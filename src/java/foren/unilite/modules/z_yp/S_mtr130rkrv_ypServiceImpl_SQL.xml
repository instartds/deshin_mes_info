<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="s_mtr130rkrv_ypServiceImpl">

	<select id="s_mtr130rkrv_ypServiceImpl.selectList" parameterType="Map" resultType="rMap">
        --입고현황출력
        BEGIN
                DECLARE               @COMP_CODE           NVARCHAR(08)             --(필수) 법인코드
                                    , @DIV_CODE            NVARCHAR(08)             --(필수) 사업장
                                    , @INOUT_FR_DATE       NVARCHAR(08)             --(필수) 입고일(FR)
                                    , @INOUT_TO_DATE       NVARCHAR(08)             --(필수) 입고일(TO)
                                    , @ORDER_TYPE          NVARCHAR(02)             --(선택) 발주형태
                                    , @INOUT_CODE          NVARCHAR(20)             --(선택) 거래처코드
                                    , @CUSTOM_NAME         NVARCHAR(40)
                                    , @ITEM_CODE           NVARCHAR(20)             --(선택) 품목코드
                                    , @ITEM_NAME           NVARCHAR(200)
                                    , @INOUT_PRSN          NVARCHAR(10)             --(선택) 입고담당자
                                    , @WH_CODE             NVARCHAR(08)             --(선택) 입고창고
                                    , @INOUT_TYPE_DETAIL   NVARCHAR(03)
                                    , @ITEM_ACCOUNT        NVARCHAR(02)             --(선택) 품목계정
                                    , @ITEM_LEVEL1         NVARCHAR(05)
                                    , @ITEM_LEVEL2         NVARCHAR(05)
                                    , @ITEM_LEVEL3         NVARCHAR(05)
                                    , @USER_ID             NVARCHAR(100)             --(필수) USER ID
                                    , @PROJECT_NO          NVARCHAR(20)             --(선택) 관리번호
                                    , @PRINT_USER          NVARCHAR(100)            --(선택) 출력자
                                    , @VIEW_PRINT_INFO_YN  NVARCHAR(01)             --인쇄출력정보 여부
                                    , @QUERY_TYPE          NVARCHAR(01)             --(필수) 품목별 : 1, 거래처별 : 2
                                    , @ITEM_NAME_SEARCH    NVARCHAR(200)             --품목명 (검색용 textBOX)

                SET NOCOUNT ON
                SET ARITHABORT ON

                SET @COMP_CODE                  =   #{S_COMP_CODE}
                SET @DIV_CODE                   =   #{DIV_CODE}
                SET @INOUT_FR_DATE              =   #{INOUT_FR_DATE}
                SET @INOUT_TO_DATE              =   #{INOUT_TO_DATE}
                SET @ORDER_TYPE                 =   #{ORDER_TYPE}
                SET @INOUT_CODE                 =   #{CUSTOM_CODE}
                SET @CUSTOM_NAME                =   #{CUSTOM_NAME}
                SET @ITEM_CODE                  =   #{ITEM_CODE}
                SET @ITEM_NAME                  =   #{ITEM_NAME}
                SET @INOUT_PRSN                 =   #{INOUT_PRSN}
                SET @WH_CODE                    =   #{WH_CODE}
                SET @INOUT_TYPE_DETAIL          =   #{INOUT_TYPE_DETAIL}
                SET @ITEM_ACCOUNT               =   #{ITEM_ACCOUNT}
                SET @ITEM_LEVEL1                =   #{ITEM_LEVEL1}
                SET @ITEM_LEVEL2                =   #{ITEM_LEVEL1}
                SET @ITEM_LEVEL3                =   #{ITEM_LEVEL1}
                SET @USER_ID                    =   #{S_USER_ID}
                SET @PROJECT_NO                 =   #{PROJECT_NO}
                SET @ITEM_NAME_SEARCH       =   #{ITEM_NAME_SEARCH}


                SET @QUERY_TYPE                 =   N'2'

                SELECT @PRINT_USER = USER_NAME
                  FROM BSA300T WITH(NOLOCK)
                 WHERE COMP_CODE = @COMP_CODE
                   AND USER_ID = @USER_ID

                SELECT @VIEW_PRINT_INFO_YN = SUB_CODE
                  FROM BSA100T WITH(NOLOCK)
                 WHERE COMP_CODE = @COMP_CODE
                   AND MAIN_CODE = 'B249'
                   AND SUB_CODE != '$'
                   AND REF_CODE1 = 'Y'

        SELECT S.COMP_CODE
            , S.DIV_CODE
            , S.INOUT_CODE                                  AS CUSTOM_CODE
            , uniLITE.fnCustName(@USER_ID, S.INOUT_CODE)    AS CUSTOM_NAME
            , MAX(S.TAX_TYPE)                               AS TAX_TYPE
           -- , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN S.INOUT_I
           --             WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
           --             ELSE 0 END )        INOUT_I
           -- , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN S.INOUT_I
           --             WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
           --             ELSE 0 END )        S_INOUT_I
            , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN
                                S.INOUT_I
                        WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN
                            CASE WHEN M4.TAX_TYPE = '1' THEN
                                S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
                            ELSE
                                ROUND(S.INOUT_I,0)
                            END
                        ELSE 0 END
                )                       AS INOUT_I

            , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN
                                S.INOUT_I
                        WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN
                            CASE WHEN M4.TAX_TYPE = '1' THEN
                                S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
                            ELSE
                                ROUND(S.INOUT_I,0)
                            END
                        ELSE 0 END
                )                       AS S_INOUT_I
           , B.CODE_NAME                                   AS CUST_TYPE    --거래처 구분
            , M4.BANK_CODE                                                  --은행코드
            , uniLITE.fnCustName(@USER_ID, M5.CUSTOM_CODE)  AS BANK_NAME    --거래처 은행명
            , uniLITE.fnCipherDecrypt(M4.BANKBOOK_NUM, '')  AS BANKBOOK_NUM --계좌번호
            , M4.BANKBOOK_NAME                                              --예금주
            , B2.CODE_NAME                                  AS BILL_PUBLISH_TYPE  --1:발행 2:미발행
            , '' REMARK
            , (CASE WHEN ISNULL(@INOUT_FR_DATE, '') = ''
                THEN ''
                ELSE REPLACE(REPLACE(REPLACE('YYYY.MM.DD', 'YYYY', SUBSTRING(@INOUT_FR_DATE, 1, 4))
                                                            , 'MM'  , SUBSTRING(@INOUT_FR_DATE, 5, 2))
                                                            , 'DD'  , SUBSTRING(@INOUT_FR_DATE, 7, 2))
                END)                                                AS INOUT_FR_DATE
            , (CASE WHEN ISNULL(@INOUT_TO_DATE, '') = ''
                THEN ''
                ELSE REPLACE(REPLACE(REPLACE('YYYY.MM.DD', 'YYYY', SUBSTRING(@INOUT_TO_DATE, 1, 4))
                                                            , 'MM'  , SUBSTRING(@INOUT_TO_DATE, 5, 2))
                                                            , 'DD'  , SUBSTRING(@INOUT_TO_DATE, 7, 2))
            END)                                                AS INOUT_TO_DATE
            , @PRINT_USER           AS PRINT_USER                   --출력자 이름
            , @VIEW_PRINT_INFO_YN  AS VIEW_PRINT_INFO_YN           --인쇄출력정보 표시여부
            FROM BTR100T S
            LEFT JOIN   BPR200T  M3 WITH (NOLOCK) ON M3.COMP_CODE        = S.COMP_CODE
                                                    AND M3.DIV_CODE         = S.DIV_CODE
                                                    AND M3.ITEM_CODE        = S.ITEM_CODE
            LEFT JOIN   BPR100T  M2 WITH (NOLOCK) ON M2.COMP_CODE        = S.COMP_CODE
                                                    AND M2.ITEM_CODE        = S.ITEM_CODE
            LEFT JOIN   BCM100T  M4 WITH (NOLOCK) ON M4.COMP_CODE        = S.COMP_CODE
                                                    AND M4.CUSTOM_CODE   = S.INOUT_CODE
            LEFT JOIN   BCM100T  M5 WITH (NOLOCK) ON M5.COMP_CODE        = M4.COMP_CODE
                                                    AND M5.CUSTOM_CODE   = M4.BANK_CODE
            LEFT JOIN BSA100T B WITH(NOLOCK) ON B.COMP_CODE = M4.COMP_CODE
                                                AND B.MAIN_CODE = 'B055'
                                                AND B.SUB_CODE = M4.AGENT_TYPE
            LEFT JOIN BSA100T B2 WITH(NOLOCK) ON B2.COMP_CODE = M4.COMP_CODE
                                                AND B2.MAIN_CODE = 'B214'
                                                AND B2.SUB_CODE = M4.BILL_PUBLISH_TYPE
            WHERE S.COMP_CODE = @COMP_CODE
                AND S.DIV_CODE = @DIV_CODE
                AND S.INOUT_TYPE = '1'
                AND S.CREATE_LOC = '2'
                <if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">
                AND (ISNULL(S.ORDER_TYPE,'')   = @ORDER_TYPE          AND   ISNULL(S.ORDER_TYPE,'') != '4')
                </if>
                AND ((S.INOUT_DATE         &gt;=  @INOUT_FR_DATE        AND @INOUT_FR_DATE       != '') OR (@INOUT_FR_DATE      = ''))
                AND ((S.INOUT_DATE         &lt;=  @INOUT_TO_DATE        AND @INOUT_TO_DATE       != '') OR (@INOUT_TO_DATE      = ''))
                AND ((S.INOUT_CODE       LIKE  @INOUT_CODE + '%'     AND @INOUT_CODE          != '') OR (@INOUT_CODE         = ''))
                AND ((M4.CUSTOM_NAME      LIKE  '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME          != '') OR (@CUSTOM_NAME         = ''))
                AND ((S.INOUT_PRSN          =  @INOUT_PRSN           AND @INOUT_PRSN          != '') OR (@INOUT_PRSN         = ''))
                AND ((S.INOUT_TYPE_DETAIL   =  @INOUT_TYPE_DETAIL    AND @INOUT_TYPE_DETAIL   != '') OR (@INOUT_TYPE_DETAIL  = ''))
                AND ((S.WH_CODE             =  @WH_CODE              AND @WH_CODE             != '') OR (@WH_CODE            = ''))
                AND ((M3.ITEM_ACCOUNT        =  @ITEM_ACCOUNT         AND @ITEM_ACCOUNT        != '') OR (@ITEM_ACCOUNT       = ''))
                AND ((M2.ITEM_LEVEL1         =  @ITEM_LEVEL1          AND @ITEM_LEVEL1         != '') OR (@ITEM_LEVEL1        = ''))
                AND ((M2.ITEM_LEVEL2         =  @ITEM_LEVEL2          AND @ITEM_LEVEL2         != '') OR (@ITEM_LEVEL2        = ''))
                AND ((M2.ITEM_LEVEL3         =  @ITEM_LEVEL3          AND @ITEM_LEVEL3         != '') OR (@ITEM_LEVEL3        = ''))
                AND ((S.ITEM_CODE        LIKE  @ITEM_CODE + '%'      AND @ITEM_CODE           != '') OR (@ITEM_CODE          = ''))
                <if test="@foren.Ognl@isNotEmpty(ITEM_NAME_SEARCH)">
					AND ((M2.ITEM_NAME       LIKE  @ITEM_NAME_SEARCH + '%'      AND @ITEM_NAME_SEARCH           != '') OR (@ITEM_NAME_SEARCH          = ''))
                </if>
                AND ((S.PROJECT_NO          =  @PROJECT_NO           AND @PROJECT_NO          != '') OR (@PROJECT_NO         = ''))
            GROUP BY S.COMP_CODE, S.DIV_CODE, S.INOUT_CODE, M4.BANK_CODE, M5.CUSTOM_CODE, M4.BANKBOOK_NUM, M4.BANKBOOK_NAME, M4.BILL_PUBLISH_TYPE
                ,B.CODE_NAME, B2.CODE_NAME
			ORDER BY uniLITE.fnCustName(@USER_ID, S.INOUT_CODE)
                    SET NOCOUNT OFF
                SET ARITHABORT OFF
        END
	</select>


    <select id="s_mtr130rkrv_ypServiceImpl.printList1" parameterType="Map" resultType="rMap">
        --입고현황출력
        BEGIN
                DECLARE               @COMP_CODE           NVARCHAR(08)             --(필수) 법인코드
                                    , @DIV_CODE            NVARCHAR(08)             --(필수) 사업장
                                    , @INOUT_FR_DATE       NVARCHAR(08)             --(필수) 입고일(FR)
                                    , @INOUT_TO_DATE       NVARCHAR(08)             --(필수) 입고일(TO)
                                    , @ORDER_TYPE          NVARCHAR(02)             --(선택) 발주형태
                                    , @INOUT_CODE          NVARCHAR(20)             --(선택) 거래처코드
                                    , @CUSTOM_NAME         NVARCHAR(40)
                                    , @ITEM_CODE           NVARCHAR(20)             --(선택) 품목코드
                                    , @ITEM_NAME           NVARCHAR(200)
                                    , @INOUT_PRSN          NVARCHAR(10)             --(선택) 입고담당자
                                    , @WH_CODE             NVARCHAR(08)             --(선택) 입고창고
                                    , @INOUT_TYPE_DETAIL   NVARCHAR(03)
                                    , @ITEM_ACCOUNT        NVARCHAR(02)             --(선택) 품목계정
                                    , @ITEM_LEVEL1         NVARCHAR(05)
                                    , @ITEM_LEVEL2         NVARCHAR(05)
                                    , @ITEM_LEVEL3         NVARCHAR(05)
                                    , @USER_ID             NVARCHAR(100)             --(필수) USER ID
                                    , @PROJECT_NO          NVARCHAR(20)             --(선택) 관리번호
                                    , @PRINT_USER          NVARCHAR(100)            --(선택) 출력자
                                    , @VIEW_PRINT_INFO_YN  NVARCHAR(01)             --인쇄출력정보 여부
                                    , @QUERY_TYPE          NVARCHAR(01)             --(필수) 품목별 : 1, 거래처별 : 2

                SET NOCOUNT ON
                SET ARITHABORT ON

                SET @COMP_CODE                  =   ISNULL(#{S_COMP_CODE}, '')
                SET @DIV_CODE                   =   ISNULL(#{DIV_CODE}, '')
                SET @INOUT_FR_DATE              =   ISNULL(#{INOUT_FR_DATE}, '')
                SET @INOUT_TO_DATE              =   ISNULL(#{INOUT_TO_DATE}, '')
                SET @ORDER_TYPE                 =   ISNULL(#{ORDER_TYPE}, '')
                SET @INOUT_CODE                 =   ISNULL(#{CUSTOM_CODE}, '')
                SET @CUSTOM_NAME                =   ISNULL(#{CUSTOM_NAME}, '')
                SET @ITEM_CODE                  =   ISNULL(#{ITEM_CODE}, '')
                SET @ITEM_NAME                  =   ISNULL(#{ITEM_NAME}, '')
                SET @INOUT_PRSN                 =   ISNULL(#{INOUT_PRSN}, '')
                SET @WH_CODE                    =   ISNULL(#{WH_CODE}, '')
                SET @INOUT_TYPE_DETAIL          =   ISNULL(#{INOUT_TYPE_DETAIL}, '')
                SET @ITEM_ACCOUNT               =   ISNULL(#{ITEM_ACCOUNT}, '')
                SET @ITEM_LEVEL1                =   ISNULL(#{ITEM_LEVEL1}, '')
                SET @ITEM_LEVEL2                =   ISNULL(#{ITEM_LEVEL1}, '')
                SET @ITEM_LEVEL3                =   ISNULL(#{ITEM_LEVEL1}, '')
                SET @USER_ID                    =   ISNULL(#{S_USER_ID}, '')
                SET @PROJECT_NO                 =   ISNULL(#{PROJECT_NO}, '')

                SET @QUERY_TYPE                 =   N'2'

                SELECT @PRINT_USER = USER_NAME
                  FROM BSA300T WITH(NOLOCK)
                 WHERE COMP_CODE = @COMP_CODE
                   AND USER_ID = @USER_ID

                SELECT @VIEW_PRINT_INFO_YN = SUB_CODE
                  FROM BSA100T WITH(NOLOCK)
                 WHERE COMP_CODE = @COMP_CODE
                   AND MAIN_CODE = 'B249'
                   AND SUB_CODE != '$'
                   AND REF_CODE1 = 'Y'


	IF EXISTS (SELECT TOP 1 1 FROM tempdb.sys.objects WHERE object_id = OBJECT_ID('tempdb..#SUM_BTR100T'))
		DROP TABLE #SUM_BTR100T

                                             SELECT S.COMP_CODE, S.DIV_CODE, S.INOUT_CODE
                                                --, SUM(S.INOUT_I) AS INOUT_I_NO
                                                , SUM(S.INOUT_Q)    AS INOUT_Q_AMT
                                                , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN S.INOUT_I ELSE 0 END) AS INOUT_I_AMT        --면세 합계
                                                --, SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I ELSE 0 END) AS INOUT_I_V_AMT  --공급가 합계
                                                --, SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I ELSE 0 END
                                                --    * M4.VAT_RATE/100)                                              AS INOUT_TAX_AMT    --부가세 합계
												, SUM( CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN
															CASE WHEN M4.TAX_TYPE = '1' THEN
																S.INOUT_I
															ELSE
																ROUND(S.INOUT_I / (1 + M4.VAT_RATE / 100), 0)
															END
														ELSE
															0
														END
													  ) AS INOUT_I_V_AMT  																		--공급가 합계

												, SUM(
														CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN
															CASE WHEN M4.TAX_TYPE = '1' THEN
																S.INOUT_I * M4.VAT_RATE / 100
															ELSE
																ROUND(S.INOUT_I, 0) - ROUND(ROUND(S.INOUT_I, 0) / (1 + M4.VAT_RATE / 100), 0)
															END
														ELSE
																0
														END
                                                   )                                              AS INOUT_TAX_AMT    						--부가세 합계
                                                --, SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN S.INOUT_I
                                                --         WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
                                                --         ELSE 0 END )       INOUT_TOT_AMT
                                                 , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN
																S.INOUT_I
                                                         WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN

															CASE WHEN M4.TAX_TYPE = '1' THEN
																S.INOUT_I + (S.INOUT_I * M4.VAT_RATE / 100)
															ELSE
																ROUND(S.INOUT_I, 0)
															END
                                                         ELSE
																0
														 END
													)       INOUT_TOT_AMT


                                                INTO #SUM_BTR100T
                                                FROM BTR100T S WITH (NOLOCK)
                                                LEFT JOIN   BPR200T  M3 WITH (NOLOCK) ON M3.COMP_CODE        = S.COMP_CODE
                                                                                     AND M3.DIV_CODE         = S.DIV_CODE
                                                                                     AND M3.ITEM_CODE        = S.ITEM_CODE
                                                LEFT JOIN   BPR100T  M2 WITH (NOLOCK) ON M2.COMP_CODE        = S.COMP_CODE
                                                                                     AND M2.ITEM_CODE        = S.ITEM_CODE
                                                LEFT JOIN   BCM100T  M4 WITH (NOLOCK) ON M4.COMP_CODE        = S.COMP_CODE
                                                                                        AND M4.CUSTOM_CODE   = S.INOUT_CODE

                                                WHERE S.COMP_CODE = @COMP_CODE
                                                    AND S.DIV_CODE = @DIV_CODE
                                                    AND S.INOUT_TYPE = '1'
                                                    AND ISNULL(S.ORDER_TYPE,'') != '4'
                                                    AND S.CREATE_LOC = '2'
                                                    AND ((S.INOUT_DATE         &gt;=  @INOUT_FR_DATE        AND @INOUT_FR_DATE       != '') OR (@INOUT_FR_DATE      = ''))
                                                    AND ((S.INOUT_DATE         &lt;=  @INOUT_TO_DATE        AND @INOUT_TO_DATE       != '') OR (@INOUT_TO_DATE      = ''))
                                                    AND ((S.INOUT_CODE       LIKE  @INOUT_CODE + '%'     AND @INOUT_CODE          != '') OR (@INOUT_CODE         = ''))
                                                    AND ((M4.CUSTOM_NAME      LIKE  '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME          != '') OR (@CUSTOM_NAME         = ''))
                                                    AND ((S.INOUT_PRSN          =  @INOUT_PRSN           AND @INOUT_PRSN          != '') OR (@INOUT_PRSN         = ''))
                                                    AND ((S.INOUT_TYPE_DETAIL   =  @INOUT_TYPE_DETAIL    AND @INOUT_TYPE_DETAIL   != '') OR (@INOUT_TYPE_DETAIL  = ''))
                                                    AND ((S.WH_CODE             =  @WH_CODE              AND @WH_CODE             != '') OR (@WH_CODE            = ''))
                                                    AND ((M3.ITEM_ACCOUNT        =  @ITEM_ACCOUNT         AND @ITEM_ACCOUNT        != '') OR (@ITEM_ACCOUNT       = ''))
                                                    AND ((M2.ITEM_LEVEL1         =  @ITEM_LEVEL1          AND @ITEM_LEVEL1         != '') OR (@ITEM_LEVEL1        = ''))
                                                    AND ((M2.ITEM_LEVEL2         =  @ITEM_LEVEL2          AND @ITEM_LEVEL2         != '') OR (@ITEM_LEVEL2        = ''))
                                                    AND ((M2.ITEM_LEVEL3         =  @ITEM_LEVEL3          AND @ITEM_LEVEL3         != '') OR (@ITEM_LEVEL3        = ''))
                                                    AND ((S.ITEM_CODE        LIKE  @ITEM_CODE + '%'      AND @ITEM_CODE           != '') OR (@ITEM_CODE          = ''))
                                                    AND ((S.PROJECT_NO          =  @PROJECT_NO           AND @PROJECT_NO          != '') OR (@PROJECT_NO         = ''))

                                                GROUP BY S.COMP_CODE, S.DIV_CODE, S.INOUT_CODE--, M2.TAX_TYPE



                SELECT A.INDEX01                        AS CUSTOM_CODE
                    , A.INDEX02                         AS CUSTOM_NAME
                    , A.INDEX03                         AS INOUT_DATE
                    , SUBSTRING(A.INDEX03, 1, 7)        AS INOUT_MONTH
                    , A.ITEM_CODE
                    , uniLITE.fnItemNameComp(A.COMP_CODE, @USER_ID, A.ITEM_CODE) AS ITEM_NAME
                    , A.SPEC AS SPEC
                    , A.INOUT_Q         --수량
                    , A.INOUT_P         --단가
                    , CASE WHEN ISNULL(A.TAX_TYPE, '1') = '2' THEN A.INOUT_I ELSE 0 END AS INOUT_I      --면세
				--, CASE WHEN ISNULL(A.TAX_TYPE, '1') = '1' THEN A.INOUT_I ELSE 0 END AS INOUT_I_V    --공급가
                , CASE WHEN ISNULL(A.TAX_TYPE, '1') = '1' THEN
						CASE WHEN A.CUSTOM_TAX_TYPE = '1'   THEN
							A.INOUT_I
						ELSE
							ROUND(ROUND(A.INOUT_I, 0) / (1 + A.VAT_RATE / 100 ), 0)
						END
					ELSE
						0
					END																AS INOUT_I_V    --공급가

				, CASE WHEN ISNULL(A.TAX_TYPE, '1') = '1' THEN       --과세

					CASE WHEN A.CUSTOM_TAX_TYPE = '1'   THEN
						A.INOUT_I * A.VAT_RATE / 100
					ELSE
						ROUND(A.INOUT_I, 0) - ROUND(ROUND(A.INOUT_I, 0) / (1 + A.VAT_RATE / 100 ), 0)
					END
				  ELSE
						0
				  END
																					AS INOUT_TAX    --부가세
                    , A.REMARK
                    , A.MY_CUSTOM_NAME
                    , A.MY_TOP_NAME
                    , A.COMP_TYPE
                    , A.COMP_CLASS
                    , A.MY_COMPANY_NUM
                    , A.MY_ADDR
                    , A.TELEPHON
                    , A.FAX_NUM
                    , A.INOUT_Q_AMT
                    , A.INOUT_I_AMT
                    , A.INOUT_I_V_AMT
                    , A.INOUT_TAX_AMT
                    , A.INOUT_TOT_AMT
                    , replace(unilite.fnConvertToAmt(A.INOUT_TOT_AMT), ' ', '') + '원정'    AS INOUT_TOT_AMT_KO
                    , (CASE WHEN ISNULL(@INOUT_FR_DATE, '') = ''
                            THEN ''
                            ELSE REPLACE(REPLACE(REPLACE('YYYY.MM.DD', 'YYYY', SUBSTRING(@INOUT_FR_DATE, 1, 4))
                                                                        , 'MM'  , SUBSTRING(@INOUT_FR_DATE, 5, 2))
                                                                        , 'DD'  , SUBSTRING(@INOUT_FR_DATE, 7, 2))
                            END)                                                AS INOUT_FR_DATE
                    , (CASE WHEN ISNULL(@INOUT_TO_DATE, '') = ''
                            THEN ''
                            ELSE REPLACE(REPLACE(REPLACE('YYYY.MM.DD', 'YYYY', SUBSTRING(@INOUT_TO_DATE, 1, 4))
                                                                        , 'MM'  , SUBSTRING(@INOUT_TO_DATE, 5, 2))
                                                                        , 'DD'  , SUBSTRING(@INOUT_TO_DATE, 7, 2))
                        END)                                                AS INOUT_TO_DATE
                    , @PRINT_USER           AS PRINT_USER                   --출력자 이름
                    , @VIEW_PRINT_INFO_YN   AS VIEW_PRINT_INFO_YN           --인쇄출력정보 표시여부
                    FROM
                        (
                            SELECT CASE WHEN @QUERY_TYPE = '1' THEN  M1.ITEM_CODE
                                        WHEN @QUERY_TYPE = '2' THEN  M1.INOUT_CODE
                                        ELSE ''
                                   END                                                                                             AS INDEX01
                                 , CASE WHEN @QUERY_TYPE = '1' THEN  uniLITE.fnItemNameComp(M1.COMP_CODE, @USER_ID, M1.ITEM_CODE)
                                        WHEN @QUERY_TYPE = '2' THEN  uniLITE.fnCustName(@USER_ID, M1.INOUT_CODE)
                                        ELSE ''
                                   END                                                                                             AS INDEX02
                                 , CASE WHEN @QUERY_TYPE = '1' THEN  M2.SPEC
                                        WHEN @QUERY_TYPE = '2' THEN  uniLITE.fnGetUserDate(M1.COMP_CODE, M1.INOUT_DATE)
                                        ELSE ''
                                   END                                                                                             AS INDEX03
                                 , CASE WHEN @QUERY_TYPE = '1' THEN  unilite.fnGetUserDate(M1.COMP_CODE, M1.INOUT_DATE)
                                        WHEN @QUERY_TYPE = '2' THEN  M1.ITEM_CODE
                                        ELSE ''
                                   END                                                                                             AS INDEX04
                                 , CASE WHEN @QUERY_TYPE = '1' THEN  M1.INOUT_CODE
                                        WHEN @QUERY_TYPE = '2' THEN  uniLITE.fnItemNameComp(M1.COMP_CODE, @USER_ID, M1.ITEM_CODE)
                                        ELSE ''
                                   END                                                                                             AS INDEX05
                                 , CASE WHEN @QUERY_TYPE = '1' THEN  uniLITE.fnCustName(@USER_ID, M1.INOUT_CODE)
                                        WHEN @QUERY_TYPE = '2' THEN  M2.SPEC
                                        ELSE ''
                                   END                                                                                             AS INDEX06
                                 , CASE M1.INOUT_METH
                                        WHEN '6' THEN M1.INOUT_Q * -1
                                        WHEN '5' THEN M1.INOUT_Q * -1
                                        ELSE M1.INOUT_Q
                                   END                                                                                             AS INOUT_Q

                                 , CASE M1.INOUT_METH
                                        WHEN '6' THEN M1.INOUT_P * -1
                                        WHEN '5' THEN M1.INOUT_P * -1
                                        ELSE M1.INOUT_P
                                   END                                                                                             AS INOUT_P
                                 , CASE M1.INOUT_METH
                                        WHEN '6' THEN M1.INOUT_I * -1
                                        WHEN '5' THEN M1.INOUT_I * -1
                                        ELSE M1.INOUT_I
                                   END                                                                                             AS INOUT_I
                                 , M2.STOCK_UNIT                                                                                   AS STOCK_UNIT
                                 , B6.TREE_NAME                                                                                    AS WH_CODE
                                 , B3.CODE_NAME                                                                                    AS INOUT_PRSN
                                 , M1.INOUT_NUM                                                                                    AS INOUT_NUM
                                 , B4.CODE_NAME                                                                                    AS INOUT_METH
                                 , B5.CODE_NAME                                                                                    AS INOUT_TYPE_DETAIL
                                 , uniLITE.fnGetUserDate(@COMP_CODE, M5.ORDER_DATE)                                                AS ORDER_DATE
                                 , M5.ORDER_NUM                                                                                    AS ORDER_NUM
                                 , M6.ORDER_SEQ                                                                                    AS ORDER_SEQ
                                 , M1.LC_NUM                                                                                       AS LC_NUM
                                 , M1.BL_NUM                                                                                       AS BL_NUM
                                 , B1.DIV_NAME                                                                                     AS DIV_CODE
                                 , B7.CODE_NAME                                                                                    AS PRICE_YN
                                 , M1.PROJECT_NO                                                                                   AS PROJECT_NO
                                 , M1.ITEM_CODE
                                 , M2.ITEM_NAME
                                 , M1.COMP_CODE
                                 , M1.REMARK

                                 , B1.DIV_CODE    AS MY_CUSTOM_CODE      --사업장코드
                                 , B1.DIV_NAME    AS MY_CUSTOM_NAME      --상호
                                 , B1.REPRE_NAME  AS MY_TOP_NAME         --대표자
                                 , B1.COMP_TYPE                     --업태
                                 , B1.COMP_CLASS                        --종목
                                 , CASE ISNULL(B1.COMPANY_NUM,'')
                                                 WHEN '' THEN ''
                                   ELSE         SUBSTRING(B1.COMPANY_NUM,1,3) + '-'
                                                + SUBSTRING(B1.COMPANY_NUM,4,2) + '-'
                                                + SUBSTRING(B1.COMPANY_NUM,6,5)
                                   END          AS MY_COMPANY_NUM           --등록번호
                                 , B1.ADDR      AS MY_ADDR                  --사업장주소
                                 , B1.TELEPHON                          --전화번호
                                 , B1.FAX_NUM                               --팩스
                                 , X.INOUT_Q_AMT
                                 , X.INOUT_I_AMT
                                 , X.INOUT_I_V_AMT
                                 , X.INOUT_TAX_AMT
                                 , X.INOUT_TOT_AMT
                                 , M2.SPEC
                                 , M2.TAX_TYPE
                                 , M4.VAT_RATE
                                 , M4.TAX_TYPE AS CUSTOM_TAX_TYPE
                            FROM                BTR100T  M1 WITH (NOLOCK)
                                    LEFT JOIN   BPR100T  M2 WITH (NOLOCK) ON M2.COMP_CODE        = M1.COMP_CODE
                                                                         AND M2.ITEM_CODE        = M1.ITEM_CODE
                                    LEFT JOIN   BPR200T  M3 WITH (NOLOCK) ON M3.COMP_CODE        = M1.COMP_CODE
                                                                         AND M3.DIV_CODE         = M1.DIV_CODE
                                                                         AND M3.ITEM_CODE        = M1.ITEM_CODE
                                    LEFT JOIN   BCM100T  M4 WITH (NOLOCK) ON M4.COMP_CODE        = M1.COMP_CODE
                                                                         AND M4.CUSTOM_CODE      = M1.INOUT_CODE
                                    LEFT JOIN   MPO100T  M5 WITH (NOLOCK) ON M5.COMP_CODE        = M1.COMP_CODE
                                                                         AND M5.DIV_CODE         = M1.DIV_CODE
                                                                         AND M5.CUSTOM_CODE      = M1.INOUT_CODE
                                                                         AND M5.ORDER_NUM        = M1.ORDER_NUM
                                    LEFT JOIN   MPO200T  M6 WITH (NOLOCK) ON M6.COMP_CODE        = M1.COMP_CODE
                                                                         AND M6.DIV_CODE         = M1.DIV_CODE
                                                                         AND M6.CUSTOM_CODE      = M1.INOUT_CODE
                                                                         AND M6.ORDER_NUM        = M1.ORDER_NUM
                                                                         AND M6.ORDER_SEQ        = M1.ORDER_SEQ
                                    LEFT JOIN   BOR120T  B1 WITH (NOLOCK) ON B1.COMP_CODE        = M1.COMP_CODE
                                                                         AND B1.DIV_CODE         = M1.DIV_CODE
                                    LEFT JOIN   BSA100T  B2 WITH (NOLOCK) ON B2.COMP_CODE        = M1.COMP_CODE
                                                                         AND B2.MAIN_CODE        = 'B004'
                                                                         AND B2.REF_CODE1        = 'Y'
                                    LEFT JOIN   BSA100T  B3 WITH (NOLOCK) ON B3.COMP_CODE        = M1.COMP_CODE
                                                                         AND B3.MAIN_CODE        = 'B024'
                                                                         AND B3.SUB_CODE         = M1.INOUT_PRSN
                                    LEFT JOIN   BSA100T  B4 WITH (NOLOCK) ON B4.COMP_CODE        = M1.COMP_CODE
                                                                         AND B4.MAIN_CODE        = 'B036'
                                                                         AND B4.SUB_CODE         = M1.INOUT_METH
                                    LEFT JOIN   BSA100T  B5 WITH (NOLOCK) ON B5.COMP_CODE        = M1.COMP_CODE
                                                                         AND B5.MAIN_CODE        = 'M103'
                                                                         AND B5.SUB_CODE         = M1.INOUT_TYPE_DETAIL
                                    LEFT JOIN   BSA220T  B6 WITH (NOLOCK) ON B6.COMP_CODE        = M1.COMP_CODE
                                                                         AND B6.TREE_CODE        = M1.WH_CODE
                                    LEFT JOIN   BSA100T  B7 WITH (NOLOCK) ON B7.COMP_CODE        = M1.COMP_CODE
                                                                         AND B7.MAIN_CODE        = 'M301'
                                                                         AND B7.SUB_CODE         = M1.PRICE_YN

                                    LEFT JOIN (
                                                  SELECT * FROM #SUM_BTR100T

                                                ) X ON X.COMP_CODE = M1.COMP_CODE AND X.DIV_CODE = M1.DIV_CODE
                                                    AND X.INOUT_CODE = M1.INOUT_CODE

                                    <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODES)">
                                    INNER JOIN uniLITE.fnSplit(#{CUSTOM_CODES}, ',') AS F ON F.VALUE = M1.INOUT_CODE
                                    </if>

                            WHERE  M1.COMP_CODE             =  @COMP_CODE
                               AND M1.DIV_CODE              =  @DIV_CODE
                               AND M1.INOUT_TYPE            =  '1'
                               AND ISNULL(M1.ORDER_TYPE,'') != '4'
                               AND M1.CREATE_LOC            = '2'
                               AND ((M1.INOUT_DATE         &gt;=  @INOUT_FR_DATE        AND @INOUT_FR_DATE       != '') OR (@INOUT_FR_DATE      = ''))
                               AND ((M1.INOUT_DATE         &lt;=  @INOUT_TO_DATE        AND @INOUT_TO_DATE       != '') OR (@INOUT_TO_DATE      = ''))
                               AND ((M1.ORDER_TYPE          =  @ORDER_TYPE           AND @ORDER_TYPE          != '') OR (@ORDER_TYPE         = ''))
                               AND ((M1.INOUT_CODE       LIKE  @INOUT_CODE + '%'     AND @INOUT_CODE          != '') OR (@INOUT_CODE         = ''))
                               AND ((M4.CUSTOM_NAME      LIKE  '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME          != '') OR (@CUSTOM_NAME         = ''))
                               AND ((M1.INOUT_PRSN          =  @INOUT_PRSN           AND @INOUT_PRSN          != '') OR (@INOUT_PRSN         = ''))
                               AND ((M1.INOUT_TYPE_DETAIL   =  @INOUT_TYPE_DETAIL    AND @INOUT_TYPE_DETAIL   != '') OR (@INOUT_TYPE_DETAIL  = ''))
                               AND ((M1.WH_CODE             =  @WH_CODE              AND @WH_CODE             != '') OR (@WH_CODE            = ''))
                               AND ((M3.ITEM_ACCOUNT        =  @ITEM_ACCOUNT         AND @ITEM_ACCOUNT        != '') OR (@ITEM_ACCOUNT       = ''))
                               AND ((M2.ITEM_LEVEL1         =  @ITEM_LEVEL1          AND @ITEM_LEVEL1         != '') OR (@ITEM_LEVEL1        = ''))
                               AND ((M2.ITEM_LEVEL2         =  @ITEM_LEVEL2          AND @ITEM_LEVEL2         != '') OR (@ITEM_LEVEL2        = ''))
                               AND ((M2.ITEM_LEVEL3         =  @ITEM_LEVEL3          AND @ITEM_LEVEL3         != '') OR (@ITEM_LEVEL3        = ''))
                               AND ((M1.ITEM_CODE        LIKE  @ITEM_CODE + '%'      AND @ITEM_CODE           != '') OR (@ITEM_CODE          = ''))
                               AND ((M1.PROJECT_NO          =  @PROJECT_NO           AND @PROJECT_NO          != '') OR (@PROJECT_NO         = ''))
                        ) A
                    ORDER BY 2,1,3

                SET NOCOUNT OFF
                SET ARITHABORT OFF

        END
    </select>

    <select id="s_mtr130rkrv_ypServiceImpl.printList2" parameterType="Map" resultType="rMap">
        --입고현황출력
        BEGIN
                DECLARE               @COMP_CODE           NVARCHAR(08)             --(필수) 법인코드
                                    , @DIV_CODE            NVARCHAR(08)             --(필수) 사업장
                                    , @INOUT_FR_DATE       NVARCHAR(08)             --(필수) 입고일(FR)
                                    , @INOUT_TO_DATE       NVARCHAR(08)             --(필수) 입고일(TO)
                                    , @ORDER_TYPE          NVARCHAR(02)             --(선택) 발주형태
                                    , @INOUT_CODE          NVARCHAR(20)             --(선택) 거래처코드
                                    , @CUSTOM_NAME         NVARCHAR(40)
                                    , @ITEM_CODE           NVARCHAR(20)             --(선택) 품목코드
                                    , @ITEM_NAME           NVARCHAR(200)
                                    , @INOUT_PRSN          NVARCHAR(10)             --(선택) 입고담당자
                                    , @WH_CODE             NVARCHAR(08)             --(선택) 입고창고
                                    , @INOUT_TYPE_DETAIL   NVARCHAR(03)
                                    , @ITEM_ACCOUNT        NVARCHAR(02)             --(선택) 품목계정
                                    , @ITEM_LEVEL1         NVARCHAR(05)
                                    , @ITEM_LEVEL2         NVARCHAR(05)
                                    , @ITEM_LEVEL3         NVARCHAR(05)
                                    , @USER_ID             NVARCHAR(100)             --(필수) USER ID
                                    , @PROJECT_NO          NVARCHAR(20)             --(선택) 관리번호
                                    , @PRINT_USER          NVARCHAR(100)            --(선택) 출력자
                                    , @VIEW_PRINT_INFO_YN  NVARCHAR(01)             --인쇄출력정보 여부
                                    , @QUERY_TYPE          NVARCHAR(01)             --(필수) 품목별 : 1, 거래처별 : 2

                SET NOCOUNT ON
                SET ARITHABORT ON

                SET @COMP_CODE                  =   ISNULL(#{S_COMP_CODE}, '')
                SET @DIV_CODE                   =   ISNULL(#{DIV_CODE}, '')
                SET @INOUT_FR_DATE              =   ISNULL(#{INOUT_FR_DATE}, '')
                SET @INOUT_TO_DATE              =   ISNULL(#{INOUT_TO_DATE}, '')
                SET @ORDER_TYPE                 =   ISNULL(#{ORDER_TYPE}, '')
                SET @INOUT_CODE                 =   ISNULL(#{CUSTOM_CODE}, '')
                SET @CUSTOM_NAME                =   ISNULL(#{CUSTOM_NAME}, '')
                SET @ITEM_CODE                  =   ISNULL(#{ITEM_CODE}, '')
                SET @ITEM_NAME                  =   ISNULL(#{ITEM_NAME}, '')
                SET @INOUT_PRSN                 =   ISNULL(#{INOUT_PRSN}, '')
                SET @WH_CODE                    =   ISNULL(#{WH_CODE}, '')
                SET @INOUT_TYPE_DETAIL          =   ISNULL(#{INOUT_TYPE_DETAIL}, '')
                SET @ITEM_ACCOUNT               =   ISNULL(#{ITEM_ACCOUNT}, '')
                SET @ITEM_LEVEL1                =   ISNULL(#{ITEM_LEVEL1}, '')
                SET @ITEM_LEVEL2                =   ISNULL(#{ITEM_LEVEL1}, '')
                SET @ITEM_LEVEL3                =   ISNULL(#{ITEM_LEVEL1}, '')
                SET @USER_ID                    =   ISNULL(#{S_USER_ID}, '')
                SET @PROJECT_NO                 =   ISNULL(#{PROJECT_NO}, '')


                SET @QUERY_TYPE                 =   N'2'

                SELECT @PRINT_USER = USER_NAME
                  FROM BSA300T WITH(NOLOCK)
                 WHERE COMP_CODE = @COMP_CODE
                   AND USER_ID = @USER_ID

                SELECT @VIEW_PRINT_INFO_YN = SUB_CODE
                  FROM BSA100T WITH(NOLOCK)
                 WHERE COMP_CODE = @COMP_CODE
                   AND MAIN_CODE = 'B249'
                   AND SUB_CODE != '$'
                   AND REF_CODE1 = 'Y'

        SELECT S.COMP_CODE
            , S.DIV_CODE
            , S.INOUT_CODE                                  AS CUSTOM_CODE
            , uniLITE.fnCustName(@USER_ID, S.INOUT_CODE)    AS CUSTOM_NAME
            , MAX(S.TAX_TYPE)                               AS TAX_TYPE
           -- , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN S.INOUT_I
           --             WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
           --             ELSE 0 END )        INOUT_I
           -- , SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN S.INOUT_I
           --             WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
           --             ELSE 0 END )        S_INOUT_I
 			, SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN
								S.INOUT_I
                        WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN
							CASE WHEN M4.TAX_TYPE = '1' THEN
								S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
							ELSE
								ROUND(S.INOUT_I,0)
							END
                        ELSE 0 END
				)						AS INOUT_I

			, SUM(CASE WHEN ISNULL(M2.TAX_TYPE, '1') = '2' THEN
								S.INOUT_I
                        WHEN ISNULL(M2.TAX_TYPE, '1') = '1' THEN
							CASE WHEN M4.TAX_TYPE = '1' THEN
								S.INOUT_I + (S.INOUT_I * M4.VAT_RATE/100)
							ELSE
								ROUND(S.INOUT_I,0)
							END
                        ELSE 0 END
				)						AS S_INOUT_I
           , B.CODE_NAME                                   AS CUST_TYPE    --거래처 구분
            , M4.BANK_CODE                                                  --은행코드
            , uniLITE.fnCustName(@USER_ID, M5.CUSTOM_CODE)  AS BANK_NAME    --거래처 은행명
            , uniLITE.fnCipherDecrypt(M4.BANKBOOK_NUM, '')  AS BANKBOOK_NUM --계좌번호
            , M4.BANKBOOK_NAME                                              --예금주
            , B2.CODE_NAME                                  AS BILL_PUBLISH_TYPE  --1:발행 2:미발행
            , '' REMARK
            , (CASE WHEN ISNULL(@INOUT_FR_DATE, '') = ''
                THEN ''
                ELSE REPLACE(REPLACE(REPLACE('YYYY.MM.DD', 'YYYY', SUBSTRING(@INOUT_FR_DATE, 1, 4))
                                                            , 'MM'  , SUBSTRING(@INOUT_FR_DATE, 5, 2))
                                                            , 'DD'  , SUBSTRING(@INOUT_FR_DATE, 7, 2))
                END)                                                AS INOUT_FR_DATE
            , (CASE WHEN ISNULL(@INOUT_TO_DATE, '') = ''
                THEN ''
                ELSE REPLACE(REPLACE(REPLACE('YYYY.MM.DD', 'YYYY', SUBSTRING(@INOUT_TO_DATE, 1, 4))
                                                            , 'MM'  , SUBSTRING(@INOUT_TO_DATE, 5, 2))
                                                            , 'DD'  , SUBSTRING(@INOUT_TO_DATE, 7, 2))
            END)                                                AS INOUT_TO_DATE
            , @PRINT_USER           AS PRINT_USER                   --출력자 이름
            , @VIEW_PRINT_INFO_YN  AS VIEW_PRINT_INFO_YN           --인쇄출력정보 표시여부
            FROM BTR100T S
            LEFT JOIN   BPR200T  M3 WITH (NOLOCK) ON M3.COMP_CODE        = S.COMP_CODE
                                                    AND M3.DIV_CODE         = S.DIV_CODE
                                                    AND M3.ITEM_CODE        = S.ITEM_CODE
            LEFT JOIN   BPR100T  M2 WITH (NOLOCK) ON M2.COMP_CODE        = S.COMP_CODE
                                                    AND M2.ITEM_CODE        = S.ITEM_CODE
            LEFT JOIN   BCM100T  M4 WITH (NOLOCK) ON M4.COMP_CODE        = S.COMP_CODE
                                                    AND M4.CUSTOM_CODE   = S.INOUT_CODE
            LEFT JOIN   BCM100T  M5 WITH (NOLOCK) ON M5.COMP_CODE        = M4.COMP_CODE
                                                    AND M5.CUSTOM_CODE   = M4.BANK_CODE
            LEFT JOIN BSA100T B WITH(NOLOCK) ON B.COMP_CODE = M4.COMP_CODE
                                                AND B.MAIN_CODE = 'B055'
                                                AND B.SUB_CODE = M4.AGENT_TYPE
            LEFT JOIN BSA100T B2 WITH(NOLOCK) ON B2.COMP_CODE = M4.COMP_CODE
                                                AND B2.MAIN_CODE = 'B214'
                                                AND B2.SUB_CODE = M4.BILL_PUBLISH_TYPE
            <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODES)">
            INNER JOIN uniLITE.fnSplit(#{CUSTOM_CODES}, ',') AS F ON F.VALUE = S.INOUT_CODE
            </if>
            WHERE S.COMP_CODE = @COMP_CODE
                AND S.DIV_CODE = @DIV_CODE
                AND S.INOUT_TYPE = '1'
                AND ISNULL(S.ORDER_TYPE,'') != '4'
                AND S.CREATE_LOC = '2'
                AND ((S.INOUT_DATE         &gt;=  @INOUT_FR_DATE        AND @INOUT_FR_DATE       != '') OR (@INOUT_FR_DATE      = ''))
                AND ((S.INOUT_DATE         &lt;=  @INOUT_TO_DATE        AND @INOUT_TO_DATE       != '') OR (@INOUT_TO_DATE      = ''))
                AND ((S.INOUT_CODE       LIKE  @INOUT_CODE + '%'     AND @INOUT_CODE          != '') OR (@INOUT_CODE         = ''))
                AND ((M4.CUSTOM_NAME      LIKE  '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME          != '') OR (@CUSTOM_NAME         = ''))
                AND ((S.INOUT_PRSN          =  @INOUT_PRSN           AND @INOUT_PRSN          != '') OR (@INOUT_PRSN         = ''))
                AND ((S.INOUT_TYPE_DETAIL   =  @INOUT_TYPE_DETAIL    AND @INOUT_TYPE_DETAIL   != '') OR (@INOUT_TYPE_DETAIL  = ''))
                AND ((S.WH_CODE             =  @WH_CODE              AND @WH_CODE             != '') OR (@WH_CODE            = ''))
                AND ((M3.ITEM_ACCOUNT        =  @ITEM_ACCOUNT         AND @ITEM_ACCOUNT        != '') OR (@ITEM_ACCOUNT       = ''))
                AND ((M2.ITEM_LEVEL1         =  @ITEM_LEVEL1          AND @ITEM_LEVEL1         != '') OR (@ITEM_LEVEL1        = ''))
                AND ((M2.ITEM_LEVEL2         =  @ITEM_LEVEL2          AND @ITEM_LEVEL2         != '') OR (@ITEM_LEVEL2        = ''))
                AND ((M2.ITEM_LEVEL3         =  @ITEM_LEVEL3          AND @ITEM_LEVEL3         != '') OR (@ITEM_LEVEL3        = ''))
                AND ((S.ITEM_CODE        LIKE  @ITEM_CODE + '%'      AND @ITEM_CODE           != '') OR (@ITEM_CODE          = ''))
                AND ((S.PROJECT_NO          =  @PROJECT_NO           AND @PROJECT_NO          != '') OR (@PROJECT_NO         = ''))
            GROUP BY S.COMP_CODE, S.DIV_CODE, S.INOUT_CODE, M4.BANK_CODE, M5.CUSTOM_CODE, M4.BANKBOOK_NUM, M4.BANKBOOK_NAME, M4.BILL_PUBLISH_TYPE
                ,B.CODE_NAME, B2.CODE_NAME
			ORDER BY uniLITE.fnCustName(@USER_ID, S.INOUT_CODE)
                    SET NOCOUNT OFF
                SET ARITHABORT OFF
        END
    </select>
</mapper>