<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="s_mpo200ukrv_ypServiceImpl">

	<select id="s_mpo200ukrv_ypServiceImpl.gridUp" parameterType="Map" resultType="rMap">
		--s_mpo200ukrv_yp.Cs_mpo200ukrv_yp[fnMpo200QStd] Query01
        SET NOCOUNT ON

        DECLARE @COMP_CODE      NVARCHAR(08)    -- (필수) 법인코드
              , @USER_ID        NVARCHAR(100)    -- (필수) 사용자ID
              , @DIV_CODE       NVARCHAR(08)    -- (필수) 사업장코드
              , @ORDER_FR_DATE  NVARCHAR(08)    -- (선택) 발주예정일(FROM)
              , @ORDER_TO_DATE  NVARCHAR(08)    -- (선택) 발주예정일(TO)
              , @DOM_FORIGN     NVARCHAR(01)    -- (선택) 국내외구분
              , @SUPPLY_TYPE    NVARCHAR(01)    -- (선택) 조달구분
              , @CUSTOM_CODE    NVARCHAR(08)    -- (선택) 거래처코드
              , @CUSTOM_NAME    NVARCHAR(20)    -- (선택) 거래처명
              , @LOT_NO         NVARCHAR(20)    -- (선택) LOT번호
              , @ORDER_PRSN     NVARCHAR(04)    -- (선택) 구매담당
              , @ORDER_TYPE     NVARCHAR(04)    -- (선택) 판매유형
              , @ITEM_CODE      NVARCHAR(20)    -- (선택) 품목코드
              , @ITEM_NAME      NVARCHAR(200)   -- (선택) 품목명

        DECLARE @MoneyUnit      NVARCHAR(10)    -- 화폐단위
              , @OrderPrsn      NVARCHAR(10)    -- 로그인ID의 구매담당
              , @AgreePrsn      NVARCHAR(10)    -- 로그인ID의 승인자ID

            SET @COMP_CODE      = #{S_COMP_CODE}
            SET @USER_ID        = #{S_USER_ID}
            SET @DIV_CODE       = #{DIV_CODE}
            SET @ORDER_FR_DATE  = #{ORDER_FR_DATE}
            SET @ORDER_TO_DATE  = #{ORDER_TO_DATE}
            SET @DOM_FORIGN     = #{DOM_FORIGN}
            SET @SUPPLY_TYPE    = #{SUPPLY_TYPE}
            SET @CUSTOM_CODE    = #{CUSTOM_CODE}
            SET @CUSTOM_NAME    = #{CUSTOM_NAME}
            SET @LOT_NO         = #{LOT_NO}
            SET @ORDER_PRSN     = #{ORDER_PRSN}
            SET @ORDER_TYPE     = #{ORDER_TYPE}
            SET @ITEM_CODE      = #{ITEM_CODE}
            SET @ITEM_NAME      = #{ITEM_NAME}

        -- 공통코드의 화폐단위 조회
        SELECT TOP 1
               @MoneyUnit = ISNULL(SUB_CODE, '')
          FROM BSA100T WITH (NOLOCK)
         WHERE COMP_CODE  = @COMP_CODE
           AND MAIN_CODE  = N'B004'
           AND (ISNULL(left(REF_CODE1,1),'') = N'Y'
             OR ISNULL(left(REF_CODE1,1),'') = N'y')

        -- 로그인ID의 구매담당자 조회
        SELECT TOP 1
               @OrderPrsn = ISNULL(SUB_CODE, '')
             , @AgreePrsn = ISNULL(REF_CODE1, '')
          FROM BSA100T WITH (NOLOCK)
         WHERE COMP_CODE = @COMP_CODE
           AND MAIN_CODE = N'M201'
           AND SUB_CODE != N'$'
           AND REF_CODE2 = @USER_ID
         ORDER BY SUB_CODE

        -- 구매오더확정 마스터 조회
        SELECT
               CAST(' ' AS BIT)           AS CHK
             , 'N'                        AS CONFIRM_YN
             , A.COMP_CODE                AS COMP_CODE
             , A.DIV_CODE                 AS DIV_CODE
             , CASE A.CUSTOM_CODE
                    WHEN '*' THEN ''
                    ELSE A.CUSTOM_CODE
                END                       AS CUSTOM_CODE
             , uniLITE.fnCustNameComp(@COMP_CODE, @USER_ID, A.CUSTOM_CODE)  AS CUSTOM_NAME
             , uniLITE.fnGetUserDate(@COMP_CODE, A.ORDER_PLAN_DATE)         AS ORDER_DATE
             , uniLITE.fnGetUserDate(@COMP_CODE, A.ORDER_PLAN_DATE)         AS ORDER_PLAN_DATE
             , ''                         AS ORDER_NUM
             , ISNULL(A.SUPPLY_TYPE, '')  AS SUPPLY_TYPE
             , CASE A.SUPPLY_TYPE
                    WHEN '1' THEN '2'
                    WHEN '3' THEN '4'
                END                       AS ORDER_TYPE
             , CASE ISNULL(A.ORDER_PRSN,'')
                    WHEN '' THEN @OrderPrsn
                    ELSE A.ORDER_PRSN
                END                       AS ORDER_PRSN
             , ISNULL(CASE A.ORDER_PRSN
                           WHEN '*' THEN ''
                           ELSE A.ORDER_PRSN
                       END, '')           AS ORDER_PRSN1
             , ISNULL(C.USER_ID, '')      AS AGREE_PRSN
             , ISNULL(C.USER_NAME, '')    AS AGREE_NAME
             , CASE WHEN ISNULL(B.MONEY_UNIT, '') = ''  THEN @MoneyUnit
                    ELSE B.MONEY_UNIT
                END                       AS MONEY_UNIT
             , '1'                        AS EXCHG_RATE_O
             , ''                         AS ORDER_O
             , (SELECT TOP 1 ISNULL(SUB_CODE,'2') FROM BSA100T WHERE MAIN_CODE = 'M008' AND SUB_CODE != '$' AND REF_CODE1 = 'Y')    AS AGREE_STATUS
             , ''                         AS CHECKTYPE
             , ''                         AS CHECKSEQ
             , ''                         AS REMARK
             , C.USER_ID
             , A.ORDER_REQ_PRSN
          FROM            MRP400T A WITH (NOLOCK)
               INNER JOIN BCM100T B WITH (NOLOCK)
                       ON B.COMP_CODE   = A.COMP_CODE
                      AND B.CUSTOM_CODE = A.CUSTOM_CODE
               LEFT  JOIN BSA300T C WITH (NOLOCK)
                       ON C.COMP_CODE   = A.COMP_CODE
                      AND C.DIV_CODE    = A.DIV_CODE
                      AND C.USER_ID     = (SELECT REF_CODE1
                                             FROM BSA100T WITH (NOLOCK)
                                            WHERE COMP_CODE = A.COMP_CODE
                                              AND MAIN_CODE = N'M201'
                                              AND SUB_CODE  = CASE ISNULL(A.ORDER_PRSN,'')
                                                                   WHEN '' THEN @OrderPrsn
                                                                   ELSE A.ORDER_PRSN
                                                               END )
               INNER JOIN BPR200T D WITH (NOLOCK)
                       ON D.COMP_CODE   = A.COMP_CODE
                      AND D.DIV_CODE    = A.DIV_CODE
                      AND D.ITEM_CODE   = A.ITEM_CODE
                      
               LEFT  JOIN SOF100T E WITH(NOLOCK)
                               ON A.COMP_CODE        = E.COMP_CODE
                              AND A.DIV_CODE         = E.DIV_CODE
                              AND A.ORDER_NUM        = E.ORDER_NUM       
               

         WHERE A.ORDER_YN    = N'N'
           AND A.COMP_CODE   = @COMP_CODE
           AND A.DIV_CODE    = @DIV_CODE
           AND (
               (A.ORDER_PLAN_DATE &gt;=       @ORDER_FR_DATE     AND @ORDER_FR_DATE != '') OR (@ORDER_FR_DATE = '')
               )
           AND (
               (A.ORDER_PLAN_DATE &lt;=       @ORDER_TO_DATE     AND @ORDER_TO_DATE != '') OR (@ORDER_TO_DATE = '')
               )
           AND (
               (A.DOM_FORIGN       =       @DOM_FORIGN        AND @DOM_FORIGN    != '') OR (@DOM_FORIGN    = '')
               )
           AND (
               (A.SUPPLY_TYPE      =       @SUPPLY_TYPE       AND @SUPPLY_TYPE   != '') OR (@SUPPLY_TYPE   = '')
               )
           AND (
               (A.CUSTOM_CODE   LIKE       @CUSTOM_CODE + '%' AND @CUSTOM_CODE   != '') OR (@CUSTOM_CODE   = '')
               )
           AND (
               (B.CUSTOM_NAME   LIKE '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME   != '') OR (@CUSTOM_NAME   = '')
               )
           AND (
               (A.LOT_NO        LIKE       @LOT_NO      + '%' AND @LOT_NO        != '') OR (@LOT_NO        = '')
               )
           AND (
               (A.ORDER_PRSN       =       @ORDER_PRSN        AND @ORDER_PRSN    != '') OR (@ORDER_PRSN    = '')
               )
           AND (
               (E.ORDER_TYPE       =       @ORDER_TYPE        AND @ORDER_TYPE    != '') OR (@ORDER_TYPE    = '')
               )
           AND (
               (A.ITEM_CODE     LIKE       @ITEM_CODE   + '%' AND @ITEM_CODE     != '') OR (@ITEM_CODE     = '')
               )
           AND (
               (D.ITEM_NAME     LIKE '%' + @ITEM_NAME   + '%' AND @ITEM_NAME     != '') OR (@ITEM_NAME     = '')
               )

		   AND A.MRP_CONTROL_NUM = ( SELECT MAX(MRP_CONTROL_NUM) FROM MRP400T WHERE COMP_CODE = A.COMP_CODE AND DIV_CODE = A.DIV_CODE )

         GROUP BY A.COMP_CODE, A.DIV_CODE, A.CUSTOM_CODE, B.CUSTOM_NAME, A.SUPPLY_TYPE, A.ORDER_PRSN
                , C.USER_ID, C.USER_NAME, B.MONEY_UNIT, A.ORDER_PLAN_DATE, A.ORDER_REQ_PRSN
         ORDER BY A.CUSTOM_CODE
    </select>

    <select id="s_mpo200ukrv_ypServiceImpl.gridDown" parameterType="Map" resultType="rMap">
        --s_mpo200ukrv_yp.Cs_mpo200ukrv_yp[fnMpo200QStd] Query02
        SET NOCOUNT ON

        DECLARE @COMP_CODE      NVARCHAR(08)    -- (필수) 법인코드
              , @USER_ID        NVARCHAR(100)    -- (필수) 사용자ID
              , @DIV_CODE       NVARCHAR(08)    -- (필수) 사업장코드
              , @ORDER_TO_DATE  NVARCHAR(08)    -- (선택) 발주예정일(TO)
              , @ORDER_PLAN_DATE NVARCHAR(08)    -- (선택) 발주예정일
              , @DOM_FORIGN     NVARCHAR(01)    -- (선택) 국내외구분
              , @SUPPLY_TYPE    NVARCHAR(01)    -- (선택) 조달구분
              , @CUSTOM_CODE    NVARCHAR(08)    -- (선택) 거래처코드
              , @CUSTOM_NAME    NVARCHAR(20)    -- (선택) 거래처명
              , @LOT_NO         NVARCHAR(20)    -- (선택) LOT번호
              , @ORDER_PRSN     NVARCHAR(04)    -- (선택) 구매담당
              , @ITEM_CODE      NVARCHAR(20)    -- (선택) 품목코드
              , @ITEM_NAME      NVARCHAR(200)    -- (선택) 품목명
              , @MONEY_UNIT     NVARCHAR(10)    -- (입력) 화폐단위
              , @ORDER_REQ_PRSN NVARCHAR(40)
        DECLARE @MoneyUnit      NVARCHAR(10)    -- 화폐단위
              , @OrderPrsn      NVARCHAR(10)    -- 로그인ID의 구매담당
              , @AgreePrsn      NVARCHAR(10)    -- 로그인ID의 승인자ID

            SET @COMP_CODE      = #{S_COMP_CODE}
            SET @USER_ID        = #{S_USER_ID}
            SET @DIV_CODE       = ISNULL('${DIV_CODE}', '')
            SET @ORDER_PLAN_DATE  = ISNULL('${ORDER_PLAN_DATE}', '')
            SET @ORDER_TO_DATE  = ISNULL('${ORDER_TO_DATE}', '')
            SET @DOM_FORIGN     = ISNULL('${DOM_FORIGN}', '')
            SET @SUPPLY_TYPE    = ISNULL('${SUPPLY_TYPE}', '')
            SET @CUSTOM_CODE    = ISNULL('${CUSTOM_CODE}', '')
            SET @CUSTOM_NAME    = ISNULL('${CUSTOM_NAME}', '')
            SET @LOT_NO         = ISNULL('${LOT_NO}', '')
            SET @ORDER_PRSN     = ISNULL('${ORDER_PRSN1}', '')
            SET @ITEM_CODE      = ISNULL('${ITEM_CODE}', '')
            SET @ITEM_NAME      = ISNULL('${ITEM_NAME}', '')
            SET @MONEY_UNIT     = ISNULL('${MONEY_UNIT}', '')
            SET @ORDER_REQ_PRSN = ISNULL('${ORDER_REQ_PRSN}', '')

        -- 공통코드의 화폐단위 조회
        SELECT TOP 1
               @MoneyUnit = ISNULL(SUB_CODE, '')
          FROM BSA100T WITH (NOLOCK)
         WHERE COMP_CODE  = @COMP_CODE
           AND MAIN_CODE  = N'B004'
           AND (ISNULL(left(REF_CODE1,1),'') = N'Y'
             OR ISNULL(left(REF_CODE1,1),'') = N'y')

        -- 로그인ID의 구매담당자 조회
        SELECT TOP 1
               @OrderPrsn = ISNULL(SUB_CODE, '')
             , @AgreePrsn = ISNULL(REF_CODE1, '')
          FROM BSA100T WITH (NOLOCK)
         WHERE COMP_CODE = @COMP_CODE
           AND MAIN_CODE = N'M201'
           AND SUB_CODE != N'$'
           AND REF_CODE2 = @USER_ID
         ORDER BY SUB_CODE

        -- 구매오더확정 디테일 조회
        SELECT
               CAST(' ' AS BIT)           AS CHK
             , A.COMP_CODE                AS COMP_CODE
             , A.DIV_CODE                 AS DIV_CODE
             , (CASE A.CUSTOM_CODE
                     WHEN '*' THEN ''
                     ELSE A.CUSTOM_CODE
                 END)                     AS CUSTOM_CODE
             , ''                         AS ORDER_NUM
             --, ''                       AS ORDER_SEQ
             , A.ORDER_NUM                  AS SO_NUM       --수주번호
             , A.ORDER_SEQ                  AS SO_SEQ       --수주순번
             , ROW_NUMBER() OVER(ORDER BY A.ITEM_CODE) AS ORDER_SEQ
             , A.ITEM_CODE
             , B.ITEM_NAME
             , B.SPEC
             , B.STOCK_UNIT
             , (A.ORDER_PLAN_Q / CASE ISNULL(C.ORDER_UNIT, D.ORDER_UNIT)
                                       WHEN B.STOCK_UNIT THEN 1
                                       ELSE 1
                                  END)    AS ORDER_UNIT_Q
             , ISNULL(C.ORDER_UNIT, D.ORDER_UNIT) AS ORDER_UNIT
             , 'Y'                        AS UNIT_PRICE_TYPE
             , (CASE ISNULL(C.ORDER_UNIT, D.ORDER_UNIT)
                     WHEN B.STOCK_UNIT THEN 1
                     ELSE 0
                 END) * (CASE WHEN ISNULL(C.ITEM_P, 0) != 0
                                   THEN C.ITEM_P
                              WHEN ISNULL(H.MONEY_UNIT, @MoneyUnit) = @MoneyUnit
                                   THEN D.PURCHASE_BASE_P
                              ELSE 0
                          END)            AS ORDER_UNIT_P
             , (A.ORDER_PLAN_Q * CASE @MONEY_UNIT
                                      WHEN @MoneyUnit
                                           THEN ISNULL(C.ITEM_P, D.PURCHASE_BASE_P)
                                      ELSE 0
                                  END)    AS ORDER_O
             --, uniLITE.fnGetUserDate(@COMP_CODE, A.BASIS_DATE)      AS DVRY_DATE
             , uniLITE.fnGetUserDate(@COMP_CODE, A.DVRY_DATE)      AS DVRY_DATE
             , D.WH_CODE
             , ISNULL(D.INSPEC_YN, 'N')   AS INSPEC_YN
             , CASE ISNULL(C.ORDER_UNIT, D.ORDER_UNIT)
                    WHEN B.STOCK_UNIT THEN 1
                    ELSE ISNULL(B.TRNS_RATE, 1)
                END                       AS TRNS_RATE
             , A.ORDER_PLAN_Q             AS ORDER_Q
             , ISNULL(H.MONEY_UNIT, @MoneyUnit) AS MONEY_UNIT
             , CASE WHEN ISNULL(C.ITEM_P, 0) != 0
                         THEN C.ITEM_P
                    WHEN ISNULL(H.MONEY_UNIT, @MoneyUnit) = @MoneyUnit
                         THEN D.BASIS_P
                    ELSE 0
                END                       AS ORDER_P
             , '1'                        AS CONTROL_STATUS
             , A.ORDER_REQ_NUM
             , D.PURCH_LDTIME
             , uniLITE.fnGetUserDate(@COMP_CODE, A.BASIS_DATE)      AS BASIS_DATE
             , uniLITE.fnGetUserDate(@COMP_CODE, A.CREATE_DATE)     AS CREATE_DATE
             , uniLITE.fnGetUserDate(@COMP_CODE, A.ORDER_PLAN_DATE) AS ORDER_PLAN_DATE
             , A.SUPPLY_TYPE
             , ''                         AS CHECKSEQ
             , ''                         AS UPDATE_DB_USER
             , ''                         AS UPDATE_DB_TIME
--, CASE WHEN ISNULL(A.ORDER_PRSN,'') = '' THEN @OrderPrsn
--                    ELSE A.ORDER_PRSN
--                END                       AS ORDER_PRSN
             , A.LOT_NO
             , A.REMARK
             , A.PROJECT_NO
          FROM            MRP400T A WITH (NOLOCK)
               LEFT  JOIN BPR100T B WITH (NOLOCK)
                       ON B.COMP_CODE   = A.COMP_CODE
                      AND B.ITEM_CODE   = A.ITEM_CODE
               LEFT  JOIN BPR200T D WITH (NOLOCK)
                       ON D.COMP_CODE   = A.COMP_CODE
                      AND D.DIV_CODE    = A.DIV_CODE
                      AND D.ITEM_CODE   = A.ITEM_CODE
               LEFT  JOIN (SELECT *
                             FROM BPR400T WITH (NOLOCK)
                            WHERE APLY_START_DATE = (SELECT MAX(APLY_START_DATE)
                                                       FROM            BPR400T X WITH (NOLOCK)
                                                            INNER JOIN BCM100T M WITH (NOLOCK)
                                                                    ON X.COMP_CODE   = M.COMP_CODE
                                                                   AND X.CUSTOM_CODE = M.CUSTOM_CODE
                                                                   AND X.MONEY_UNIT  = ISNULL(M.MONEY_UNIT, @MoneyUnit)
                                                      WHERE X.TYPE = N'1'
                                                        AND X.COMP_CODE        = @COMP_CODE
                                                        AND X.DIV_CODE         = @DIV_CODE
                                                     -- AND X.ITEM_CODE        = @ITEM_CODE
                                                        AND X.CUSTOM_CODE      = @CUSTOM_CODE
                                                        AND X.APLY_START_DATE &lt;= @ORDER_TO_DATE)) C
                       ON C.DIV_CODE    = A.DIV_CODE
                      AND C.ITEM_CODE   = A.ITEM_CODE
                      AND C.CUSTOM_CODE = A.CUSTOM_CODE
                      AND C.TYPE        = N'1'
                      AND C.ORDER_UNIT  = D.ORDER_UNIT
               INNER JOIN BCM100T H WITH (NOLOCK)
                       ON H.COMP_CODE   = A.COMP_CODE
                      AND H.CUSTOM_CODE = A.CUSTOM_CODE
 --              LEFT  JOIN BSA300T I WITH (NOLOCK)
 --                      ON I.COMP_CODE   = A.COMP_CODE
 --                     AND I.DIV_CODE    = A.DIV_CODE
 --                     AND I.USER_ID     = (SELECT REF_CODE1
 --                                            FROM BSA100T WITH (NOLOCK)
 --                                           WHERE COMP_CODE = A.COMP_CODE
 --                                             AND MAIN_CODE = N'M201'
 --                                             AND SUB_CODE  = CASE ISNULL(A.ORDER_PRSN,'')
 --                                                                  WHEN '' THEN @OrderPrsn
 --                                                                  ELSE A.ORDER_PRSN
 --                                                              END )
         WHERE A.ORDER_YN    = N'N'
           AND A.CUSTOM_CODE &gt; ''
           AND A.COMP_CODE   = @COMP_CODE
           AND A.DIV_CODE    = @DIV_CODE
           AND A.ORDER_PRSN  = @ORDER_PRSN
           AND (
               (A.CUSTOM_CODE   LIKE       @CUSTOM_CODE + '%' AND @CUSTOM_CODE   != '') OR (@CUSTOM_CODE   = '')
               )
           AND (
               (H.CUSTOM_NAME   LIKE '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME   != '') OR (@CUSTOM_NAME   = '')
               )
           AND (
               (A.SUPPLY_TYPE      =       @SUPPLY_TYPE       AND @SUPPLY_TYPE   != '') OR (@SUPPLY_TYPE   = '')
               )
--           AND (
--               (A.ORDER_PRSN       =       @ORDER_PRSN        AND @ORDER_PRSN    != '') OR (@ORDER_PRSN    = '')
--               )
--           AND (
--               (I.USER_ID       =       @USER_ID        AND @USER_ID    != '') OR (@USER_ID    = '')
--               )
           AND (
                CASE WHEN ISNULL(H.MONEY_UNIT, '') = ''THEN @MoneyUnit
                     ELSE H.MONEY_UNIT
                END =   @MONEY_UNIT
               )
           AND (
               (A.ORDER_PLAN_DATE =       @ORDER_PLAN_DATE     AND @ORDER_PLAN_DATE != '') OR (@ORDER_PLAN_DATE = '')
               )
           AND (
               (A.ORDER_REQ_PRSN =       @ORDER_REQ_PRSN     AND @ORDER_REQ_PRSN != '') OR (@ORDER_REQ_PRSN = '')
               )
 		   AND A.MRP_CONTROL_NUM = ( SELECT MAX(MRP_CONTROL_NUM) FROM MRP400T WHERE COMP_CODE = A.COMP_CODE AND DIV_CODE = A.DIV_CODE )

         ORDER BY A.ITEM_CODE
    </select>

    <select id="s_mpo200ukrv_ypServiceImpl.selectAdjustList1" parameterType="Map" resultType="rMap">
    	--s_mpo200ukrv_yp.Cs_mpo200ukrv_yp[fnMpo201QStd] Query01
        DECLARE @COMP_CODE      NVARCHAR(08)    -- (필수) 법인코드
              , @USER_ID        NVARCHAR(100)    -- (필수) 사용자ID
              , @DIV_CODE       NVARCHAR(08)    -- (필수) 사업장코드
              , @ORDER_FR_DATE  NVARCHAR(08)    -- (선택) 발주예정일(FROM)
              , @ORDER_TO_DATE  NVARCHAR(08)    -- (선택) 발주예정일(TO)
              , @DOM_FORIGN     NVARCHAR(01)    -- (선택) 국내외구분
              , @SUPPLY_TYPE    NVARCHAR(01)    -- (선택) 조달구분
              , @CUSTOM_CODE    NVARCHAR(08)    -- (선택) 거래처코드
              , @CUSTOM_NAME    NVARCHAR(20)    -- (선택) 거래처명
              , @LOT_NO         NVARCHAR(20)    -- (선택) LOT번호
              , @ORDER_PRSN     NVARCHAR(04)    -- (선택) 구매담당
              , @ITEM_CODE      NVARCHAR(20)    -- (선택) 품목코드
              , @ITEM_NAME      NVARCHAR(200)    -- (선택) 품목명

            SET @COMP_CODE      = #{S_COMP_CODE}
            SET @USER_ID        = #{S_USER_ID}
            SET @DIV_CODE       = #{DIV_CODE}
            SET @ORDER_FR_DATE  = #{ORDER_FR_DATE}
            SET @ORDER_TO_DATE  = #{ORDER_TO_DATE}
            SET @DOM_FORIGN     = #{DOM_FORIGN}
            SET @SUPPLY_TYPE    = #{SUPPLY_TYPE}
            SET @CUSTOM_CODE    = #{CUSTOM_CODE}
            SET @CUSTOM_NAME    = #{CUSTOM_NAME}
            SET @LOT_NO         = #{LOT_NO}
            SET @ORDER_PRSN     = #{ORDER_PRSN}
            SET @ITEM_CODE      = #{ITEM_CODE}
            SET @ITEM_NAME      = #{ITEM_NAME}

        SELECT TOP 100
               A.COMP_CODE          AS COMP_CODE
             , A.DIV_CODE           AS DIV_CODE
             , A.ORDER_PLAN_DATE    AS ORDER_PLAN_DATE
             , A.ITEM_CODE          AS ITEM_CODE
         FROM             MRP400T A WITH(NOLOCK)
               INNER JOIN BPR200T B WITH(NOLOCK)
                       ON B.COMP_CODE        = A.COMP_CODE
                      AND B.DIV_CODE         = A.DIV_CODE
                      AND B.ITEM_CODE        = A.ITEM_CODE
               INNER JOIN BPR100T C WITH(NOLOCK)
                       ON C.COMP_CODE        = A.COMP_CODE
                      AND C.ITEM_CODE        = A.ITEM_CODE
               LEFT  JOIN BCM100T D WITH(NOLOCK)
                       ON D.COMP_CODE        = A.COMP_CODE
                      AND D.CUSTOM_CODE      = A.CUSTOM_CODE
         WHERE A.ORDER_YN     = N'N'
           AND A.SUPPLY_TYPE != N'2'
           AND A.COMP_CODE    =  @COMP_CODE
           AND A.DIV_CODE     =  @DIV_CODE
           AND (
               (A.ORDER_PLAN_DATE &gt;=       @ORDER_FR_DATE     AND @ORDER_FR_DATE != '') OR (@ORDER_FR_DATE = '')
               )
           AND (
               (A.ORDER_PLAN_DATE &lt;=       @ORDER_TO_DATE     AND @ORDER_TO_DATE != '') OR (@ORDER_TO_DATE = '')
               )
           AND (
               (A.DOM_FORIGN       =       @DOM_FORIGN        AND @DOM_FORIGN    != '') OR (@DOM_FORIGN    = '')
               )
           AND (
               (A.SUPPLY_TYPE      =       @SUPPLY_TYPE       AND @SUPPLY_TYPE   != '') OR (@SUPPLY_TYPE   = '')
               )
           AND (
               (A.CUSTOM_CODE   LIKE       @CUSTOM_CODE + '%' AND @CUSTOM_CODE   != '') OR (@CUSTOM_CODE   = '')
               )
           AND (
               (D.CUSTOM_NAME   LIKE '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME   != '') OR (@CUSTOM_NAME   = '')
               )
           AND (
               (A.LOT_NO        LIKE       @LOT_NO      + '%' AND @LOT_NO        != '') OR (@LOT_NO        = '')
               )
           AND (
               (A.ORDER_PRSN       =       @ORDER_PRSN        AND @ORDER_PRSN    != '') OR (@ORDER_PRSN    = '')
               )
           AND (
               (A.ITEM_CODE     LIKE       @ITEM_CODE   + '%' AND @ITEM_CODE     != '') OR (@ITEM_CODE     = '')
               )
           AND (
               (C.ITEM_NAME     LIKE '%' + @ITEM_NAME   + '%' AND @ITEM_NAME     != '') OR (@ITEM_NAME     = '')
               )
         GROUP BY A.COMP_CODE, A.DIV_CODE, A.ORDER_PLAN_DATE, A.ITEM_CODE
    </select>
    <select id="s_mpo200ukrv_ypServiceImpl.selectAdjustList2" parameterType="Map" resultType="rMap">
    	--s_mpo200ukrv_yp.Cs_mpo200ukrv_yp[fnMpo201QStd] Query02
        SET NOCOUNT ON
        --  조회조건
        DECLARE @COMP_CODE      NVARCHAR(08)    -- (필수) 법인코드
              , @USER_ID        NVARCHAR(100)    -- (필수) 사용자ID
              , @DIV_CODE       NVARCHAR(08)    -- (필수) 사업장코드
              , @ORDER_FR_DATE  NVARCHAR(08)    -- (선택) 발주예정일(FROM)
              , @ORDER_TO_DATE  NVARCHAR(08)    -- (선택) 발주예정일(TO)
              , @DOM_FORIGN     NVARCHAR(01)    -- (선택) 국내외구분
              , @SUPPLY_TYPE    NVARCHAR(01)    -- (선택) 조달구분
              , @CUSTOM_CODE    NVARCHAR(08)    -- (선택) 거래처코드
              , @CUSTOM_NAME    NVARCHAR(20)    -- (선택) 거래처명
              , @LOT_NO         NVARCHAR(20)    -- (선택) LOT번호
              , @ORDER_PRSN     NVARCHAR(04)    -- (선택) 구매담당
              , @ORDER_TYPE     NVARCHAR(04)    -- (선택) 판매유형
              , @ITEM_CODE      NVARCHAR(20)    -- (선택) 품목코드
              , @ITEM_NAME      NVARCHAR(200)    -- (선택) 품목명

        --  가용재고함수인자
              , @BASE_DATE1     VARCHAR(8000)   -- (인자) 기준일자
              , @FROM_ITEM      VARCHAR(8000)   -- (인자) 품목코드(FROM)
              , @TO_ITEM        NVARCHAR(20)    -- (인자) 품목코드(TO)
              , @QRY_TYPE       NVARCHAR(01)    -- (인자) 조회타입

        --  대체품목함수인자
              , @BASE_DATE2     NVARCHAR(08)    -- (인자) 기준일자

            SET @COMP_CODE      = #{S_COMP_CODE}
            SET @USER_ID        = #{S_USER_ID}
            SET @DIV_CODE       = #{DIV_CODE}
            SET @ORDER_FR_DATE  = #{ORDER_FR_DATE}
            SET @ORDER_TO_DATE  = #{ORDER_TO_DATE}
            SET @DOM_FORIGN     = #{DOM_FORIGN}
            SET @SUPPLY_TYPE    = #{SUPPLY_TYPE}
            SET @CUSTOM_CODE    = #{CUSTOM_CODE}
            SET @CUSTOM_NAME    = #{CUSTOM_NAME}
            SET @LOT_NO         = #{LOT_NO}
            SET @ORDER_PRSN     = #{ORDER_PRSN}
            SET @ORDER_TYPE     = #{ORDER_TYPE}
            SET @ITEM_CODE      = #{ITEM_CODE}
            SET @ITEM_NAME      = #{ITEM_NAME}

            SET @BASE_DATE1     = #{BASE_DATE}
            SET @FROM_ITEM      = #{FROM_ITEM}
            SET @TO_ITEM        = N''
            SET @QRY_TYPE       = N'5'

            SET @BASE_DATE2     = CONVERT(NVARCHAR(08), GETDATE(), 112)

        -----------------------------------------------------------------------------------------------------------------------

            DECLARE @EXChgYN            NVARCHAR(01)

            SELECT TOP 1 @EXChgYN = SUB_CODE
            FROM   BSA100T WITH (NOLOCK)
            WHERE  COMP_CODE = @COMP_CODE
            AND    MAIN_CODE = 'B081'
            AND    REF_CODE1 = 'Y'

            SET @EXChgYN = ISNULL(@EXChgYN, 'N')

        -----------------------------------------------------------------------------------------------------------------------

            IF @EXChgYN = 'Y'
                SELECT
                       A.COMP_CODE                                                  AS COMP_CODE
                     , A.DIV_CODE                                                   AS DIV_CODE
                     , uniLITE.fnGetUserDate(A.COMP_CODE, A.ORDER_PLAN_DATE)        AS ORDER_PLAN_DATE
                     , (CASE A.CUSTOM_CODE WHEN '*' THEN '' ELSE A.CUSTOM_CODE END) AS CUSTOM_CODE
                     , uniLITE.fnCustNameComp(D.COMP_CODE, @USER_ID, D.CUSTOM_CODE) AS CUSTOM_NAME
                     , ISNULL(F.PROD_ITEM_CODE, '')                                 AS PROD_ITEM_CODE
                     , ISNULL(A.ITEM_CODE, '')                                      AS ITEM_CODE
                     , uniLITE.fnItemNameComp(C.COMP_CODE, @USER_ID, C.ITEM_CODE)   AS ITEM_NAME
                     , ISNULL(C.SPEC, '')                                           AS SPEC
                     , ISNULL(A.ORDER_PLAN_Q, 0)                                    AS ORDER_PLAN_Q
                     , ISNULL(C.STOCK_UNIT, '')                                     AS STOCK_UNIT
                     , uniLITE.fnGetUserDate(A.COMP_CODE, A.BASIS_DATE)             AS BASIS_DATE
                     , ISNULL(A.REQ_PLAN_Q, 0)                                      AS REQ_PLAN_Q
                     , (CASE A.SUPPLY_TYPE WHEN '*' THEN '' ELSE A.SUPPLY_TYPE END) AS SUPPLY_TYPE
                     , ISNULL(H.PAB_STOCK_Q,0)                                      AS PAB_STOCK_Q
                     , (CASE WHEN ISNULL(G.EXCHG_CNT,0) = 0 THEN 'N' ELSE 'Y' END)  AS EXCHG_EXIST_YN
                     , ISNULL(A.REF_ITEM_CODE, '')                                  AS REF_ITEM_CODE
                     , uniLITE.fnItemNameComp(E.COMP_CODE, @USER_ID, E.ITEM_CODE)   AS REF_ITEM_NAME
                     , ISNULL(A.EXCHG_YN, '')                                       AS EXCHG_YN
                     , ISNULL(A.DOM_FORIGN, '')                                     AS DOM_FORIGN
                     , (CASE WHEN A.ORDER_REQ_DEPT_CODE = '*' THEN ''
                             ELSE A.ORDER_REQ_DEPT_CODE             END)            AS ORDER_REQ_DEPT_CODE
                     , (CASE WHEN A.ORDER_PRSN IS NULL THEN CASE B.ORDER_PRSN WHEN '*' THEN '' ELSE B.ORDER_PRSN END
                                          ELSE A.ORDER_PRSN END)                    AS ORDER_PRSN
                     , ISNULL(A.ORDER_YN, '')                                       AS ORDER_YN
                     , ISNULL(F.ORDER_NUM, '')                                      AS ORDER_NUM
                     , F.ORDER_SEQ                                                  AS ORDER_SEQ
                     , ISNULL(A.ORDER_REQ_NUM, '')                                  AS ORDER_REQ_NUM
                     , (CASE WHEN A.MRP_CONTROL_NUM = '*' THEN ''
                             ELSE A.MRP_CONTROL_NUM                 END)            AS MRP_CONTROL_NUM
                     , ISNULL(A.WKORD_NUM, '')                                      AS WKORD_NUM
                     , ISNULL(B.ITEM_ACCOUNT, '')                                   AS ITEM_ACCOUNT
                     , ISNULL(B.PURCH_LDTIME, 0)                                    AS PURCH_LDTIME
                     , ISNULL(A.CREATE_DATE, '')                                    AS CREATE_DATE
                     , ISNULL(A.MRP_YN, '')                                         AS MRP_YN
                     , ISNULL(A.LOT_NO, '')                                         AS LOT_NO
                     , ISNULL(A.REMARK, '')                                         AS REMARK
                     , ISNULL(A.PROJECT_NO, '')                                     AS PROJECT_NO
                     --, uniLITE.fnGetUserDate(@COMP_CODE, A.BASIS_DATE)              AS DVRY_DATE
                     , uniLITE.fnGetUserDate(@COMP_CODE, A.DVRY_DATE)              AS DVRY_DATE
                     , I.CUSTOM_CODE
                     , J.DVRY_DATE                                                  AS ORDER_DVRY_DATE
                     , K.CUSTOM_NAME
                     , J.PROD_END_DATE												AS PROD_END_DATE
                     , J.EXP_ISSUE_DATE
                  FROM            MRP400T A WITH(NOLOCK)
                       INNER JOIN BPR200T B WITH(NOLOCK)
                               ON B.COMP_CODE        = A.COMP_CODE
                              AND B.DIV_CODE         = A.DIV_CODE
                              AND B.ITEM_CODE        = A.ITEM_CODE
                       INNER JOIN BPR100T C WITH(NOLOCK)
                               ON C.COMP_CODE        = A.COMP_CODE
                              AND C.ITEM_CODE        = A.ITEM_CODE
                       LEFT  JOIN BCM100T D WITH(NOLOCK)
                               ON D.COMP_CODE        = A.COMP_CODE
                              AND D.CUSTOM_CODE      = A.CUSTOM_CODE
                       LEFT  JOIN BPR200T E WITH(NOLOCK)
                               ON E.COMP_CODE        = A.COMP_CODE
                              AND E.ITEM_CODE        = A.REF_ITEM_CODE
                       LEFT  JOIN MRP350T F WITH(NOLOCK)
                               ON A.COMP_CODE        = F.COMP_CODE
                              AND A.DIV_CODE         = F.DIV_CODE
                              AND A.ORDER_REQ_NUM    = CONVERT(NVARCHAR, F.ITEM_CHECK)
                       LEFT  JOIN SOF100T I WITH(NOLOCK)
                               ON F.COMP_CODE        = I.COMP_CODE
                              AND F.DIV_CODE         = I.DIV_CODE
                              AND F.ORDER_NUM        = I.ORDER_NUM
                       LEFT  JOIN SOF110T J WITH(NOLOCK)
                               ON F.COMP_CODE        = J.COMP_CODE
                              AND F.DIV_CODE         = J.DIV_CODE
                              AND F.ORDER_NUM        = J.ORDER_NUM
                              AND F.ORDER_SEQ        = J.SER_NO
                       LEFT  JOIN BCM100T K WITH(NOLOCK)
                               ON I.COMP_CODE        = K.COMP_CODE
                              AND I.CUSTOM_CODE      = K.CUSTOM_CODE
                       LEFT  JOIN (SELECT COMP_CODE,         DIV_CODE,           PROD_ITEM_CODE
                                        , CHILD_ITEM_CODE,   COUNT(EXCHG_ITEM_CODE) AS EXCHG_CNT
                                   FROM   uniLITE.fnValidEXCHG(@COMP_CODE, @DIV_CODE, @BASE_DATE2)
                                   GROUP BY COMP_CODE, DIV_CODE, PROD_ITEM_CODE, CHILD_ITEM_CODE) G
                               ON F.COMP_CODE        = G.COMP_CODE
                              AND F.DIV_CODE         = G.DIV_CODE
                              AND F.PROD_ITEM_CODE   = G.PROD_ITEM_CODE
                              AND F.ITEM_CODE        = G.CHILD_ITEM_CODE
                       LEFT  JOIN uniLITE.fnGetPABStock(@COMP_CODE, @DIV_CODE, @BASE_DATE1, @FROM_ITEM, @TO_ITEM, @QRY_TYPE) H
                               ON A.COMP_CODE        = H.COMP_CODE
                              AND A.DIV_CODE         = H.DIV_CODE
                              AND A.ITEM_CODE        = H.ITEM_CODE
                              AND A.ORDER_PLAN_DATE  = H.BASE_DATE
                 WHERE A.ORDER_YN     = 'N'
                   AND A.SUPPLY_TYPE != '2'
                   AND A.COMP_CODE    =  @COMP_CODE
                   AND A.DIV_CODE     =  @DIV_CODE
                   AND (
                       (A.ORDER_PLAN_DATE &gt;=       @ORDER_FR_DATE     AND @ORDER_FR_DATE != '') OR (@ORDER_FR_DATE = '')
                       )
                   AND (
                       (A.ORDER_PLAN_DATE &lt;=       @ORDER_TO_DATE     AND @ORDER_TO_DATE != '') OR (@ORDER_TO_DATE = '')
                       )
                   AND (
                       (A.DOM_FORIGN       =       @DOM_FORIGN        AND @DOM_FORIGN    != '') OR (@DOM_FORIGN    = '')
                       )
                   AND (
                       (A.SUPPLY_TYPE      =       @SUPPLY_TYPE       AND @SUPPLY_TYPE   != '') OR (@SUPPLY_TYPE   = '')
                       )
                   AND (
                       (A.CUSTOM_CODE   LIKE       @CUSTOM_CODE + '%' AND @CUSTOM_CODE   != '') OR (@CUSTOM_CODE   = '')
                       )
                   AND (
                       (D.CUSTOM_NAME   LIKE '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME   != '') OR (@CUSTOM_NAME   = '')
                       )
                   AND (
                       (A.LOT_NO        LIKE       @LOT_NO      + '%' AND @LOT_NO        != '') OR (@LOT_NO        = '')
                       )
                   AND (
                       (A.ORDER_PRSN       =       @ORDER_PRSN        AND @ORDER_PRSN    != '') OR (@ORDER_PRSN    = '')
                       )
                   AND (
                       (I.ORDER_TYPE       =       @ORDER_TYPE        AND @ORDER_TYPE    != '') OR (@ORDER_TYPE    = '')
                       )    
                   AND (
                       (A.ITEM_CODE     LIKE       @ITEM_CODE   + '%' AND @ITEM_CODE     != '') OR (@ITEM_CODE     = '')
                       )
                   AND (
                       (C.ITEM_NAME     LIKE '%' + @ITEM_NAME   + '%' AND @ITEM_NAME     != '') OR (@ITEM_NAME     = '')
                       )
                 ORDER BY A.ORDER_PLAN_DATE, A.CUSTOM_CODE, A.ITEM_CODE
            ELSE
                SELECT
                       A.COMP_CODE                                                  AS COMP_CODE
                     , A.DIV_CODE                                                   AS DIV_CODE
                     , uniLITE.fnGetUserDate(A.COMP_CODE, A.ORDER_PLAN_DATE)        AS ORDER_PLAN_DATE
                     , (CASE A.CUSTOM_CODE WHEN '*' THEN '' ELSE A.CUSTOM_CODE END) AS CUSTOM_CODE
                     , uniLITE.fnCustNameComp(D.COMP_CODE, @USER_ID, D.CUSTOM_CODE) AS CUSTOM_NAME
                     , ISNULL(F.PROD_ITEM_CODE, '')                                 AS PROD_ITEM_CODE
                     , ISNULL(A.ITEM_CODE, '')                                      AS ITEM_CODE
                     , uniLITE.fnItemNameComp(C.COMP_CODE, @USER_ID, C.ITEM_CODE)   AS ITEM_NAME
                     , ISNULL(C.SPEC, '')                                           AS SPEC
                     , ISNULL(A.ORDER_PLAN_Q, 0)                                    AS ORDER_PLAN_Q
                     , ISNULL(C.STOCK_UNIT, '')                                     AS STOCK_UNIT
                     , uniLITE.fnGetUserDate(A.COMP_CODE, A.BASIS_DATE)             AS BASIS_DATE
                     , ISNULL(A.REQ_PLAN_Q, 0)                                      AS REQ_PLAN_Q
                     , (CASE A.SUPPLY_TYPE WHEN '*' THEN '' ELSE A.SUPPLY_TYPE END) AS SUPPLY_TYPE
                     , 0                                                            AS PAB_STOCK_Q
                     , (CASE WHEN ISNULL(G.EXCHG_CNT,0) = 0 THEN 'N' ELSE 'Y' END)  AS EXCHG_EXIST_YN
                     , ISNULL(A.REF_ITEM_CODE, '')                                  AS REF_ITEM_CODE
                     , uniLITE.fnItemNameComp(E.COMP_CODE, @USER_ID, E.ITEM_CODE)   AS REF_ITEM_NAME
                     , ISNULL(A.EXCHG_YN, '')                                       AS EXCHG_YN
                     , ISNULL(A.DOM_FORIGN, '')                                     AS DOM_FORIGN
                     , (CASE WHEN A.ORDER_REQ_DEPT_CODE = '*' THEN ''
                             ELSE A.ORDER_REQ_DEPT_CODE             END)            AS ORDER_REQ_DEPT_CODE
                     , (CASE WHEN A.ORDER_PRSN IS NULL THEN CASE B.ORDER_PRSN WHEN '*' THEN '' ELSE B.ORDER_PRSN END
                                          ELSE A.ORDER_PRSN END)                    AS ORDER_PRSN
                     , ISNULL(A.ORDER_YN, '')                                       AS ORDER_YN
                     --, ISNULL(F.ORDER_NUM, '')                                      AS ORDER_NUM
                     --, F.ORDER_SEQ                                                  AS ORDER_SEQ
                     , ISNULL(A.ORDER_NUM, '')                                      AS ORDER_NUM
                     , A.ORDER_SEQ                                                  AS ORDER_SEQ
                     , ISNULL(A.ORDER_REQ_NUM, '')                                  AS ORDER_REQ_NUM
                     , (CASE WHEN A.MRP_CONTROL_NUM = '*' THEN ''
                             ELSE A.MRP_CONTROL_NUM                 END)            AS MRP_CONTROL_NUM
                     , ISNULL(A.WKORD_NUM, '')                                      AS WKORD_NUM
                     , ISNULL(B.ITEM_ACCOUNT, '')                                   AS ITEM_ACCOUNT
                     , ISNULL(B.PURCH_LDTIME, 0)                                    AS PURCH_LDTIME
                     , ISNULL(A.CREATE_DATE, '')                                    AS CREATE_DATE
                     , ISNULL(A.MRP_YN, '')                                         AS MRP_YN
                     , ISNULL(A.LOT_NO, '')                                         AS LOT_NO
                     , ISNULL(A.REMARK, '')                                         AS REMARK
                     , ISNULL(A.PROJECT_NO, '')                                     AS PROJECT_NO
                     --, uniLITE.fnGetUserDate(@COMP_CODE, A.BASIS_DATE)            AS DVRY_DATE
                     , uniLITE.fnGetUserDate(@COMP_CODE, A.DVRY_DATE)               AS DVRY_DATE
                     , I.CUSTOM_CODE
                     , J.DVRY_DATE                                                  AS ORDER_DVRY_DATE
                     , K.CUSTOM_NAME                                                AS ORDER_CUSTOM_NAME
                     , J.PROD_END_DATE												AS PROD_END_DATE
                     , J.EXP_ISSUE_DATE
                  FROM            MRP400T A WITH(NOLOCK)
                       INNER JOIN BPR200T B WITH(NOLOCK)
                               ON B.COMP_CODE        = A.COMP_CODE
                              AND B.DIV_CODE         = A.DIV_CODE
                              AND B.ITEM_CODE        = A.ITEM_CODE
                       INNER JOIN BPR100T C WITH(NOLOCK)
                               ON C.COMP_CODE        = A.COMP_CODE
                              AND C.ITEM_CODE        = A.ITEM_CODE
                       LEFT  JOIN BCM100T D WITH(NOLOCK)
                               ON D.COMP_CODE        = A.COMP_CODE
                              AND D.CUSTOM_CODE      = A.CUSTOM_CODE
                       LEFT  JOIN BPR200T E WITH(NOLOCK)
                               ON E.COMP_CODE        = A.COMP_CODE
                              AND E.ITEM_CODE        = A.REF_ITEM_CODE
                       LEFT  JOIN MRP350T F WITH(NOLOCK)
                               ON A.COMP_CODE        = F.COMP_CODE
                              AND A.DIV_CODE         = F.DIV_CODE
                              AND A.ORDER_REQ_NUM    = CONVERT(NVARCHAR, F.ITEM_CHECK)
                       LEFT  JOIN (SELECT COMP_CODE,         DIV_CODE,           PROD_ITEM_CODE
                                        , CHILD_ITEM_CODE,   COUNT(EXCHG_ITEM_CODE) AS EXCHG_CNT
                                   FROM   uniLITE.fnValidEXCHG(@COMP_CODE, @DIV_CODE, @BASE_DATE2)
                                   GROUP BY COMP_CODE, DIV_CODE, PROD_ITEM_CODE, CHILD_ITEM_CODE) G
                               ON F.COMP_CODE        = G.COMP_CODE
                              AND F.DIV_CODE         = G.DIV_CODE
                              AND F.PROD_ITEM_CODE   = G.PROD_ITEM_CODE
                              AND F.ITEM_CODE        = G.CHILD_ITEM_CODE
                       LEFT  JOIN SOF100T I WITH(NOLOCK)
                               ON A.COMP_CODE        = I.COMP_CODE
                              AND A.DIV_CODE         = I.DIV_CODE
                              AND A.ORDER_NUM        = I.ORDER_NUM
                       LEFT  JOIN SOF110T J WITH(NOLOCK)
                               ON A.COMP_CODE        = J.COMP_CODE
                              AND A.DIV_CODE         = J.DIV_CODE
                              AND A.ORDER_NUM        = J.ORDER_NUM
                              AND A.ORDER_SEQ        = J.SER_NO
                       LEFT  JOIN BCM100T K WITH(NOLOCK)
                               ON I.COMP_CODE        = K.COMP_CODE
                              AND I.CUSTOM_CODE      = K.CUSTOM_CODE
                 WHERE A.ORDER_YN     = 'N'
                   AND A.SUPPLY_TYPE != '2'
                   AND A.COMP_CODE    =  @COMP_CODE
                   AND A.DIV_CODE     =  @DIV_CODE
                   AND (
                       (A.ORDER_PLAN_DATE &gt;=       @ORDER_FR_DATE     AND @ORDER_FR_DATE != '') OR (@ORDER_FR_DATE = '')
                       )
                   AND (
                       (A.ORDER_PLAN_DATE &lt;=       @ORDER_TO_DATE     AND @ORDER_TO_DATE != '') OR (@ORDER_TO_DATE = '')
                       )
                   AND (
                       (A.DOM_FORIGN       =       @DOM_FORIGN        AND @DOM_FORIGN    != '') OR (@DOM_FORIGN    = '')
                       )
                   AND (
                       (A.SUPPLY_TYPE      =       @SUPPLY_TYPE       AND @SUPPLY_TYPE   != '') OR (@SUPPLY_TYPE   = '')
                       )
                   AND (
                       (A.CUSTOM_CODE   LIKE       @CUSTOM_CODE + '%' AND @CUSTOM_CODE   != '') OR (@CUSTOM_CODE   = '')
                       )
                   AND (
                       (D.CUSTOM_NAME   LIKE '%' + @CUSTOM_NAME + '%' AND @CUSTOM_NAME   != '') OR (@CUSTOM_NAME   = '')
                       )
                   AND (
                       (A.LOT_NO        LIKE       @LOT_NO      + '%' AND @LOT_NO        != '') OR (@LOT_NO        = '')
                       )
                   AND (
                       (A.ORDER_PRSN       =       @ORDER_PRSN        AND @ORDER_PRSN    != '') OR (@ORDER_PRSN    = '')
                       )
                   AND (
                       (I.ORDER_TYPE       =       @ORDER_TYPE        AND @ORDER_TYPE    != '') OR (@ORDER_TYPE    = '')
                       )    
                   AND (
                       (A.ITEM_CODE     LIKE       @ITEM_CODE   + '%' AND @ITEM_CODE     != '') OR (@ITEM_CODE     = '')
                       )
                   AND (
                       (C.ITEM_NAME     LIKE '%' + @ITEM_NAME   + '%' AND @ITEM_NAME     != '') OR (@ITEM_NAME     = '')
                       )
                   AND A.MRP_CONTROL_NUM = (SELECT MAX(MRP_CONTROL_NUM) FROM MRP400T
											WHERE COMP_CODE = A.COMP_CODE AND DIV_CODE = A.DIV_CODE )

                 ORDER BY A.ORDER_PLAN_DATE, A.CUSTOM_CODE, A.ITEM_CODE
    </select>
    <update id="s_mpo200ukrv_ypServiceImpl.updateAdjust" parameterType="Map">     /* 수정 */
        --s_mpo200ukrv_yp.Cs_mpo200ukrv_yp[fnMpo201Save] Query05
        UPDATE MRP400T
           SET COMP_CODE           = #{S_COMP_CODE}
             , DIV_CODE            = #{DIV_CODE}
             , ORDER_PLAN_DATE     = #{ORDER_PLAN_DATE}
             , CUSTOM_CODE         = #{CUSTOM_CODE}
             , CUSTOM_NAME         = #{CUSTOM_NAME}
             , ITEM_CODE           = #{ITEM_CODE}
             , ORDER_PLAN_Q        = #{ORDER_PLAN_Q}
             , BASIS_DATE          = #{BASIS_DATE}
             , REQ_PLAN_Q          = #{REQ_PLAN_Q}
             , SUPPLY_TYPE         = #{SUPPLY_TYPE}
             , REF_ITEM_CODE       = #{REF_ITEM_CODE}
             , EXCHG_YN            = #{EXCHG_YN}
             , DOM_FORIGN          = #{DOM_FORIGN}
             , ORDER_REQ_DEPT_CODE = #{ORDER_REQ_DEPT_CODE}
             , ORDER_PRSN          = #{ORDER_PRSN}
             , ORDER_YN            = #{ORDER_YN}
             , MRP_CONTROL_NUM     = #{MRP_CONTROL_NUM}
             , WKORD_NUM           = #{WKORD_NUM}
             , CREATE_DATE         = #{CREATE_DATE}
             , MRP_YN              = #{MRP_YN}
             , LOT_NO              = #{LOT_NO}
             , REMARK              = #{REMARK}
             , PROJECT_NO          = #{PROJECT_NO}
             , UPDATE_DB_USER      = #{S_USER_ID}
             , UPDATE_DB_TIME      = GETDATE()
         WHERE COMP_CODE           = #{COMP_CODE}
           AND DIV_CODE            = #{DIV_CODE}
           AND ORDER_REQ_NUM       = #{ORDER_REQ_NUM}
    </update>

    <update id="s_mpo200ukrv_ypServiceImpl.insertLogMaster" parameterType="Map">
    	INSERT INTO L_MPO100T(
    	   KEY_VALUE,
    	   OPR_FLAG,
    	   COMP_CODE,
    	   DIV_CODE,
    	   CUSTOM_CODE,
    	   ORDER_NUM,
    	   ORDER_TYPE,
    	   ORDER_PRSN,
    	   ORDER_DATE,
    	   MONEY_UNIT,
    	   EXCHG_RATE_O,
    	   AGREE_STATUS,
    	   INSERT_DB_USER,
    	   INSERT_DB_TIME,
    	   UPDATE_DB_USER,
    	   UPDATE_DB_TIME
    	)VALUES(
    	   #{KEY_VALUE},
           #{OPR_FLAG},
           #{COMP_CODE},
           #{DIV_CODE},
           #{CUSTOM_CODE},
           #{ORDER_NUM},
           #{ORDER_TYPE},
           #{ORDER_PRSN},
           #{ORDER_DATE},
           #{MONEY_UNIT},
           #{EXCHG_RATE_O},
    	   ISNULL(#{AGREE_STATUS},'2'),
           #{S_USER_ID},
           GETDATE(),
           #{S_USER_ID},
           GETDATE()
    	)
    </update>

    <update id="s_mpo200ukrv_ypServiceImpl.insertLogDetail" parameterType="Map">
    	INSERT INTO L_MPO200T(
            KEY_VALUE,
            OPR_FLAG,
            COMP_CODE,
            DIV_CODE,
            CUSTOM_CODE,
            ORDER_NUM,
            ORDER_SEQ,
            ITEM_CODE,
            ORDER_UNIT,
            DVRY_DATE,
            TRNS_RATE,
            ORDER_Q,
            ORDER_UNIT_Q,
            ORDER_P,
            ORDER_UNIT_P,
            ORDER_O,
            ORDER_LOC_P,
            ORDER_LOC_O,
            MONEY_UNIT,
            EXCHG_RATE_O,
            INSTOCK_Q,
            IN_DIV_CODE,
            WH_CODE,
            ORDER_REQ_NUM,
            CONTROL_STATUS,
            UNIT_PRICE_TYPE,
            UPDATE_DB_USER,
            UPDATE_DB_TIME,
            LOT_NO,
            REMARK,
            PROJECT_NO,
            INSPEC_FLAG,
            SO_NUM,
            SO_SEQ
        )VALUES(
            #{KEY_VALUE},
            #{OPR_FLAG},
            #{COMP_CODE},
            #{DIV_CODE},
            #{CUSTOM_CODE},
            #{ORDER_NUM},
            #{ORDER_SEQ},
            #{ITEM_CODE},
            #{ORDER_UNIT},
            #{DVRY_DATE},
            #{TRNS_RATE},
            #{ORDER_Q},
            #{ORDER_UNIT_Q},
            #{ORDER_P},
            #{ORDER_UNIT_P},
            #{ORDER_O},
            0,
            0,
            #{MONEY_UNIT},
            #{EXCHG_RATE_O},
            0,
            '01',
            #{WH_CODE},
            #{ORDER_REQ_NUM},
            #{CONTROL_STATUS},
            #{UNIT_PRICE_TYPE},
            #{S_USER_ID},
            GETDATE(),
            #{LOT_NO},
            #{REMARK},
            #{PROJECT_NO},
            #{INSPEC_YN},
            #{SO_NUM},
            #{SO_SEQ}
        )
    </update>

    <update id="s_mpo200ukrv_ypServiceImpl.USP_MATRL_Mpo200ukr" parameterType="Map" statementType="CALLABLE">
        {call USP_MATRL_Mpo200ukr (
            #{KeyValue, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
            #{OrderNum, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String},
            #{ErrorDesc, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
        )}
    </update>
</mapper>