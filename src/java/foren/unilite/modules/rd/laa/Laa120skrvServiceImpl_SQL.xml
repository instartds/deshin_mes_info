<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="laa120skrvServiceImpl">
	<select id="laa120skrvServiceImpl.selectList" parameterType="Map" resultType="rMap">
		/* laa120skrvServiceImpl.selectList */
		SELECT A.COMP_CODE
			 , A.CHILD_ITEM_CODE			AS ITEM_CODE
			 , B.ITEM_NAME
			 , A.UNIT_Q						AS MATERIAL_CONTENT
			 , C.CHEMICAL_CODE
			 , D.CHEMICAL_NAME
			 , D.CHEMICAL_NAME_EN
			 , D.CHEMICAL_NAME_CH
			 , D.CHEMICAL_NAME_JP
			 , A.UNIT_Q	* C.UNIT_RATE / 100	AS ACTUAL_CONTENT
			 , C.UNIT_RATE
			 , D.CAS_NO
			 , D.FUNCTION_DESC
			 , D.CONTROL_CH
			 , D.CONTROL_JP
			 , D.CONTROL_USA
			 , D.CONTROL_ETC1
			 , D.CONTROL_ETC2
			 , D.CONTROL_ETC3
			 , D.CONTROL_ETC4
			 , D.CONTROL_ETC5
			 , C.REMARK
		  FROM		 BPR580T A WITH(NOLOCK)
		  INNER JOIN BPR100T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
										   AND B.ITEM_CODE = A.CHILD_ITEM_CODE
		  LEFT  JOIN LAA110T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
										   AND C.ITEM_CODE = A.CHILD_ITEM_CODE
		  LEFT  JOIN LAA100T D WITH(NOLOCK) ON D.COMP_CODE     = C.COMP_CODE
										   AND D.CHEMICAL_CODE = C.CHEMICAL_CODE
		 WHERE A.COMP_CODE        = #{S_COMP_CODE}
		   AND A.DIV_CODE         = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE   = #{ITEM_CODE}
		   AND A.CHILD_ITEM_CODE != '$'
		   AND A.START_DATE   &lt;= CONVERT(NVARCHAR(08), GETDATE(), 112)
		 ORDER BY A.CHILD_ITEM_CODE ASC, C.UNIT_RATE DESC
	</select>

	<select id="laa120skrvServiceImpl.selectList2" parameterType="Map" resultType="rMap">
		/* laa120skrvServiceImpl.selectList2 */
		SELECT Z.COMP_CODE
			 , Z.CHEMICAL_CODE
			 , Z.CHEMICAL_NAME
			 , Z.CHEMICAL_NAME_EN
			 , Z.CHEMICAL_NAME_CH
			 , Z.CHEMICAL_NAME_JP
			 , SUM(Z.ACTUAL_CONTENT) AS ACTUAL_CONTENT
			 , Z.CAS_NO
			 , Z.FUNCTION_DESC
		  FROM (
				SELECT A.COMP_CODE
					 , C.CHEMICAL_CODE
					 , D.CHEMICAL_NAME
					 , D.CHEMICAL_NAME_EN
					 , D.CHEMICAL_NAME_CH
					 , D.CHEMICAL_NAME_JP
					 , A.UNIT_Q * C.UNIT_RATE / 100	AS ACTUAL_CONTENT
					 , D.CAS_NO
					 , D.FUNCTION_DESC
				  FROM		 BPR580T A WITH(NOLOCK)
				  INNER JOIN LAA110T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
												   AND C.ITEM_CODE = A.CHILD_ITEM_CODE
				  LEFT  JOIN LAA100T D WITH(NOLOCK) ON D.COMP_CODE     = C.COMP_CODE
												   AND D.CHEMICAL_CODE = C.CHEMICAL_CODE
				 WHERE A.COMP_CODE        = #{S_COMP_CODE}
				   AND A.DIV_CODE         = #{DIV_CODE}
				   AND A.PROD_ITEM_CODE   = #{ITEM_CODE}
				   AND A.CHILD_ITEM_CODE != '$'
				   AND A.START_DATE   &lt;= CONVERT(NVARCHAR(08), GETDATE(), 112)
		  ) Z
		 GROUP BY Z.COMP_CODE
				, Z.CHEMICAL_CODE
				, Z.CHEMICAL_NAME
				, Z.CHEMICAL_NAME_EN
				, Z.CHEMICAL_NAME_CH
				, Z.CHEMICAL_NAME_JP
				, Z.CAS_NO
				, Z.FUNCTION_DESC
		 ORDER BY 7 DESC
	</select>
</mapper>