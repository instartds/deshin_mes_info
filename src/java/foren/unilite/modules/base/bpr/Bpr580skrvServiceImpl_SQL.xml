<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bpr580skrvServiceImpl">
	<select id="bpr580skrvServiceImpl.selectMaster" parameterType="Map" resultType="rMap">	
		<if test="OPTSEL == &quot;0&quot;">
			/* bpr580skrv.Cbpr580skrv [fnBpr580QSt1]Query1 */
			/* 정전개 */
			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
			      , @UserId			NVARCHAR(100)	/* 사용자ID */
			      , @LangType		NVARCHAR(2)		/* 언어구분 */
			      , @RefItem		NVARCHAR(01)
			      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */
				
			SET @CompCode = #{S_COMP_CODE}
			SET @UserId   = #{S_USER_ID}
			SET @LangType = #{S_LANG_CODE}
			
			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED	
			SELECT A.DIV_CODE
			     , A.PROD_ITEM_CODE
			     , B.ITEM_CODE
			     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
			     , B.SPEC
			     , B.STOCK_UNIT
			     , (A.UNIT_Q * 0 + 1)                                                               AS UNIT_Q
			     , (A.PROD_UNIT_Q * 0 + 1)                                                          AS PROD_UNIT_Q
			     , (A.LOSS_RATE * 0)                                                                AS LOSS_RATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
			     , M1.CODE_NAME                                                  AS PATH_CODE
			     , A.BOM_YN
			     , A.USE_YN
			     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
			     --20180528 MATERIAL_CNT, SET_QTY 추가
			     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
			     , ISNULL(A.SET_QTY,0)																AS SET_QTY
			     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
			     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
			     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
			     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
			     , CONVERT(NVARCHAR(02), '')                                                        AS SUB_FLAG
			     , C.ITEM_ACCOUNT
			     , CONVERT(NUMERIC(5,0), 0)                                                         AS SEQ
			     , (A.UNIT_Q * 0 + 1)                                                               AS INTENS_Q
			     , B.SPEC_NUM                                                                       AS SPEC_NUM
			     , E.STOCK_Q                                                                        AS STOCK_Q
			     , A.REMARK                                                                         AS REMARK
			     
			  FROM            BPR500T  A  WITH (NOLOCK)
			       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
			                                           AND B.ITEM_CODE    = A.PROD_ITEM_CODE
			       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
			                                           AND C.DIV_CODE     = A.DIV_CODE
			                                           AND C.ITEM_CODE    = A.PROD_ITEM_CODE
			       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
			                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
			       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
			       				 FROM BIV100T WITH (NOLOCK) 
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.PROD_ITEM_CODE
			       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
			                                           AND M1.MAIN_CODE   = N'B083'
			                                           AND M1.SUB_CODE   != N'$'
			                                           AND M1.SUB_CODE    = A.PATH_CODE
			 WHERE A.COMP_CODE       = #{S_COMP_CODE}
			   AND A.DIV_CODE        = #{DIV_CODE}
			   AND A.PROD_ITEM_CODE  = #{ITEM_CODE}
			   AND A.CHILD_ITEM_CODE = '$'
<!-- 20190718 주석처리
			   <if test="@foren.Ognl@isNotEmpty(StPathY)">
                  <if test="StPathY == &quot;Y&quot;"> 
                  		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
                  </if>
                  <if test="StPathY == &quot;N&quot;">
            	  		AND A.path_code = A.path_code
                  </if>
          	   </if>
-->
          	   <if test="ITEM_SEARCH == &quot;C&quot;"> 
			   AND A.START_DATE     = (SELECT MAX(START_DATE)
                                         FROM BPR500T WITH(NOLOCK)
                                        WHERE COMP_CODE        = #{S_COMP_CODE}
                                          AND DIV_CODE         = #{DIV_CODE}
                                          AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                          AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                          AND PATH_CODE        = A.PATH_CODE
                                          AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112))
			   AND (A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                 OR A.STOP_DATE       IS NULL)
			  </if>
		</if>
			
		<if test="OPTSEL == &quot;1&quot;">
			/* bpr580skrv.Cbpr580skrv [fnBpr580QSt2]Query1 */
			/* 역전개 */
			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
			      , @UserId			NVARCHAR(100)	/* 사용자ID */
			      , @LangType		NVARCHAR(2)		/* 언어구분 */
			      , @RefItem		NVARCHAR(01)
			      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */
				
			SET @CompCode = #{S_COMP_CODE}
			SET @UserId   = #{S_USER_ID}
			SET @LangType = #{S_LANG_CODE}
			
			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
			SELECT DISTINCT 
				   A.DIV_CODE
			     , B.ITEM_CODE                                                                      AS PROD_ITEM_CODE
			     , B.ITEM_CODE
			     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
			     , B.SPEC
			     , B.STOCK_UNIT
			     , 1                                                                                AS UNIT_Q
			     , 1                                                                                AS PROD_UNIT_Q
			     , 0                                                                                AS LOSS_RATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
			     , M1.CODE_NAME                                                  AS PATH_CODE
			     , A.BOM_YN
			     , A.USE_YN
			     , A.MAN_HOUR
			     --20180528 MATERIAL_CNT, SET_QTY 추가
			     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
			     , ISNULL(A.SET_QTY,0)																AS SET_QTY
			     , A.UNIT_P1
			     , A.UNIT_P2
			     , A.UNIT_P3
			     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
			     , ''                                                                               AS SUB_FLAG
			     , C.ITEM_ACCOUNT
			     , 0                                                                                AS SEQ
			     , 1                                                                                AS INTENS_Q
			     , B.SPEC_NUM                                                                       AS SPEC_NUM
			     , E.STOCK_Q                                                                        AS STOCK_Q
			     , A.REMARK                                                                         AS REMARK
			  FROM            BPR500T  A  WITH (NOLOCK)
			       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
			                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
			       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
			                                           AND C.DIV_CODE     = A.DIV_CODE
			                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
			       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
			                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
			       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
			       				 FROM BIV100T WITH (NOLOCK) 
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE
			       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
			                                           AND M1.MAIN_CODE   = N'B083'
			                                           AND M1.SUB_CODE   != N'$'
			                                           AND M1.SUB_CODE    = A.PATH_CODE
			 WHERE A.COMP_CODE       = #{S_COMP_CODE}
			   AND A.DIV_CODE        = #{DIV_CODE}
			   AND A.CHILD_ITEM_CODE = #{ITEM_CODE}
<!-- 20190718 주석처리
			   <if test="@foren.Ognl@isNotEmpty(StPathY)">
                  <if test="StPathY == &quot;Y&quot;"> 
                  		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
                  </if>
                  <if test="StPathY == &quot;N&quot;">
            	  		AND A.path_code = A.path_code
                  </if>
          	   </if>
-->
          	   <if test="ITEM_SEARCH == &quot;C&quot;"> 
			   	AND	 A.START_DATE     = (SELECT MAX(START_DATE)
                                           FROM BPR500T WITH(NOLOCK)
                                          WHERE COMP_CODE        = #{S_COMP_CODE}
                                            AND DIV_CODE         = #{DIV_CODE}
                                            AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                            AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                            AND PATH_CODE        = A.PATH_CODE
                                            AND START_DATE   &lt;= CONVERT(VARCHAR(8), GETDATE(), 112))
			    AND (A.STOP_DATE &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                  OR A.STOP_DATE       IS NULL)
          	   </if>
		</if>
	</select>
	
	<select id="bpr580skrvServiceImpl.selectList" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		/* bpr580skrv.Cbpr580skrv [fnBpr580QSt1]Query1 */
		/* 정전개 */
		DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
		      , @UserId			NVARCHAR(100)	/* 사용자ID */
		      , @LangType		NVARCHAR(2)		/* 언어구분 */
		      , @RefItem		NVARCHAR(01)
		      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */
			
		SET @CompCode = #{S_COMP_CODE}
		SET @UserId   = #{S_USER_ID}
		SET @LangType = #{S_LANG_CODE}
		
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED	
		SELECT A.PROD_ITEM_CODE + B.ITEM_CODE 	as id
			 , 'root' 							as parentId
		     , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , (A.UNIT_Q * 0 + 1)                                                               AS UNIT_Q
		     , (A.PROD_UNIT_Q * 0 + 1)                                                          AS PROD_UNIT_Q
		     , (A.LOSS_RATE * 0)                                                                AS LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
		     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , CONVERT(NVARCHAR(02), '')                                                        AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , CONVERT(NUMERIC(5,0), 0)                                                         AS SEQ
		     , (A.UNIT_Q * 0 + 1)                                                               AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
		     , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.PROD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.PROD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
		       				 FROM BIV100T WITH (NOLOCK) 
		       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
		       														   AND E.DIV_CODE	= A.DIV_CODE
		       														   AND E.ITEM_CODE  = A.PROD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{ITEM_CODE}
		   AND A.CHILD_ITEM_CODE = '$'
<!-- 20190718 주석처리
		   <if test="@foren.Ognl@isNotEmpty(StPathY)">
              <if test="StPathY == &quot;Y&quot;"> 
              		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
              </if>
              <if test="StPathY == &quot;N&quot;">
        	  		AND A.path_code = A.path_code
              </if>
      	   </if>
-->
      	   <if test="ITEM_SEARCH == &quot;C&quot;"> 
		   AND A.START_DATE     = (SELECT MAX(START_DATE)
                                     FROM BPR500T WITH(NOLOCK)
                                    WHERE COMP_CODE        = #{S_COMP_CODE}
                                      AND DIV_CODE         = #{DIV_CODE}
                                      AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                      AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                      AND PATH_CODE        = A.PATH_CODE
                                      AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                      )
		   AND (
               A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
           OR  A.STOP_DATE       IS NULL
               )
		  </if>
	</select>
	<select id="bpr580skrvServiceImpl.selectList_new" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		/* bpr580skrv.Cbpr580skrv [fnBpr580QSt1]Query1 NEW */
		/* 정전개 */
		DECLARE @CompCode  NVARCHAR(08) 	/* 법인코드  */
		      , @DivCode  NVARCHAR(08) 		/* 사업장코드 */
		      , @ProdItemCode NVARCHAR(20) 	/* 품목코드  */
		      , @BaseDate  NVARCHAR(08) 	/* 기준일  */
		      , @UserId   NVARCHAR(100) 		/* 사용자ID  */
		    
		SET @CompCode = #{S_COMP_CODE}
		SET @DivCode       = #{DIV_CODE}
		SET @ProdItemCode  = #{ITEM_CODE}
		SET @BaseDate      = CONVERT(NVARCHAR(08), GETDATE(), 112)
		SET @UserId   = #{S_USER_ID}
		
		SELECT rtrim(ltrim(A.SORT_FLD)) AS id
		     , rtrim(ltrim(SORT_FLD2))  AS parentId
		     , A.DIV_CODE
		     , A.PROD_ITEM_CODE 
		     , A.ITEM_CODE
		     , A.ITEM_NAME
		     , A.SPEC
		     , A.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , C.ITEM_ACCOUNT
			 , C.SUPPLY_TYPE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)             AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )             AS STOP_DATE
		     , M1.CODE_NAME             AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                         AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)										AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)											AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                         AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                         AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                         AS UNIT_P3
		     , uniLITE.fnCustNameComp(A.COMP_CODE, @UserId, D.CUSTOM_CODE) AS CUSTOM_NAME
		     , ''                                                           AS SUB_FLAG
		     , A.SEQ
		     , A.INTENS_Q             AS INTENS_Q
		     , B.SPEC_NUM                                                   AS SPEC_NUM
		     , ISNULL(E.STOCK_Q, 0)                                         AS STOCK_Q
		     , A.REMARK
		     , ISNULL(A.LEVEL,0)+1											AS LVL --EXCEL 다운로드시 필요
		  FROM uniLITE.fnBOMExplosionAddInfo (@CompCode , @DivCode, @ProdItemCode, @BaseDate, @UserId, 'AV') A
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
		                         FROM BIV100T WITH (NOLOCK) 
		                        GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE) E ON E.COMP_CODE = A.COMP_CODE
		                                                                  AND E.DIV_CODE  = A.DIV_CODE
		                                                                  AND E.ITEM_CODE = A.ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
	</select>
	<select id="bpr580skrvServiceImpl.getChildren" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetChildren]Query1
		SELECT A.PROD_ITEM_CODE + B.ITEM_CODE 		as id
			 , #{parentId} 						as parentId
			 , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , ''                                                                               AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(UNIT_Q, 1) * (1 + ISNULL(LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                     AS REMARK   
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
			       				 FROM BIV100T WITH (NOLOCK) 
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{ITEM_CODE}
<!-- 20190718 주석처리
		   AND (
		       ({StPathY} = 'Y' AND (A.path_code = '0' OR A.path_code LIKE '1%'))
		    OR ({StPathY} = 'N' AND  A.path_code = A.path_code)
		       )
-->
		       <if test="ITEM_SEARCH == &quot;C&quot;"> 
          	 
			   AND A.START_DATE     = (
                                          SELECT MAX(START_DATE)
                                            FROM BPR500T WITH(NOLOCK)
                                           WHERE COMP_CODE        = #{S_COMP_CODE}
                                             AND DIV_CODE         = #{DIV_CODE}
                                             AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                             AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                             AND PATH_CODE        = A.PATH_CODE
                                             AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                          )
			   AND (
                   A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
               OR  A.STOP_DATE       IS NULL
                   )
			  </if>
		 ORDER BY A.SEQ
	</select>

	<select id="bpr580skrvServiceImpl.getSubstitute" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetSubstitute]Query1
		SELECT A.PROD_ITEM_CODE + A.CHILD_ITEM_CODE as id
			 , #{parentId}						as parentId
			 , A.DIV_CODE
		     , A.CHILD_ITEM_CODE AS PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
		     , CONVERT(NVARCHAR(08), '0')                                                       AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , 'S'                                                                              AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(UNIT_Q, 1) * (1 + ISNULL(LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		  FROM            BPR510T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.EXCHG_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.EXCHG_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
			       				 FROM BIV100T WITH (NOLOCK) 
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.EXCHG_ITEM_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{PROD_ITEM_CODE}
		   AND A.CHILD_ITEM_CODE = #{ITEM_CODE}
		 ORDER BY A.SEQ
	</select>

	<select id="bpr580skrvServiceImpl.selectList1" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
	/* bpr580skrv.Cbpr580skrv [fnBpr580QSt2]Query1 */  /* 역전개 */
			
			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
			      , @UserId			NVARCHAR(100)	/* 사용자ID */
			      , @LangType		NVARCHAR(2)		/* 언어구분 */
			      , @RefItem		NVARCHAR(01)
			      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */
				
			SET @CompCode = #{S_COMP_CODE}
			SET @UserId   = #{S_USER_ID}
			SET @LangType = #{S_LANG_CODE}
			
			
			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
			SELECT Top 1 
			 	   B.ITEM_CODE + B.ITEM_CODE 	as id
				 , 'root' 						as parentId
				 , A.DIV_CODE
			     , B.ITEM_CODE                                                                      AS PROD_ITEM_CODE
			     , B.ITEM_CODE
			     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
			     , B.SPEC
			     , B.STOCK_UNIT
			     , 1                                                                                AS UNIT_Q
			     , 1                                                                                AS PROD_UNIT_Q
			     , 0                                                                                AS LOSS_RATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
			     , M1.CODE_NAME                                                  AS PATH_CODE
			     , A.BOM_YN
			     , A.USE_YN
			     , A.MAN_HOUR
			     --20180528 MATERIAL_CNT, SET_QTY 추가
			     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
			     , ISNULL(A.SET_QTY,0)																AS SET_QTY
			     , A.UNIT_P1
			     , A.UNIT_P2
			     , A.UNIT_P3
			     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
			     , ''                                                                               AS SUB_FLAG
			     , C.ITEM_ACCOUNT
			     , 0                                                                                AS SEQ
			     , 1                                                                                AS INTENS_Q
			     , B.SPEC_NUM                                                                       AS SPEC_NUM
			     , E.STOCK_Q                                                                        AS STOCK_Q
			     , A.REMARK                                                                         AS REMARK
			  FROM            BPR500T  A  WITH (NOLOCK)
			       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
			                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
			       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
			                                           AND C.DIV_CODE     = A.DIV_CODE
			                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
			       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
			                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       	   LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
			       				 FROM BIV100T WITH (NOLOCK) 
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE		                                           
			       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
			                                           AND M1.MAIN_CODE   = N'B083'
			                                           AND M1.SUB_CODE   != N'$'
			                                           AND M1.SUB_CODE    = A.PATH_CODE
			 WHERE A.COMP_CODE       = #{S_COMP_CODE}
			   AND A.DIV_CODE        = #{DIV_CODE}
			   AND A.CHILD_ITEM_CODE = #{ITEM_CODE}
<!-- 20190718 주석처리
			   <if test="@foren.Ognl@isNotEmpty(StPathY)">
                  <if test="StPathY == &quot;Y&quot;"> 
                  		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
                  </if>
                  <if test="StPathY == &quot;N&quot;">
            	  		AND A.path_code = A.path_code
                  </if>
          	   </if>
-->
          	   <if test="ITEM_SEARCH == &quot;C&quot;"> 
			   	AND	 A.START_DATE     = (
                                          SELECT MAX(START_DATE)
                                            FROM BPR500T WITH(NOLOCK)
                                           WHERE COMP_CODE        = #{S_COMP_CODE}
                                             AND DIV_CODE         = #{DIV_CODE}
                                             AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                             AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                             AND PATH_CODE        = A.PATH_CODE
                                             AND START_DATE   &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                          )
			    AND (
				    A.STOP_DATE &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                OR  A.STOP_DATE       IS NULL
                    )
          	   </if>
	
	</select>

	<select id="bpr580skrvServiceImpl.getParent" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetParent]Query1
		SELECT 
		 	  case when  #{CHILD_ITEM_CODE}+#{PROD_ITEM_CODE} = #{ROOT_ITEM_CODE} 
		 	  	   then 'root' 
		 	  else #{CHILD_ITEM_CODE}+#{PROD_ITEM_CODE} 
		 	  end as parentId
			 , #{PROD_ITEM_CODE}+A.PROD_ITEM_CODE as id
			 , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , A.MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , A.UNIT_P1
		     , A.UNIT_P2
		     , A.UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , ''                                                                               AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(A.UNIT_Q, 1) * (1 + ISNULL(A.LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
			       				 FROM BIV100T WITH (NOLOCK) 
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE		       
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.CHILD_ITEM_CODE = #{PROD_ITEM_CODE}
<!-- 20190718 주석처리
		   AND (
		       ({StPathY} = 'Y' AND (A.path_code = '0' OR A.path_code LIKE '1%'))
		    OR ({StPathY} = 'N' AND  A.path_code = A.path_code)
		       )
-->		   
	       <if test="ITEM_SEARCH == &quot;C&quot;"> 
         	 
		   AND A.START_DATE     = (
                                         SELECT MAX(START_DATE)
                                           FROM BPR500T WITH(NOLOCK)
                                          WHERE COMP_CODE        = #{S_COMP_CODE}
                                            AND DIV_CODE         = #{DIV_CODE}
                                            AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                            AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                            AND PATH_CODE        = A.PATH_CODE
                                            AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                         )
		   AND (
                  A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
              OR  A.STOP_DATE       IS NULL
                  )
		  </if>
		 ORDER BY A.SEQ
	</select>

	<select id="bpr580skrvServiceImpl.getParent1" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetParent]Query2
		SELECT 
			   #{CHILD_ITEM_CODE}+#{PROD_ITEM_CODE} as parentId 
			 , #{PROD_ITEM_CODE}+A.PROD_ITEM_CODE as id
	<!-- 		   B.ITEM_CODE as parentId -->
	<!-- 		 , A.PROD_ITEM_CODE as id -->
			 , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , B.ITEM_NAME
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , A.MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , A.UNIT_P1
		     , A.UNIT_P2
		     , A.UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , ''                                                                               AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(A.UNIT_Q, 1) * (1 + ISNULL(A.LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.PROD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.PROD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q 
				       				 FROM BIV100T WITH (NOLOCK) 
				       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
				       														   AND E.DIV_CODE	= A.DIV_CODE
				       														   AND E.ITEM_CODE  = A.PROD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{PROD_ITEM_CODE}
		   AND A.CHILD_ITEM_CODE = #{CHILD_ITEM_CODE}
<!-- 20190718 주석처리
		   AND (
		       ({StPathY} = 'Y' AND (A.path_code = '0' OR A.path_code LIKE '1%'))
		    OR ({StPathY} = 'N' AND  A.path_code = A.path_code)
		       )
-->		   
	       <if test="ITEM_SEARCH == &quot;C&quot;"> 
	         	 
			   AND A.START_DATE     = (
	                                         SELECT MAX(START_DATE)
	                                           FROM BPR500T WITH(NOLOCK)
	                                          WHERE COMP_CODE        = #{S_COMP_CODE}
	                                            AND DIV_CODE         = #{DIV_CODE}
	                                            AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
	                                            AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
	                                            AND PATH_CODE        = A.PATH_CODE
	                                            AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
	                                         )
			   AND (
	                  A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
	              OR  A.STOP_DATE       IS NULL
	                  )
			</if>
		 ORDER BY A.SEQ
	 </select>

	<select id="bpr580skrvServiceImpl.chekCompCode" parameterType="Map" resultType="rMap">
		/* UBpr01Krv.CBpr501UKr[fnBpr501QStd] Query03 */
        DECLARE     @COMP_CODE  NVARCHAR(08)
        
        SET @COMP_CODE  = {S_COMP_CODE}
        
        SELECT SUB_CODE
          FROM BSA100T WITH(NOLOCK)
         WHERE COMP_CODE = @COMP_CODE
           AND MAIN_CODE = 'B082'
           AND (
               REF_CODE1 = 'Y'
            OR REF_CODE1 = 'y'
               )
	</select>
</mapper>