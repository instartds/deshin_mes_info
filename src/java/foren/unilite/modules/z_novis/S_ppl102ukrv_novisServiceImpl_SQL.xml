<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="s_ppl102ukrv_novisServiceImpl">

<select id="s_ppl102ukrv_novisServiceImpl.getPlanDay" parameterType="Map" resultType="rMap">
	
IF EXISTS (SELECT TOP 1 1 FROM tempdb.sys.objects WHERE object_id = OBJECT_ID('tempdb..#PLANDAY'))  
	BEGIN
		DROP TABLE #PLANDAY
	END

CREATE TABLE #PLANDAY
	( 
	  GUBUN	NVARCHAR(10)
	, DAY_1 NVARCHAR(08)
	, DAY_2 NVARCHAR(08)
	, DAY_3 NVARCHAR(08)
	, DAY_4 NVARCHAR(08)
	, DAY_5 NVARCHAR(08)
	, DAY_6 NVARCHAR(08)
	, DAY_7 NVARCHAR(08)
	, DAY_8 NVARCHAR(08)
	, DAY_9 NVARCHAR(08)
	, DAY_10 NVARCHAR(08)
	, DAY_11 NVARCHAR(08)
	)

DECLARE 

	@I INT, 
	@MAX_NO INT,
	@COL_NO INT,
	@COL_NAME NVARCHAR (100),
	
	@BASIS_DATE NVARCHAR(08),
	
	@VALUE NVARCHAR (08),
	
	@SQL_STRING NVARCHAR(1000)
	
	
	SET @COL_NAME = ''
	
	SET @BASIS_DATE = #{BASIS_DATE}
	
	SET @I = -3	--고정 (3일전)
	SET @MAX_NO = 7	--고정 (7일후)
	
	SET @COL_NO = 1
	
	SET @VALUE = ''

	INSERT #PLANDAY
	(
		GUBUN
	) 
	VALUES
	(
		@BASIS_DATE
	)

WHILE @I &lt;= @MAX_NO
	BEGIN
		SET @COL_NAME = 'DAY_' + CONVERT(NVARCHAR(2), @COL_NO)

		SET @VALUE = CONVERT(NVARCHAR(8),DATEADD(DAY,@I,@BASIS_DATE),112)

		SET @SQL_STRING =
			'UPDATE #PLANDAY ' +
			   'SET '+ @COL_NAME + ' = ' + @VALUE +
			 'WHERE GUBUN = ' + @BASIS_DATE  
		 
		EXEC sp_executesql @SQL_STRING

		SET @I = @I + 1
		SET @COL_NO = @COL_NO +1
	END
	
SELECT TOP 1 * FROM #PLANDAY
</select>





<update id="s_ppl102ukrv_novisServiceImpl.saveAutoItemCode" parameterType="Map">
	IF NOT EXISTS (
		SELECT
			TOP 1 COMP_CODE
		FROM BAUTONOT WITH(NOLOCK)
		WHERE COMP_CODE = #{S_COMP_CODE}
		  AND DIV_CODE = '01'  --고정
		  AND TABLE_ID = 'BPR100T' --고정
		  AND AUTO_MAN = #{AUTO_MAN}
	)

		BEGIN
			INSERT INTO BAUTONOT(
				COMP_CODE
				,DIV_CODE
				,TABLE_ID
				,BASIS_DATE
				,AUTO_MAN
				,LAST_SEQ
				,INSERT_DB_USER
				,INSERT_DB_TIME
				,UPDATE_DB_USER
				,UPDATE_DB_TIME
			)VALUES(
				#{S_COMP_CODE}
				,'01'
				,'BPR100T'
				,CONVERT(CHAR(8), GETDATE(), 112)
				,#{AUTO_MAN}
				,${LAST_SEQ}
				,#{S_USER_ID}
				,GETDATE()
				,#{S_USER_ID}
				,GETDATE()

			)

		END
	ELSE
		BEGIN
			UPDATE A SET
				 LAST_SEQ = ${LAST_SEQ}
				,UPDATE_DB_USER = #{S_USER_ID}
				,UPDATE_DB_TIME = GETDATE()
			FROM BAUTONOT A WITH(NOLOCK)
			WHERE A.COMP_CODE = #{S_COMP_CODE}
			  AND A.DIV_CODE = '01'  --고정
			  AND A.TABLE_ID = 'BPR100T' --고정
			  AND A.BASIS_DATE = (SELECT 	BASIS_DATE
									FROM (
										SELECT
											ROW_NUMBER()OVER(PARTITION BY COMP_CODE, DIV_CODE, TABLE_ID, AUTO_MAN ORDER BY BASIS_DATE DESC )  AS RN
											,BASIS_DATE
										FROM BAUTONOT WITH(NOLOCK)
										WHERE COMP_CODE = #{S_COMP_CODE}
										AND DIV_CODE = '01'  --고정
										AND TABLE_ID = 'BPR100T' --고정
										AND AUTO_MAN = #{AUTO_MAN}
									) T
								WHERE T.RN = 1
							  )
			  AND A.AUTO_MAN = #{AUTO_MAN}

		END
</update>


<select id="s_ppl102ukrv_novisServiceImpl.selectList1" parameterType="Map" resultType="rMap">

DECLARE

	@BASIS_DATE NVARCHAR(08)

SET @BASIS_DATE = #{BASIS_DATE}

SELECT
	TT.COMP_CODE
	,TT.DIV_CODE
	,TT.ITEM_CODE
	,MAX(R1.ITEM_NAME) AS ITEM_NAME
	,MAX(R1.SPEC) AS SPEC
	,TT.CUSTOM_CODE
	,MAX(R2.CUSTOM_NAME) AS CUSTOM_NAME
	,TT.WK_PLAN_Q

	,MAX(TT.PRODT_PLAN_DATE1) AS PRODT_PLAN_DATE1
	,MAX(TT.PROG_CODE1)		AS PROG_CODE1
	,MAX(TT.PROG_STATUS1)	AS PROG_STATUS1
	,MAX(TT.PRODT_DATE1)	AS PRODT_DATE1
	,MAX(TT.WK_PLAN_NUM1)	AS WK_PLAN_NUM1
	
	,MAX(TT.PRODT_PLAN_DATE2) AS PRODT_PLAN_DATE2
	,MAX(TT.PROG_CODE2)		AS PROG_CODE2
	,MAX(TT.PROG_STATUS2)	AS PROG_STATUS2
	,MAX(TT.PRODT_DATE2)	AS PRODT_DATE2
	,MAX(TT.WK_PLAN_NUM2)	AS WK_PLAN_NUM2
	
	,MAX(TT.PRODT_PLAN_DATE3) AS PRODT_PLAN_DATE3
	,MAX(TT.PROG_CODE3)		AS PROG_CODE3
	,MAX(TT.PROG_STATUS3)	AS PROG_STATUS3
	,MAX(TT.PRODT_DATE3)	AS PRODT_DATE3
	,MAX(TT.WK_PLAN_NUM3)	AS WK_PLAN_NUM3
	
	,MAX(TT.PRODT_PLAN_DATE4) AS PRODT_PLAN_DATE4
	,MAX(TT.PROG_CODE4)		AS PROG_CODE4
	,MAX(TT.PROG_STATUS4)	AS PROG_STATUS4
	,MAX(TT.PRODT_DATE4)	AS PRODT_DATE4
	,MAX(TT.WK_PLAN_NUM4)	AS WK_PLAN_NUM4
	
	,MAX(TT.PRODT_PLAN_DATE5) AS PRODT_PLAN_DATE5
	,MAX(TT.PROG_CODE5)		AS PROG_CODE5
	,MAX(TT.PROG_STATUS5)	AS PROG_STATUS5
	,MAX(TT.PRODT_DATE5)	AS PRODT_DATE5
	,MAX(TT.WK_PLAN_NUM5)	AS WK_PLAN_NUM5
	
	,MAX(TT.PRODT_PLAN_DATE6) AS PRODT_PLAN_DATE6
	,MAX(TT.PROG_CODE6)		AS PROG_CODE6
	,MAX(TT.PROG_STATUS6)	AS PROG_STATUS6
	,MAX(TT.PRODT_DATE6)	AS PRODT_DATE6
	,MAX(TT.WK_PLAN_NUM6)	AS WK_PLAN_NUM6
	
	,MAX(TT.PRODT_PLAN_DATE7) AS PRODT_PLAN_DATE7
	,MAX(TT.PROG_CODE7)		AS PROG_CODE7
	,MAX(TT.PROG_STATUS7)	AS PROG_STATUS7
	,MAX(TT.PRODT_DATE7)	AS PRODT_DATE7
	,MAX(TT.WK_PLAN_NUM7)	AS WK_PLAN_NUM7
	
	,MAX(TT.PRODT_PLAN_DATE8) AS PRODT_PLAN_DATE8
	,MAX(TT.PROG_CODE8)		AS PROG_CODE8
	,MAX(TT.PROG_STATUS8)	AS PROG_STATUS8
	,MAX(TT.PRODT_DATE8)	AS PRODT_DATE8
	,MAX(TT.WK_PLAN_NUM8)	AS WK_PLAN_NUM8
	
	,MAX(TT.PRODT_PLAN_DATE9) AS PRODT_PLAN_DATE9
	,MAX(TT.PROG_CODE9)		AS PROG_CODE9
	,MAX(TT.PROG_STATUS9)	AS PROG_STATUS9
	,MAX(TT.PRODT_DATE9)	AS PRODT_DATE9
	,MAX(TT.WK_PLAN_NUM9)	AS WK_PLAN_NUM9
	
	,MAX(TT.PRODT_PLAN_DATE10) AS PRODT_PLAN_DATE10
	,MAX(TT.PROG_CODE10)	AS PROG_CODE10
	,MAX(TT.PROG_STATUS10)	AS PROG_STATUS10
	,MAX(TT.PRODT_DATE10)	AS PRODT_DATE10
	,MAX(TT.WK_PLAN_NUM10)	AS WK_PLAN_NUM10
	
	,MAX(TT.PRODT_PLAN_DATE11) AS PRODT_PLAN_DATE11
	,MAX(TT.PROG_CODE11)	AS PROG_CODE11
	,MAX(TT.PROG_STATUS11)	AS PROG_STATUS11
	,MAX(TT.PRODT_DATE11)	AS PRODT_DATE11
	,MAX(TT.WK_PLAN_NUM11)	AS WK_PLAN_NUM11
FROM
(
	SELECT
		T.COMP_CODE
		,T.DIV_CODE
		,T.ITEM_CODE
		,T.CUSTOM_CODE
		,T.WK_PLAN_Q

		,CONVERT(NVARCHAR(8),DATEADD(DAY,-3,@BASIS_DATE),112) AS PRODT_PLAN_DATE1
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE1
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS1
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE1
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM1

		,CONVERT(NVARCHAR(8),DATEADD(DAY,-2,@BASIS_DATE),112) AS PRODT_PLAN_DATE2
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE2
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS2
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE2
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM2

		,CONVERT(NVARCHAR(8),DATEADD(DAY,-1,@BASIS_DATE),112) AS PRODT_PLAN_DATE3
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE3
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS3
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE3
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,-1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM3

		,@BASIS_DATE AS PRODT_PLAN_DATE4
		,CASE WHEN @BASIS_DATE = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE4
		,CASE WHEN @BASIS_DATE = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS4
		,CASE WHEN @BASIS_DATE = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE4
		,CASE WHEN @BASIS_DATE = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM4

		,CONVERT(NVARCHAR(8),DATEADD(DAY,1,@BASIS_DATE),112) AS PRODT_PLAN_DATE5
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE5
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS5
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE5
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,1,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM5

		,CONVERT(NVARCHAR(8),DATEADD(DAY,2,@BASIS_DATE),112) AS PRODT_PLAN_DATE6
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE6
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS6
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE6
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,2,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM6

		,CONVERT(NVARCHAR(8),DATEADD(DAY,3,@BASIS_DATE),112) AS PRODT_PLAN_DATE7
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE7
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS7
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE7
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,3,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM7
	
		,CONVERT(NVARCHAR(8),DATEADD(DAY,4,@BASIS_DATE),112) AS PRODT_PLAN_DATE8
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,4,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE8
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,4,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS8
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,4,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE8
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,4,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM8

		,CONVERT(NVARCHAR(8),DATEADD(DAY,5,@BASIS_DATE),112) AS PRODT_PLAN_DATE9
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,5,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE9
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,5,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS9
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,5,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE9
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,5,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM9

		,CONVERT(NVARCHAR(8),DATEADD(DAY,6,@BASIS_DATE),112) AS PRODT_PLAN_DATE10
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,6,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE10
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,6,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS10
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,6,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE10
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,6,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM10

		,CONVERT(NVARCHAR(8),DATEADD(DAY,7,@BASIS_DATE),112) AS PRODT_PLAN_DATE11
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,7,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_CODE ELSE NULL 
			END AS PROG_CODE11
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,7,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PROG_STATUS ELSE NULL 
			END AS PROG_STATUS11
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,7,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.PRODT_DATE ELSE NULL 
			END AS PRODT_DATE11
		,CASE WHEN CONVERT(NVARCHAR(8),DATEADD(DAY,7,@BASIS_DATE),112) = T.PRODT_PLAN_DATE THEN T.WK_PLAN_NUM ELSE NULL 
			END AS WK_PLAN_NUM11

	FROM (			 

		SELECT 
			--ROW_NUMBER() OVER(PARTITION BY COMP_CODE, DIV_CODE, ITEM_CODE, CUSTOM_CODE,WK_PLAN_Q  ORDER BY COMP_CODE, DIV_CODE, ITEM_CODE, CUSTOM_CODE,WK_PLAN_Q, PRODT_PLAN_DATE) AS RN 
			A.COMP_CODE
			,A.DIV_CODE
			,A.ITEM_CODE
			,A.CUSTOM_CODE
			,A.WK_PLAN_Q
			,A.PRODT_PLAN_DATE
			,A.PROG_CODE
			,A.PROG_STATUS
			,A.PRODT_DATE
		
			,A.WK_PLAN_NUM
		FROM S_PPL100T_NOVIS A WITH(NOLOCK)

		WHERE A.COMP_CODE = #{S_COMP_CODE}
			AND A.DIV_CODE = #{DIV_CODE}
			AND A.PRODT_PLAN_DATE &gt;= CONVERT(NVARCHAR(8),DATEADD(DAY,-3,@BASIS_DATE),112)
			AND A.PRODT_PLAN_DATE &lt;= CONVERT(NVARCHAR(8),DATEADD(DAY,7,@BASIS_DATE),112)
			
        <if test="@foren.Ognl@isNotEmpty(ITEM_CODE)">
			AND A.ITEM_CODE = #{ITEM_CODE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
			AND A.CUSTOM_CODE = #{CUSTOM_CODE}
        </if>
	)T
)TT

LEFT JOIN BPR100T R1 ON R1.COMP_CODE = TT.COMP_CODE
					AND R1.ITEM_CODE = TT.ITEM_CODE
LEFT JOIN BCM100T R2 ON R2.COMP_CODE = TT.COMP_CODE
					AND R2.CUSTOM_CODE = TT.CUSTOM_CODE

GROUP BY TT.COMP_CODE, TT.DIV_CODE, TT.ITEM_CODE, TT.CUSTOM_CODE, TT.WK_PLAN_Q

</select>


<update id="s_ppl102ukrv_novisServiceImpl.spAutoNum" parameterType="Map" statementType="CALLABLE">
	{call SP_GetAutoNumComp (
		#{COMP_CODE, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
		#{DIV_CODE, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
		#{TABLE_ID, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
		#{PREFIX, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
		#{BASIS_DATE, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
		#{AUTO_TYPE, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
		#{KEY_NUMBER, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
	)}
</update>
	
<insert id="s_ppl102ukrv_novisServiceImpl.insertDetail" parameterType="Map">
	
		
DECLARE
	@AutoNum NVARCHAR(20)
		    ,@TodayDate      NVARCHAR(8)
		    
		SET @TodayDate = CONVERT(NVARCHAR(8), GETDATE(), 112)

EXEC uniLITE.SP_GetAutoNumComp #{S_COMP_CODE}, #{DIV_CODE}, 'S_PPL100T_NOVIS', 'P', @TodayDate, '1', @AutoNum OUTPUT

INSERT INTO S_PPL100T_NOVIS
(
COMP_CODE
,DIV_CODE
,WK_PLAN_NUM
,ITEM_CODE
,CUSTOM_CODE
,WK_PLAN_Q

,PRODT_PLAN_DATE
,PROG_CODE
,PROG_STATUS
,PRODT_DATE

,INSERT_DB_USER
,INSERT_DB_TIME
,UPDATE_DB_USER
,UPDATE_DB_TIME
)
VALUES
(
#{S_COMP_CODE}
,#{DIV_CODE}
,@AutoNum
,#{ITEM_CODE}
,#{CUSTOM_CODE}
,${WK_PLAN_Q}

,#{PRODT_PLAN_DATE}
,#{PROG_CODE}
,#{PROG_STATUS}
,#{PRODT_DATE}

,#{S_USER_ID}
,GETDATE()
,#{S_USER_ID}
,GETDATE()
)
</insert>

<update id="s_ppl102ukrv_novisServiceImpl.updateDetail" parameterType="Map">
UPDATE S_PPL100T_NOVIS
   SET ITEM_CODE = #{ITEM_CODE}
	, CUSTOM_CODE = #{CUSTOM_CODE}
	, WK_PLAN_Q = ${WK_PLAN_Q}
	
	, PRODT_PLAN_DATE = #{PRODT_PLAN_DATE}
	, PROG_CODE = #{PROG_CODE}
	, PROG_STATUS = #{PROG_STATUS}
	, PRODT_DATE = #{PRODT_DATE}
	
	, UPDATE_DB_USER = #{S_USER_ID}
	, UPDATE_DB_TIME = GETDATE()
WHERE COMP_CODE = #{S_COMP_CODE}
  AND DIV_CODE = #{DIV_CODE}
  AND WK_PLAN_NUM = #{WK_PLAN_NUM}
</update>

<delete id="s_ppl102ukrv_novisServiceImpl.deleteDetail" parameterType="Map">
	DELETE S_PPL100T_NOVIS
	WHERE COMP_CODE = #{S_COMP_CODE}
	  AND DIV_CODE = #{DIV_CODE}
	  AND WK_PLAN_NUM = #{WK_PLAN_NUM}
</delete>

</mapper>