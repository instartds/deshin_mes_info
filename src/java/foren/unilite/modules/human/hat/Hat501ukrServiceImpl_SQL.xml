<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hat501ukrServiceImpl">
    
    <select id="hat501ukrServiceImpl.getDutyRule" parameterType="String" resultType="String">
        /* hat501ukrServiceImpl.getDutyRule */
        SELECT  DUTY_INPUT_RULE
        FROM    HBS400T
        WHERE   COMP_CODE = #{S_COMP_CODE}
    </select>
    
    <select id="hat501ukrServiceImpl.getAllDutycode" parameterType="rMap" resultType="rMap">
        /* hat501ukrServiceImpl.getAllDutycode */
        SELECT  DISTINCT B.SUB_CODE
             ,  B.CODE_NAME 
        FROM               HBS100T A WITH (NOLOCK)
                INNER JOIN BSA100T B WITH (NOLOCK) ON A.COMP_CODE = B.COMP_CODE
                                                  AND A.DUTY_CODE = B.SUB_CODE 
        WHERE   A.COMP_CODE = #{S_COMP_CODE}
        AND     B.MAIN_CODE = 'H033' 
        AND     B.SUB_CODE &lt;&gt; '$' 
        <if test='DUTY_RULE.equals("Y")'> 
        AND     A.COTR_TYPE = '2'
        </if>
        <if test='DUTY_RULE.equals("N")'> 
        AND     A.COTR_TYPE = '1'
        </if>
    </select>
    
    <select id="hat501ukrServiceImpl.getDutycode" parameterType="rMap" resultType="rMap">
        /* hat501ukrServiceImpl.getDutyCode */
        SELECT  B.SUB_CODE
             ,  B.CODE_NAME 
        FROM               HBS100T A WITH (NOLOCK)
                INNER JOIN BSA100T B WITH (NOLOCK) ON A.COMP_CODE = B.COMP_CODE
                                                  AND A.DUTY_CODE = B.SUB_CODE 
        WHERE   A.COMP_CODE = #{S_COMP_CODE}
        AND     B.MAIN_CODE = 'H033' 
        AND     B.SUB_CODE &lt;&gt; '$' 
        AND     A.PAY_CODE  = #{PAY_CODE}
        <if test='DUTY_RULE.equals("Y")'> 
        AND     A.COTR_TYPE = '2'
        </if>
        <if test='DUTY_RULE.equals("N")'> 
        AND     A.COTR_TYPE = '1'
        </if>
        ORDER   BY B.REF_CODE2, B.SUB_CODE

    </select>
    
    <select id="hat501ukrServiceImpl.getComboList" parameterType="rMap" resultType="rMap">
        /* hat510ukrServiceImpl.getComboList */
        SELECT  B.SUB_CODE
             ,  B.CODE_NAME 
        FROM               HBS100T A WITH (NOLOCK)
                INNER JOIN BSA100T B WITH (NOLOCK) ON A.COMP_CODE = B.COMP_CODE
                                                  AND A.DUTY_CODE = B.SUB_CODE 
        WHERE   A.COMP_CODE = #{S_COMP_CODE}
        AND     B.MAIN_CODE = 'H033' 
        AND     B.USE_YN = 'Y'
        AND     B.SUB_CODE &lt;&gt; '$' 
        <if test="@foren.Ognl@isNotEmpty(PAY_CODE)">
        AND     A.PAY_CODE  = #{PAY_CODE} 
        </if>
        AND     A.COTR_TYPE = '2' 
        ORDER   BY B.REF_CODE2, B.SUB_CODE
    </select>
    
    <select id="hat501ukrServiceImpl.selectList" parameterType="Map" resultType="rMap">     
        /* hat501ukrServiceImpl.selectList */
        SELECT  D.DUTY_YYYYMMDD AS DUTY_DATE         -- 20170621 : 박재범 (D.DUTY_DATE)
             ,  C.CAL_DATE
             ,  C.CAL_NO
             ,  C.WEEK_DAY
             ,  M1.CODE_NAME AS DAY_NAME
             ,  C.HOLY_TYPE  
             ,  M2.CODE_NAME AS HOLY_NAME
             ,  A.DEPT_CODE
             ,  A.DEPT_NAME
             ,  A.PERSON_NUMB
             ,  A.NAME
             ,  B.WORK_TEAM
             ,  M3.CODE_NAME AS WORK_TEAM_NAME
             ,  D.APPLY_YN          /* 일괄확정필드*/
             ,  D.DUTY_CHK1_YN
             ,  D.DUTY_CODE
             ,  D.DUTY_FR_D
             ,  D.DUTY_FR_H
             ,  D.DUTY_FR_M
             ,  D.DUTY_TO_D
             ,  D.DUTY_TO_H
             ,  D.DUTY_TO_M
             ,  D.OVERTIME_1_H
             ,  D.OVERTIME_1_M
             ,  D.OVERTIME_2_H
             ,  D.OVERTIME_2_M
             ,  D.OVERTIME_3_H
             ,  D.OVERTIME_3_M
             ,  D.LATENESS_H
             ,  D.LATENESS_M
             ,  D.EARLY_H
             ,  D.EARLY_M
             ,  D.OUT_H
             ,  D.OUT_M
             ,  A.DIV_CODE
             ,  D.REMARK             
        FROM               HUM100T A  WITH (NOLOCK)
                LEFT  JOIN HAT400T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE 
                                                   AND B.PERSON_NUMB    = A.PERSON_NUMB 
                                                   AND B.DUTY_YYYYMMDD  =  (SELECT  MAX(C.DUTY_YYYYMMDD)    
                                                                            FROM    HAT400T C WITH (NOLOCK)
                                                                            WHERE   C.COMP_CODE       = A.COMP_CODE
                                                                            AND     C.PERSON_NUMB     = A.PERSON_NUMB
                                                                            AND     C.DUTY_YYYYMMDD &lt;= #{DUTY_DATE})      
                LEFT  JOIN HBS600T C  WITH (NOLOCK) ON C.COMP_CODE      = A.COMP_CODE             
                                                   AND C.CAL_DATE       = #{DUTY_DATE}
                LEFT  JOIN HAT500T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE 
                                                   AND D.PERSON_NUMB    = A.PERSON_NUMB
                LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE     = A.COMP_CODE 
                                                   AND M1.MAIN_CODE     = 'H001'
                                                   AND M1.SUB_CODE      = CONVERT(VARCHAR(2),C.WEEK_DAY)
                LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                   AND M2.MAIN_CODE     = 'B011'
                                                   AND M2.SUB_CODE      = C.HOLY_TYPE
                LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                   AND M2.MAIN_CODE     = 'H004'
                                                   AND M2.SUB_CODE      = B.WORK_TEAM
        WHERE   A.COMP_CODE     = #{S_COMP_CODE}
        AND     D.DUTY_YYYYMMDD = #{DUTY_DATE}
        <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
        AND     A.DIV_CODE      = #{DIV_CODE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(PERSON_NUMB)">
        AND     A.PERSON_NUMB   = #{PERSON_NUMB}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DEPTS)">                    
        AND     A.DEPT_CODE    IN
            <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
                #{item}
            </foreach>                                  
        </if>
        <if test="@foren.Ognl@isNotEmpty(WORK_TEAM)">         
        AND     B.WORK_TEAM     = #{WORK_TEAM}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DUTY_CODE)">    
            <if test='DUTY_CODE.equals("01")'> 
        --기본연장(01)
        AND     D.OVERTIME_1_H != '00'
            </if>
            <if test='DUTY_CODE.equals("02")'>
        --추가연장(02)
        AND     D.OVERTIME_2_H != '00'
            </if>
            <if test='DUTY_CODE.equals("04")'>
        --야간(04)
        AND     D.OVERTIME_3_H != '00'
            </if>
            <if test='DUTY_CODE.equals("06")'>
        --지각(06) 
        AND     D.LATENESS_H   != '00'
            </if>
            <if test='DUTY_CODE.equals("07")'> 
        --외출(07)
        AND     D.EARLY_H      != '00'
            </if>   
            <if test='DUTY_CODE.equals("08")'>
        --외출(08) 
        AND     D.OUT_H        != '00'
            </if> 
       </if>
       
       
       <if test="@foren.Ognl@isNotEmpty(DUTY_CHK_YN)">  

            <!-- <if test="DUTY_CHK_YN.equals('true')"> -->
            EXCEPT
                    
            SELECT  D.DUTY_YYYYMMDD AS DUTY_DATE         -- 20170621 : 박재범 (D.DUTY_DATE)
                 ,  C.CAL_DATE
                 ,  C.CAL_NO
                 ,  C.WEEK_DAY
                 ,  M1.CODE_NAME AS DAY_NAME
                 ,  C.HOLY_TYPE  
                 ,  M2.CODE_NAME AS HOLY_NAME
                 ,  A.DEPT_CODE
                 ,  A.DEPT_NAME
                 ,  A.PERSON_NUMB
                 ,  A.NAME
                 ,  B.WORK_TEAM
                 ,  M3.CODE_NAME AS WORK_TEAM_NAME
                 ,  D.APPLY_YN          /* 일괄확정필드*/
                 ,  D.DUTY_CHK1_YN
                 ,  D.DUTY_CODE
                 ,  D.DUTY_FR_D
                 ,  D.DUTY_FR_H
                 ,  D.DUTY_FR_M
                 ,  D.DUTY_TO_D
                 ,  D.DUTY_TO_H
                 ,  D.DUTY_TO_M
                 ,  D.OVERTIME_1_H
                 ,  D.OVERTIME_1_M
                 ,  D.OVERTIME_2_H
                 ,  D.OVERTIME_2_M
                 ,  D.OVERTIME_3_H
                 ,  D.OVERTIME_3_M
                 ,  D.LATENESS_H
                 ,  D.LATENESS_M
                 ,  D.EARLY_H
                 ,  D.EARLY_M
                 ,  D.OUT_H
                 ,  D.OUT_M
                 ,  A.DIV_CODE
                 ,  D.REMARK             
            FROM               HUM100T A  WITH (NOLOCK)
                    LEFT  JOIN HAT400T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE 
                                                       AND B.PERSON_NUMB    = A.PERSON_NUMB 
                                                       AND B.DUTY_YYYYMMDD  =  (SELECT  MAX(C.DUTY_YYYYMMDD)    
                                                                                FROM    HAT400T C WITH (NOLOCK)
                                                                                WHERE   C.COMP_CODE       = A.COMP_CODE
                                                                                AND     C.PERSON_NUMB     = A.PERSON_NUMB
                                                                                AND     C.DUTY_YYYYMMDD &lt;= #{DUTY_DATE})      
                    LEFT  JOIN HBS600T C  WITH (NOLOCK) ON C.COMP_CODE      = A.COMP_CODE             
                                                       AND C.CAL_DATE       = #{DUTY_DATE}
                    LEFT  JOIN HAT500T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE 
                                                       AND D.PERSON_NUMB    = A.PERSON_NUMB
                    LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE     = A.COMP_CODE 
                                                       AND M1.MAIN_CODE     = 'H001'
                                                       AND M1.SUB_CODE      = CONVERT(VARCHAR(2),C.WEEK_DAY)
                    LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                       AND M2.MAIN_CODE     = 'B011'
                                                       AND M2.SUB_CODE      = C.HOLY_TYPE
                    LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                       AND M2.MAIN_CODE     = 'H004'
                                                       AND M2.SUB_CODE      = B.WORK_TEAM
            WHERE   A.COMP_CODE     = #{S_COMP_CODE}
            AND     D.DUTY_YYYYMMDD = #{DUTY_DATE}
            AND D.DUTY_CODE         = ''
            AND D.OVERTIME_2_H      = '0'
            AND D.OVERTIME_2_M      = '0'
            AND D.LATENESS_H        = '0'
            AND D.LATENESS_M        = '0'
            AND D.EARLY_H           = '0'
            AND D.EARLY_M           = '0'
            AND D.OUT_H             = '0'
            AND D.OUT_M             = '0'
            <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
            AND     A.DIV_CODE      = #{DIV_CODE}
            </if>
            <if test="@foren.Ognl@isNotEmpty(PERSON_NUMB)">
            AND     A.PERSON_NUMB   = #{PERSON_NUMB}
            </if>
            <if test="@foren.Ognl@isNotEmpty(DEPTS)">                    
            AND     A.DEPT_CODE    IN
                <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
                    #{item}
                </foreach>                                  
            </if>
            <if test="@foren.Ognl@isNotEmpty(WORK_TEAM)">         
            AND     B.WORK_TEAM     = #{WORK_TEAM}
            </if>
            <if test="@foren.Ognl@isNotEmpty(DUTY_CODE)">    
                <if test='DUTY_CODE.equals("01")'> 
                --기본연장(01)
                AND     D.OVERTIME_1_H != '00'
                </if>
                <if test='DUTY_CODE.equals("02")'>
                --추가연장(02)
                AND     D.OVERTIME_2_H != '00'
                </if>
                <if test='DUTY_CODE.equals("04")'>
                --야간(04)
                AND     D.OVERTIME_3_H != '00'
                </if>
                <if test='DUTY_CODE.equals("06")'>
                --지각(06) 
                AND     D.LATENESS_H   != '00'
                </if>
                <if test='DUTY_CODE.equals("07")'> 
                --외출(07)
                AND     D.EARLY_H      != '00'
                </if>   
                <if test='DUTY_CODE.equals("08")'>
                --외출(08) 
                AND     D.OUT_H        != '00'
                </if> 
            </if>
            
        </if>
    <!-- </if> -->

       
        ORDER   BY  WORK_TEAM , DEPT_CODE, NAME, PERSON_NUMB      
        <!-- ORDER   BY ISNULL(B.WORK_TEAM, '1'), A.DEPT_CODE, A.NAME, A.PERSON_NUMB -->      

    </select>
    
    <insert id="hat501ukrServiceImpl.insertList"  parameterType="rMap">
        /* hat520ukrServiceImpl.insertList */
        INSERT INTO HAT500T
        (
            COMP_CODE
        ,   PERSON_NUMB
        ,   DUTY_YYYYMMDD
        ,   DUTY_CHK1_YN
        ,   DUTY_FR_D
        ,   DUTY_FR_H
        ,   DUTY_FR_M
        ,   DUTY_TO_D
        ,   DUTY_TO_H
        ,   DUTY_TO_M
        ,   DUTY_CODE
        ,   WORK_TEAM
        ,   REMARK
        ,   LATENESS_H
        ,   LATENESS_M
        ,   EARLY_H
        ,   EARLY_M
        ,   OUT_H
        ,   OUT_M
        ,   OVERTIME_1_H
        ,   OVERTIME_1_M
        ,   OVERTIME_2_H
        ,   OVERTIME_2_M
        ,   OVERTIME_3_H
        ,   OVERTIME_3_M
        
        ,   INSERT_DB_USER
        ,   INSERT_DB_TIME
        ,   UPDATE_DB_USER
        ,   UPDATE_DB_TIME
        ,   TEMPC_01
        ,   TEMPC_02
        ,   TEMPC_03
        ,   TEMPN_01
        ,   TEMPN_02
        ,   TEMPN_03
        )
        VALUES
        ( 
            #{S_COMP_CODE}
        ,   #{PERSON_NUMB}
        ,   #{DUTY_DATE}
        ,   #{DUTY_CHK_YN}
            
        ,   #{DUTY_FR_D}
        ,   #{DUTY_FR_H}
        ,   #{DUTY_FR_M}
        ,   #{DUTY_TO_D}
        ,   #{DUTY_TO_H}
        ,   #{DUTY_TO_M}
        ,   #{DUTY_CODE}
        ,   #{WORK_TEAM}
        ,   #{REMARK}
        ,   #{LATENESS_H}
        ,   #{LATENESS_M}
        ,   #{EARLY_H}
        ,   #{EARLY_M}
        ,   #{OUT_H}
        ,   #{OUT_M}
        ,   #{OVERTIME_1_H}
        ,   #{OVERTIME_1_M}
        ,   #{OVERTIME_2_H}
        ,   #{OVERTIME_2_M}
        ,   #{OVERTIME_3_H}
        ,   #{OVERTIME_3_M}
        
        ,   #{S_USER_ID}
        ,   GETDATE()
        ,   #{S_USER_ID}
        ,   GETDATE()
        ,   #{TEMPC_01}
        ,   #{TEMPC_02}
        ,   #{TEMPC_03}
        ,   #{TEMPN_01}
        ,   #{TEMPN_02}
        ,   #{TEMPN_03}
        )
    </insert>

    <insert id="hat501ukrServiceImpl.insertExcelHAT500t" parameterType="Map">       /* 엑셀insert */
        /*hat501ukrServiceImpl.insertExcelHAT500t*/
           <!--
                INSERT INTO HAT500T_EXCEL
                    (_EXCEL_JOBID, _EXCEL_ROWNUM, _EXCEL_HAS_ERROR, _EXCEL_ERROR_MSG, COMP_CODE, DUTY_DATE, PERSON_NUMB, NAME, POST_CODE, POST_NAME
                    , DEPT_CODE, DEPT_NAME, DUTY_FR_DHM, DUTY_TO_DHM, INSERT_DB_USER, INSERT_DB_TIME, UPDATE_DB_USER, UPDATE_DB_TIME )
                VALUES (
                    #{_EXCEL_JOBID}, #{_EXCEL_ROWNUM}, #{_EXCEL_HAS_ERROR,jdbcType=VARCHAR}, #{_EXCEL_ERROR,jdbcType=VARCHAR}, #{S_COMP_CODE}, #{DUTY_DATE}, #{PERSON_NUMB}, #{NAME},  #{POST_CODE}, #{POST_NAME}
                    , #{DEPT_CODE}, #{DEPT_NAME}, #{DUTY_FR_DHM}, #{DUTY_TO_DHM}, #{S_USER_ID}, GETDATE(), #{S_USER_ID}, GETDATE()
                )
            --> 
        
        MERGE HAT500T_EXCEL AS M
            USING ( SELECT #{DUTY_DATE} AS DUTY_DATE , #{PERSON_NUMB} AS PERSON_NUMB ) AS A
            ON  M.DUTY_DATE     = A.DUTY_DATE
            AND M.PERSON_NUMB   = A.PERSON_NUMB
            WHEN NOT MATCHED THEN
                INSERT 
                (   COMP_CODE, DUTY_DATE, PERSON_NUMB, NAME
                ,   DEPT_CODE, DEPT_NAME, DUTY_FR_DHM, DUTY_TO_DHM, INSERT_DB_USER, INSERT_DB_TIME, UPDATE_DB_USER, UPDATE_DB_TIME )
                VALUES 
                (   #{S_COMP_CODE}, #{DUTY_DATE}, #{PERSON_NUMB}, #{NAME}
                ,   #{DEPT_CODE}, #{DEPT_NAME}, #{DUTY_FR_DHM}, #{DUTY_TO_DHM}, #{S_USER_ID}, GETDATE(), #{S_USER_ID}, GETDATE()
                )
            WHEN MATCHED THEN
                UPDATE
                SET     DUTY_FR_DHM     = #{DUTY_FR_DHM}
                  ,     DUTY_TO_DHM     = #{DUTY_TO_DHM}
                  ,     UPDATE_DB_USER  = #{S_USER_ID}
                  ,     UPDATE_DB_TIME  = GETDATE();       
                    
    </insert>   
    
    <insert id="hat501ukrServiceImpl.insertList_DutyRule_Y"  parameterType="rMap">
        /* hat501ukrServiceImpl.insertList_DutyRule_Y */
        INSERT INTO HAT500T
        (   COMP_CODE
        ,   PERSON_NUMB
        ,   DUTY_YYYYMMDD
        ,   DUTY_FR_D
        ,   DUTY_FR_H
        ,   DUTY_FR_M
        ,   DUTY_TO_D
        ,   DUTY_TO_H
        ,   DUTY_TO_M
        ,   DUTY_CODE
        ,   WORK_TEAM
        ,   UPDATE_DB_USER
        ,   UPDATE_DB_TIME
        ,   INSERT_DB_USER
        ,   INSERT_DB_TIME
        )
        VALUES
        (   #{S_COMP_CODE}
        ,   #{PERSON_NUMB}
        ,   #{DUTY_DATE}
        ,   #{DUTY_FR_D}
        ,   #{DUTY_FR_H}
        ,   #{DUTY_FR_M}
        ,   #{DUTY_TO_D}
        ,   #{DUTY_TO_H}
        ,   #{DUTY_TO_M}
        ,   #{DUTY_CODE}
        ,   #{WORK_TEAM}
        ,   #{S_USER_ID}
        ,   GETDATE()
        ,   #{S_USER_ID}
        ,   GETDATE()
        )
    </insert>
    
    
    <update id="hat501ukrServiceImpl.updateList"  parameterType="rMap">
        /* hat501ukrServiceImpl.updateList */
        UPDATE  HAT500T
        SET     DUTY_CODE       = #{DUTY_CODE}
          ,     DUTY_FR_D       = #{DUTY_FR_D}
          ,     DUTY_FR_H       = REPLICATE(0, 2 - LEN(#{DUTY_FR_H})) + #{DUTY_FR_H}
          ,     DUTY_FR_M       = REPLICATE(0, 2 - LEN(#{DUTY_FR_M})) + #{DUTY_FR_M}
          ,     DUTY_TO_D       = #{DUTY_TO_D}
          ,     DUTY_TO_H       = REPLICATE(0, 2 - LEN(#{DUTY_TO_H})) + #{DUTY_TO_H}
          ,     DUTY_TO_M       = REPLICATE(0, 2 - LEN(#{DUTY_TO_M})) + #{DUTY_TO_M}
          ,     OVERTIME_1_H    = REPLICATE(0, 2 - LEN(#{OVERTIME_1_H})) + #{OVERTIME_1_H}
          ,     OVERTIME_1_M    = REPLICATE(0, 2 - LEN(#{OVERTIME_1_M})) + #{OVERTIME_1_M}
          ,     OVERTIME_2_H    = REPLICATE(0, 2 - LEN(#{OVERTIME_2_H})) + #{OVERTIME_2_H}
          ,     OVERTIME_2_M    = REPLICATE(0, 2 - LEN(#{OVERTIME_2_M})) + #{OVERTIME_2_M}
          ,     OVERTIME_3_H    = REPLICATE(0, 2 - LEN(#{OVERTIME_3_H})) + #{OVERTIME_3_H}
          ,     OVERTIME_3_M    = REPLICATE(0, 2 - LEN(#{OVERTIME_3_M})) + #{OVERTIME_3_M}
          ,     LATENESS_H      = REPLICATE(0, 2 - LEN(#{LATENESS_H})) + #{LATENESS_H}
          ,     LATENESS_M      = REPLICATE(0, 2 - LEN(#{LATENESS_M})) + #{LATENESS_M}
          ,     EARLY_H         = REPLICATE(0, 2 - LEN(#{EARLY_H})) + #{EARLY_H}
          ,     EARLY_M         = REPLICATE(0, 2 - LEN(#{EARLY_M})) + #{EARLY_M}
          ,     OUT_H           = REPLICATE(0, 2 - LEN(#{OUT_H})) + #{OUT_H}
          ,     OUT_M           = REPLICATE(0, 2 - LEN(#{OUT_M})) + #{OUT_M}

        WHERE   COMP_CODE   = #{S_COMP_CODE}
        AND     PERSON_NUMB = #{PERSON_NUMB}
        AND     DUTY_YYYYMMDD   = #{DUTY_DATE}
        
        IF EXISTS (SELECT * FROM HAT400T 
            WHERE COMP_CODE     = #{S_COMP_CODE}
              AND DUTY_YYYYMMDD = #{DUTY_DATE}
              AND PERSON_NUMB   = #{PERSON_NUMB})


            BEGIN
                UPDATE HAT400T
                  SET WORK_TEAM     = #{WORK_TEAM}
                WHERE COMP_CODE     = #{S_COMP_CODE}
                  AND PERSON_NUMB   = #{PERSON_NUMB}
                  AND DUTY_YYYYMMDD = #{DUTY_DATE}
                  
            END
        
        ELSE
        
            BEGIN
                INSERT HAT400T
                        (
                          COMP_CODE
                        , DUTY_YYYYMMDD
                        , PERSON_NUMB
                        , WORK_TEAM
        
                        , UPDATE_DB_USER
                        , UPDATE_DB_TIME
                        , INSERT_DB_USER
                        , INSERT_DB_TIME
                        )
                        VALUES
                        (
                          #{S_COMP_CODE}
                        , #{DUTY_DATE}
                        , #{PERSON_NUMB}
                        , '2'
        
                        , #{S_USER_ID}
                        , GETDATE()
                        , #{S_USER_ID}
                        , GETDATE()
                        )
            END
    </update>
    
    
    <update id="hat501ukrServiceImpl.updateList_DutyRule_Y"  parameterType="rMap">
        /* hat501ukrServiceImpl.updateList_DutyRule_Y */
        UPDATE  HAT500T
        SET     DUTY_CODE = #{DUTY_CODE}
          ,     DUTY_FR_D = #{DUTY_FR_D}
          ,     DUTY_FR_H = REPLICATE(0, 2 - LEN(#{DUTY_FR_H})) + #{DUTY_FR_H}
          ,     DUTY_FR_M = REPLICATE(0, 2 - LEN(#{DUTY_FR_M})) + #{DUTY_FR_M}
          ,     DUTY_TO_D = #{DUTY_TO_D}
          ,     DUTY_TO_H = REPLICATE(0, 2 - LEN(#{DUTY_TO_H})) + #{DUTY_TO_H}
          ,     DUTY_TO_M = REPLICATE(0, 2 - LEN(#{DUTY_TO_M})) + #{DUTY_TO_M}
        WHERE   COMP_CODE   = #{S_COMP_CODE}
        AND     PERSON_NUMB = #{PERSON_NUMB}
        AND     DUTY_YYYYMMDD   = #{DUTY_DATE}
    </update>
    
    <delete id="hat501ukrServiceImpl.deleteList_DutyRule_Y"  parameterType="rMap">
        /* hat501ukrServiceImpl.deleteList_DutyRule_Y */
        DELETE  FROM HAT500T
        WHERE   COMP_CODE = #{S_COMP_CODE}
        AND     PERSON_NUMB = #{PERSON_NUMB}
        AND     DUTY_YYYYMMDD = #{DUTY_DATE}
    </delete>
    
    <insert id="hat501ukrServiceImpl.insertList_DutyRule_N01"  parameterType="rMap">
        /* hat501ukrServiceImpl.insertList_DutyRule_N01 */
        INSERT INTO HAT600T
        (   DUTY_YYYYMMDD
        ,   PERSON_NUMB
        ,   WORK_TEAM
        ,   DUTY_CODE
        ,   DUTY_NUM
        ,   DUTY_TIME
        ,   DUTY_MINU
        ,   UPDATE_DB_USER
        ,   UPDATE_DB_TIME
        ,   COMP_CODE
        ) 
        VALUES
        (   #{DUTY_DATE}
        ,   #{PERSON_NUMB}
        ,   #{WORK_TEAM}
        ,   #{DUTY_CODE}
        ,   #{DUTY_NUM}
        ,   #{DUTY_TIME}
        ,   #{DUTY_MINU}
        ,   #{S_USER_ID}
        ,   GETDATE()
        ,   #{S_COMP_CODE}
        )
    </insert>
        
    <insert id="hat501ukrServiceImpl.insertList_DutyRule_N02"  parameterType="rMap">
        /* hat501ukrServiceImpl.insertList_DutyRule_N02 */
        INSERT INTO HAT600T
        (   PERSON_NUMB
        ,   DUTY_YYYYMMDD
        ,   DUTY_CODE
        ,   DUTY_NUM
        ,   DUTY_TIME
        ,   DUTY_MINU
        ,   WORK_TEAM
        ,   UPDATE_DB_USER
        ,   UPDATE_DB_TIME
        ,   COMP_CODE
        )
        SELECT  B.PERSON_NUMB
             ,  #{DUTY_DATE}
             ,  A.SUB_CODE
             ,  0, 0, 0, #{WORK_TEAM}
             ,  #{S_USER_ID}
             ,  GETDATE()
             ,  B.COMP_CODE
        FROM               BSA100T A WITH (NOLOCK)
                INNER JOIN HUM100T B WITH (NOLOCK) ON A.COMP_CODE = B.COMP_CODE
                INNER JOIN HBS100T C WITH (NOLOCK) ON A.COMP_CODE = C.COMP_CODE
                                                  AND A.SUB_CODE  = C.DUTY_CODE
                                                  AND B.PAY_CODE  = C.PAY_CODE
        WHERE   A.COMP_CODE     = #{S_COMP_CODE} 
        AND     A.MAIN_CODE     = 'H033'
        AND     A.SUB_CODE &lt;&gt; '$'
        AND     B.PERSON_NUMB   =  #{PERSON_NUMB} 
        AND     A.SUB_CODE NOT IN ( SELECT  DUTY_CODE
                                    FROM    HAT600T
                                    WHERE   COMP_CODE   = #{S_COMP_CODE}
                                    AND     PERSON_NUMB = #{PERSON_NUMB} 
                                    AND     DUTY_YYYYMMDD   = #{DUTY_DATE})
    </insert>
    
    <update id="hat501ukrServiceImpl.updateList_DutyRule_N"  parameterType="rMap">
        /* hat501ukrServiceImpl.updateList_DutyRule_N */
        UPDATE  HAT600T
        SET     DUTY_NUM = '1'
          ,     UPDATE_DB_USER = #{S_USER_ID}
          ,     UPDATE_DB_TIME = GETDATE()
        WHERE   COMP_CODE   = #{S_COMP_CODE}
        AND     PERSON_NUMB = #{PERSON_NUMB}
        AND     DUTY_YYYYMMDD   = #{DUTY_DATE}
        AND     DUTY_CODE   = #{NUMC}
    </update>
    
    <delete id="hat501ukrServiceImpl.deleteList_DutyRule_N"  parameterType="rMap">
        /* hat501ukrServiceImpl.deleteList_DutyRule_N */
        DELETE  FROM HAT600T
        WHERE   COMP_CODE   = #{S_COMP_CODE}
        AND     PERSON_NUMB = #{PERSON_NUMB}
        AND     DUTY_YYYYMMDD   = #{DUTY_DATE}
    </delete>
    
    
    <delete id="hat501ukrServiceImpl.deleteList"  parameterType="rMap">
        /* hat501ukrServiceImpl.deleteList */
        DELETE  FROM HAT550T
        WHERE   COMP_CODE   = #{S_COMP_CODE}
        AND     PERSON_NUMB = #{PERSON_NUMB}
        AND     DUTY_YYYYMMDD   = #{DUTY_DATE}
    </delete>
    
    
    <select id="hat501ukrServiceImpl.select" parameterType="Map" resultType="rMap">
        SELECT  PGM_ID
             ,  SEQ
             ,  COL01
             ,  COL02
             ,  COL03
             ,  COL04
             ,  COL05
             ,  COL06
             ,  COL07
             ,  COL08
             ,  COL09
             ,  COL10
        FROM    TMP_CSV_30
        WHERE   FILE_ID = #{FILE_ID}
        
    </select>
    
    
    <insert id="hat501ukrServiceImpl.insertTXT" parameterType="Map">
        INSERT INTO TMP_CSV_30
        (
            PGM_ID
        ,   FILE_ID
        ,   SEQ
        ,   COL01
        ,   COL02
        ,   COL03
        ,   COL04
        ,   COL05
        ,   COL06
        ,   COL07
        ,   COL08
        ,   COL09
        ,   COL10
        ,   COL11
        ,   COL12
        ,   COL13
        ,   COL14
        ,   COL15
        ,   COL16
        ,   COL17
        ,   COL18
        ,   COL19
        ,   COL20
        ,   COL21
        ,   COL22
        ,   COL23
        ,   COL24
        ,   COL25
        ,   COL26
        ,   COL27
        ,   COL28
        ,   COL29
        ,   COL30
        )
        VALUES
        (
            #{PGM_ID}
        ,   #{FILE_ID}
        ,   #{SEQ}
        ,   #{COL01}
        ,   #{COL02}
        ,   #{COL03}
        ,   #{COL04}
        ,   #{COL05}
        ,   ''
        ,   #{KEY_VALUE}
        ,   #{COL08}
        ,   #{COL09}
        ,   #{COL10}
        ,   #{COL11}
        ,   #{COL12}
        ,   #{COL13}
        ,   #{COL14}
        ,   #{COL15}
        ,   #{COL16}
        ,   #{COL17}
        ,   #{COL18}
        ,   #{COL19}
        ,   #{COL20}
        ,   #{COL21}
        ,   #{COL22}
        ,   #{COL23}
        ,   #{COL24}
        ,   #{COL25}
        ,   #{COL26}
        ,   #{COL27}
        ,   #{COL28}
        ,   #{COL29}
        ,   #{COL30}
        )
        
    </insert>
    
    <insert id="hat501ukrServiceImpl.insertHAT" parameterType="Map" useGeneratedKeys="false">
    
        DBCC CHECKIDENT( L_HAT500T , RESEED, 0 )
    
        INSERT INTO L_HAT500T
        (
            KEY_VALUE
        ,   COMP_CODE
        ,   DUTY_DATE    
        ,   PERSON_NUMB  
        ,   DUTY_GUBUN     
        ,   DUTY_TIME      
        ,   REPRE_NUM      
        ,   PERSON_NAME    
        ,   INSERT_DB_USER 
        ,   INSERT_DB_TIME 
        )
        SELECT  COL07
             ,  #{S_COMP_CODE}
             ,  COL01
             ,  COL02
             ,  COL03
             ,  COL04
             ,  COL05
             ,  ''
             ,  #{S_USER_ID}
             ,  GETDATE()
        FROM    TMP_CSV_30
        WHERE   COL07 = #{KEY_VALUE}
    
    </insert>
    
    <select id="hat501ukrServiceImpl.insertSP" parameterType="Map" resultType="rMap">
        DECLARE @COMP_CODE  NVARCHAR(08)
              , @WORK_DATE  NVARCHAR(08)
              , @KEY_VALUE  NVARCHAR(20)
              , @LANG_TYPE  NVARCHAR(02)
              , @LOGIN_ID   NVARCHAR(100)
              , @ERROR_DESC NVARCHAR(2000)

        SET @COMP_CODE  = #{COMP_CODE}
        SET @WORK_DATE  = #{WORK_DATE}
        SET @KEY_VALUE  = #{KEY_VALUE}
        SET @LANG_TYPE  = #{LANG_TYPE}
        SET @LOGIN_ID   = #{LOGIN_ID}

        EXEC unilite.USP_HUMAN_HAT501TUKR_fnInsert @COMP_CODE, @WORK_DATE, @KEY_VALUE, @LANG_TYPE, @LOGIN_ID, @ERROR_DESC OUTPUT
        
        IF ISNULL(@ERROR_DESC, '') != ''
        BEGIN
            SELECT ISNULL(@ERROR_DESC, '')  AS errorDesc
        END
    </select>
    
    <update id="hat501ukrServiceImpl.commitAll_A" parameterType="Map" >
   /* hat501ukrServiceImpl.commitAll_A */
   
        UPDATE HAT500T     
        SET APPLY_YN = 'Y'      
        FROM               HUM100T A  WITH (NOLOCK)
                LEFT  JOIN HAT400T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE 
                                                   AND B.PERSON_NUMB    = A.PERSON_NUMB 
                                                   AND B.DUTY_YYYYMMDD  =  (SELECT  MAX(C.DUTY_YYYYMMDD)    
                                                                            FROM    HAT400T C WITH (NOLOCK)
                                                                            WHERE   C.COMP_CODE       = A.COMP_CODE
                                                                            AND     C.PERSON_NUMB     = A.PERSON_NUMB
                                                                            AND     C.DUTY_YYYYMMDD &lt;= #{DUTY_DATE})      
                LEFT  JOIN HBS600T C  WITH (NOLOCK) ON C.COMP_CODE      = A.COMP_CODE             
                                                   AND C.CAL_DATE       = #{DUTY_DATE}
                LEFT  JOIN HAT500T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE 
                                                   AND D.PERSON_NUMB    = A.PERSON_NUMB
                LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE     = A.COMP_CODE 
                                                   AND M1.MAIN_CODE     = 'H001'
                                                   AND M1.SUB_CODE      = CONVERT(VARCHAR(2),C.WEEK_DAY)
                LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                   AND M2.MAIN_CODE     = 'B011'
                                                   AND M2.SUB_CODE      = C.HOLY_TYPE
                LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                   AND M2.MAIN_CODE     = 'H004'
                                                   AND M2.SUB_CODE      = B.WORK_TEAM
        WHERE   A.COMP_CODE     = #{S_COMP_CODE}
        AND     D.APPLY_YN  = 'N'
        AND     D.DUTY_YYYYMMDD = #{DUTY_DATE}
        <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
        AND     A.DIV_CODE      = #{DIV_CODE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(PERSON_NUMB)">
        AND     A.PERSON_NUMB   = #{PERSON_NUMB}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DEPTS)">                    
        AND     A.DEPT_CODE    IN
            <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
                #{item}
            </foreach>                                  
        </if>
        <if test="@foren.Ognl@isNotEmpty(WORK_TEAM)">         
        AND     B.WORK_TEAM     = #{WORK_TEAM}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DUTY_CODE)">    
            <if test='DUTY_CODE.equals("01")'> 
        --기본연장(01)
        AND     D.OVERTIME_1_H != '00'
            </if>
            <if test='DUTY_CODE.equals("02")'>
        --추가연장(02)
        AND     D.OVERTIME_2_H != '00'
            </if>
            <if test='DUTY_CODE.equals("04")'>
        --야간(04)
        AND     D.OVERTIME_3_H != '00'
            </if>
            <if test='DUTY_CODE.equals("06")'>
        --지각(06) 
        AND     D.LATENESS_H   != '00'
            </if>
            <if test='DUTY_CODE.equals("07")'> 
        --외출(07)
        AND     D.EARLY_H      != '00'
            </if>   
            <if test='DUTY_CODE.equals("08")'>
        --외출(08) 
        AND     D.OUT_H        != '00'
            </if> 
       </if>
      </update> 
       
       <update id="hat501ukrServiceImpl.commitAll_B" parameterType="Map" >
       /* hat501ukrServiceImpl.commitAll_B */
       
                 
            UPDATE HAT500T     
            SET APPLY_YN = 'N'    
            FROM               HUM100T A  WITH (NOLOCK)
                    LEFT  JOIN HAT400T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE 
                                                       AND B.PERSON_NUMB    = A.PERSON_NUMB 
                                                       AND B.DUTY_YYYYMMDD  =  (SELECT  MAX(C.DUTY_YYYYMMDD)    
                                                                                FROM    HAT400T C WITH (NOLOCK)
                                                                                WHERE   C.COMP_CODE       = A.COMP_CODE
                                                                                AND     C.PERSON_NUMB     = A.PERSON_NUMB
                                                                                AND     C.DUTY_YYYYMMDD &lt;= #{DUTY_DATE})      
                    LEFT  JOIN HBS600T C  WITH (NOLOCK) ON C.COMP_CODE      = A.COMP_CODE             
                                                       AND C.CAL_DATE       = #{DUTY_DATE}
                    LEFT  JOIN HAT500T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE 
                                                       AND D.PERSON_NUMB    = A.PERSON_NUMB
                    LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE     = A.COMP_CODE 
                                                       AND M1.MAIN_CODE     = 'H001'
                                                       AND M1.SUB_CODE      = CONVERT(VARCHAR(2),C.WEEK_DAY)
                    LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                       AND M2.MAIN_CODE     = 'B011'
                                                       AND M2.SUB_CODE      = C.HOLY_TYPE
                    LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                       AND M2.MAIN_CODE     = 'H004'
                                                       AND M2.SUB_CODE      = B.WORK_TEAM
            WHERE   A.COMP_CODE     = #{S_COMP_CODE}
            AND     D.APPLY_YN = 'Y'
            AND     D.DUTY_YYYYMMDD = #{DUTY_DATE}
            AND D.DUTY_CODE         = ''
            AND D.OVERTIME_2_H      = '0'
            AND D.OVERTIME_2_M      = '0'
            AND D.LATENESS_H        = '0'
            AND D.LATENESS_M        = '0'
            AND D.EARLY_H           = '0'
            AND D.EARLY_M           = '0'
            AND D.OUT_H             = '0'
            AND D.OUT_M             = '0'
            <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
            AND     A.DIV_CODE      = #{DIV_CODE}
            </if>
            <if test="@foren.Ognl@isNotEmpty(PERSON_NUMB)">
            AND     A.PERSON_NUMB   = #{PERSON_NUMB}
            </if>
            <if test="@foren.Ognl@isNotEmpty(DEPTS)">                    
            AND     A.DEPT_CODE    IN
                <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
                    #{item}
                </foreach>                                  
            </if>
            <if test="@foren.Ognl@isNotEmpty(WORK_TEAM)">         
            AND     B.WORK_TEAM     = #{WORK_TEAM}
            </if>
            <if test="@foren.Ognl@isNotEmpty(DUTY_CODE)">    
                <if test='DUTY_CODE.equals("01")'> 
                --기본연장(01)
                AND     D.OVERTIME_1_H != '00'
                </if>
                <if test='DUTY_CODE.equals("02")'>
                --추가연장(02)
                AND     D.OVERTIME_2_H != '00'
                </if>
                <if test='DUTY_CODE.equals("04")'>
                --야간(04)
                AND     D.OVERTIME_3_H != '00'
                </if>
                <if test='DUTY_CODE.equals("06")'>
                --지각(06) 
                AND     D.LATENESS_H   != '00'
                </if>
                <if test='DUTY_CODE.equals("07")'> 
                --외출(07)
                AND     D.EARLY_H      != '00'
                </if>   
                <if test='DUTY_CODE.equals("08")'>
                --외출(08) 
                AND     D.OUT_H        != '00'
                </if> 
            </if>
            

    
    
    </update>     
    
    <update id="hat501ukrServiceImpl.cancelAll_A" parameterType="Map" >
    /* hat501ukrServiceImpl.cancelAll_A */
   
        UPDATE HAT500T     
        SET APPLY_YN = 'N'      
        FROM               HUM100T A  WITH (NOLOCK)
                LEFT  JOIN HAT400T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE 
                                                   AND B.PERSON_NUMB    = A.PERSON_NUMB 
                                                   AND B.DUTY_YYYYMMDD  =  (SELECT  MAX(C.DUTY_YYYYMMDD)    
                                                                            FROM    HAT400T C WITH (NOLOCK)
                                                                            WHERE   C.COMP_CODE       = A.COMP_CODE
                                                                            AND     C.PERSON_NUMB     = A.PERSON_NUMB
                                                                            AND     C.DUTY_YYYYMMDD &lt;= #{DUTY_DATE})      
                LEFT  JOIN HBS600T C  WITH (NOLOCK) ON C.COMP_CODE      = A.COMP_CODE             
                                                   AND C.CAL_DATE       = #{DUTY_DATE}
                LEFT  JOIN HAT500T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE 
                                                   AND D.PERSON_NUMB    = A.PERSON_NUMB
                LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE     = A.COMP_CODE 
                                                   AND M1.MAIN_CODE     = 'H001'
                                                   AND M1.SUB_CODE      = CONVERT(VARCHAR(2),C.WEEK_DAY)
                LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                   AND M2.MAIN_CODE     = 'B011'
                                                   AND M2.SUB_CODE      = C.HOLY_TYPE
                LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                   AND M2.MAIN_CODE     = 'H004'
                                                   AND M2.SUB_CODE      = B.WORK_TEAM
        WHERE   A.COMP_CODE     = #{S_COMP_CODE}
        AND     D.APPLY_YN  = 'Y'
        AND     D.DUTY_CHK1_YN = 'Y'
        AND     D.DUTY_YYYYMMDD = #{DUTY_DATE}
        <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
        AND     A.DIV_CODE      = #{DIV_CODE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(PERSON_NUMB)">
        AND     A.PERSON_NUMB   = #{PERSON_NUMB}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DEPTS)">                    
        AND     A.DEPT_CODE    IN
            <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
                #{item}
            </foreach>                                  
        </if>
        <if test="@foren.Ognl@isNotEmpty(WORK_TEAM)">         
        AND     B.WORK_TEAM     = #{WORK_TEAM}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DUTY_CODE)">    
            <if test='DUTY_CODE.equals("01")'> 
        --기본연장(01)
        AND     D.OVERTIME_1_H != '00'
            </if>
            <if test='DUTY_CODE.equals("02")'>
        --추가연장(02)
        AND     D.OVERTIME_2_H != '00'
            </if>
            <if test='DUTY_CODE.equals("04")'>
        --야간(04)
        AND     D.OVERTIME_3_H != '00'
            </if>
            <if test='DUTY_CODE.equals("06")'>
        --지각(06) 
        AND     D.LATENESS_H   != '00'
            </if>
            <if test='DUTY_CODE.equals("07")'> 
        --외출(07)
        AND     D.EARLY_H      != '00'
            </if>   
            <if test='DUTY_CODE.equals("08")'>
        --외출(08) 
        AND     D.OUT_H        != '00'
            </if> 
       </if>
      </update> 
       
       
       <update id="hat501ukrServiceImpl.cancelAll_B" parameterType="Map" >
       /* hat501ukrServiceImpl.cancelAll_B */
                 
            UPDATE HAT500T     
            SET APPLY_YN = 'Y'    
            FROM               HUM100T A  WITH (NOLOCK)
                    LEFT  JOIN HAT400T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE 
                                                       AND B.PERSON_NUMB    = A.PERSON_NUMB 
                                                       AND B.DUTY_YYYYMMDD  =  (SELECT  MAX(C.DUTY_YYYYMMDD)    
                                                                                FROM    HAT400T C WITH (NOLOCK)
                                                                                WHERE   C.COMP_CODE       = A.COMP_CODE
                                                                                AND     C.PERSON_NUMB     = A.PERSON_NUMB
                                                                                AND     C.DUTY_YYYYMMDD &lt;= #{DUTY_DATE})      
                    LEFT  JOIN HBS600T C  WITH (NOLOCK) ON C.COMP_CODE      = A.COMP_CODE             
                                                       AND C.CAL_DATE       = #{DUTY_DATE}
                    LEFT  JOIN HAT500T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE 
                                                       AND D.PERSON_NUMB    = A.PERSON_NUMB
                    LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE     = A.COMP_CODE 
                                                       AND M1.MAIN_CODE     = 'H001'
                                                       AND M1.SUB_CODE      = CONVERT(VARCHAR(2),C.WEEK_DAY)
                    LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                       AND M2.MAIN_CODE     = 'B011'
                                                       AND M2.SUB_CODE      = C.HOLY_TYPE
                    LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M2.COMP_CODE     = A.COMP_CODE 
                                                       AND M2.MAIN_CODE     = 'H004'
                                                       AND M2.SUB_CODE      = B.WORK_TEAM
            WHERE   A.COMP_CODE     = #{S_COMP_CODE}
            AND     D.APPLY_YN = 'N'
            AND     D.DUTY_CHK1_YN = 'Y'
            AND     D.DUTY_YYYYMMDD = #{DUTY_DATE}
            AND D.DUTY_CODE         = ''
            AND D.OVERTIME_2_H      = '0'
            AND D.OVERTIME_2_M      = '0'
            AND D.LATENESS_H        = '0'
            AND D.LATENESS_M        = '0'
            AND D.EARLY_H           = '0'
            AND D.EARLY_M           = '0'
            AND D.OUT_H             = '0'
            AND D.OUT_M             = '0'
            <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
            AND     A.DIV_CODE      = #{DIV_CODE}
            </if>
            <if test="@foren.Ognl@isNotEmpty(PERSON_NUMB)">
            AND     A.PERSON_NUMB   = #{PERSON_NUMB}
            </if>
            <if test="@foren.Ognl@isNotEmpty(DEPTS)">                    
            AND     A.DEPT_CODE    IN
                <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
                    #{item}
                </foreach>                                  
            </if>
            <if test="@foren.Ognl@isNotEmpty(WORK_TEAM)">         
            AND     B.WORK_TEAM     = #{WORK_TEAM}
            </if>
            <if test="@foren.Ognl@isNotEmpty(DUTY_CODE)">    
                <if test='DUTY_CODE.equals("01")'> 
                --기본연장(01)
                AND     D.OVERTIME_1_H != '00'
                </if>
                <if test='DUTY_CODE.equals("02")'>
                --추가연장(02)
                AND     D.OVERTIME_2_H != '00'
                </if>
                <if test='DUTY_CODE.equals("04")'>
                --야간(04)
                AND     D.OVERTIME_3_H != '00'
                </if>
                <if test='DUTY_CODE.equals("06")'>
                --지각(06) 
                AND     D.LATENESS_H   != '00'
                </if>
                <if test='DUTY_CODE.equals("07")'> 
                --외출(07)
                AND     D.EARLY_H      != '00'
                </if>   
                <if test='DUTY_CODE.equals("08")'>
                --외출(08) 
                AND     D.OUT_H        != '00'
                </if> 
            </if>
    
    </update>     
    
</mapper>