<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hpe500ukrServiceImpl">
	
	<select id="hpe500ukrServiceImpl.selectWorkPayListA" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectListWorkPayA
		/*************************************************************************************************************
			간이신고명세서(근로소득) 신고자료 (A 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT TOP 1
				   --	A1 . 레코드 구분		: A
				   --	A2 . 자료구분			: 77
				   SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)														AS SAFFER		--	A3 . 세무서코드
				   --	A4 . 제출년월일			: 사용자입력필드 - 제출년월일
				   --	A5 . 제출자구분			: 사용자입력필드 - 관리번호가 있을경우 '1', 없으면 '2'
				   --	A6 . 세무대리인관리번호	: 사용자입력필드 - 관리번호
				   --	A7 . 홈택스ID			: 사용자입력필드 - 홈택스ID
				   --	A8 . 세무프로그램코드	: 9000
				 , B.COMPANY_NUM																												--	A9 . 사업자등록번호
				 , CONVERT(CHAR(30)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)	AS DIV_NAME		--	A10. 법인명(상호)
				 , CONVERT(CHAR(30)  , A.DEPT_NAME)																				AS DEPT_NAME	--	A11. 담당자 부서
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))																AS REPRE_NAME	--	A12. 담당자 성명
				 , ISNULL(REPLACE(B.TELEPHON, '-', ''), '')                                                                                      AS TELEPHON		--	A13. 담당자 전화번호
				 , E.SECT_CNT                                                                                                   AS CNT			--	A14. 원천징수의무자(B레코드) 수
				 , CONVERT(CHAR(25)  , '')																						AS A_SPACE		--	A15. 공란
			FROM				HUM100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPE100T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, COUNT(DISTINCT T1.SECT_CODE) AS SECT_CNT
								FROM				HUM100T	T1 WITH (NOLOCK)
										INNER JOIN	HPE100T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
								WHERE  T1.COMP_CODE = @COMP_CODE
								AND    T2.YEAR_YYYY = @YEAR_YYYY
								AND    T2.HALF_YEAR = @HALF_YEAR
								AND    T1.SECT_CODE = @DIV_CODE
								GROUP  BY T1.COMP_CODE
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    C.YEAR_YYYY = @YEAR_YYYY
			AND    C.HALF_YEAR = @HALF_YEAR
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectWorkPayListB" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectListWorkPayB
		/*************************************************************************************************************
			간이신고명세서(근로소득) 신고자료 (B 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT DISTINCT
				   A.SECT_CODE
				   --	B1 . 레코드 구분		: B
				   --	B2 . 자료구분			: 77
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      AS SAFFER		--	B3 . 세무서코드
				   --	B4 . 일련번호			: 루프 변수 사용
				 , CONVERT(CHAR(40)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)    AS DIV_NAME		--	B5 . 상호(법인명)
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))                                                                AS REPRE_NAME	--	B6 . 성명(대표자)
				 , ISNULL(REPLACE(B.COMPANY_NUM, '-', ''), '')																	AS COMPANY_NUM	--	B7 . 사업자등록번호
				 , ISNULL(REPLACE(D.COMP_OWN_NO, '-', ''), '')																	AS REPRE_NO		--	B8 . 주민(법인)등록번호
				 , C.YEAR_YYYY																													--	B9 . 귀속년도
				 , C.HALF_YEAR																													--	B10. 근무시기
				 , E.PERSON_CNT																									AS CNT			--	B11. 근로자 수
				 , E.TAXABLE_INCOME_AMT																											--	B12. 과세소득합계
				 , E.ETC_INCOME_AMT                               																 				-- B13.인정상여        
				 --, E.NONTAXABLE_INCOME_AMT																									--	B13. 비과세소득합계
				 , CONVERT(CHAR(44)  , '')																						AS B_SPACE		--	B14. 공란
			FROM				HUM100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPE100T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, T1.SECT_CODE, T2.YEAR_YYYY, T2.HALF_YEAR
									 , COUNT(T2.PERSON_NUMB)			AS PERSON_CNT
									 , SUM(T2.TAXABLE_INCOME_AMT)		AS TAXABLE_INCOME_AMT
									 , SUM(T2.NONTAXABLE_INCOME_AMT)	AS NONTAXABLE_INCOME_AMT
									 , SUM(T2.ETC_INCOME_AMT)			AS ETC_INCOME_AMT
								FROM				HUM100T	T1 WITH (NOLOCK)
										INNER JOIN	HPE100T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
								WHERE  T1.COMP_CODE = @COMP_CODE
								AND    T2.YEAR_YYYY = @YEAR_YYYY
								AND    T2.HALF_YEAR = @HALF_YEAR
								AND    T1.SECT_CODE = @DIV_CODE
								GROUP  BY T1.COMP_CODE, T1.SECT_CODE, T2.YEAR_YYYY, T2.HALF_YEAR
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
																			AND E.SECT_CODE   = A.SECT_CODE
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    C.YEAR_YYYY = @YEAR_YYYY
			AND    C.HALF_YEAR = @HALF_YEAR
			ORDER  BY A.SECT_CODE
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectWorkPayListC" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectListWorkPayC
		/*************************************************************************************************************
			간이신고명세서(근로소득) 신고자료 (C 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT A.SECT_CODE
				   --	C1 . 레코드 구분		: C
				   --	C2 . 자료구분			: 77
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      	AS SAFFER		--	C3 . 세무서코드
				   --	C4 . 일련번호			: 루프 변수 사용
				 , REPLACE(B.COMPANY_NUM, '-', '')																					AS COMPANY_NUM	--	C5 . 사업자등록번호
				 , CONVERT(CHAR(13)  , unilite.fnCipherDecrypt(A.REPRE_NUM, ''))													AS REPRE_NUM	--	C6 . 주민등록번호
				 , CONVERT(CHAR(30)  , A.NAME)																						AS NAME			--	C7 . 성명
				 , CONVERT(CHAR(20)  , REPLACE(CASE WHEN ISNULL(A.PHONE_NO,'') = '' THEN A.TELEPHON ELSE A.PHONE_NO END, '-', ''))	AS TELEPHON		--	C8 . 전화번호
				 , CASE WHEN UPPER(A.NATION_CODE) = 'KR'	THEN '1' ELSE '9' END													AS FORIGN		--	C9 . 내ㆍ외국인
				 , CASE WHEN ISNULL(A.LIVE_GUBUN, '') = ''	THEN '1' ELSE A.LIVE_GUBUN END											AS LIVE_GUBUN	--	C10. 거주자구분
				 , UPPER(ISNULL(A.LIVE_CODE, 'KR'))																					AS LIVE_CODE	--	C11. 거주지국코드
				 , C.WORKDATE_FR																													--	C12. 근무기간시작년월일
				 , C.WORKDATE_TO																													--	C13. 근무기간종료년월일
				 , C.TAXABLE_INCOME_AMT																												--	C14. 과세소득
				 , C.ETC_INCOME_AMT																													--	C15. 인정상여
				 , CONVERT(CHAR(58)  , '')																							AS C_SPACE		--	C16. 공란
			FROM				HUM100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPE100T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    C.YEAR_YYYY = @YEAR_YYYY
			AND    C.HALF_YEAR = @HALF_YEAR
			ORDER  BY A.SECT_CODE, A.PERSON_NUMB
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectWorkPayListTest" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectListWorkPayA
		/*************************************************************************************************************
			간이신고명세서(근로소득) 신고자료 (A 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= N'MASTER'
			SET @DIV_CODE	= N'01'
			SET @YEAR_YYYY	= N'2019'
			SET @HALF_YEAR	= N'1'
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------	//	A레코드
			SELECT TOP 1
				   --	A1 . 레코드 구분		: A
				   --	A2 . 자료구분			: 77
				   SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)														AS SAFFER		--	A3 . 세무서코드
				   --	A4 . 제출년월일			: 사용자입력필드 - 제출년월일
				   --	A5 . 제출자구분			: 사용자입력필드 - 관리번호가 있을경우 '1', 없으면 '2'
				   --	A6 . 세무대리인관리번호	: 사용자입력필드 - 관리번호
				   --	A7 . 홈택스ID			: 사용자입력필드 - 홈택스ID
				   --	A8 . 세무프로그램코드	: 9000
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	A9 . 사업자등록번호
				 , CONVERT(CHAR(30)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)	AS DIV_NAME		--	A10. 법인명(상호)
				 , CONVERT(CHAR(30)  , A.DEPT_NAME)																				AS DEPT_NAME	--	A11. 담당자 부서
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))																AS REPRE_NAME	--	A12. 담당자 성명
				 , REPLACE(ISNULL(B.TELEPHON, ''), '-', '')																		AS TELEPHON		--	A13. 담당자 전화번호
				 , E.SECT_CNT																									AS CNT			--	A14. 원천징수의무자(B레코드) 수
				 , CONVERT(CHAR(25)  , '')																						AS A_SPACE		--	A15. 공란
			FROM				HUM100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPE100T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, COUNT(DISTINCT T1.SECT_CODE) AS SECT_CNT
								FROM				HUM100T	T1 WITH (NOLOCK)
										INNER JOIN	HPE100T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
								WHERE  T1.COMP_CODE = @COMP_CODE
								AND    T2.YEAR_YYYY = @YEAR_YYYY
								AND    T2.HALF_YEAR = @HALF_YEAR
								AND    T1.SECT_CODE = @DIV_CODE
								GROUP  BY T1.COMP_CODE
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    C.YEAR_YYYY = @YEAR_YYYY
			AND    C.HALF_YEAR = @HALF_YEAR
		    
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------	//	B레코드
			SELECT DISTINCT
				   A.SECT_CODE
				   --	B1 . 레코드 구분		: B
				   --	B2 . 자료구분			: 77
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      AS SAFFER		--	B3 . 세무서코드
				   --	B4 . 일련번호			: 루프 변수 사용
				 , CONVERT(CHAR(40)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)    AS DIV_NAME		--	B5 . 상호(법인명)
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))                                                                AS REPRE_NAME	--	B6 . 성명(대표자)
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	B7 . 사업자등록번호
				 , ISNULL(REPLACE(D.COMP_OWN_NO, '-', ''), '')																	AS REPRE_NO		--	B8 . 주민(법인)등록번호
				 , C.YEAR_YYYY																													--	B9 . 귀속년도
				 , C.HALF_YEAR																													--	B10. 근무시기
				 , E.PERSON_CNT																									AS CNT			--	B11. 근로자 수
				 , E.TAXABLE_INCOME_AMT																											--	B12. 과세소득합계
				 , E.NONTAXABLE_INCOME_AMT																										--	B13. 비과세소득합계
				 , CONVERT(CHAR(44)  , '')																						AS B_SPACE		--	B14. 공란
			FROM				HUM100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPE100T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, T1.SECT_CODE, T2.YEAR_YYYY, T2.HALF_YEAR
									 , COUNT(T2.PERSON_NUMB)			AS PERSON_CNT
									 , SUM(T2.TAXABLE_INCOME_AMT)		AS TAXABLE_INCOME_AMT
									 , SUM(T2.NONTAXABLE_INCOME_AMT)	AS NONTAXABLE_INCOME_AMT
								FROM				HUM100T	T1 WITH (NOLOCK)
										INNER JOIN	HPE100T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
								WHERE  T1.COMP_CODE = @COMP_CODE
								AND    T2.YEAR_YYYY = @YEAR_YYYY
								AND    T2.HALF_YEAR = @HALF_YEAR
								AND    T1.SECT_CODE = @DIV_CODE
								GROUP  BY T1.COMP_CODE, T1.SECT_CODE, T2.YEAR_YYYY, T2.HALF_YEAR
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
																			AND E.SECT_CODE   = A.SECT_CODE
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    C.YEAR_YYYY = @YEAR_YYYY
			AND    C.HALF_YEAR = @HALF_YEAR
			ORDER  BY A.SECT_CODE
		    
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------	//	C레코드
			SELECT A.SECT_CODE
				   --	C1 . 레코드 구분		: C
				   --	C2 . 자료구분			: 77
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      	AS SAFFER		--	C3 . 세무서코드
				   --	C4 . 일련번호			: 루프 변수 사용
				 , REPLACE(B.COMPANY_NUM, '-', '')																					AS COMPANY_NUM	--	C5 . 사업자등록번호
				 , CONVERT(CHAR(13)  , unilite.fnCipherDecrypt(A.REPRE_NUM, ''))													AS REPRE_NUM	--	C6 . 주민등록번호
				 , CONVERT(CHAR(30)  , A.NAME)																						AS NAME			--	C7 . 성명
				 , CONVERT(CHAR(20)  , REPLACE(CASE WHEN ISNULL(A.PHONE_NO,'') = '' THEN A.TELEPHON ELSE A.PHONE_NO END, '-', ''))	AS TELEPHON		--	C8 . 전화번호
				 , CASE WHEN UPPER(A.NATION_CODE) = 'KR'	THEN '1' ELSE '9' END													AS FORIGN		--	C9 . 내ㆍ외국인
				 , CASE WHEN ISNULL(A.LIVE_GUBUN, '') = ''	THEN '1' ELSE A.LIVE_GUBUN END											AS LIVE_GUBUN	--	C10. 거주자구분
				 , UPPER(ISNULL(A.LIVE_CODE, 'KR'))																					AS LIVE_CODE	--	C11. 거주지국코드
				 , C.WORKDATE_FR																													--	C12. 근무기간시작년월일
				 , C.WORKDATE_TO																													--	C13. 근무기간종료년월일
				 , C.TAXABLE_INCOME_AMT																												--	C14. 과세소득
				 , C.NONTAXABLE_INCOME_AMT																											--	C15. 비과세소득
				 , CONVERT(CHAR(58)  , '')																							AS C_SPACE		--	C16. 공란
			FROM				HUM100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPE100T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    C.YEAR_YYYY = @YEAR_YYYY
			AND    C.HALF_YEAR = @HALF_YEAR
			ORDER  BY A.SECT_CODE, A.PERSON_NUMB
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectBusiPayLiveInListA" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectBusiPayLiveInListA
		/*************************************************************************************************************
			간이신고명세서(거주자 사업소득) 신고자료 (A 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT TOP 1
				   --	A1 . 레코드 구분		: A
				   --	A2 . 자료구분			: 50
				   SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)														AS SAFFER		--	A3 . 세무서코드
				   --	A4 . 제출년월일			: 사용자입력필드 - 제출년월일
				   --	A5 . 제출자구분			: 사용자입력필드 - 관리번호가 있을경우 '1', 없으면 '2'
				   --	A6 . 세무대리인관리번호	: 사용자입력필드 - 관리번호
				   --	A7 . 홈택스ID			: 사용자입력필드 - 홈택스ID
				   --	A8 . 세무프로그램코드	: 9000
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	A9 . 사업자등록번호
				 , CONVERT(CHAR(30)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)	AS DIV_NAME		--	A10. 법인명(상호)
				 , CONVERT(CHAR(30)  , A.DEPT_NAME)																				AS DEPT_NAME	--	A11. 담당자 부서
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))																AS REPRE_NAME	--	A12. 담당자 성명
				 , REPLACE(ISNULL(B.TELEPHON, ''), '-', '')																		AS TELEPHON		--	A13. 담당자 전화번호
				 , E.SECT_CNT																									AS CNT			--	A14. 원천징수의무자(B레코드) 수
				 , CONVERT(CHAR(5)   , '')																						AS A_SPACE		--	A15. 공란
			FROM				HPB100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPB200T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
														AND C.DED_TYPE    = A.DED_TYPE
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, COUNT(DISTINCT T1.SECT_CODE) AS SECT_CNT
								FROM				HPB100T	T1 WITH (NOLOCK)
										INNER JOIN	HPB200T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
																			AND T2.DED_TYPE    = T1.DED_TYPE
								WHERE  T1.COMP_CODE   = @COMP_CODE
								AND    T1.SECT_CODE   = @DIV_CODE
								AND    LEFT(T2.PAY_YYYYMM, 4) = @YEAR_YYYY
                                AND  ((@HALF_YEAR     = '1' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                                      (@HALF_YEAR     = '2' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
								AND    T1.DWELLING_YN = '1'
								AND    T1.DED_TYPE    = '1'
								GROUP  BY T1.COMP_CODE
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
			WHERE  A.COMP_CODE   = @COMP_CODE
			AND    A.SECT_CODE   = @DIV_CODE
			AND    LEFT(C.PAY_YYYYMM, 4) = @YEAR_YYYY
            AND  ((@HALF_YEAR    = '1' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                  (@HALF_YEAR    = '2' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
			AND    A.DWELLING_YN = '1'
			AND    A.DED_TYPE	 = '1'
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectBusiPayLiveInListB" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectBusiPayLiveInListB
		/*************************************************************************************************************
			간이신고명세서(거주자 사업소득) 신고자료 (B 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT DISTINCT
				   A.SECT_CODE
				   --	B1 . 레코드 구분		: B
				   --	B2 . 자료구분			: 50
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      AS SAFFER		--	B3 . 세무서코드
				   --	B4 . 일련번호			: 루프 변수 사용
				 , CONVERT(CHAR(40)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)    AS DIV_NAME		--	B5 . 상호(법인명)
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))                                                                AS REPRE_NAME	--	B6 . 성명(대표자)
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	B7 . 사업자등록번호
				 , ISNULL(REPLACE(D.COMP_OWN_NO, '-', ''), '')																	AS REPRE_NO		--	B8 . 주민(법인)등록번호
				 , SUBSTRING(C.PAY_YYYYMM, 1, 4)																				AS YEAR_YYYY	--	B9 . 귀속년도
				 , @HALF_YEAR																									AS HALF_YEAR	--	B10. 근무시기
				 , E.PERSON_CNT																									AS CNT			--	B11. 반기소득인원
				 , E.PAY_AMOUNT_I																												--	B12. 반기총지급액계
				 , CONVERT(CHAR(37)  , '')																						AS B_SPACE		--	B13. 공란
			FROM				HPB100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPB200T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
														AND C.DED_TYPE    = A.DED_TYPE
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, T1.SECT_CODE, SUBSTRING(T2.PAY_YYYYMM, 1, 4)	AS YEAR_YYYY
									 , COUNT(T2.PERSON_NUMB)	AS PERSON_CNT
									 , SUM(T2.PAY_AMOUNT_I)		AS PAY_AMOUNT_I
								FROM				HPB100T	T1 WITH (NOLOCK)
										INNER JOIN	HPB200T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
																			AND T2.DED_TYPE    = T1.DED_TYPE
								WHERE  T1.COMP_CODE   = @COMP_CODE
								AND    T1.SECT_CODE   = @DIV_CODE
								AND    LEFT(T2.PAY_YYYYMM, 4) = @YEAR_YYYY
                                AND  ((@HALF_YEAR     = '1' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                                      (@HALF_YEAR     = '2' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
								AND    T1.DWELLING_YN = '1'
								AND    T1.DED_TYPE    = '1'
								GROUP  BY T1.COMP_CODE, T1.SECT_CODE, SUBSTRING(T2.PAY_YYYYMM, 1, 4)
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
																			AND E.SECT_CODE   = A.SECT_CODE
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    LEFT(C.PAY_YYYYMM, 4) = @YEAR_YYYY
            AND  ((@HALF_YEAR    = '1' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                  (@HALF_YEAR    = '2' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
			AND    A.DWELLING_YN = '1'
			AND    A.DED_TYPE	 = '1'
			ORDER  BY A.SECT_CODE
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectBusiPayLiveInListC" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectBusiPayLiveInListC
		/*************************************************************************************************************
			간이신고명세서(거주자 사업소득) 신고자료 (C 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT A.SECT_CODE
				   --	C1 . 레코드 구분		: C
				   --	C2 . 자료구분			: 50
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      AS SAFFER		--	C3 . 세무서코드
				   --	C4 . 일련번호			: 루프 변수 사용
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	C5 . 사업자등록번호
				 , C.DED_CODE																													--	C6 . 업종코드
				 , CONVERT(CHAR(30)  , A.NAME)																					AS NAME			--	C7 . 성명
				 , CONVERT(CHAR(13)  , CASE WHEN A.BUSINESS_TYPE  = '1'
											  OR A.DED_CODE		  = '851101'	THEN REPLACE(A.COMP_NUM, '-', '')
			 								WHEN A.BUSINESS_TYPE != '1'
											 AND A.FOREIGN_YN     = '1'			THEN REPLACE(uniLITE.fnCipherDecrypt(A.REPRE_NUM  , ''), '-', '')
			 								ELSE									 REPLACE(uniLITE.fnCipherDecrypt(A.FOREIGN_NUM, ''), '-', '')
									   END)																						AS REPRE_NUM	--	C8 . 주민등록번호
				 , ISNULL(A.FOREIGN_YN, CASE WHEN UPPER(A.NATION_CODE) = 'KR'	THEN '1' ELSE '9' END)							AS FORIGN		--	C9 . 내ㆍ외국인
				 , UPPER(ISNULL(A.DWELLING_CODE, ''))																			AS LIVE_CODE	--	C10. 거주지국코드
				 , SUBSTRING(C.SUPP_DATE , 1, 4)																				AS SUPP_YEAR	--	C11. 지급연도
				 , SUBSTRING(C.PAY_YYYYMM, 1, 4)																				AS PAY_YEAR		--	C12. 소득귀속연도
				 , COUNT(C.PAY_YYYYMM)																							AS PAY_COUNT	--	C13. 지급건수
				 , SUM(C.PAY_AMOUNT_I)																							AS PAY_AMOUNT_I	--	C14. 지급총액
				 , CONVERT(CHAR(70)  , '')																						AS C_SPACE		--	C15. 공란
			FROM				HPB100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPB200T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
														AND C.DED_TYPE    = A.DED_TYPE
			WHERE  A.COMP_CODE	 = @COMP_CODE
			AND    A.SECT_CODE	 = @DIV_CODE
			AND    LEFT(C.PAY_YYYYMM, 4) = @YEAR_YYYY
            AND  ((@HALF_YEAR    = '1' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                  (@HALF_YEAR    = '2' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
			AND    A.DWELLING_YN = '1'
			AND    A.DED_TYPE	 = '1'
			GROUP  BY A.SECT_CODE
				 , B.SAFFER_TAX
				 , B.COMPANY_NUM																												--	C5 . 사업자등록번호
				 , C.DED_CODE
				 , A.NAME
				 , A.BUSINESS_TYPE
				 , A.DED_CODE
				 , A.COMP_NUM
				 , A.FOREIGN_YN
				 , uniLITE.fnCipherDecrypt(A.REPRE_NUM  , '')
				 , uniLITE.fnCipherDecrypt(A.FOREIGN_NUM, '')
				 , A.NATION_CODE
				 , A.DWELLING_CODE
				 , SUBSTRING(C.SUPP_DATE , 1, 4)
				 , SUBSTRING(C.PAY_YYYYMM, 1, 4)
			ORDER  BY A.SECT_CODE
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectBusiPayLiveOutListA" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectBusiPayLiveOutListA
		/*************************************************************************************************************
			간이신고명세서(비거주자 사업소득) 신고자료 (A 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT TOP 1
				   --	A1 . 레코드 구분		: A
				   --	A2 . 자료구분			: 49
				   SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)														AS SAFFER		--	A3 . 세무서코드
				   --	A4 . 제출년월일			: 사용자입력필드 - 제출년월일
				   --	A5 . 제출자구분			: 사용자입력필드 - 관리번호가 있을경우 '1', 없으면 '2'
				   --	A6 . 세무대리인관리번호	: 사용자입력필드 - 관리번호
				   --	A7 . 홈택스ID			: 사용자입력필드 - 홈택스ID
				   --	A8 . 세무프로그램코드	: 9000
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	A9 . 사업자등록번호
				 , CONVERT(CHAR(40)  , CASE WHEN ISNULL(B.DIV_FULL_NAME, '') = '' THEN D.COMP_NAME ELSE B.DIV_FULL_NAME END)	AS DIV_NAME		--	A10. 법인명(상호)
				 , CONVERT(CHAR(30)  , A.DEPT_NAME)																				AS DEPT_NAME	--	A11. 담당자 부서
				 , CONVERT(CHAR(30)  , ISNULL(B.REPRE_NAME, ''))																AS REPRE_NAME	--	A12. 담당자 성명
				 , REPLACE(ISNULL(B.TELEPHON, ''), '-', '')																		AS TELEPHON		--	A13. 담당자 전화번호
				 , E.SECT_CNT																									AS CNT			--	A14. 원천징수의무자(B레코드) 수
				 , CONVERT(CHAR(85)  , '')																						AS A_SPACE		--	A15. 공란
			FROM				HPB100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPB200T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
														AND C.DED_TYPE    = A.DED_TYPE
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, COUNT(DISTINCT T1.SECT_CODE) AS SECT_CNT
								FROM				HPB100T	T1 WITH (NOLOCK)
										INNER JOIN	HPB200T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
																			AND T2.DED_TYPE    = T1.DED_TYPE
								WHERE  T1.COMP_CODE   = @COMP_CODE
								AND    T1.SECT_CODE   = @DIV_CODE
								AND    LEFT(T2.PAY_YYYYMM, 4) = @YEAR_YYYY
                                AND  ((@HALF_YEAR     = '1' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                                      (@HALF_YEAR     = '2' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
								AND    T1.DWELLING_YN = '2'
								AND    T1.DED_TYPE    = '1'
								AND    T1.BUSINESS_TYPE != '1'
								GROUP  BY T1.COMP_CODE
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
			WHERE  A.COMP_CODE   = @COMP_CODE
			AND    A.SECT_CODE   = @DIV_CODE
			AND    LEFT(C.PAY_YYYYMM, 4) = @YEAR_YYYY
            AND  ((@HALF_YEAR    = '1' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                  (@HALF_YEAR    = '2' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
			AND    A.DWELLING_YN = '2'
			AND    A.DED_TYPE	 = '1'
		    AND    A.BUSINESS_TYPE != '1'
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectBusiPayLiveOutListB" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectBusiPayLiveOutListB
		/*************************************************************************************************************
			간이신고명세서(비거주자 사업소득) 신고자료 (B 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT DISTINCT
				   A.SECT_CODE
				   --	B1 . 레코드 구분		: B
				   --	B2 . 자료구분			: 49
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      AS SAFFER		--	B3 . 세무서코드
				   --	B4 . 일련번호			: 루프 변수 사용
				 , CONVERT(CHAR(50)  , ISNULL(D.COMP_ENG_NAME, ''))																		    AS DIV_NAME		--	B5 . 상호(법인명)
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	B6 . 사업자등록번호
				 , CONVERT(CHAR(140) , ISNULL(D.ENG_ADDR     , ''))																AS ADDR			--	B7 . 소재지(주소)
				 , SUBSTRING(C.PAY_YYYYMM, 1, 4)																				AS YEAR_YYYY	--	B8 . 귀속년도
				 , @HALF_YEAR																									AS HALF_YEAR	--	B9 . 근무시기
				 , E.PERSON_CNT																									AS CNT			--	B10. 반기소득인원
				 , E.PAY_AMOUNT_I																												--	B11. 반기총지급액계
				 , CONVERT(CHAR(20)  , '')																						AS B_SPACE		--	B12. 공란
			FROM				HPB100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPB200T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
														AND C.DED_TYPE    = A.DED_TYPE
					INNER JOIN	BOR100T	D WITH (NOLOCK)  ON	D.COMP_CODE   = A.COMP_CODE
					INNER JOIN (-- 사업장별 그룹갯수 조회
								SELECT T1.COMP_CODE, T1.SECT_CODE, SUBSTRING(T2.PAY_YYYYMM, 1, 4)	AS YEAR_YYYY
									 , COUNT(T2.PERSON_NUMB)	AS PERSON_CNT
									 , SUM(T2.PAY_AMOUNT_I)		AS PAY_AMOUNT_I
								FROM				HPB100T	T1 WITH (NOLOCK)
										INNER JOIN	HPB200T	T2 WITH (NOLOCK) ON T2.COMP_CODE   = T1.COMP_CODE
																			AND T2.PERSON_NUMB = T1.PERSON_NUMB
																			AND T2.DED_TYPE    = T1.DED_TYPE
								WHERE  T1.COMP_CODE   = @COMP_CODE
								AND    T1.SECT_CODE   = @DIV_CODE
								AND    LEFT(T2.PAY_YYYYMM, 4) = @YEAR_YYYY
                                AND  ((@HALF_YEAR     = '1' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                                      (@HALF_YEAR     = '2' AND LEFT(T2.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
								AND    T1.DWELLING_YN = '2'
								AND    T1.DED_TYPE    = '1'
								AND    T1.BUSINESS_TYPE != '1'
								GROUP  BY T1.COMP_CODE, T1.SECT_CODE, SUBSTRING(T2.PAY_YYYYMM, 1, 4)
							   )		E									 ON E.COMP_CODE   = A.COMP_CODE
																			AND E.SECT_CODE   = A.SECT_CODE
			WHERE  A.COMP_CODE = @COMP_CODE
			AND    A.SECT_CODE = @DIV_CODE
			AND    LEFT(C.PAY_YYYYMM, 4) = @YEAR_YYYY
            AND  ((@HALF_YEAR    = '1' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                  (@HALF_YEAR    = '2' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
			AND    A.DWELLING_YN = '2'
			AND    A.DED_TYPE	 = '1'
			AND    A.BUSINESS_TYPE != '1'
			ORDER  BY A.SECT_CODE
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

	<select id="hpe500ukrServiceImpl.selectBusiPayLiveOutListC" parameterType="Map" resultType="rMap">
		--Hpe500ukr.selectBusiPayLiveOutListC
		/*************************************************************************************************************
			간이신고명세서(비거주자 사업소득) 신고자료 (C 레코드) 조회
		*************************************************************************************************************/
		BEGIN
			DECLARE @COMP_CODE	NVARCHAR(08)
				  , @DIV_CODE	NVARCHAR(08)
				  , @YEAR_YYYY	NVARCHAR(04)
				  , @HALF_YEAR	NVARCHAR(01)
			
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		--  1. 변수 값 할당 ----------------------------------------------------------------------------------------
			SET @COMP_CODE	= #{S_COMP_CODE}
			SET @DIV_CODE	= #{DIV_CODE}
			SET @YEAR_YYYY	= #{YEAR_YYYY}
			SET @HALF_YEAR	= #{HALF_YEAR}
		
		--  2. 데이터 조회 -----------------------------------------------------------------------------------------
			SELECT A.SECT_CODE
				   --	C1 . 레코드 구분		: C
				   --	C2 . 자료구분			: 50
				 , SUBSTRING(LTRIM(RTRIM(ISNULL(B.SAFFER_TAX, ''))), 1, 3)                                                      AS SAFFER		--	C3 . 세무서코드
				   --	C4 . 일련번호			: 루프 변수 사용
				 , REPLACE(B.COMPANY_NUM, '-', '')																				AS COMPANY_NUM	--	C5 . 사업자등록번호
				 , C.DED_CODE																													--	C6 . 업종코드
				 , CONVERT(CHAR(30)  , CASE WHEN A.BUSINESS_TYPE  = '1'			THEN ISNULL(A.COMP_ENG_NAME, '')
				 							ELSE									 ISNULL(A.ENG_NAME     , '')
				 					   END)																						AS NAME			--	C7 . 소득자성명(상호)
				 , CONVERT(CHAR(13)  , CASE WHEN unilite.fnCipherDecrypt(A.REPRE_NUM, '') = '' THEN
												 CASE WHEN ISNULL(A.COMP_NUM, '') = '' THEN
														   CASE WHEN unilite.fnCipherDecrypt(A.FOREIGN_NUM, '') = '' THEN REPLACE(A.RECOGN_NUM, '-', '')
																ELSE REPLACE(unilite.fnCipherDecrypt(A.FOREIGN_NUM, ''), '-', '')
														   END
													  ELSE REPLACE(A.COMP_NUM, '-', '')
												 END
											ELSE REPLACE(unilite.fnCipherDecrypt(A.REPRE_NUM, ''), '-', '')
									   END)																						AS REPRE_NUM	--	C8 . 주민등록번호
				 , CONVERT(CHAR(140) , CASE WHEN A.BUSINESS_TYPE  = '1'			THEN ISNULL(A.COMP_ENG_ADDR, '')
				 							ELSE									 ISNULL(A.ENG_ADDR     , '')
				 					   END)																						AS ADDR			--	C9 . 소득자의 주소
				 , ISNULL(A.FOREIGN_YN, CASE WHEN UPPER(A.NATION_CODE) = 'KR'	THEN '1' ELSE '9' END)							AS FORIGN		--	C10. 내ㆍ외국인
				 , UPPER(ISNULL(A.DWELLING_CODE, A.NATION_CODE))																AS LIVE_CODE	--	C11. 거주지국코드
				 , SUBSTRING(C.SUPP_DATE , 1, 4)																				AS SUPP_YEAR	--	C12. 지급연도
				 , SUBSTRING(C.PAY_YYYYMM, 1, 4)																				AS PAY_YEAR		--	C13. 소득귀속연도
				 , SUM(C.PAY_AMOUNT_I)																							AS PAY_AMOUNT_I	--	C14. 지급총액
				 , CONVERT(CHAR(21)  , '')																						AS C_SPACE		--	C15. 공란
			FROM				HPB100T	A WITH (NOLOCK)
					INNER JOIN	BOR120T	B WITH (NOLOCK)  ON	B.COMP_CODE   = A.COMP_CODE
														AND B.DIV_CODE    = A.SECT_CODE
					INNER JOIN	HPB200T	C WITH (NOLOCK)  ON	C.COMP_CODE   = A.COMP_CODE
														AND C.PERSON_NUMB = A.PERSON_NUMB
														AND C.DED_TYPE    = A.DED_TYPE
			WHERE  A.COMP_CODE	 = @COMP_CODE
			AND    A.SECT_CODE	 = @DIV_CODE
			AND    LEFT(C.PAY_YYYYMM, 4) = @YEAR_YYYY
            AND  ((@HALF_YEAR    = '1' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '01' AND @YEAR_YYYY + '06') OR
                  (@HALF_YEAR    = '2' AND LEFT(C.SUPP_DATE, 6) BETWEEN @YEAR_YYYY + '07' AND @YEAR_YYYY + '12'))
			AND    A.DWELLING_YN = '2'
			AND    A.DED_TYPE	 = '1'
			AND    A.BUSINESS_TYPE != '1'
			GROUP  BY A.SECT_CODE
				 , B.SAFFER_TAX
				 , B.COMPANY_NUM																												--	C5 . 사업자등록번호
				 , C.DED_CODE
				 , A.COMP_ENG_NAME
				 , A.ENG_NAME
				 , A.BUSINESS_TYPE
				 , A.DED_CODE
				 , A.COMP_NUM
				 , A.FOREIGN_YN
				 , uniLITE.fnCipherDecrypt(A.REPRE_NUM  , '')
				 , uniLITE.fnCipherDecrypt(A.FOREIGN_NUM, '')
				 , A.RECOGN_NUM
				 , A.COMP_ENG_ADDR
				 , A.ENG_ADDR
				 , A.NATION_CODE
				 , A.DWELLING_CODE
				 , SUBSTRING(C.SUPP_DATE , 1, 4)
				 , SUBSTRING(C.PAY_YYYYMM, 1, 4)
			ORDER  BY A.SECT_CODE
		    
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

</mapper>

	