<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hpa970rkrServiceImpl">
	<select id="hpa970rkrServiceImpl.selectList" parameterType="Map" resultType="rMap">
			--hpa970rkr.Chpa970rkr [fnHpa970P] 
DECLARE   @ISSU_DIVI     NVARCHAR(01)   -- 발급구분(0:회사발급용, 1:세무대리용)
    SET   @ISSU_DIVI   = '0'

SELECT MONTH_01
	 , MONTH_02
	 , MONTH_03
	 , MONTH_04
	 , MONTH_05
	 , MONTH_06
	 , MONTH_07
	 , MONTH_08
	 , MONTH_09
	 , MONTH_10
	 , MONTH_11
	 , MONTH_12
	 , DED_AMONT_01
	 , DED_AMONT_02
	 , DED_AMONT_03
	 , DED_AMONT_04
	 , DED_AMONT_05
	 , DED_AMONT_06
	 , DED_AMONT_07
	 , DED_AMONT_08
	 , DED_AMONT_09
	 , DED_AMONT_10
	 , DED_AMONT_11
	 , DED_AMONT_12
	 , PAY_YYYYMM_01
	 , PAY_YYYYMM_02
	 , PAY_YYYYMM_03
	 , PAY_YYYYMM_04
	 , PAY_YYYYMM_05
	 , PAY_YYYYMM_06
	 , PAY_YYYYMM_07
	 , PAY_YYYYMM_08
	 , PAY_YYYYMM_09
	 , PAY_YYYYMM_10
	 , PAY_YYYYMM_11
	 , PAY_YYYYMM_12
	 , SUPP_DATE_01
	 , SUPP_DATE_02
	 , SUPP_DATE_03
	 , SUPP_DATE_04
	 , SUPP_DATE_05
	 , SUPP_DATE_06
	 , SUPP_DATE_07
	 , SUPP_DATE_08
	 , SUPP_DATE_09
	 , SUPP_DATE_10
	 , SUPP_DATE_11
	 , SUPP_DATE_12
	 , Y.DIV_FULL_NAME AS DIV_NAME	
	 , H.NAME   
     , unilite.fnCipherDecrypt(H.REPRE_NUM, 'A') AS REPRE_NUM
	 , H.KOR_ADDR      
	 , SUBSTRING(Y.COMPANY_NUM,1,3) +'-'+ 
	   SUBSTRING(Y.COMPANY_NUM,4,2) +'-'+
	   SUBSTRING(Y.COMPANY_NUM,6,5) AS COMPANY_NUM
     , Y.ADDR
	 , Y.REPRE_NAME
	 , Z.COMP_OWN_NO
	 , Y.TELEPHON
     , (CASE WHEN @ISSU_DIVI = '1' THEN Y.TAX_NAME ELSE ''         END) TAX_NAME
     , (CASE WHEN @ISSU_DIVI = '1' THEN SUBSTRING(Y.TAX_NUM,1,3) +'-'+ 
	                                    SUBSTRING(Y.TAX_NUM,4,2) +'-'+
										SUBSTRING(Y.TAX_NUM,6,5)   
			 ELSE ''         
	     END)                                                           TAX_NUM
     , (CASE WHEN @ISSU_DIVI = '1' THEN Y.TAX_TEL  ELSE Y.TELEPHON END) TAX_TEL
     , (CASE WHEN @ISSU_DIVI = '1' THEN Y.TAX_ADDR ELSE Y.ADDR     END) TAX_ADDR 

  FROM (SELECT MAX(T2.PAY_YYYYMM_01) AS PAY_YYYYMM_01
		     , MAX(T2.PAY_YYYYMM_02) AS PAY_YYYYMM_02
		     , MAX(T2.PAY_YYYYMM_03) AS PAY_YYYYMM_03
		     , MAX(T2.PAY_YYYYMM_04) AS PAY_YYYYMM_04
		     , MAX(T2.PAY_YYYYMM_05) AS PAY_YYYYMM_05
		     , MAX(T2.PAY_YYYYMM_06) AS PAY_YYYYMM_06
		     , MAX(T2.PAY_YYYYMM_07) AS PAY_YYYYMM_07
		     , MAX(T2.PAY_YYYYMM_08) AS PAY_YYYYMM_08
		     , MAX(T2.PAY_YYYYMM_09) AS PAY_YYYYMM_09
		     , MAX(T2.PAY_YYYYMM_10) AS PAY_YYYYMM_10
		     , MAX(T2.PAY_YYYYMM_11) AS PAY_YYYYMM_11
		     , MAX(T2.PAY_YYYYMM_12) AS PAY_YYYYMM_12
		     , SUM(T2.MONTH_01)      AS MONTH_01
		     , SUM(T2.MONTH_02)      AS MONTH_02
		     , SUM(T2.MONTH_03)      AS MONTH_03
		     , SUM(T2.MONTH_04)      AS MONTH_04
		     , SUM(T2.MONTH_05)      AS MONTH_05
		     , SUM(T2.MONTH_06)      AS MONTH_06
		     , SUM(T2.MONTH_07)      AS MONTH_07
		     , SUM(T2.MONTH_08)      AS MONTH_08
		     , SUM(T2.MONTH_09)      AS MONTH_09
		     , SUM(T2.MONTH_10)      AS MONTH_10
		     , SUM(T2.MONTH_11)      AS MONTH_11
		     , SUM(T2.MONTH_12)      AS MONTH_12
		     , SUM(T2.DED_AMOUNT_01) AS DED_AMONT_01 
		     , SUM(T2.DED_AMOUNT_02) AS DED_AMONT_02
		     , SUM(T2.DED_AMOUNT_03) AS DED_AMONT_03
		     , SUM(T2.DED_AMOUNT_04) AS DED_AMONT_04
		     , SUM(T2.DED_AMOUNT_05) AS DED_AMONT_05
		     , SUM(T2.DED_AMOUNT_06) AS DED_AMONT_06
		     , SUM(T2.DED_AMOUNT_07) AS DED_AMONT_07
		     , SUM(T2.DED_AMOUNT_08) AS DED_AMONT_08
		     , SUM(T2.DED_AMOUNT_09) AS DED_AMONT_09
		     , SUM(T2.DED_AMOUNT_10) AS DED_AMONT_10
		     , SUM(T2.DED_AMOUNT_11) AS DED_AMONT_11
		     , SUM(T2.DED_AMOUNT_12) AS DED_AMONT_12
		     , MAX(T2.SUPP_DATE_01)  AS SUPP_DATE_01
		     , MAX(T2.SUPP_DATE_02)  AS SUPP_DATE_02
		     , MAX(T2.SUPP_DATE_03)  AS SUPP_DATE_03
		     , MAX(T2.SUPP_DATE_04)  AS SUPP_DATE_04
		     , MAX(T2.SUPP_DATE_05)  AS SUPP_DATE_05
		     , MAX(T2.SUPP_DATE_06)  AS SUPP_DATE_06
		     , MAX(T2.SUPP_DATE_07)  AS SUPP_DATE_07
		     , MAX(T2.SUPP_DATE_08)  AS SUPP_DATE_08
		     , MAX(T2.SUPP_DATE_09)  AS SUPP_DATE_09
		     , MAX(T2.SUPP_DATE_10)  AS SUPP_DATE_10
		     , MAX(T2.SUPP_DATE_11)  AS SUPP_DATE_11
		     , MAX(T2.SUPP_DATE_12)  AS SUPP_DATE_12
		     , T2.COMP_CODE
		     , T2.PERSON_NUMB
	      FROM (SELECT (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '01' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_01
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '02' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_02
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '03' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_03
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '04' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_04
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '05' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_05
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '06' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_06
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '07' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_07
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '08' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_08
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '09' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_09
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '10' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_10
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '11' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_11
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '12' THEN T1.PAY_YYYYMM   ELSE '' END) PAY_YYYYMM_12
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '01' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_01
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '02' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_02
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '03' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_03
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '04' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_04
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '05' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_05
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '06' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_06
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '07' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_07
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '08' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_08
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '09' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_09
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '10' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_10
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '11' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_11
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '12' THEN T1.SUPP_TOTAL_I ELSE 0  END) MONTH_12
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '01' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_01
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '02' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_02
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '03' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_03
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '04' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_04
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '05' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_05
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '06' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_06
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '07' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_07
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '08' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_08
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '09' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_09
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '10' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_10
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '11' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_11
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '12' THEN T1.DED_AMOUNT_I ELSE 0  END) DED_AMOUNT_12
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '01' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_01
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '02' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_02
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '03' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_03
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '04' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_04
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '05' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_05
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '06' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_06
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '07' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_07
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '08' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_08
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '09' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_09
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '10' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_10
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '11' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_11
 	   	 		     , (CASE WHEN RIGHT (T1.PAY_YYYYMM_ORDER, 2) = '12' THEN T1.SUPP_DATE    ELSE '' END) SUPP_DATE_12
	   	 		     , T1.COMP_CODE
	   	 		     , T1.PERSON_NUMB
 	   	 	      FROM ( SELECT A.COMP_CODE
	   	 	   	 		      , A.PERSON_NUMB
	   	 	   	 		      , uniLITE.fnGetUserDateComp(A.COMP_CODE, A.PAY_YYYYMM) AS PAY_YYYYMM
 	     	   	 			  , A.SUPP_TOTAL_I
 	     	   	 			  , B.DED_AMOUNT_I
 	     	   	 			  , uniLITE.fnGetUserDateComp(A.COMP_CODE, A.SUPP_DATE) AS SUPP_DATE
 	     	   	 			  , '0'+ CONVERT(NVARCHAR(02),ROW_NUMBER() OVER(ORDER BY A.PAY_YYYYMM)) AS PAY_YYYYMM_ORDER
 	   	 	   	 	       FROM  (SELECT COMP_CODE
 	     	   	 	   	 			   , PERSON_NUMB
 	     	   	 	   	 			   , PAY_YYYYMM
 	     	   	 	   	 			   , SUM(SUPP_TOTAL_I) AS SUPP_TOTAL_I
 	     	   	 	   	 			   , MAX(SUPP_DATE)    AS SUPP_DATE
 	     	   	 	   	 		    FROM HPA600T WITH(NOLOCK)
 	     	   	 	   	 		   WHERE COMP_CODE   = #{S_COMP_CODE}
 	     	   	 	   	 		 	 AND PERSON_NUMB = #{PERSON_NUMB}
 	     	   	 	   	 		 	 AND PAY_YYYYMM &gt;= #{DATE_FR} 
 	     	   	 	   	 		 	 AND PAY_YYYYMM &lt;= #{DATE_TO}
 	     	   	 	   	 		   GROUP BY COMP_CODE, PERSON_NUMB, PAY_YYYYMM
 	     	   	 	   	 		) AS A INNER JOIN ( SELECT COMP_CODE
 	     	   	 	   	 								 , PERSON_NUMB
 	     	   	 	   	 								 , PAY_YYYYMM
 	     	   	 	   	 								 , SUM(DED_AMOUNT_I) AS DED_AMOUNT_I 
 	     	   	 	   	 							  FROM HPA400T WITH (NOLOCK)
 	     	   	 	   	 							 WHERE COMP_CODE   = #{S_COMP_CODE}
 	     	   	 	   	 							   AND PERSON_NUMB = #{PERSON_NUMB}
 	     	   	 	   	 							   AND PAY_YYYYMM &gt;= #{DATE_FR} 
 	     	   	 	   	 							   AND PAY_YYYYMM &lt;= #{DATE_TO}
 	     	   	 	   	 							   AND DED_CODE   = 'INC'
 	     	   	 	   	 							 GROUP BY COMP_CODE, PERSON_NUMB, PAY_YYYYMM
 	     	   	 	   	 						  ) AS B  ON A.COMP_CODE   = B.COMP_CODE
 	     	   	 	   	 								 AND A.PERSON_NUMB = B.PERSON_NUMB
 	                                  					 AND A.PAY_YYYYMM  = B.PAY_YYYYMM
 	   	 	   	 	      WHERE A.COMP_CODE   = #{S_COMP_CODE}
 	   	 	   	 	        AND A.PERSON_NUMB = #{PERSON_NUMB}
 	   	 	   	 	        AND A.PAY_YYYYMM &gt;= #{DATE_FR} 
 	   	 	   	 	        AND A.PAY_YYYYMM &lt;= #{DATE_TO}
 	   	 	   	 ) AS T1
 	   	    ) AS T2
	   	 GROUP BY T2.COMP_CODE, T2.PERSON_NUMB
	 ) AS T3 	 
	INNER JOIN HUM100T AS H WITH (NOLOCK) ON H.COMP_CODE   = T3.COMP_CODE
	                                     AND H.PERSON_NUMB = T3.PERSON_NUMB
    INNER JOIN BOR120T AS Y WITH (NOLOCK) ON Y.COMP_CODE   = H.COMP_CODE
	                                     AND Y.DIV_CODE    = H.SECT_CODE
	INNER JOIN BOR100T AS Z WITH (NOLOCK) ON Z.COMP_CODE   = H.COMP_CODE
WHERE H.COMP_CODE   = #{S_COMP_CODE}
  AND H.PERSON_NUMB = #{PERSON_NUMB}






       







	</select>

</mapper>