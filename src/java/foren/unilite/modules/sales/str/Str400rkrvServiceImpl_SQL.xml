<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="str400rkrvServiceImpl">
	<select id="str400rkrvServiceImpl.mainReport" parameterType="Map" resultType="rMap">
		/* str400rkrv.Cstr400rkrv[fnstr400np] Query01 mainReport*/
		 BEGIN
		IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE ID=object_id('tempdb..#STR400RKR_TMP_080913'))
		    DROP TABLE #STR400RKR_TMP_080913
		
		DECLARE @COMP_CODE     NVARCHAR(08)   /* (필수)법인코드 */
		      , @INOUT_DATE    NVARCHAR(08)   /* (선택)출고일 */
		      , @DIV_CODE      NVARCHAR(08)   /* (필수)사업장 */
		      , @WH_CODE       NVARCHAR(08)   /* (선택)출고창고 */
		      , @INOUT_NUM     NVARCHAR(20)  /* (선택)출고번호 */
		      , @AGENT_TYPE    NVARCHAR(08)   /* (선택)고객분류 */
		      , @AREA_TYPE     NVARCHAR(03)   /* (선택)지역 */
		      , @CUSTOM_CODE   NVARCHAR(08)   /* (선택)고객 */
		      , @CUSTOM_NAME   NVARCHAR(20)   /* (선택)고객명 */
		      , @USER_ID       NVARCHAR(100)   /* (필수)사용자ID */
		      , @TodayDate     NVARCHAR(08)   /* 현재일자 */
		
		SET     @COMP_CODE   = N'MASTER'
		SET     @INOUT_DATE  = N''
		SET     @DIV_CODE    = N'01'
		SET     @WH_CODE     = N''
		SET     @INOUT_NUM   = N''
		SET     @AGENT_TYPE  = N''
		SET     @AREA_TYPE   = N''
		SET     @CUSTOM_CODE = N''
		SET     @CUSTOM_NAME = N''
		SET     @USER_ID     = N''
		
		SELECT @TodayDate = CONVERT(NVARCHAR(08), GETDATE(), 112)
		
		SELECT A.COMP_CODE
		     , A.INOUT_NUM
		     , A.INOUT_SEQ
		     , A.INOUT_TYPE
		     , A.DIV_CODE
		     , A.INOUT_DATE
		     /* 공급자정보 */
		     , E.DIV_CODE    AS MY_CUSTOM_CODE
		     , E.DIV_NAME    AS MY_CUSTOM_NAME
		     , E.REPRE_NAME  AS MY_TOP_NAME
			 , E.TELEPHON	AS MY_PHONE
		     , CASE ISNULL(E.COMPANY_NUM,'')
		            WHEN '' THEN ''
		            ELSE         SUBSTRING(E.COMPANY_NUM,1,3) + '-'
		                       + SUBSTRING(E.COMPANY_NUM,4,2) + '-'
		                       + SUBSTRING(E.COMPANY_NUM,6,5)
		        END          AS MY_COMPANY_NUM
		     , E.ZIP_CODE    AS MY_ZIP_CODE
		     , E.ADDR        AS MY_ADDR
		     /* 공급받는자정보 */
		     , B.CUSTOM_CODE
		     , B.CUSTOM_NAME AS CUSTOM_NAME
		     , B.TOP_NAME
			 , B.TELEPHON AS CUSTOM_TELE
		     , CASE ISNULL(B.COMPANY_NUM,'')
		            WHEN '' THEN ''
		            ELSE         SUBSTRING(B.COMPANY_NUM,1,3) + '-'
		                       + SUBSTRING(B.COMPANY_NUM,4,2) + '-'
		                       + SUBSTRING(B.COMPANY_NUM,6,5)
		        END AS COMPANY_NUM
		     , B.ZIP_CODE
		     , RTRIM(ISNULL(B.ADDR1,'') + ISNULL(B.ADDR2,'')) AS ADDR
		     /* 거래품목정보 */
		     , CASE ISNULL(CC.CUSTOM_ITEM_CODE, '')
		            WHEN '' THEN A.ITEM_CODE
		            ELSE         CC.CUSTOM_ITEM_CODE
		        END AS ITEM_CODE
		     , CASE ISNULL(CC.CUSTOM_ITEM_NAME, '')
		            WHEN '' THEN uniLITE.fnItemNameComp(C.COMP_CODE, @USER_ID, C.ITEM_CODE)
		            ELSE         CC.CUSTOM_ITEM_NAME
		        END AS ITEM_NAME
		     , CASE ISNULL(CC.CUSTOM_ITEM_SPEC, '')
		            WHEN '' THEN (SELECT SPEC
		                            FROM BPR100T
		                           WHERE COMP_CODE = A.COMP_CODE
		                             AND ITEM_CODE = A.ITEM_CODE)
		            ELSE         CC.CUSTOM_ITEM_SPEC
		        END AS SPEC
		     , A.ORDER_UNIT
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_Q
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_Q  * (-1)
		         END) AS ORDER_UNIT_Q
		     , A.ORDER_UNIT_P
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_O
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_O  * (-1)
		         END) AS ORDER_UNIT_O
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.INOUT_TAX_AMT
		             WHEN A.INOUT_TYPE = '3' THEN A.INOUT_TAX_AMT * (-1)
		         END) AS INOUT_TAX_AMT
		     , A.TAX_TYPE
		     , ISNULL(A.DISCOUNT_RATE, 0)  AS DISCOUNT_RATE
		     , A.DVRY_CUST_CD
		     , ISNULL(D.DVRY_CUST_NM,' ')  AS DVRY_CUST_NM
		     , ISNULL(D.DVRY_CUST_TEL,' ') AS DVRY_CUST_TEL
		     , ISNULL(D.DVRY_CUST_ADD,' ') AS DVRY_CUST_ADD
		     , CONVERT(NUMERIC(18,0),0)    AS GUBUN
		     , CONVERT(NUMERIC(18,0),0)    AS l_PAGE
		     , CONVERT(NUMERIC(6,0),0)     AS N_PAGE
		     , CONVERT(NUMERIC(6,0),0)     AS MAX_PAGE
		     , (SELECT SUM(ORDER_UNIT_Q) FROM BTR100T S1 WHERE S1.INOUT_NUM = A.INOUT_NUM) AS SUM_Q
			 , (SELECT SUM(ORDER_UNIT_O) FROM BTR100T S1 WHERE S1.INOUT_NUM = A.INOUT_NUM) AS SUM_O
			 , (SELECT SUM(INOUT_TAX_AMT) FROM BTR100T S1 WHERE S1.INOUT_NUM = A.INOUT_NUM) AS SUM_TAX
		     , CONVERT(NUMERIC(4,0),0)     AS G_REC
		     /* 공급자용:1 / 공급받는자용:2 */
		     ,'1'                          AS G_SUPP
			 , G.CODE_NAME AS BANK_ACCNT_CODE
		     , G.REF_CODE1    AS BANK_NAME  
		  INTO #STR400RKR_TMP_080913
		  FROM            BTR100T A  WITH (NOLOCK)
		       INNER JOIN BCM100T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                          AND B.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		       INNER JOIN BPR200T C  WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE
		                                          AND C.DIV_CODE    = A.DIV_CODE
		                                          AND C.ITEM_CODE   = A.ITEM_CODE
		       LEFT  JOIN BPR300T CC WITH (NOLOCK) ON CC.TYPE            = '2'
		                                          --20190821 '*' -> IN('*', @DIV_CODE)로 변경
		                                          AND CC.DIV_CODE        IN ('*', @DIV_CODE)
		                                          AND CC.COMP_CODE       = A.COMP_CODE
		                                          AND CC.CUSTOM_CODE     = A.INOUT_CODE
		                                          AND CC.ITEM_CODE       = A.ITEM_CODE
		                                          AND CC.APLY_START_DATE = (SELECT MAX(APLY_START_DATE)
		                                                                      FROM BPR300T WITH (NOLOCK)
		                                                                     WHERE COMP_CODE        = CC.COMP_CODE
		                                                                       AND TYPE             = CC.TYPE
		                                                                       AND DIV_CODE         = CC.DIV_CODE
		                                                                       AND ITEM_CODE        = CC.ITEM_CODE
		                                                                       AND CUSTOM_CODE      = CC.CUSTOM_CODE
		                                                                       AND APLY_START_DATE &lt;= @TodayDate)
		       LEFT  JOIN (SELECT DD.COMP_CODE
		                        , DD.CUSTOM_CODE
		                        , CONVERT(NVARCHAR(8), DD.DVRY_CUST_SEQ) AS DVRY_CUST_SEQ
		                        , DD.DVRY_CUST_NM
		                        , MAX(DD.DVRY_CUST_TEL)                  AS DVRY_CUST_TEL
		                        , DD.DVRY_CUST_ADD
		                     FROM SCM100T DD WITH (NOLOCK)
		                    WHERE DD.COMP_CODE  = @COMP_CODE
		                    GROUP BY DD.COMP_CODE   , DD.CUSTOM_CODE, DD.DVRY_CUST_SEQ
		                           , DD.DVRY_CUST_NM, DD.DVRY_CUST_ADD) D ON D.COMP_CODE     = A.COMP_CODE
		                                                                 AND D.DVRY_CUST_SEQ = A.DVRY_CUST_CD
		                                                                 AND D.CUSTOM_CODE   = A.INOUT_CODE
		       INNER JOIN BOR120T E  WITH (NOLOCK) ON E.COMP_CODE   = A.COMP_CODE
		                                          AND E.DIV_CODE    = A.DIV_CODE
		       INNER JOIN BCM100T F  WITH (NOLOCK) ON F.COMP_CODE   = A.COMP_CODE
		                                          AND F.CUSTOM_CODE = A.INOUT_CODE
			   LEFT JOIN BSA100T G  WITH (NOLOCK) ON G.COMP_CODE   = A.COMP_CODE                                                                
				                                          AND G.MAIN_CODE    = 'S041' 
														  AND G.SUB_CODE     = '01'  
		 WHERE A.CREATE_LOC              =    '1'
		   AND A.COMP_CODE               =    @COMP_CODE
		   AND A.DIV_CODE                =    @DIV_CODE
		   AND ((A.INOUT_DATE            =    @INOUT_DATE        AND @INOUT_DATE  &lt;&gt; '') OR (@INOUT_DATE  = ''))
		   AND ((A.WH_CODE               =    @WH_CODE           AND @WH_CODE     &lt;&gt; '') OR (@WH_CODE     = ''))
		   AND ((A.INOUT_NUM             LIKE @INOUT_NUM + '%'   AND @INOUT_NUM   &lt;&gt; '') OR (@INOUT_NUM   = ''))
		   AND ((F.AGENT_TYPE            =    @AGENT_TYPE        AND @AGENT_TYPE  &lt;&gt; '') OR (@AGENT_TYPE  = ''))
		   AND ((ISNULL(F.AREA_TYPE,'')  =    @AREA_TYPE         AND @AREA_TYPE   &lt;&gt; '') OR (@AREA_TYPE   = ''))
		   AND ((A.INOUT_CODE            LIKE @CUSTOM_CODE + '%' AND @CUSTOM_CODE &lt;&gt; '') OR (@CUSTOM_CODE = ''))
		   AND ((F.CUSTOM_NAME           LIKE @CUSTOM_NAME + '%' AND @CUSTOM_NAME &lt;&gt; '') OR (@CUSTOM_NAME = ''))
		   AND A.INOUT_TYPE              IN ('2', '3')
		ORDER BY B.CUSTOM_CODE, A.INOUT_NUM, A.INOUT_SEQ
		
		SELECT DISTINCT INOUT_NUM, INOUT_DATE
		     , MY_CUSTOM_CODE, MY_CUSTOM_NAME, MY_TOP_NAME , MY_COMPANY_NUM, MY_PHONE,MY_ZIP_CODE, MY_ADDR
		     , CUSTOM_CODE   , CUSTOM_NAME   , TOP_NAME    , COMPANY_NUM  ,CUSTOM_TELE , ZIP_CODE   , ADDR , SUM_Q , SUM_O, SUM_TAX, SUM_O + SUM_TAX AS TOT_O, BANK_ACCNT_CODE, BANK_NAME
		 FROM #STR400RKR_TMP_080913
		 where inout_date &gt; '201401'
		 END
 
	</select>

	<select id="str400rkrvServiceImpl.subReport" parameterType="Map" resultType="rMap">
		/* str400rkrv.Cstr400rkrv[fnstr400np] Query01 subReport*/
		BEGIN
		IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE ID=object_id('tempdb..#STR400RKR_TMP_080913'))
		    DROP TABLE #STR400RKR_TMP_080913
		
		DECLARE @COMP_CODE     NVARCHAR(08)   /* (필수)법인코드 */
		      , @INOUT_DATE    NVARCHAR(08)   /* (선택)출고일 */
		      , @DIV_CODE      NVARCHAR(08)   /* (필수)사업장 */
		      , @WH_CODE       NVARCHAR(08)   /* (선택)출고창고 */
		      , @INOUT_NUM     NVARCHAR(20)  /* (선택)출고번호 */
		      , @AGENT_TYPE    NVARCHAR(08)   /* (선택)고객분류 */
		      , @AREA_TYPE     NVARCHAR(03)   /* (선택)지역 */
		      , @CUSTOM_CODE   NVARCHAR(08)   /* (선택)고객 */
		      , @CUSTOM_NAME   NVARCHAR(20)   /* (선택)고객명 */
		      , @USER_ID       NVARCHAR(100)   /* (필수)사용자ID */
		      , @TodayDate     NVARCHAR(08)   /* 현재일자 */
		
		SET     @COMP_CODE   = N'MASTER'
		SET     @INOUT_DATE  = N''
		SET     @DIV_CODE    = N'01'
		SET     @WH_CODE     = N''
		SET     @INOUT_NUM   = N''
		SET     @AGENT_TYPE  = N''
		SET     @AREA_TYPE   = N''
		SET     @CUSTOM_CODE = N''
		SET     @CUSTOM_NAME = N''
		SET     @USER_ID     = N''
		
		SELECT @TodayDate = CONVERT(NVARCHAR(08), GETDATE(), 112)
		
		SELECT A.COMP_CODE
		     , A.INOUT_NUM
		     , A.INOUT_SEQ
		     , A.INOUT_TYPE
		     , A.DIV_CODE
		     , A.INOUT_DATE
		     /* 공급자정보 */
		     , E.DIV_CODE    AS MY_CUSTOM_CODE
		     , E.DIV_NAME    AS MY_CUSTOM_NAME
		     , E.REPRE_NAME  AS MY_TOP_NAME
		     , CASE ISNULL(E.COMPANY_NUM,'')
		            WHEN '' THEN ''
		            ELSE         SUBSTRING(E.COMPANY_NUM,1,3) + '-'
		                       + SUBSTRING(E.COMPANY_NUM,4,2) + '-'
		                       + SUBSTRING(E.COMPANY_NUM,6,5)
		        END          AS MY_COMPANY_NUM
		     , E.ZIP_CODE    AS MY_ZIP_CODE
		     , E.ADDR        AS MY_ADDR
		     /* 공급받는자정보 */
		     , B.CUSTOM_CODE
		     , B.CUSTOM_NAME AS CUSTOM_NAME
		     , B.TOP_NAME
		     , CASE ISNULL(B.COMPANY_NUM,'')
		            WHEN '' THEN ''
		            ELSE         SUBSTRING(B.COMPANY_NUM,1,3) + '-'
		                       + SUBSTRING(B.COMPANY_NUM,4,2) + '-'
		                       + SUBSTRING(B.COMPANY_NUM,6,5)
		        END AS COMPANY_NUM
		     , B.ZIP_CODE
		     , RTRIM(ISNULL(B.ADDR1,'') + ISNULL(B.ADDR2,'')) AS ADDR
		     /* 거래품목정보 */
		     , CASE ISNULL(CC.CUSTOM_ITEM_CODE, '')
		            WHEN '' THEN A.ITEM_CODE
		            ELSE         CC.CUSTOM_ITEM_CODE
		        END AS ITEM_CODE
		     , CASE ISNULL(CC.CUSTOM_ITEM_NAME, '')
		            WHEN '' THEN uniLITE.fnItemNameComp(C.COMP_CODE, @USER_ID, C.ITEM_CODE)
		            ELSE         CC.CUSTOM_ITEM_NAME
		        END AS ITEM_NAME
		     , CASE ISNULL(CC.CUSTOM_ITEM_SPEC, '')
		            WHEN '' THEN (SELECT SPEC
		                            FROM BPR100T
		                           WHERE COMP_CODE = A.COMP_CODE
		                             AND ITEM_CODE = A.ITEM_CODE)
		            ELSE         CC.CUSTOM_ITEM_SPEC
		        END AS SPEC
		     , A.ORDER_UNIT
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_Q
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_Q  * (-1)
		         END) AS ORDER_UNIT_Q
		     , A.ORDER_UNIT_P
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_O
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_O  * (-1)
		         END) AS ORDER_UNIT_O
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.INOUT_TAX_AMT
		             WHEN A.INOUT_TYPE = '3' THEN A.INOUT_TAX_AMT * (-1)
		         END) AS INOUT_TAX_AMT
		     , A.TAX_TYPE
		     , ISNULL(A.DISCOUNT_RATE, 0)  AS DISCOUNT_RATE
		     , A.DVRY_CUST_CD
		     , ISNULL(D.DVRY_CUST_NM,' ')  AS DVRY_CUST_NM
		     , ISNULL(D.DVRY_CUST_TEL,' ') AS DVRY_CUST_TEL
		     , ISNULL(D.DVRY_CUST_ADD,' ') AS DVRY_CUST_ADD
		     , CONVERT(NUMERIC(18,0),0)    AS GUBUN
		     , CONVERT(NUMERIC(18,0),0)    AS l_PAGE
		     , CONVERT(NUMERIC(6,0),0)     AS N_PAGE
		     , CONVERT(NUMERIC(6,0),0)     AS MAX_PAGE
		     , CONVERT(NUMERIC(18,6),0)    AS SUM_Q
		     , CONVERT(NUMERIC(18,4),0)    AS SUM_O
		     , CONVERT(NUMERIC(18,4),0)    AS SUM_TAX
		     , CONVERT(NUMERIC(4,0),0)     AS G_REC
		     /* 공급자용:1 / 공급받는자용:2 */
		     ,'1'                          AS G_SUPP
		  INTO #STR400RKR_TMP_080913
		  FROM            BTR100T A  WITH (NOLOCK)
		       INNER JOIN BCM100T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                          AND B.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		       INNER JOIN BPR200T C  WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE
		                                          AND C.DIV_CODE    = A.DIV_CODE
		                                          AND C.ITEM_CODE   = A.ITEM_CODE
		       LEFT  JOIN BPR300T CC WITH (NOLOCK) ON CC.TYPE            = '2'
		                                          --20190821 '*' -> IN('*', @DIV_CODE)로 변경
		                                          AND CC.DIV_CODE        IN ('*', @DIV_CODE)
		                                          AND CC.COMP_CODE       = A.COMP_CODE
		                                          AND CC.CUSTOM_CODE     = A.INOUT_CODE
		                                          AND CC.ITEM_CODE       = A.ITEM_CODE
		                                          AND CC.APLY_START_DATE = (SELECT MAX(APLY_START_DATE)
		                                                                      FROM BPR300T WITH (NOLOCK)
		                                                                     WHERE COMP_CODE        = CC.COMP_CODE
		                                                                       AND TYPE             = CC.TYPE
		                                                                       AND DIV_CODE         = CC.DIV_CODE
		                                                                       AND ITEM_CODE        = CC.ITEM_CODE
		                                                                       AND CUSTOM_CODE      = CC.CUSTOM_CODE
		                                                                       AND APLY_START_DATE &lt;= @TodayDate)
		       LEFT  JOIN (SELECT DD.COMP_CODE
		                        , DD.CUSTOM_CODE
		                        , CONVERT(NVARCHAR(8), DD.DVRY_CUST_SEQ) AS DVRY_CUST_SEQ
		                        , DD.DVRY_CUST_NM
		                        , MAX(DD.DVRY_CUST_TEL)                  AS DVRY_CUST_TEL
		                        , DD.DVRY_CUST_ADD
		                     FROM SCM100T DD WITH (NOLOCK)
		                    WHERE DD.COMP_CODE  = @COMP_CODE
		                    GROUP BY DD.COMP_CODE   , DD.CUSTOM_CODE, DD.DVRY_CUST_SEQ
		                           , DD.DVRY_CUST_NM, DD.DVRY_CUST_ADD) D ON D.COMP_CODE     = A.COMP_CODE
		                                                                 AND D.DVRY_CUST_SEQ = A.DVRY_CUST_CD
		                                                                 AND D.CUSTOM_CODE   = A.INOUT_CODE
		       INNER JOIN BOR120T E  WITH (NOLOCK) ON E.COMP_CODE   = A.COMP_CODE
		                                          AND E.DIV_CODE    = A.DIV_CODE
		       INNER JOIN BCM100T F  WITH (NOLOCK) ON F.COMP_CODE   = A.COMP_CODE
		                                          AND F.CUSTOM_CODE = A.INOUT_CODE
		 WHERE A.CREATE_LOC              =    '1'
		   AND A.COMP_CODE               =    @COMP_CODE
		   AND A.DIV_CODE                =    @DIV_CODE
		   AND ((A.INOUT_DATE            =    @INOUT_DATE        AND @INOUT_DATE  &lt;&gt; '') OR (@INOUT_DATE  = ''))
		   AND ((A.WH_CODE               =    @WH_CODE           AND @WH_CODE     &lt;&gt; '') OR (@WH_CODE     = ''))
		   AND ((A.INOUT_NUM             LIKE @INOUT_NUM + '%'   AND @INOUT_NUM   &lt;&gt; '') OR (@INOUT_NUM   = ''))
		   AND ((F.AGENT_TYPE            =    @AGENT_TYPE        AND @AGENT_TYPE  &lt;&gt; '') OR (@AGENT_TYPE  = ''))
		   AND ((ISNULL(F.AREA_TYPE,'')  =    @AREA_TYPE         AND @AREA_TYPE   &lt;&gt; '') OR (@AREA_TYPE   = ''))
		   AND ((A.INOUT_CODE            LIKE @CUSTOM_CODE + '%' AND @CUSTOM_CODE &lt;&gt; '') OR (@CUSTOM_CODE = ''))
		   AND ((F.CUSTOM_NAME           LIKE @CUSTOM_NAME + '%' AND @CUSTOM_NAME &lt;&gt; '') OR (@CUSTOM_NAME = ''))
		   AND A.INOUT_TYPE              IN ('2', '3')
		ORDER BY B.CUSTOM_CODE, A.INOUT_NUM, A.INOUT_SEQ
		
		SELECT INOUT_NUM, INOUT_DATE
		     , MY_CUSTOM_CODE, MY_CUSTOM_NAME, MY_TOP_NAME , MY_COMPANY_NUM, MY_ZIP_CODE, MY_ADDR
		     , CUSTOM_CODE   , CUSTOM_NAME   , TOP_NAME    , COMPANY_NUM   , ZIP_CODE   , ADDR
		     , INOUT_SEQ     , ITEM_CODE     , ITEM_NAME   , SPEC
		     , ORDER_UNIT    , ORDER_UNIT_Q  , ORDER_UNIT_P, ORDER_UNIT_O  , INOUT_TAX_AMT
		     , TAX_TYPE      , DISCOUNT_RATE , DVRY_CUST_NM, DVRY_CUST_TEL
		     , GUBUN         , l_PAGE        , N_PAGE      , MAX_PAGE      , SUM_Q      , SUM_O, SUM_TAX
		     , DVRY_CUST_CD  , G_REC         , G_SUPP      , DVRY_CUST_ADD
		 FROM #STR400RKR_TMP_080913
		 where inout_date &gt; '201401'
		 END
	</select>

	<select id="str400rkrvServiceImpl.getTransactionReceipt" parameterType="Map" resultType="rMap">
		IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE ID=object_id('tempdb..##STR400RKR_TMP_080913'))
		    DROP TABLE #STR400RKR_TMP_080913
		
		DECLARE @COMP_CODE     NVARCHAR(08)   /* (필수)법인코드 */
		      , @INOUT_DATE    NVARCHAR(08)   /* (선택)출고일 */
		      , @DIV_CODE      NVARCHAR(08)   /* (필수)사업장 */
		      , @WH_CODE       NVARCHAR(08)   /* (선택)출고창고 */
		      , @INOUT_NUM     NVARCHAR(20)  /* (선택)출고번호 */
		      , @AGENT_TYPE    NVARCHAR(08)   /* (선택)고객분류 */
		      , @AREA_TYPE     NVARCHAR(03)   /* (선택)지역 */
		      , @CUSTOM_CODE   NVARCHAR(08)   /* (선택)고객 */
		      , @CUSTOM_NAME   NVARCHAR(20)   /* (선택)고객명 */
		      , @USER_ID       NVARCHAR(100)   /* (필수)사용자ID */
		      , @TodayDate     NVARCHAR(08)   /* 현재일자 */
		
		SET     @COMP_CODE   = N'MASTER'
		SET     @INOUT_DATE  = N''
		SET     @DIV_CODE    = N'01'
		SET     @WH_CODE     = N''
		SET     @INOUT_NUM   = N'01S20140219006'
		SET     @AGENT_TYPE  = N''
		SET     @AREA_TYPE   = N''
		SET     @CUSTOM_CODE = N''
		SET     @CUSTOM_NAME = N''
		SET     @USER_ID     = N''
		
		SELECT @TodayDate = CONVERT(NVARCHAR(08), GETDATE(), 112)
		
		SELECT A.COMP_CODE
		     , A.INOUT_NUM
		     , A.INOUT_SEQ
		     , A.INOUT_TYPE
		     , A.DIV_CODE
		     , A.INOUT_DATE
		     /* 공급자정보 */
		     , E.DIV_CODE    AS MY_CUSTOM_CODE
		     , E.DIV_NAME    AS MY_CUSTOM_NAME
		     , E.REPRE_NAME  AS MY_TOP_NAME
		     , CASE ISNULL(E.COMPANY_NUM,'')
		            WHEN '' THEN ''
		            ELSE         SUBSTRING(E.COMPANY_NUM,1,3) + '-'
		                       + SUBSTRING(E.COMPANY_NUM,4,2) + '-'
		                       + SUBSTRING(E.COMPANY_NUM,6,5)
		        END          AS MY_COMPANY_NUM
		     , E.ZIP_CODE    AS MY_ZIP_CODE
		     , E.ADDR        AS MY_ADDR
		     /* 공급받는자정보 */
		     , B.CUSTOM_CODE
		     , B.CUSTOM_NAME AS CUSTOM_NAME
		     , B.TOP_NAME
		     , CASE ISNULL(B.COMPANY_NUM,'')
		            WHEN '' THEN ''
		            ELSE         SUBSTRING(B.COMPANY_NUM,1,3) + '-'
		                       + SUBSTRING(B.COMPANY_NUM,4,2) + '-'
		                       + SUBSTRING(B.COMPANY_NUM,6,5)
		        END AS COMPANY_NUM
		     , B.ZIP_CODE
		     , RTRIM(ISNULL(B.ADDR1,'') + ISNULL(B.ADDR2,'')) AS ADDR
		     /* 거래품목정보 */
		     , CASE ISNULL(CC.CUSTOM_ITEM_CODE, '')
		            WHEN '' THEN A.ITEM_CODE
		            ELSE         CC.CUSTOM_ITEM_CODE
		        END AS ITEM_CODE
		     , CASE ISNULL(CC.CUSTOM_ITEM_NAME, '')
		            WHEN '' THEN uniLITE.fnItemNameComp(C.COMP_CODE, @USER_ID, C.ITEM_CODE)
		            ELSE         CC.CUSTOM_ITEM_NAME
		        END AS ITEM_NAME
		     , CASE ISNULL(CC.CUSTOM_ITEM_SPEC, '')
		            WHEN '' THEN (SELECT SPEC
		                            FROM BPR100T
		                           WHERE COMP_CODE = A.COMP_CODE
		                             AND ITEM_CODE = A.ITEM_CODE)
		            ELSE         CC.CUSTOM_ITEM_SPEC
		        END AS SPEC
		     , A.ORDER_UNIT
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_Q
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_Q  * (-1)
		         END) AS ORDER_UNIT_Q
		     , A.ORDER_UNIT_P
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_O
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_O  * (-1)
		         END) AS ORDER_UNIT_O
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.INOUT_TAX_AMT
		             WHEN A.INOUT_TYPE = '3' THEN A.INOUT_TAX_AMT * (-1)
		         END) AS INOUT_TAX_AMT
		     , A.TAX_TYPE
		     , ISNULL(A.DISCOUNT_RATE, 0)  AS DISCOUNT_RATE
		     , A.DVRY_CUST_CD
		     , ISNULL(D.DVRY_CUST_NM,' ')  AS DVRY_CUST_NM
		     , ISNULL(D.DVRY_CUST_TEL,' ') AS DVRY_CUST_TEL
		     , ISNULL(D.DVRY_CUST_ADD,' ') AS DVRY_CUST_ADD
		     , CONVERT(NUMERIC(18,0),0)    AS GUBUN
		     , CONVERT(NUMERIC(18,0),0)    AS l_PAGE
		     , CONVERT(NUMERIC(6,0),0)     AS N_PAGE
		     , CONVERT(NUMERIC(6,0),0)     AS MAX_PAGE
		     , CONVERT(NUMERIC(18,6),0)    AS SUM_Q
		     , CONVERT(NUMERIC(18,4),0)    AS SUM_O
		     , CONVERT(NUMERIC(18,4),0)    AS SUM_TAX
		     , CONVERT(NUMERIC(4,0),0)     AS G_REC
		     /* 공급자용:1 / 공급받는자용:2 */
		     ,'1'                          AS G_SUPP
		  INTO #STR400RKR_TMP_080913
		  FROM            BTR100T A  WITH (NOLOCK)
		       INNER JOIN BCM100T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                          AND B.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		       INNER JOIN BPR200T C  WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE
		                                          AND C.DIV_CODE    = A.DIV_CODE
		                                          AND C.ITEM_CODE   = A.ITEM_CODE
		       LEFT  JOIN BPR300T CC WITH (NOLOCK) ON CC.TYPE            = '2'
		                                          --20190821 '*' -> IN('*', @DIV_CODE)로 변경
		                                          AND CC.DIV_CODE        IN ('*', @DIV_CODE)
		                                          AND CC.COMP_CODE       = A.COMP_CODE
		                                          AND CC.CUSTOM_CODE     = A.INOUT_CODE
		                                          AND CC.ITEM_CODE       = A.ITEM_CODE
		                                          AND CC.APLY_START_DATE = (SELECT MAX(APLY_START_DATE)
		                                                                      FROM BPR300T WITH (NOLOCK)
		                                                                     WHERE COMP_CODE        = CC.COMP_CODE
		                                                                       AND TYPE             = CC.TYPE
		                                                                       AND DIV_CODE         = CC.DIV_CODE
		                                                                       AND ITEM_CODE        = CC.ITEM_CODE
		                                                                       AND CUSTOM_CODE      = CC.CUSTOM_CODE
		                                                                       AND APLY_START_DATE &lt;= @TodayDate)
		       LEFT  JOIN (SELECT DD.COMP_CODE
		                        , DD.CUSTOM_CODE
		                        , CONVERT(NVARCHAR(8), DD.DVRY_CUST_SEQ) AS DVRY_CUST_SEQ
		                        , DD.DVRY_CUST_NM
		                        , MAX(DD.DVRY_CUST_TEL)                  AS DVRY_CUST_TEL
		                        , DD.DVRY_CUST_ADD
		                     FROM SCM100T DD WITH (NOLOCK)
		                    WHERE DD.COMP_CODE  = @COMP_CODE
		                    GROUP BY DD.COMP_CODE   , DD.CUSTOM_CODE, DD.DVRY_CUST_SEQ
		                           , DD.DVRY_CUST_NM, DD.DVRY_CUST_ADD) D ON D.COMP_CODE     = A.COMP_CODE
		                                                                 AND D.DVRY_CUST_SEQ = A.DVRY_CUST_CD
		                                                                 AND D.CUSTOM_CODE   = A.INOUT_CODE
		       INNER JOIN BOR120T E  WITH (NOLOCK) ON E.COMP_CODE   = A.COMP_CODE
		                                          AND E.DIV_CODE    = A.DIV_CODE
		       INNER JOIN BCM100T F  WITH (NOLOCK) ON F.COMP_CODE   = A.COMP_CODE
		                                          AND F.CUSTOM_CODE = A.INOUT_CODE
		 WHERE A.CREATE_LOC              =    '1'
		   AND A.COMP_CODE               =    @COMP_CODE
		   AND A.DIV_CODE                =    @DIV_CODE
		   AND ((A.INOUT_DATE            =    @INOUT_DATE        AND @INOUT_DATE  &lt;&gt; '') OR (@INOUT_DATE  = ''))
		   AND ((A.WH_CODE               =    @WH_CODE           AND @WH_CODE     &lt;&gt; '') OR (@WH_CODE     = ''))
		   AND ((A.INOUT_NUM             LIKE @INOUT_NUM + '%'   AND @INOUT_NUM   &lt;&gt; '') OR (@INOUT_NUM   = ''))
		   AND ((F.AGENT_TYPE            =    @AGENT_TYPE        AND @AGENT_TYPE  &lt;&gt; '') OR (@AGENT_TYPE  = ''))
		   AND ((ISNULL(F.AREA_TYPE,'')  =    @AREA_TYPE         AND @AREA_TYPE   &lt;&gt; '') OR (@AREA_TYPE   = ''))
		   AND ((A.INOUT_CODE            LIKE @CUSTOM_CODE + '%' AND @CUSTOM_CODE &lt;&gt; '') OR (@CUSTOM_CODE = ''))
		   AND ((F.CUSTOM_NAME           LIKE @CUSTOM_NAME + '%' AND @CUSTOM_NAME &lt;&gt; '') OR (@CUSTOM_NAME = ''))
		   AND A.INOUT_TYPE              IN ('2', '3')
		ORDER BY B.CUSTOM_CODE, A.INOUT_NUM, A.INOUT_SEQ
		
		
		
		SELECT INOUT_NUM, INOUT_DATE
		     , MY_CUSTOM_CODE, MY_CUSTOM_NAME, MY_TOP_NAME , MY_COMPANY_NUM, MY_ZIP_CODE, MY_ADDR
		     , CUSTOM_CODE   , CUSTOM_NAME   , TOP_NAME    , COMPANY_NUM   , ZIP_CODE   , ADDR
		     , INOUT_SEQ     , ITEM_CODE     , ITEM_NAME   , SPEC
		     , ORDER_UNIT    , ORDER_UNIT_Q  , ORDER_UNIT_P, ORDER_UNIT_O  , INOUT_TAX_AMT
		     , TAX_TYPE      , DISCOUNT_RATE , DVRY_CUST_NM, DVRY_CUST_TEL
		     , GUBUN         , l_PAGE        , N_PAGE      , MAX_PAGE      , SUM_Q      , SUM_O, SUM_TAX
		     , DVRY_CUST_CD  , G_REC         , G_SUPP      , DVRY_CUST_ADD
		 FROM #STR400RKR_TMP_080913
		 where inout_date &gt; '201401'
		 END
 
	</select>

	<select id="str400rkrvServiceImpl.selectPrimaryDataList" parameterType="Map" resultType="rMap">
		/* 고객별 */ 
		BEGIN
			
		DECLARE @TodayDate  NVARCHAR(08)   /*현재일자*/
		SELECT @TodayDate = CONVERT(NVARCHAR(08), GETDATE(), 112)
		
		SELECT 
			  PUBLISHER
			  ,TELEPHON
			  <if test="OUTPUT_CONTROL == &quot;true&quot;"> 	
			  ,SUM((ORDER_UNIT_Q*SALE_BASIS_P)- TOTAL_CASH) OVER(PARTITION BY G_SUPP, INOUT_NUM ORDER BY SORT_SEQ)								AS DISCOUNT_MONEY	/* 할인금액 */
			  ,ROUND(SUM(((ORDER_UNIT_Q*SALE_BASIS_P)- TOTAL_CASH)*100) OVER(PARTITION BY G_SUPP, INOUT_NUM ORDER BY SORT_SEQ) /
			   		 SUM((ORDER_UNIT_Q*SALE_BASIS_P)) OVER(PARTITION BY G_SUPP,INOUT_NUM ORDER BY SORT_SEQ),2) 								AS TOTAL_DISCOUNT_RATE /* 할인율*/
			  , SALE_BASIS_P				/* 정가*/ 
			  , BASIS_RATE  				/* % */
			  , A.ORDER_UNIT_FOR_P			/* 단가 */
			  ,TOTAL_CASH
			  </if>
			  ,COMP_NAME
			  ,COMP_CODE
			  ,INOUT_NUM
			  ,INOUT_SEQ	
			  ,INOUT_TYPE
			  ,DIV_CODE
			  ,INOUT_DATE
			  /*공급자정보*/
			  ,MY_CUSTOM_CODE
			  ,MY_CUSTOM_NAME
			  ,MY_TOP_NAME
			  ,MY_COMPANY_NUM
			  ,MY_ZIP_CODE
			  ,MY_ADDR
			  /*공급받는자정보*/
			  , CUSTOM_CODE
		      ,CUSTOM_NAME
		     , TOP_NAME
		     , COMPANY_NUM
		     , ZIP_CODE
		     , ADDR
		     /*거래품목정보*/
		     , ITEM_CODE
		     , ITEM_NAME
		     , SPEC
		     , ORDER_UNIT
		     , ORDER_UNIT_Q
			 , ORDER_UNIT_P
		     , ORDER_UNIT_O     
		     , INOUT_TAX_AMT   
		     , A.TAX_TYPE
		     , RETURN_NAME      /* 반품처명 */
		     , DISCOUNT_RATE
		     , A.DVRY_CUST_CD
		     , DVRY_CUST_NM
		     , DVRY_CUST_TEL
		     , DVRY_CUST_ADD
		     , l_PAGE
		     , N_PAGE
		     , MAX_PAGE
		     , SUM_Q
		     , SUM_O
		     , SUM_TAX
		     , G_REC
		     , AGENT_TYPE
		     , AREA_TYPE
		     /*공급자용:1 / 공급받는자용:2*/
		     , G_SUPP
			 , GUBUN
			 , AUTHOR1					/*저자*/
			 , SORT_SEQ
		FROM (		
			SELECT 
			     H.PUBLISHER /* 출판사 */
			     ,(CASE WHEN ISNULL(I.TELEPHONE_NO,'') = '' THEN E.TELEPHON
			     		 ELSE I.TELEPHONE_NO
			        END) AS TELEPHON
			     , G.COMP_NAME
			     , A.COMP_CODE
			     , A.INOUT_NUM
			     , ROW_NUMBER() OVER (PARTITION BY Z.GROUP_CODE ORDER BY A.INOUT_NUM) AS INOUT_SEQ	
			     , A.INOUT_TYPE
			     , A.DIV_CODE
			     , A.INOUT_DATE
			     /*공급자정보*/
			     , E.DIV_CODE    AS MY_CUSTOM_CODE
			     , G.COMP_NAME    AS MY_CUSTOM_NAME
			     , E.REPRE_NAME  AS MY_TOP_NAME
			     , CASE ISNULL(E.COMPANY_NUM,'')
			            WHEN '' THEN ''
			            ELSE         SUBSTRING(E.COMPANY_NUM,1,3) + '-'
			                       + SUBSTRING(E.COMPANY_NUM,4,2) + '-'
			                       + SUBSTRING(E.COMPANY_NUM,6,5)
			        END          AS MY_COMPANY_NUM
			     , E.ZIP_CODE    AS MY_ZIP_CODE
			     , E.ADDR        AS MY_ADDR
			     /*공급받는자정보*/
			     , B.CUSTOM_CODE
			     , B.CUSTOM_NAME AS CUSTOM_NAME
			     , B.TOP_NAME
			     , CASE ISNULL(B.COMPANY_NUM,'')
			            WHEN '' THEN ''
			            ELSE         SUBSTRING(B.COMPANY_NUM,1,3) + '-'
			                       + SUBSTRING(B.COMPANY_NUM,4,2) + '-'
			                       + SUBSTRING(B.COMPANY_NUM,6,5)
			        END AS COMPANY_NUM
			     , B.ZIP_CODE
			     , RTRIM(ISNULL(B.ADDR1,'') + ISNULL(B.ADDR2,'')) AS ADDR
			     /*거래품목정보*/
			     , CASE ISNULL(CC.CUSTOM_ITEM_CODE, '')
			            WHEN '' THEN A.ITEM_CODE
			            ELSE         CC.CUSTOM_ITEM_CODE
			        END AS ITEM_CODE
			     , CASE ISNULL(CC.CUSTOM_ITEM_NAME, '')
			            WHEN '' THEN uniLITE.fnItemNameComp(C.COMP_CODE, 'UNILITE5', C.ITEM_CODE)
			            ELSE         CC.CUSTOM_ITEM_NAME
			        END AS ITEM_NAME
			     , CASE ISNULL(CC.CUSTOM_ITEM_SPEC, '')
			            WHEN '' THEN (SELECT SPEC
			                            FROM BPR100T
			                           WHERE COMP_CODE = A.COMP_CODE
			                             AND ITEM_CODE = A.ITEM_CODE)
			            ELSE         CC.CUSTOM_ITEM_SPEC
			        END AS SPEC
			     , A.ORDER_UNIT
			     , SUM((CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_Q
			             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_Q  * (-1)
			         END)) AS ORDER_UNIT_Q
				 , (CASE WHEN 'true' = 'true' THEN								/* 단가/금액 Radio button 처리 */
			     		A.ORDER_UNIT_P
			        WHEN 'true' ='false' THEN 0 END) AS ORDER_UNIT_P
			     , SUM((CASE WHEN 'true' = 'true' THEN
			     		((CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_O
			             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_O  * (-1)
			         END))
			        WHEN 'true' ='false' THEN 0 END)) AS ORDER_UNIT_O
			             
			     , SUM((CASE WHEN 'true' = 'true' THEN
			     		((CASE WHEN A.INOUT_TYPE = '2' THEN A.INOUT_TAX_AMT
			             WHEN A.INOUT_TYPE = '3' THEN A.INOUT_TAX_AMT * (-1)
			         END))
			        WHEN 'true' ='false' THEN 0 END)) AS INOUT_TAX_AMT  
			         
			     , A.TAX_TYPE
			     ,(
				   SELECT CODE_NAME
				   FROM BSA100T
				   WHERE COMP_CODE = A.COMP_CODE
				    AND B.RETURN_CODE = SUB_CODE
				    AND MAIN_CODE = 'YP04'
				  )	AS RETURN_NAME      /* 반품처명 */
			     
				     
				     
		
			     , ISNULL(A.DISCOUNT_RATE, 0)  AS DISCOUNT_RATE
			     , A.DVRY_CUST_CD
			     , ISNULL(D.DVRY_CUST_NM,' ')  AS DVRY_CUST_NM
			     , ISNULL(D.DVRY_CUST_TEL,' ') AS DVRY_CUST_TEL
			     , ISNULL(D.DVRY_CUST_ADD,' ') AS DVRY_CUST_ADD
			     , CONVERT(NUMERIC(18,0),0)    AS l_PAGE
			     , CONVERT(NUMERIC(6,0),0)     AS N_PAGE
			     , CONVERT(NUMERIC(6,0),0)     AS MAX_PAGE
			     , CONVERT(NUMERIC(18,6),0)    AS SUM_Q
			     , CONVERT(NUMERIC(18,4),0)    AS SUM_O
			     , CONVERT(NUMERIC(18,4),0)    AS SUM_TAX
			     , CONVERT(NUMERIC(4,0),0)     AS G_REC
			     , F.AGENT_TYPE
			     , F.AREA_TYPE
			     /*공급자용:1 / 공급받는자용:2*/
			     , Z.GROUP_CODE AS G_SUPP
				 , Z.GROUP_NAME AS GUBUN
				 , H.AUTHOR1					/*저자*/
				 , H.SALE_BASIS_P				/* 정가*/ 
				 , ROUND(A.ORDER_UNIT_FOR_P / H.SALE_BASIS_P,2) * 100   AS BASIS_RATE  		/* % */
				 , A.ORDER_UNIT_FOR_P			/* 단가 */
				 
				 ,SUM((CASE WHEN 'true' = 'true' THEN 	     
					     ((CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_O
					         WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_O  * (-1)
					     END)  
					     + 
					    (CASE WHEN A.INOUT_TYPE = '2' THEN A.INOUT_TAX_AMT
					         WHEN A.INOUT_TYPE = '3' THEN A.INOUT_TAX_AMT * (-1)
					     END)) 
			      WHEN 'true' = 'false' THEN 0 END)) AS TOTAL_CASH
				  ,A.SORT_SEQ
				  
	
				  
				  
				  
			  FROM            BTR100T A  WITH (NOLOCK)
			       INNER JOIN BCM100T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
			                                          AND B.CUSTOM_CODE = A.SALE_CUSTOM_CODE
			       INNER JOIN BPR200T C  WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE
			                                          AND C.DIV_CODE    = A.DIV_CODE
			                                          AND C.ITEM_CODE   = A.ITEM_CODE
			       LEFT  JOIN BPR300T CC WITH (NOLOCK) ON CC.TYPE            = '2'
			                                          --20190821 '*' -> IN('*', @DIV_CODE)로 변경
			                                          AND CC.DIV_CODE        IN ('*', #{DIV_CODE})
			                                          AND CC.COMP_CODE       = A.COMP_CODE
			                                          AND CC.CUSTOM_CODE     = A.INOUT_CODE
			                                          AND CC.ITEM_CODE       = A.ITEM_CODE
			                                          AND CC.APLY_START_DATE = (SELECT MAX(APLY_START_DATE)
			                                                                      FROM BPR300T WITH (NOLOCK)
			                                                                     WHERE COMP_CODE        = CC.COMP_CODE
			                                                                       AND TYPE             = CC.TYPE
			                                                                       AND DIV_CODE         = CC.DIV_CODE
			                                                                       AND ITEM_CODE        = CC.ITEM_CODE
			                                                                       AND CUSTOM_CODE      = CC.CUSTOM_CODE
			                                                                       AND APLY_START_DATE &lt;= @TodayDate)
			       LEFT  JOIN (SELECT DD.COMP_CODE
			                        , DD.CUSTOM_CODE
			                        , CONVERT(NVARCHAR(8), DD.DVRY_CUST_SEQ) AS DVRY_CUST_SEQ
			                        , DD.DVRY_CUST_NM
			                        , MAX(DD.DVRY_CUST_TEL)                  AS DVRY_CUST_TEL
			                        , DD.DVRY_CUST_ADD
			                     FROM SCM100T DD WITH (NOLOCK)
			                    WHERE DD.COMP_CODE  = 'MASTER'
			                    GROUP BY DD.COMP_CODE   , DD.CUSTOM_CODE, DD.DVRY_CUST_SEQ
			                           , DD.DVRY_CUST_NM, DD.DVRY_CUST_ADD) D ON D.COMP_CODE     = A.COMP_CODE
			                                                                 AND D.DVRY_CUST_SEQ = A.DVRY_CUST_CD
			                                                                 AND D.CUSTOM_CODE   = A.INOUT_CODE
			       INNER JOIN BOR120T E  WITH (NOLOCK) ON E.COMP_CODE   = A.COMP_CODE
			                                          AND E.DIV_CODE    = A.DIV_CODE
			       INNER JOIN BCM100T F  WITH (NOLOCK) ON F.COMP_CODE   = A.COMP_CODE
			                                          AND F.CUSTOM_CODE = A.INOUT_CODE
			                                          
			       INNER JOIN BOR100T G  WITH (NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
			       CROSS JOIN (SELECT '1' AS GROUP_CODE, '공급자 보관용'   AS GROUP_NAME
				               UNION ALL
				               SELECT '2' AS GROUP_CODE, '공급받는자 보관용' AS GROUP_NAME) Z
				               
				   INNER JOIN BPR100T H WITH(NOLOCK) ON A.COMP_CODE = H.COMP_CODE
			                     			  		AND A.ITEM_CODE = H.ITEM_CODE 
			                     			  		
			       LEFT  JOIN BSA210T I WITH(NOLOCK) ON A.COMP_CODE = I.COMP_CODE
			       									AND A.DIV_CODE  = I.TYPE_LEVEL
			       									AND A.DEPT_CODE = I.TREE_CODE
				                		       
			                                          
			 WHERE A.COMP_CODE               =    #{COMP_CODE}
			 <if test="@foren.Ognl@isNotEmpty(INOUT_DATE)">
			   AND A.INOUT_DATE				 = 	  #{INOUT_DATE}
			 </if>
			   AND A.CREATE_LOC              =    '1'
			   AND A.INOUT_TYPE              IN ('2', '3')
			   AND A.DIV_CODE                =    #{DIV_CODE}
			 <if test="@foren.Ognl@isNotEmpty(DEPT_CODE)">
			   AND A.DEPT_CODE				 = 	  #{DEPT_CODE}
			 </if>  
		     <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
			   AND A.WH_CODE 				 = 	  #{WH_CODE}
			 </if>
			 <if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">
				   AND  A.INOUT_NUM	 IN
				 <foreach collection="INOUT_NUM" item="item" separator="," close=")" open="(">
		          		 #{item}
		    	 </foreach>
	    	 </if>  
			 <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">  
			   AND F.AGENT_TYPE				 = 	  #{AGENT_TYPE}
			 </if> 
			 <if test="@foren.Ognl@isNotEmpty(AREA_TYPE)">  
			   AND F.AREA_TYPE				 = 	  #{AREA_TYPE}
			 </if> 
			 
			 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			  AND A.INOUT_CODE = #{CUSTOM_CODE}					/* 거래처코드  */
			  </if>
			  <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			  AND A.INOUT_CODE LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
			  </if>
			  <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
			  AND F.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%'	/* 거래처명  */
			  </if>
		  
		  
		  GROUP BY A.SORT_SEQ, I.TELEPHONE_NO,G.COMP_NAME, A.COMP_CODE, A.INOUT_NUM, A.INOUT_TYPE, A.DIV_CODE, A.INOUT_DATE	    
				 , E.DIV_CODE, G.COMP_NAME, E.REPRE_NAME, E.COMPANY_NUM, E.ZIP_CODE, E.ADDR, B.CUSTOM_CODE
			     , B.CUSTOM_NAME, B.TOP_NAME, B.COMPANY_NUM, B.ZIP_CODE, B.ADDR1, B.ADDR2, CC.CUSTOM_ITEM_CODE
			     , A.ITEM_CODE, CC.CUSTOM_ITEM_NAME, C.COMP_CODE, C.ITEM_CODE, CC.CUSTOM_ITEM_SPEC
			     , A.ORDER_UNIT, A.ORDER_UNIT_P, A.TAX_TYPE, A.DISCOUNT_RATE, A.DVRY_CUST_CD
			     , D.DVRY_CUST_NM, D.DVRY_CUST_TEL, D.DVRY_CUST_ADD, F.AGENT_TYPE
			     , F.AREA_TYPE, Z.GROUP_CODE, Z.GROUP_NAME ,B.RETURN_CODE,E.TELEPHON,H.PUBLISHER
			     
			     
			     , H.AUTHOR1
				 , H.SALE_BASIS_P
				 , H.SALE_BASIS_P
				 , A.ORDER_UNIT_FOR_P
		  ) A
		  ORDER BY A.INOUT_NUM, A.G_SUPP, A.SORT_SEQ
		END
	</select>

	<select id="str400rkrvServiceImpl.selectPrintList" parameterType="Map" resultType="rMap">
		--str400rkrv.Cstr400rkrv[fnstr400np] Query01
		BEGIN
		SET NOCOUNT ON
		SET ARITHABORT ON
		
		IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE ID=object_id('tempdb..#STR400RKR_TMP_080913'))
		    DROP TABLE #STR400RKR_TMP_080913
		
		DECLARE @COMP_CODE     NVARCHAR(08)   --(필수)법인코드 
		      , @INOUT_DATE    NVARCHAR(08)   --(선택)출고일   
		      , @DIV_CODE      NVARCHAR(08)   --(필수)사업장   
		      , @WH_CODE       NVARCHAR(08)   --(선택)출고창고 
		      , @INOUT_NUM     NVARCHAR(20)   --(선택)출고번호 
		      , @AGENT_TYPE    NVARCHAR(08)   --(선택)고객분류 
		      , @AREA_TYPE     NVARCHAR(03)   --(선택)지역     
		      , @CUSTOM_CODE   NVARCHAR(08)   --(선택)고객     
		      , @CUSTOM_NAME   NVARCHAR(20)   --(선택)고객명   
		      , @USER_ID       NVARCHAR(100)   --(필수)사용자ID 
		      , @TodayDate     NVARCHAR(08)   --현재일자       
		
		SET     @COMP_CODE   = #{S_COMP_CODE}
		<if test="@foren.Ognl@isNotEmpty(INOUT_DATE)">
			SET     @INOUT_DATE  = #{INOUT_DATE}
		</if>
		<if test="@foren.Ognl@isEmpty(INOUT_DATE)">
			SET     @INOUT_DATE  = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
			SET     @DIV_CODE    = #{DIV_CODE}
		</if>
		<if test="@foren.Ognl@isEmpty(DIV_CODE)">
			SET     @DIV_CODE    = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(WH_CODE)">
			SET     @WH_CODE     = #{WH_CODE}
		</if>
		<if test="@foren.Ognl@isEmpty(WH_CODE)">
			SET     @WH_CODE     = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">
			SET     @INOUT_NUM   = #{INOUT_NUM}
		</if>
		<if test="@foren.Ognl@isEmpty(INOUT_NUM)">
			SET     @INOUT_NUM   = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
			SET     @AGENT_TYPE  = #{AGENT_TYPE}
		</if>
		<if test="@foren.Ognl@isEmpty(AGENT_TYPE)">
			SET     @AGENT_TYPE  = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(AREA_TYPE)">
			SET     @AREA_TYPE   = #{AREA_TYPE}
		</if>
		<if test="@foren.Ognl@isEmpty(AREA_TYPE)">
			SET     @AREA_TYPE   = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
			SET     @CUSTOM_CODE = #{CUSTOM_CODE}
		</if>
		<if test="@foren.Ognl@isEmpty(CUSTOM_CODE)">
			SET     @CUSTOM_CODE = ''
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			SET     @CUSTOM_NAME = #{CUSTOM_NAME}
		</if>
		<if test="@foren.Ognl@isEmpty(CUSTOM_NAME)">
			SET     @CUSTOM_NAME = ''
		</if>
			SET     @USER_ID     = #{S_USER_ID} 
		
		SELECT @TodayDate = CONVERT(NVARCHAR(08), GETDATE(), 112)
		
		SELECT 
		       A.COMP_CODE                                                                                           
		     , A.INOUT_NUM                                                                                           
		     , A.INOUT_SEQ                                                                                           
		     , A.INOUT_TYPE                                                                                          
		     , A.DIV_CODE                                                                                            
		     , A.INOUT_DATE                                                                                          
		     , E.DIV_CODE    AS MY_CUSTOM_CODE                                                                       
		     , E.DIV_NAME    AS MY_CUSTOM_NAME                                                                       
		     , E.REPRE_NAME  AS MY_TOP_NAME                                                                          
		     , CASE ISNULL(E.COMPANY_NUM,'')                                                                         
		            WHEN '' THEN ''                                                                                  
		            ELSE         SUBSTRING(E.COMPANY_NUM,1,3) + '-'                                                  
		                       + SUBSTRING(E.COMPANY_NUM,4,2) + '-'                                                  
		                       + SUBSTRING(E.COMPANY_NUM,6,5)                                                        
		        END          AS MY_COMPANY_NUM                                                                       
		     , E.ZIP_CODE    AS MY_ZIP_CODE                                                                          
		     , E.ADDR        AS MY_ADDR                                                                              
		     , B.CUSTOM_CODE                                                                                         
		     , B.CUSTOM_NAME AS CUSTOM_NAME                                                                          
		     , B.TOP_NAME                                                                                            
		     , CASE ISNULL(B.COMPANY_NUM,'')                                                                         
		            WHEN '' THEN ''                                                                                  
		            ELSE         SUBSTRING(B.COMPANY_NUM,1,3) + '-'                                                  
		                       + SUBSTRING(B.COMPANY_NUM,4,2) + '-'                                                  
		                       + SUBSTRING(B.COMPANY_NUM,6,5)                                                        
		        END AS COMPANY_NUM                                                                                   
		     , B.ZIP_CODE                                                                                            
		     , RTRIM(ISNULL(B.ADDR1,'') + ISNULL(B.ADDR2,'')) AS ADDR                                                
		     , CASE ISNULL(CC.CUSTOM_ITEM_CODE, '')                                                                  
		            WHEN '' THEN A.ITEM_CODE                                                                         
		            ELSE         CC.CUSTOM_ITEM_CODE                                                                 
		        END AS ITEM_CODE                                                                                     
		     , CASE ISNULL(CC.CUSTOM_ITEM_NAME, '')                                                                  
		            WHEN '' THEN uniLITE.fnItemNameComp(C.COMP_CODE, @USER_ID, C.ITEM_CODE)                          
		            ELSE         CC.CUSTOM_ITEM_NAME                                                                 
		        END AS ITEM_NAME                                                                                     
		     , CASE ISNULL(CC.CUSTOM_ITEM_SPEC, '')                                                                  
		            WHEN '' THEN (SELECT SPEC                                                                        
		                            FROM BPR100T                                                                     
		                           WHERE COMP_CODE = A.COMP_CODE                                                     
		                             AND ITEM_CODE = A.ITEM_CODE)                                                    
		            ELSE         CC.CUSTOM_ITEM_SPEC                                                                 
		        END AS SPEC                                                                                          
		     , A.ORDER_UNIT                                                                                          
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_Q                                                     
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_Q  * (-1)                                             
		         END) AS ORDER_UNIT_Q                                                                                
		     , A.ORDER_UNIT_P                                                                                        
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.ORDER_UNIT_O                                                     
		             WHEN A.INOUT_TYPE = '3' THEN A.ORDER_UNIT_O  * (-1)                                             
		         END) AS ORDER_UNIT_O                                                                                
		     , (CASE WHEN A.INOUT_TYPE = '2' THEN A.INOUT_TAX_AMT                                                    
		             WHEN A.INOUT_TYPE = '3' THEN A.INOUT_TAX_AMT * (-1)                                             
		         END) AS INOUT_TAX_AMT                                                                               
		     , A.TAX_TYPE                                                                                            
		     , ISNULL(A.DISCOUNT_RATE, 0)  AS DISCOUNT_RATE                                                          
		     , A.DVRY_CUST_CD                                                                                        
		     , ISNULL(D.DVRY_CUST_NM,' ')  AS DVRY_CUST_NM                                                           
		     , ISNULL(D.DVRY_CUST_TEL,' ') AS DVRY_CUST_TEL                                                          
		     , ISNULL(D.DVRY_CUST_ADD,' ') AS DVRY_CUST_ADD                                                          
		     , CONVERT(NUMERIC(18,0),0)    AS GUBUN                                                                  
		     , CONVERT(NUMERIC(18,0),0)    AS l_PAGE                                                                 
		     , CONVERT(NUMERIC(6,0),0)     AS N_PAGE                                                                 
		     , CONVERT(NUMERIC(6,0),0)     AS MAX_PAGE                                                               
		     , CONVERT(NUMERIC(18,6),0)    AS SUM_Q                                                                  
		     , CONVERT(NUMERIC(18,4),0)    AS SUM_O                                                                  
		     , CONVERT(NUMERIC(18,4),0)    AS SUM_TAX                                                                
		     , CONVERT(NUMERIC(4,0),0)     AS G_REC                                                                  
		     ,'1'                          AS G_SUPP                                                                 
		  INTO #STR400RKR_TMP_080913                                                                                 
		  FROM            BTR100T A  WITH (NOLOCK)                                                                   
		       INNER JOIN BCM100T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE                                    
		                                          AND B.CUSTOM_CODE = A.SALE_CUSTOM_CODE                             
		       INNER JOIN BPR200T C  WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE                                    
		                                          AND C.DIV_CODE    = A.DIV_CODE                                     
		                                          AND C.ITEM_CODE   = A.ITEM_CODE                                    
		       LEFT  JOIN BPR300T CC WITH (NOLOCK) ON CC.TYPE            = '2'                                       
		                                          --20190821 '*' -> IN('*', @DIV_CODE)로 변경
		                                          AND CC.DIV_CODE        IN ('*', @DIV_CODE)
		                                          AND CC.COMP_CODE       = A.COMP_CODE                               
		                                          AND CC.CUSTOM_CODE     = A.INOUT_CODE                              
		                                          AND CC.ITEM_CODE       = A.ITEM_CODE                               
		                                          AND CC.APLY_START_DATE = (SELECT MAX(APLY_START_DATE)              
		                                                                      FROM BPR300T WITH (NOLOCK)             
		                                                                     WHERE COMP_CODE        = CC.COMP_CODE   
		                                                                       AND TYPE             = CC.TYPE        
		                                                                       AND DIV_CODE         = CC.DIV_CODE    
		                                                                       AND ITEM_CODE        = CC.ITEM_CODE   
		                                                                       AND CUSTOM_CODE      = CC.CUSTOM_CODE 
		                                                                       AND APLY_START_DATE &lt;= @TodayDate)    
		       LEFT  JOIN (SELECT DD.COMP_CODE                                                                       
		                        , DD.CUSTOM_CODE                                                                     
		                        , CONVERT(NVARCHAR(8), DD.DVRY_CUST_SEQ) AS DVRY_CUST_SEQ                            
		                        , DD.DVRY_CUST_NM                                                                    
		                        , MAX(DD.DVRY_CUST_TEL)                  AS DVRY_CUST_TEL                            
		                        , DD.DVRY_CUST_ADD                                                                   
		                     FROM SCM100T DD WITH (NOLOCK)                                                           
		                    WHERE DD.COMP_CODE  = @COMP_CODE                                                         
		                    GROUP BY DD.COMP_CODE   , DD.CUSTOM_CODE, DD.DVRY_CUST_SEQ                               
		                           , DD.DVRY_CUST_NM, DD.DVRY_CUST_ADD) D ON D.COMP_CODE     = A.COMP_CODE           
		                                                                 AND D.DVRY_CUST_SEQ = A.DVRY_CUST_CD        
		                                                                 AND D.CUSTOM_CODE   = A.INOUT_CODE          
		       INNER JOIN BOR120T E  WITH (NOLOCK) ON E.COMP_CODE   = A.COMP_CODE                                    
		                                          AND E.DIV_CODE    = A.DIV_CODE                                     
		       INNER JOIN BCM100T F  WITH (NOLOCK) ON F.COMP_CODE   = A.COMP_CODE                                    
		                                          AND F.CUSTOM_CODE = A.INOUT_CODE                                   
		 WHERE A.CREATE_LOC              =    '1'                                                                    
		   AND A.COMP_CODE               =    @COMP_CODE                                                             
		   AND A.DIV_CODE                =    @DIV_CODE                                                              
		   AND ((A.INOUT_DATE            =    @INOUT_DATE        AND @INOUT_DATE  != '') OR (@INOUT_DATE  = ''))     
		   AND ((A.WH_CODE               =    @WH_CODE           AND @WH_CODE     != '') OR (@WH_CODE     = ''))     
		   AND ((A.INOUT_NUM             LIKE @INOUT_NUM + '%'   AND @INOUT_NUM   != '') OR (@INOUT_NUM   = ''))     
		   AND ((F.AGENT_TYPE            =    @AGENT_TYPE        AND @AGENT_TYPE  != '') OR (@AGENT_TYPE  = ''))     
		   AND ((ISNULL(F.AREA_TYPE,'')  =    @AREA_TYPE         AND @AREA_TYPE   != '') OR (@AREA_TYPE   = ''))     
		   
		   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
		   AND A.INOUT_CODE = @CUSTOM_CODE					/* 거래처코드  */
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
		   AND A.INOUT_CODE LIKE  @CUSTOM_CODE + '%'			/* 거래처코드  */
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
		   AND F.CUSTOM_NAME LIKE '%' + @CUSTOM_NAME + '%'	/* 거래처명  */
		   </if>
		   
		   
		 --  AND ((A.INOUT_CODE            LIKE @CUSTOM_CODE + '%' AND @CUSTOM_CODE != '') OR (@CUSTOM_CODE = ''))
		 --  AND ((F.CUSTOM_NAME           LIKE @CUSTOM_NAME + '%' AND @CUSTOM_NAME != '') OR (@CUSTOM_NAME = ''))
		   AND A.INOUT_TYPE IN ('2','3')  
   		 <if test="PRINT_KIND == &quot;CUST&quot;">
		   ORDER BY B.CUSTOM_CODE, A.INOUT_NUM, A.INOUT_SEQ
		 </if>
		 <if test="PRINT_KIND == &quot;DVRY&quot;">
		  ORDER BY D.CUSTOM_CODE, A.INOUT_NUM, CUSTOM_NAME, A.INOUT_SEQ
		 </if>
		
		SELECT INOUT_NUM, INOUT_DATE
		     , MY_CUSTOM_CODE, MY_CUSTOM_NAME, MY_TOP_NAME , MY_COMPANY_NUM, MY_ZIP_CODE, MY_ADDR       
		     , CUSTOM_CODE   , CUSTOM_NAME   , TOP_NAME    , COMPANY_NUM   , ZIP_CODE   , ADDR          
		     , INOUT_SEQ     , ITEM_CODE     , ITEM_NAME   , SPEC                                       
		     , ORDER_UNIT    , ORDER_UNIT_Q  , ORDER_UNIT_P, ORDER_UNIT_O  , INOUT_TAX_AMT              
		     , TAX_TYPE      , DISCOUNT_RATE , DVRY_CUST_NM, DVRY_CUST_TEL                              
		     , GUBUN         , l_PAGE        , N_PAGE      , MAX_PAGE      , SUM_Q      , SUM_O, SUM_TAX
		     , DVRY_CUST_CD  , G_REC         , G_SUPP      , DVRY_CUST_ADD                              
		  FROM #STR400RKR_TMP_080913
		
		SET NOCOUNT OFF
		SET ARITHABORT OFF
		END
	</select>
</mapper>