<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssa101ukrvServiceImpl">
	
		
	<select id="ssa101ukrvServiceImpl.selectMaster" parameterType="Map" resultType="rMap">	
		 /*ssa101ukrv.Cssa101ukrv[fnSsa101QStd] Query1*/		
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON
		
		    DECLARE @CompCode    NVARCHAR(08) /* 법인코드    */
		          , @UserId      NVARCHAR(100) /* 사용자ID    */
		          , @LangType    NVARCHAR(2)  /* 언어구분    */
		          , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */
		
		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE} 
		
		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId
		
		    SET @RefItem = ISNULL(@RefItem, N'0')
		
		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'
		
		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		
		/*  데이터 조회 */
		    
		    <if test="@foren.Ognl@isEmpty(DIV_CODE)">		    
		        SELECT TOP 0 A.DIV_CODE
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		        SELECT A.DIV_CODE
		    </if>		    
		         , A.BILL_NUM
		         , A.BILL_TYPE
		         , A.SALE_DATE
		         , A.ORDER_TYPE
		         , A.SALE_CUSTOM_CODE
		         , CASE WHEN @RefItem = '0' THEN C1.CUSTOM_NAME
		                WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
		                                    ELSE C1.CUSTOM_NAME
		           END                                              As CUSTOM_NAME
		         , A.MONEY_UNIT
		         , A.EXCHG_RATE_O
		         , A.VAT_RATE
		         , A.SALE_PRSN
		         , A.TAX_TYPE
		         , A.CARD_CUST_CD
		         , C2.CREDIT_NAME                                   AS CARD_CUST_NM
		         , A.PROJECT_NO
		         , A.REMARK
		         , A.EX_DATE
		         , A.EX_NUM
		         , A.AC_DATE
		         , SUM(CASE WHEN B.TAX_TYPE = '1' THEN ISNULL(B.SALE_LOC_AMT_I, 0)
		                    ELSE 0
		               END)                                         AS TOT_SALE_TAX_I
		         , SUM(CASE WHEN B.TAX_TYPE = '2' THEN ISNULL(B.SALE_LOC_AMT_I, 0)
		                    ELSE 0
		               END)                                         AS TOT_SALE_EXP_I
		         , SUM(CASE WHEN B.TAX_TYPE = '1' THEN ISNULL(B.TAX_AMT_O, 0)
		                    ELSE 0
		               END)                                         AS TOT_TAX_AMT
		         , SUM(CASE WHEN B.TAX_TYPE = '1' THEN ISNULL(B.SALE_AMT_O, 0)
		                    ELSE 0
		               END)                                         AS TOT_SALE_TAX_O
		         , SUM(CASE WHEN B.TAX_TYPE = '2' THEN ISNULL(B.SALE_AMT_O, 0)
		                    ELSE 0
		               END)                                         AS TOT_SALE_EXP_O
		         , M1.CODE_NAME                                      AS CARD_NM
		
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           LEFT  JOIN BCM100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                               AND C1.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		           LEFT  JOIN BCM200T  C2 WITH (NOLOCK) ON C2.COMP_CODE   = A.COMP_CODE
		                                               AND A.CARD_CUST_CD = C2.CREDIT_CODE + C2.CARD_COMP_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = C2.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'A028'                          /* 단가유형*/
		                                               AND M1.SUB_CODE    = C2.CARD_COMP_CODE
		     WHERE A.COMP_CODE = @CompCode
		<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">  
		     AND   A.DIV_CODE  = #{DIV_CODE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(BILL_NUM)"> 
		     AND   A.BILL_NUM  = #{BILL_NUM}
		</if>
		     GROUP BY A.DIV_CODE, A.BILL_NUM, A.BILL_TYPE, A.SALE_DATE, A.ORDER_TYPE, A.SALE_CUSTOM_CODE, A.MONEY_UNIT, A.EXCHG_RATE_O
		         , A.VAT_RATE, A.SALE_PRSN, A.TAX_TYPE, A.CARD_CUST_CD, C2.CREDIT_NAME, A.PROJECT_NO, A.REMARK, A.EX_DATE, A.EX_NUM, A.AC_DATE
		         , C1.CUSTOM_NAME, C1.CUSTOM_NAME1, C1.CUSTOM_NAME2, M1.CODE_NAME 
		
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END		
	</select>
		
	<select id="ssa101ukrvServiceImpl.selectDetailList" parameterType="Map" resultType="rMap">
		/*ssa101ukrv.Cssa101ukrv[fnMakeQuery] Query1*/
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON
		
		    DECLARE @CompCode    NVARCHAR(08) /* 법인코드    */
		          , @UserId      NVARCHAR(100) /* 사용자ID    */
		          , @LangType    NVARCHAR(2)  /* 언어구분    */
		          , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */
		
		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE} 
		
		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId
		
		    SET @RefItem = ISNULL(@RefItem, N'0')
		
		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'
		
		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		
		/*데이터 조회*/
		    SELECT B.BILL_SEQ
		         , B.INOUT_TYPE_DETAIL
		         , B.OUT_DIV_CODE
		         , B.WH_CODE
		         , B.ITEM_CODE
		         , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                ELSE C1.ITEM_NAME
		           END                                               AS ITEM_NAME
		         , C1.SPEC
		         , B.SALE_UNIT
		         , B.PRICE_TYPE
		         , B.TRANS_RATE
		         , B.SALE_Q
		         , B.SALE_P
		         , ISNULL(B.SALE_WGT_Q    , 0)                       AS SALE_WGT_Q
		         , ISNULL(B.SALE_FOR_WGT_P, 0)                       AS SALE_FOR_WGT_P
		         , ISNULL(B.SALE_VOL_Q    , 0)                       AS SALE_VOL_Q
		         , ISNULL(B.SALE_FOR_VOL_P, 0)                       AS SALE_FOR_VOL_P
		         , ISNULL(B.SALE_WGT_P    , 0)                       AS SALE_WGT_P
		         , ISNULL(B.SALE_VOL_P    , 0)                       AS SALE_VOL_P
		         , B.SALE_AMT_O
		         , B.TAX_TYPE
		         , B.TAX_AMT_O
		         , (B.SALE_AMT_O + B.TAX_AMT_O)                      AS ORDER_O_TAX_O
		         , B.WGT_UNIT                                                                      /*중량단위*/
		         , ISNULL(B.UNIT_WGT, 0)                             AS UNIT_WGT                   /*단위중량*/
		         , B.VOL_UNIT                                                                      /*부피단위*/
		         , ISNULL(B.UNIT_VOL, 0)                             AS UNIT_VOL                   /*단위부피*/
		         , B.DISCOUNT_RATE
		         , ISNULL(D2.GOOD_STOCK_Q, 0)                        AS STOCK_Q
		         , B.DVRY_CUST_CD
		         , C2.DVRY_CUST_NM                                   AS DVRY_CUST_NAME
		         , B.PRICE_YN
		         , D1.LOT_NO
		         , B.INOUT_NUM
		         , B.INOUT_SEQ
		         , uniLITE.fnGetUserdate(B.COMP_CODE, D1.INOUT_DATE) AS INOUT_DATE
		         , B.ORDER_NUM
		         , B.PUB_NUM
		         , B.DIV_CODE
		         , B.BILL_NUM
		         , B.SALE_LOC_AMT_I
		         , B.INOUT_TYPE
		         , B.SER_NO
		         , C1.STOCK_UNIT
		         , D1.ITEM_STATUS
		         , D1.ACCOUNT_YNC
		         , B.SALE_Q                                          AS ORIGIN_Q
		         , A.SALE_PRSN                                       AS REF_SALE_PRSN
		         , A.SALE_CUSTOM_CODE                                AS REF_CUSTOM_CODE
		         , A.SALE_DATE                                       AS REF_SALE_DATE
		         , A.BILL_TYPE                                       AS REF_BILL_TYPE
		         , A.CARD_CUST_CD                                    AS REF_CARD_CUST_CD
		         , A.ORDER_TYPE                                      AS REF_SALE_TYPE
		         , B.PROJECT_NO                                      AS REF_PROJECT_NO
		         , A.TAX_TYPE                                        AS REF_TAX_INOUT
		         , A.REMARK                                          AS REF_REMARK
		         , A.EX_NUM                                          AS REF_EX_NUM
		         , A.MONEY_UNIT                                      AS REF_MONEY_UNIT
		         , A.EXCHG_RATE_O                                    AS REF_EXCHG_RATE_O
		         , ISNULL(C1.STOCK_CARE_YN, 'Y')                     AS STOCK_CARE_YN
		         , CASE WHEN D1.INOUT_TYPE = '2' THEN (ISNULL(D1.ORDER_UNIT_Q, 0) - ISNULL(D1.ACCOUNT_Q, 0))
		                WHEN D1.INOUT_TYPE = '3' THEN (ISNULL(D1.ORDER_UNIT_Q, 0) - ISNULL(D1.ACCOUNT_Q, 0)) * (-1)
		           END                                               AS UNSALE_Q
		         , B.UPDATE_DB_USER
		         , B.UPDATE_DB_TIME
		         , 'T'                                               AS DATA_REF_FLAG
		         , B.CUSTOM_CODE                                     AS SRC_CUSTOM_CODE
		         , CASE WHEN @RefItem = '1' THEN C4.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C4.CUSTOM_NAME2
		                ELSE C4.CUSTOM_NAME
		           END                                               AS SRC_CUSTOM_NAME
		         , B.ORDER_PRSN                                      AS SRC_ORDER_PRSN
		         , CASE WHEN ISNULL(M1.REF_CODE2, '') = '' THEN M1.SUB_CODE
		                                                   ELSE M1.REF_CODE2
		           END                                               AS REF_CODE2
		         , D3.ACCOUNT_YNC                                    AS SOF110T_ACCOUNT_YNC
		         , B.COMP_CODE
		         , D1.INOUT_CODE                                     AS INOUT_CUSTOM_CODE
		         , CASE WHEN @RefItem = '1' THEN C3.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C3.CUSTOM_NAME2
		                ELSE C3.CUSTOM_NAME
		           END                                               AS INOUT_CUSTOM_NAME
		         , C3.AGENT_TYPE                                     AS INOUT_AGENT_TYPE
		         , B.ADVAN_YN                                        AS ADVAN_YN
		         , 'FEFER'                                           AS GUBUN
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           LEFT  JOIN BTR100T  D1 WITH (NOLOCK) ON D1.COMP_CODE   = B.COMP_CODE
		                                               AND D1.DIV_CODE    = B.OUT_DIV_CODE
		                                               AND D1.INOUT_NUM   = B.INOUT_NUM
		                                               AND D1.INOUT_SEQ   = B.INOUT_SEQ
		                                               AND D1.INOUT_TYPE  = B.INOUT_TYPE
		           LEFT  JOIN BIV100T  D2 WITH (NOLOCK) ON D2.COMP_CODE   = B.COMP_CODE
		                                               AND D2.DIV_CODE    = B.OUT_DIV_CODE
		                                               AND D2.WH_CODE     = B.WH_CODE
		                                               AND D2.ITEM_CODE   = B.ITEM_CODE
		           LEFT  JOIN SOF110T  D3 WITH (NOLOCK) ON D3.COMP_CODE   = B.COMP_CODE
		                                               AND D3.DIV_CODE    = B.DIV_CODE
		                                               AND D3.ORDER_NUM   = B.ORDER_NUM
		                                               AND D3.SER_NO      = B.SER_NO
		           LEFT  JOIN BPR100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = B.COMP_CODE
		                                               AND C1.ITEM_CODE   = B.ITEM_CODE
		           LEFT  JOIN SCM100T  C2 WITH (NOLOCK) ON C2.COMP_CODE   = B.COMP_CODE
		                                               AND C2.CUSTOM_CODE = B.CUSTOM_CODE
		                                               AND CONVERT(NVARCHAR(08), C2.DVRY_CUST_SEQ) = B.DVRY_CUST_CD
		           LEFT  JOIN BCM100T  C3 WITH (NOLOCK) ON C3.COMP_CODE   = D1.COMP_CODE
		                                               AND C3.CUSTOM_CODE = D1.INOUT_CODE
		           LEFT  JOIN BCM100T  C4 WITH (NOLOCK) ON C4.COMP_CODE   = B.COMP_CODE
		                                               AND C4.CUSTOM_CODE = B.CUSTOM_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = B.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S007'                          /* 단가유형*/
		                                               AND M1.SUB_CODE    = B.INOUT_TYPE_DETAIL
		    WHERE  A.COMP_CODE = @CompCode
		<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">    
		    AND    A.DIV_CODE  = #{DIV_CODE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(BILL_NUM)">
		    AND    A.BILL_NUM  = #{BILL_NUM}
		</if>
		 ORDER BY B.BILL_SEQ
		 
		 		    SET NOCOUNT OFF
				    SET ARITHABORT OFF
		END		
	</select>	
	
	<select id="ssa101ukrvServiceImpl.selectSalesNumMaster" parameterType="Map" resultType="rMap">
		/* ssa101ukrv.Cssa101ukrv[fnSsa101QPopDetail] Query1 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON
		
		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */
		
		     SET @CompCode = #{S_COMP_CODE}
		     SET @UserId   = #{S_USER_ID}
		     SET @LangType = #{S_LANG_CODE}    
		
		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId
		
		    SET @RefItem = ISNULL(@RefItem, N'0')
		
		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'
		
		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		
		    SELECT A.DIV_CODE
		         , A.SALE_CUSTOM_CODE
		         , (CASE WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
		                 WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
		                                     ELSE C1.CUSTOM_NAME
		             END)                                           AS CUSTOM_NAME
		         , B.ITEM_CODE
		         , (CASE WHEN @RefItem = '1' THEN M3.ITEM_NAME1
		                 WHEN @RefItem = '2' THEN M3.ITEM_NAME2
		                                     ELSE M3.ITEM_NAME
		             END)                                           AS ITEM_NAME
		         , CAST((CASE WHEN ISNULL(A.SALE_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.SALE_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.SALE_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.SALE_DATE, 7, 2))
		                  END)AS DATETIME)                          AS SALE_DATE
		         , A.BILL_TYPE
		         , A.ORDER_TYPE                                     AS SALE_TYPE
		         , M1.CODE_NAME                                     AS SALE_TYPE_NAME
		         , ISNULL(B.SALE_Q, 0)                              AS SALE_Q
		         , (A.SALE_AMT_O + A.SALE_LOC_EXP_I + A.TAX_AMT_O ) AS SALE_TOT_O
		         , A.SALE_LOC_AMT_I
		         , A.SALE_LOC_EXP_I
		         , A.TAX_AMT_O
		         , A.SALE_PRSN
		         , M2.CODE_NAME                                     AS SALE_PRSN_NAME
		         , A.BILL_NUM
		         , A.PROJECT_NO
		         , B.INOUT_NUM
		         , C1.AGENT_TYPE
		         , C1.CREDIT_YN
		         , C1.WON_CALC_BAS
		         , C1.TAX_CALC_TYPE
		         , C1.TAX_TYPE
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           INNER JOIN BCM100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                               AND C1.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S002'                          /*수주유형 */
		                                               AND M1.SUB_CODE    = A.ORDER_TYPE
		           LEFT  JOIN BSA100T  M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                               AND M2.MAIN_CODE   = 'S010'                          /*영업담당 */
		                                               AND M2.SUB_CODE    = A.SALE_PRSN
		           LEFT  JOIN BPR100T  M3 WITH (NOLOCK) ON M3.COMP_CODE   = B.COMP_CODE
		                                               AND M3.ITEM_CODE   = B.ITEM_CODE
		
		    WHERE    A.COMP_CODE           = @CompCode       /* (필수) 법인코드 */
		    <if test="@foren.Ognl@isNotEmpty(SALE_DATE_FR)">
		      AND    A.SALE_DATE       &gt;= #{SALE_DATE_FR} /* (필수) 시작 매출일 */
		    </if> 
		    <if test="@foren.Ognl@isNotEmpty(SALE_DATE_TO)">  
		      AND    A.SALE_DATE       &lt;= #{SALE_DATE_TO} /* (필수) 종료 매출일 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">  
		      AND    A.DIV_CODE            = #{DIV_CODE}     /*(필수) 사업장코드 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">  
		      AND    A.SALE_CUSTOM_CODE LIKE #{CUSTOM_CODE}  /* 거래처코드 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME)">  
		      AND    C1.CUSTOM_NAME     LIKE #{CUSTOM_NAME}  /* 거래처명 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(SALE_PRSN)">  
		      AND    A.SALE_PRSN           = #{SALE_PRSN}    /* 영업담당 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">  
		      AND    A.ORDER_TYPE          = #{ORDER_TYPE}   /* 판매유형 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">  
		      AND    A.BILL_TYPE           = #{BILL_TYPE}    /* 부가세유형 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">  
		      AND    A.PROJECT_NO       LIKE #{PROJECT_NO}   /* 관리번호 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">  
		      AND    B.INOUT_NUM        LIKE #{INOUT_NUM}    /* 출고번호 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(BILL_NUM)">  
		      AND    A.BILL_NUM         LIKE #{BILL_NUM}     /* 매출번호 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE)">  
		      AND    B.ITEM_CODE           = #{ITEM_CODE}    /* 품목코드 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(ITEM_NAME)">  
		      AND    M3.ITEM_NAME          = #{ITEM_NAME}    /* 품목명   */
		    </if>  
		
		
		   ORDER BY C1.CUSTOM_NAME, A.SALE_DATE, A.BILL_NUM, B.ITEM_CODE
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END		
    </select>
    
    <select id="ssa101ukrvServiceImpl.selectSalesNumDetail" parameterType="Map" resultType="rMap">
		/* ssa101ukrv.Cssa101ukrv[fnSsa101QPopDetail] Query1 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON
		
		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */
		
		     SET @CompCode = #{S_COMP_CODE}
		     SET @UserId   = #{S_USER_ID}
		     SET @LangType = #{S_LANG_CODE}   
		
		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId
		
		    SET @RefItem = ISNULL(@RefItem, N'0')
		
		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'
		
		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		
		    SELECT A.DIV_CODE
		         , A.SALE_CUSTOM_CODE
		         , (CASE WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
		                 WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
		                                     ELSE C1.CUSTOM_NAME
		             END)                                           AS CUSTOM_NAME
		         , B.ITEM_CODE
		         , (CASE WHEN @RefItem = '1' THEN M3.ITEM_NAME1
		                 WHEN @RefItem = '2' THEN M3.ITEM_NAME2
		                                     ELSE M3.ITEM_NAME
		             END)                                           AS ITEM_NAME
		         , CAST((CASE WHEN ISNULL(A.SALE_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.SALE_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.SALE_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.SALE_DATE, 7, 2))
		                  END)AS DATETIME)                          AS SALE_DATE
		         , A.BILL_TYPE
		         , A.ORDER_TYPE                                     AS SALE_TYPE
		         , M1.CODE_NAME                                     AS SALE_TYPE_NAME
		         , ISNULL(B.SALE_Q, 0)                              AS SALE_Q
		         , (A.SALE_AMT_O + A.SALE_LOC_EXP_I + A.TAX_AMT_O ) AS SALE_TOT_O
		         , A.SALE_LOC_AMT_I
		         , A.SALE_LOC_EXP_I
		         , A.TAX_AMT_O
		         , A.SALE_PRSN
		         , M2.CODE_NAME                                     AS SALE_PRSN_NAME
		         , A.BILL_NUM
		         , A.PROJECT_NO
		         , B.INOUT_NUM
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           INNER JOIN BCM100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                               AND C1.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S002'                          /* 수주유형 */
		                                               AND M1.SUB_CODE    = A.ORDER_TYPE
		           LEFT  JOIN BSA100T  M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                               AND M2.MAIN_CODE   = 'S010'                          /* 영업담당 */
		                                               AND M2.SUB_CODE    = A.SALE_PRSN
		           LEFT  JOIN BPR100T  M3 WITH (NOLOCK) ON M3.COMP_CODE   = B.COMP_CODE
		                                               AND M3.ITEM_CODE   = B.ITEM_CODE
		
		    WHERE    A.COMP_CODE           = @CompCode       /* (필수) 법인코드 */
		    <if test="@foren.Ognl@isNotEmpty(SALE_DATE_FR)">
		      AND    A.SALE_DATE       &gt;= #{SALE_DATE_FR} /* (필수) 시작 매출일 */
		    </if> 
		    <if test="@foren.Ognl@isNotEmpty(SALE_DATE_TO)">  
		      AND    A.SALE_DATE       &lt;= #{SALE_DATE_TO} /* (필수) 종료 매출일 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">  
		      AND    A.DIV_CODE            = #{DIV_CODE}     /*(필수) 사업장코드 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">  
		      AND    A.SALE_CUSTOM_CODE LIKE #{CUSTOM_CODE}  /* 거래처코드 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME)">  
		      AND    C1.CUSTOM_NAME     LIKE #{CUSTOM_NAME}  /* 거래처명 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(SALE_PRSN)">  
		      AND    A.SALE_PRSN           = #{SALE_PRSN}    /* 영업담당 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">  
		      AND    A.ORDER_TYPE          = #{ORDER_TYPE}   /* 판매유형 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">  
		      AND    A.BILL_TYPE           = #{BILL_TYPE}    /* 부가세유형 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">  
		      AND    A.PROJECT_NO       LIKE #{PROJECT_NO}   /* 관리번호 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">  
		      AND    B.INOUT_NUM        LIKE #{INOUT_NUM}    /* 출고번호 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(BILL_NUM)">  
		      AND    A.BILL_NUM         LIKE #{BILL_NUM}     /* 매출번호 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE)">  
		      AND    B.ITEM_CODE           = #{ITEM_CODE}    /* 품목코드 */
		    </if>  
		    <if test="@foren.Ognl@isNotEmpty(ITEM_NAME)">  
		      AND    M3.ITEM_NAME          = #{ITEM_NAME}    /* 품목명   */
		    </if> 
		
		
		   ORDER BY C1.CUSTOM_NAME, A.SALE_DATE, A.BILL_NUM, B.ITEM_CODE
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
    </select>
    
    <select id="ssa101ukrvServiceImpl.selectSalesOrderList" parameterType="Map" resultType="rMap">
		/* ssa101ukrv.Cssa101ukrv[fnSof101QRef] Query1 */
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON
		
		    DECLARE @CompCode         NVARCHAR(08) /* 법인코드  */
		          , @UserId           NVARCHAR(100) /* 사용자ID */
		          , @LangType         NVARCHAR(2)  /* 언어구분  */
		          , @RefItem          NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat       NVARCHAR(10) /* 날짜 포맷 유형 설정 */
		          , @DIV_CODE         NVARCHAR(08) /* (필수) 사업장코드 */
		          , @FR_DVRY_DATE     NVARCHAR(08) /* 시작 납기일 */
		          , @TO_DVRY_DATE     NVARCHAR(08) /* 종료 납기일 */
		          , @ITEM_CODE        NVARCHAR(20) /* 품목코드 */
		
		    SET @CompCode 	  = #{S_COMP_CODE}
		    SET @UserId   	  = #{S_USER_ID}
		    SET @LangType 	  = #{S_LANG_CODE}  
		    SET @DIV_CODE 	  = #{DIV_CODE}		/*마스터폼 정보*/
		    SET @FR_DVRY_DATE = #{FR_DVRY_DATE}
		    SET @TO_DVRY_DATE = #{TO_DVRY_DATE}
		    SET @ITEM_CODE    = #{ITEM_CODE}
		    
		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId
		
		    SET @RefItem = ISNULL(@RefItem, N'0')
		
		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'
		
		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')                  
		
		
		
		    /* 데이터 조회 */
		    SELECT CAST(0 AS BIT) AS CHOICE  
		         , B.ORDER_NUM
		         , B.SER_NO
		         , B.SO_KIND
		         , ISNULL(C4.REF_CODE2,'') AS INOUT_TYPE_DETAIL 
		         , B.ITEM_CODE
		         , (CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                 WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                                     ELSE C1.ITEM_NAME
		            END)                                                                                    AS ITEM_NAME 
		         , C1.SPEC
		         , B.ORDER_UNIT
		         , B.TRANS_RATE
		         , CAST(B.DVRY_DATE AS DATETIME) AS DVRY_DATE
		         , (B.ORDER_Q + B.RETURN_Q - B.OUTSTOCK_Q - (B.ISSUE_REQ_Q - ISNULL(SUM(D1.ISSUE_QTY), 0))) AS NOT_SALE_Q
		         , B.ORDER_Q
		         , A.PROJECT_NO
		         , (CASE WHEN @RefItem = '1' THEN C3.CUSTOM_NAME1
		                 WHEN @RefItem = '2' THEN C3.CUSTOM_NAME2
		                                     ELSE C3.CUSTOM_NAME
		            END)                                                                                    AS CUSTOM_NAME
		         , A.ORDER_PRSN
		         , B.PO_NUM
		         , A.CUSTOM_CODE
		         , B.OUT_DIV_CODE
		         , B.ORDER_P
		         , B.ORDER_O
		         , B.TAX_TYPE
		         , C2.WH_CODE                                                                                AS WH_CODE
		         , A.MONEY_UNIT
		         , A.EXCHG_RATE_O
		         , B.ACCOUNT_YNC
		         , B.DISCOUNT_RATE
		         , B.DVRY_CUST_CD
		         , A.BILL_TYPE
		         , A.ORDER_TYPE
		         , B.PRICE_YN
		         , ISNULL(C1.STOCK_CARE_YN, 'Y')                                                             AS STOCK_CARE_YN
		         , C1.STOCK_UNIT
		         , D2.DVRY_CUST_NM                                                                           AS DVRY_CUST_NAME
		         , A.TAX_INOUT
		         , B.ORDER_TAX_O
		    FROM              SOF100T  A  WITH (NOLOCK)
		           INNER JOIN SOF110T  B  WITH (NOLOCK) ON B.COMP_CODE       = A.COMP_CODE
		                                               AND B.DIV_CODE        = A.DIV_CODE
		                                               AND B.ORDER_NUM       = A.ORDER_NUM
		                                               AND B.ORDER_STATUS    = 'N'
		                                               AND ((@DIV_CODE      != '' AND B.OUT_DIV_CODE = @DIV_CODE)        OR (@DIV_CODE     = ''))
		                                               AND ((@FR_DVRY_DATE  != '' AND B.DVRY_DATE   &gt;= @FR_DVRY_DATE)    OR (@FR_DVRY_DATE = ''))
		                                               AND ((@TO_DVRY_DATE  != '' AND B.DVRY_DATE   &lt;= @TO_DVRY_DATE)    OR (@TO_DVRY_DATE = ''))
		                                               AND ((@ITEM_CODE     != '' AND B.ITEM_CODE LIKE @ITEM_CODE + '%') OR (@ITEM_CODE    = ''))
		           LEFT  JOIN BPR100T  C1 WITH (NOLOCK) ON C1.COMP_CODE      = B.COMP_CODE
		                                               AND C1.ITEM_CODE      = B.ITEM_CODE
		           LEFT  JOIN BPR200T  C2 WITH (NOLOCK) ON C2.COMP_CODE      = B.COMP_CODE
		                                               AND C2.DIV_CODE       = B.OUT_DIV_CODE
		                                               AND C2.ITEM_CODE      = B.ITEM_CODE
		           LEFT  JOIN BCM100T  C3 WITH (NOLOCK) ON C3.COMP_CODE      = A.COMP_CODE
		                                               AND C3.CUSTOM_CODE    = A.CUSTOM_CODE
		           LEFT  JOIN BSA100T  C4 WITH (NOLOCK) ON C4.COMP_CODE      = B.COMP_CODE      
		                                               AND C4.MAIN_CODE      = 'S065'           
		                                               AND C4.SUB_CODE       = B.SO_KIND        
		           LEFT  JOIN SRQ100T  D1 WITH (NOLOCK) ON D1.COMP_CODE      = B.COMP_CODE
		                                               AND D1.ISSUE_DIV_CODE = B.OUT_DIV_CODE
		                                               AND D1.ORDER_NUM      = B.ORDER_NUM
		                                               AND D1.SER_NO         = B.SER_NO
		           LEFT  JOIN SCM100T  D2 WITH (NOLOCK) ON D2.COMP_CODE      = A.COMP_CODE
		                                               AND D2.CUSTOM_CODE    = A.CUSTOM_CODE
		                                               AND CONVERT(NVARCHAR(08), D2.DVRY_CUST_SEQ) = B.DVRY_CUST_CD
		    WHERE  A.COMP_CODE      = @CompCode
		    AND    (A.STATUS IS NULL OR A.STATUS = '6')		    
		    AND    A.MONEY_UNIT      = N'KRW'   	/*마스터폼(히든)*/
		    
		    <if test="@foren.Ognl@isNotEmpty(TAX_INOUT)">     
		    AND    A.TAX_INOUT       = #{TAX_INOUT}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">      
		    AND    A.CUSTOM_CODE  LIKE #{CUSTOM_CODE} + '%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ORDER_NUM)">
		    AND    A.ORDER_NUM    LIKE #{ORDER_NUM} + '%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)"> 
		    AND    A.PROJECT_NO   LIKE #{PROJECT_NO} + '%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_NAME)"> 
		    AND    C2.ITEM_NAME   LIKE #{ITEM_NAME}' + '%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME)">   
		    AND    C3.CUSTOM_NAME LIKE #{CUSTOM_NAME} + '%'
		    </if>
		    GROUP BY B.ORDER_STATUS     , A.CUSTOM_CODE  , C3.CUSTOM_NAME , C3.CUSTOM_NAME1, C3.CUSTOM_NAME2,
		             B.ORDER_NUM        , B.SER_NO       , B.ITEM_CODE    , C1.ITEM_NAME, C1.ITEM_NAME1, C1.ITEM_NAME2
		           , C1.SPEC            , B.ORDER_UNIT   , B.TRANS_RATE
		           , B.DVRY_DATE        , B.ORDER_Q      , B.RETURN_Q     , B.OUTSTOCK_Q , B.ISSUE_REQ_Q
		           , B.PO_NUM           , B.OUT_DIV_CODE , B.ORDER_P      , B.ORDER_O    , B.TAX_TYPE
		           , A.PROJECT_NO       , A.MONEY_UNIT   , A.EXCHG_RATE_O , B.ACCOUNT_YNC, A.ORDER_PRSN
		           , B.DVRY_CUST_CD     , A.BILL_TYPE    , A.ORDER_TYPE   , B.PRICE_YN   , B.DISCOUNT_RATE
		           , C1.STOCK_CARE_YN   , C1.STOCK_UNIT  , A.TAX_INOUT    , B.ORDER_TAX_O, B.COMP_CODE
		           , C2.WH_CODE         , D2.DVRY_CUST_NM, B.SO_KIND      , C4.REF_CODE2
		    HAVING B.ORDER_Q + 
		    B.RETURN_Q - B.OUTSTOCK_Q - (B.ISSUE_REQ_Q - ISNULL(SUM(D1.ISSUE_QTY), 0)) &gt; 0    
		    ORDER BY C3.CUSTOM_NAME, B.DVRY_DATE, B.ORDER_NUM, B.SER_NO
		
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END	
    </select>
    
    	
	<select id="ssa101ukrvServiceImpl.selectIssueList" parameterType="Map" resultType="rMap">
		/* ssa101ukrv.Cssa101ukrv[fnStr101QRef] Query1 */
		/* 매출등록  [출고(미매출)/반품참조] */
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON
		
		    DECLARE	@CompCode    NVARCHAR(08) /* 법인코드    */
		          , @UserId      NVARCHAR(100) /* 사용자ID    */
		          , @LangType    NVARCHAR(2)  /* 언어구분    */
		          , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */
		          , @TAX_INOUT   NVARCHAR(01) /* 세액 포함여부(1:별도, 2:포함) */
		          , @ITEM_NAME   NVARCHAR(200) /* 품명 */
		
		    SET @CompCode 	  = #{S_COMP_CODE}
		    SET @UserId   	  = #{S_USER_ID}
		    SET @LangType 	  = #{S_LANG_CODE}
		    SET @TAX_INOUT 	  = #{TAX_INOUT}
		    SET @ITEM_NAME 	  = #{ITEM_NAME}
		
		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		      WHERE USER_ID = @UserId
		    
		    SET @RefItem = ISNULL(@RefItem, N'0')
		
		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'
		
		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		    /* 데이터 조회&gt; */
		    SELECT CAST(0 AS BIT) AS CHOICE   
		         , A.ITEM_CODE
		         , CASE WHEN @RefItem = '0' THEN C1.ITEM_NAME
		                WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                ELSE C1.ITEM_NAME
		           END                                              AS ITEM_NAME
		         , C1.SPEC
		         , A.ORDER_UNIT
		         , CASE WHEN C.ADVAN_AMOUNT &gt; 0 THEN C.ORDER_Q - C.SALE_Q
		                ELSE CASE WHEN A.INOUT_TYPE = '2' THEN (A.ORDER_UNIT_Q - A.ACCOUNT_Q)
		                          WHEN A.INOUT_TYPE = '3' THEN (A.ORDER_UNIT_Q - A.ACCOUNT_Q) * (-1)
		                     END
		           END AS NOT_SALE_Q
		         , A.ORDER_UNIT_Q
		         , A.INOUT_WGT_Q
		         , A.INOUT_VOL_Q        
		         , A.ORDER_UNIT_P
		         , CASE WHEN C.ADVAN_AMOUNT &gt; 0 THEN (C.ORDER_Q - C.SALE_Q) * A.ORDER_UNIT_P
		                ELSE A.ORDER_UNIT_O 
		           END  ORDER_UNIT_O
		         , CASE WHEN C.ADVAN_AMOUNT &gt; 0 THEN (C.ORDER_Q - C.SALE_Q) * A.ORDER_UNIT_P * 0.1
		                ELSE A.INOUT_TAX_AMT 
		           END  INOUT_TAX_AMT
		         , A.PROJECT_NO
		         , A.INOUT_NUM
		         , A.INOUT_SEQ
		         , A.INOUT_TYPE
		         , CASE WHEN @RefItem = '1' THEN C2.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C2.CUSTOM_NAME2
		                                    ELSE C2.CUSTOM_NAME
		           END                                              AS CUSTOM_NAME
		         , A.DIV_CODE
		         , A.INOUT_TYPE_DETAIL
		         , A.WH_CODE
		         , A.TRNS_RATE
		         , A.MONEY_UNIT
		         , A.EXCHG_RATE_O
		         , A.ORDER_NUM
		         , A.ORDER_SEQ
		         , A.TAX_TYPE
		         , A.DVRY_CUST_CD
		         , A.LOT_NO
		         , A.PRICE_YN
		         , ISNULL(A.DISCOUNT_RATE, 0)                       AS DISCOUNT_RATE
		         , ISNULL(C1.STOCK_CARE_YN, 'Y')                    AS STOCK_CARE_YN
		         , C1.STOCK_UNIT
		         , A.ACCOUNT_YNC
		         , C3.DVRY_CUST_NM                                  AS DVRY_CUST_NAME
		         , A.INOUT_CODE                                     AS CUSTOM_CODE
		         , CASE WHEN @RefItem = '1' THEN C4.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C4.CUSTOM_NAME2
		                                    ELSE C4.CUSTOM_NAME
		           END                                              AS INOUT_NAME
		         , B.ORDER_PRSN
		         , CASE WHEN ISNULL(A.ORDER_NUM, '') = '' THEN C2.TAX_TYPE 
		                ELSE B.TAX_INOUT
		           END                                              AS SOF100_TAX_INOUT
		         , (CASE WHEN ISNULL(A.INOUT_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INOUT_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.INOUT_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.INOUT_DATE, 7, 2))
		            END)                                             AS INOUT_DATE         
		         , CASE WHEN ISNULL(M1.REF_CODE2, '') = '' THEN M1.SUB_CODE
		                ELSE M1.REF_CODE2
		           END                                              AS REF_CODE2
		         , A.AGENT_TYPE    
		         , A.PRICE_TYPE
		         , A.INOUT_FOR_WGT_P
		         , A.INOUT_WGT_P
		         , A.INOUT_FOR_VOL_P
		         , A.INOUT_VOL_P
		         , A.WGT_UNIT
		         , A.UNIT_WGT
		         , A.VOL_UNIT
		         , A.UNIT_VOL
		    FROM              BTR100T  A  WITH (NOLOCK, INDEX(BTR100T_IDX02)) 
		           LEFT  JOIN SOF100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.SALE_DIV_CODE
		                                               AND B.ORDER_NUM    = A.ORDER_NUM
		                                               AND ((@TAX_INOUT  != '' AND B.TAX_INOUT = @TAX_INOUT) OR (@TAX_INOUT = ''))
		           LEFT  JOIN SOF110T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                               AND C.DIV_CODE     = A.SALE_DIV_CODE
		                                               AND C.ORDER_NUM    = A.ORDER_NUM
		                                               AND C.SER_NO       = A.ORDER_SEQ
		                                               AND C.ITEM_CODE    = A.ITEM_CODE
		                                               AND C.SALE_Q       &lt; C.ORDER_UNIT_Q
		           LEFT  JOIN BPR100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                               AND C1.ITEM_CODE   = A.ITEM_CODE
		           LEFT  JOIN BCM100T  C2 WITH (NOLOCK) ON C2.COMP_CODE   = A.COMP_CODE
		                                               AND C2.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		           LEFT  JOIN SCM100T  C3 WITH (NOLOCK) ON C3.COMP_CODE   = A.COMP_CODE
		                                               AND C3.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		                                               AND CONVERT(NVARCHAR(08), C3.DVRY_CUST_SEQ) = A.DVRY_CUST_CD
		           LEFT  JOIN BCM100T  C4 WITH (NOLOCK) ON C4.COMP_CODE   = A.COMP_CODE
		                                               AND C4.CUSTOM_CODE = A.INOUT_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S007'                          /* 단가유형 */
		                                               AND M1.SUB_CODE    = A.INOUT_TYPE_DETAIL
		    WHERE  A.COMP_CODE         = @CompCode
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		    AND    A.SALE_DIV_CODE     = #{DIV_CODE} /* 마스터폼 정보 */
		    </if> 
		    <if test="@foren.Ognl@isNotEmpty(INOUT_TYPE)">
		    AND    A.INOUT_TYPE        = #{INOUT_TYPE}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
		    AND    A.SALE_CUSTOM_CODE  = #{CUSTOM_CODE} /*마스터 정보*/
		    </if>		    
		    AND    A.CREATE_LOC        = '1'
		    AND    A.ACCOUNT_YNC       = 'Y'
		    AND    A.INOUT_CODE_TYPE   = '4'
		    AND    A.ACCOUNT_Q         &lt; A.ORDER_UNIT_Q
		    AND    A.MONEY_UNIT        = N'KRW'
		    
		    <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">
		    AND    A.INOUT_DATE       &gt;= #{INOUT_DATE_FR}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">
		    AND    A.INOUT_DATE       &lt;= #{INOUT_DATE_TO}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">
		    AND    A.INOUT_NUM     LIKE #{INOUT_NUM} +'%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE)">
		    AND    A.ITEM_CODE     LIKE #{ITEM_CODE} +'%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		    AND    A.PROJECT_NO    LIKE #{PROJECT_NO} +'%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(INOUT_PRSN)">
		    AND    A.INOUT_PRSN    LIKE #{INOUT_PRSN} +'%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_NAME)">
		    AND    (CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
                 		 WHEN @RefItem = '2' THEN C1.ITEM_NAME2
                                     		 ELSE C1.ITEM_NAME
     		   		 END)        LIKE #{ITEM_NAME} +'%'
     		</if>   		 
		    ORDER BY C2.CUSTOM_NAME, A.INOUT_DATE, A.INOUT_NUM, A.INOUT_SEQ
		END	    	
	</select>
	
	<select id="ssa101ukrvServiceImpl.getCustCredit" parameterType="Map" resultType="rMap">
		/* USFuncKrv.CSFuncKr[fnGetCRedit] Query01 */
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		SELECT uniLITE.fnGetCredit( #{S_COMP_CODE}
		                          , #{DIV_CODE}	/* 사업장 */
		                          , #{CUSTOM_CODE}
		                          , #{SALE_DATE} /* 매출일 */
		                          , #{MONEY_UNIT} ) AS CREDIT	
	</select>
	
	
</mapper>