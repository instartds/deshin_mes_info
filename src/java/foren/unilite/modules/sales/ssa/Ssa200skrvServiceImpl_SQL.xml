<?xml version="1.0" encoding="UTF-8"?><!---->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssa200skrvServiceImpl">
	
	<select id="ssa200skrvServiceImpl.selectList1" parameterType="Map" resultType="rMap">
		
		<if test="rdoSelect1 == &quot;N&quot;">
			/*고객별 - 무역포함 않함*/
			/*ssa200skrv.Cssa200skrv[Ssa200nq] Query01*/
			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
			
				SELECT A.SALE_CUSTOM_CODE AS INOUT_CODE                                              
			         , (SELECT uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, X.CUSTOM_CODE) as CUSTOM_NAME
			              FROM BCM100T X WITH(NOLOCK)
			             WHERE X.CUSTOM_CODE = A.SALE_CUSTOM_CODE                                    
			               AND X.COMP_CODE   = A.COMP_CODE  ) AS INOUT_NAME                          
			         , unilite.fnGetUserdate(#{S_COMP_CODE},A.INOUT_DATE) AS INOUT_DATE                             
			         , A.ITEM_CODE                                                                   
			         , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID},D.ITEM_CODE) as ITEM_NAME             
			         , D.ITEM_NAME1
			         , D.SPEC                                                                        
			         , A.TRNS_RATE                                                                   
			         , A.ORDER_UNIT                                                                  
			         , A.ORDER_UNIT_Q  * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END)   AS ORDER_UNIT_Q     /*판매단위출고수량 */
			         --20191030 추가: ORDER_UNIT_P, ORDER_UNIT_O
			         , A.ORDER_UNIT_P
			         , A.ORDER_UNIT_O  * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS ORDER_UNIT_O
			         , A.ACCOUNT_Q     * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS    ACCOUNT_Q    /*판매단위매출수량 */
			         , (ISNULL(A.ORDER_UNIT_Q,0) - ISNULL(A.ACCOUNT_Q,0)) AS NO_ACCOUNT                       /*미매출수량       */
			         , (CASE WHEN A.INOUT_TYPE = '2'                                                 
			                      THEN (SELECT CODE_NAME             
			                              FROM BSA100T WITH(NOLOCK)
			                             WHERE MAIN_CODE = 'S007'                                    
			                               AND COMP_CODE = A.COMP_CODE                              
			                               AND SUB_CODE  = A.INOUT_TYPE_DETAIL)                      
			                 WHEN A.INOUT_TYPE = '3'                                                 
			                      THEN (SELECT CODE_NAME             
			                              FROM BSA100T WITH(NOLOCK)
			                             WHERE MAIN_CODE = 'S008'                                    
			                               AND COMP_CODE = A.COMP_CODE                              
			                               AND SUB_CODE  = A.INOUT_TYPE_DETAIL)                      
			             END) AS INOUT_TYPE_DETAIL                                                   
			          , A.INOUT_CODE_TYPE                                                            
					 , N'국내' AS DOM_FORIGN                                                      
					 , A.ACCOUNT_YNC                                                                     
					 , A.WH_CODE                                                                         
					 , A.INOUT_PRSN                                                                      
					 , (SELECT unilite.fnGetUserdate(#{S_COMP_CODE},X.ISSUE_REQ_DATE) AS ISSUE_REQ_DATE                 
						  FROM SRQ100T X WITH(NOLOCK)
						 WHERE X.DIV_CODE      = A.DIV_CODE                                              
						   AND X.ISSUE_REQ_NUM = A.ISSUE_REQ_NUM                                         
						   AND X.COMP_CODE     = A.COMP_CODE                              
						   AND X.ISSUE_REQ_SEQ = A.ISSUE_REQ_SEQ) AS ISSUE_REQ_DATE                      
					 , A.ISSUE_REQ_NUM                                                                   
					 , A.ORDER_NUM                                                                       
					 , (SELECT unilite.fnGetUserdate(#{S_COMP_CODE},X.DVRY_DATE) AS DVRY_DATE                           
						  FROM SOF110T X WITH(NOLOCK)
						 WHERE X.DIV_CODE  = A.DIV_CODE                                                  
						   AND X.ORDER_NUM = A.ORDER_NUM                                                 
						   AND X.COMP_CODE = A.COMP_CODE                              
						   AND X.SER_NO    = A.ORDER_SEQ) AS DVRY_DATE                                   
					 , A.LC_NUM                                                                          
					 , A.INOUT_NUM                                                                       
					 , A.INOUT_SEQ                                                                       
					 , A.PROJECT_NO                                                                      
					 , A.INOUT_METH                                                                      
					 , RTRIM(A.INOUT_NUM) + RTRIM(CONVERT(VARCHAR(4),A.INOUT_SEQ)) AS SORT_KEY              /*  SORT KEY용 */
					 ,A.SALE_DIV_CODE
				  FROM BTR100T A WITH(NOLOCK)
				   LEFT OUTER JOIN BCM100T C WITH(NOLOCK) ON A.SALE_CUSTOM_CODE = C.CUSTOM_CODE AND A.COMP_CODE = C.COMP_CODE 
				   INNER JOIN (SELECT AA.ITEM_CODE                                                      
									, uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID},AA.ITEM_CODE) as ITEM_NAME
									, AA.ITEM_NAME1
									, AA.COMP_CODE                                                      
									, AA.SPEC                                                           
									, AA.STOCK_UNIT                                                     
									, BB.ITEM_GROUP                                                     
									, BB.GROUP_NAME                                                     
									, AA.ITEM_LEVEL1                                                    
									, AA.ITEM_LEVEL2                                                    
									, AA.ITEM_LEVEL3                                                    
								 FROM BPR100T AA WITH(NOLOCK)
									   LEFT OUTER JOIN (SELECT DISTINCT X.ITEM_GROUP            
															 , X.COMP_CODE 
															 , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID},Y.ITEM_CODE) as GROUP_NAME 
														  FROM BPR100T X WITH(NOLOCK), BPR100T Y WITH(NOLOCK)
														 WHERE X.ITEM_GROUP IS NOT NULL         
														   AND X.COMP_CODE  = Y.COMP_CODE       
														   AND X.USE_YN     = 'Y'               
														   AND X.ITEM_GROUP = Y.ITEM_CODE       
													   ) BB   
														 ON AA.ITEM_CODE = BB.ITEM_GROUP        
														AND AA.COMP_CODE = BB.COMP_CODE         
							 ) D                                                                        
									ON A.ITEM_CODE = D.ITEM_CODE                                                
								   AND A.COMP_CODE = D.COMP_CODE                                                
						   INNER JOIN BPR200T E WITH(NOLOCK)
								   ON A.DIV_CODE  = E.DIV_CODE                                                  
								  AND A.ITEM_CODE = E.ITEM_CODE                                                 
								  AND A.COMP_CODE = E.COMP_CODE                                                 
				 WHERE A.COMP_CODE         = #{S_COMP_CODE}            		  /*COMP_CODE        */
				   AND A.CREATE_LOC      = '1'                                                                              /*영업*/
				   AND A.INOUT_CODE_TYPE = '4'                                                                              
				   AND (ISNULL(A.ORDER_UNIT_Q,0) - ISNULL(A.ACCOUNT_Q,0)) &lt;&gt; 0                                               /*미매출수량이존재하는경우만조회*/			    
				   AND A.INOUT_TYPE IN ('2','3')                                                           /*출고*/
				   <if test="@foren.Ognl@isNotEmpty(TXT_INOUT_PRSN)">			                                                            
				   		AND A.INOUT_PRSN         = #{TXT_INOUT_PRSN}           /*수불담당         */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(TXT_WH_CODE)">	
				   		AND A.WH_CODE            = #{TXT_WH_CODE}           	  /*창고             */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">	
				   		AND A.INOUT_DATE        &gt;= #{INOUT_DATE_FR}         /*출고일(FR)           */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">	
				   		AND A.INOUT_DATE        &lt;= #{INOUT_DATE_TO}         /*출고일(TO)           */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(INOUT_NUM_FR)">	
				   		AND A.INOUT_NUM         &gt;= #{INOUT_NUM_FR}         /*출고번호(FR)     */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(INOUT_NUM_TO)">	
				   		AND A.INOUT_NUM         &lt;= #{INOUT_NUM_TO}         /*출고번호(To)     */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">	
				   		AND A.PROJECT_NO        LIKE #{PROJECT_NO} + '%'      /*관리번호         */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">				                                                            
				   		AND C.AGENT_TYPE        = #{AGENT_TYPE}               /*고객분류         */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">	
				   		AND C.AREA_TYPE         = #{TXT_AREA_TYPE}            /*지역             */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(INOUT_TYPE_DETAIL)">	
				   		AND A.INOUT_TYPE_DETAIL = #{INOUT_TYPE_DETAIL}        /*출고유형         */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
				   		AND D.ITEM_LEVEL1       = #{TXTLV_L1}                 /*대분류           */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
				   		AND D.ITEM_LEVEL2       = #{TXTLV_L1}                 /*중분류           */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
				   		AND D.ITEM_LEVEL3       = #{TXTLV_L1}                 /*소분류           */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(TXT_ITEM_ACCOUNT)">				                                                            
				   		AND E.ITEM_ACCOUNT      = #{TXT_ITEM_ACCOUNT}         /*품목계정         */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">	
				   		AND A.SALE_DIV_CODE          = #{DIV_CODE}                 /*사업장           */
				   </if>
				   <if test="@foren.Ognl@isNotEmpty(ACCOUNT_YNC)">	
				   		AND A.ACCOUNT_YNC       = #{ACCOUNT_YNC}              /*매출대상         */
				   </if>
				   
				   /* 미구현 */
				   <if test="@foren.Ognl@isNotEmpty(ITEM_GROUP)">	
				  		AND D.ITEM_GROUP        LIKE #{ITEM_GROUP}    /*대표모델         */
				   </if>
				   
				   
					<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
					AND A.SALE_CUSTOM_CODE = #{CUSTOM_CODE}					/* 거래처코드  */
					</if>
					<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
					AND A.SALE_CUSTOM_CODE LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
					</if>
					<if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
					AND (SELECT uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, X.CUSTOM_CODE) as CUSTOM_NAME
				              FROM BCM100T X WITH(NOLOCK)
				             WHERE X.CUSTOM_CODE = A.SALE_CUSTOM_CODE
				               AND X.COMP_CODE   = A.COMP_CODE  ) LIKE '%' + #{CUSTOM_NAME} + '%'	/* 거래처명  */
					</if>
					
					<if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
					AND A.ITEM_CODE   = #{ITEM_CODE}						/* 품목코드  */
					</if>
					<if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
					AND A.ITEM_CODE   LIKE #{ITEM_CODE} + '%'			/* 품목코드  */
					</if>
					<if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
					AND uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID},D.ITEM_CODE)   LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
					</if>
				   
				   --수주마감된 건은 제외 20190306
				   AND NOT EXISTS (SELECT TOP 1 1 FROM SOF110T WITH (NOLOCK) WHERE COMP_CODE=A.COMP_CODE AND DIV_CODE=A.DIV_CODE AND ORDER_NUM=A.ORDER_NUM AND SER_NO=A.ORDER_SEQ AND ORDER_STATUS = 'Y')
				   
				    
				 ORDER BY A.INOUT_CODE, A.INOUT_DATE, A.ITEM_CODE, A.INOUT_TYPE_DETAIL, A.INOUT_CODE_TYPE 
						, A.INOUT_NUM, A.INOUT_SEQ
		</if>
		
		<if test="rdoSelect1 == &quot;Y&quot;">
			/*고객별, 무역포함*/
			/*ssa200skrv.Cssa200skrv[Ssa200Tnq] Query03*/
			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
			
			SELECT INOUT_CODE                                                    
			     , INOUT_NAME                                                    
			     , INOUT_DATE                                                    
			     , ITEM_CODE                                                     
			     , ITEM_NAME                                                     
			     , ITEM_NAME1                                                    
			     , SPEC                                                          
			     , TRNS_RATE                                                     
			     , ORDER_UNIT                                                    
			     , ORDER_UNIT_Q                                                
			     --20191030 추가: ORDER_UNIT_P, ORDER_UNIT_O
			     , ORDER_UNIT_P
			     , ORDER_UNIT_O 
			     , ACCOUNT_Q 
			     , (ISNULL(ORDER_UNIT_Q,0) - ISNULL(ACCOUNT_Q,0)) AS NO_ACCOUNT
			     , INOUT_TYPE_DETAIL                                             
			     , INOUT_CODE_TYPE                                               
			     , DOM_FORIGN                                                        
			     , ACCOUNT_YNC                                                       
			     , WH_CODE                                                           
			     , INOUT_PRSN                                                        
			     , ISSUE_REQ_DATE                                                    
			     , ISSUE_REQ_NUM                                                     
			     , ORDER_NUM                                                         
			     , DVRY_DATE                                                         
			     , LC_NUM                                                            
			     , INOUT_NUM                                                         
			     , INOUT_SEQ                                                         
			     , PROJECT_NO                                                        
			     , INOUT_METH                                                        
			     , SORT_KEY       
			     , SALE_DIV_CODE
			     --20200414 추가
			     , SALE_TYPE
			  FROM (SELECT A.ITEM_CODE                                               
			             , uniLITE.fnItemNameComp(#{S_COMP_CODE},#{S_USER_ID},D.ITEM_CODE) as ITEM_NAME
			             , D.ITEM_NAME1
			             , D.SPEC                                                           
			             , A.TRNS_RATE                                                      
			             , A.ORDER_UNIT                                                     
			             , A.ORDER_UNIT_Q  * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END)   AS ORDER_UNIT_Q      /* 판매단위수량 */
			             --20191030 추가: ORDER_UNIT_P, ORDER_UNIT_O
			             , A.ORDER_UNIT_P
			             , A.ORDER_UNIT_O * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS ORDER_UNIT_O
			             , A.ACCOUNT_Q   * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS    ACCOUNT_Q                                                     
			             , (CASE WHEN A.INOUT_TYPE = '2'                                    
			                          THEN (SELECT CODE_NAME
			                                  FROM BSA100T WITH(NOLOCK)
			                                 WHERE MAIN_CODE = 'S007'                       
			                                   AND COMP_CODE = A.COMP_CODE                  
			                                   AND SUB_CODE  = A.INOUT_TYPE_DETAIL)         
			                     WHEN A.INOUT_TYPE = '3'                                    
			                          THEN (SELECT CODE_NAME
			                                  FROM BSA100T WITH(NOLOCK)
			                                 WHERE MAIN_CODE = 'S008'                       
			                                   AND COMP_CODE = A.COMP_CODE                  
			                                   AND SUB_CODE  = A.INOUT_TYPE_DETAIL)         
			                 END) AS INOUT_TYPE_DETAIL                                      
			             , A.INOUT_CODE_TYPE                                                
			             , A.SALE_CUSTOM_CODE AS INOUT_CODE                                 
			             , (SELECT uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, X.CUSTOM_CODE) as CUSTOM_NAME
			                  FROM BCM100T X WITH(NOLOCK)
			                 WHERE X.CUSTOM_CODE = A.SALE_CUSTOM_CODE                    
			                   AND X.COMP_CODE   = A.COMP_CODE) AS INOUT_NAME                     
			             , unilite.fnGetUserdate(#{S_COMP_CODE},A.INOUT_DATE) AS INOUT_DATE                             
			             , N'국내' AS DOM_FORIGN                                                  
			             , A.ACCOUNT_YNC                                                                 
			             , A.WH_CODE                                                                     
			             , A.INOUT_PRSN                                                                  
			             , (SELECT unilite.fnGetUserdate(#{S_COMP_CODE},X.ISSUE_REQ_DATE) AS ISSUE_REQ_DATE             
			                  FROM SRQ100T X WITH(NOLOCK)
			                 WHERE X.DIV_CODE      = A.DIV_CODE                                          
			                   AND X.ISSUE_REQ_NUM = A.ISSUE_REQ_NUM                                     
			                   AND X.COMP_CODE     = A.COMP_CODE                                         
			                   AND X.ISSUE_REQ_SEQ = A.ISSUE_REQ_SEQ) AS ISSUE_REQ_DATE                  
			             , A.ISSUE_REQ_NUM                                                               
			             , A.ORDER_NUM                                                                   
			             , (SELECT unilite.fnGetUserdate(#{S_COMP_CODE},X.DVRY_DATE) AS DVRY_DATE                       
			                  FROM SOF110T X WITH(NOLOCK)
			                 WHERE X.DIV_CODE  = A.DIV_CODE                                              
			                   AND X.ORDER_NUM = A.ORDER_NUM                                             
			                   AND X.COMP_CODE = A.COMP_CODE                                         
			                   AND X.SER_NO    = A.ORDER_SEQ) AS DVRY_DATE                               
			             , A.LC_NUM                                                                      
			             , A.INOUT_NUM                                                                   
			             , A.INOUT_SEQ                                                                   
			             , A.PROJECT_NO                                                                  
			             , A.INOUT_METH                                                                  
			             , RTRIM(A.INOUT_NUM) + RTRIM(CONVERT(VARCHAR(4),A.INOUT_SEQ)) AS SORT_KEY          /*  SORT KEY용 */
			             , A.SALE_DIV_CODE
			             --20200414 추가
			             , A.SALE_TYPE
			          FROM BTR100T A WITH(NOLOCK)
			               LEFT OUTER JOIN BCM100T C WITH(NOLOCK) ON A.SALE_CUSTOM_CODE = C.CUSTOM_CODE AND A.COMP_CODE = C.COMP_CODE
			               INNER JOIN (SELECT AA.ITEM_CODE                                                      
			                                , uniLITE.fnItemNameComp(#{S_COMP_CODE},#{S_USER_ID},AA.ITEM_CODE) as ITEM_NAME
			                                , AA.ITEM_NAME1
			                                , AA.COMP_CODE                                                      
			                                , AA.SPEC                                                           
			                                , AA.STOCK_UNIT                                                     
			                                , BB.ITEM_GROUP                                                     
			                                , BB.GROUP_NAME                                                     
			                                , AA.ITEM_LEVEL1                                                    
			                                , AA.ITEM_LEVEL2                                                    
			                                , AA.ITEM_LEVEL3                                                    
			                             FROM BPR100T AA  WITH(NOLOCK)
                                           LEFT OUTER JOIN (SELECT DISTINCT X.ITEM_GROUP            
                                                                 , X.COMP_CODE 
                                                                 , uniLITE.fnItemNameComp(#{S_COMP_CODE},#{S_USER_ID},Y.ITEM_CODE) as GROUP_NAME 
                                                              FROM BPR100T X WITH(NOLOCK), BPR100T Y WITH(NOLOCK)
                                                             WHERE X.ITEM_GROUP IS NOT NULL         
                                                               AND X.COMP_CODE  = Y.COMP_CODE       
                                                               AND X.USE_YN     = 'Y'               
                                                               AND X.ITEM_GROUP = Y.ITEM_CODE       
                                                           ) BB   
                                                             ON AA.ITEM_CODE = BB.ITEM_GROUP        
                                                            AND AA.COMP_CODE = BB.COMP_CODE         
			                         ) D                                                                        
			                        ON A.ITEM_CODE = D.ITEM_CODE                                                
			                       AND A.COMP_CODE = D.COMP_CODE                                                
			               INNER JOIN BPR200T E WITH(NOLOCK)                                                                 
			                       ON A.DIV_CODE  = E.DIV_CODE                                                  
			                      AND A.ITEM_CODE = E.ITEM_CODE                                                 
			                      AND A.COMP_CODE = E.COMP_CODE                                                 
			 WHERE A.COMP_CODE         = #{S_COMP_CODE}            		  /*COMP_CODE        */
			   AND A.CREATE_LOC      = '1'                                                                               /*영업*/
			   AND A.INOUT_CODE_TYPE = '4'                                                                       
			    
			   AND A.INOUT_TYPE IN ('2','3')                                                            /*출고*/
			   
			   <if test="@foren.Ognl@isNotEmpty(TXT_INOUT_PRSN)">			                                                            
			   		AND A.INOUT_PRSN         = #{TXT_INOUT_PRSN}           /*수불담당         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXT_WH_CODE)">	
			   		AND A.WH_CODE            = #{TXT_WH_CODE}           	  /*창고             */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">	
			   		AND A.INOUT_DATE        &gt;= #{INOUT_DATE_FR}         /*출고일(FR)           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">	
			   		AND A.INOUT_DATE        &lt;= #{INOUT_DATE_TO}         /*출고일(TO)           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_NUM_FR)">	
			   		AND A.INOUT_NUM         &gt;= #{INOUT_NUM_FR}         /*출고번호(FR)     */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_NUM_TO)">	
			   		AND A.INOUT_NUM         &lt;= #{INOUT_NUM_TO}         /*출고번호(To)     */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">	
			   		AND A.PROJECT_NO        LIKE #{PROJECT_NO} + '%'      /*관리번호         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">				                                                            
			   		AND C.AGENT_TYPE        = #{AGENT_TYPE}               /*고객분류         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">	
			   		AND C.AREA_TYPE         = #{TXT_AREA_TYPE}            /*지역             */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_TYPE_DETAIL)">	
			   		AND A.INOUT_TYPE_DETAIL = #{INOUT_TYPE_DETAIL}        /*출고유형         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
			   		AND D.ITEM_LEVEL1       = #{TXTLV_L1}                 /*대분류           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
			   		AND D.ITEM_LEVEL2       = #{TXTLV_L1}                 /*중분류           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
			   		AND D.ITEM_LEVEL3       = #{TXTLV_L1}                 /*소분류           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXT_ITEM_ACCOUNT)">				                                                            
			   		AND E.ITEM_ACCOUNT      = #{TXT_ITEM_ACCOUNT}         /*품목계정         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">	
			   		AND A.SALE_DIV_CODE          = #{DIV_CODE}                 /*사업장           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(ACCOUNT_YNC)">	
			   		AND A.ACCOUNT_YNC       = #{ACCOUNT_YNC}              /*매출대상         */
			   </if>
			   
			   /* 미구현 */
			   <if test="@foren.Ognl@isNotEmpty(ITEM_GROUP)">	
			  		AND D.ITEM_GROUP        LIKE #{ITEM_GROUP}    /*대표모델         */
			   </if>
			   
			   
			   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			   		AND A.SALE_CUSTOM_CODE = #{CUSTOM_CODE}					/* 거래처코드  */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			   		AND A.SALE_CUSTOM_CODE LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
			   		AND (SELECT uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, X.CUSTOM_CODE) as CUSTOM_NAME
			                  FROM BCM100T X WITH(NOLOCK)
			                 WHERE X.CUSTOM_CODE = A.SALE_CUSTOM_CODE                    
			                   AND X.COMP_CODE   = A.COMP_CODE) LIKE '%' + #{CUSTOM_NAME} + '%'	/* 거래처명  */
			   </if>

			   <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
			   		AND A.ITEM_CODE   = #{ITEM_CODE}						/* 품목코드  */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
			   		AND A.ITEM_CODE   LIKE #{ITEM_CODE} + '%'			/* 품목코드  */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
			   		AND D.ITEM_NAME   LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
			   </if>
			    
			UNION                                                                    
			SELECT A.ITEM_CODE                                                       
			     , uniLITE.fnItemNameComp(#{S_COMP_CODE},#{S_USER_ID},D.ITEM_CODE) as ITEM_NAME 
			     , D.ITEM_NAME1
			     , D.SPEC                                                            
			     , A.TRNS_RATE                                                       
			     , A.ORDER_UNIT                                                      
			     , (ISNULL(A.INOUT_Q,0) / ISNULL(A.TRNS_RATE,1)) * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS ORDER_UNIT_Q             /*판매단위출고량*/
			     --20191030 추가: ORDER_UNIT_P, ORDER_UNIT_O
			     , A.ORDER_UNIT_P
			     , A.ORDER_UNIT_O * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS ORDER_UNIT_O
			     , (ISNULL(A.ACCOUNT_Q,0) / ISNULL(A.TRNS_RATE,1)) * (CASE WHEN A.INOUT_TYPE = '3' THEN -1 ELSE 1 END) AS ACCOUNT_Q              /*판매단위매출량*/
			     , (CASE WHEN A.INOUT_TYPE = '2'                                     
			                  THEN (SELECT CODE_NAME 
			                          FROM BSA100T WITH(NOLOCK)
			                         WHERE MAIN_CODE = 'S007'                        
			                           AND COMP_CODE = A.COMP_CODE                   
			                           AND SUB_CODE  = A.INOUT_TYPE_DETAIL)          
			             WHEN A.INOUT_TYPE = '3'                                     
			                  THEN (SELECT CODE_NAME 
			                          FROM BSA100T WITH(NOLOCK)
			                         WHERE MAIN_CODE = 'S008'                        
			                           AND COMP_CODE = A.COMP_CODE                   
			                           AND SUB_CODE  = A.INOUT_TYPE_DETAIL)          
			         END) AS INOUT_TYPE_DETAIL                                       
			     , A.INOUT_CODE_TYPE                                                 
			     , A.INOUT_CODE                                                      
			     , ISNULL((CASE A.INOUT_CODE_TYPE WHEN '4'                           
			                                           THEN (SELECT uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, X.CUSTOM_CODE) as CUSTOM_NAME      /*거래처*/
			                                                   FROM BCM100T X WITH(NOLOCK)
			                                                  WHERE X.CUSTOM_CODE = A.INOUT_CODE 
			                                                    AND X.COMP_CODE   = A.COMP_CODE  ) 
			                                      WHEN '3'                                       
			                                           THEN (SELECT X.TREE_NAME                                                                 /*사업장*/
			                                                   FROM BSA230T X WITH(NOLOCK)
			                                                  WHERE X.TREE_CODE  = A.INOUT_CODE  
			                                                    AND X.TYPE_LEVEL = A.DIV_CODE    
			                                                    AND X.COMP_CODE  = A.COMP_CODE)  
			                                           ELSE ''                                   
			                END), ' ') AS INOUT_NAME                                             
			     , unilite.fnGetUserdate(#{S_COMP_CODE},A.INOUT_DATE) AS INOUT_DATE                             
			     , N'국외' AS DOM_FORIGN                                              
			     , A.ACCOUNT_YNC                                                                 
			     , A.WH_CODE                                                                     
			     , A.INOUT_PRSN                                                                  
			     , (SELECT unilite.fnGetUserdate(#{S_COMP_CODE},X.ISSUE_REQ_DATE) AS ISSUE_REQ_DATE             
			          FROM SRQ100T X WITH(NOLOCK)
			         WHERE X.DIV_CODE      = A.DIV_CODE                                          
			           AND X.ISSUE_REQ_NUM = A.ISSUE_REQ_NUM                                     
			           AND X.COMP_CODE     = A.COMP_CODE                                         
			           AND X.ISSUE_REQ_SEQ = A.ISSUE_REQ_SEQ) AS ISSUE_REQ_DATE                  
			     , A.ISSUE_REQ_NUM                                                               
			     , A.ORDER_NUM                                                                   
			     , (SELECT unilite.fnGetUserdate(#{S_COMP_CODE},X.DVRY_DATE) AS DVRY_DATE                       
			          FROM SOF110T X WITH(NOLOCK)
			         WHERE X.DIV_CODE  = A.DIV_CODE                                              
			           AND X.ORDER_NUM = A.ORDER_NUM                                             
			           AND X.COMP_CODE = A.COMP_CODE                                             
			           AND X.SER_NO    = A.ORDER_SEQ) AS DVRY_DATE                               
			     , A.LC_NUM                                                                      
			     , A.INOUT_NUM                                                                   
			     , A.INOUT_SEQ                                                                   
			     , A.PROJECT_NO                                                                  
			     , A.INOUT_METH                                                                  
			     , RTRIM(A.INOUT_NUM) + RTRIM(CONVERT(VARCHAR(4),A.INOUT_SEQ)) AS SORT_KEY   /*  SORT KEY용*/
			     , A.SALE_DIV_CODE
			     --20200414 추가
			     , A.SALE_TYPE
			  FROM BTR100T A WITH(NOLOCK)
			               LEFT OUTER JOIN BTR200T B WITH(NOLOCK)
			                            ON A.INOUT_NUM = B.INOUT_NUM                      
			                           AND A.INOUT_SEQ = B.INOUT_SEQ                      
			               LEFT OUTER JOIN BCM100T C WITH(NOLOCK) ON A.INOUT_CODE = C.CUSTOM_CODE AND A.COMP_CODE = C.COMP_CODE 
			               INNER JOIN (SELECT AA.ITEM_CODE                                                      
			                                , uniLITE.fnItemNameComp(#{S_COMP_CODE},#{S_USER_ID},AA.ITEM_CODE) as ITEM_NAME
			                                , AA.COMP_CODE                                                      
			                                , AA.ITEM_NAME1
			                                , AA.SPEC                                                           
			                                , AA.STOCK_UNIT                                                     
			                                , BB.ITEM_GROUP                                                     
			                                , BB.GROUP_NAME                                                     
			                                , AA.ITEM_LEVEL1                                                    
			                                , AA.ITEM_LEVEL2                                                    
			                                , AA.ITEM_LEVEL3                                                    
			                             FROM BPR100T AA WITH(NOLOCK)
                                           LEFT OUTER JOIN (SELECT DISTINCT X.ITEM_GROUP            
                                                                 , X.COMP_CODE 
                                                                 , uniLITE.fnItemNameComp(#{S_COMP_CODE},#{S_USER_ID},Y.ITEM_CODE) as GROUP_NAME 
                                                              FROM BPR100T X WITH(NOLOCK), BPR100T Y WITH(NOLOCK)
                                                             WHERE X.ITEM_GROUP IS NOT NULL         
                                                               AND X.COMP_CODE  = Y.COMP_CODE       
                                                               AND X.USE_YN     = 'Y'               
                                                               AND X.ITEM_GROUP = Y.ITEM_CODE       
                                                           ) BB   
			                                                             ON AA.ITEM_CODE = BB.ITEM_GROUP        
			                                                            AND AA.COMP_CODE = BB.COMP_CODE         
			                         ) D                                                                        
			                        ON A.ITEM_CODE = D.ITEM_CODE                                                
			                       AND A.COMP_CODE = D.COMP_CODE                                                
			               INNER JOIN BPR200T E WITH(NOLOCK)
			                       ON A.DIV_CODE  = E.DIV_CODE                                                  
			                      AND A.ITEM_CODE = E.ITEM_CODE                                                 
			                      AND A.COMP_CODE = E.COMP_CODE                                                 
			 
			 WHERE A.COMP_CODE         = #{S_COMP_CODE}            		  /*COMP_CODE        */
			   AND A.CREATE_LOC      = '5'        					 /*수출*/
			   AND A.INOUT_CODE_TYPE = '4'
			   AND A.INOUT_TYPE      IN  ('2','3')        					 /*출고*/
			   <if test="@foren.Ognl@isNotEmpty(TXT_INOUT_PRSN)">			                                                            
			   		AND A.INOUT_PRSN         = #{TXT_INOUT_PRSN}           /*수불담당         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXT_WH_CODE)">	
			   		AND A.WH_CODE            = #{TXT_WH_CODE}           	  /*창고             */
			   </if>
			   
			   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			   		AND A.SALE_CUSTOM_CODE = #{CUSTOM_CODE}					/*매출처(출고처)코드*/
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			   		AND A.SALE_CUSTOM_CODE LIKE  #{CUSTOM_CODE} + '%'			/*매출처(출고처)코드*/
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
			   		 AND ISNULL((CASE A.INOUT_CODE_TYPE WHEN '4'                           
			                                           THEN (SELECT uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, X.CUSTOM_CODE) as CUSTOM_NAME      /*거래처*/
			                                                   FROM BCM100T X WITH(NOLOCK)
			                                                  WHERE X.CUSTOM_CODE = A.INOUT_CODE 
			                                                    AND X.COMP_CODE   = A.COMP_CODE  ) 
			                                      WHEN '3'                                       
			                                           THEN (SELECT X.TREE_NAME                                                                 /*사업장*/
			                                                   FROM BSA230T X WITH(NOLOCK)
			                                                  WHERE X.TREE_CODE  = A.INOUT_CODE  
			                                                    AND X.TYPE_LEVEL = A.DIV_CODE    
			                                                    AND X.COMP_CODE  = A.COMP_CODE)  
			                                           ELSE ''                                   
			                END), ' ') LIKE '%' + #{CUSTOM_NAME} + '%'	/* 매출처(출고처)명  */
			   </if>
			   
			   <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
			   AND A.ITEM_CODE   = #{ITEM_CODE}						/* 품목코드  */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
			   AND A.ITEM_CODE   LIKE #{ITEM_CODE} + '%'			/* 품목코드  */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
			   AND uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID},D.ITEM_CODE)   LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
			   </if>

			   <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">	
			   		AND A.INOUT_DATE        &gt;= #{INOUT_DATE_FR}         /*출고일(FR)           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">	
			   		AND A.INOUT_DATE        &lt;= #{INOUT_DATE_TO}         /*출고일(TO)           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_NUM_FR)">	
			   		AND A.INOUT_NUM         &gt;= #{INOUT_NUM_FR}         /*출고번호(FR)     */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_NUM_TO)">	
			   		AND A.INOUT_NUM         &lt;= #{INOUT_NUM_TO}         /*출고번호(To)     */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">	
			   		AND A.PROJECT_NO        LIKE #{PROJECT_NO} + '%'      /*관리번호         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">				                                                            
			   		AND C.AGENT_TYPE        = #{AGENT_TYPE}               /*고객분류         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">	
			   		AND C.AREA_TYPE         = #{TXT_AREA_TYPE}            /*지역             */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(INOUT_TYPE_DETAIL)">	
			   		AND A.INOUT_TYPE_DETAIL = #{INOUT_TYPE_DETAIL}        /*출고유형         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
			   		AND D.ITEM_LEVEL1       = #{TXTLV_L1}                 /*대분류           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
			   		AND D.ITEM_LEVEL2       = #{TXTLV_L1}                 /*중분류           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXTLV_L1)">	
			   		AND D.ITEM_LEVEL3       = #{TXTLV_L1}                 /*소분류           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(TXT_ITEM_ACCOUNT)">				                                                            
			   		AND E.ITEM_ACCOUNT      = #{TXT_ITEM_ACCOUNT}         /*품목계정         */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">	
			   		AND A.SALE_DIV_CODE          = #{DIV_CODE}                 /*사업장           */
			   </if>
			   <if test="@foren.Ognl@isNotEmpty(ACCOUNT_YNC)">	
			   		AND A.ACCOUNT_YNC       = #{ACCOUNT_YNC}              /*매출대상         */
			   </if>
			   
			   /* 미구현 */
			   <if test="@foren.Ognl@isNotEmpty(ITEM_GROUP)">	
			  		AND D.ITEM_GROUP        LIKE #{ITEM_GROUP}    		/*대표모델         */
			   </if>
			  
			) XXX
			LEFT JOIN BSA100T Z WITH(NOLOCK) ON Z.COMP_CODE = #{S_COMP_CODE}
			                                AND Z.MAIN_CODE = 'S002'
			                                AND Z.SUB_CODE  = XXX.SALE_TYPE
<!-- 20200414 추가 -->
		<if test="NATION_INOUT == &quot;1&quot;">
			                                AND Z.REF_CODE2 = '1'
		</if>
		<if test="NATION_INOUT == &quot;2&quot;">
			                                AND Z.REF_CODE2 = '2'
		</if>
			 WHERE (ISNULL(XXX.ORDER_UNIT_Q,0) - ISNULL(XXX.ACCOUNT_Q,0)) &lt;&gt; 0                  /*미매출수량이존재하는경우만조회*/
			   AND Z.COMP_CODE IS NOT NULL
			 ORDER BY XXX.INOUT_CODE, XXX.INOUT_DATE, XXX.ITEM_CODE, XXX.INOUT_TYPE_DETAIL, XXX.INOUT_CODE_TYPE
			        , XXX.INOUT_NUM, XXX.INOUT_SEQ
		</if>		
    </select>
</mapper>