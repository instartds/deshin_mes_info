<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssa600skrvServiceImpl">
	<select id="ssa600skrvServiceImpl.selectList1" parameterType="Map" resultType="rMap">
		/* ssa600skrv.Cssa600skrv[ssa600nq1] Query03 */
		BEGIN
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		
		DECLARE @START_TIME DATETIME
			  , @END_TIME   DATETIME
			  , @DIFF_TIME  NUMERIC(10, 0)
		
		SET @START_TIME = GETDATE()
		
		SELECT
			   B.CUSTOM_CODE
			 , uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE) AS CUSTOM_NAME
			<if test="RDO == &quot;1&quot;">
			 , B.MONEY_UNIT
			</if>
			<if test="RDO == &quot;2&quot;">
			 ,(SELECT TOP 1 SUB_CODE FROM BSA100T WHERE COMP_CODE=#{S_COMP_CODE} AND MAIN_CODE='B004' AND REF_CODE1='Y') as MONEY_UNIT
			</if>
			 , SUM(ISNULL(B.UN_COLLECT_AMT,0)) UN_COLLECT_AMT											  
			 , SUM(ISNULL(C.SALE_AMT_O,0)) AS SALE_LOC_AMT_I											   
			 , SUM(ISNULL(C.TAX_AMT_O,0)) TAX_AMT_O														
			 , SUM(ISNULL(C.ENURI_AMT_I,0)) ENURI_AMT_I													
			 , SUM(ISNULL(C.ENURI_TAX_AMT_O,0)) ENURI_TAX_AMT_O											
			 , SUM(ISNULL((C.SALE_AMT_O + C.TAX_AMT_O + C.ENURI_AMT_I + C.ENURI_TAX_AMT_O),0)) TOT_SALE_AMT
			 , SUM(ISNULL(D.CASH_COLLECT_AMT,0)) CASH_COLLECT_AMT										  
			 , SUM(ISNULL(D.NOTE_COLLECT_AMT,0)) NOTE_COLLECT_AMT										  
			 , SUM(ISNULL(D.DIS_COLLECT_AMT,0)) DIS_COLLECT_AMT											
			 , SUM(ISNULL(D.UP_COLLECT_AMT,0)) UP_COLLECT_AMT											  
			 , SUM((ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))) TOT_COLLECT_AMT
			 , SUM((ISNULL(B.UN_COLLECT_AMT,0)															
				 + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
				 - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0))) GRANT_UN_COLLECT_AMT
			 , SUM(ISNULL(C.CARD_AMT_O,0)) CARD_AMT_O	
			 , B.SALE_PRSN																			
			 , B.DIV_CODE																			 
			 , B.AGENT_TYPE																		   
			 , B.AREA_TYPE																			
			 , B.MANAGE_CUSTOM AS M_CUSTOM_CODE													   
			 , uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.MANAGE_CUSTOM)   AS M_CUSTOM_NAME
			
			 <if test="RDO == &quot;1&quot;">
			 , uniLITE.fnGetCredit( #{S_COMP_CODE}	, #{DIV_CODE}   /* 사업장 */	, B.CUSTOM_CODE	, #{BILL_TO_DATE}, B.MONEY_UNIT) AS REMAIN_CREDIT
			</if>
			<if test="RDO == &quot;2&quot;">
			 , uniLITE.fnGetCredit( #{S_COMP_CODE}	, #{DIV_CODE}   /* 사업장 */	, B.CUSTOM_CODE	, #{BILL_TO_DATE}
			 						, (SELECT TOP 1 SUB_CODE FROM BSA100T WHERE COMP_CODE=#{S_COMP_CODE} AND MAIN_CODE='B004' AND REF_CODE1='Y')) AS REMAIN_CREDIT
			</if>
			 , CASE WHEN ISNULL(A.CREDIT_YMD,'') &lt;&gt; '' AND A.CREDIT_YMD &lt; #{BILL_TO_DATE} THEN 0
					ELSE A.CREDIT_AMT
					END															AS CREDIT_AMT
		  FROM (SELECT DISTINCT	A.CUSTOM_CODE
					 , uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, A.CUSTOM_CODE) as CUSTOM_NAME
					 , A.COMP_CODE
					 , A.AGENT_TYPE
					 , A.AREA_TYPE
					 , A.MANAGE_CUSTOM ,B.DIV_CODE
					 , A.BUSI_PRSN AS SALE_PRSN
					 , UNCOLLECT_AMT AS UN_COLLECT_AMT
					 , B.MONEY_UNIT
				  FROM SAR200T B WITH(NOLOCK)
							   INNER JOIN BCM100T A	WITH(NOLOCK)											   
									   ON A.CUSTOM_CODE = B.CUSTOM_CODE							   
									  AND A.COMP_CODE   = B.COMP_CODE								 
							   LEFT JOIN BCM100T C	WITH(NOLOCK)											   
									   ON A.MANAGE_CUSTOM = C.CUSTOM_CODE							 
									  AND A.COMP_CODE	 = C.COMP_CODE		
		  
			<if test="RDO == &quot;1&quot;">
				LEFT JOIN fnGetBalance4CustomTbl(#{S_COMP_CODE}, #{DIV_CODE}, #{CUSTOM_CODE}, #{BILL_FR_DATE}, '', '3') D ON B.DIV_CODE=D.DIV_CODE AND A.CUSTOM_CODE=D.CUSTOM_CODE AND B.MONEY_UNIT=D.MONEY_UNIT	/* 발생기준화폐 */
			</if>
			<if test="RDO == &quot;2&quot;">
				LEFT JOIN fnGetBalanceLocal4CustomTbl(#{S_COMP_CODE}, #{DIV_CODE}, #{CUSTOM_CODE}, #{BILL_FR_DATE}, '', '3') D ON B.DIV_CODE=D.DIV_CODE AND A.CUSTOM_CODE=D.CUSTOM_CODE AND B.MONEY_UNIT=D.MONEY_UNIT	/* 자사기준화폐 */
			</if>
				WHERE B.DIV_CODE = #{DIV_CODE}
				 <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
				  AND A.COMP_CODE		= #{S_COMP_CODE}  
				 </if>
				 <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
				  AND A.AGENT_TYPE	   = #{AGENT_TYPE}
				 </if>
				 <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
				  AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
				 </if>
				 
				<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
					AND A.MANAGE_CUSTOM = #{MANAGE_CUSTOM_CODE}
				</if>
				<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
					AND A.MANAGE_CUSTOM LIKE #{MANAGE_CUSTOM_CODE} + '%'
				</if>
				<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
					AND ISNULL(C.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
				</if>		 

		 )  B
		 LEFT OUTER JOIN BCM100T A WITH(NOLOCK)
		                            ON A.COMP_CODE		= B.COMP_CODE
									AND A.CUSTOM_CODE	= B.CUSTOM_CODE
		/* 매출조회 */
					FULL OUTER JOIN (																 
					/* 무역포함. */
				   (SELECT	X.COMP_CODE, X.CUSTOM_CODE,X.DIV_CODE,X.MONEY_UNIT									  
						 , SUM(X.SALE_AMT_O) AS SALE_AMT_O												 /* 환산매출액 */
						 , SUM(X.TAX_AMT_O) AS TAX_AMT_O												   /* 세액 */
						 , SUM(X.ENURI_AMT_I) AS ENURI_AMT_I											   /* 에누리금액 */
						 , SUM(X.ENURI_TAX_AMT_O) AS ENURI_TAX_AMT_O									   /* 에누리세액 */
						 , SUM(X.CARD_AMT_O) AS CARD_AMT_O												 /* 카드매출액+세액 */
					  FROM																			
		
				   (SELECT A.COMP_CODE															  
						 , A.CUSTOM_CODE																 
						 , B.DIV_CODE																 
						 , B.SALE_AMT_O												   /* 환산매출액 */
						 , B.TAX_AMT_O													/* 세액 */
			
						 , B.ENURI_AMT_I												  /* 에누리금액 */
			
			
						 , B.ENURI_TAX_AMT_O											  /* 에누리세액  */
			
						 , B.CARD_AMT_O												   /* 카드매출액+세액 */
						 , B.MONEY_UNIT															   
					  FROM BCM100T A WITH(NOLOCK)
					       INNER JOIN ( SELECT A.COMP_CODE															  
											 , A.SALE_CUSTOM_CODE																 
											 , A.DIV_CODE																 
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN 0							
																						ELSE B.${sFld_SaleAmt}				  
														   END),0) SALE_AMT_O												   /* 환산매출액 */
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN 0							
																						ELSE B.TAX_AMT_O				  
														   END),0) TAX_AMT_O													/* 세액 */
								
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN B.${sFld_SaleAmt}				  
														   END),0) ENURI_AMT_I												  /* 에누리금액 */
								
								
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN B.TAX_AMT_O				  
														   END),0) ENURI_TAX_AMT_O											  /* 에누리세액  */
								
											 , ISNULL(SUM(CASE A.BILL_TYPE WHEN '40'									  
																				THEN B.${sFld_SaleAmt} +B.TAX_AMT_O			 
														   END),0) CARD_AMT_O												   /* 카드매출액+세액 */
											 , A.MONEY_UNIT	
											 FROM SSA100T A WITH(NOLOCK)
											      INNER JOIN SSA110T B WITH(NOLOCK) ON A.COMP_CODE = B.COMP_CODE
											                                       AND A.DIV_CODE  = B.DIV_CODE
																			       AND A.BILL_NUM  = B.BILL_NUM
					   						WHERE A.COMP_CODE		= #{S_COMP_CODE}
											  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
											   AND A.DIV_CODE		 = #{DIV_CODE}
											  </if>		
											  <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)"> 
											   AND A.SALE_DATE	  &gt;= #{BILL_FR_DATE}
											  </if> 
											  <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)"> 
											   AND A.SALE_DATE	  &lt;= #{BILL_TO_DATE}
											  </if> 
											  
											  GROUP BY A.COMP_CODE, A.SALE_CUSTOM_CODE,A.DIV_CODE, A.MONEY_UNIT	
																			    ) AS B ON B.COMP_CODE        = A.COMP_CODE
											                                          AND B.SALE_CUSTOM_CODE = A.CUSTOM_CODE
						   LEFT  JOIN BCM100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
						                                    AND D.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '')	
					   WHERE A.COMP_CODE		= #{S_COMP_CODE}

					  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)"> 
					   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
					  </if> 
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE = #{CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
						</if>					  

					  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)"> 
					   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
					  </if> 
					  
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(D.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
						</if>	
											  

					 							  
		
				 /* 무역포함. */
						 UNION
						 
						SELECT A.COMP_CODE, A.CUSTOM_CODE				
							 , B.DIV_CODE								
							 , B.SALE_AMT_O	                                    /* 매출액 */
							 , 0 AS TAX_AMT_O									/* 세액 */
							 , 0 AS ENURI_AMT_I								  /* 에누리금액 */
							 , 0 AS ENURI_TAX_AMT_O							  /* 에누리세액 */
							 , 0 AS CARD_AMT_O								   /* 카드매출액+세액 */
							 , B.AMT_UNIT AS MONEY_UNIT				  
						  FROM BCM100T A WITH(NOLOCK)
						       INNER JOIN (SELECT A.COMP_CODE, A.DIV_CODE, A.IMPORTER, B.AMT_UNIT, ISNULL(SUM(B.BL_AMT ),0) AS SALE_AMT_O
							                 FROM TEA100T A WITH(NOLOCK)
											      INNER JOIN TED100T B WITH(NOLOCK) ON A.COMP_CODE = B.COMP_CODE
												                                   AND A.DIV_CODE  = B.DIV_CODE
							                                                       AND A.SO_SER_NO = B.SO_SER_NO
							                 WHERE A.COMP_CODE = #{S_COMP_CODE}
											  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">				
											   AND A.DIV_CODE		 = #{DIV_CODE}
											  </if>		
											  <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)"> 
											   AND B.BL_DATE		&gt;= #{BILL_FR_DATE}
											  </if> 
											  <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)"> 
											   AND B.BL_DATE		&lt;= #{BILL_TO_DATE}
											  </if>										   

											 GROUP BY A.COMP_CODE, A.DIV_CODE, A.IMPORTER, B.AMT_UNIT) AS B ON B.COMP_CODE = A.COMP_CODE
											                                                   AND B.IMPORTER  = A.CUSTOM_CODE
								LEFT JOIN BCM100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
								                                AND D.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '')			                                                   
											                                                   
											                                                   
						 WHERE A.COMP_CODE = #{S_COMP_CODE}
						  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)"> 
						   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
						  </if> 
 						  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
						   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
						  </if> 
						  
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE = #{CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
						</if>	
						
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(D.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
						</if>				 
 
						 UNION										   
						SELECT	A.COMP_CODE, A.CUSTOM_CODE							 
							 , C.DIV_CODE								
							 , ISNULL(SUM(C.${sFld_PassAmt}  ),0) AS SALE_AMT_O /*환산매출액 */
							 , 0 AS TAX_AMT_O									/*세액 */
							 , 0 AS ENURI_AMT_I								  /*에누리금액 */
							 , 0 AS ENURI_TAX_AMT_O							  /*에누리세액 */
							 , 0 AS CARD_AMT_O								   /*카드매출액+세액 */
							 , C.AMT_UNIT AS MONEY_UNIT				  
						  FROM BCM100T A WITH(NOLOCK)
                               INNER JOIN TEC120T C	WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
                                                                AND C.APPLICANT = A.CUSTOM_CODE	
							   LEFT  JOIN BCM100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
								                                 AND D.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '')                                                                
						 <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">				
						   AND C.DIV_CODE		 = #{DIV_CODE}
						 </if>
						 <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
						   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
						 </if>  
						 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">  
						   AND C.APPLICANT LIKE #{CUSTOM_CODE} + '%'
						 </if>  
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE = #{CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
						</if>	
						
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(D.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
						</if>
						 <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">  
						   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
						 </if> 
						 <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)">  
						   AND C.ACCEPT_DATE	&gt;= #{BILL_FR_DATE}
						 </if>  
						 <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)">  
						   AND C.ACCEPT_DATE	&lt;= #{BILL_TO_DATE}
						 </if>  
						 GROUP BY A.COMP_CODE,A.CUSTOM_CODE,C.DIV_CODE, C.AMT_UNIT) X
			 GROUP BY X.COMP_CODE, X.CUSTOM_CODE,X.DIV_CODE, X.MONEY_UNIT 
					)) C												 
					   ON B.CUSTOM_CODE = C.CUSTOM_CODE				  
					  AND B.MONEY_UNIT  = C.MONEY_UNIT				   
					  AND B.COMP_CODE   = C.COMP_CODE					
		/* 수금조회 */
						FULL OUTER JOIN								  
			
				   (													 
		
				   (SELECT	X.COMP_CODE								   
						 , X.CUSTOM_CODE								 
						 , X.DIV_CODE									
						 , X.MONEY_UNIT								  
						 , SUM(X.CASH_COLLECT_AMT) AS CASH_COLLECT_AMT   
						 , SUM(X.NOTE_COLLECT_AMT) AS NOTE_COLLECT_AMT   
						 , SUM(X.DIS_COLLECT_AMT) AS DIS_COLLECT_AMT	 
						 , SUM(X.UP_COLLECT_AMT) AS UP_COLLECT_AMT	   
					  FROM											   
		
						   (SELECT   
								   A.COMP_CODE						   
								 , A.CUSTOM_CODE						 
								 , D.DIV_CODE							
								 , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '30'							
																	   THEN 0						  
																  WHEN '50'							
																	   THEN 0						  
																  WHEN '60'							
																	   THEN 0						  
																  WHEN '71'							
																	   THEN 0						  
																  WHEN '80'							
																	   THEN 0						  
																	   ELSE CASE WHEN F.REF_CODE6 = 'Y' THEN D.${sFld_CollectAmt}   * (-1)
																				 ELSE D.${sFld_CollectAmt}   
																			END
												END),0) CASH_COLLECT_AMT							   
								  , ISNULL(SUM(CASE WHEN F.COLLECT_TYPE='30' OR F.COLLECT_TYPE='71'	
														 THEN D.${sFld_CollectAmt}							  
												END),0) NOTE_COLLECT_AMT							   
								  , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '50'						   
																		THEN  D.${sFld_CollectAmt}			  
												END),0) DIS_COLLECT_AMT								
								  , ISNULL(SUM(CASE  F.COLLECT_TYPE WHEN '60'						  
																		 THEN  D.${sFld_CollectAmt}			 
												END),0) UP_COLLECT_AMT								 
								  , D.MONEY_UNIT	
   							   FROM BCM100T A WITH(NOLOCK)
							        INNER JOIN SCO100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE            
									                                 AND D.CUSTOM_CODE = A.CUSTOM_CODE											  
									INNER JOIN (  SELECT COMP_CODE												  
													  , DIV_CODE												   
													  , CUSTOM_CODE												
													  , MONEY_UNIT												 
												   FROM SAR200T	WITH(NOLOCK)												
												  WHERE COMP_CODE = #{S_COMP_CODE}						   
												  GROUP BY COMP_CODE,DIV_CODE, CUSTOM_CODE, MONEY_UNIT) E ON E.COMP_CODE = D.COMP_CODE
												                                                         AND E.DIV_CODE  = D.DIV_CODE
																										 AND E.CUSTOM_CODE = D.CUSTOM_CODE
																										 AND E.MONEY_UNIT= ISNULL(D.MONEY_UNIT,'KRW')	 				
									INNER JOIN (SELECT SUB_CODE												 
													, (CASE ISNULL(REF_CODE1,'') WHEN ''					   
																					  THEN SUB_CODE					  
																					  ELSE REF_CODE1					 
														END) AS COLLECT_TYPE											 
													,  ISNULL(REF_CODE6, '') AS REF_CODE6
												 FROM BSA100T															
												WHERE MAIN_CODE = 'S017'												 
												  AND COMP_CODE = #{S_COMP_CODE}								   
												  AND SUB_CODE != '$') F ON F.SUB_CODE		   = D.COLLECT_TYPE		
												                        AND F.COLLECT_TYPE	   != '80'	
							   LEFT  JOIN BCM100T G WITH(NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
								                                 AND G.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '')  											 
							  WHERE (D.DISHONOR_DATE	 IS NULL OR D.DISHONOR_DATE = '')						
							   <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
								AND D.COMP_CODE		= #{S_COMP_CODE}
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(DIV_CODE)"> 
								AND D.DIV_CODE		 = #{DIV_CODE}
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">  
								AND A.AGENT_TYPE	   = #{AGENT_TYPE}
							   </if> 
								<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
									AND D.CUSTOM_CODE = #{CUSTOM_CODE}
								</if>
								<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
									AND D.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
								</if>
								<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
								</if>
							   <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)"> 
								AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
							   </if> 
								<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
								</if>
								<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
								</if>
								<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(G.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
								</if>							   
							   <if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE)"> 
								AND A.MANAGE_CUSTOM	LIKE #{MANAGE_CUSTOM_CODE} + '%'
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)"> 
								AND D.COLLECT_DATE   &gt;= #{BILL_FR_DATE}
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)"> 
								AND D.COLLECT_DATE   &lt;= #{BILL_TO_DATE}
							   </if> 
								
							  GROUP BY A.COMP_CODE, A.CUSTOM_CODE,D.DIV_CODE,D.MONEY_UNIT
		
			/*  무역포함. */
						 UNION													   
						SELECT	A.COMP_CODE										   
							 , A.CUSTOM_CODE										 
							 , D.DIV_CODE											
							 , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '20'			  
																   THEN 0			
																   ELSE D.${sFld_PayAmt}	 
										   END),0) CASH_COLLECT_AMT				  
							 , ISNULL(SUM(CASE WHEN F.COLLECT_TYPE = '20'			
													THEN D.${sFld_PayAmt}					
										   END),0) NOTE_COLLECT_AMT				  
							 , 0 AS DIS_COLLECT_AMT								  
							 , 0 AS UP_COLLECT_AMT								   
							 , D.MONEY_UNIT		
  						  FROM BCM100T A WITH(NOLOCK)											 
							   INNER JOIN TEE100T D	WITH(NOLOCK) ON D.COMP_CODE = A.COMP_CODE
							                                    AND D.IMPORTER	= A.CUSTOM_CODE							                      										 
							   INNER JOIN ( SELECT COMP_CODE, DIV_CODE									  
												 , CUSTOM_CODE								   
												 , MONEY_UNIT									
											  FROM SAR200T WITH(NOLOCK)								   
											 WHERE COMP_CODE = #{S_COMP_CODE} 
											 GROUP BY COMP_CODE, DIV_CODE,CUSTOM_CODE,MONEY_UNIT) E	ON E.COMP_CODE   = D.COMP_CODE
											                                                       AND E.DIV_CODE    = D.DIV_CODE
																								   AND E.MONEY_UNIT  = D.MONEY_UNIT
																								   AND E.CUSTOM_CODE = D.IMPORTER	 
							   INNER JOIN ( SELECT SUB_CODE									  
												 , (CASE ISNULL(REF_CODE1,'') WHEN ''			
																				   THEN '10'	 
																				   ELSE REF_CODE1
													 END) AS COLLECT_TYPE						
											  FROM BSA100T WITH(NOLOCK)								   
											 WHERE MAIN_CODE = 'T060'
											   AND COMP_CODE = #{S_COMP_CODE} 						
											   AND SUB_CODE != '$') F ON F.SUB_CODE	 = D.COLET_TYPE
							   LEFT  JOIN BCM100T G WITH(NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
								                                 AND G.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '')  											   
						 WHERE D.NEGO_TYPE	= '1'  
						  <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">								
						   AND D.COMP_CODE		= #{S_COMP_CODE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)"> 
						   AND D.DIV_CODE		 = #{DIV_CODE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)"> 
						   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
						  </if> 
						  
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE = #{CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
							AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
						</if>						  
						  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)"> 
						   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
						  </if> 
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
						</if>
						<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
						</if>
						<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
							AND ISNULL(G.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
						</if>
						  <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)"> 
						   AND D.NEGO_DATE	   &gt;= #{BILL_FR_DATE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)"> 
						   AND D.NEGO_DATE	   &lt;= #{BILL_TO_DATE}
						  </if> 
						 GROUP BY A.COMP_CODE, A.CUSTOM_CODE,D.DIV_CODE,D.MONEY_UNIT					  
					 UNION															   
					SELECT	A.COMP_CODE												   
						 , A.CUSTOM_CODE												 
						 , D.DIV_CODE													
						 , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '20'					  
															   THEN 0					
															   ELSE D.${sFld_PayAmt}			 
									   END),0) CASH_COLLECT_AMT						  
						 , ISNULL(SUM(CASE WHEN F.COLLECT_TYPE='20'					  
												THEN D.${sFld_PayAmt}							
									   END),0) NOTE_COLLECT_AMT						  
						 , 0 AS DIS_COLLECT_AMT										  
						 , 0 AS UP_COLLECT_AMT										   
						 , D.MONEY_UNIT												  
					  FROM BCM100T A WITH(NOLOCK)
					       INNER JOIN TEE100T D	WITH(NOLOCK) ON D.COMP_CODE = A.COMP_CODE
					                                        AND D.IMPORTER  = A.CUSTOM_CODE								  
						   INNER JOIN ( SELECT COMP_CODE, DIV_CODE											  
											 , CUSTOM_CODE										   
											 , MONEY_UNIT											
										  FROM SAR200T WITH(NOLOCK)										   
										 WHERE COMP_CODE =#{S_COMP_CODE} 
										 GROUP BY COMP_CODE, DIV_CODE,CUSTOM_CODE,MONEY_UNIT) E	ON E.COMP_CODE   = D.COMP_CODE
										                                                       AND E.DIV_CODE    = D.DIV_CODE
										                                                       AND E.MONEY_UNIT  = E.MONEY_UNIT
										                                                       AND E.CUSTOM_CODE = D.IMPORTER			 
						   INNER JOIN ( SELECT SUB_CODE, (CASE ISNULL(REF_CODE1,'') WHEN ''		  
																			 THEN '10'   
																			 ELSE REF_CODE1
											   END) AS COLLECT_TYPE					  
										  FROM BSA100T	WITH(NOLOCK)										   
										 WHERE COMP_CODE= #{S_COMP_CODE} 
										   AND MAIN_CODE = 'T060'									
										   AND SUB_CODE != '$') F ON F.SUB_CODE	= D.COLET_TYPE		
						   LEFT  JOIN BCM100T G WITH(NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
				                                 			 AND G.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '') 
					 WHERE D.NEGO_TYPE   = '2'   
					  <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">										  
					   AND D.COMP_CODE		= #{S_COMP_CODE}
					  </if> 
					  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">  
					   AND D.DIV_CODE		 = #{DIV_CODE}
					  </if> 
					  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">  
					   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
					  </if> 
					<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
						AND A.CUSTOM_CODE = #{CUSTOM_CODE}
					</if>
					<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
						AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
					</if>
					<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
						AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
					</if> 
					  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">  
					   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
					  </if> 
					<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
						AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
					</if>
					<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
						AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
					</if>
					<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
						AND ISNULL(G.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
					</if>
					  <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)">  
					   AND D.PAY_DATE	   &gt;= #{BILL_FR_DATE}
					  </if> 
					  <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)">  
					   AND D.PAY_DATE	   &lt;= #{BILL_TO_DATE}
					  </if> 
					 GROUP BY A.COMP_CODE, A.CUSTOM_CODE,D.DIV_CODE,D.MONEY_UNIT) X				   
			 GROUP BY X.COMP_CODE, X.CUSTOM_CODE,X.DIV_CODE,X.MONEY_UNIT					  
			
		 )) D																	 
			 ON B.CUSTOM_CODE = D.CUSTOM_CODE												
			AND B.MONEY_UNIT  = D.MONEY_UNIT												 
			AND B.COMP_CODE   = D.COMP_CODE												  
		  WHERE B.COMP_CODE = #{S_COMP_CODE}
		    AND	B.DIV_CODE	= #{DIV_CODE}

			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
				AND B.CUSTOM_CODE = #{CUSTOM_CODE}
			</if>
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
				AND B.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
			</if>
			<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
				AND uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE) LIKE '%' + #{CUSTOM_NAME} + '%' 
			</if>
		  
			<if test="@foren.Ognl@isNotEmpty(ORDER_PRSN)">
				AND B.SALE_PRSN	= #{ORDER_PRSN}
			</if>			
			<if test="@foren.Ognl@isNotEmpty(TXT_FR_SALE_AMT)">
				AND (ISNULL(B.UN_COLLECT_AMT,0)											  
				  + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
				  - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0)) &gt;= #{TXT_FR_SALE_AMT}  /* 4/08수정  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(TXT_TO_SALE_AMT)">
				AND (ISNULL(B.UN_COLLECT_AMT,0)											  
				  + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
				  - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0)) &lt;= #{TXT_TO_SALE_AMT}  /* 4/08수정 */
			</if>			
												   
			AND (NOT (ISNULL(B.UN_COLLECT_AMT,0)										   = 0
			AND ISNULL(C.SALE_AMT_O,0)													 = 0
			AND ISNULL(C.TAX_AMT_O,0)													  = 0
			AND ISNULL(C.ENURI_AMT_I,0)													= 0
			AND ISNULL(C.ENURI_TAX_AMT_O,0)												= 0
			AND ISNULL((C.SALE_AMT_O + C.TAX_AMT_O + C.ENURI_AMT_I + C.ENURI_TAX_AMT_O),0) = 0
			AND ISNULL(D.CASH_COLLECT_AMT,0)											   = 0
			AND ISNULL(D.NOTE_COLLECT_AMT,0)											   = 0
			AND ISNULL(D.DIS_COLLECT_AMT,0)												= 0
			AND ISNULL(D.UP_COLLECT_AMT,0)												 = 0
			AND (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0)) = 0 
			AND (ISNULL(B.UN_COLLECT_AMT,0)												   
			  + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
			  - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0)) = 0 
			AND ISNULL(C.CARD_AMT_O,0)													 = 0))
			<if test="@foren.Ognl@isNotEmpty(MONEY_UNIT)">
			 AND B.MONEY_UNIT = #{MONEY_UNIT}
			</if>
			<if test="RDO == &quot;1&quot;">
			GROUP BY B.CUSTOM_CODE, B.SALE_PRSN, B.DIV_CODE, B.AGENT_TYPE, B.AREA_TYPE, B.MANAGE_CUSTOM, B.MANAGE_CUSTOM, B.MONEY_UNIT, A.CREDIT_AMT, A.CREDIT_YMD
			</if>
			<if test="RDO == &quot;2&quot;">
			GROUP BY B.CUSTOM_CODE, B.SALE_PRSN, B.DIV_CODE, B.AGENT_TYPE, B.AREA_TYPE, B.MANAGE_CUSTOM, B.MANAGE_CUSTOM, A.CREDIT_AMT, A.CREDIT_YMD
			</if>
		  ORDER BY 1,2,3   
	
		SET @END_TIME   = GETDATE()
		
		SET @DIFF_TIME = DATEDIFF(S, @START_TIME, @END_TIME)
		
		-- 2021.07.06 이정현 차장님 요청
		<!-- EXEC uniLITE.SP_QRY_TIME 'ssa600skrv', '미수채권현황 조회', #{BILL_FR_DATE}, #{BILL_TO_DATE}, @DIFF_TIME -->
		
	END  			
	</select>	

	<select id="ssa600skrvServiceImpl.selectList2" parameterType="Map" resultType="rMap">
	BEGIN
		DECLARE @START_TIME DATETIME
			  , @END_TIME   DATETIME
			  , @DIFF_TIME  NUMERIC(10, 0)
		
		SET @START_TIME = GETDATE()	
			
		/* 계산서발행별*/
		/*ssa600skrv.Cssa600skrv[fnSsa600nq2] Query01*/
		SELECT A.COMP_CODE																   
			 , A.CUSTOM_CODE																 
			 , MAX(uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE)) as CUSTOM_NAME   
			 , unilite.fnGetUserDate(#{S_COMP_CODE},A.BILL_DATE) AS BILL_DATE							   
			 , A.PUB_NUM																	 
			 , ISNULL(SUM(A.SALE_LOC_AMT_I),0) PUB_AMT									   
			 , ISNULL(SUM(A.TAX_AMT_O),0) TAX_AMT_O										  
			 , ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O),0) TOT_AMT_O					   
			 , ISNULL(SUM(A.COLET_AMT),0) COLET_AMT										  
			 , ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0) UN_COLET_AMT	  
			 , B.BUSI_PRSN AS SALE_PRSN																  
			 , A.DIV_CODE																	
			 , B.AGENT_TYPE																  
			 , B.AREA_TYPE																   
			 , B.MANAGE_CUSTOM AS M_CUSTOM_CODE											  
			 , MAX(uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE)) as M_CUSTOM_NAME 
			 , A.BILL_TYPE																   
			 , A.REMARK																	  
		  FROM STB100T A WITH(NOLOCK)
		       INNER JOIN BCM100T B	WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
		                                        AND B.CUSTOM_CODE = A.CUSTOM_CODE																 
		 WHERE A.CUSTOM_CODE  = B.CUSTOM_CODE												
		   AND A.COMP_CODE	  = B.COMP_CODE												  
		   AND A.COLLECT_CARE = '1'													   
		   AND A.COMP_CODE	  = #{S_COMP_CODE}		   
		   <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		   		AND A.SALE_DIV_CODE	 = #{DIV_CODE}
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
		   		AND B.AGENT_TYPE		= #{AGENT_TYPE}
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
		   		AND A.CUSTOM_CODE	LIKE #{CUSTOM_CODE} + '%'
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME)"> 
			    AND B.CUSTOM_NAME LIKE #{CUSTOM_NAME} + '%'
		   </if> 
		   <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
		   		AND B.AREA_TYPE		 = #{TXT_AREA_TYPE}
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE)">
		   		AND B.MANAGE_CUSTOM  LIKE #{MANAGE_CUSTOM_CODE} + '%'
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(BILL_FR_DATE)">
		   		AND A.BILL_DATE	   &gt;= #{BILL_FR_DATE}
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(BILL_TO_DATE)">
		   		AND A.BILL_DATE	   &lt;= #{BILL_TO_DATE}
		   </if>
		   <if test="@foren.Ognl@isNotEmpty(ORDER_PRSN)">			
		   		AND B.BUSI_PRSN		 = #{ORDER_PRSN}
			</if>
			
		 GROUP BY A.COMP_CODE,A.CUSTOM_CODE ,A.PUB_NUM ,A.BILL_DATE ,A.DIV_CODE ,B.AGENT_TYPE			
				, B.AREA_TYPE ,B.MANAGE_CUSTOM ,A.BILL_TYPE, A.REMARK, B.BUSI_PRSN
			
			<if test="TXT_FR_SALE_AMT != &quot;&quot;">
				<if test="TXT_TO_SALE_AMT == &quot;&quot;">
					HAVING  ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &gt;= #{TXT_FR_SALE_AMT}
				</if>
			</if>
			
			<if test="TXT_TO_SALE_AMT != &quot;&quot;">
				<if test="TXT_FR_SALE_AMT == &quot;&quot;">
					HAVING  ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &lt;= #{TXT_TO_SALE_AMT}
				</if>
			</if>
			
			<if test="TXT_TO_SALE_AMT != &quot;&quot;">
				<if test="TXT_FR_SALE_AMT != &quot;&quot;">
					HAVING  ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &gt;= #{TXT_FR_SALE_AMT}
				 		AND ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &lt;= #{TXT_TO_SALE_AMT}
				</if>
			</if>
			
		 ORDER BY 1,2,3,4	
		 
		SET @END_TIME   = GETDATE()
		
		SET @DIFF_TIME = DATEDIFF(S, @START_TIME, @END_TIME)
	
	<!--2021.08.11 주석처리 -->	
	<!--	EXEC uniLITE.SP_QRY_TIME 'ssa600skrv', '미수채권현황 조회', #{BILL_FR_DATE}, #{BILL_TO_DATE}, @DIFF_TIME -->	

	END		 
	</select>
	
	<!-- 수금예정일 -->
	<select id="ssa600skrvServiceImpl.selectList3" parameterType="Map" resultType="rMap">
		/* ssa600skrvServiceImpl.selectList3 */
		BEGIN
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

		SELECT
		       B.CUSTOM_CODE
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE) as CUSTOM_NAME
		    <if test="RDO == &quot;1&quot;">
		     , B.MONEY_UNIT
		    </if>
		    <if test="RDO == &quot;2&quot;">
		     ,(SELECT TOP 1 SUB_CODE FROM BSA100T WHERE COMP_CODE=#{S_COMP_CODE} AND MAIN_CODE='B004' AND REF_CODE1='Y') as MONEY_UNIT
		    </if>
		     , SUM(ISNULL(B.UN_COLLECT_AMT,0))			AS UN_COLLECT_AMT
		     , SUM(ISNULL(C.SALE_AMT_O,0))				AS SALE_LOC_AMT_I
		     , SUM(ISNULL(C.TAX_AMT_O,0))				AS TAX_AMT_O
		     , SUM(ISNULL(C.ENURI_AMT_I,0))				AS ENURI_AMT_I
		     , SUM(ISNULL(C.ENURI_TAX_AMT_O,0))			AS ENURI_TAX_AMT_O
		     , SUM(ISNULL((C.SALE_AMT_O + C.TAX_AMT_O + C.ENURI_AMT_I + C.ENURI_TAX_AMT_O),0))	AS TOT_SALE_AMT
		     , SUM(ISNULL(D.CASH_COLLECT_AMT,0))		AS CASH_COLLECT_AMT
		     , SUM(ISNULL(D.NOTE_COLLECT_AMT,0))		AS NOTE_COLLECT_AMT
		     , SUM(ISNULL(D.DIS_COLLECT_AMT,0))			AS DIS_COLLECT_AMT
		     , SUM(ISNULL(D.UP_COLLECT_AMT,0))			AS UP_COLLECT_AMT
		     , SUM((ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))) TOT_COLLECT_AMT
		     , SUM((ISNULL(B.UN_COLLECT_AMT,0)
		    	 + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
		    	 - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0))) GRANT_UN_COLLECT_AMT
		     , SUM(ISNULL(C.CARD_AMT_O,0)) CARD_AMT_O
		     , B.SALE_PRSN
		     , B.DIV_CODE
		     , B.AGENT_TYPE
		     , B.AREA_TYPE
		     , B.MANAGE_CUSTOM							AS M_CUSTOM_CODE
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.MANAGE_CUSTOM)				AS M_CUSTOM_NAME
		     , ISNULL(C.PAYMENT_DAY, D.PAYMENT_DAY)                                             AS PAYMENT_DAY
		  FROM (SELECT DISTINCT	A.CUSTOM_CODE
		             , uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, A.CUSTOM_CODE)		AS CUSTOM_NAME
		             , A.COMP_CODE
		             , A.AGENT_TYPE
		             , A.AREA_TYPE
		             , A.MANAGE_CUSTOM 
		             , B.DIV_CODE
		             , A.BUSI_PRSN 						AS SALE_PRSN
		             , UNCOLLECT_AMT					AS UN_COLLECT_AMT
		             , B.MONEY_UNIT
		          FROM SAR200T B WITH(NOLOCK)
		           INNER JOIN BCM100T A WITH(NOLOCK)  ON A.CUSTOM_CODE   = B.CUSTOM_CODE
		                                            AND A.COMP_CODE     = B.COMP_CODE
		           LEFT JOIN BCM100T C WITH(NOLOCK)  ON A.MANAGE_CUSTOM = C.CUSTOM_CODE
		                                            AND A.COMP_CODE     = C.COMP_CODE
			<if test="RDO == &quot;1&quot;">
		        LEFT JOIN fnGetBalance4CustomTbl(#{S_COMP_CODE}, #{DIV_CODE}, #{CUSTOM_CODE}, #{PAYMENT_DAY_FR}, '', '3') D  ON B.DIV_CODE = D.DIV_CODE
		                                                                                                                    AND A.CUSTOM_CODE = D.CUSTOM_CODE
		                                                                                                                    AND B.MONEY_UNIT = D.MONEY_UNIT      /* 발생기준화폐 */
			</if>
			<if test="RDO == &quot;2&quot;">
		        LEFT JOIN fnGetBalanceLocal4CustomTbl(#{S_COMP_CODE}, #{DIV_CODE}, #{CUSTOM_CODE}, #{PAYMENT_DAY_FR}, '', '3') D ON B.DIV_CODE = D.DIV_CODE
		                                                                                                                        AND A.CUSTOM_CODE = D.CUSTOM_CODE
		                                                                                                                        AND B.MONEY_UNIT = D.MONEY_UNIT	/* 자사기준화폐 */
			</if>
		       WHERE B.DIV_CODE = #{DIV_CODE}
		        <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
		         AND A.COMP_CODE		= #{S_COMP_CODE}
		        </if>
		        <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
		         AND A.AGENT_TYPE		= #{AGENT_TYPE}
		        </if>
		        <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
		         AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
		        </if>
				<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
					AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
				</if>
				<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
					AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
				</if>
				<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
					AND ISNULL(C.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
				</if>		        

		)  B
		/* 매출조회 */
		  FULL OUTER JOIN (
					/* 무역포함. */
					(SELECT	X.COMP_CODE, X.CUSTOM_CODE,X.DIV_CODE,X.MONEY_UNIT
						 , SUM(X.SALE_AMT_O) AS SALE_AMT_O												/* 환산매출액 */
						 , SUM(X.TAX_AMT_O) AS TAX_AMT_O												/* 세액 */
						 , SUM(X.ENURI_AMT_I) AS ENURI_AMT_I											/* 에누리금액 */
						 , SUM(X.ENURI_TAX_AMT_O) AS ENURI_TAX_AMT_O									/* 에누리세액 */
						 , SUM(X.CARD_AMT_O) AS CARD_AMT_O												/* 카드매출액+세액 */
						 , X.PAYMENT_DAY    --20210715 추가: , X.PAYMENT_DAY
					  FROM
						   (SELECT A.COMP_CODE
								 , A.CUSTOM_CODE
								 , B.DIV_CODE
								 , B.SALE_AMT_O												/* 환산매출액 */
								 , B.TAX_AMT_O												/* 세액 */
								 , B.ENURI_AMT_I												/* 에누리금액 */
								 , B.ENURI_TAX_AMT_O											/* 에누리세액  */
								 , B.CARD_AMT_O												/* 카드매출액+세액 */
								 , B.MONEY_UNIT
								 , B.PAYMENT_DAY                                    --20210715 추가
								 
							  FROM BCM100T A WITH(NOLOCK)
					       INNER JOIN ( SELECT A.COMP_CODE															  
											 , A.SALE_CUSTOM_CODE																 
											 , A.DIV_CODE																 
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN 0							
																						ELSE B.${sFld_SaleAmt}				  
														   END),0) SALE_AMT_O												   /* 환산매출액 */
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN 0							
																						ELSE B.TAX_AMT_O				  
														   END),0) TAX_AMT_O													/* 세액 */
								
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN B.${sFld_SaleAmt}				  
														   END),0) ENURI_AMT_I												  /* 에누리금액 */
								
								
											 , ISNULL(SUM(CASE B.INOUT_TYPE_DETAIL WHEN '94'							  
																						THEN B.TAX_AMT_O				  
														   END),0) ENURI_TAX_AMT_O											  /* 에누리세액  */
								
											 , ISNULL(SUM(CASE A.BILL_TYPE WHEN '40'									  
																				THEN B.${sFld_SaleAmt} +B.TAX_AMT_O			 
														   END),0) CARD_AMT_O												   /* 카드매출액+세액 */
											 , A.MONEY_UNIT	
											 , ISNULL(A.PAYMENT_DAY, '') AS PAYMENT_DAY
											 FROM SSA100T A WITH(NOLOCK)
											      INNER JOIN SSA110T B WITH(NOLOCK) ON A.COMP_CODE = B.COMP_CODE
											                                       AND A.DIV_CODE  = B.DIV_CODE
																			       AND A.BILL_NUM  = B.BILL_NUM
					   						WHERE A.COMP_CODE		= #{S_COMP_CODE}
											  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
											   AND A.DIV_CODE		 = #{DIV_CODE}
											  </if>		
											  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)"> 
											   AND A.PAYMENT_DAY	&gt;= #{PAYMENT_DAY_FR}
											  </if> 
											  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)"> 
											   AND A.PAYMENT_DAY	&lt;= #{PAYMENT_DAY_TO}
											  </if> 
											  
											  GROUP BY A.COMP_CODE, A.SALE_CUSTOM_CODE,A.DIV_CODE, A.MONEY_UNIT, ISNULL(A.PAYMENT_DAY, '')
																			    ) AS B ON B.COMP_CODE        = A.COMP_CODE
											                                          AND B.SALE_CUSTOM_CODE = A.CUSTOM_CODE	
						   LEFT  JOIN BCM100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
						                                    AND D.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '')												                                          
							 WHERE ISNULL(B.PAYMENT_DAY, '') != ''      --20210714 추가
							   <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
							   AND B.COMP_CODE		= #{S_COMP_CODE}
							   </if>
							  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
							   AND B.DIV_CODE		= #{DIV_CODE}
							  </if>
							  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)"> 
							   AND A.AGENT_TYPE		= #{AGENT_TYPE}
							  </if> 
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE = #{CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
							</if>							  
							  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)"> 
							   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
							  </if> 
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(D.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
							</if>							  
				
						 /* 무역포함. */
							UNION

							SELECT	A.COMP_CODE, A.CUSTOM_CODE
								 , B.DIV_CODE
								 , B.SALE_AMT_O	                                    /* 매출액 */
								 , 0 AS TAX_AMT_O									/* 세액 */
								 , 0 AS ENURI_AMT_I									/* 에누리금액 */
								 , 0 AS ENURI_TAX_AMT_O								/* 에누리세액 */
								 , 0 AS CARD_AMT_O									/* 카드매출액+세액 */
								 , B.AMT_UNIT AS MONEY_UNIT
								 , B.PAYMENT_DAY                                    --20210715 추가
							  FROM BCM100T A WITH(NOLOCK)
							       INNER JOIN (SELECT A.COMP_CODE, A.DIV_CODE, A.IMPORTER, B.AMT_UNIT, ISNULL(B.PAYMENT_DAY, '') AS PAYMENT_DAY, ISNULL(SUM(B.${sFld_BLAmt} ),0) AS SALE_AMT_O
								                 FROM TEA100T A WITH(NOLOCK)
												      INNER JOIN TED100T B WITH(NOLOCK) ON A.COMP_CODE = B.COMP_CODE
													                                   AND A.DIV_CODE  = B.DIV_CODE
								                                                       AND A.SO_SER_NO = B.SO_SER_NO
								                 WHERE A.COMP_CODE = #{S_COMP_CODE}
								                   AND ISNULL(B.PAYMENT_DAY, '') != ''      --20210714 추가
												  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">				
												   AND A.DIV_CODE		 = #{DIV_CODE}
												  </if>		
												  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)">
												   AND B.PAYMENT_DAY		&gt;= #{PAYMENT_DAY_FR}
												  </if> 
												  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)">
												   AND B.PAYMENT_DAY		&lt;= #{PAYMENT_DAY_TO}
												  </if> 									   
	
												 GROUP BY A.COMP_CODE, A.DIV_CODE, A.IMPORTER, B.AMT_UNIT, ISNULL(B.PAYMENT_DAY, '')) AS B ON B.COMP_CODE = A.COMP_CODE
												                                                   AND B.IMPORTER  = A.CUSTOM_CODE								 
					   
						   LEFT  JOIN BCM100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
				                                 			 AND D.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '') 
				           WHERE A.COMP_CODE = #{S_COMP_CODE}
							  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
							   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
							  </if> 
								<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_CODE = #{CUSTOM_CODE}
								</if>
								<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
								</if>
								<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
								</if>							  
							  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
							   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
							  </if> 
								<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
								</if>
								<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
								</if>
								<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(D.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
								</if>							  

							  
							 UNION

							SELECT	A.COMP_CODE
								 , A.CUSTOM_CODE
								 , C.DIV_CODE
								 , ISNULL(SUM(C.${sFld_PassAmt}  ),0) AS SALE_AMT_O		/*환산매출액 */
								 , 0 AS TAX_AMT_O										/*세액 */
								 , 0 AS ENURI_AMT_I										/*에누리금액 */
								 , 0 AS ENURI_TAX_AMT_O									/*에누리세액 */
								 , 0 AS CARD_AMT_O										/*카드매출액+세액 */
								 , C.AMT_UNIT AS MONEY_UNIT
								 , ''                                       AS PAYMENT_DAY     --20210715 추가
							  FROM BCM100T A WITH(NOLOCK)
							       INNER JOIN TEC120T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
							                                        AND C.APPLICANT = A.CUSTOM_CODE
								   LEFT  JOIN BCM100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
						                                 			 AND D.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '') 							                                        
							 WHERE ISNULL(C.ACCEPT_DATE, '') != ''      --20210714 추가
							 <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
							   AND C.DIV_CODE		 = #{DIV_CODE}
							 </if>
							 <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
							   AND A.AGENT_TYPE		= #{AGENT_TYPE}
							 </if>  
							 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
							   AND C.APPLICANT LIKE #{CUSTOM_CODE} + '%'
							 </if>  
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE = #{CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
							</if>
							 <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
							   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
							 </if>  
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(D.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
							</if>  
							 <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)">
							   AND C.ACCEPT_DATE	&gt;= #{PAYMENT_DAY_FR}
							 </if>  
							 <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)">
							   AND C.ACCEPT_DATE	&lt;= #{PAYMENT_DAY_TO}
							 </if>  
							 GROUP BY A.COMP_CODE,A.CUSTOM_CODE,C.DIV_CODE, C.AMT_UNIT) X
			 			GROUP BY X.COMP_CODE, X.CUSTOM_CODE,X.DIV_CODE, X.MONEY_UNIT, X.PAYMENT_DAY )) C  ON B.CUSTOM_CODE = C.CUSTOM_CODE    --20210715 추가: , X.PAYMENT_DAY
																										   AND B.MONEY_UNIT  = C.MONEY_UNIT
																										   AND B.COMP_CODE   = C.COMP_CODE
		/* 수금조회 */
		  FULL OUTER JOIN (
				   (SELECT X.COMP_CODE
						 , X.CUSTOM_CODE
						 , X.DIV_CODE
						 , X.MONEY_UNIT
						 , SUM(X.CASH_COLLECT_AMT)	AS CASH_COLLECT_AMT
						 , SUM(X.NOTE_COLLECT_AMT)	AS NOTE_COLLECT_AMT
						 , SUM(X.DIS_COLLECT_AMT)	AS DIS_COLLECT_AMT
						 , SUM(X.UP_COLLECT_AMT)	AS UP_COLLECT_AMT
						 , X.PAYMENT_DAY    --20210715 추가: , X.PAYMENT_DAY
					  FROM
						   (SELECT A.COMP_CODE
								 , A.CUSTOM_CODE
								 , D.DIV_CODE
								 , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '30' THEN 0
																  WHEN '50' THEN 0
																  WHEN '60' THEN 0
																  WHEN '71' THEN 0
																  WHEN '80' THEN 0
																  ELSE CASE WHEN F.REF_CODE6 = 'Y' THEN D.${sFld_CollectAmt} * (-1)
																			ELSE D.${sFld_CollectAmt}
																		END
												END),0) CASH_COLLECT_AMT
								  , ISNULL(SUM(CASE WHEN F.COLLECT_TYPE='30' OR F.COLLECT_TYPE='71'
														 THEN D.${sFld_CollectAmt}
												END),0) NOTE_COLLECT_AMT
								  , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '50'
																		THEN  D.${sFld_CollectAmt}
												END),0) DIS_COLLECT_AMT
								  , ISNULL(SUM(CASE  F.COLLECT_TYPE WHEN '60'
																		 THEN  D.${sFld_CollectAmt}
												END),0) UP_COLLECT_AMT
								  , D.MONEY_UNIT
								  , ''                                       AS PAYMENT_DAY     --20210715 추가
							   FROM BCM100T A WITH(NOLOCK)
                                    INNER JOIN SCO100T D WITH(NOLOCK) ON D.COMP_CODE   = A.COMP_CODE
                                                                     AND D.CUSTOM_CODE = A.CUSTOM_CODE
								    INNER JOIN ( SELECT	COMP_CODE
													  , DIV_CODE
													  , CUSTOM_CODE
													  , MONEY_UNIT
												   FROM SAR200T WITH(NOLOCK)
												  WHERE COMP_CODE = #{S_COMP_CODE}
												  GROUP BY COMP_CODE,DIV_CODE, CUSTOM_CODE, MONEY_UNIT) E ON E.COMP_CODE   = D.COMP_CODE
												                                                         AND E.DIV_CODE    = D.DIV_CODE
												                                                         AND E.CUSTOM_CODE = D.CUSTOM_CODE
												                                                         AND E.MONEY_UNIT  = ISNULL(D.MONEY_UNIT,#{GS_MONEY_UNIT})
								    INNER JOIN (SELECT SUB_CODE
													, (CASE ISNULL(REF_CODE1,'') WHEN '' THEN SUB_CODE
																				 ELSE REF_CODE1
														END) AS COLLECT_TYPE
													,  ISNULL(REF_CODE6, '') AS REF_CODE6
												 FROM BSA100T
												WHERE MAIN_CODE = 'S017'
												  AND COMP_CODE = #{S_COMP_CODE}
												  AND SUB_CODE != '$') F ON F.SUB_CODE			= D.COLLECT_TYPE
												                        AND F.COLLECT_TYPE		!= '80'
								   LEFT  JOIN BCM100T G WITH(NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
						                                 			 AND G.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '') 												                        
							  WHERE (D.DISHONOR_DATE	IS NULL OR D.DISHONOR_DATE = '')
							    AND ISNULL(D.COLLECT_DATE, '') != ''      --20210714 추가
							   <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
								AND D.COMP_CODE		= #{S_COMP_CODE}
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
								AND D.DIV_CODE		 = #{DIV_CODE}
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
								AND A.AGENT_TYPE	   = #{AGENT_TYPE}
							   </if> 
								<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_CODE = #{CUSTOM_CODE}
								</if>
								<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
								</if>
								<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
									AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
								</if>
							   <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
								AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
							   </if> 
								<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
								</if>
								<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
								</if>
								<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
									AND ISNULL(G.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
								</if>
							   <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)">
								AND D.COLLECT_DATE   &gt;= #{PAYMENT_DAY_FR}
							   </if> 
							   <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)">
								AND D.COLLECT_DATE   &lt;= #{PAYMENT_DAY_TO}
							   </if> 
							  GROUP BY A.COMP_CODE, A.CUSTOM_CODE,D.DIV_CODE,D.MONEY_UNIT
		
			/*  무역포함. */
						UNION

						SELECT	A.COMP_CODE
							 , A.CUSTOM_CODE
							 , D.DIV_CODE
							 , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '20'
																   THEN 0
																   ELSE D.${sFld_PayAmt}
										   END),0) CASH_COLLECT_AMT
							 , ISNULL(SUM(CASE WHEN F.COLLECT_TYPE = '20'
													THEN D.${sFld_PayAmt}
										   END),0) NOTE_COLLECT_AMT
							 , 0 AS DIS_COLLECT_AMT
							 , 0 AS UP_COLLECT_AMT
							 , D.MONEY_UNIT
							 , ''                                       AS PAYMENT_DAY     --20210715 추가
						  FROM BCM100T A WITH(NOLOCK)
							   INNER JOIN TEE100T D WITH(NOLOCK) ON D.COMP_CODE = A.COMP_CODE
							                                    AND D.IMPORTER  = A.CUSTOM_CODE
							   INNER JOIN ( SELECT COMP_CODE, DIV_CODE
												 , CUSTOM_CODE
												 , MONEY_UNIT
											  FROM SAR200T WITH(NOLOCK)
											 WHERE COMP_CODE =#{S_COMP_CODE}
											 GROUP BY COMP_CODE, DIV_CODE,CUSTOM_CODE,MONEY_UNIT) E ON E.COMP_CODE   = D.COMP_CODE
											                                                       AND E.DIV_CODE    = D.DIV_CODE
											                                                       AND E.MONEY_UNIT  = D.MONEY_UNIT
											                                                       AND E.CUSTOM_CODE = D.IMPORTER
							   INNER JOIN ( SELECT SUB_CODE
												 , (CASE ISNULL(REF_CODE1,'') WHEN '' THEN '10'
																			  ELSE REF_CODE1
													 END) AS COLLECT_TYPE
											  FROM BSA100T WITH(NOLOCK)
											 WHERE MAIN_CODE = 'T060'
											   AND SUB_CODE != '$') F ON F.SUB_CODE	 = D.COLET_TYPE
							   LEFT  JOIN BCM100T G WITH(NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
					                                 			 AND G.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '') 											   
						 WHERE D.NEGO_TYPE	= '1'
						   AND ISNULL(D.NEGO_DATE, '') != ''      --20210714 추가
						  <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
						   AND D.COMP_CODE		= #{S_COMP_CODE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
						   AND D.DIV_CODE		 = #{DIV_CODE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
						   AND A.AGENT_TYPE	   = #{AGENT_TYPE}
						  </if> 
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE = #{CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
							</if>
						  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
						   AND A.AREA_TYPE		= #{TXT_AREA_TYPE}
						  </if> 
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(G.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
							</if>
						  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)">
						   AND D.NEGO_DATE	   &gt;= #{PAYMENT_DAY_FR}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)">
						   AND D.NEGO_DATE	   &lt;= #{PAYMENT_DAY_TO}
						  </if> 
						 GROUP BY A.COMP_CODE, A.CUSTOM_CODE,D.DIV_CODE,D.MONEY_UNIT

						UNION

						SELECT A.COMP_CODE
							 , A.CUSTOM_CODE
							 , D.DIV_CODE
							 , ISNULL(SUM(CASE F.COLLECT_TYPE WHEN '20' THEN 0
															  ELSE D.${sFld_PayAmt}
										   END),0) CASH_COLLECT_AMT
							 , ISNULL(SUM(CASE WHEN F.COLLECT_TYPE='20' THEN D.${sFld_PayAmt}
										   END),0) NOTE_COLLECT_AMT
							 , 0 AS DIS_COLLECT_AMT
							 , 0 AS UP_COLLECT_AMT
							 , D.MONEY_UNIT
							 , ''                                       AS PAYMENT_DAY     --20210715 추가
						  FROM BCM100T A WITH(NOLOCK)
						       INNER JOIN TEE100T D WITH(NOLOCK) ON D.COMP_CODE = A.COMP_CODE
						                                        AND D.IMPORTER  = A.CUSTOM_CODE
							   INNER JOIN ( SELECT COMP_CODE
												 , DIV_CODE
												 , CUSTOM_CODE
												 , MONEY_UNIT
											  FROM SAR200T WITH(NOLOCK)
											 WHERE COMP_CODE =#{S_COMP_CODE}
											 GROUP BY COMP_CODE, DIV_CODE,CUSTOM_CODE,MONEY_UNIT) E ON E.COMP_CODE   = D.COMP_CODE
											                                                       AND E.DIV_CODE    = D.DIV_CODE
											                                                       AND E.MONEY_UNIT  = D.MONEY_UNIT
											                                                       AND E.CUSTOM_CODE = D.IMPORTER
							   INNER JOIN ( SELECT SUB_CODE, (CASE ISNULL(REF_CODE1,'') WHEN '' THEN '10'
																						ELSE REF_CODE1
															   END) AS COLLECT_TYPE
											  FROM BSA100T WITH(NOLOCK)
											 WHERE COMP_CODE = #{S_COMP_CODE} 
											   AND MAIN_CODE = 'T060'
											   AND SUB_CODE != '$') F ON F.SUB_CODE    = D.COLET_TYPE
							   LEFT  JOIN BCM100T G WITH(NOLOCK) ON G.COMP_CODE   = A.COMP_CODE
					                                 			 AND G.CUSTOM_CODE = ISNULL(A.MANAGE_CUSTOM, '') 											   
						 WHERE D.NEGO_TYPE   = '2'
						   AND ISNULL(D.PAY_DATE, '') != ''      --20210714 추가
						  <if test="@foren.Ognl@isNotEmpty(S_COMP_CODE)">
						   AND D.COMP_CODE   = #{S_COMP_CODE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
						   AND D.DIV_CODE    = #{DIV_CODE}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
						   AND A.AGENT_TYPE  = #{AGENT_TYPE}
						  </if> 
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE = #{CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
								AND A.CUSTOM_NAME LIKE '%' + #{CUSTOM_NAME} + '%' 
							</if>
						  <if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
						   AND A.AREA_TYPE   = #{TXT_AREA_TYPE}
						  </if> 
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	= #{MANAGE_CUSTOM_CODE}
							</if>
							<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(A.MANAGE_CUSTOM, '')	 LIKE #{MANAGE_CUSTOM_CODE} + '%'
							</if>
							<if test="@foren.Ognl@isEmpty(MANAGE_CUSTOM_CODE) and @foren.Ognl@isNotEmpty(MANAGE_CUSTOM_NAME)">
								AND ISNULL(G.CUSTOM_NAME, '') LIKE '%' + #{MANAGE_CUSTOM_NAME} + '%' 
							</if>
						  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)">
						   AND D.PAY_DATE    &gt;= #{PAYMENT_DAY_FR}
						  </if> 
						  <if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)">
						   AND D.PAY_DATE    &lt;= #{PAYMENT_DAY_TO}
						  </if> 
						 GROUP BY A.COMP_CODE, A.CUSTOM_CODE,D.DIV_CODE,D.MONEY_UNIT) X
			 GROUP BY X.COMP_CODE, X.CUSTOM_CODE, X.DIV_CODE, X.MONEY_UNIT, X.PAYMENT_DAY    --20210715 추가: , X.PAYMENT_DAY
		 )) D
			 ON B.CUSTOM_CODE	= D.CUSTOM_CODE
			AND B.MONEY_UNIT	= D.MONEY_UNIT
			AND B.COMP_CODE		= D.COMP_CODE
		  WHERE B.DIV_CODE		= #{DIV_CODE}
		  
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			AND B.CUSTOM_CODE = #{CUSTOM_CODE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			AND B.CUSTOM_CODE LIKE #{CUSTOM_CODE} + '%'
		</if>
		<if test="@foren.Ognl@isEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			AND uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE) LIKE #{CUSTOM_NAME} LIKE '%' + #{CUSTOM_NAME} + '%' 
		</if>		  
		<if test="@foren.Ognl@isNotEmpty(ORDER_PRSN)">
		   AND B.SALE_PRSN	= #{ORDER_PRSN}
		</if>
		<if test="@foren.Ognl@isNotEmpty(TXT_FR_SALE_AMT)">
		   AND (ISNULL(B.UN_COLLECT_AMT,0)
		     + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
		     - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0)) &gt;= #{TXT_FR_SALE_AMT}  /* 4/08수정  */
		</if>
		<if test="@foren.Ognl@isNotEmpty(TXT_TO_SALE_AMT)">
		   AND (ISNULL(B.UN_COLLECT_AMT,0)
		     + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
		     - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0)) &lt;= #{TXT_TO_SALE_AMT}  /* 4/08수정 */
		</if>
		   AND B.COMP_CODE = #{S_COMP_CODE}
		   AND (NOT (ISNULL(B.UN_COLLECT_AMT,0)										= 0
		   AND ISNULL(C.SALE_AMT_O,0)													= 0
		   AND ISNULL(C.TAX_AMT_O,0)													= 0
		   AND ISNULL(C.ENURI_AMT_I,0)													= 0
		   AND ISNULL(C.ENURI_TAX_AMT_O,0)												= 0
		   AND ISNULL((C.SALE_AMT_O + C.TAX_AMT_O + C.ENURI_AMT_I + C.ENURI_TAX_AMT_O),0) = 0
		   AND ISNULL(D.CASH_COLLECT_AMT,0)											= 0
		   AND ISNULL(D.NOTE_COLLECT_AMT,0)											= 0
		   AND ISNULL(D.DIS_COLLECT_AMT,0)												= 0
		   AND ISNULL(D.UP_COLLECT_AMT,0)												= 0
		   AND (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0)) = 0
		   AND (ISNULL(B.UN_COLLECT_AMT,0)
		     + (ISNULL(C.SALE_AMT_O,0) + ISNULL(C.TAX_AMT_O,0) + ISNULL(C.ENURI_AMT_I,0) + ISNULL(C.ENURI_TAX_AMT_O,0))
		     - (ISNULL(D.CASH_COLLECT_AMT,0) + ISNULL(D.NOTE_COLLECT_AMT,0) + ISNULL(D.DIS_COLLECT_AMT,0) + ISNULL(D.UP_COLLECT_AMT,0))-ISNULL(C.CARD_AMT_O,0)) = 0
		   AND ISNULL(C.CARD_AMT_O,0)													= 0))
		<if test="@foren.Ognl@isNotEmpty(MONEY_UNIT)">
		   AND B.MONEY_UNIT = #{MONEY_UNIT}
		</if>
		<if test="RDO == &quot;1&quot;">
		 GROUP BY B.CUSTOM_CODE, B.SALE_PRSN, B.DIV_CODE, B.AGENT_TYPE, B.AREA_TYPE, B.MANAGE_CUSTOM, B.MANAGE_CUSTOM, B.MONEY_UNIT, ISNULL(C.PAYMENT_DAY, D.PAYMENT_DAY) --20210715 추가: ISNULL(C.PAYMENT_DAY, D.PAYMENT_DAY)
		</if>
		<if test="RDO == &quot;2&quot;">
		 GROUP BY B.CUSTOM_CODE, B.SALE_PRSN, B.DIV_CODE, B.AGENT_TYPE, B.AREA_TYPE, B.MANAGE_CUSTOM, B.MANAGE_CUSTOM, ISNULL(C.PAYMENT_DAY, D.PAYMENT_DAY) --20210715 추가: ISNULL(C.PAYMENT_DAY, D.PAYMENT_DAY)
		</if>
		 HAVING SUM(ISNULL((C.SALE_AMT_O + C.TAX_AMT_O + C.ENURI_AMT_I + C.ENURI_TAX_AMT_O),0)) != 0     --202107014 추가
		 
		 
<!-- 2021.08.11 같은 거래처 매출금액 이중조회되어 주석처리함 - 아랫쪽에 백업 (ssa600skrvServiceImpl.backup)
	-->		 
		  ORDER BY 1,2,3
		  
		  
	END
	</select>
	
	
	<select id="ssa600skrvServiceImpl.backup" parameterType="Map" resultType="rMap">
		UNION ALL  --20210713 추가
		SELECT A.CUSTOM_CODE
		     , MAX(uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE)) as CUSTOM_NAME
		    <if test="RDO == &quot;1&quot;">
		     , B.MONEY_UNIT
		    </if>
		    <if test="RDO == &quot;2&quot;">
		     ,(SELECT TOP 1 SUB_CODE FROM BSA100T WHERE COMP_CODE=#{S_COMP_CODE} AND MAIN_CODE='B004' AND REF_CODE1='Y') as MONEY_UNIT
		    </if>
		     , ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0) UN_COLLECT_AMT
		     , ISNULL(SUM(A.SALE_LOC_AMT_I),0)                             SALE_LOC_AMT_I
		     , ISNULL(SUM(A.TAX_AMT_O),0)                                  TAX_AMT_O
		     , 0                                                           ENURI_AMT_I
		     , 0                                                           ENURI_TAX_AMT_O
		     , ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O),0)               TOT_SALE_AMT
		     , 0                                                           CASH_COLLECT_AMT
		     , 0                                                           NOTE_COLLECT_AMT
		     , 0                                                           DIS_COLLECT_AMT
		     , 0                                                           UP_COLLECT_AMT
		     , 0                                                           TOT_COLLECT_AMT
		     , 0                                                           GRANT_UN_COLLECT_AMT
		     , 0                                                           CARD_AMT_O
		     , B.BUSI_PRSN                                                 SALE_PRSN
		     , A.DIV_CODE
		     , B.AGENT_TYPE
		     , B.AREA_TYPE
		     , B.MANAGE_CUSTOM                                             M_CUSTOM_CODE
		     , MAX(uniLITE.fnCustNameComp(#{S_COMP_CODE},#{S_USER_ID}, B.CUSTOM_CODE))  M_CUSTOM_NAME
		     , A.RECEIPT_PLAN_DATE                                         PAYMENT_DAY   --20210715 추가
		  FROM STB100T A WITH(NOLOCK)
		       INNER JOIN BCM100T B WITH(NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                        AND B.CUSTOM_CODE = A.CUSTOM_CODE
		 WHERE A.CUSTOM_CODE    = B.CUSTOM_CODE
		   AND A.COMP_CODE      = B.COMP_CODE
		   AND A.COLLECT_CARE   = '1'
		   AND A.COMP_CODE      = #{S_COMP_CODE}
		<if test="@foren.Ognl@isNotEmpty(MONEY_UNIT)">
		   AND B.MONEY_UNIT     = #{MONEY_UNIT}
		</if>
		<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		   AND A.SALE_DIV_CODE  = #{DIV_CODE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(AGENT_TYPE)">
		   AND B.AGENT_TYPE     = #{AGENT_TYPE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
		   AND A.CUSTOM_CODE    LIKE #{CUSTOM_CODE} + '%'
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME)"> 
		   AND B.CUSTOM_NAME    LIKE #{CUSTOM_NAME} + '%'
		</if> 
		<if test="@foren.Ognl@isNotEmpty(TXT_AREA_TYPE)">
		   AND B.AREA_TYPE      = #{TXT_AREA_TYPE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(MANAGE_CUSTOM_CODE)">
		   AND B.MANAGE_CUSTOM  LIKE #{MANAGE_CUSTOM_CODE} + '%'
		</if>
		<if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_FR)"> 
		   AND A.RECEIPT_PLAN_DATE &gt;= #{PAYMENT_DAY_FR}
		</if> 
		<if test="@foren.Ognl@isNotEmpty(PAYMENT_DAY_TO)"> 
		   AND A.RECEIPT_PLAN_DATE &lt;= #{PAYMENT_DAY_TO}
		</if>
		<if test="@foren.Ognl@isNotEmpty(ORDER_PRSN)">
		   AND B.BUSI_PRSN          = #{ORDER_PRSN}
		</if>
		 GROUP BY A.COMP_CODE,A.CUSTOM_CODE ,A.PUB_NUM ,A.BILL_DATE ,A.DIV_CODE ,B.AGENT_TYPE
				, B.AREA_TYPE ,B.MANAGE_CUSTOM ,A.BILL_TYPE, A.REMARK, B.BUSI_PRSN, B.MONEY_UNIT, A.RECEIPT_PLAN_DATE --20210715 추가: A.RECEIPT_PLAN_DATE
			<if test="TXT_FR_SALE_AMT != &quot;&quot;">
				<if test="TXT_TO_SALE_AMT == &quot;&quot;">
					HAVING  ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &gt;= #{TXT_FR_SALE_AMT}
				</if>
			</if>
			<if test="TXT_TO_SALE_AMT != &quot;&quot;">
				<if test="TXT_FR_SALE_AMT == &quot;&quot;">
					HAVING  ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &lt;= #{TXT_TO_SALE_AMT}
				</if>
			</if>
			<if test="TXT_TO_SALE_AMT != &quot;&quot;">
				<if test="TXT_FR_SALE_AMT != &quot;&quot;">
					HAVING  ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &gt;= #{TXT_FR_SALE_AMT}
				 		AND ISNULL(SUM(A.SALE_LOC_AMT_I + A.TAX_AMT_O - A.COLET_AMT),0)  &lt;= #{TXT_TO_SALE_AMT}
				</if>
			</if>
	</select>
</mapper>