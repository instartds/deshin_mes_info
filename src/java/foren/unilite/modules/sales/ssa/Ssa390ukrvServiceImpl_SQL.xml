<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssa390ukrvServiceImpl">
	<select id="ssa390ukrvServiceImpl.selectMaster" parameterType="Map" resultType="rMap">
		/*ssa390ukrv.Cssa390ukrv[fnSsa100QStd] Query1*/
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON

		    DECLARE @CompCode    NVARCHAR(08) /* 법인코드    */
		          , @UserId      NVARCHAR(100) /* 사용자ID    */
		          , @LangType    NVARCHAR(2)  /* 언어구분    */
		          , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE}

		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')


		/*  데이터 조회 */
			SELECT X.COMP_CODE
		         , X.DIV_CODE
		         , X.BILL_NUM
		         , X.BILL_TYPE
		         , X.SALE_DATE
		         , X.ORDER_TYPE
		         , X.SALE_CUSTOM_CODE
		         , X.CUSTOM_NAME
		         , X.MONEY_UNIT
		         , X.EXCHG_RATE_O
		         , X.VAT_RATE
		         , X.SALE_PRSN
		         , X.TAX_TYPE
		         , X.CARD_CUST_CD
		         , X.CARD_CUST_NM
		         , X.PROJECT_NO
		         , X.REMARK
		         , X.EX_DATE
		         , X.EX_NUM
		         , X.AC_DATE
--		         , X.TREE_CODE	AS DEPT_CODE
--		         , X.TREE_NAME  AS DEPT_NAME
		         , X.TOT_SALE_TAX_I
		         , X.TOT_SALE_EXP_I
		         , X.TOT_TAX_AMT
		         , X.TOT_SALE_TAX_O
		         , X.TOT_SALE_EXP_O
		         , X.CARD_NM
		         --20190730 추가: 계약번호, 계약종료여부, (계약금액), 매출누적액
				 , X.CONT_NUM
				 , X.CONT_STATE
				 , X.CONT_AMT
		         , X.ORDER_NUM
				 , ISNULL(SUM(B1.TOT_SALES_AMT), 0)					AS TOT_SALES_AMT
			  FROM (
			        SELECT A.COMP_CODE
				         , A.DIV_CODE
				         , A.BILL_NUM
				         , A.BILL_TYPE
				         , A.SALE_DATE
				         , A.ORDER_TYPE
				         , A.SALE_CUSTOM_CODE
				         , CASE WHEN @RefItem = '0' THEN C1.CUSTOM_NAME
				                WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
				                WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
				                                    ELSE C1.CUSTOM_NAME
				           END                                              As CUSTOM_NAME
				         , A.MONEY_UNIT
				         , A.EXCHG_RATE_O
				         , A.VAT_RATE
				         , A.SALE_PRSN
				         , A.TAX_TYPE
				         , A.CARD_CUST_CD
				         , C2.CREDIT_NAME                                   AS CARD_CUST_NM
				         , A.PROJECT_NO
				         , A.REMARK
				         , A.EX_DATE
				         , A.EX_NUM
				         , A.AC_DATE
		--		         , D.TREE_CODE	AS DEPT_CODE
		--		         , D.TREE_NAME  AS DEPT_NAME
				         , SUM(CASE WHEN B.TAX_TYPE = '1' THEN ISNULL(B.SALE_LOC_AMT_I, 0)
				                    ELSE 0
				               END)                                         AS TOT_SALE_TAX_I
				         , SUM(CASE WHEN B.TAX_TYPE = '2' THEN ISNULL(B.SALE_LOC_AMT_I, 0)
				                    ELSE 0
				               END)                                         AS TOT_SALE_EXP_I
				         , SUM(CASE WHEN B.TAX_TYPE = '1' THEN ISNULL(B.TAX_AMT_O, 0)
				                    ELSE 0
				               END)                                         AS TOT_TAX_AMT
				         , SUM(CASE WHEN B.TAX_TYPE = '1' THEN ISNULL(B.SALE_AMT_O, 0)
				                    ELSE 0
				               END)                                         AS TOT_SALE_TAX_O
				         , SUM(CASE WHEN B.TAX_TYPE = '2' THEN ISNULL(B.SALE_AMT_O, 0)
				                    ELSE 0
				               END)                                         AS TOT_SALE_EXP_O
				         , M1.CODE_NAME                                     AS CARD_NM
				         --20190730 추가: 계약번호, 계약종료여부, (계약금액), 매출누적액
						 , MAX(D.CONT_NUM)									AS CONT_NUM
						 , MAX(D.CONT_STATE)								AS CONT_STATE
						 , ISNULL(MAX(D.CONT_AMT), 0)						AS CONT_AMT
				         , B.ORDER_NUM										AS ORDER_NUM
		
				    FROM              SSA100T  A  WITH (NOLOCK)
				           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
				                                               AND B.DIV_CODE     = A.DIV_CODE
				                                               AND B.BILL_NUM     = A.BILL_NUM
				           LEFT  JOIN BCM100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
				                                               AND C1.CUSTOM_CODE = A.SALE_CUSTOM_CODE
				           LEFT  JOIN BCM200T  C2 WITH (NOLOCK) ON C2.COMP_CODE   = A.COMP_CODE
				                                               AND A.CARD_CUST_CD = C2.CREDIT_CODE + C2.CARD_COMP_CODE
				           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = C2.COMP_CODE
				                                               AND M1.MAIN_CODE   = 'A028'                          /* 단가유형*/
				                                               AND M1.SUB_CODE    = C2.CARD_COMP_CODE
				           LEFT  JOIN SCN100T  D  WITH (NOLOCK) ON D.COMP_CODE    = B.COMP_CODE
				                                               AND D.DIV_CODE     = B.DIV_CODE
				                                               AND D.CONT_NUM     = B.ORDER_NUM
				     WHERE A.COMP_CODE = @CompCode
				<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
				     AND   A.DIV_CODE  = #{DIV_CODE}
				</if>
				<if test="@foren.Ognl@isNotEmpty(BILL_NUM)">
				     AND   A.BILL_NUM  = #{BILL_NUM}
				</if>
				     GROUP BY A.COMP_CODE, B.ORDER_NUM, A.DIV_CODE, A.BILL_NUM, A.BILL_TYPE, A.SALE_DATE, A.ORDER_TYPE, A.SALE_CUSTOM_CODE, A.MONEY_UNIT, A.EXCHG_RATE_O
				         , A.VAT_RATE, A.SALE_PRSN, A.TAX_TYPE, A.CARD_CUST_CD, C2.CREDIT_NAME, A.PROJECT_NO, A.REMARK, A.EX_DATE, A.EX_NUM, A.AC_DATE
				         , C1.CUSTOM_NAME, C1.CUSTOM_NAME1, C1.CUSTOM_NAME2, M1.CODE_NAME

				) X
		           LEFT  JOIN (SELECT Z1.COMP_CODE, Z1.DIV_CODE, Z1.ORDER_NUM, Z2.SALE_DATE
									, SUM(ISNULL(Z1.SALE_AMT_O, 0) + ISNULL(Z1.TAX_AMT_O, 0))	AS TOT_SALES_AMT
								 FROM      SSA110T Z1 WITH(NOLOCK)
								 LEFT JOIN SSA100T Z2 WITH(NOLOCK) ON Z2.COMP_CODE = Z1.COMP_CODE
																  AND Z2.DIV_CODE  = Z1.DIV_CODE
																  AND Z2.BILL_NUM  = Z1.BILL_NUM
								WHERE Z1.COMP_CODE   = #{S_COMP_CODE}
								  AND Z1.DIV_CODE    = #{DIV_CODE}
								GROUP BY Z1.COMP_CODE, Z1.DIV_CODE, Z1.ORDER_NUM, Z2.SALE_DATE
		           )                   B1 ON B1.COMP_CODE = X.COMP_CODE
				                         AND B1.DIV_CODE  = X.DIV_CODE
										 AND B1.ORDER_NUM = X.ORDER_NUM
										 AND CONVERT(NVARCHAR(06), B1.SALE_DATE, 112) &lt; CONVERT(NVARCHAR(06), X.SALE_DATE, 112)
				GROUP BY X.COMP_CODE
				       , X.DIV_CODE
				       , X.BILL_NUM
				       , X.BILL_TYPE
				       , X.SALE_DATE
				       , X.ORDER_TYPE
				       , X.SALE_CUSTOM_CODE
				       , X.CUSTOM_NAME
				       , X.MONEY_UNIT
				       , X.EXCHG_RATE_O
				       , X.VAT_RATE
				       , X.SALE_PRSN
				       , X.TAX_TYPE
				       , X.CARD_CUST_CD
				       , X.CARD_CUST_NM
				       , X.PROJECT_NO
				       , X.REMARK
				       , X.EX_DATE
				       , X.EX_NUM
				       , X.AC_DATE
		--		       , X.TREE_CODE	AS DEPT_CODE
		--		       , X.TREE_NAME  AS DEPT_NAME
				       , X.TOT_SALE_TAX_I
				       , X.TOT_SALE_EXP_I
				       , X.TOT_TAX_AMT
				       , X.TOT_SALE_TAX_O
				       , X.TOT_SALE_EXP_O
				       , X.CARD_NM
				       --20190730 추가: 계약번호, 계약종료여부, (계약금액), 매출누적액
					   , X.CONT_NUM
					   , X.CONT_STATE
					   , X.CONT_AMT
				       , X.ORDER_NUM
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="ssa390ukrvServiceImpl.selectDetailList" parameterType="Map" resultType="rMap">
		/*ssa390ukrv.Cssa390ukrv[fnMakeQuery] Query1*/
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON

		    DECLARE @CompCode    NVARCHAR(08) /* 법인코드    */
		          , @UserId      NVARCHAR(100) /* 사용자ID    */
		          , @LangType    NVARCHAR(2)  /* 언어구분    */
		          , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE}

		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')


		/*데이터 조회*/
		    SELECT B.BILL_SEQ
		         , B.INOUT_TYPE_DETAIL
		         , B.OUT_DIV_CODE
		         , B.WH_CODE
		         , B.ITEM_CODE
		         , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                ELSE C1.ITEM_NAME
		           END                                               AS ITEM_NAME
		         , C1.SPEC
		         , B.SALE_UNIT
		         , B.PRICE_TYPE
		         , B.TRANS_RATE
		         , B.SALE_Q
		         , B.SALE_P
		         , ISNULL(B.SALE_WGT_Q    , 0)                       AS SALE_WGT_Q
		         , ISNULL(B.SALE_FOR_WGT_P, 0)                       AS SALE_FOR_WGT_P
		         , ISNULL(B.SALE_VOL_Q    , 0)                       AS SALE_VOL_Q
		         , ISNULL(B.SALE_FOR_VOL_P, 0)                       AS SALE_FOR_VOL_P
		         , ISNULL(B.SALE_WGT_P    , 0)                       AS SALE_WGT_P
		         , ISNULL(B.SALE_VOL_P    , 0)                       AS SALE_VOL_P
		         , B.SALE_AMT_O
		         , B.TAX_TYPE
		         , B.TAX_AMT_O
		         , (B.SALE_AMT_O + B.TAX_AMT_O)                      AS ORDER_O_TAX_O
		         , B.WGT_UNIT                                                                      /*중량단위*/
		         , ISNULL(B.UNIT_WGT, 0)                             AS UNIT_WGT                   /*단위중량*/
		         , B.VOL_UNIT                                                                      /*부피단위*/
		         , ISNULL(B.UNIT_VOL, 0)                             AS UNIT_VOL                   /*단위부피*/
		         , B.DISCOUNT_RATE
		         , ISNULL(D2.GOOD_STOCK_Q, 0)                        AS STOCK_Q
		         , B.DVRY_CUST_CD
		         , C2.DVRY_CUST_NM                                   AS DVRY_CUST_NAME
		         , B.PRICE_YN
		         , D1.LOT_NO
		         , B.INOUT_NUM
		         , B.INOUT_SEQ
		         , uniLITE.fnGetUserdate(B.COMP_CODE, D1.INOUT_DATE) AS INOUT_DATE
		         , B.ORDER_NUM
		         , B.PUB_NUM
		         , B.DIV_CODE
		         , B.BILL_NUM
		         , B.SALE_LOC_AMT_I
		         , B.INOUT_TYPE
		         , B.SER_NO
		         , C1.STOCK_UNIT
		         , D1.ITEM_STATUS
		         , D1.ACCOUNT_YNC
		         , B.SALE_Q                                          AS ORIGIN_Q
		         , A.SALE_PRSN                                       AS REF_SALE_PRSN
		         , A.SALE_CUSTOM_CODE                                AS REF_CUSTOM_CODE
		         , A.SALE_DATE                                       AS REF_SALE_DATE
		         , A.BILL_TYPE                                       AS REF_BILL_TYPE
		         , A.CARD_CUST_CD                                    AS REF_CARD_CUST_CD
		         , A.ORDER_TYPE                                      AS REF_SALE_TYPE
		         , B.PROJECT_NO                                      AS REF_PROJECT_NO
		         --20200131 추가
		         , Z1.PJT_NAME                                       AS PJT_NAME
		         , A.TAX_TYPE                                        AS REF_TAX_INOUT
		         , A.REMARK                                          AS REF_REMARK
		         , A.EX_NUM                                          AS REF_EX_NUM
		         , A.MONEY_UNIT                                      AS REF_MONEY_UNIT
		         , A.EXCHG_RATE_O                                    AS REF_EXCHG_RATE_O
		         , ISNULL(C1.STOCK_CARE_YN, 'Y')                     AS STOCK_CARE_YN
		         , CASE WHEN D1.INOUT_TYPE = '2' THEN (ISNULL(D1.ORDER_UNIT_Q, 0) - ISNULL(D1.ACCOUNT_Q, 0))
		                WHEN D1.INOUT_TYPE = '3' THEN (ISNULL(D1.ORDER_UNIT_Q, 0) - ISNULL(D1.ACCOUNT_Q, 0)) * (-1)
		           END                                               AS UNSALE_Q
		         , B.UPDATE_DB_USER
		         , B.UPDATE_DB_TIME
		         , ''                                               AS DATA_REF_FLAG
		         , B.CUSTOM_CODE                                     AS SRC_CUSTOM_CODE
		         , CASE WHEN @RefItem = '1' THEN C4.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C4.CUSTOM_NAME2
		                ELSE C4.CUSTOM_NAME
		           END                                               AS SRC_CUSTOM_NAME
		         , B.ORDER_PRSN                                      AS SRC_ORDER_PRSN
		         , CASE WHEN ISNULL(M1.REF_CODE2, '') = '' THEN M1.SUB_CODE
		                                                   ELSE M1.REF_CODE2
		           END                                               AS REF_CODE2
		         , D3.ACCOUNT_YNC                                    AS SOF110T_ACCOUNT_YNC
		         , B.COMP_CODE
		         , D1.INOUT_CODE                                     AS INOUT_CUSTOM_CODE
		         , CASE WHEN @RefItem = '1' THEN C3.CUSTOM_NAME1
		                WHEN @RefItem = '2' THEN C3.CUSTOM_NAME2
		                ELSE C3.CUSTOM_NAME
		           END                                               AS INOUT_CUSTOM_NAME
		         , C3.AGENT_TYPE                                     AS INOUT_AGENT_TYPE
		         , B.ADVAN_YN                                        AS ADVAN_YN
		         , 'FEFER'                                           AS GUBUN
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           LEFT  JOIN BTR100T  D1 WITH (NOLOCK) ON D1.COMP_CODE   = B.COMP_CODE
		                                               AND D1.SALE_DIV_CODE    = B.DIV_CODE
		                                               AND D1.INOUT_NUM   = B.INOUT_NUM
		                                               AND D1.INOUT_SEQ   = B.INOUT_SEQ
		                                               AND D1.INOUT_TYPE  = B.INOUT_TYPE
		           LEFT  JOIN BIV100T  D2 WITH (NOLOCK) ON D2.COMP_CODE   = B.COMP_CODE
		                                               AND D2.DIV_CODE    = B.OUT_DIV_CODE
		                                               AND D2.WH_CODE     = B.WH_CODE
		                                               AND D2.ITEM_CODE   = B.ITEM_CODE
		           LEFT  JOIN SOF110T  D3 WITH (NOLOCK) ON D3.COMP_CODE   = B.COMP_CODE
		                                               AND D3.DIV_CODE    = B.DIV_CODE
		                                               AND D3.ORDER_NUM   = B.ORDER_NUM
		                                               AND D3.SER_NO      = B.SER_NO
		           LEFT  JOIN BPR100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = B.COMP_CODE
		                                               AND C1.ITEM_CODE   = B.ITEM_CODE
		           LEFT  JOIN SCM100T  C2 WITH (NOLOCK) ON C2.COMP_CODE   = B.COMP_CODE
		                                               AND C2.CUSTOM_CODE = B.CUSTOM_CODE
		                                               AND CONVERT(NVARCHAR(08), C2.DVRY_CUST_SEQ) = B.DVRY_CUST_CD
		           LEFT  JOIN BCM100T  C3 WITH (NOLOCK) ON C3.COMP_CODE   = D1.COMP_CODE
		                                               AND C3.CUSTOM_CODE = D1.INOUT_CODE
		           LEFT  JOIN BCM100T  C4 WITH (NOLOCK) ON C4.COMP_CODE   = B.COMP_CODE
		                                               AND C4.CUSTOM_CODE = B.CUSTOM_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = B.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S007'                          /* 단가유형*/
		                                               AND M1.SUB_CODE    = B.INOUT_TYPE_DETAIL
		           --20200102 추가: 프로젝트명 가져오기 위해 추가
		           LEFT  JOIN BCM600T  Z1 WITH (NOLOCK) ON Z1.COMP_CODE   = B.COMP_CODE
		                                               AND Z1.PJT_CODE    = B.PROJECT_NO
		    WHERE  A.COMP_CODE = @CompCode
		<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		    AND    A.DIV_CODE  = #{DIV_CODE}
		</if>
		<if test="@foren.Ognl@isNotEmpty(BILL_NUM)">
		    AND    A.BILL_NUM  = #{BILL_NUM}
		</if>
		 ORDER BY B.BILL_SEQ

		 		    SET NOCOUNT OFF
				    SET ARITHABORT OFF
		END
	</select>

	<select id="ssa390ukrvServiceImpl.selectSalesNumMaster" parameterType="Map" resultType="rMap">
		/* ssa101ukrv.Cssa101ukrv[fnSsa101QPop] Query1 */
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON

		    DECLARE	@CompCode    NVARCHAR(08) /* 법인코드    */
		          , @UserId      NVARCHAR(100) /* 사용자ID    */
		          , @LangType    NVARCHAR(2)  /* 언어구분    */
		          , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		          , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE}

		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

		    /* 데이터 조회 */
		    SELECT A.DIV_CODE
		         , A.SALE_CUSTOM_CODE
		         , (CASE WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
		                 WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
		                                     ELSE C1.CUSTOM_NAME
		             END)						                    AS CUSTOM_NAME
		         , '' AS ITEM_CODE
		         , '' AS ITEM_NAME
		         , CAST(A.SALE_DATE AS DATETIME)                    AS SALE_DATE
		         , A.BILL_TYPE
		         , A.ORDER_TYPE                                     AS SALE_TYPE
		         , M1.CODE_NAME                                     AS SALE_TYPE_NAME
		         , SUM(ISNULL(B.SALE_Q, 0))                         AS SALE_Q
		         , (A.SALE_AMT_O + ISNULL(A.SALE_LOC_EXP_I, 0) + A.TAX_AMT_O ) AS SALE_TOT_O
		         , A.SALE_LOC_AMT_I
		         , A.SALE_LOC_EXP_I
		         , A.TAX_AMT_O
		         , A.SALE_PRSN
		         , M2.CODE_NAME                                     AS SALE_PRSN_NAME
		         , A.BILL_NUM
		         , A.PROJECT_NO
--		         , B.INOUT_NUM
		         , C1.AGENT_TYPE
		         , C1.CREDIT_YN
		         , C1.WON_CALC_BAS
		         , C1.TAX_CALC_TYPE
		         , C1.TAX_TYPE
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           INNER JOIN BCM100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                               AND C1.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S002'                          /* 수주유형 */
		                                               AND M1.SUB_CODE    = A.ORDER_TYPE
		           LEFT  JOIN BSA100T  M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                               AND M2.MAIN_CODE   = 'S010'                          /* 영업담당 */
		                                               AND M2.SUB_CODE    = A.SALE_PRSN
		           LEFT  JOIN BPR100T  M3 WITH (NOLOCK) ON M3.COMP_CODE   = B.COMP_CODE
		                                               AND M3.ITEM_CODE   = B.ITEM_CODE
--		           INNER JOIN BSA210T D WITH (NOLOCK)   ON D.COMP_CODE 	  = A.COMP_CODE
--          											   AND D.TYPE_LEVEL   = A.DIV_CODE
--          											   AND D.TREE_CODE 	  = A.DEPT_CODE
		    WHERE  A.COMP_CODE           = @CompCode
			<if test="@foren.Ognl@isNotEmpty(SALE_DATE_FR)">
		      AND    A.SALE_DATE       &gt;= #{SALE_DATE_FR} /* (필수) 시작 매출일 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(SALE_DATE_TO)">
		      AND    A.SALE_DATE       &lt;= #{SALE_DATE_TO} /* (필수) 종료 매출일 */
			</if>
		      AND    A.DIV_CODE            = #{DIV_CODE}     /*(필수) 사업장코드 */

			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			  AND A.SALE_CUSTOM_CODE 		= #{CUSTOM_CODE}					/* 거래처코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			  AND A.SALE_CUSTOM_CODE 		LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
			  AND C1.CUSTOM_NAME 			LIKE '%' + #{CUSTOM_NAME} + '%'		/* 거래처명  */
			</if>
			
			<if test="@foren.Ognl@isNotEmpty(SALE_PRSN)">
		      AND    A.SALE_PRSN           = #{SALE_PRSN}    /* 영업담당 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">
		      AND    A.ORDER_TYPE          = #{ORDER_TYPE}   /* 판매유형 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">
		      AND    A.BILL_TYPE           = #{BILL_TYPE}    /* 부가세유형 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		      AND    A.PROJECT_NO       LIKE #{PROJECT_NO}   /* 관리번호 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">
		      AND    B.INOUT_NUM        LIKE #{INOUT_NUM}    /* 출고번호 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(BILL_NUM)">
		      AND    A.BILL_NUM         LIKE #{BILL_NUM}     /* 매출번호 */
			</if>
			
			<if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
			  AND B.ITEM_CODE 		= #{ITEM_CODE}						/* 품목코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
			  AND B.ITEM_CODE 		LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
			  AND M3.ITEM_NAME 		LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(DEPT_CODE)">		/*부서*/
			  AND    D.TREE_LEVEL          LIKE  (SELECT TREE_LEVEL FROM BSA210T WITH(NOLOCK) WHERE COMP_CODE =D.COMP_CODE AND TYPE_LEVEL=D.TYPE_LEVEL AND TREE_CODE = #{DEPT_CODE}) + '%'
			</if>
		    GROUP BY A.COMP_CODE    , A.DIV_CODE        , A.SALE_DATE   , A.BILL_TYPE       , A.ORDER_TYPE
		           , A.SALE_AMT_O   , A.SALE_LOC_EXP_I  , A.TAX_AMT_O   , A.SALE_LOC_AMT_I  , A.SALE_LOC_EXP_I
		           , A.TAX_AMT_O    , A.SALE_PRSN       , A.BILL_NUM    , A.PROJECT_NO      , A.SALE_CUSTOM_CODE
		           , C1.CUSTOM_NAME , M1.CODE_NAME  , M2.CODE_NAME      , C1.CUSTOM_NAME1
		           , C1.CUSTOM_NAME2, C1.AGENT_TYPE     , C1.CREDIT_YN  , C1.WON_CALC_BAS   , C1.TAX_CALC_TYPE
		           , C1.TAX_TYPE
		    ORDER BY C1.CUSTOM_NAME, A.SALE_DATE, A.BILL_NUM, A.SALE_AMT_O

		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="ssa390ukrvServiceImpl.selectSalesNumDetail" parameterType="Map" resultType="rMap">
		/* ssa390ukrv.Cssa390ukrv[fnSsa100QPopDetail] Query1 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON

		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		     SET @CompCode = #{S_COMP_CODE}
		     SET @UserId   = #{S_USER_ID}
		     SET @LangType = #{S_LANG_CODE}

		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')


		    SELECT A.DIV_CODE
		         , A.SALE_CUSTOM_CODE
		         , (CASE WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
		                 WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
		                                     ELSE C1.CUSTOM_NAME
		             END)                                           AS CUSTOM_NAME
		         , B.ITEM_CODE
		         , (CASE WHEN @RefItem = '1' THEN M3.ITEM_NAME1
		                 WHEN @RefItem = '2' THEN M3.ITEM_NAME2
		                                     ELSE M3.ITEM_NAME
		             END)                                           AS ITEM_NAME
		         , CAST((CASE WHEN ISNULL(A.SALE_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.SALE_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.SALE_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.SALE_DATE, 7, 2))
		                  END)AS DATETIME)                          AS SALE_DATE
		         , A.BILL_TYPE
		         , A.ORDER_TYPE                                     AS SALE_TYPE
		         , M1.CODE_NAME                                     AS SALE_TYPE_NAME
		         , ISNULL(B.SALE_Q, 0)                              AS SALE_Q
		         , (A.SALE_AMT_O + A.SALE_LOC_EXP_I + A.TAX_AMT_O ) AS SALE_TOT_O
		         , A.SALE_LOC_AMT_I
		         , A.SALE_LOC_EXP_I
		         , A.TAX_AMT_O
		         , A.SALE_PRSN
		         , M2.CODE_NAME                                     AS SALE_PRSN_NAME
		         , A.BILL_NUM
		         , A.PROJECT_NO
		         , B.INOUT_NUM
		    FROM              SSA100T  A  WITH (NOLOCK)
		           INNER JOIN SSA110T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                               AND B.DIV_CODE     = A.DIV_CODE
		                                               AND B.BILL_NUM     = A.BILL_NUM
		           INNER JOIN BCM100T  C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                               AND C1.CUSTOM_CODE = A.SALE_CUSTOM_CODE
		           LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                               AND M1.MAIN_CODE   = 'S002'                          /* 수주유형 */
		                                               AND M1.SUB_CODE    = A.ORDER_TYPE
		           LEFT  JOIN BSA100T  M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                               AND M2.MAIN_CODE   = 'S010'                          /* 영업담당 */
		                                               AND M2.SUB_CODE    = A.SALE_PRSN
		           LEFT  JOIN BPR100T  M3 WITH (NOLOCK) ON M3.COMP_CODE   = B.COMP_CODE
		                                               AND M3.ITEM_CODE   = B.ITEM_CODE
--				   INNER JOIN BSA210T D WITH (NOLOCK)   ON D.COMP_CODE 	  = A.COMP_CODE
--          											   AND D.TYPE_LEVEL   = A.DIV_CODE
--          											   AND D.TREE_CODE 	  = A.DEPT_CODE
		    WHERE    A.COMP_CODE           = @CompCode       /* (필수) 법인코드 */
			<if test="@foren.Ognl@isNotEmpty(SALE_DATE_FR)">
		      AND    A.SALE_DATE       &gt;= #{SALE_DATE_FR} /* (필수) 시작 매출일 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(SALE_DATE_TO)">
		      AND    A.SALE_DATE       &lt;= #{SALE_DATE_TO} /* (필수) 종료 매출일 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		      AND    A.DIV_CODE            = #{DIV_CODE}     /*(필수) 사업장코드 */
			</if>
			
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			  AND A.SALE_CUSTOM_CODE 		= #{CUSTOM_CODE}					/* 거래처코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			  AND A.SALE_CUSTOM_CODE 		LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
			  AND C1.CUSTOM_NAME 			LIKE '%' + #{CUSTOM_NAME} + '%'		/* 거래처명  */
			</if>
			
			<if test="@foren.Ognl@isNotEmpty(SALE_PRSN)">
		      AND    A.SALE_PRSN           = #{SALE_PRSN}    /* 영업담당 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">
		      AND    A.ORDER_TYPE          = #{ORDER_TYPE}   /* 판매유형 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">
		      AND    A.BILL_TYPE           = #{BILL_TYPE}    /* 부가세유형 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		      AND    A.PROJECT_NO       LIKE #{PROJECT_NO}   /* 관리번호 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">
		      AND    B.INOUT_NUM        LIKE #{INOUT_NUM}    /* 출고번호 */
			</if>
			<if test="@foren.Ognl@isNotEmpty(BILL_NUM)">
		      AND    A.BILL_NUM         LIKE #{BILL_NUM}     /* 매출번호 */
			</if>
			
			<if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
			  AND B.ITEM_CODE 		= #{ITEM_CODE}						/* 품목코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
			  AND B.ITEM_CODE 		LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
			</if>
			<if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
			  AND M3.ITEM_NAME 		LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
			</if>
			
			<if test="@foren.Ognl@isNotEmpty(DEPT_CODE)">		/*부서*/
			  AND    D.TREE_LEVEL          LIKE  (SELECT TREE_LEVEL FROM BSA210T WITH(NOLOCK) WHERE COMP_CODE =D.COMP_CODE AND TYPE_LEVEL=D.TYPE_LEVEL AND TREE_CODE = #{DEPT_CODE}) + '%'
			</if>

		   ORDER BY C1.CUSTOM_NAME, A.SALE_DATE, A.BILL_NUM, B.ITEM_CODE
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>





	<select id="ssa390ukrvServiceImpl.selectSalesOrderList" parameterType="Map" resultType="rMap">
		/* ssa390ukrvServiceImpl.selectSalesOrderList */
		BEGIN
		    SET NOCOUNT ON
		    SET ARITHABORT ON

		    DECLARE @CompCode         NVARCHAR(08)		/* 법인코드				*/
		          , @UserId           NVARCHAR(100)		/* 사용자				*/
		          , @LangType         NVARCHAR(2)		/* 언어구분				*/
		          , @RefItem          NVARCHAR(01)		/* 명칭 참조 유형			*/
		          , @DateFormat       NVARCHAR(10)		/* 날짜 포맷 유형 설정		*/
		          , @DIV_CODE         NVARCHAR(08)		/* (필수) 사업장코드 		*/
		          , @CUSTOM_CODE      NVARCHAR(08)		/* 거래처코드 			*/
		          , @CUSTOM_NAME      NVARCHAR(50)		/* 거래처명 				*/
		          , @CONT_NUM         NVARCHAR(20)		/* 계약번호 				*/
		          , @CONT_GUBUN       NVARCHAR(10)		/* 계약구분(임대/유지보수)	*/
		          , @CONT_STATE       NVARCHAR(10)		/* 계약상태(계약/종료)		*/

		    SET @CompCode 	  = #{S_COMP_CODE}
		    SET @UserId   	  = #{S_USER_ID}
		    SET @LangType 	  = #{S_LANG_CODE}
		    SET @DIV_CODE 	  = #{DIV_CODE}
		    SET @CUSTOM_CODE  = #{CUSTOM_CODE}
		    SET @CUSTOM_NAME  = #{CUSTOM_NAME}
		    SET @CONT_NUM     = #{CONT_NUM}
		    SET @CONT_GUBUN   = #{CONT_GUBUN}
		    SET @CONT_STATE   = #{CONT_STATE}

		    /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 데이터 조회 */
		    SELECT A.COMP_CODE
				 , A.DIV_CODE
				 , A.CONT_NUM
				 , A.CUSTOM_CODE
		         , (CASE WHEN @RefItem = '1' THEN C.CUSTOM_NAME1
		                 WHEN @RefItem = '2' THEN C.CUSTOM_NAME2
		                                     ELSE C.CUSTOM_NAME
		            END)                                        AS CUSTOM_NAME
				 , A.CONT_GUBUN
				 , A.CONT_DATE
				 , A.CONT_AMT                                                     --계약금액
				 , ISNULL(B.TOT_SALES_AMT, 0)                   AS TOT_SALES_AMT  --매출누적액
				 , A.CONT_AMT - ISNULL(B.TOT_SALES_AMT, 0)      AS REMAIN_AMT     --잔액(금월매출액 제외)
				 , A.SALE_PRSN
				 , A.CONT_STATE
				 , A.CONT_FR_DATE
				 , A.CONT_TO_DATE
				 , A.CONT_MONTH
				 , A.MONTH_MAINT_AMT
				 , A.CHAGE_DAY
				 , A.TAX_IN_OUT
				 , A.REMARK
				 , C.MONEY_UNIT
			  FROM       SCN100T A  WITH(NOLOCK)
			  LEFT JOIN(
						SELECT A.COMP_CODE
							 , A.DIV_CODE
							 , A.CONT_NUM
							-- , SUM(ISNULL(A.CONT_TOT_AMT, 0))		AS CONT_AMT
							 , SUM(ISNULL(B.SALE_AMT_O, 0) + ISNULL(B.TAX_AMT_O, 0))
							 										AS TOT_SALES_AMT
							-- , SUM(ISNULL(A.CONT_TOT_AMT, 0))
							-- - SUM(ISNULL(B.SALE_AMT_O, 0) + ISNULL(B.TAX_AMT_O, 0))
							--										AS REMAIN_AMT
						  FROM      SCN110T A WITH(NOLOCK)
						  LEFT JOIN SSA110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
														  AND B.DIV_CODE  = A.DIV_CODE
														  AND B.ORDER_NUM = A.CONT_NUM
														  AND B.SER_NO    = A.CONT_SEQ
						  LEFT JOIN SSA100T C WITH(NOLOCK) ON C.COMP_CODE = B.COMP_CODE
														  AND C.DIV_CODE  = B.DIV_CODE
														  AND C.BILL_NUM  = B.BILL_NUM
						 WHERE A.COMP_CODE = @CompCode
						   AND A.DIV_CODE  = @DIV_CODE
						<if test="@foren.Ognl@isNotEmpty(CONT_NUM)">
						   AND A.CONT_NUM  = @CONT_NUM
						</if>
						<if test="@foren.Ognl@isNotEmpty(SALE_DATE)">
						   AND C.SALE_DATE &lt;= CONVERT(NVARCHAR(06), #{SALE_DATE}, 112)
						</if>
						 GROUP BY A.COMP_CODE
								, A.DIV_CODE
								, A.CONT_NUM
			  )                              B ON B.COMP_CODE   = A.COMP_CODE
			                                  AND B.DIV_CODE    = A.DIV_CODE
				                              AND B.CONT_NUM    = A.CONT_NUM
			  LEFT JOIN BCM100T C WITH(NOLOCK) ON C.COMP_CODE   = A.COMP_CODE
											  AND C.CUSTOM_CODE = A.CUSTOM_CODE
			  LEFT JOIN(
						SELECT DISTINCT
							   A.COMP_CODE
							 , A.DIV_CODE
							 , A.SALE_DATE
							 , B.ORDER_NUM
						  FROM      SSA100T A WITH(NOLOCK)
						  LEFT JOIN SSA110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
														  AND B.DIV_CODE  = A.DIV_CODE
														  AND B.BILL_NUM  = A.BILL_NUM
						 WHERE A.COMP_CODE = #{S_COMP_CODE}
						   AND A.DIV_CODE  = #{DIV_CODE}
						   AND SUBSTRING(A.SALE_DATE, 1, 6) = CONVERT(NVARCHAR(06), #{SALE_DATE}, 112)
			  )                              D ON D.COMP_CODE   = A.COMP_CODE
			                                  AND D.DIV_CODE    = A.DIV_CODE
				                              AND D.ORDER_NUM   = A.CONT_NUM
		     WHERE A.COMP_CODE   = @CompCode
			   AND A.DIV_CODE    = @DIV_CODE
			   --해당달에 매출등록된 계약건은 참조되지 않음
			   AND D.COMP_CODE IS NULL
			   
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
			   AND A.CUSTOM_CODE 		= @CUSTOM_CODE						/* 거래처코드  */
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
			   AND A.CUSTOM_CODE 		LIKE  @CUSTOM_CODE + '%'			/* 거래처코드  */
		</if>
		<if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
			   AND CASE WHEN @RefItem = '1' THEN C.CUSTOM_NAME1
						WHEN @RefItem = '2' THEN C.CUSTOM_NAME2
											ELSE C.CUSTOM_NAME
					END					LIKE '%' + @CUSTOM_NAME + '%' 		/* 거래처명  */
		</if>
		
		<if test="@foren.Ognl@isNotEmpty(CONT_NUM)">
			   AND A.CONT_NUM    LIKE @CONT_NUM + '%'
		</if>
		<if test="@foren.Ognl@isNotEmpty(CONT_GUBUN)">
			   AND A.CONT_GUBUN  = @CONT_GUBUN
		</if>
		<if test="@foren.Ognl@isNotEmpty(CONT_STATE)">
			   AND A.CONT_STATE  = @CONT_STATE
		</if>
		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="ssa390ukrvServiceImpl.setSalesOrderList" parameterType="Map" resultType="rMap">
		/* ssa390ukrvServiceImpl.setSalesOrderList */
		SELECT A.COMP_CODE
		     , A.DIV_CODE
			 --MASTER DATA
		     , A.CONT_NUM          AS ORDER_NUM
		     , '10'                AS BILL_TYPE          --  NVARCHAR(04)    NOT NULL,            /* 계산서유형(S024)    */
		     , GETDATE()           AS SALE_DATE          --  NVARCHAR(08)    NOT NULL,            /* 매출일              */ PANEL 값
		     , '20'                AS ORDER_TYPE         --  NVARCHAR(02)    NOT NULL,            /* 매출구분(S002)      */ 임대매출
		     , A.CUSTOM_CODE       AS SALE_CUSTOM_CODE   --  NVARCHAR(08)    NOT NULL,            /* 매출처              */
		     , C1.AGENT_TYPE                             --  NVARCHAR(08)        NULL ,           /* 매출처 분류         */
		     , C1.MONEY_UNIT                             --  NVARCHAR(03)    NOT NULL,            /* 화폐단위            */
		     , '1'                 AS EXCHG_RATE_O       --  NUMERIC(18, 6)  NOT NULL DEFAULT 0,  /* 환율                */
		     , CASE WHEN ISNULL(C1.VAT_RATE, 0) = 0 THEN ISNULL(C2.REF_CODE1, 0)
		            ELSE VAT_RATE
		       END                 AS VAT_RATE           --  NUMERIC(5, 2)       NULL DEFAULT 0,  /* 부가세율            */
		     , A.SALE_PRSN                               --  NVARCHAR(02)        NULL,            /* 매출담당자          */
		     , ''                  AS TAX_TYPE           --  NVARCHAR(01)    NOT NULL,            /* 세액구분(과세구분)  */
		     , A.TAX_IN_OUT        AS TAX_CALC_TYPE      --  NVARCHAR(01)    NOT NULL,            /* 세액계산법          SSA100T.TAX_TYPE */
		
		     -- DETAIL DATA
		     , 1                   AS SER_NO
		     , A.DIV_CODE          AS OUT_DIV_CODE
		     , ''                  AS ITEM_CODE
		     , ''                  AS ITEM_NAME
			 , ''                  AS SPEC
			 , ''                  AS SALE_UNIT
			 , 1                   AS TRANS_RATE
			 , ''                  AS WH_CODE
		     , '11'                AS INOUT_TYPE_DETAIL  --  출고유형(S007)
		     , '2'                 AS PRICE_YN           --  단가구분
		     , 1                   AS SALE_Q             --  계약수량(매출량)
		     , 0                   AS SALE_P             --  계약단가
		     , 0                   AS SALE_AMT_O         --  NUMERIC(30,6)        NULL,            /* 계약금액-공급가    */
		     , 0                   AS TAX_AMT_O          --  NUMERIC(30,6)        NULL,            /* 계약금액-부가세    */
		     , 0                   AS ORDER_O_TAX_O      --  NUMERIC(30,6)        NULL,            /* 계약금액-총액      */
		  FROM       SCN100T A
		  INNER JOIN BCM100T C1 ON C1.COMP_CODE   = A.COMP_CODE
		                       AND C1.CUSTOM_CODE = A.CUSTOM_CODE
		   LEFT JOIN (SELECT COMP_CODE, REF_CODE1
		                FROM BSA100T WITH(NOLOCK)
		               WHERE COMP_CODE = #{S_COMP_CODE}
		                 AND MAIN_CODE = 'S028'
		                 AND SUB_CODE  = '1' ) C2 ON C2.COMP_CODE = A.COMP_CODE
		 WHERE A.COMP_CODE = #{S_COMP_CODE}
		   AND A.DIV_CODE  = #{DIV_CODE}
		   AND A.CONT_NUM  = #{CONT_NUM}
	</select>

	<select id="ssa390ukrvServiceImpl.setSalesOrderList_BACKUP" parameterType="Map" resultType="rMap">
		/* ssa390ukrvServiceImpl.setSalesOrderList */
		SELECT A.COMP_CODE
		     , A.DIV_CODE
			 --MASTER DATA
		     , A.CONT_NUM          AS ORDER_NUM
		     , '10'                AS BILL_TYPE          --  NVARCHAR(04)    NOT NULL,            /* 계산서유형(S024)    */
		     , GETDATE()           AS SALE_DATE          --  NVARCHAR(08)    NOT NULL,            /* 매출일              */ PANEL 값
		     , '20'                AS ORDER_TYPE         --  NVARCHAR(02)    NOT NULL,            /* 매출구분(S002)      */ 임대매출
		     , A.CUSTOM_CODE       AS SALE_CUSTOM_CODE   --  NVARCHAR(08)    NOT NULL,            /* 매출처              */
		     , C1.AGENT_TYPE                             --  NVARCHAR(08)        NULL ,           /* 매출처 분류         */
		     , C1.MONEY_UNIT                             --  NVARCHAR(03)    NOT NULL,            /* 화폐단위            */
		     , '1'                 AS EXCHG_RATE_O       --  NUMERIC(18, 6)  NOT NULL DEFAULT 0,  /* 환율                */
		     , CASE WHEN ISNULL(C1.VAT_RATE, 0) = 0 THEN ISNULL(C2.REF_CODE1, 0)
		            ELSE VAT_RATE
		       END                 AS VAT_RATE           --  NUMERIC(5, 2)       NULL DEFAULT 0,  /* 부가세율            */
		     , A.SALE_PRSN                               --  NVARCHAR(02)        NULL,            /* 매출담당자          */
		     , C3.TAX_TYPE                               --  NVARCHAR(01)    NOT NULL,            /* 세액구분(과세구분)  */
		     , A.TAX_IN_OUT        AS TAX_CALC_TYPE      --  NVARCHAR(01)    NOT NULL,            /* 세액계산법          */
		
		     -- DETAIL DATA
		     , B.CONT_SEQ          AS SER_NO
		     , A.DIV_CODE          AS OUT_DIV_CODE
		     , B.ITEM_CODE
		     , C3.ITEM_NAME
			 , C3.SPEC
			 , C3.SALE_UNIT
			 , C3.TRNS_RATE        AS TRANS_RATE
			 , C4.WH_CODE
		     , '11'                AS INOUT_TYPE_DETAIL  --  출고유형(S007)
		     , '2'                 AS PRICE_YN           --  단가구분
		     , B.CONT_Q            AS SALE_Q             --  계약수량(매출량)
		     , B.CONT_P            AS SALE_P             --  계약단가
		     , B.CONT_SUPPLY_AMT   AS SALE_AMT_O         --  NUMERIC(30,6)        NULL,            /* 계약금액-공급가    */
		     , B.CONT_TAX_AMT      AS TAX_AMT_O          --  NUMERIC(30,6)        NULL,            /* 계약금액-부가세    */
		     , B.CONT_TOT_AMT      AS ORDER_O_TAX_O      --  NUMERIC(30,6)        NULL,            /* 계약금액-총액      */
		  FROM       SCN100T A
		  INNER JOIN SCN110T B  ON B.COMP_CODE = A.COMP_CODE
		                       AND B.DIV_CODE  = A.DIV_CODE
		                       AND B.CONT_NUM  = A.CONT_NUM
		  INNER JOIN BCM100T C1 ON C1.COMP_CODE   = A.COMP_CODE
		                       AND C1.CUSTOM_CODE = A.CUSTOM_CODE
		   LEFT JOIN (SELECT COMP_CODE, REF_CODE1
		                FROM BSA100T WITH(NOLOCK)
		               WHERE COMP_CODE = #{S_COMP_CODE}
		                 AND MAIN_CODE = 'S028'
		                 AND SUB_CODE  = '1' ) C2 ON C2.COMP_CODE = A.COMP_CODE
		   LEFT JOIN BPR100T C3 ON C3.COMP_CODE = B.COMP_CODE
		                       AND C3.ITEM_CODE = B.ITEM_CODE
		   LEFT JOIN BPR200T C4 ON C4.COMP_CODE = B.COMP_CODE
		                       AND C4.DIV_CODE  = B.DIV_CODE
		                       AND C4.ITEM_CODE = B.ITEM_CODE
		 WHERE A.COMP_CODE = #{S_COMP_CODE}
		   AND A.DIV_CODE  = #{DIV_CODE}
		   AND A.CONT_NUM  = #{CONT_NUM}
	</select>






	<select id="ssa390ukrvServiceImpl.getGsManageLotNoYN" parameterType="Map" resultType="rMap">
		SELECT CASE WHEN ISNULL(B.SUB_CODE, '2') = '1' THEN ISNULL(A.REF_CODE1, 'N') ELSE 'N' END AS MNG_LOT
	     , CASE WHEN ISNULL(B.SUB_CODE, '2') = '1' THEN ISNULL(A.REF_CODE2, 'N') ELSE 'N' END AS ESS_YN
	     , CASE WHEN ISNULL(B.SUB_CODE, '2') = '1' THEN ISNULL(A.REF_CODE3, '' ) ELSE ''  END AS ESS_ACCOUNT
	    FROM            BSA100T   A  WITH (NOLOCK)
	         LEFT  JOIN BSA100T   B  WITH (NOLOCK) ON B.COMP_CODE = A.COMP_CODE
	                                            AND B.MAIN_CODE = N'S035'
	                                            AND B.REF_CODE1 = N'Y'
	   WHERE A.COMP_CODE = #{S_COMP_CODE}
	     AND A.MAIN_CODE = N'B090'
	     AND A.SUB_CODE  = N'SE'      /* 매출 */
	 ORDER BY A.SUB_CODE
	</select>

	<select id="ssa390ukrvServiceImpl.getGlSubCdTotCnt" parameterType="Map" resultType="rMap">
		/* USFuncKrv.CSFuncKr[fnGetRefCode2] Query01 */
		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		SELECT (CASE ISNULL(REF_CODE2,'') WHEN '' THEN SUB_CODE ELSE REF_CODE2 END) AS REF_CODE
		  FROM BSA100T
		 WHERE COMP_CODE = #{S_COMP_CODE}
		   AND MAIN_CODE = 'S007'
		   AND SUB_CODE != '$'
		   AND (CASE ISNULL(REF_CODE2,'') WHEN '' THEN SUB_CODE ELSE REF_CODE2 END)  = '95'
	</select>

	<select id="ssa390ukrvServiceImpl.getGetClosingInfo" parameterType="Map" resultType="rMap">
	</select>

	<select id="ssa390ukrvServiceImpl.getDeptName" parameterType="Map" resultType="rMap">
		SELECT TREE_NAME AS DEPT_NAME
		  FROM BSA210T WITH(NOLOCK)
	     WHERE COMP_CODE = #{S_COMP_CODE}
		   AND USE_YN    = 'Y'
		   AND TREE_CODE = #{DEPT_CODE}
	</select>

	<insert id="ssa390ukrvServiceImpl.insertLogMaster" parameterType="Map">
		/*ssa390ukrvServiceImpl.insertLogMaster*/
		INSERT INTO L_SSA100T
		     ( KEY_VALUE		      , OPR_FLAG
		     , DIV_CODE               , BILL_NUM                , BILL_TYPE               , SALE_DATE               , SALE_CUSTOM_CODE
		     , MONEY_UNIT             , EXCHG_RATE_O            , SALE_AMT_O              , SALE_LOC_AMT_I          , SALE_LOC_EXP_I
		     , VAT_RATE               , TAX_AMT_O               , SALE_PRSN               , TAX_TYPE                , TAX_CALC_TYPE
		     , REMARK                 , CREATE_LOC              , PROJECT_NO              , CARD_CUST_CD
		     , AGENT_TYPE             , ORDER_TYPE				, COMP_CODE
		     , UPDATE_DB_USER         , UPDATE_DB_TIME          , INSERT_DB_USER          , INSERT_DB_TIME)
		VALUES
		     ( #{KEY_VALUE}		      , #{OPR_FLAG}
		     , #{DIV_CODE}            , #{BILL_NUM}             , #{BILL_TYPE}            , #{SALE_DATE}            , #{SALE_CUSTOM_CODE}
		     , #{MONEY_UNIT}          , #{EXCHG_RATE_O}         , #{SALE_AMT_O}           , #{TOT_SALE_TAX_O}       , #{TOT_SALE_EXP_O}
		     , #{VAT_RATE}            , #{TOT_TAX_AMT}          , #{SALE_PRSN}            , #{TAX_TYPE}             , #{TAX_CALC_TYPE}
		     , #{REMARK}              , '1'           		    , #{PROJECT_NO}           , #{CARD_CUST_CD}
		     , #{AGENT_TYPE}          , #{ORDER_TYPE}			, #{S_COMP_CODE}
		     , #{S_USER_ID}           , GETDATE()               , #{S_USER_ID}            , GETDATE())
 	</insert>

	<insert id="ssa390ukrvServiceImpl.insertLogDetail" parameterType="Map">
		 /*ssa390ukrvServiceImpl.insertLogDetail*/
		 INSERT INTO L_SSA110T
		     ( KEY_VALUE		    , OPR_FLAG
		     , COMP_CODE            , DIV_CODE              , BILL_NUM              , BILL_SEQ              , INOUT_NUM
		     , INOUT_SEQ            , INOUT_TYPE            , INOUT_TYPE_DETAIL     , ITEM_CODE             , SALE_UNIT
		     , TRANS_RATE           , SALE_Q                , SALE_P                , SALE_AMT_O            , SALE_LOC_AMT_I
		     , TAX_AMT_O            , WH_CODE               , TAX_TYPE              , DISCOUNT_RATE         , DVRY_CUST_CD
		     , ORDER_NUM            , SER_NO                , LC_NUM                , PROJECT_NO            , PJT_CODE
		     , PUB_NUM              , BEFORE_PUB_NUM        , TO_DIV_CODE           , PRICE_YN              , CUSTOM_CODE
		     , ORDER_PRSN           , OUT_DIV_CODE          , AS_NUM                , ADVAN_YN              , CHANGE_REASON
		     , REMARK               , PRICE_TYPE            , WGT_UNIT              , UNIT_WGT              , VOL_UNIT
		     , UNIT_VOL             , SALE_WGT_Q            , SALE_WGT_P            , SALE_FOR_WGT_P        , SALE_VOL_Q
		     , SALE_VOL_P           , SALE_FOR_VOL_P
			 , UPDATE_DB_USER       , UPDATE_DB_TIME        , INSERT_DB_USER        , INSERT_DB_TIME)
		VALUES
		     ( #{KEY_VALUE}         , #{OPR_FLAG}
		     , #{COMP_CODE}         , #{DIV_CODE}           , #{BILL_NUM}           , #{BILL_SEQ}           , #{INOUT_NUM}
		     , #{INOUT_SEQ}         , #{INOUT_TYPE}         , #{INOUT_TYPE_DETAIL}  , #{ITEM_CODE}          , #{SALE_UNIT}
		     , #{TRANS_RATE}        , #{SALE_Q}             , #{SALE_P}             , #{SALE_AMT_O}         , #{SALE_LOC_AMT_I}
		     , #{TAX_AMT_O}         , #{WH_CODE}            , #{TAX_TYPE}           , #{DISCOUNT_RATE}      , #{DVRY_CUST_CD}
		     , #{ORDER_NUM}         , #{SER_NO}             , #{LC_NUM}             , #{REF_PROJECT_NO}         , #{PJT_CODE}
		     , #{PUB_NUM}           , #{BEFORE_PUB_NUM}     , #{TO_DIV_CODE}        , #{PRICE_YN}           , #{CUSTOM_CODE}
		     , #{ORDER_PRSN}        , #{OUT_DIV_CODE}       , #{AS_NUM}             , #{ADVAN_YN}           , #{CHANGE_REASON}
		     , #{REMARK}            , #{PRICE_TYPE}         , #{WGT_UNIT}           , #{UNIT_WGT}           , #{VOL_UNIT}
		     , #{UNIT_VOL}          , #{SALE_WGT_Q}         , #{SALE_WGT_P}         , #{SALE_FOR_WGT_P}     , #{SALE_VOL_Q}
		     , #{SALE_VOL_P}        , #{SALE_FOR_VOL_P}
		     , #{S_USER_ID}         , GETDATE()             , #{S_USER_ID}          , GETDATE())
 	</insert>

 	<update id="ssa390ukrvServiceImpl.updateMaster" parameterType="Map">
	    UPDATE SSA100T
		   SET BILL_TYPE    = #{BILL_TYPE}
		     , CARD_CUST_CD = #{CARD_CUST_CD}
		     , ORDER_TYPE   = #{ORDER_TYPE}
		     , PROJECT_NO   = #{PROJECT_NO}
		     , TAX_TYPE     = #{TAX_TYPE}
		     , REMARK       = #{REMARK}
		     --20190709 추가
		     , SALE_PRSN    = #{SALE_PRSN}
		 WHERE COMP_CODE = #{COMP_CODE}
		   AND DIV_CODE  = #{DIV_CODE}
		   AND BILL_NUM  = #{BILL_NUM}
 	</update>

 	<update id="ssa390ukrvServiceImpl.updateScn100t" parameterType="Map">
	    UPDATE SCN100T
		   SET CONT_STATE = #{CONT_STATE}
		 WHERE COMP_CODE = #{S_COMP_CODE}
		   AND DIV_CODE  = #{DIV_CODE}
		   AND CONT_NUM  = #{CONT_NUM}
 	</update>

	<update id="ssa390ukrvServiceImpl.spReceiving" parameterType="Map" statementType="CALLABLE">
		{call USP_SALES_Ssa390ukr (
			#{KeyValue, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String},
			#{BillNum, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String},
			#{ErrorDesc, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
		)}
	</update>

	<select id="ssa390ukrvServiceImpl.deptWhcode" parameterType="Map" resultType="rMap">
		SELECT WH_CODE
		  FROM BSA210T WITH(NOLOCK)
		 WHERE COMP_CODE  = #{S_COMP_CODE}
		   AND TYPE_LEVEL = #{DIV_CODE}
		   AND TREE_CODE  = #{DEPT_CODE}
	</select>
</mapper>