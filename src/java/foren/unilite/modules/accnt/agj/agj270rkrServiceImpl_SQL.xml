<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="agj270rkrServiceImpl">
	<select id="agj270rkrServiceImpl.selectPrimaryDataList" parameterType="Map" resultType="rMap" >	
		/* 전표출력*/
		
		DECLARE   @SLIP_DIVI   NVARCHAR(01)                 -- 전표구분

   		SET       @SLIP_DIVI = #{SLIP_DIVI}   --1: 회계 , 2: 결의
		
		--UArpt01Krv.Cagj270SKR[fnagj270r] Query12
		BEGIN
		   SET NOCOUNT ON
		   SET ARITHABORT ON
		   
		   SELECT T.AUTO_NUM                                                     AS AUTO_NUM
		        , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)  AS PAGE 
		        , CONVERT(NUMERIC(6,0),ROUND((T.EX_SEQ-1) / 6, 0, 1) + 1)        AS PAGE_SEQ
		        , X.PAGE_SEQ                                                     AS MAX_PAGE_SEQ	--PAGE별 PAGE_SEQ의 MAX값
		        , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) + RIGHT('00000' + CONVERT(NVARCHAR,CONVERT(NUMERIC(6,0),ROUND((T.EX_SEQ-1) / 6, 0, 1) + 1)),6) AS PAGE_DIVI
		        , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)  AS PAGE_KEY		-- PAGE 별 KEY값 (그룹핑용)
		        , 1                                                              AS PAGE_TOT
		        , T.IN_DIV_NAME                                                  AS IN_DIV_NAME
		        , T.IN_DEPT_CODE                                                 AS IN_DEPT_CODE
		        , T.IN_DEPT_NAME                                                 AS IN_DEPT_NAME
		        , T.CHARGE_NAME                                                  AS CHARGE_NAME
		        , uniLITE.fnGetUserDate(T.COMP_CODE, T.EX_DATE)                  AS EX_DATES
		        , T.EX_NUM                                                       AS EX_NUM
		        , T.EX_SEQ                                                       AS EX_SEQ
		        , uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATE)                  AS AC_DATES
		        , T.SLIP_NUM                                                     AS SLIP_NUM
		        , T.SLIP_SEQ                                                     AS SLIP_SEQ
		        , ISNULL(T.ACCNT, '')                                            AS ACCNT
		        , M1.ACCNT_NAME                                                  AS ACCNT_NAME
		          -- 1
		        , ISNULL(T.AC_CODE1, '')                                         AS AC_CODE1
		        , CASE B1.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA1)
		                          WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA1),112),'.00','')
		                          ELSE CASE WHEN T.AC_CODE1 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
		                                    ELSE ISNULL(T.AC_DATA1,'')
		                                END
		           END                                                           AS AC_DATA1
		        , ISNULL(T.AC_DATA_NAME1, '')                                    AS AC_DATA_NAME1
		          -- 2
		        , ISNULL(T.AC_CODE2, '')                                         AS AC_CODE2
		        , CASE B2.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA2)
		                          WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA2),112),'.00','')
		                          ELSE CASE WHEN T.AC_CODE2 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
		                                    ELSE ISNULL(T.AC_DATA2,'')
		                                END 
		           END                                                           AS AC_DATA2
		        , ISNULL(T.AC_DATA_NAME2, '')                                    AS AC_DATA_NAME2
		          -- 3
		        , ISNULL(T.AC_CODE3, '')                                         AS AC_CODE3
		        , CASE B3.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA3)
		                          WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA3),112),'.00','')
		                          ELSE CASE WHEN T.AC_CODE3 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
		                                    ELSE ISNULL(T.AC_DATA3,'')
		                                END
		           END                                                           AS AC_DATA3
		        , ISNULL(T.AC_DATA_NAME3, '')                                    AS AC_DATA_NAME3
		          -- 4
		        , ISNULL(T.AC_CODE4, '')                                         AS AC_CODE4
		        , CASE B4.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA4)
		                          WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA4),112),'.00','')
		                          ELSE CASE WHEN T.AC_CODE4 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
		                                    ELSE ISNULL(T.AC_DATA4,'')
		                                END
		           END                                                           AS AC_DATA4
		        , ISNULL(T.AC_DATA_NAME4, '')                                    AS AC_DATA_NAME4
		          -- 5
		        , ISNULL(T.AC_CODE5, '')                                         AS AC_CODE5
		        , CASE B5.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA5)
		                          WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA5),112),'.00','')
		                          ELSE CASE WHEN T.AC_CODE5 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
		                                    ELSE ISNULL(T.AC_DATA5,'')
		                                END
		           END                                                           AS AC_DATA5
		        , ISNULL(T.AC_DATA_NAME5, '')                                    AS AC_DATA_NAME5
		          -- 6
		        , ISNULL(T.AC_CODE6, '')                                         AS AC_CODE6
		        , CASE B6.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA6)
		                          WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA6),112),'.00','')
		                          ELSE CASE WHEN T.AC_CODE6 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
		                                    ELSE ISNULL(T.AC_DATA6,'')
		                                END
		           END                                                           AS AC_DATA6
		        , ISNULL(T.AC_DATA_NAME6, '')                                    AS AC_DATA_NAME6
		          --
		        , ISNULL(T.DEPT_NAME, '')                                        AS DEPT_NAME
		        , ISNULL(T.DIV_NAME, '')                                         AS DIV_NAME
		        , T.DR_CR                                                        AS DR_CR
		        , CASE T.DR_CR WHEN '1' THEN T.AMT_I     ELSE 0.0 END            AS DR_AMT_I
		        , CASE T.DR_CR WHEN '2' THEN T.AMT_I     ELSE 0.0 END            AS CR_AMT_I
		        , CASE T.DR_CR WHEN '1' THEN T.FOR_AMT_I ELSE 0.0 END            AS FOR_DR_AMT_I
		        , CASE T.DR_CR WHEN '2' THEN T.FOR_AMT_I ELSE 0.0 END            AS FOR_CR_AMT_I
		        , T.REMARK                                                       AS REMARK
		        , T.MONEY_UNIT                                                   AS MONEY_UNIT
		        , T.SLIP_DIVI                                                    AS SLIP_DIVI
		        , T.COMPANY_NUM                                                  AS COMPANY_NUM
		        , T.EXCHG_RATE_O                                                 AS EXCHG_RATE_O
		        , T.PROOF_KIND                                                   AS PROOF_KIND
		        , T.EB_YN                                                        AS EB_YN
		        , T.EB_YN_NAME  + CASE WHEN ISNULL(T.EB_YN_NAME, '') = '' THEN '' ELSE ' : ' END + ISNULL(M6.CODE_NAME, '')                 AS EB_YN_NAME
		        , T.INPUT_PATH_NM                                                AS INPUT_PATH_NM 
		     FROM (
		           SELECT A.COMP_CODE                                          AS COMP_CODE
		                , A.AUTO_NUM                                           AS AUTO_NUM
		                , M1.DIV_NAME                                          AS IN_DIV_NAME
		                , A.IN_DEPT_CODE                                       AS IN_DEPT_CODE
		                , A.IN_DEPT_NAME                                       AS IN_DEPT_NAME
		                , M4.CODE_NAME                                         AS CHARGE_NAME
		                , CASE WHEN @SLIP_DIVI = '1' THEN A.AC_DATE  ELSE A.EX_DATE  END   AS EX_DATE 
		                , CASE WHEN @SLIP_DIVI = '1' THEN A.SLIP_NUM ELSE A.EX_NUM   END   AS EX_NUM
		                , CASE WHEN @SLIP_DIVI = '1' THEN A.SLIP_SEQ ELSE A.EX_SEQ   END   AS EX_SEQ
		                , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_DATE  ELSE A.AC_DATE  END   AS AC_DATE 
		                , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_NUM   ELSE A.SLIP_NUM END   AS SLIP_NUM
		                , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_SEQ   ELSE A.SLIP_SEQ END   AS SLIP_SEQ
		                , A.ACCNT                                              AS ACCNT
		                , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN 'A4' 
		                            ELSE A.AC_CODE1 
		                   END                                                 AS AC_CODE1
		                , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_CODE,'') 
		                            ELSE A.AC_DATA1 
		                   END                                                 AS AC_DATA1
		                , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_NAME,'') 
		                            ELSE A.AC_DATA_NAME1
		                   END                                                 AS AC_DATA_NAME1
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 = ''
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN 'A4' 
		                            ELSE A.AC_CODE2 
		                   END                                                 AS AC_CODE2
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 = ''
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_CODE,'')
		                            ELSE A.AC_DATA2
		                   END                                                 AS AC_DATA2
		                , CASE WHEN A.AC_DATA1 != '' AND A.AC_DATA2 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_NAME,'')
		                            ELSE A.AC_DATA_NAME2 
		                   END                                                 AS AC_DATA_NAME2
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
		                                             AND  A.AC_DATA3 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN 'A4' 
		                            ELSE A.AC_CODE3 
		                   END                                                 AS AC_CODE3
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
		                                             AND  A.AC_DATA3 = ''
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_CODE,'') 
		                            ELSE A.AC_DATA3 
		                   END                                                 AS AC_DATA3
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
		                                             AND  A.AC_DATA3 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_NAME,'')
		                            ELSE A.AC_DATA_NAME3 
		                   END                                                 AS AC_DATA_NAME3
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN 'A4' 
		                            ELSE A.AC_CODE4
		                   END                                                 AS AC_CODE4
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_CODE,'') 
		                            ELSE A.AC_DATA4 
		                   END                                                 AS AC_DATA4
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 = ''
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_NAME,'')
		                            ELSE A.AC_DATA_NAME4 
		                   END                                                 AS AC_DATA_NAME4
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 != '' 
		                                             AND  A.AC_DATA5 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN 'A4' 
		                            ELSE A.AC_CODE5
		                   END                                                 AS AC_CODE5
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 != '' 
		                                             AND  A.AC_DATA5 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_CODE,'') 
		                            ELSE A.AC_DATA5 
		                   END                                                 AS AC_DATA5
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 != ''
		                                             AND  A.AC_DATA5 = ''
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_NAME,'')
		                            ELSE A.AC_DATA_NAME5 
		                   END                                                 AS AC_DATA_NAME5
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 != '' 
		                                             AND  A.AC_DATA5 != '' 
		                                             AND  A.AC_DATA6 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN 'A4' 
		                            ELSE A.AC_CODE6
		                   END                                                 AS AC_CODE6
		                , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 != '' 
		                                             AND  A.AC_DATA5 != '' 
		                                             AND  A.AC_DATA6 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_CODE,'') 
		                            ELSE A.AC_DATA6 
		                   END                                                 AS AC_DATA6
		                , CASE WHEN A.AC_DATA1 != '' AND  A. AC_DATA2 != ''
		                                             AND  A.AC_DATA3 != ''
		                                             AND  A.AC_DATA4 != ''
		                                             AND  A.AC_DATA5 != ''
		                                             AND  A.AC_DATA6 = '' 
		                                             AND (A.AC_CODE1 != 'A4' 
		                                             AND  A.AC_CODE2 != 'A4' 
		                                             AND  A.AC_CODE3 != 'A4'
		                                             AND  A.AC_CODE4 != 'A4' 
		                                             AND  A.AC_CODE5 != 'A4' 
		                                             AND  A.AC_CODE6 != 'A4')
		                            THEN ISNULL(A.CUSTOM_NAME,'')
		                            ELSE A.AC_DATA_NAME6 
		                   END                                                 AS AC_DATA_NAME6
		                , M3.TREE_NAME                                         AS DEPT_NAME
		                , M2.DIV_NAME                                          AS DIV_NAME
		                , A.DR_CR                                              AS DR_CR
		                , A.AMT_I                                              AS AMT_I
		                , A.FOR_AMT_I                                          AS FOR_AMT_I
		                , A.REMARK                                             AS REMARK
		                , CASE WHEN ISNULL(M5.REF_CODE1, '') = 'Y' THEN NULL
		                       ELSE ISNULL(A.MONEY_UNIT, 'KRW')
		                   END                                                 AS MONEY_UNIT
		                , A.SLIP_DIVI                                          AS SLIP_DIVI
		                , CASE WHEN A.SPEC_DIVI IN ('F1', 'F2') THEN ISNULL(B.COMPANY_NUM, '') 
		                       ELSE ''
		                   END                                                 AS COMPANY_NUM
		                , A.EXCHG_RATE_O                                       AS EXCHG_RATE_O
		                , CASE WHEN A.SPEC_DIVI IN ('F1', 'F2') THEN ISNULL(M6.CODE_NAME, '') 
		                       ELSE '' 
		                   END                                                 AS PROOF_KIND
		                , CASE WHEN A.AC_CODE1 = 'I7' THEN A.AC_DATA1
		                       WHEN A.AC_CODE2 = 'I7' THEN A.AC_DATA2
		                       WHEN A.AC_CODE3 = 'I7' THEN A.AC_DATA3
		                       WHEN A.AC_CODE4 = 'I7' THEN A.AC_DATA4
		                       WHEN A.AC_CODE5 = 'I7' THEN A.AC_DATA5
		                       WHEN A.AC_CODE6 = 'I7' THEN A.AC_DATA6
		                       ELSE ''
		                   END                                                 AS EB_YN
		                , CASE WHEN A.AC_CODE1 = 'I7' THEN A.AC_DATA_NAME1
		                       WHEN A.AC_CODE2 = 'I7' THEN A.AC_DATA_NAME2
		                       WHEN A.AC_CODE3 = 'I7' THEN A.AC_DATA_NAME3
		                       WHEN A.AC_CODE4 = 'I7' THEN A.AC_DATA_NAME4
		                       WHEN A.AC_CODE5 = 'I7' THEN A.AC_DATA_NAME5
		                       WHEN A.AC_CODE6 = 'I7' THEN A.AC_DATA_NAME6
		                       ELSE ''
		                   END                                                 AS EB_YN_NAME
		                , ISNULL(M7.CODE_NAME, '')                             AS INPUT_PATH_NM
		                , A.REASON_CODE
		--회계전표
		<if test="SLIP_DIVI == &quot;1&quot;">
		
		             FROM  (SELECT * FROM AGJ210T   WITH (NOLOCK)
							 WHERE COMP_CODE = #{S_COMP_CODE}
				             AND AC_DATE + CONVERT(nvarchar, SLIP_NUM) IN
					         	<foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
						        	'${acDate}'
						    	</foreach>
							 AND (MOD_DIVI IS NULL OR MOD_DIVI = '')) A

						
		                  LEFT JOIN BCM100T   B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                                      AND B.CUSTOM_CODE = A.CUSTOM_CODE
		                  LEFT JOIN BOR120T   M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
		                                                      AND M1.DIV_CODE   = A.IN_DIV_CODE
		                  LEFT JOIN BOR120T   M2 WITH (NOLOCK) ON M2.COMP_CODE  = A.COMP_CODE
		                                                      AND M2.DIV_CODE   = A.DIV_CODE
		                  LEFT JOIN BSA210T   M3 WITH (NOLOCK) ON M3.COMP_CODE  = A.COMP_CODE
		                                                      AND M3.TREE_CODE  = A.DEPT_CODE
		                  LEFT JOIN BSA100T   M4 WITH (NOLOCK) ON M4.COMP_CODE  = A.COMP_CODE
		                                                      AND M4.MAIN_CODE  = 'A009'
		                                                      AND M4.SUB_CODE   = A.CHARGE_CODE
		                  LEFT JOIN BSA100T   M5 WITH (NOLOCK) ON M5.COMP_CODE  = A.COMP_CODE
		                                                      AND M5.MAIN_CODE  = 'B004'
		                                                      AND M5.SUB_CODE   = A.MONEY_UNIT
		                  LEFT JOIN BSA100T   M6 WITH (NOLOCK) ON M6.COMP_CODE  = A.COMP_CODE
		                                                      AND M6.MAIN_CODE  = 'A022'
		                                                      AND M6.SUB_CODE   = A.PROOF_KIND
		                  LEFT JOIN BSA100T   M7 WITH (NOLOCK) ON M7.COMP_CODE  = A.COMP_CODE
		                                                      AND M7.MAIN_CODE  = 'A011'
		                                                      AND M7.SUB_CODE   = A.INPUT_PATH
		            WHERE A.COMP_CODE          = #{S_COMP_CODE}
		              AND ISNULL(A.CASH_NUM,0) = 0
		              
		</if>
		<if test="SLIP_DIVI == &quot;2&quot;">
		--결의전표
		             FROM  (SELECT * FROM AGJ110T   WITH (NOLOCK)
							 WHERE COMP_CODE = #{S_COMP_CODE}
				             AND EX_DATE + CONVERT(nvarchar, EX_NUM) IN
					         	<foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
						        	'${acDate}'
						    	</foreach>
							 AND (MOD_DIVI IS NULL OR MOD_DIVI = '')) A

		                  LEFT JOIN BCM100T   B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                                      AND B.CUSTOM_CODE = A.CUSTOM_CODE
		                  LEFT JOIN BOR120T   M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
		                                                      AND M1.DIV_CODE   = A.IN_DIV_CODE
		                  LEFT JOIN BOR120T   M2 WITH (NOLOCK) ON M2.COMP_CODE  = A.COMP_CODE
		                                                      AND M2.DIV_CODE   = A.DIV_CODE
		                  LEFT JOIN BSA210T   M3 WITH (NOLOCK) ON M3.COMP_CODE  = A.COMP_CODE
		                                                      AND M3.TREE_CODE  = A.DEPT_CODE
		                  LEFT JOIN BSA100T   M4 WITH (NOLOCK) ON M4.COMP_CODE  = A.COMP_CODE
		                                                      AND M4.MAIN_CODE  = 'A009'
		                                                      AND M4.SUB_CODE   = A.CHARGE_CODE
		                  LEFT JOIN BSA100T   M5 WITH (NOLOCK) ON M5.COMP_CODE  = A.COMP_CODE
		                                                      AND M5.MAIN_CODE  = 'B004'
		                                                      AND M5.SUB_CODE   = A.MONEY_UNIT
		                  LEFT JOIN BSA100T   M6 WITH (NOLOCK) ON M6.COMP_CODE  = A.COMP_CODE
		                                                      AND M6.MAIN_CODE  = 'A022'
		                                                      AND M6.SUB_CODE   = A.PROOF_KIND
		                  LEFT JOIN BSA100T   M7 WITH (NOLOCK) ON M7.COMP_CODE  = A.COMP_CODE
		                                                      AND M7.MAIN_CODE  = 'A011'
		                                                      AND M7.SUB_CODE   = A.INPUT_PATH
		            WHERE A.COMP_CODE          = #{S_COMP_CODE}
		              AND ISNULL(A.CASH_NUM,0) = 0
		</if>
		
		         ) T
		           LEFT JOIN ABA200T B1 WITH (NOLOCK) ON B1.COMP_CODE = T.COMP_CODE
		                                             AND B1.AC_CD     = T.AC_CODE1
		           LEFT JOIN ABA200T B2 WITH (NOLOCK) ON B2.COMP_CODE = T.COMP_CODE
		                                             AND B2.AC_CD     = T.AC_CODE2
		           LEFT JOIN ABA200T B3 WITH (NOLOCK) ON B3.COMP_CODE = T.COMP_CODE
		                                             AND B3.AC_CD     = T.AC_CODE3
		           LEFT JOIN ABA200T B4 WITH (NOLOCK) ON B4.COMP_CODE = T.COMP_CODE
		                                             AND B4.AC_CD     = T.AC_CODE4
		           LEFT JOIN ABA200T B5 WITH (NOLOCK) ON B5.COMP_CODE = T.COMP_CODE
		                                             AND B5.AC_CD     = T.AC_CODE5
		           LEFT JOIN ABA200T B6 WITH (NOLOCK) ON B6.COMP_CODE = T.COMP_CODE
		                                             AND B6.AC_CD     = T.AC_CODE6
		           LEFT JOIN ABA400T M1 WITH (NOLOCK) ON M1.COMP_CODE = T.COMP_CODE
		                                             AND M1.ACCNT     = T.ACCNT
		           LEFT JOIN ABA500T M2 WITH (NOLOCK) ON M2.COMP_CODE = T.COMP_CODE
		                                             AND M2.CRDT_NUM  = CASE WHEN T.AC_CODE1 = 'G5' THEN T.AC_DATA1
		                                                                     WHEN T.AC_CODE2 = 'G5' THEN T.AC_DATA2
		                                                                     WHEN T.AC_CODE3 = 'G5' THEN T.AC_DATA3
		                                                                     WHEN T.AC_CODE4 = 'G5' THEN T.AC_DATA4
		                                                                     WHEN T.AC_CODE5 = 'G5' THEN T.AC_DATA5
		                                                                     WHEN T.AC_CODE6 = 'G5' THEN T.AC_DATA6
		                                                                     ELSE ''
		                                                                END
		           LEFT JOIN BSA100T M3 WITH (NOLOCK) ON M3.COMP_CODE = T.COMP_CODE
		                                             AND M3.MAIN_CODE = N'A165'
		                                             AND M3.SUB_CODE  = N'41'
		           <if test="SLIP_DIVI == &quot;1&quot;">	                                   
		           LEFT JOIN (
								SELECT A.COMP_CODE
									 , A.AC_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, A.SLIP_NUM), 7)  	AS PAGE 
									 , MAX(CONVERT(NUMERIC(5,0),ROUND((A.SLIP_SEQ - 1) / 5, 0, 1) + 1))	AS PAGE_SEQ
	 
								 FROM AGJ210T A WITH(NOLOCK)
								WHERE A.COMP_CODE          = #{S_COMP_CODE}
								  AND ISNULL(A.CASH_NUM,0) = 0
								  AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
								  <if test="@foren.Ognl@isNotEmpty(AC_DATE)">
					              	AND A.AC_DATE + CONVERT(nvarchar, A.SLIP_NUM) IN
						              <foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
							          		 '${acDate}'
							    	  </foreach>
					              </if>
					  
								GROUP BY A.COMP_CODE, A.AC_DATE, A.SLIP_NUM
						    ) X ON X.COMP_CODE = T.COMP_CODE
							   AND X.PAGE      = T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)  
							   LEFT JOIN BSA100T M6 WITH (NOLOCK) ON M6.COMP_CODE = T.COMP_CODE
                                                                 AND M6.MAIN_CODE = N'A070'
                                                                 AND M6.SUB_CODE  = T.REASON_CODE
							                                   
					 </if> 
					 <if test="SLIP_DIVI == &quot;2&quot;">	            
					 LEFT JOIN (
								SELECT A.COMP_CODE
									 , A.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, A.EX_NUM), 7)  AS PAGE 
									 , MAX(CONVERT(NUMERIC(5,0),ROUND((A.EX_SEQ - 1) / 5, 0, 1) + 1))
					 
									 AS PAGE_SEQ
	 
								 FROM AGJ110T A WITH(NOLOCK)
								WHERE A.COMP_CODE          = #{S_COMP_CODE}
								  AND ISNULL(A.CASH_NUM,0) = 0
								  AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
								  <if test="@foren.Ognl@isNotEmpty(AC_DATE)">
						              --AND A.AC_DATE + CONVERT(nvarchar, A.SLIP_NUM) IN
						              AND A.EX_DATE + CONVERT(NVARCHAR, A.EX_NUM) IN
							              <foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
								          		'${acDate}'
								    	  </foreach>
					               </if>
                                   
                                   
								  
								GROUP BY A.COMP_CODE, A.EX_DATE, A.EX_NUM, A.SLIP_NUM
						    ) X ON X.COMP_CODE = T.COMP_CODE
							   AND X.PAGE      = T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)
							   LEFT JOIN BSA100T M6 WITH (NOLOCK) ON M6.COMP_CODE = T.COMP_CODE
                                                                 AND M6.MAIN_CODE = N'A070'
                                                                 AND M6.SUB_CODE  = T.REASON_CODE
					 	</if>                              
		   ORDER BY T.EX_DATE, T.EX_NUM, T.EX_SEQ
		   
		   SET ARITHABORT OFF
		   SET NOCOUNT OFF
		
		END
	</select>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <select id="agj270rkrServiceImpl.selectPrimaryDataList2" parameterType="Map" resultType="rMap" > 
        -- 전표출력
        --agj270rkrServiceImpl.selectPrimaryDataList2
        DECLARE   @SLIP_DIVI   NVARCHAR(01)         -- 전표구분
        		, @PAGE_CNT    INT					-- 한페이지당 출력행 갯수
        		
        SET       @SLIP_DIVI = #{SLIP_DIVI}   		--1: 회계 , 2: 결의
        SET       @PAGE_CNT  = #{PAGE_CNT}
        
		BEGIN
			SET NOCOUNT ON
			SET ARITHABORT ON
		
		<if test="SLIP_DIVI == &quot;1&quot;">
			--회계전표
			SELECT A.*
			  INTO #T_AGJ210T
			  FROM AGJ210T A WITH (NOLOCK)
			 WHERE A.COMP_CODE = #{S_COMP_CODE}
			   AND A.AC_DATE + CONVERT(nvarchar, A.SLIP_NUM) IN
					<foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
						'${acDate}'
					</foreach>
			   AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
			   AND ISNULL(A.CASH_NUM,0) = 0
		</if>
		<if test="SLIP_DIVI != &quot;1&quot;">
			--결의전표
			SELECT A.*
			  INTO #T_AGJ210T
			  FROM AGJ110T A WITH (NOLOCK)
			 WHERE A.COMP_CODE = #{S_COMP_CODE}
			   AND A.EX_DATE + CONVERT(nvarchar, A.EX_NUM) IN
					<foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
						'${acDate}'
					</foreach>
			   AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
			   AND ISNULL(A.CASH_NUM,0) = 0
		</if>
		
		<if test="SLIP_DIVI == &quot;1&quot;">
			SELECT A.COMP_CODE
				 , A.AC_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, A.SLIP_NUM), 7)			AS PAGE
				 , CONVERT(NUMERIC(5, 0), ROUND((COUNT(*) - 1) / @PAGE_CNT, 0, 1) + 1)		AS PAGE_SEQ
			  INTO #T_AGJ210T_2
			  FROM #T_AGJ210T A WITH(NOLOCK)
			 GROUP BY A.COMP_CODE, A.AC_DATE, A.SLIP_NUM
		</if>
		<if test="SLIP_DIVI != &quot;1&quot;">
			SELECT A.COMP_CODE
				 , A.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, A.EX_NUM), 7)			AS PAGE
				 , CONVERT(NUMERIC(5, 0), ROUND((COUNT(*) - 1) / @PAGE_CNT, 0, 1) + 1)		AS PAGE_SEQ
			  INTO #T_AGJ210T_2
			  FROM #T_AGJ210T A WITH(NOLOCK)
			 GROUP BY A.COMP_CODE, A.EX_DATE, A.EX_NUM
		</if>

           SELECT T.AUTO_NUM                                                      AS AUTO_NUM
                --20200417 추가: 여유컬럼 계산용 값
                , ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ) AS CAL_EMPTY_ROW
                , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)   AS PAGE 
                --20200417 수정
                --, CONVERT(NUMERIC(6,0),ROUND((T.EX_SEQ-1) / @PAGE_CNT, 0, 1) + 1) AS PAGE_SEQ
                , CONVERT(NUMERIC(6,0),ROUND(((ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ))-1) / @PAGE_CNT, 0, 1) + 1) AS PAGE_SEQ
                , X.PAGE_SEQ                                                      AS MAX_PAGE_SEQ    --PAGE별 PAGE_SEQ의 MAX값
                --20200417 수정
                , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) + RIGHT('00000' + CONVERT(NVARCHAR,CONVERT(NUMERIC(6,0),ROUND(((ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ))-1) / @PAGE_CNT, 0, 1) + 1)),5) AS PAGE_DIVI
                , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)  AS PAGE_KEY        -- PAGE 별 KEY값 (그룹핑용)
                , 1                                                              AS PAGE_TOT
                , T.IN_DIV_NAME                                                  AS IN_DIV_NAME
                , T.IN_DEPT_CODE                                                 AS IN_DEPT_CODE
                , T.IN_DEPT_NAME                                                 AS IN_DEPT_NAME
                , T.CHARGE_NAME                                                  AS CHARGE_NAME
                , uniLITE.fnGetUserDate(T.COMP_CODE, T.EX_DATE)                  AS EX_DATES
                , T.EX_NUM                                                       AS EX_NUM
                , T.EX_SEQ                                                       AS EX_SEQ
                , uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATE)                  AS AC_DATES
                , T.SLIP_NUM                                                     AS SLIP_NUM
                , T.SLIP_SEQ                                                     AS SLIP_SEQ
                , ISNULL(T.ACCNT, '')                                            AS ACCNT
                , M1.ACCNT_NAME                                                  AS ACCNT_NAME
                  -- 1
                , ISNULL(T.AC_CODE1, '')                                         AS AC_CODE1
                , CASE B1.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA1)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA1),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE1 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA1,'')
                                        END
                   END                                                           AS AC_DATA1
                , ISNULL(T.AC_DATA_NAME1, '')                                    AS AC_DATA_NAME1
                  -- 2
                , ISNULL(T.AC_CODE2, '')                                         AS AC_CODE2
                , CASE B2.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA2)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA2),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE2 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA2,'')
                                        END 
                   END                                                           AS AC_DATA2
                , ISNULL(T.AC_DATA_NAME2, '')                                    AS AC_DATA_NAME2
                  -- 3
                , ISNULL(T.AC_CODE3, '')                                         AS AC_CODE3
                , CASE B3.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA3)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA3),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE3 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA3,'')
                                        END
                   END                                                           AS AC_DATA3
                , ISNULL(T.AC_DATA_NAME3, '')                                    AS AC_DATA_NAME3
                  -- 4
                , ISNULL(T.AC_CODE4, '')                                         AS AC_CODE4
                , CASE B4.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA4)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA4),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE4 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA4,'')
                                        END
                   END                                                           AS AC_DATA4
                , ISNULL(T.AC_DATA_NAME4, '')                                    AS AC_DATA_NAME4
                  -- 5
                , ISNULL(T.AC_CODE5, '')                                         AS AC_CODE5
                , CASE B5.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA5)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA5),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE5 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA5,'')
                                        END
                   END                                                           AS AC_DATA5
                , ISNULL(T.AC_DATA_NAME5, '')                                    AS AC_DATA_NAME5
                  -- 6
                , ISNULL(T.AC_CODE6, '')                                         AS AC_CODE6
                , CASE B6.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA6)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA6),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE6 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA6,'')
                                        END
                   END                                                           AS AC_DATA6
                , ISNULL(T.AC_DATA_NAME6, '')                                    AS AC_DATA_NAME6
                  --
                , ISNULL(T.DEPT_NAME, '')                                        AS DEPT_NAME
                , ISNULL(T.DIV_NAME, '')                                         AS DIV_NAME
                , T.DR_CR                                                        AS DR_CR
                , CASE T.DR_CR WHEN '1' THEN T.AMT_I     ELSE 0.0 END            AS DR_AMT_I
                , CASE T.DR_CR WHEN '2' THEN T.AMT_I     ELSE 0.0 END            AS CR_AMT_I
                , CASE T.DR_CR WHEN '1' THEN T.FOR_AMT_I ELSE 0.0 END            AS FOR_DR_AMT_I
                , CASE T.DR_CR WHEN '2' THEN T.FOR_AMT_I ELSE 0.0 END            AS FOR_CR_AMT_I
                , T.REMARK                                                       AS REMARK
                , T.MONEY_UNIT                                                   AS MONEY_UNIT
                , T.SLIP_DIVI                                                    AS SLIP_DIVI
                , T.COMPANY_NUM                                                  AS COMPANY_NUM
                , T.EXCHG_RATE_O                                                 AS EXCHG_RATE_O
                , T.PROOF_KIND                                                   AS PROOF_KIND
                , T.EB_YN                                                        AS EB_YN
                , T.EB_YN_NAME  + CASE WHEN ISNULL(T.EB_YN_NAME, '') = '' THEN '' ELSE ' : ' END + ISNULL(M6.CODE_NAME, '')                 AS EB_YN_NAME
                , T.INPUT_PATH_NM                                                AS INPUT_PATH_NM
                --20200417 수정
                --, DENSE_RANK() OVER(PARTITION BY T.EX_DATE, T.EX_NUM ORDER BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) + RIGHT('00000' + CONVERT(NVARCHAR,CONVERT(NUMERIC(5,0),ROUND((T.EX_SEQ-1) / @PAGE_CNT, 0, 1) + 1)),5)) AS ROWNUM 
                , CONVERT(NUMERIC(6,0),ROUND(((ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ))-1) / @PAGE_CNT, 0, 1) + 1) AS ROWNUM
             FROM (
					 
                   SELECT A.COMP_CODE                                          AS COMP_CODE
                        , A.AUTO_NUM                                           AS AUTO_NUM
                        , M1.DIV_NAME                                          AS IN_DIV_NAME
                        , A.IN_DEPT_CODE                                       AS IN_DEPT_CODE
                        , A.IN_DEPT_NAME                                       AS IN_DEPT_NAME
                        , M4.CODE_NAME                                         AS CHARGE_NAME
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.AC_DATE  ELSE A.EX_DATE  END   AS EX_DATE 
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.SLIP_NUM ELSE A.EX_NUM   END   AS EX_NUM
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.SLIP_SEQ ELSE A.EX_SEQ   END   AS EX_SEQ
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_DATE  ELSE A.AC_DATE  END   AS AC_DATE 
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_NUM   ELSE A.SLIP_NUM END   AS SLIP_NUM
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_SEQ   ELSE A.SLIP_SEQ END   AS SLIP_SEQ
                        , A.ACCNT                                              AS ACCNT
                        , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE1 
                           END                                                 AS AC_CODE1
                        , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA1 
                           END                                                 AS AC_DATA1
                        , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'') 
                                    ELSE A.AC_DATA_NAME1
                           END                                                 AS AC_DATA_NAME1
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE2 
                           END                                                 AS AC_CODE2
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'')
                                    ELSE A.AC_DATA2
                           END                                                 AS AC_DATA2
                        , CASE WHEN A.AC_DATA1 != '' AND A.AC_DATA2 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME2 
                           END                                                 AS AC_DATA_NAME2
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE3 
                           END                                                 AS AC_CODE3
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA3 
                           END                                                 AS AC_DATA3
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME3 
                           END                                                 AS AC_DATA_NAME3
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE4
                           END                                                 AS AC_CODE4
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA4 
                           END                                                 AS AC_DATA4
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME4 
                           END                                                 AS AC_DATA_NAME4
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE5
                           END                                                 AS AC_CODE5
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA5 
                           END                                                 AS AC_DATA5
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != ''
                                                     AND  A.AC_DATA5 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME5 
                           END                                                 AS AC_DATA_NAME5
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 != '' 
                                                     AND  A.AC_DATA6 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE6
                           END                                                 AS AC_CODE6
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 != '' 
                                                     AND  A.AC_DATA6 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA6 
                           END                                                 AS AC_DATA6
                        , CASE WHEN A.AC_DATA1 != '' AND  A. AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != ''
                                                     AND  A.AC_DATA5 != ''
                                                     AND  A.AC_DATA6 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME6 
                           END                                                 AS AC_DATA_NAME6
                        , M3.TREE_NAME                                         AS DEPT_NAME
                        , M2.DIV_NAME                                          AS DIV_NAME
                        , A.DR_CR                                              AS DR_CR
                        , A.AMT_I                                              AS AMT_I
                        , A.FOR_AMT_I                                          AS FOR_AMT_I
                        , A.REMARK                                             AS REMARK
                        , CASE WHEN ISNULL(M5.REF_CODE1, '') = 'Y' THEN NULL
                               ELSE ISNULL(A.MONEY_UNIT, 'KRW')
                           END                                                 AS MONEY_UNIT
                        , A.SLIP_DIVI                                          AS SLIP_DIVI
                        , CASE WHEN A.SPEC_DIVI IN ('F1', 'F2') THEN ISNULL(B.COMPANY_NUM, '') 
                               ELSE ''
                           END                                                 AS COMPANY_NUM
                        , A.EXCHG_RATE_O                                       AS EXCHG_RATE_O
                        , CASE WHEN A.SPEC_DIVI IN ('F1', 'F2') THEN ISNULL(M6.CODE_NAME, '') 
                               ELSE '' 
                           END                                                 AS PROOF_KIND
                        , CASE WHEN A.AC_CODE1 = 'I7' THEN A.AC_DATA1
                               WHEN A.AC_CODE2 = 'I7' THEN A.AC_DATA2
                               WHEN A.AC_CODE3 = 'I7' THEN A.AC_DATA3
                               WHEN A.AC_CODE4 = 'I7' THEN A.AC_DATA4
                               WHEN A.AC_CODE5 = 'I7' THEN A.AC_DATA5
                               WHEN A.AC_CODE6 = 'I7' THEN A.AC_DATA6
                               ELSE ''
                           END                                                 AS EB_YN
                        , CASE WHEN A.AC_CODE1 = 'I7' THEN A.AC_DATA_NAME1
                               WHEN A.AC_CODE2 = 'I7' THEN A.AC_DATA_NAME2
                               WHEN A.AC_CODE3 = 'I7' THEN A.AC_DATA_NAME3
                               WHEN A.AC_CODE4 = 'I7' THEN A.AC_DATA_NAME4
                               WHEN A.AC_CODE5 = 'I7' THEN A.AC_DATA_NAME5
                               WHEN A.AC_CODE6 = 'I7' THEN A.AC_DATA_NAME6
                               ELSE ''
                           END                                                 AS EB_YN_NAME
                        , ISNULL(M7.CODE_NAME, '')                             AS INPUT_PATH_NM
                        , A.REASON_CODE
        
                     FROM  #T_AGJ210T A
                        
                          LEFT JOIN BCM100T   B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                              AND B.CUSTOM_CODE = A.CUSTOM_CODE
                          LEFT JOIN BOR120T   M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
                                                              AND M1.DIV_CODE   = A.IN_DIV_CODE
                          LEFT JOIN BOR120T   M2 WITH (NOLOCK) ON M2.COMP_CODE  = A.COMP_CODE
                                                              AND M2.DIV_CODE   = A.DIV_CODE
                          LEFT JOIN BSA210T   M3 WITH (NOLOCK) ON M3.COMP_CODE  = A.COMP_CODE
                                                              AND M3.TREE_CODE  = A.DEPT_CODE
                          LEFT JOIN BSA100T   M4 WITH (NOLOCK) ON M4.COMP_CODE  = A.COMP_CODE
                                                              AND M4.MAIN_CODE  = 'A009'
                                                              AND M4.SUB_CODE   = A.CHARGE_CODE
                          LEFT JOIN BSA100T   M5 WITH (NOLOCK) ON M5.COMP_CODE  = A.COMP_CODE
                                                              AND M5.MAIN_CODE  = 'B004'
                                                              AND M5.SUB_CODE   = A.MONEY_UNIT
                          LEFT JOIN BSA100T   M6 WITH (NOLOCK) ON M6.COMP_CODE  = A.COMP_CODE
                                                              AND M6.MAIN_CODE  = 'A022'
                                                              AND M6.SUB_CODE   = A.PROOF_KIND
                          LEFT JOIN BSA100T   M7 WITH (NOLOCK) ON M7.COMP_CODE  = A.COMP_CODE
                                                              AND M7.MAIN_CODE  = 'A011'
                                                              AND M7.SUB_CODE   = A.INPUT_PATH
                    WHERE A.COMP_CODE          = #{S_COMP_CODE}
                      AND ISNULL(A.CASH_NUM,0) = 0
                 ) T
                   LEFT JOIN ABA200T B1 WITH (NOLOCK) ON B1.COMP_CODE = T.COMP_CODE
                                                     AND B1.AC_CD     = T.AC_CODE1
                   LEFT JOIN ABA200T B2 WITH (NOLOCK) ON B2.COMP_CODE = T.COMP_CODE
                                                     AND B2.AC_CD     = T.AC_CODE2
                   LEFT JOIN ABA200T B3 WITH (NOLOCK) ON B3.COMP_CODE = T.COMP_CODE
                                                     AND B3.AC_CD     = T.AC_CODE3
                   LEFT JOIN ABA200T B4 WITH (NOLOCK) ON B4.COMP_CODE = T.COMP_CODE
                                                     AND B4.AC_CD     = T.AC_CODE4
                   LEFT JOIN ABA200T B5 WITH (NOLOCK) ON B5.COMP_CODE = T.COMP_CODE
                                                     AND B5.AC_CD     = T.AC_CODE5
                   LEFT JOIN ABA200T B6 WITH (NOLOCK) ON B6.COMP_CODE = T.COMP_CODE
                                                     AND B6.AC_CD     = T.AC_CODE6
                   LEFT JOIN ABA400T M1 WITH (NOLOCK) ON M1.COMP_CODE = T.COMP_CODE
                                                     AND M1.ACCNT     = T.ACCNT
                   LEFT JOIN ABA500T M2 WITH (NOLOCK) ON M2.COMP_CODE = T.COMP_CODE
                                                     AND M2.CRDT_NUM  = CASE WHEN T.AC_CODE1 = 'G5' THEN T.AC_DATA1
                                                                             WHEN T.AC_CODE2 = 'G5' THEN T.AC_DATA2
                                                                             WHEN T.AC_CODE3 = 'G5' THEN T.AC_DATA3
                                                                             WHEN T.AC_CODE4 = 'G5' THEN T.AC_DATA4
                                                                             WHEN T.AC_CODE5 = 'G5' THEN T.AC_DATA5
                                                                             WHEN T.AC_CODE6 = 'G5' THEN T.AC_DATA6
                                                                             ELSE ''
                                                                        END
                   LEFT JOIN BSA100T M3 WITH (NOLOCK) ON M3.COMP_CODE = T.COMP_CODE
                                                     AND M3.MAIN_CODE = N'A165'
                                                     AND M3.SUB_CODE  = N'41'
                   LEFT JOIN #T_AGJ210T_2 X ON X.COMP_CODE = T.COMP_CODE
                                           AND X.PAGE      = T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)
                   LEFT JOIN BSA100T M6 WITH (NOLOCK) ON M6.COMP_CODE = T.COMP_CODE
                                                     AND M6.MAIN_CODE = N'A070'
                                                     AND M6.SUB_CODE  = T.REASON_CODE
           ORDER BY T.EX_DATE, T.EX_NUM, T.EX_SEQ
           
           SET ARITHABORT OFF
           SET NOCOUNT OFF
        
        END
    </select>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
	
	
	
	<select id="agj270rkrServiceImpl.selectJournal" parameterType="Map" resultType="rMap" >
		/* 분개장 출력 */
		
	</select>
	
	
	<select id="agj270rkrServiceImpl.selectSheet" parameterType="Map" resultType="rMap" >
		/* 집계표 출력 */
		
		BEGIN
       SET NOCOUNT ON
       SET ARITHABORT ON
    
       /*-- 1. 날짜 포맷 유형 설정 ------------------------------------------------------------------------------------------*/
       DECLARE @DateFormat         NVARCHAR(01)
    
       SELECT TOP 1 @DateFormat = SUBSTRING(CODE_NAME, 5, 1)
       FROM   BSA100T   WITH (NOLOCK)
       WHERE  COMP_CODE  = #{S_COMP_CODE}
       AND    MAIN_CODE  = 'B044'
       AND    REF_CODE1  = 'Y'
    
       SET @DateFormat = ISNULL(@DateFormat, '.')
    
      
       SELECT ROW_NUMBER() OVER(ORDER BY A.AC_DATE, A.SLIP_NUM) AS SEQ
            , CASE WHEN ISNULL(A.AC_DATE, '') = '' THEN NULL
                   ELSE SUBSTRING(A.AC_DATE, 1, 4) + @DateFormat + 
                        SUBSTRING(A.AC_DATE, 5, 2) + @DateFormat + 
                        SUBSTRING(A.AC_DATE, 7, 2)
               END                                                      AS AC_DATE
            , A.SLIP_NUM
            , SUM(A.DR_AMT_I)                                           AS DR_AMT_I
            , SUM(A.CR_AMT_I)                                           AS CR_AMT_I
            , MIN(A.DIV_CODE)                                           AS DIV_CODE
            , '  ' + MIN(A.REMARK)                                      AS REMARK
            , A.INPUT_PATH
            , M3.CODE_NAME                                              AS INPUT_PATH_NAME
            , CASE WHEN ISNULL(A.EX_DATE, '') = '' THEN NULL
                   ELSE SUBSTRING(A.EX_DATE, 1, 4) + @DateFormat + 
                        SUBSTRING(A.EX_DATE, 5, 2) + @DateFormat + 
                        SUBSTRING(A.EX_DATE, 7, 2)
               END                                                      AS EX_DATE
            , A.EX_NUM
            , M1.CODE_NAME                                              AS CHARGE_NAME 
            , SUBSTRING(A.INPUT_DATE, 1, 4) + @DateFormat + 
              SUBSTRING(A.INPUT_DATE, 5, 2) + @DateFormat + 
              SUBSTRING(A.INPUT_DATE, 7, 2)                             AS INPUT_DATE
            , M2.CODE_NAME                                              AS AP_CHARGE_NAME
            , CASE WHEN ISNULL(A.AP_DATE, '') = '' THEN NULL
                   ELSE SUBSTRING(A.AP_DATE, 1, 4) + @DateFormat + 
                        SUBSTRING(A.AP_DATE, 5, 2) + @DateFormat + 
                        SUBSTRING(A.AP_DATE, 7, 2)
               END                                                      AS AP_DATE
            , ISNULL(A.MOD_DIVI, 'N')                                   AS MOD_DIVI
            , A.INPUT_DIVI
            , A.POSTIT_YN
            , MAX(A.DEPT_CODE)          AS DEPT_CODE
            , MAX(A.DEPT_NAME)          AS DEPT_NAME
        FROM    (
        <if test="SLIP_DIVI == &quot;2&quot;">
           SELECT 
                    A.COMP_CODE
                  , A.EX_DATE                                           AS AC_DATE
                  , A.EX_NUM                                            AS SLIP_NUM
                  , CASE WHEN A.DR_CR = '1' THEN A.AMT_I ELSE 0 END     AS DR_AMT_I
                  , CASE WHEN A.DR_CR = '2' THEN A.AMT_I ELSE 0 END     AS CR_AMT_I
                  , A.DIV_CODE
                  , A.REMARK
                  , A.INPUT_PATH
                  , A.AC_DATE                                           AS EX_DATE
                  , A.SLIP_NUM                                          AS EX_NUM
                  , A.CHARGE_CODE
                  , A.INPUT_DATE
                  , A.AP_CHARGE_CODE
                  , A.AP_DATE
                  , A.MOD_DIVI
                  , A.INPUT_DIVI
                  , A.POSTIT_YN
                  , A.DEPT_CODE
                  , A.DEPT_NAME
            FROM                AGJ110T   A  WITH (NOLOCK)  
                    LEFT  JOIN  BOR120T   B  WITH (NOLOCK)   ON B.COMP_CODE   = A.COMP_CODE
                                                          AND B.DIV_CODE    = A.DIV_CODE
                    LEFT  JOIN  ABA400T   C  WITH (NOLOCK)   ON C.COMP_CODE   = A.COMP_CODE
                                                          AND C.ACCNT       = A.ACCNT
                    LEFT  JOIN BSA210T    D  WITH (NOLOCK)   ON D.COMP_CODE   = A.COMP_CODE
                                                          AND D.TREE_CODE   = A.IN_DEPT_CODE
                    LEFT  JOIN BSA210T    E  WITH (NOLOCK)   ON E.COMP_CODE   = A.COMP_CODE
                                                          AND E.TREE_CODE   = A.DEPT_CODE
                                                          
                                                          
                    LEFT  JOIN  L_AGJ270T G  WITH (NOLOCK)   ON G.COMP_CODE   = A.COMP_CODE
                                                            AND G.AC_DATE     =  A.EX_DATE
                                                            AND G.SLIP_NUM    =  A.EX_NUM
                                                            AND G.KEY_VALUE   = #{KEY_VALUE}                                         
                                                          
                                                          
            WHERE   A.COMP_CODE   = #{S_COMP_CODE}
               AND A.AC_DATE  &gt;= #{FR_AC_DATE}
               AND A.AC_DATE  &lt;= #{TO_AC_DATE}
               AND G.KEY_VALUE    = #{KEY_VALUE}
               
        </if>
        <if test="SLIP_DIVI == &quot;1&quot;">
            SELECT 
                    A.COMP_CODE
                  , A.AC_DATE
                  , A.SLIP_NUM
                  , CASE WHEN A.DR_CR = '1' THEN A.AMT_I ELSE 0 END     AS DR_AMT_I
                  , CASE WHEN A.DR_CR = '2' THEN A.AMT_I ELSE 0 END     AS CR_AMT_I
                  , A.DIV_CODE
                  , A.REMARK
                  , A.INPUT_PATH
                  , A.EX_DATE
                  , A.EX_NUM
                  , A.CHARGE_CODE
                  , A.INPUT_DATE
                  , A.AP_CHARGE_CODE
                  , A.AP_DATE
                  , A.MOD_DIVI
                  , A.INPUT_DIVI
                  , A.POSTIT_YN
                  , A.DEPT_CODE
                  , A.DEPT_NAME
            FROM                AGJ210T   A  WITH (NOLOCK)  
                    LEFT  JOIN  BOR120T   B  WITH (NOLOCK)   ON B.COMP_CODE   = A.COMP_CODE
                                                            AND B.DIV_CODE    = A.DIV_CODE
                    LEFT  JOIN  ABA400T   C  WITH (NOLOCK)   ON C.COMP_CODE   = A.COMP_CODE
                                                            AND C.ACCNT       = A.ACCNT
                    LEFT  JOIN  BSA210T   D  WITH (NOLOCK)   ON D.COMP_CODE   = A.COMP_CODE
                                                            AND D.TREE_CODE   = A.IN_DEPT_CODE
                    LEFT  JOIN  BSA210T   E  WITH (NOLOCK)   ON E.COMP_CODE   = A.COMP_CODE
                                                            AND E.TREE_CODE   = A.DEPT_CODE
                    LEFT  JOIN  L_AGJ270T G  WITH (NOLOCK)   ON G.COMP_CODE   = A.COMP_CODE
                                                            AND G.AC_DATE     =  A.AC_DATE
                                                            AND G.SLIP_NUM    =  A.SLIP_NUM
                                                            AND G.KEY_VALUE   = #{KEY_VALUE}                                         
                                                          
                                                          
            WHERE   A.COMP_CODE   = #{S_COMP_CODE}
               AND A.AC_DATE  &gt;= #{FR_AC_DATE}
               AND A.AC_DATE  &lt;= #{TO_AC_DATE}
               AND G.KEY_VALUE    = #{KEY_VALUE}
        </if>
		
		    /*'수정삭제이력표시*/
				AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
	               ) A
	                LEFT  JOIN BSA100T AS M1 WITH (NOLOCK) ON M1.COMP_CODE = A.COMP_CODE
	                                                      AND M1.MAIN_CODE = 'A009'
	                                                      AND M1.SUB_CODE  = A.CHARGE_CODE
	                LEFT  JOIN BSA100T AS M2 WITH (NOLOCK) ON M2.COMP_CODE = A.COMP_CODE
	                                                      AND M2.MAIN_CODE = 'A009'
	                                                      AND M2.SUB_CODE  = A.AP_CHARGE_CODE
	                LEFT  JOIN BSA100T AS M3 WITH (NOLOCK) ON M3.COMP_CODE = A.COMP_CODE
	                                                      AND M3.MAIN_CODE = 'A011'
	                                                      AND M3.SUB_CODE  = A.INPUT_PATH
                                     
	                                                      
	        GROUP   BY  A.AC_DATE   , A.SLIP_NUM  , A.INPUT_PATH, M3.CODE_NAME, A.EX_DATE , A.EX_NUM
	                  , M1.CODE_NAME, A.INPUT_DATE, M2.CODE_NAME, A.AP_DATE   , A.MOD_DIVI, A.INPUT_DIVI, A.POSTIT_YN
	        ORDER   BY  A.AC_DATE, A.SLIP_NUM
	    
	      
	       SET ARITHABORT OFF
	       SET NOCOUNT OFF
	    END
		
		
	</select>	
	
    <select id="agj270rkrServiceImpl.selectPrimaryDataList2_BAK" parameterType="Map" resultType="rMap" > 
        -- 전표출력
        --agj270rkrServiceImpl.selectPrimaryDataList2
        DECLARE   @SLIP_DIVI   NVARCHAR(01)         -- 전표구분
        		, @PAGE_CNT    INT					-- 한페이지당 출력행 갯수
        		
        SET       @SLIP_DIVI = #{SLIP_DIVI}   		--1: 회계 , 2: 결의
        SET       @PAGE_CNT  = #{PAGE_CNT}
        
        BEGIN
           SET NOCOUNT ON
           SET ARITHABORT ON
           
           SELECT T.AUTO_NUM                                                      AS AUTO_NUM
                --20200417 추가: 여유컬럼 계산용 값
                , ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ) AS CAL_EMPTY_ROW
                , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)   AS PAGE 
                --20200417 수정
                --, CONVERT(NUMERIC(6,0),ROUND((T.EX_SEQ-1) / @PAGE_CNT, 0, 1) + 1) AS PAGE_SEQ
                , CONVERT(NUMERIC(6,0),ROUND(((ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ))-1) / @PAGE_CNT, 0, 1) + 1) AS PAGE_SEQ
                , X.PAGE_SEQ                                                      AS MAX_PAGE_SEQ    --PAGE별 PAGE_SEQ의 MAX값
                --20200417 수정
                , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) + RIGHT('00000' + CONVERT(NVARCHAR,CONVERT(NUMERIC(6,0),ROUND(((ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ))-1) / @PAGE_CNT, 0, 1) + 1)),5) AS PAGE_DIVI
                , T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)  AS PAGE_KEY        -- PAGE 별 KEY값 (그룹핑용)
                , 1                                                              AS PAGE_TOT
                , T.IN_DIV_NAME                                                  AS IN_DIV_NAME
                , T.IN_DEPT_CODE                                                 AS IN_DEPT_CODE
                , T.IN_DEPT_NAME                                                 AS IN_DEPT_NAME
                , T.CHARGE_NAME                                                  AS CHARGE_NAME
                , uniLITE.fnGetUserDate(T.COMP_CODE, T.EX_DATE)                  AS EX_DATES
                , T.EX_NUM                                                       AS EX_NUM
                , T.EX_SEQ                                                       AS EX_SEQ
                , uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATE)                  AS AC_DATES
                , T.SLIP_NUM                                                     AS SLIP_NUM
                , T.SLIP_SEQ                                                     AS SLIP_SEQ
                , ISNULL(T.ACCNT, '')                                            AS ACCNT
                , M1.ACCNT_NAME                                                  AS ACCNT_NAME
                  -- 1
                , ISNULL(T.AC_CODE1, '')                                         AS AC_CODE1
                , CASE B1.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA1)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA1),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE1 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA1,'')
                                        END
                   END                                                           AS AC_DATA1
                , ISNULL(T.AC_DATA_NAME1, '')                                    AS AC_DATA_NAME1
                  -- 2
                , ISNULL(T.AC_CODE2, '')                                         AS AC_CODE2
                , CASE B2.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA2)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA2),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE2 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA2,'')
                                        END 
                   END                                                           AS AC_DATA2
                , ISNULL(T.AC_DATA_NAME2, '')                                    AS AC_DATA_NAME2
                  -- 3
                , ISNULL(T.AC_CODE3, '')                                         AS AC_CODE3
                , CASE B3.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA3)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA3),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE3 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA3,'')
                                        END
                   END                                                           AS AC_DATA3
                , ISNULL(T.AC_DATA_NAME3, '')                                    AS AC_DATA_NAME3
                  -- 4
                , ISNULL(T.AC_CODE4, '')                                         AS AC_CODE4
                , CASE B4.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA4)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA4),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE4 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA4,'')
                                        END
                   END                                                           AS AC_DATA4
                , ISNULL(T.AC_DATA_NAME4, '')                                    AS AC_DATA_NAME4
                  -- 5
                , ISNULL(T.AC_CODE5, '')                                         AS AC_CODE5
                , CASE B5.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA5)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA5),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE5 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA5,'')
                                        END
                   END                                                           AS AC_DATA5
                , ISNULL(T.AC_DATA_NAME5, '')                                    AS AC_DATA_NAME5
                  -- 6
                , ISNULL(T.AC_CODE6, '')                                         AS AC_CODE6
                , CASE B6.DT_TYPE WHEN 'D' THEN uniLITE.fnGetUserDate(T.COMP_CODE, T.AC_DATA6)
                                  WHEN 'N' THEN REPLACE(CONVERT(NVARCHAR,CONVERT(MONEY, T.AC_DATA6),112),'.00','')
                                  ELSE CASE WHEN T.AC_CODE6 = 'G5' AND ISNULL(M3.REF_CODE1, '') != 'N' THEN uniLITE.fnCipherDecrypt(M2.CRDT_FULL_NUM, 'C')
                                            ELSE ISNULL(T.AC_DATA6,'')
                                        END
                   END                                                           AS AC_DATA6
                , ISNULL(T.AC_DATA_NAME6, '')                                    AS AC_DATA_NAME6
                  --
                , ISNULL(T.DEPT_NAME, '')                                        AS DEPT_NAME
                , ISNULL(T.DIV_NAME, '')                                         AS DIV_NAME
                , T.DR_CR                                                        AS DR_CR
                , CASE T.DR_CR WHEN '1' THEN T.AMT_I     ELSE 0.0 END            AS DR_AMT_I
                , CASE T.DR_CR WHEN '2' THEN T.AMT_I     ELSE 0.0 END            AS CR_AMT_I
                , CASE T.DR_CR WHEN '1' THEN T.FOR_AMT_I ELSE 0.0 END            AS FOR_DR_AMT_I
                , CASE T.DR_CR WHEN '2' THEN T.FOR_AMT_I ELSE 0.0 END            AS FOR_CR_AMT_I
                , T.REMARK                                                       AS REMARK
                , T.MONEY_UNIT                                                   AS MONEY_UNIT
                , T.SLIP_DIVI                                                    AS SLIP_DIVI
                , T.COMPANY_NUM                                                  AS COMPANY_NUM
                , T.EXCHG_RATE_O                                                 AS EXCHG_RATE_O
                , T.PROOF_KIND                                                   AS PROOF_KIND
                , T.EB_YN                                                        AS EB_YN
                , T.EB_YN_NAME  + CASE WHEN ISNULL(T.EB_YN_NAME, '') = '' THEN '' ELSE ' : ' END + ISNULL(M6.CODE_NAME, '')                 AS EB_YN_NAME
                , T.INPUT_PATH_NM                                                AS INPUT_PATH_NM
                --20200417 수정
                --, DENSE_RANK() OVER(PARTITION BY T.EX_DATE, T.EX_NUM ORDER BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) + RIGHT('00000' + CONVERT(NVARCHAR,CONVERT(NUMERIC(5,0),ROUND((T.EX_SEQ-1) / @PAGE_CNT, 0, 1) + 1)),5)) AS ROWNUM 
                , CONVERT(NUMERIC(6,0),ROUND(((ROW_NUMBER() OVER(PARTITION BY T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7) ORDER BY T.EX_NUM, T.EX_SEQ))-1) / @PAGE_CNT, 0, 1) + 1) AS ROWNUM
             FROM (
                   SELECT A.COMP_CODE                                          AS COMP_CODE
                        , A.AUTO_NUM                                           AS AUTO_NUM
                        , M1.DIV_NAME                                          AS IN_DIV_NAME
                        , A.IN_DEPT_CODE                                       AS IN_DEPT_CODE
                        , A.IN_DEPT_NAME                                       AS IN_DEPT_NAME
                        , M4.CODE_NAME                                         AS CHARGE_NAME
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.AC_DATE  ELSE A.EX_DATE  END   AS EX_DATE 
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.SLIP_NUM ELSE A.EX_NUM   END   AS EX_NUM
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.SLIP_SEQ ELSE A.EX_SEQ   END   AS EX_SEQ
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_DATE  ELSE A.AC_DATE  END   AS AC_DATE 
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_NUM   ELSE A.SLIP_NUM END   AS SLIP_NUM
                        , CASE WHEN @SLIP_DIVI = '1' THEN A.EX_SEQ   ELSE A.SLIP_SEQ END   AS SLIP_SEQ
                        , A.ACCNT                                              AS ACCNT
                        , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE1 
                           END                                                 AS AC_CODE1
                        , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA1 
                           END                                                 AS AC_DATA1
                        , CASE WHEN A.AC_DATA1 = ''  AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'') 
                                    ELSE A.AC_DATA_NAME1
                           END                                                 AS AC_DATA_NAME1
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE2 
                           END                                                 AS AC_CODE2
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'')
                                    ELSE A.AC_DATA2
                           END                                                 AS AC_DATA2
                        , CASE WHEN A.AC_DATA1 != '' AND A.AC_DATA2 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME2 
                           END                                                 AS AC_DATA_NAME2
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE3 
                           END                                                 AS AC_CODE3
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA3 
                           END                                                 AS AC_DATA3
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME3 
                           END                                                 AS AC_DATA_NAME3
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE4
                           END                                                 AS AC_CODE4
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA4 
                           END                                                 AS AC_DATA4
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME4 
                           END                                                 AS AC_DATA_NAME4
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE5
                           END                                                 AS AC_CODE5
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA5 
                           END                                                 AS AC_DATA5
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != ''
                                                     AND  A.AC_DATA5 = ''
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME5 
                           END                                                 AS AC_DATA_NAME5
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != '' 
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 != '' 
                                                     AND  A.AC_DATA6 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN 'A4' 
                                    ELSE A.AC_CODE6
                           END                                                 AS AC_CODE6
                        , CASE WHEN A.AC_DATA1 != '' AND  A.AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != '' 
                                                     AND  A.AC_DATA5 != '' 
                                                     AND  A.AC_DATA6 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_CODE,'') 
                                    ELSE A.AC_DATA6 
                           END                                                 AS AC_DATA6
                        , CASE WHEN A.AC_DATA1 != '' AND  A. AC_DATA2 != ''
                                                     AND  A.AC_DATA3 != ''
                                                     AND  A.AC_DATA4 != ''
                                                     AND  A.AC_DATA5 != ''
                                                     AND  A.AC_DATA6 = '' 
                                                     AND (A.AC_CODE1 != 'A4' 
                                                     AND  A.AC_CODE2 != 'A4' 
                                                     AND  A.AC_CODE3 != 'A4'
                                                     AND  A.AC_CODE4 != 'A4' 
                                                     AND  A.AC_CODE5 != 'A4' 
                                                     AND  A.AC_CODE6 != 'A4')
                                    THEN ISNULL(A.CUSTOM_NAME,'')
                                    ELSE A.AC_DATA_NAME6 
                           END                                                 AS AC_DATA_NAME6
                        , M3.TREE_NAME                                         AS DEPT_NAME
                        , M2.DIV_NAME                                          AS DIV_NAME
                        , A.DR_CR                                              AS DR_CR
                        , A.AMT_I                                              AS AMT_I
                        , A.FOR_AMT_I                                          AS FOR_AMT_I
                        , A.REMARK                                             AS REMARK
                        , CASE WHEN ISNULL(M5.REF_CODE1, '') = 'Y' THEN NULL
                               ELSE ISNULL(A.MONEY_UNIT, 'KRW')
                           END                                                 AS MONEY_UNIT
                        , A.SLIP_DIVI                                          AS SLIP_DIVI
                        , CASE WHEN A.SPEC_DIVI IN ('F1', 'F2') THEN ISNULL(B.COMPANY_NUM, '') 
                               ELSE ''
                           END                                                 AS COMPANY_NUM
                        , A.EXCHG_RATE_O                                       AS EXCHG_RATE_O
                        , CASE WHEN A.SPEC_DIVI IN ('F1', 'F2') THEN ISNULL(M6.CODE_NAME, '') 
                               ELSE '' 
                           END                                                 AS PROOF_KIND
                        , CASE WHEN A.AC_CODE1 = 'I7' THEN A.AC_DATA1
                               WHEN A.AC_CODE2 = 'I7' THEN A.AC_DATA2
                               WHEN A.AC_CODE3 = 'I7' THEN A.AC_DATA3
                               WHEN A.AC_CODE4 = 'I7' THEN A.AC_DATA4
                               WHEN A.AC_CODE5 = 'I7' THEN A.AC_DATA5
                               WHEN A.AC_CODE6 = 'I7' THEN A.AC_DATA6
                               ELSE ''
                           END                                                 AS EB_YN
                        , CASE WHEN A.AC_CODE1 = 'I7' THEN A.AC_DATA_NAME1
                               WHEN A.AC_CODE2 = 'I7' THEN A.AC_DATA_NAME2
                               WHEN A.AC_CODE3 = 'I7' THEN A.AC_DATA_NAME3
                               WHEN A.AC_CODE4 = 'I7' THEN A.AC_DATA_NAME4
                               WHEN A.AC_CODE5 = 'I7' THEN A.AC_DATA_NAME5
                               WHEN A.AC_CODE6 = 'I7' THEN A.AC_DATA_NAME6
                               ELSE ''
                           END                                                 AS EB_YN_NAME
                        , ISNULL(M7.CODE_NAME, '')                             AS INPUT_PATH_NM
                        , A.REASON_CODE
        
        	<if test="SLIP_DIVI == &quot;1&quot;">
        	--회계전표
        
                     FROM  (SELECT * FROM AGJ210T   WITH (NOLOCK)
                             WHERE COMP_CODE = #{S_COMP_CODE}
                              AND AC_DATE + CONVERT(nvarchar, SLIP_NUM) IN
                                <foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
                                    '${acDate}'
                                </foreach>
                                
                             
                             AND (MOD_DIVI IS NULL OR MOD_DIVI = '')) A

                        
                          LEFT JOIN BCM100T   B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                              AND B.CUSTOM_CODE = A.CUSTOM_CODE
                          LEFT JOIN BOR120T   M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
                                                              AND M1.DIV_CODE   = A.IN_DIV_CODE
                          LEFT JOIN BOR120T   M2 WITH (NOLOCK) ON M2.COMP_CODE  = A.COMP_CODE
                                                              AND M2.DIV_CODE   = A.DIV_CODE
                          LEFT JOIN BSA210T   M3 WITH (NOLOCK) ON M3.COMP_CODE  = A.COMP_CODE
                                                              AND M3.TREE_CODE  = A.DEPT_CODE
                          LEFT JOIN BSA100T   M4 WITH (NOLOCK) ON M4.COMP_CODE  = A.COMP_CODE
                                                              AND M4.MAIN_CODE  = 'A009'
                                                              AND M4.SUB_CODE   = A.CHARGE_CODE
                          LEFT JOIN BSA100T   M5 WITH (NOLOCK) ON M5.COMP_CODE  = A.COMP_CODE
                                                              AND M5.MAIN_CODE  = 'B004'
                                                              AND M5.SUB_CODE   = A.MONEY_UNIT
                          LEFT JOIN BSA100T   M6 WITH (NOLOCK) ON M6.COMP_CODE  = A.COMP_CODE
                                                              AND M6.MAIN_CODE  = 'A022'
                                                              AND M6.SUB_CODE   = A.PROOF_KIND
                          LEFT JOIN BSA100T   M7 WITH (NOLOCK) ON M7.COMP_CODE  = A.COMP_CODE
                                                              AND M7.MAIN_CODE  = 'A011'
                                                              AND M7.SUB_CODE   = A.INPUT_PATH
                    WHERE A.COMP_CODE          = #{S_COMP_CODE}
                      AND ISNULL(A.CASH_NUM,0) = 0
                      
        </if>
        <if test="SLIP_DIVI != &quot;1&quot;">
        --결의전표
                     FROM  (SELECT * FROM AGJ110T   WITH (NOLOCK)
                             WHERE COMP_CODE = #{S_COMP_CODE}
                             AND EX_DATE + CONVERT(nvarchar, EX_NUM) IN
                                <foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
                                    '${acDate}'
                                </foreach> 
                                
                                
                             AND (MOD_DIVI IS NULL OR MOD_DIVI = '')) A

                          LEFT JOIN BCM100T   B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                              AND B.CUSTOM_CODE = A.CUSTOM_CODE
                          LEFT JOIN BOR120T   M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
                                                              AND M1.DIV_CODE   = A.IN_DIV_CODE
                          LEFT JOIN BOR120T   M2 WITH (NOLOCK) ON M2.COMP_CODE  = A.COMP_CODE
                                                              AND M2.DIV_CODE   = A.DIV_CODE
                          LEFT JOIN BSA210T   M3 WITH (NOLOCK) ON M3.COMP_CODE  = A.COMP_CODE
                                                              AND M3.TREE_CODE  = A.DEPT_CODE
                          LEFT JOIN BSA100T   M4 WITH (NOLOCK) ON M4.COMP_CODE  = A.COMP_CODE
                                                              AND M4.MAIN_CODE  = 'A009'
                                                              AND M4.SUB_CODE   = A.CHARGE_CODE
                          LEFT JOIN BSA100T   M5 WITH (NOLOCK) ON M5.COMP_CODE  = A.COMP_CODE
                                                              AND M5.MAIN_CODE  = 'B004'
                                                              AND M5.SUB_CODE   = A.MONEY_UNIT
                          LEFT JOIN BSA100T   M6 WITH (NOLOCK) ON M6.COMP_CODE  = A.COMP_CODE
                                                              AND M6.MAIN_CODE  = 'A022'
                                                              AND M6.SUB_CODE   = A.PROOF_KIND
                          LEFT JOIN BSA100T   M7 WITH (NOLOCK) ON M7.COMP_CODE  = A.COMP_CODE
                                                              AND M7.MAIN_CODE  = 'A011'
                                                              AND M7.SUB_CODE   = A.INPUT_PATH
                    WHERE A.COMP_CODE          = #{S_COMP_CODE}
                      AND ISNULL(A.CASH_NUM,0) = 0
        </if>
        
                 ) T
                   LEFT JOIN ABA200T B1 WITH (NOLOCK) ON B1.COMP_CODE = T.COMP_CODE
                                                     AND B1.AC_CD     = T.AC_CODE1
                   LEFT JOIN ABA200T B2 WITH (NOLOCK) ON B2.COMP_CODE = T.COMP_CODE
                                                     AND B2.AC_CD     = T.AC_CODE2
                   LEFT JOIN ABA200T B3 WITH (NOLOCK) ON B3.COMP_CODE = T.COMP_CODE
                                                     AND B3.AC_CD     = T.AC_CODE3
                   LEFT JOIN ABA200T B4 WITH (NOLOCK) ON B4.COMP_CODE = T.COMP_CODE
                                                     AND B4.AC_CD     = T.AC_CODE4
                   LEFT JOIN ABA200T B5 WITH (NOLOCK) ON B5.COMP_CODE = T.COMP_CODE
                                                     AND B5.AC_CD     = T.AC_CODE5
                   LEFT JOIN ABA200T B6 WITH (NOLOCK) ON B6.COMP_CODE = T.COMP_CODE
                                                     AND B6.AC_CD     = T.AC_CODE6
                   LEFT JOIN ABA400T M1 WITH (NOLOCK) ON M1.COMP_CODE = T.COMP_CODE
                                                     AND M1.ACCNT     = T.ACCNT
                   LEFT JOIN ABA500T M2 WITH (NOLOCK) ON M2.COMP_CODE = T.COMP_CODE
                                                     AND M2.CRDT_NUM  = CASE WHEN T.AC_CODE1 = 'G5' THEN T.AC_DATA1
                                                                             WHEN T.AC_CODE2 = 'G5' THEN T.AC_DATA2
                                                                             WHEN T.AC_CODE3 = 'G5' THEN T.AC_DATA3
                                                                             WHEN T.AC_CODE4 = 'G5' THEN T.AC_DATA4
                                                                             WHEN T.AC_CODE5 = 'G5' THEN T.AC_DATA5
                                                                             WHEN T.AC_CODE6 = 'G5' THEN T.AC_DATA6
                                                                             ELSE ''
                                                                        END
                   LEFT JOIN BSA100T M3 WITH (NOLOCK) ON M3.COMP_CODE = T.COMP_CODE
                                                     AND M3.MAIN_CODE = N'A165'
                                                     AND M3.SUB_CODE  = N'41'
                   <if test="SLIP_DIVI == &quot;1&quot;">                                      
                   LEFT JOIN (
                                SELECT A.COMP_CODE
                                     , A.AC_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, A.SLIP_NUM), 7)          AS PAGE 
                                     --, MAX(CONVERT(NUMERIC(5,0),ROUND((A.SLIP_SEQ - 1) / @PAGE_CNT, 0, 1) + 1)) AS PAGE_SEQ
                                     , CONVERT(NUMERIC(5, 0), ROUND((COUNT(*) - 1) / @PAGE_CNT, 0, 1) + 1)		AS PAGE_SEQ
     
                                 FROM AGJ210T A WITH(NOLOCK)
                                WHERE A.COMP_CODE          = #{S_COMP_CODE}
                                  AND ISNULL(A.CASH_NUM,0) = 0
                                  AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
                                   <if test="@foren.Ognl@isNotEmpty(AC_DATE)">
                                    AND A.AC_DATE + CONVERT(nvarchar, A.SLIP_NUM) IN
                                      <foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
                                             '${acDate}'
                                      </foreach>
                                  </if> 
                                  
                      
                                GROUP BY A.COMP_CODE, A.AC_DATE, A.SLIP_NUM
                            ) X ON X.COMP_CODE = T.COMP_CODE
                               AND X.PAGE      = T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)  
                               LEFT JOIN BSA100T M6 WITH (NOLOCK) ON M6.COMP_CODE = T.COMP_CODE
                                                                 AND M6.MAIN_CODE = N'A070'
                                                                 AND M6.SUB_CODE  = T.REASON_CODE
                                                               
                     </if> 
                     <if test="SLIP_DIVI != &quot;1&quot;">             
                     LEFT JOIN (
                                SELECT A.COMP_CODE
                                     , A.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, A.EX_NUM), 7)          AS PAGE 
                                     --, MAX(CONVERT(NUMERIC(5,0),ROUND((A.EX_SEQ - 1) / @PAGE_CNT, 0, 1) + 1)) AS PAGE_SEQ
                                     , CONVERT(NUMERIC(5, 0), ROUND((COUNT(*) - 1) / @PAGE_CNT, 0, 1) + 1)		AS PAGE_SEQ
     
                                 FROM AGJ110T A WITH(NOLOCK)
                                WHERE A.COMP_CODE          = #{S_COMP_CODE}
                                  AND ISNULL(A.CASH_NUM,0) = 0
                                  AND (A.MOD_DIVI IS NULL OR A.MOD_DIVI = '')
                                   <if test="@foren.Ognl@isNotEmpty(AC_DATE)">
                                      AND A.EX_DATE + CONVERT(nvarchar, A.EX_NUM) IN
                                          <foreach collection="AC_DATE" item="acDate" separator="," close=")" open="(">
                                                '${acDate}'
                                          </foreach>
                                   </if>                                    
                                                                     
                                GROUP BY A.COMP_CODE, A.EX_DATE, A.EX_NUM, A.SLIP_NUM
                            ) X ON X.COMP_CODE = T.COMP_CODE
                               AND X.PAGE      = T.EX_DATE + RIGHT('0000000' + CONVERT(NVARCHAR, T.EX_NUM), 7)
                               LEFT JOIN BSA100T M6 WITH (NOLOCK) ON M6.COMP_CODE = T.COMP_CODE
                                                                 AND M6.MAIN_CODE = N'A070'
                                                                 AND M6.SUB_CODE  = T.REASON_CODE
                        </if>                              
           ORDER BY T.EX_DATE, T.EX_NUM, T.EX_SEQ
           
           SET ARITHABORT OFF
           SET NOCOUNT OFF
        
        END
    </select>
    
</mapper>