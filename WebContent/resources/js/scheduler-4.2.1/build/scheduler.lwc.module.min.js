/*!
 *
 * Bryntum Scheduler 4.2.1
 *
 * Copyright(c) 2021 Bryntum AB
 * https://bryntum.com/contact
 * https://bryntum.com/license
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).bryntum=e.bryntum||{},e.bryntum.scheduler={}))}(this,(function(e){"use strict";const t="scheduler",{undefined:n}=window;class r{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isIE11=Boolean(t.match(/rv:11/)),n._edgeVersion=n.getVersion(t,/Edge?\/(\d+)\./),n._isEdge=n._edgeVersion>0&&n._edgeVersion<80,n._isEdge||(n._edgeVersion=0),n._isWebkit=Boolean(t.match(/WebKit/))&&!n._isEdge,n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n._isEdge?0:n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome&&!n._isEdge,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),n._isAndroid=Boolean(t.match(/Android/g));try{document.querySelector(":scope"),n.supportsQueryScope=!n._isFirefox}catch(e){n.supportsQueryScope=!1}n._supportsPassive=!1;try{document.addEventListener("__notvalid__",null,{get passive(){n._supportsPassive=!0}})}catch(e){}}static get supportsSticky(){return!this._isIE11}static getVersion(e,t){const n=e.match(t);return n?parseInt(n[1]):0}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:"ontouchstart"in window||!this.isEdge&&navigator.maxTouchPoints>0||this.isEdge&&window.TouchEvent||navigator.msMaxTouchPoints>0}static set isTouchDevice(e){this._isTouchDevice=e}static get supportsPointerEvents(){return Boolean(window.PointerEvent||window.MSPointerEvent)}static get isHoverableDevice(){return this._isHoverableDevice===n&&(this._isHoverableDevice=window.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return"undefined"!=typeof window}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isIE11(){return this._isIE11}static get isEdge(){return this._isEdge}static get edgeVersion(){return this._edgeVersion}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get isMobileSafari(){return this._isMobileSafari}static get supportsPassive(){return this._supportsPassive}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,n=document.location.search){const r=new RegExp(`[?&]${e}=([^&]*)`),i=n.match(r);return i&&i[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return""}static download(e,t){const n=document.createElement("a");n.download=e,n.href=t||e,n.style.cssText="display:none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static downloadBlob(e,t){const n=window.URL.createObjectURL(e);this.download(t,n),window.URL.revokeObjectURL(n)}static get queryString(){if(this.isBrowserEnv){var e;const t=new URL(window.location.href).searchParams;return null===(e=Object.fromEntries)||void 0===e?void 0:e.call(Object,t.entries())}}static get global(){return this.isBrowserEnv?window:"undefined"!=typeof global?global:globalThis||{}}static copyToClipboard(e){let t=!0;const n=document.createElement("textarea");n.value=e,n.style.height=n.style.width=0,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){t=!1}return n.remove(),t}}r.isBrowserEnv&&r.cacheFlags(),r._$name="BrowserHelper";let i=!1;try{i=Boolean(r.global.parent&&r.global.parent.Siesta||"undefined"!=typeof process&&(r.global.StartTest||r.global.Siesta))}catch(e){}i&&(r._isHoverableDevice=!0);class s{static setVersion(e,n){e=e.toLowerCase(),o[e]={version:n,isNewerThan:e=>e<n,isOlderThan:e=>e>n};let s="";s=t;const a=`${s}.${e}${n.replace(/\./g,"-")}`;if(r.isBrowserEnv&&!r.global.bryntum.silenceBundleException)if(!0===window.bryntum[a]){if(!i)throw new Error('Bryntum bundle included twice, check cache-busters and file types (.js).\nSimultaneous imports from "*.module.js" and "*.umd.js" bundles are not allowed.');window.BUNDLE_EXCEPTION=!0}else window.bryntum[a]=!0}static getVersion(e){if(e=e.toLowerCase(),!o[e])throw new Error("No version specified! Please check that you import VersionHelper right into the class from where you call `deprecate` function.");return o[e].version}static checkVersion(e,t,n){const r=o.getVersion(e);let i;switch(n){case"<":i=r<t;break;case"<=":i=r<=t;break;case"=":i=r===t;break;case">=":i=r>=t;break;case">":i=r>t}return i}static deprecate(e,t,n){if(!o.checkVersion(e,t,"<"))throw new Error(`Deprecated API use. ${n}`);console.warn(`Deprecation warning: You are using a deprecated API which will change in v${t}. ${n}`)}static get isTestEnv(){return i}static get isDebug(){return!1}}const o=s;r.isBrowserEnv&&((window.bryntum||(window.bryntum={})).getVersion=o.getVersion.bind(o),window.bryntum.checkVersion=o.checkVersion.bind(o),window.bryntum.deprecate=o.deprecate.bind(o),window.bryntum.isTestEnv=o.isTestEnv),s._$name="VersionHelper";const a={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1};class l{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,n,e.prototype),!0}static internalOverrideAll(e,t,n){Reflect.ownKeys(n).forEach((r=>{if(t.includes(r)&&!a[r]){const t=Object.getOwnPropertyDescriptor(n,r);let i=e,s=null;for(;!s&&i;)s=Object.getOwnPropertyDescriptor(i,r),s||(i=Object.getPrototypeOf(i));s&&this.internalOverride(i,r,t,s)}}))}static internalOverride(e,t,n,r){(e._overridden=e._overridden||{})[t]=e[t],r.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:n.get}):e[t]=n.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!s[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!s[t.product].isOlderThan(t.minVersion))}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}l._$name="Override";class h{static animationFrame(){return new Promise((e=>{requestAnimationFrame(e)}))}static sleep(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static yield(){return Promise.resolve()}}let g,m,p,f;h._$name="AsyncHelper";const v=/([a-z])([A-Z])/g,y=/[\n\r]/g,b=/[.*+?^${}()|[\]\\]/g,C=/[&<]/,w=/(^[^a-z]+|[^\w]+)/gi,S=/\s+/,E=(e,t)=>m[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10)),D=(e,t)=>g[t],x=(e,t,n)=>`${t}-${n.toLowerCase()}`,R=(e,t,n)=>`${t} ${n.toLowerCase()}`,T=e=>e?`_x${e.charCodeAt(0).toString(16)}`:"__blank__",M={},F={};class A{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static capitalizeFirstLetter(e){return s.deprecate("Core","5.0.0","Deprecated in favor of `capitalize()`, will be removed in 5.0"),e?e[0].toUpperCase()+e.substr(1):null}static lowercaseFirstLetter(e){return s.deprecate("Core","5.0.0","Deprecated in favor of `uncapitalize()`, will be removed in 5.0"),e?e[0].toLowerCase()+e.substr(1):null}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=M[e];return t||(M[e]=e.replace(v,x))}static separate(e){const t=F[e];return t||(F[e]=this.capitalize(e.replace(v,R)))}static createId(e){return String(e).replace(w,T)}static escapeRegExp(e,t){let r=e.replace(b,"\\$&");return t!==n&&(r=new RegExp(r,t)),r}static decodeHtml(e){return e&&String(e).replace(f,E)}static encodeHtml(e){return e&&String(e).replace(p,D)}static encodeHtmlBR(e){var t;return null===(t=A.encodeHtml(e))||void 0===t?void 0:t.replace(y,"<br>")}static isHtml(e){return"string"==typeof e&&C.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);g=e,m=t.reduce(((t,n)=>(t[e[n]]=n,t)),{}),p=new RegExp(`([${t.map((e=>"[-]".includes(e)?"\\"+e:e)).join("")}])`,"g"),f=new RegExp(`(${Object.values(e).join("|")}|&#[0-9]+;)`,"ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){}return t}static safeJsonStringify(e,t=null,n=null){let r=null;try{r=JSON.stringify(e,t,n)}catch(e){}return r}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=S){let n=e;return"string"==typeof n&&(n=e.trim(),n=n?n.split(t):[]),n}static xss(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+A.encodeHtml(t[r]);return n.join("")}static xssBR(e,...t){const n=[];let r=t.length;for(n[r]=e[r];r-- >0;)n[r]=e[r]+A.encodeHtmlBR(t[r]);return n.join("")}}A.initHtmlEntities(),A._$name="StringHelper";const{toString:I}=Object.prototype,{isFrozen:k}=Object,O=/\s*<\s*/,L=/\s*>\s*/,P={},_=/\[object ([^\]]+)]/,$={},H=Object.freeze({});class j{static assign(e,...t){for(let n,r,i=0;i<t.length;i++)if(n=t[i],n)for(r in n)e[r]=n[r];return e}static assignIf(e,...t){for(let r,i,s=0;s<t.length;s++)if(r=t[s],r)for(i in r)i in e&&e[i]!==n||(e[i]=r[i]);return e}static blend(e,t,n){n=n||P,e=e||{};const{clone:r=j.clone,merge:i=j.blend}=n;if(Array.isArray(t)){if(t.length>1)return t.forEach((t=>{e=j.blend(e,t,n)})),e;t=t[0]}if(t){let s,o,a;for(o in t)a=t[o],a&&B.isObject(a)&&(s=e[o],n.key=o,s&&B.isObject(s)?(k(s)&&(e[o]=s=r(s,n)),a=i(s,a,n)):a=k(a)?a:r(a,n)),e[o]=a}return e}static clone(e,t){let n,r=e;if(e&&"object"==typeof e){if(t&&"object"==typeof t&&t&&(t=null),B.isObject(e))for(n in r={},e)r[n]=B.clone(e[n]);else if(Array.isArray(e))for(r=[],n=e.length;n-- >0;)r[n]=B.clone(e[n]);else B.isDate(e)?r=new Date(e.getTime()):t&&(r=t(e))}return r}static createTruthyKeys(e){const t=A.split(e),n=t&&{};if(t)for(const e of t)e&&(n[e]=!0);return n}static getPath(e,t){return t.split(".").reduce(((e,t)=>(e||H)[t]),e)}static getPathDefault(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=r.length-1;return r.reduce(((e,t,r)=>(n&&!(t in e)&&(e[t]=r===i?n:{}),(e||H)[t])),e)}static hasPath(e,t){return t.split(".").every((t=>t in e&&(e=e[t],!0)))}static getTruthyKeys(e){const t=[];for(const n in e)e[n]&&t.push(n);return t}static getTruthyValues(e){const t=[];for(const n in e)e[n]&&t.push(e[n]);return t}static isClass(e){var t;return"function"==typeof e&&(null===(t=e.prototype)||void 0===t?void 0:t.constructor)===e}static isDate(e){return Boolean(e&&e.getUTCDate)&&"date"===B.typeOf(e)}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||"function"==typeof(null==e?void 0:e.then);throw new Error("Promise not supported in your environment")}static isEmpty(e){if(e&&"object"==typeof e)for(const t in e)return!1;return!0}static isObject(e){const t=null==e?void 0:e.constructor;return Boolean(t?t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype):e&&"object"==typeof e)}static isInstantiated(e){return!!e&&("object"==typeof e&&!j.isObject(e))}static merge(e,...t){return j.blend(e,t)}static mergeItems(e,t,n){let r,i,s,o,a,l,c;n=n||P;const{merge:d=j.blend,rebuild:u=!j.ES6_OBJECT_ORDER}=n;if(e=e||{},Array.isArray(t))t.forEach((t=>{e=j.mergeItems(e,t,n)}));else if(t){for(a in t)if(c=t[a],r=null,a.includes(">")?([a,r]=a.split(L),i=0):a.includes("<")&&([r,a]=a.split(O),i=1),a in e)c&&e[a]&&d&&(n.key=a,c=d(e[a],c,n)),e[a]=c;else if(r){if(!o){o=new Map,s=0;for(const t in e)o.set(t,s++)}if(s=o.get(r),e[a]=c,null==s&&i)s=o.size;else{l=!u&&(l||[]),s=(s||0)+i;for(const e of o){const[t,n]=e;s<=n&&(l&&(l[o.size-n-1]=t),o.set(t,n+1))}if(l)for(;l.length;){const t=l.pop(),n=e[t];delete e[t],e[t]=n}}o.set(a,s)}else{var h;e[a]=c,null===(h=o)||void 0===h||h.set(a,o.size)}if(u&&o){const t=Array.from(o.entries()).sort(((e,t)=>e[1]-t[1])),n=e;e={};for(let r,i=0;i<t.length;++i)r=t[i][0],e[r]=n[r]}}return e}static setPath(e,t,n){return t.split(".").reduce(((e,t,r,i)=>r===i.length-1?e[t]=n:(e[t]instanceof Object||(e[t]={}),e[t])),e),e}static typeOf(e){let t,n,r=typeof e;return"object"===r?null===e?r="null":(n=I.call(e),(r=$[n])||(t=_.exec(n),$[n]=r=t?t[1].toLowerCase():n)):e!=e&&(r="nan"),r}}const B=j;B.ES6_OBJECT_ORDER=(()=>{const e={a:1,b:2,c:3};delete e.b,e.b=20;return"c"===Object.keys(e)[1]})(),j._$name="Objects";const{defineProperty:N,getOwnPropertyDescriptor:z}=Reflect,{hasOwnProperty:V,toString:W}=Object.prototype,G=Symbol("instanceProperties"),U=Symbol("configuring"),Y=Symbol("lazyConfigValues"),q=W.call(new Date),K=/\s+/,X=(e,t)=>(e[t]=1,e);class Z{static get(e,t){const{cache:n}=this,r=n[e]||(n[e]=new Z(e));let i,s=r;return t&&(i=Z.makeCacheKey(e,t),(s=i&&n[i])||(s=r.extend(t),i&&(n[i]=s))),s}constructor(e){const t=this,n=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=n,t.changer="change"+n,t.initializing="initializing"+n,t.updater="update"+n}get descriptor(){let e=this._descriptor;return e&&V.call(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return e&&V.call(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{equal:n,merge:r}=e,{equalityMethods:i}=Z;return"string"==typeof n&&(n.endsWith("[]")?t.equal=Z.makeArrayEquals(i[n.substr(0,n.length-2)]):t.equal=i[n]),"string"==typeof r&&(t.merge=Z.mergeMethods[r]),t}define(e){const t=z(e,this.name);let n=this.descriptor;t&&t.get&&(n=Object.assign({},n),n.get=t.get),N(e,this.name,n)}defineInitter(e,t){const{name:n}=this,r=e[G];let i,s;r[n]||!(s=z(e,n))||"value"in s||(r[n]=s),N(e,n,this.initDescriptor),this.lazy&&(i=e[Y]||(e[Y]={$counter_:0}),i[n]=t,++i.$counter_)}static makeArrayEquals(e){return(t,n)=>{let r,i=t&&n&&t.length===(r=n.length);if(i&&Array.isArray(t)&&Array.isArray(n))if(e)for(;i&&r-- >0;)i=e(t[r],n[r]);else for(;i&&r-- >0;)i=t[r]===n[r];else i=e?e(t,n):t===n;return i}}static makeCacheKey(e,t){const n=Object.keys(t).sort();for(let e,r,i,s=n.length;s-- >0;)if(i=t[e=n[s]],null==i&&!1===i)n.splice(s,1);else{if(r=typeof i,"function"===r)return null;"string"===r?n[s]=`${e}:"${i}"`:"number"===r&&(n[s]=`${e}:${i}`)}return n.length?`${e}>${n.join("|")}`:e}makeDescriptor(){const e=this,{base:t,field:r,changer:i,updater:s,name:o}=e;return t!==e&&t.equal===e.equal?t.descriptor:{get(){var e;return null===(e=this.configObserver)||void 0===e||e.get(o,this),this[r]},set(t){const a=this;let l,c,d=a[r];if("string"==typeof t){let e=t;var u;if(t.startsWith("up."))e=null===(u=a.owner)||void 0===u?void 0:u.resolveProperty(t.substr(3));else t.startsWith("this.")&&(e=a.resolveProperty(t.substr(5)));"function"!=typeof e&&(t=e)}a[i]&&(l=(c=a[i](t,d))===n,l||(t=c,d=a[r])),l||(e.equal===Q?d===t:e.equal(d,t))||(a[r]=t,l=!0,a[s]&&a[s](t,d)),l&&!a.onConfigChange.$nullFn&&a.onConfigChange({name:o,value:t,was:d,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this;return e.removeInitter(r),r[t]=!0,r[n]=r[U][n],r[t]=!1,r.configDone[n]=!0,r[n]},set(t){e.removeInitter(this),this.configDone[n]=!0,this[n]=t}}}makeLazyInitter(){const e=this,{initializing:t,name:n}=e;return{configurable:!0,get(){const r=this,i=r[Y][n];return e.removeInitter(r),r.isDestroying||(r[t]=!0,r[n]=i,r[t]=!1),r[n]},set(t){e.removeInitter(this),this[n]=t}}}removeInitter(e){const{name:t}=this,n=e[G][t];n?N(e,t,n):delete e[t],this.lazy&&(--e[Y].$counter_||delete e[Y])}merge(e,t){return t&&e&&j.isObject(t)&&j.isObject(e)&&(e=j.merge(j.clone(t),e)),e}}const{prototype:J}=Z,{equal:Q}=J;Z.symbols={configuring:U,instanceProperties:G,lazyConfigs:Y},Z.cache=Object.create(null),Z.equalityMethods={array:Z.makeArrayEquals(),date:(e,t)=>e===t||!(!e||!t||W.call(e)!==q||W.call(t)!==q)&&e.getTime()===t.getTime(),strict:Z.equal=Q},Z.mergeMethods={distinct(e,t){let r=t?t.slice():[];if(null!=e)if(j.isObject(e))if(t===n)r=e;else{let t,n;for(t in e)n=r.indexOf(t),e[t]?n<0&&r.push(t):n>-1&&r.splice(n,1)}else Array.isArray(e)?e.forEach((e=>!r.includes(e)&&r.push(e))):r.includes(e)||r.push(e);return r},merge:Z.merge=J.merge,classList(e,t){if("string"==typeof e){if(!e.length)return t;e=e.split(K).reduce(X,{})}return Z.merge(e,t)},objects:(e,t)=>!0===e?t||{}:Z.merge(e,t),replace:e=>e,items:(e,t)=>j.mergeItems(t,e,{merge:(e,t)=>J.merge(t,e)})},Object.assign(J,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),Z._$name="Config";class ee{constructor(e){e&&Object.assign(this,e)}getInherited(e,t=!0){let n=this[e];var r;e in this||(n=null===(r=this.super)||void 0===r?void 0:r.getInherited(e,t),(n||t)&&(this[e]=n=Object.create(n||null)));return n}}const{getPrototypeOf:te}=Object,{defineProperty:ne}=Reflect,{hasOwnProperty:re}=Object.prototype,ie=Symbol("classMetaData"),se=Symbol("mixinTag"),oe=Symbol("originalConfig"),ae=Z.symbols.configuring,le=Z.symbols.instanceProperties,ce=Z.symbols.lazyConfigs,de={merge:"replace",simple:!0},ue=()=>{},he=e=>new ee(e),ge={};class me{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,n=t.constructor;t.$meta.class!==n&&n.$meta,t.construct(...e),t.afterConstruct()}static new(...e){return new this(j.merge({},...e))}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=e=>{null!=e&&e.destroy?e.destroy():Array.isArray(e)&&e.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=ue,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)"destroy"!==t&&"isDestroying"!==t&&delete e[t];delete e[oe],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return re.call(this,"$name")&&this.$name||re.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,n){"this"===t&&(t=this);const{handler:r,thisObj:i}=this.resolveCallback(e,t);return n?r.apply(i,n):r.call(i)}resolveProperty(e){let t=this;for(;t;){if(j.hasPath(t,e))return j.getPath(t,e);t=t.owner}return n}resolveCallback(e,t=this,n=!0){if(e.substr){if(e.startsWith("up.")){for(e=e.substr(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substr(5),t=this);if(!(t&&t instanceof Object))return;if("function"!=typeof t[e])return;e=t[e]}return{handler:e,thisObj:t}}bindCallback(e,t=this){if(e){const{handler:n,thisObj:r}=this.resolveCallback(e,t);if(n)return n.bind(r)}}delay(e,t){e=this.setTimeout?e:e.bind(this);(this.setTimeout?this:r.global)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let n=0;n<t.length;++n)null!=e[t[n].field]&&(e[t[n].name]=null)}destroyProperties(...e){const t=this;let n,r;for(n of e)!(n in t)||t[ae]&&t[ae][n]||(r=t[n],r&&r.destroy&&r.destroy(),delete t[n])}configure(e={}){const t=this,{beforeConfigure:n}=e,r=t.$meta.configs,i=t.getDefaultConfiguration();let s,o,a;for(o in t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),e)a=e[o],s=r[o],i[o]=s?s.merge(a,i[o],null):a;n&&(delete i.beforeConfigure,n(t,i)),t.setConfig(t[oe]=i,!0),t.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,t){const n=this,r=n[ae],i=r?n.configDone:n.configDone={},s=n.$meta.configs;let o,a;for(a in n[le]={},n[ae]=r?Object.setPrototypeOf(Object.assign({},e),r):e,e)null!=e[a]||re.call(e,a)?(o=s[a]||Z.get(a),o.defineInitter(n,e[a]),t?o.lazy&&(i[a]=!0):i[a]=!1):i[a]=!0;for(a in t&&n.startConfigure(e),e)i[a]||(n[a]=e[a]);return r?n[ae]=r:delete n[ae],t&&n.finishConfigure(e),n}hasConfig(e){const t=this,n=t[ce],r=t[ae],i=null!=t["_"+e],s=null!=(null==n?void 0:n[e]),o=Boolean(!t.configDone[e]&&r&&(null!=r[e]||re.call(r,e)));return i||s||o}triggerConfig(e){const{configDone:t}=this,n=this[ae],r=n&&(null!=n[e]||re.call(n,e))?!t[e]:null;return r&&this.getConfig(e),r}onConfigChange(){}get config(){const e={},t=this[oe];for(const n in t)e[n]=t[n];return e}static initClass(){return this.$meta.class}static get $meta(){const e=this;let t=e[ie];return re.call(e,ie)||(e[ie]=t=he(),t.class=e,e.setupClass(t)),t}static onClassMixedIn(){}static mergeConfigs(e,...t){const n=this.$meta.configs,r=j.clone(e)||{};let i,s,o,a;for(s=0;s<t.length;++s)if(i=t[s],i)for(o in i)a=i[o],n[o]?a=n[o].merge(a,r[o]):r[o]&&a&&(a=Z.merge(a,r[o])),r[o]=a;return r}static mixin(...e){let t,n=this;for(t=0;t<e.length;++t){const r=e[t],i=r[se]||(r[se]=Symbol("mixinTag"));n[i]||(n=r(n),n[i]=!0,re.call(n,"onClassMixedIn")&&n.onClassMixedIn())}return n}static setupClass(e){var t;const n=e.class,r=te(n).$meta,i=n.$$name,s=r.names,o=n.prototype;if(ne(o,"$meta",{value:e}),Object.assign(e,{super:r,config:Object.create(r.config),configs:Object.create(r.configs),declarables:r.declarables,forkConfigs:r.forkConfigs,hierarchy:Object.freeze([...r.hierarchy,n]),names:s.includes(i)?s:Object.freeze([...s,i]),properties:r.properties,nullify:null===(t=r.nullify)||void 0===t?void 0:t.slice()}),s!==e.names){const e="is"+i;re.call(o,e)||ne(o,e,{value:!0}),re.call(n,e)||ne(n,e,{value:!0})}for(let t,r,i=0;i<e.declarables.length;++i)t=e.declarables[i],re.call(n,t)&&(r=ge[t]||(ge[t]=`setup${A.capitalize(t)}`),n[r](n,e))}static setupConfigs(e,t,n){const r=e.config,i=e.configs,s=e.class.prototype;let o,a,l,c,{nullify:d}=e;for(const u in t)l=t[u],n?(o=i[u])?l=o.merge(l,r[u],e):o=Z.get(u,de):(a=null,l&&"object"==typeof l&&"$config"in l&&(a=l.$config,a&&!j.isObject(a)&&(a=j.createTruthyKeys(a)),"default"in l&&ne(s,Z.get(u).field,{configurable:!0,writable:!0,value:l.default}),l=l.value),(o=i[u])?(c=o.nullify,a&&(o=o.extend(a)),l=o.merge(l,r[u],e)):(o=Z.get(u,a),o.define(e.class.prototype),c=!1),o.nullify&&!c&&(d||(d=e.nullify||(e.nullify=[]))).push(o)),l&&(j.isObject(l)||Array.isArray(l))&&!Object.isFrozen(l)&&(e.forkConfigs=!0),i[u]=o,r[u]=l}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const n=e.declarable;let r,i,s=t.declarables;for(i=0;i<n.length;++i)s.includes(n[i])||(r||(t.declarables=r=s=s.slice()),s.push(n[i]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?me.fork(e.config):Object.create(e.config);if(s.isTestEnv&&r.isBrowserEnv&&t.testConfig&&r.global.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}static fork(e){let t,n,r=e;if(e&&j.isObject(e)&&!Object.isFrozen(e))for(t in r=Object.create(e),e)n=e[t],n&&(j.isObject(n)?r[t]=me.fork(n):Array.isArray(n)&&(r[t]=n.slice()));return r}getProperties(){const e=this.$meta.properties,t={};for(let n=0;n<e.length;n++)Object.assign(t,e[n].properties);return t}static get superclass(){return te(this)}classHierarchy(e){const t=this.$meta.hierarchy,n=e?t.indexOf(e):0;return n>0?t.slice(n):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){var t;let n=this.$detachers;if(n=null===(t=n)||void 0===t?void 0:t[e],n)for(;n.length;)n.pop()()}trackDetacher(e,t){const n=this.$detachers||(this.$detachers={});(n[e]||(n[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const n in t){const r=t[n];for(let t=r.length;t-- >0;)r[t].eventer===e&&r.splice(t,1)}}}const pe=me.prototype;var fe;pe.onConfigChange.$nullFn=!0,me[ie]=pe.$meta=he({class:me,config:Object.freeze({}),configs:Object.create(null),declarables:me.declarable,forkConfigs:!1,hierarchy:Object.freeze([me]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(pe,{$detachers:null,configObserver:null,isDestroyed:!1,isDestroying:!1}),s.setVersion("core","4.2.1"),me._$name="Base";const ve=/^(\w+)=(.*)$/,ye=(null===(fe=r.queryString)||void 0===fe?void 0:fe.__resourceRoot)||"";class be{static get(e,t){return this.fetch(e,t)}static post(e,t,n={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},n))}static fetch(e,t={}){const n=new AbortController;if(Object.assign(t,{abortController:n,signal:n.signal}),"credentials"in t||(t.credentials="include"),t.queryParams){const n=Object.entries(t.queryParams);n.length&&(e+=(e.includes("?")?"&":"?")+n.map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"))}const r=new Promise(((n,i)=>{fetch(ye+e,t).then((e=>{t.parseJson?e.json().then((t=>{e.parsedJson=t,n(e)})).catch((t=>{e.parsedJson=null,e.error=t,i(e)})):n(e)})).catch((e=>{e.stack=r.stack,"AbortError"!==e.name&&i(e)}))}));return r.stack=(new Error).stack,r.abort=function(){n.abort()},r}static mockUrl(e,t){const n=this;(n.mockAjaxMap||(n.mockAjaxMap={}))[e]=t,be.originalFetch||(be.originalFetch=be.fetch),be.fetch=n.mockAjaxFetch.bind(n)}static mockAjaxFetch(e,t){let n=e.split("?"),r=this.mockAjaxMap[n[0]],i=null;if(r){"function"==typeof r&&(r=r(n[0],n[1]&&function(e){const t={},n=e.split("&");for(const e of n){const[n,r,i]=ve.exec(e),s=decodeURIComponent(r),o=decodeURIComponent(i);if(n){let e=t[s];e?(Array.isArray(e)||(e=t[s]=[e]),e.push(o)):t[s]=o}}return t}(n[1]),t));try{i=t.parseJson&&JSON.parse(r.responseText)}catch(e){i=null,r.error=e}return r=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:i,text:()=>new Promise((e=>{e(r.responseText)})),json:()=>new Promise((e=>{e(i)}))},r),new Promise((function(e,t){r.synchronous?e(r):setTimeout((function(){e(r)}),"delay"in r?r.delay:100)}))}return be.originalFetch(e,t)}}be._$name="AjaxHelper";class Ce{static clean(e){return e.reduce(((e,t)=>(null===t||t===n||Array.isArray(t)&&0===t.length||""===t||e.push(t),e)),[])}static from(e,t,n){const r=[];if(e)for(const i of e)t&&!t(i)||r.push(n?n(i):i);return r}static remove(e,...t){let n,r,i=!1;for(let s=0;s<t.length;s++)r=t[s],-1!==(n=e.indexOf(r))&&(e.splice(n,1),i=!0);return i}static findInsertionIndex(e,t,n=this.lexicalCompare,r){const i=t.length;let s,o;return r<i&&(s=r>0?n(t[r-1],e):0,o=r<i-1?n(e,t[r]):0,s<1&&o<1)?r:this.binarySearch(t,e,n)}static findLast(e,t,n){for(let{length:r}=e,i=r-1;i>=0;i--)if(t.call(n,e[i],i,e))return e[i]}static binarySearch(e,t,n=0,r=e.length,i=this.lexicalCompare){const s=e.length;let o,a;for(n instanceof Function?(i=n,n=0):r instanceof Function&&(i=r,r=s),--r;n<=r;)o=n+r>>1,a=i(t,e[o]),a>=0?n=o+1:a<0&&(r=o-1);return n}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},n=null){const r=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(const e of i){const i=Object.assign({},e);n&&n(i,t),r.push(i)}return r}static populate(e,t){const n=[];for(let r=0;r<e;r++)n.push(t(r));return n}static include(e,t){e.includes(t)||e.push(t)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,n,r):(e[i<0?e.length+i:i]=n,!0)}})}static delta(e,t,n=!1){if(!t)return n?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const r=[],i=[],s=[];for(let n=0;n<e.length;n++){const i=e[n];t.includes(i)?s.push(i):r.push(i)}for(let e=0;e<t.length;e++){const n=t[e];s.includes(n)||i.push(n)}return n?{toAdd:r,toRemove:i,toKeep:s}:{onlyInA:r,onlyInB:i,inBoth:s}}}(e=>{const t=new Array(600),n={};let r,i,s,o;for(r=0;r<600;++r)t[r]=[Math.floor(3*Math.random())+1,r+1];for(t.sort(((e,t)=>e[0]-t[0])),r=0;r<600&&!s;++r)[i,o]=t[r],s=n[i]>o,n[i]=o;if(s){const{prototype:e}=Array,{sort:t}=e,n=(e,t)=>e<t?-1:t<e?1:0,r=function(e){const r=this,i=r.length;let s,o;if(i>1){for(o=new Array(i),s=i;s-- >0;)o[s]=s;for(e=e||n,t.call(o,((t,n)=>e(r[t],r[n])||t-n)),s=i;s-- >0;)o[s]=r[o[s]];for(s=i;s-- >0;)r[s]=o[s]}return r};Object.defineProperty(e,"sort",{configurable:!0,value:r})}})(),Ce._$name="ArrayHelper";const{hasOwnProperty:we}=Object.prototype;class Se{static after(e,t,r,i,s){const o="string"==typeof r,a=!1!==(null==s?void 0:s.return),l=(...t)=>{const s=l.$nextHook.call(e,...t),c=null!=i&&i.isDestroyed?n:a?o?i[r](s,...t):r.call(i,s,...t):o?i[r](...t):r.call(i,...t);return c===n?s:c};return Se.hookMethod(e,t,l)}static before(e,t,n,r){const i="string"==typeof n,s=(...t)=>{const o=null!=r&&r.isDestroyed?0:i?r[n](...t):n.call(r,...t);return!1===o?o:s.$nextHook.call(e,...t)};return Se.hookMethod(e,t,s)}static curry(e){return function t(...n){return n.length>=e.length?e.apply(this,n):function(...e){return t.apply(this,n.concat(e))}}}static bindAll(e){for(const t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,n){return(...r)=>!1!==t.call(n,...r)&&e.call(n,...r)}static createSequence(e,t,r){return(...i)=>{const s=e.call(r,...i),o=t.call(r,...i);return o===n?s:o}}static createThrottled(e,t,n,r,i){let s,o,a=-Number.MAX_VALUE;const l=()=>{o=0,a=performance.now(),s.push.apply(s,r),e.apply(n,s)},c=function(...e){const c=performance.now()-a;s=e,c>=t?(clearTimeout(o),l()):(o||(o=setTimeout(l,t-c)),i&&(s.push.apply(s,r),i.apply(n,s)))};return c.cancel=()=>clearTimeout(o),c}static createBuffered(e,t,n,r){let i,s;const o=()=>{s=0,a.isPending=!1,i.push.apply(i,r),e.apply(n,i)},a=function(...e){i=e,s&&clearTimeout(s),a.isPending=!0,s=setTimeout(o,t)};return a.cancel=()=>{a.isPending=!1,clearTimeout(s)},a}static hookMethod(e,t,n){return n.$nextHook=e[t],e[t]=n,()=>{if(we.call(e,t)){let s,o=e[t];var r;if(o===n)(null===(r=Object.getPrototypeOf(e))||void 0===r?void 0:r[t])===n.$nextHook?delete e[t]:e[t]=n.$nextHook;else for(;s=null===(i=o)||void 0===i?void 0:i.$nextHook;o=s){var i;if(s===n){o.$nextHook=n.$nextHook;break}}}}}static noThrow(e,t,n){const r=e[t];e[t]=(...t)=>{try{return r.apply(e,t)}catch(e){return null==n?void 0:n(e)}}}static returnTrue(){return!0}static animate(e,t,n,r="linear"){let i=!1;const s=new Promise((s=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1),c=n&&n.setTimeout?n:window;i||!1===t.call(n,this.easingFunctions[r](l))&&s(),i||1===l?c.requestAnimationFrame((()=>s())):c.requestAnimationFrame(a)};a()}));return s.cancel=()=>(i=!0,!1),s}}const Ee=.5,De=1.70158,xe=7.5625,Re=1.525,Te=2/2.75,Me=2.25/2.75,Fe=1/2.75,Ae=1.5/2.75,Ie=2.5/2.75,ke=2.625/2.75,Oe=.75,Le=.9375,Pe=.984375;Se.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=Ee)<1?Ee*Math.pow(e,2):-.5*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=Ee)<1?Ee*Math.pow(e,3):Ee*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=Ee)<1?Ee*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=Ee)<1?Ee*Math.pow(e,5):Ee*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-.5*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=Ee)<1?Ee*Math.pow(2,10*(e-1)):Ee*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=Ee)<1?-.5*(Math.sqrt(1-e*e)-1):Ee*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<Fe?xe*e*e:e<Te?xe*(e-=Ae)*e+Oe:e<Ie?xe*(e-=Me)*e+Le:xe*(e-=ke)*e+Pe,easeInBack:e=>e*e*((De+1)*e-De),easeOutBack:e=>(e-=1)*e*((De+1)*e+De)+1,easeInOutBack:e=>{let t=1.70158;return(e/=Ee)<1?Ee*(e*e*((1+(t*=Re))*e-t)):Ee*((e-=2)*e*((1+(t*=Re))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=Ee)<1?Ee*(e*e*((1+(t*=Re))*e-t)):Ee*((e-=2)*e*((1+(t*=Re))*e+t)+2)},swingFrom:e=>e*e*((De+1)*e-De),swingTo:e=>(e-=1)*e*((De+1)*e+De)+1,bounce:e=>e<Fe?xe*e*e:e<Te?xe*(e-=Ae)*e+Oe:e<Ie?xe*(e-=Me)*e+Le:xe*(e-=ke)*e+Pe,bouncePast:e=>e<Fe?xe*e*e:e<Te?2-(xe*(e-=Ae)*e+Oe):e<Ie?2-(xe*(e-=Me)*e+Le):2-(xe*(e-=ke)*e+Pe),easeFromTo:e=>(e/=Ee)<1?Ee*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},Se._$name="FunctionHelper";const{isArray:_e}=Array,{hasOwnProperty:$e}=Object.prototype,He={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1},je=(e,t)=>t.prio-e.prio;var Be=e=>class t extends(e||me){static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(e,t){const n=t.getInherited("deprecatedEvents"),r=e.deprecatedEvents;for(const e in r)n[e.toLowerCase()]=n[e]=r[e]}static get configurable(){return{listeners:{value:null,$config:{merge(e,t){if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[_e(t)?"apply":"call"](e,t)}return e}}},bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(e,...t){var n;(this.configuredListeners=null===(n=e)||void 0===n?void 0:n.listeners)&&delete(e=d({},e)).listeners,super.construct(e,...t),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const e=this,{isConfiguring:t}=e;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(),super.doDestroy()}static setupClass(e){super.setupClass(e),t.prototype.onListen.$nullFn=!0,t.prototype.onUnlisten.$nullFn=!0}addListener(e,t,i){if(_e(e)){for(let n=0,{length:r}=e;n<r;n++)this.addListener(e[n],t);return}const o=this,a=o.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return o.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:i});{t=e.thisObj=e.thisObj!==n?e.thisObj:t;for(const i in e)if(!He[i]){const l=i.toLowerCase(),c=null==a?void 0:a[l],d=o.eventListeners||(o.eventListeners={}),u=e[i],h=u.expires||e.expires,g={fn:"object"==typeof u?u.fn:u,thisObj:u.thisObj!==n?u.thisObj:t,args:u.args||e.args,prio:u.prio!==n?u.prio:e.prio!==n?e.prio:0,once:u.once!==n?u.once:e.once!==n&&e.once,buffer:u.buffer||e.buffer,throttle:u.throttle||e.throttle,catchAll:"catchAll"===i};if(c){const{product:e,invalidAsOfVersion:t,message:n}=c;s.deprecate(e,t,n)}if(h){const e=o.isDelayable?o:r.global,{alt:n}=h,i=n?h.delay:h;e.setTimeout((()=>{o.un(l,g),n&&!g.called&&o.callback(n,t)}),i)}let m=d[l]||(d[l]=[]);m.$firing&&(d[l]=m=m.slice()),m.splice(Ce.findInsertionIndex(g,m,je,m.length),0,g),!o.onListen.$nullFn&&m.length<2&&o.onListen(l)}e.relayAll&&o.relayAll(e.relayAll),t&&t!==o&&o.attachAutoDetacher(e,t);const i=!1!==e.detachable,c=e.name,d=e.expires||i||c?()=>{o.isDestroyed||o.removeListener(e,t)}:null;var l;if(d)if(d.eventer=o,d.listenerName=c,c&&null!==(l=t)&&void 0!==l&&l.trackDetacher&&t.trackDetacher(c,d),e.expires&&o.delay(d,e.expires),i)return d}}on(...e){return this.addListener(...e)}un(...e){this.removeListener(...e)}get listeners(){return this.eventListeners}changeListeners(e){if(!this.isConfiguring)return e&&!("thisObj"in e)&&(e=j.assign({thisObj:this},e)),e;e&&this.on(e,this)}updateListeners(e,t){t&&this.un(t),e&&this.on(e)}removeListener(e,t=e.thisObj,n){const r=this;if("string"==typeof e)return r.removeListener({[e]:t},n);Object.entries(e).forEach((([e,n])=>{if(!He[e]){e=e.toLowerCase();const i=r.eventListeners,s=r.findListener(e,n,t);if(s>=0){let t=i[e];t.length>1?(t.$firing&&(i[e]=t=t.slice()),t.splice(s,1)):(delete i[e],r.onUnlisten.$nullFn||r.onUnlisten(e))}}})),e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)}findListener(e,t,n){var r;const i=null===(r=this.eventListeners)||void 0===r?void 0:r[e],s=t.fn||t,o=t.thisObj||n;if(i)for(let e,t=0,{length:n}=i;t<n;t++)if(e=i[t],e.fn===s&&e.thisObj===o)return t;return-1}hasListener(e){var t;return Boolean(null===(t=this.eventListeners)||void 0===t?void 0:t[null==e?void 0:e.toLowerCase()])}relayAll(e,t,n=!0){this.relayAllTargets||(this.relayAllTargets=[]);const r=this.relayAllTargets;e.on("beforeDestroy",(({source:t})=>{if(t===e){r.filter((t=>t.through===e)).forEach((e=>Ce.remove(r,e)))}})),r.push({through:e,prefix:t,transformCase:n})}removeAllListeners(){const e=this.eventListeners;let t,n;for(const i in e){const s=e[i];for(t=s.length;t-- >0;){var r;const e=s[t];this.removeListener(i,e),n=e.thisObj,null!==(r=n)&&void 0!==r&&r.untrackDetachers&&n.untrackDetachers(this)}}}relayEvents(e,t,n=""){const r={detachable:!0};return t.forEach((e=>{r[e]=(e,...t)=>this.trigger(n+e.type,e,...t)})),e.on(r)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:e,target:t,oldDestructor:n}=this;for(let n=0;n<e.length;n++){const{dispatcher:r,config:i}=e[n];r.isDestroyed||r.removeListener(i,t)}n.call(t)}attachAutoDetacher(e,t){const n=e.thisObj||t,r="doDestroy"in n?"doDestroy":"destroy";if(r in n){let{$autoDetachers:t}=n;t||(n.$autoDetachers=t=[]),n.$oldDestructor||(n.$oldDestructor=n[r],n[r]=this.destructorInterceptor.bind({autoDetachers:t,oldDestructor:n.$oldDestructor,target:n})),t.push({config:e,dispatcher:this})}else n[r]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj;t.$oldDestructor&&!t.isDestroying&&(Ce.remove(t.$autoDetachers,t.$autoDetachers.find((t=>t.config===e&&t.dispatcher===this))),t.$autoDetachers.length||(t["doDestroy"in t?"doDestroy":"destroy"]=t.$oldDestructor,t.$oldDestructor=null))}await(e,t={checkLog:!0,resetLog:!0,args:null}){const n=this;!1===t&&(t={checkLog:!1});const{args:r}=t;return new Promise((i=>{var s;if(t.checkLog&&null!==(s=n._triggered)&&void 0!==s&&s[e]&&(i(),t.resetLog&&n.clearLog(e)),r){const s=n.on({[e]:(...o)=>{Object.keys(r).every((e=>e in o[0]&&o[0][e]===r[e]))&&(i(...o),t.resetLog&&n.clearLog(e),s())},prio:-1e4})}else n.on({[e]:(...r)=>{i(...r),t.resetLog&&n.clearLog(e)},prio:-1e4,once:!0})}))}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}trigger(e,t){var n,r,i,s;const o=this,a=e.toLowerCase(),{eventsSuspended:l,relayAllTargets:c,callOnFunctions:d}=o;let u,h=null===(n=o.eventListeners)||void 0===n?void 0:n[a];if(o._triggered||(o._triggered={}),o._triggered[e]=!0,l)return l.shouldQueue&&l.queue.push(arguments),!0;if(null!==(r=o.eventListeners)&&void 0!==r&&r.catchall&&((h=h?h.slice():[]).push(...o.eventListeners.catchall),h.sort(je)),!h&&!c&&!d)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=o:t=Object.setPrototypeOf({source:o},t)):t={source:o},t.type!==a&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>a}):t.type=a),!("bubbles"in t)&&null!==(i=o.bubbleEvents)&&void 0!==i&&i[e]&&(t.bubbles=o.bubbleEvents[e]),d){const n="on"+A.capitalize(e);if(n in o){var g;let e=!1===o.callback(o[n],o,[t]);if(!o.isDestroyed&&$e.call(o,n)&&(null===(g=o.pluginFunctionChain)||void 0===g||!g[n])){const r=Object.getPrototypeOf(o);if(n in r&&(e=!1===r[n].call(o,t)||e,o.isDestroyed))return}if(e)return!1}}if(h){let e,n,r,i=0;for(h.$firing=!0;i<h.length&&!o.isDestroyed&&!1!==r;i++){e=h[i];let s=e.thisObj;if(!s||!s.isDestroyed){if(e.called=!0,e.once&&o.removeListener(a,e),"string"==typeof e.fn){if(s&&(n=s[e.fn]),!n){const t=o.resolveCallback(e.fn);n=t.handler,s=t.thisObj}}else n=e.fn;if(e.buffer){if(!e.bufferFn){const t=Number(e.buffer);if("number"!=typeof t||isNaN(t))throw new Error(`Incorrect type for buffer, got "${t}" (expected a Number)`);e.bufferFn=Se.createBuffered(n,t,e.thisObj,e.args)}n=e.bufferFn}if(e.throttle){const t=Number(e.throttle);if("number"!=typeof t||isNaN(t))throw new Error(`Incorrect type for throttle, got "${t}" (expected a Number)`);e.throttledFn||(e.throttledFn=Se.createThrottled(n,t,e.thisObj,e.args)),n=e.throttledFn}r=n.call(s||o,...e.args||[],t),j.isPromise(r)&&(u||(u=[])).push(r)}}if(h.$firing=!1,!1===r)return r}return c&&c.forEach((n=>{let r=e;if(n.transformCase&&(r=A.capitalize(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1})),t.bubbles&&o.owner&&!o.owner.isDestroyed?o.owner.trigger(e,t):null===(s=u)||void 0===s||!s.length||new Promise((e=>{Promise.all(u).then((t=>{const n=!t.some((e=>!1===e));e(n)}))}))}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}};class Ne{static mergeLocales(...e){const t={};return e.forEach((e=>{Object.keys(e).forEach((n=>{"object"==typeof e[n]?t[n]=d(d({},t[n]),e[n]):t[n]=e[n]}))})),t}static trimLocale(e,t){const n=(t,n)=>{if(!e[t])throw new Error(`Key "${t}" doesn't exist in locale`);if(n){if(!e[t][n])throw new Error(`SubKey "${t}.${n}" doesn't exist in locale`);delete e[t][n]}else delete e[t]};Object.keys(t).forEach((e=>{Object.keys(t[e]).length>0?Object.keys(t[e]).forEach((t=>n(e,t))):n(e)}))}static publishLocale(e,t){const n=window.bryntum=window.bryntum||{},r=n.locales=n.locales||{};r[e]=r[e]?this.mergeLocales(r[e],t):t}}Ne._$name="LocaleHelper";class ze extends(Be(me)){static get defaultConfig(){return{locales:{},throwOnMissingLocale:s.isTestEnv}}construct(...e){const t=this;if(super.construct(...e),r.isBrowserEnv){const e=document.querySelector("script[data-default-locale]"),{locales:n}=window.bryntum||{};e&&(t.defaultLocaleName=e.dataset.defaultLocale),n&&(Object.keys(n).forEach((e=>{if(!e.startsWith("moment")){const r=n[e];r.extends?t.extendLocale(r.extends,r):r.localeName&&t.registerLocale(r.localeName,{desc:r.localeDesc,locale:r})}})),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){var n;const r=this,i=r.defaultLocaleName===e,s=(null===(n=r.locale)||void 0===n?void 0:n.localeName)===e,o=0===Object.keys(r.locales).length;let a=r.locales[e];a?(t.exclude&&(a.exclude=Ne.mergeLocales(a.exclude||{},t.exclude)),a.locale=Ne.mergeLocales(a.locale,t.locale)):(r.locales[e]=t,a=r.locales[e]),a.exclude&&Ne.trimLocale(a.locale,a.exclude),(i||!r.defaultLocaleName&&(o||s))&&r.internalApplyLocale(a)}extendLocale(e,t){var n;const r=this.locales[e];return!!r&&(r.locale=Ne.mergeLocales(r.locale,t),delete r.locale.extends,(null===(n=this.locale)||void 0===n?void 0:n.localeName)===e&&this.applyLocale(e),!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,n=!1){const i=this,s=i.locales[e];if(null!=s&&s.locale&&i._locale===s.locale&&!t)return!0;if(!s){if(n)return!0;throw new Error(`Locale ${e} not registered`)}function o(){i.internalApplyLocale(s)}return s.locale?(o(),!0):new Promise(((t,n)=>{i.loadLocale(s.path).then((n=>{n.text().then((n=>{new Function(n)(),r.isBrowserEnv&&(s.locale=window.bryntum.locales[e]),o(),t(s)}))})).catch((e=>n(e)))}))}loadLocale(e){return be.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}}const Ve=new ze,We=Object.getPrototypeOf(Object),Ge=/L{.*?}/g,Ue=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}");var Ye=e=>class t extends(e||me){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(e){var t,n;return"string"==typeof e?e:e===We?"Object":e.$$name||e.name||(null===(t=e.prototype)||void 0===t?void 0:t.$$name)||(null===(n=e.prototype)||void 0===n?void 0:n.name)}static parseLocaleString(e){var t;const r=[];let i;if(null!==(t=e)&&void 0!==t&&t.includes("L{")){const t=/L{(.*?)}/g;for(e=e.replace(/{(\d+)}/gm,"[[$1]]");null!=(i=t.exec(e));){const e=/((.*?)\.)?(.+)/g.exec(i[1]);r.push({match:Ue(i[0]),localeKey:Ue(e[3]),localeClass:e[2]})}}return r.length>0?r:[{match:e,localeKey:e,localeClass:n}]}construct(e={},...t){super.construct(e,...t),Ve.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(e){var r;const i=this,s=j.getPath(i,e),o=null===(r=i.$meta.configs[e])||void 0===r?void 0:r.localeKey;if(o){const n=t.localize(o,null,i.localeClass||i);n&&!(e in i.initialConfig)&&j.setPath(i,e,n)}else if("string"==typeof s){i.originalLocales=i.originalLocales||{};let t=j.getPath(i.originalLocales,e);t===n&&(j.setPath(i.originalLocales,e,s),t=s),t&&j.setPath(i,e,i.optionalL(t))}}updateLocalization(){var e;null===(e=this.localizableProperties)||void 0===e||e.forEach(this.localizeProperty,this)}static getTranslation(e,n,r){const{locale:i}=Ve;let s,o,a=null;if(i)for(const{match:l,localeKey:c,localeClass:d}of this.parseLocaleString(e)){const u=t=>{var s;const o=null===(s=i[t])||void 0===s?void 0:s[c];return o&&(a="function"==typeof o?null!=n?o(n):o:"object"==typeof o||e===l?o:(a||e).replace(l,o),"string"==typeof o&&o.includes("L{")&&(a=this.getTranslation(o,n,r))),o};let h=!1;for(o=r;o&&(s=t.clsName(o))&&!(h=u(s))&&"string"!=typeof o;o=Object.getPrototypeOf(o));!h&&d&&u(d)}return a}static localize(e,r=n,...i){var s;0===(null===(s=i)||void 0===s?void 0:s.length)&&(i=[this]);let o=null;return i.some((n=>(o=t.getTranslation(e,r,n),null!=o))),o}static L(e,r=n,...i){var s;0===(null===(s=i)||void 0===s?void 0:s.length)&&(i=[this]);const o=this.localize(e,r,...i);if(Ve.throwOnMissingLocale&&Ve.locale&&null==o)throw new Error(`Localization is not found for '${e}' in '${i.map((e=>t.clsName(e))).join(", ")}'. ${Ve.locale.localeName?`Locale : ${Ve.locale.localeName}`:""}`);return null!=o?o:e}L(e,n){const{localeClass:r,constructor:i}=this;return r&&t.clsName(r)!==t.clsName(i)?t.L(e,n,r,i):t.L(e,n,i)}static optionalL(e,r=n,...i){var s;const o=Ve.throwOnMissingLocale;Ve.throwOnMissingLocale=o&&Ge.test(e),0===(null===(s=i)||void 0===s?void 0:s.length)&&(i=[this]);const a=t.L(e,r,...i);return Ve.throwOnMissingLocale=o,a}optionalL(e,t){const n=Ve.throwOnMissingLocale;Ve.throwOnMissingLocale=n&&Ge.test(e);const r=this.L(e,t);return Ve.throwOnMissingLocale=n,r}get localeManager(){return Ve}};const{toString:qe}=Object.prototype,Ke=qe.call(new Date),Xe=new RegExp("â€Ž","g"),Ze=(e,t)=>isNaN(e)||null==e?t:e,Je=e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t},Qe=(e,t,n)=>{let i=(st[e]||(st[e]=new Intl.DateTimeFormat(nt,t))).format(n);return r.isIE11&&(i=i.replace(Xe,"")),i},et=(e,t,n,r=!1)=>{let i=Qe(e,t,n);return/am|pm/i.test(i)&&(i=i.replace(/^0/,""),r&&(i=i.replace(/:00/,""))),i},tt=e=>e>=0?e:e+7;let nt="en-US",rt=Je,it={},st={},ot={};const at={M:e=>e.getMonth()+1,Mo:e=>rt(at.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>Qe("MMM",{month:"short"},e),MMMM:e=>Qe("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>rt(at.Q(e).toString()),D:e=>e.getDate(),Do:e=>rt(at.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/pt.day.millisecond),DDDo:e=>rt(at.DDD(e).toString()),DDDD:e=>at.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>rt(e.getDay().toString()),d1:e=>at.ddd(e).substring(0,1),dd:e=>at.ddd(e).substring(0,2),ddd:e=>Qe("ddd",{weekday:"short"},e),dddd:e=>Qe("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>Mt.getWeekNumber(e)[1],Wo:e=>rt(at.W(e).toString()),WW:e=>at.W(e).toString().padStart(2,"0"),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>at.h(e).toString().padStart(2,"0"),k:e=>e.getHours()+1,kk:e=>at.k(e).toString().padStart(2,"0"),K:e=>et("K",{hour:"numeric"},e),KK:e=>et("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>at.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>at.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>Qe("z",{timeZoneName:"short"},e),zz:e=>Qe("zz",{timeZoneName:"long"},e),Z:e=>Ft.getGMTOffset(e),LT:e=>et("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>et("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>et("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>Qe("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>Qe("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>Qe("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>Qe("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>Qe("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>Qe("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>Qe("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>Qe("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},lt=`^(?:${Object.keys(at).sort(((e,t)=>t.length-e.length)).join("|")})`,ct=()=>({}),dt=e=>(e=>Et.test(e))(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},ut={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:ct,MMM:ct,MMMM:ct,DDDo:ct,DDDD:ct,d:ct,do:ct,d1:ct,dd:ct,ddd:ct,dddd:ct,Q:ct,Qo:ct,W:ct,Wo:ct,WW:ct,e:ct,E:ct,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:dt,SS:dt,SSS:dt,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",Z:e=>{if(!e||!Dt.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const n=Dt.exec(e);if(n){t=("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},ht=Object.keys(ut).sort(((e,t)=>t.length-e.length)),gt=new RegExp(`(${ht.join("|")})`),mt=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),pt={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:87648,minute:5258880,second:315532800,millisecond:3155328e5},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/87648,year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/5258880,year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/315532800,year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/3155328e5,year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},ft={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},vt=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,yt=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,bt=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],Ct=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],wt=["decade","year","month","week","day","hour","minute","second","millisecond"],St=["milliseconds","seconds","minutes","hours","date","month","year"],Et=/^[0-9]+$/,Dt=/([+-])(\d\d):*(\d\d)*$/,xt={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},Rt={round:(e,t=1)=>Math.round(e/t)*t,floor:(e,t=1)=>Math.floor(e/t)*t,ceil:(e,t=1)=>Math.ceil(e/t)*t},Tt={};class Mt extends(Ye()){static get $name(){return"DateHelper"}static set defaultFormat(e){Ft._defaultFormat=e}static get defaultFormat(){return Ft._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(gt),n=[];return 1===t.length||mt.test(e)?[]:(t.reduce(((t,r,i,s)=>{if(0!==i||""!==r)if(gt.test(r)){const o=(this.localize("L{parsers}")||{})[r]||ut[r];if("Z"===r&&i<s.length-2)throw new Error(`Invalid format ${e} TimeZone (Z) must be last token`);if("string"==typeof o){const e=Ft.buildParser(o),r=e.pop();delete r.last,n.push(...e),t=r}else t.pattern=r,t.fn=ut[r]}else t.splitter=r,n.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&n.push(t);return t}),{}),n[n.length-1].last=!0,n)}static makeKey(e){e.getTime&&(e=e.getTime());const t=Tt[e];return t||(Tt[e]=Ft.format(new Date(e),"YYYY-MM-DD"))}static parseKey(e){return Ft.parse(e,"YYYY-MM-DD")}static parse(e,t=Ft.defaultParseFormat){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const n={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(/S+/gm,"SSS");let r,i=ot[t];i||(i=ot[t]=Ft.buildParser(t)),i.reduce(((e,t)=>{if(!t.last){let r,i,s;if(r="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):""!==t.splitter?e.indexOf(t.splitter):t.pattern&&t.pattern.length||-1,-1===r||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(i=e,s=""):(i=t[0],s=`${t[1]}${t[2]}`)}else i=e.substring(0,r)||e,s=e.substring(r+t.splitter.length);if(t.fn){const e=t.fn(i);e?Object.assign(n,e):s=i+s}return s}Object.assign(n,t.fn(e))}),e),n.year&&!n.date&&(n.date=1);const s=Ft.create(n);return r=s||new Date(e),r}static create(e){const t=d({},e);let n=isNaN(t.year),r=!1;if(!n){let e=!0;St.forEach((n=>{n in t&&!isNaN(t[n])||(t[n]=0),e=e&&null===t[n]})),n=e}if("pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(r=!0,t.minutes-=t.timeZone),n)return null;const i=[Ze(t.year,2020),Ze(t.month,0),Ze(t.date,1),t.hours,t.minutes,t.seconds,t.milliseconds];return r?new Date(Date.UTC(...i)):new Date(...i)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=Ft.defaultFormat){if(!e||isNaN(e))return null;let n=it[t],i="";if(!n){n=it[t]=[];for(let e=0;e<t.length;e++){const r=t.substr(e).match(lt),i=null==r?void 0:r[0];if(i){const t=(this.localize("L{formats}")||{})[i]||at[i];n.push(t),e+=i.length-1}else if("{"===t[e]){const r=t.indexOf("}",e+1);-1===r?(n.push(t.substr(e+1)),e=t.length):(n.push(t.substring(e+1,r)),e=r)}else n.push(t[e])}}return n.forEach((t=>{i+="string"==typeof t?t:t(e)})),(r.isEdge||r.isIE11)&&(i=i.replace(/\u200E/g,"")),i}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),Ft.as("millisecond",e,t)}static asMonths(e){const t=Ft.as("ms",Ft.daysInMonth(e),"day"),n=(e.valueOf()-Ft.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+n}static monthsToDate(e){const t=Math.floor(e),n=e-t,r=new Date(0,t),i=Ft.as("ms",Ft.daysInMonth(r),"days");return r.setTime(r.getTime()+n*i),r}static formatDelta(e,t){let n,r;"boolean"==typeof t?n=t:t&&(n=t.abbrev);const i=this.getDelta(e,t),s=[],o=(null==t?void 0:t.separator)||(n?"":" ");for(r in i)s.push(`${i[r]}${o}${r}`);return!1===(null==t?void 0:t.asString)?s:s.join(", ")}static getDelta(e,t){let n,r,i,s,o;"boolean"==typeof t?n=t:t&&(n=t.abbrev,s=Ft.normalizeUnit(t.precision));const a={},l=n?Ft.getShortNameOfUnit:Ft.getLocalizedNameOfUnit;for(o of wt)if(r=Ft.as(o,e),i=s===o,r=Math[i?"round":"floor"](r),(r||i&&!a.length)&&(a[l.call(Ft,o,1!==r)]=r,e-=Ft.as("ms",r,o)),i||!e)break;return a}static as(e,t,n="ms"){return"string"==typeof t&&(t=Ft.parseDuration(t)),"object"==typeof t&&(n=t.unit,t=t.magnitude),e===n||(e=Ft.normalizeUnit(e))===(n=Ft.normalizeUnit(n))?t:xt[n]>xt[e]?t*Math.abs(pt[n][e]):t/Math.abs(pt[e][n])}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return Ft.format(Ft.getTime(13,0,0),e).includes("13")}static add(e,t,n="ms"){let r;if(r="string"==typeof e?Ft.parse(e):new Date(e.getTime()),!n||0===t)return r;switch(n=Ft.normalizeUnit(n)){case"millisecond":r=new Date(r.getTime()+t);break;case"second":r=new Date(r.getTime()+1e3*t);break;case"minute":r=new Date(r.getTime()+6e4*t);break;case"hour":r=new Date(r.getTime()+36e5*t);break;case"day":t%1==0?r.setDate(r.getDate()+t):r=new Date(r.getTime()+864e5*t),23===r.getHours()&&0===e.getHours()&&(r=Ft.add(r,1,"hour"));break;case"week":r.setDate(r.getDate()+7*t);break;case"month":{let e=r.getDate();e>28&&(e=Math.min(e,Ft.getLastDateOfMonth(Ft.add(Ft.getFirstDateOfMonth(r),t,"month")).getDate())),r.setDate(e),r.setMonth(r.getMonth()+t);break}case"quarter":r=Ft.add(r,3*t,"month");break;case"year":r.setFullYear(r.getFullYear()+t)}return r}static diff(e,t,n="ms",r=!0){if(n=Ft.normalizeUnit(n),!e||!t)return 0;let i;switch(n){case"year":i=Ft.diff(e,t,"month")/12;break;case"quarter":i=Ft.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth());break;case"week":i=Ft.diff(e,t,"day")/7;break;case"day":{const n=e.getTimezoneOffset()-t.getTimezoneOffset();i=(t-e+60*n*1e3)/864e5;break}case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return r?i:Math.round(i)}static startOf(e,t="day",n=!0){if(!e)return null;t=Ft.normalizeUnit(t),n&&(e=Ft.clone(e));const r={},i=xt[t];for(let e=0;e<i;e++){const t=bt[e];"quarter"!==t&&"week"!==t&&(r[t]="day"===t?1:0)}if("quarter"===t)r.month=3*(Ft.get(e,"quarter")-1);else if("week"===t){const t=e.getDay()-Ft.weekStartDay;r.day=e.getDate()-t}return Ft.set(e,r)}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return Ft.startOf(e,"day",t)}static midnight(e,t){let n=Ft.clearTime(e);return t&&n<e&&(n=Ft.add(n,1,"d")),n}static getTimeOfDay(e,t="ms"){const n=e.getHours()*pt.hour.millisecond+e.getMinutes()*pt.minute.millisecond+e.getSeconds()*pt.second.millisecond+e.getMilliseconds();return"ms"===t?n:Ft.as(t,n,"ms")}static set(e,t,n){if(!t)return e;if("string"==typeof t)switch(Ft.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort(((e,t)=>xt[e[0]]-xt[t[0]])).forEach((([t,n])=>{Ft.set(e,t,n)}));return e}static setDateToMidday(e,t=!0){return Ft.set(Ft.clearTime(e,t),"hour",12)}static constrain(e,t,n){return null!=t&&(e=Ft.max(e,t)),null==n?e:Ft.min(e,n)}static getTime(e,t=0,n=0,r=0){return e instanceof Date&&(r=e.getMilliseconds(),n=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(2020,0,1,e,t,n,r)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static isDST(e){const t=e.getFullYear(),n=new Date(t,0,1),r=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(n.getTimezoneOffset(),r.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,n=null){return null===n?e&&t&&e.getTime()===t.getTime():Ft.startOf(e,n)-Ft.startOf(t,n)==0}static compare(e,t,n=null){return n&&(e=Ft.startOf(e,n),t=Ft.startOf(t,n)),e<t?-1:e>t?1:0}static isStartOf(e,t){return Ft.isEqual(e,Ft.startOf(e,t))}static betweenLesser(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}static betweenLesserEqual(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}static intersectSpans(e,t,n,r){return Ft.betweenLesser(e,n,r)||Ft.betweenLesser(n,e,t)}static compareUnits(e,t){return Math.sign(xt[e]-xt[t])}static timeSpanContains(e,t,n,r){return n-e>=0&&t-r>=0}static get weekStartDay(){return this.localize("L{weekStartDay}")||0}static get nonWorkingDays(){return d({},this.localize("L{nonWorkingDays}"))}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return d({},this.localize("L{weekends}"))}static get(e,t){switch(Ft.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return at.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInMonth(e){const t=Ft.clone(e);return t.setDate(1),t.setMonth(e.getMonth()+1),t.setDate(0),t.getDate()}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,n=1,r=Ft.weekStartDay){if("week"===t){let t=Ft.clone(e);const i=t.getDay();return t=Ft.startOf(t,"day"),t=Ft.add(t,r-i+7*(n-(r<=i?0:1)),"day"),t.getDay()!==r&&Ft.add(t,1,"hour"),t}return Ft.startOf(Ft.add(e,n,t),t)}static isValidDate(e){return Ft.isDate(e)&&!isNaN(e)}static isDate(e){return e&&qe.call(e)===Ke}static getStartOfNextDay(e,t,n){let r=Ft.add(n?e:Ft.clearTime(e,t),1,"day");if(r.getDate()===e.getDate()){const n=Ft.add(Ft.clearTime(e,t),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();r=Ft.add(r,i-n,"minute")}return r}static getEndOfPreviousDay(e,t){const n=t?e:Ft.clearTime(e,!0);return n-e?n:Ft.add(n,-1,"day")}static getWeekDescription(e,t=e){const n=e.getMonth()===t.getMonth()?Mt.format(e,"MMMM"):`${Mt.format(e,"MMM")} - ${Mt.format(t,"MMM")}`,r=Mt.getWeekNumber(e);return`${r[1]}, ${n} ${r[0]}`}static getWeekNumber(e,t=Mt.weekStartDay){const n=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),11,31),i=tt(n.getDay()-t),s=tt(r.getDay()-t),o=(a=e,l=n,Math.floor((a.getTime()-l.getTime()-(a.getTimezoneOffset()-l.getTimezoneOffset())*pt.minute.millisecond)/pt.day.millisecond)+1);var a,l;let c;if(c=i<4?Math.floor((o+i-1)/7)+1:Math.floor((o+i-1)/7),c){let t=e.getFullYear();return 53===c&&s<3&&(t++,c=1),[t,c]}const d=Mt.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,d]}static formatCount(e,t){return t=Ft.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,n=!1){return(e=Ft.normalizeUnit(e))===(t=Ft.normalizeUnit(t))?1:pt[e]&&pt[e][t]&&(n||pt[e][t]>0)?1/Ft.as(t,1,e):pt[t]&&pt[t][e]&&(n||pt[t][e]>0)?Ft.as(e,1,t):-1}static getShortNameOfUnit(e){return e=Ft.parseTimeUnit(e),Ft.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const n=e.charAt(0)===e.charAt(0).toUpperCase();return e=Ft.normalizeUnit(e),e=Ft.parseTimeUnit(e),e=Ft.unitLookup[e][t?"plural":"single"],n&&(e=A.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return"date"===t||bt.includes(t)?t:ft[e]||ft[t]}static getUnitByName(e){return Ft.normalizeUnit(e)||Ft.normalizeUnit(Ft.parseTimeUnit(e))}static getDurationInUnit(e,t,n,r){return Ft.diff(e,t,n,r)}static doesUnitsAlign(e,t){return!(e!==t&&"week"===t)}static getSmallerUnit(e){return bt[xt[Ft.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return bt[xt[Ft.normalizeUnit(e)]+1]||null}static round(e,t,n){return Ft.snap("round",e,t,n)}static floor(e,t,n){return Ft.snap("floor",e,t,n)}static ceil(e,t,n){return Ft.snap("ceil",e,t,n)}static snap(e,t,n,r){const i=Rt[e];if("string"==typeof n&&(n=Ft.parseDuration(n)),j.isObject(n)){const s=n.magnitude||n.increment;switch(n.unit){case"week":{const{weekStartDay:n}=Ft,i=t.getDay();return r=Ft.add(Ft.clearTime(t),i>=n?n-i:-(i-n+7),"day"),Ft[e](t,7*s+" days",r)}case"month":{let e;return t=Ft.asMonths(t),e=r?t+i(t-(r=Ft.asMonths(r)),s):i(t,s),Ft.monthsToDate(e)}case"quarter":return Ft[e](t,3*s+" months",r);case"year":return Ft[e](t,12*s+" months",r);case"decade":return Ft[e](t,10*s+" years",r)}n=Ft.as("ms",s,n.unit)}if(r){const e=Ft.as("ms",r.getTimezoneOffset()-t.getTimezoneOffset(),"ms");return new Date(r.valueOf()+i(Ft.diff(r,t,"ms")+e,n))}{const e=60*t.getTimezoneOffset()*1e3;return new Date(i(t.valueOf()-e,n)+e)}}static parseDuration(e,t=!0,n){var r;const i=(t?vt:yt).exec(e);if(null==e||!i)return null;const s=(e=>{const t=parseFloat(e);return isNaN(t)?null:t})(null===(r=i[1])||void 0===r?void 0:r.replace(",",".")),o=Ft.parseTimeUnit(i[2])||n;return o?{magnitude:s,unit:o}:null}static parseTimeUnit(e){const t=null==e?null:Ft.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<bt.length;e++)if(t[e+1])return bt[e]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=Ft._dayNames||[],n=Ft._dayShortNames||[];t.length=0,n.length=0;for(let r=2;r<9;r++)e.setDate(r),t.push(Ft.format(e,"dddd")),n.push(Ft.format(e,"ddd"));Ft._dayNames=t,Ft._dayShortNames=n}static getDayNames(){return Ft._dayNames}static getDayName(e){return Ft._dayNames[e]}static getDayShortNames(){return Ft._dayShortNames}static getDayShortName(e){return Ft._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=Ft._monthNames||[],n=Ft._monthShortNames||[];t.length=0,n.length=0;for(let r=0;r<12;r++)e.setMonth(r),t.push(Ft.format(e,"MMMM")),n.push(Ft.format(e,"MMM"));Ft._monthNames=t,Ft._monthShortNames=n}static getMonthShortNames(){return Ft._monthShortNames}static getMonthShortName(e){return Ft._monthShortNames[e]}static getMonthNames(){return Ft._monthNames}static getMonthName(e){return Ft._monthNames[e]}static set locale(e){nt=e}static get locale(){return nt}static setupDurationRegEx(e=[],t=[]){const n=this,r={};let i="";for(let s=0;s<t.length;s++){const o=t[s],a=e[s];a.canonicalUnitName=bt[s],r[a.single]=r[a.single.toUpperCase()]=r[a.canonicalUnitName]=r[a.canonicalUnitName.toUpperCase()]=a,i+=(s?"|":"")+"(";for(let e=0;e<o.length;e++)i+=`${o[e]}|`;if(nt=n.localize("L{locale}")||"en-US","en-US"!==nt){const e=Ct[s];for(let t=0;t<e.length;t++)i+=`${e[t]}|`}i+=`${a.single}|${a.plural}|${a.canonicalUnitName}|${a.canonicalUnitName}s)`}n.unitLookup=r,n.durationRegEx=new RegExp(`^(?:${i})$`)}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],n=e.unitNames=e.localize("L{unitNames}");"unitNames"!==n&&(nt=e.localize("L{locale}")||"en-US",rt="en-US"===nt?Je:e.localize("L{ordinalSuffix}")||rt,it={},ot={},st={},Ft.setupDurationRegEx(n,t),Ft.fillDayNames(),Ft.fillMonthNames())}}const Ft=Mt;Ft.useIntlFormat=Qe,Ve.on({locale:"applyLocale",prio:1e3,thisObj:Ft}),Ve.locale&&Ft.applyLocale(),Mt._$name="DateHelper";const{hasOwnProperty:At}=Object.prototype,It=e=>{const t=typeof e;if("object"===t){if(null===e)return"null";if(Array.isArray(e))return"array";if("[object Date]"===Object.prototype.toString.call(e))return"date";if(e.isBase)return"instance"}return"function"===t&&e.isBase?"class":t},kt="1.01"===1.005.toFixed(2)?null:function(e,t){const n=e.toString().split("."),r=+(n[1]?n.join(".")+"1":n[0]);return e.toFixed.call(r,t)};class Ot extends j{static transformArrayToNamedObject(e,t="ref"){const n={};return e.forEach(((e,r)=>{const i=null!=e[t]&&e[t].toString().length?e[t]:r;n[i]=e})),n}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter((t=>e[t])).map((n=>{const r=e[n];return r[t]=n,r}))}static isEqual(e,t,r=!1){if(null===e&&null!==t||e===n&&t!==n||null===t&&null!==e||t===n&&e!==n)return!1;if(null==e&&null==t)return!0;if(e===t)return!0;const i=typeof e;if(i===typeof t){switch(i){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every(((e,n)=>Lt.isEqual(e,t[n],r)));case"object"===i&&e.constructor.prototype===t.constructor.prototype:return r?Lt.isDeeplyEqual(e,t,r):JSON.stringify(e)===JSON.stringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,n={}){if(e===t)return!0;if(!e||!t)return!1;const r=Lt.keys(e,n.ignore),i=Lt.keys(t,n.ignore);if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++){const o=r[s],a=i[s];if(o!==a)return!1;const l=e[o],c=t[a];if(!n.shouldEvaluate||!1!==n.shouldEvaluate(o,{value:l,object:e},{value:c,object:t})){if(n.evaluate){const r=n.evaluate(o,{value:l,object:e},{value:c,object:t});if(!1===r)return!1;if(!0===r)continue}if(!Lt.isEqual(l,c,n))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!==e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?Mt.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?Mt.isAfter(e,t):e>t}static fork(e){let t,n,r;if(e&&e.constructor===Object)for(n in t=Object.setPrototypeOf({},e),e)r=e[n],r&&(r.constructor===Object?t[n]=Lt.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static copyProperties(e,t,n){let r,i;for(i=0;i<n.length;i++)r=n[i],r in t&&(e[r]=t[r]);return e}static copyPropertiesIf(e,t,n){if(t)for(const r of n)r in e||(e[r]=t[r]);return e}static entries(e,t){const n=[],r="function"==typeof t;if(e)for(const i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push([i,e[i]]);return n}static fromEntries(e,t){if(t=t||{},e)for(let n=0;n<e.length;++n)t[e[n][0]]=e[n][1];return t}static keys(e,t){const n=[],r="function"==typeof t;if(e)for(const i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push(i);return n}static values(e,t){const n=[],r="function"==typeof t;if(e)for(const i in e)(r?t(i,e[i]):null!=t&&t[i])||n.push(e[i]);return n}static allKeys(e){return s.deprecate("Core","5.0.0","Deprecated in favor of `keys()`; will be removed in 5.0"),Ot.keys(e)}static pathExists(e,t){return t.split(".").every((t=>t in e&&(e=e[t],!0)))}static pathifyKeys(e){const t={};for(const n in e)if(Object.hasOwnProperty.call(e,n))if(e[n]instanceof Object){const r=this.pathifyKeys(e[n]);for(const e in r)t[`${n}.${e}`]=r[e]}else t[n]=e[n];return t}static deletePath(e,t){t.split(".").reduce(((e,t,n,r)=>{if(null==e)return null;if(Object.hasOwnProperty.call(e,t)){if(n!==r.length-1)return e[t];delete e[t]}}),e)}static coerce(e,t){const r=It(e),i=It(t),s="string"==typeof e;if(r!==i)switch(i){case"string":return String(e);case"number":return Number(e);case"boolean":return!(s&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!s||e&&"null"!==e)&&null;case"undefined":return!(!s||e&&"undefined"!==e)&&n;case"date":return s&&isNaN(e)?Mt.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,n,r,i=!0){const s={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&i;)o=Object.getPrototypeOf(o),o&&(a=Object.getOwnPropertyDescriptor(o,t));a?(a.set?s.set=t=>{a.set.call(e,t),r&&r.call(e,a.get.call(e))}:s.set=r,a.get?s.get=()=>{let t=a.get.call(e);return n&&(t=n.call(e,t)),t}:s.get=n):(s.set=n=>{e[`_${t}`]=n,r&&r.call(e,n)},s.get=()=>{let r=e[`_${t}`];return n&&(r=n.call(e,r)),r}),Object.defineProperty(e,t,s)}static getPropertyDescriptor(e,t){let n=null;for(let r=e;r&&!n&&!At.call(r,"isBase");r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,t);return n}static cleanupProperties(e,t=!1){return Object.entries(e).forEach((([r,i])=>{t?i===n&&delete e[r]:null==i&&delete e[r]})),e}static removeAllProperties(e){return Object.keys(e).forEach((t=>delete e[t])),e}static assertType(e,t,n){const r=It(e);if(null!=e&&r!==t)throw new Error(`Incorrect type "${r}" for ${n}, expected "${t}"`)}static assertObject(e,t){Lt.assertType(e,"object",t)}static assertInstance(e,t){Lt.assertType(e,"instance",t)}static assertClass(e,t){Lt.assertType(e,"class",t)}static assertFunction(e,t){if("function"!=typeof e||e.isBase||e.$$name)throw new Error(`Incorrect type for ${t}, got "${e}" (expected a function)`)}static assertNumber(e,t){const n=Number(e);if("number"!=typeof e||isNaN(n))throw new Error(`Incorrect type for ${t}, got "${e}" (expected a Number)`)}static assertBoolean(e,t){Lt.assertType(e,"boolean",t)}static assertString(e,t){Lt.assertType(e,"string",t)}static assertArray(e,t){Lt.assertType(e,"array",t)}static toFixed(e,t){return kt?kt(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const n=10**t;return Math.round(e*n)/n}static getMapPath(e,t,n){const r=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=1===r.length,s=r[0],o=e.has(s)?e.get(s):e.set(s,i?n:{}).get(s);return i?o:Lt.getPathDefault(o,r.slice(1),n)}}const Lt=Ot;Ot._$name="ObjectHelper";const Pt=["border-top-width","border-right-width","border-bottom-width","border-left-width"],_t=["margin-top","margin-right","margin-bottom","margin-left"],$t=["padding-top","padding-right","padding-bottom","padding-left"],Ht="border-top-width",jt="border-right-width",Bt="border-bottom-width",Nt="border-left-width",zt="padding-top",Vt="padding-right",Wt="padding-bottom",Gt="padding-left",Ut=Object.freeze({x:0,y:0}),Yt=/^([trblc])(\d*)-([trblc])(\d*)$/i,qt=/^([trblc])(\d*)$/i,Kt=["top","right","bottom","left"],Xt={t:0,r:1,b:2,l:3},Zt=["b-t","l-r","t-b","r-l"],Jt=Object.freeze([0,0]),Qt=["width","height"],en=(e,t=e,n=e,r=t)=>Array.isArray(e)?en.apply(null,e):[e,t,n,r];function tn(e){return`${Kt[(Xt[e.myEdge]+2)%4][0]}${e.myOffset}-${Kt[(Xt[e.targetEdge]+2)%4][0]}${e.targetOffset}`}class nn{static from(e,t,i){var s;if(e instanceof nn)return e;if(i===n&&"boolean"==typeof t&&(i=t,t=null),t){let{scrollLeft:e,scrollTop:n}=t;(r.isEdge||r.isSafari)&&t===document.body&&(e=n=0),t=nn.from(t).translate(-e,-n)}else t=Ut;const o=e===document||e===window,a=e===document.body&&0===document.body.offsetHeight,l=a&&e.getBoundingClientRect(),c=a?new nn(l.left,l.top,l.width,document.body.parentElement.scrollHeight):o?new nn(0,0,window.innerWidth,window.innerHeight):e.getBoundingClientRect(),d=i||o?[0,0]:[window.pageXOffset,window.pageYOffset];let u=0,h=0;var g,m;(r.isIE11||r.isEdge&&null!==(s=e.namespaceURI)&&void 0!==s&&s.match(/svg/))&&(u=(null===(g=e.dataset)||void 0===g?void 0:g.scaleX)||0,h=(null===(m=e.dataset)||void 0===m?void 0:m.scaleY)||0);return new nn(c.left+d[0]-t.x+u/2,c.top+d[1]-t.y+h/2,c.width-u,c.height-h)}static fromScreen(e,t){return nn.from(e,t,!0)}static inner(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=er.getStyleValue(e,Pt);r.x+=parseFloat(t[Nt]),r.y+=parseFloat(t[Ht]),r.right-=parseFloat(t[jt]),r.bottom-=parseFloat(t[Bt])}return r}static content(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=er.getStyleValue(e,Pt),n=er.getStyleValue(e,$t);r.x+=parseFloat(t[Nt])+parseFloat(n[Gt]),r.y+=parseFloat(t[Ht])+parseFloat(n[zt]),r.right-=parseFloat(t[jt])+parseFloat(n[Vt]),r.bottom-=parseFloat(t[Bt])+parseFloat(n[Wt])}return r}static client(e,t,n=!1){const r=this.content(e,t,n),i=er.scrollBarWidth;let s;return i&&(e.scrollHeight>e.clientHeight&&"hidden"!==er.getStyleValue(e,"overflow-y")&&(s=parseFloat(er.getStyleValue(e,"padding-right")),r.right+=s-Math.max(s,i)),e.scrollWidth>e.clientWidth&&"hidden"!==er.getStyleValue(e,"overflow-x")&&(s=parseFloat(er.getStyleValue(e,"padding-bottom")),r.bottom+=s-Math.max(s,i))),r}static outer(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=er.getStyleValue(e,_t);r.x-=parseFloat(t["margin-left"]),r.y-=parseFloat(t["margin-top"]),r.right+=parseFloat(t["margin-right"]),r.bottom+=parseFloat(t["margin-bottom"])}return r}static union(...e){let t,{x:n,y:r,right:i,bottom:s}=e[0];if(e.length>1)for(let o=1;o<e.length;o++)t=e[o],t.x<n&&(n=t.x),t.y<r&&(r=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new nn(n,r,i-n,s-r)}roundPx(e=window.devicePixelRatio||1){const t=this;return t._x=er.roundPx(t._x,e),t._y=er.roundPx(t._y,e),t._width=er.roundPx(t._width,e),t._height=er.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,n,r){Ot.assertNumber(e,"Rectangle.x"),Ot.assertNumber(t,"Rectangle.y"),Ot.assertNumber(n,"Rectangle.width"),Ot.assertNumber(r,"Rectangle.height");const i=this;i._x=e,i._y=t,i._width=n,i._height=r}clone(){const e=this,t=new nn(e.x,e.y,e.width,e.height);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return e instanceof nn&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}intersect(e,t=!1,n=!1){const r=this,i=Math.max(r.y,e.y),s=Math.min(r.right,e.right),o=Math.min(r.bottom,e.bottom),a=Math.max(r.x,e.x);return!!(n?o>=i&&s>=a:o>i&&s>a)&&(!!t||new nn(a,i,s-a,o-i))}equals(e,t=!1){const n=t?e=>Math.round(e):e=>e;return e instanceof nn&&n(e.x)===n(this.x)&&n(e.y)===n(this.y)&&n(e.width)===n(this.width)&&n(e.height)===n(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new nn.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,n,r){const i=this;return i.x+=e,i.y+=t,i.width+=n,i.height+=r,i}inflate(e,t=e,n=e,r=t){return this.adjust(-r,-e,t,n)}deflate(e,t=e,n=e,r=t){return this.adjust(r,e,-t,-n)}constrainTo(e,t){const n=this,r=n.height,i=n.y,s=n.minWidth||n.width,o=n.minHeight||n.height;if(n.height>=e.height){if(t&&o>e.height)return!1;n._y=e.y,n.height=e.height}if(n.width>=e.width){if(t&&s>e.width)return n.y=i,n.height=r,!1;n._x=e.x,n.width=e.width}let a=n.bottom-e.bottom;return a>0&&n.translate(0,-a),a=n.right-e.right,a>0&&n.translate(-a),a=e.y-n.y,a>0&&n.translate(0,a),a=e.x-n.x,a>0&&n.translate(a),n}alignTo(e){let t,n,r,i,s=this.clone(),{target:o,constrainTo:a,constrainPadding:l}=e;if(!o||o instanceof nn||(o=nn.from(o.element?o.element:o)),a&&!(a instanceof nn)){i=a===window||a===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!i;a=nn.from(a.element?a.element:a,null,t),l&&(l=en(l),l[0]=Math.min(l[0],o.top),l[1]=Math.min(l[1],a.right-o.right),l[2]=Math.min(l[0],a.bottom-o.bottom),l[3]=Math.min(l[0],o.left),a.deflate.apply(a,l))}const c=this,d=null==(S=e.offset)?Jt:"number"==typeof S?[S,S]:S,{align:u,axisLock:h,anchorSize:g,anchorPosition:m}=e,p=function(e){const t=Yt.exec(e),n=parseInt(t[2]||50),r=parseInt(t[4]||50);return{myAlignmentPoint:t[1]+n,myEdge:t[1],myOffset:n,targetAlignmentPoint:t[3]+r,targetEdge:t[3],targetOffset:r,startZone:Xt[t[3]]}}(u),f=e.position||(o&&"Point"===o.$$name?o:null),v=a&&a.clone(),y=[],b=[{zone:n=p.startZone,align:u}],C=e.matchSize&&Qt[1&p.startZone],w=c[C];var S;if(C&&h&&(s[C]=o[C]),a&&s.constrainTo(a),a&&null!=p.startZone)if(h)b.push({zone:n=(n+2)%4,align:tn(p)}),"flexible"===h&&(b.push({zone:n=(p.startZone+1)%4,align:Zt[n]}),b.push({zone:n=(n+2)%4,align:Zt[n]}));else for(let e=1;e<4;e++)b.push({zone:n=(n+1)%4,align:Zt[n]});if(m){const e=1&p.startZone?"y":"x";t={[e]:m[e],edge:Kt[(p.startZone+2)%4]}}if(v&&o&&(v.adjust(-o.width,-o.height,o.width,o.height),o.constrainTo(v)),s.minWidth=c.minWidth,s.minHeight=c.minHeight,f)s.moveTo(f.x,f.y),a&&s.constrainTo(a);else{const e="c"===p.myEdge||"c"===p.targetEdge,n=g&&!e?[g[1]+d[0],g[1]+d[1]]:d,l=o.getAlignmentPoint(p.targetAlignmentPoint,n),u=s.getAlignmentPoint(p.myAlignmentPoint);s.translate(l[0]-u[0],l[1]-u[1]);const m=s.intersect(o,!0);if(m)a&&s.constrainTo(a),r=p.startZone,s.translate(...n);else if(a&&!a.contains(s)){let e,l,d=s.clone(),u=[];t=null,y[0]=e=a.clone(),e.bottom=o.y-n[1],y[1]=e=a.clone(),e.x=o.right+n[0],y[2]=e=a.clone(),e.y=o.bottom+n[1],y[3]=e=a.clone(),e.right=o.x-n[0];for(let t=0;t<b.length;t++){if(C&&2==t&&(s[C]=w),e=y[r=b[t].zone],s=s.alignTo({target:o,offsets:n,align:b[t].align}),s.constrainTo(e,!0)&&(u.push({result:s,zone:r}),!l||s.width<c.width||s.height<c.height)){s.align=b[t].align;break}if(!l||e.area>l.area){const t=s.clone();switch(r){case 0:t.moveTo(null,e.bottom-t.height);break;case 1:t.moveTo(e.left);break;case 2:t.moveTo(null,e.top);break;case 3:t.moveTo(e.right-t.width)}l={area:e.area,result:t,zone:r}}}u.length?(u.length>1&&!h&&u.sort(((e,t)=>Math.sqrt((d.x-e.result.x)**2+(d.y-e.result.y)**2)-Math.sqrt((d.x-t.result.x)**2+(d.y-t.result.y)**2))),s=u[0].result,r=u[0].zone):(s=l.result,r=l.zone,i&&s.constrainTo(a))}else r=p.startZone;if(s.zone=r,g&&!m){if(!t){let e=1&r,n=e?"y":"x",i=e?"bottom":"right",a=Math.max(o[n],s[n]),l=a+(Math.min(o[i],s[i])-a)/2-g[0]/2,c=l+g[0];c>s[i]&&(l-=c-s[i]),l<s[n]&&(l+=s[n]-l),t={[n]:l-s[n],edge:Kt[(r+2)%4]}}s.anchor=t}}return s}getAlignmentPoint(e,t=Jt){const n=this,r=qt.exec(e),i=r[1].toLowerCase(),s=Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(i){case"t":return[n.x+n.width*s,n.y-t[1]];case"r":return[n.right+t[0],n.y+n.height*s];case"b":return[n.x+n.width*s,n.bottom+t[1]];case"l":return[n.x-t[0],n.y+n.height*s];case"c":{const e=n.center;return[e.x+t[0],e.y+t[1]]}}}highlight(){const e=this,t=er.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${e.x}px;top:${e.y}px;width:${e.width}px;height:${e.height}px`});return er.highlight(t).then((()=>t.remove()))}}nn._$name="Rectangle";const rn=Symbol("value"),sn=Symbol("length");class on{static change(e,t,n,r="string"){n=on.normalize(n,"object");const i=on.normalize(e,"array").filter((e=>!n[e]));if(t){t=on.normalize(t,"array");for(let e=0;e<t.length;++e)i.includes(t[e])||i.push(t[e])}return on.normalize(i,r)}static from(e,t){return e&&(e.isDomClassList||(e=new on(e)),e.value||t||(e=null)),e||(t?new on:null)}static normalize(e,t="string"){const n=typeof(e=e||""),r="array"===t,i=!r&&!("object"===t);let s,o,a,l="string"===n;var c;"object"===n&&(e.nodeType===Element.ELEMENT_NODE&&"function"==typeof e.getAttribute?(e=e.getAttribute("class")||"",l=!0):null!==(c=e)&&void 0!==c&&c.isDomClassList?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter((t=>e.get(t))):e instanceof Set?e=Array.from(e.values()):Array.isArray(e)||(e=j.getTruthyKeys(e)));for(l&&(e=[...new Set(A.split(e))]),o=e.length;o-- >0;)s=e[o],s.length?s.includes(" ")&&e.splice(o,1,...A.split(s)):e.splice(o,1);if(r)a=e;else if(i)a=e.join(" ");else for(a=Object.create(null),o=0;o<e.length;++o)a[e[o]]=!0;return a}constructor(...e){this.process(1,e)}get isDomClassList(){return!0}clone(){return new on(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?`${this.value} `:""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=on.normalize(e,"array"),n=t.length;if(this.length===n){for(let e=0;e<n;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){let e,t=this[rn];return null==t&&(e=j.getTruthyKeys(this),this[sn]=e.length,this[rn]=t=e.join(" ")),t}set value(e){const t=this,n=Object.keys(t),r=n.length;for(let e=0;e<r;e++)delete t[n[e]];e?t.process(1,[e]):t[rn]=null}get values(){return j.getTruthyKeys(this)}get length(){return this.value?this[sn]:0}process(e,t){for(let n,r,i=0;i<t.length;i++)if(t[i])for(n=on.normalize(t[i],"array"),r=0;r<n.length;++r)this[n[r]]=e;return this[rn]=null,this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],this[rn]=null);return this}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}split(){return j.getTruthyKeys(this)}forEach(e){return j.getTruthyKeys(this).forEach(e)}}on._$name="DomClassList";const an=new class extends(me.mixin(Be)){suspendFocusEvents(){hn=!0}resumeFocusEvents(){hn=!1}setupFocusListenersOnce(e,t){e&&!an.observedElements.has(e)&&(an.setupFocusListeners(e,t),an.observedElements.add(e))}setupFocusListeners(e=document,t,n=!1){var r;const i={element:e,touchstart(e){cn=cn||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{cn&&(cn.identifier===t.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===cn.identifier&&an.trigger("globaltap",{event:e}),cn=null)},passive:!1},mousedown:{handler:e=>{dn="mouse",cn||an.trigger("globaltap",{event:e})},passive:!1},keydown(){dn="key"},keypress(){dn="key"},focusin(e){const{Widget:t}=an;if(t.resetFloatRootScroll(),hn)return;const n=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,r=e.target||document.body,i=t.fromElement(n),s=t.fromElement(r),o=er.getCommonAncestor(i,s),a=!!(n&&4&r.compareDocumentPosition(n)),l=t.query(ln);let c=null;if(c=r&&r!==document.body?er.getActiveElement(r):er.getActiveElement(document),l&&(!s||!l.owns(s)))return void l.focus();let d=gn("focusout",n,e.target,i,s,a);for(let t=i;t&&t!==o;t=t.owner)if(!t.isDestroying&&t.onFocusOut&&(t.onFocusOut(d),e.target&&c!==er.getActiveElement(e.target)))return;if(o&&e.target===o.element)!o.isDestroying&&er.getActiveElement(o)===r&&o.focusElement&&o.focusElement!==o.element&&o.setTimeout((()=>{var e;return null===(e=o.focus)||void 0===e?void 0:e.call(o)}),0);else{d=gn("focusin",r,n,i,s,a);for(let e=s;e&&e!==o;e=e.owner){var u,h;if(!e.isDestroying)null===(u=(h=e).onFocusIn)||void 0===u||u.call(h,d)}}const g=er.getCommonAncestor((null==n?void 0:n.nodeType)===Element.ELEMENT_NODE?n:null,r)||r.parentNode;d=gn("focusmove",r,n,i,s,a,{bubbles:!0}),g.dispatchEvent(d)},focusout(e){if(!(hn||e.relatedTarget&&an.Widget.fromElement(e.relatedTarget))){const t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;i.focusin({target:t,relatedTarget:e.target})}},capture:!0,passive:!0};n&&(null===(r=un)||void 0===r||r()),un=t.on(i)}get lastInteractionType(){return dn}},ln=e=>e.isVisible&&e.isTopModal;an.observedElements=new Set;let cn,dn,un,hn=!1;function gn(e,t,n,r,i,s,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"_target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>n}),a.fromWidget=r,a.toWidget=i,a.backwards=s,a}const mn={align:"t0-t0"},pn=Node.ELEMENT_NODE,fn=Node.TEXT_NODE,{isObject:vn}=Ot,yn=/[+-]?\d*\.?\d+[eE]?-?\d*/g,bn=yn.source,Cn=new RegExp(`matrix\\((?:${bn}),\\s?(?:${bn}),\\s?(?:${bn}),\\s?(?:${bn}),\\s?(${bn}),\\s?(${bn})`),wn=new RegExp("matrix3d\\((?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(?:-?\\d*),\\s?(-?\\d*),\\s?(-?\\d*)"),Sn=new RegExp(`(?:${Cn.source})|(?:${wn.source})`),En=new RegExp(`translate(3d|X)?\\((${bn})px(?:,\\s?(${bn})px)?`),Dn=new RegExp(`translate(3d|Y)?\\((${bn})px(?:,\\s?(${bn})px)?`),xn=/^[^a-z]+|[^\w:.-]+/gi,Rn=/\s+/,Tn=/\s*;\s*/,Mn=/\s*:\s*/,Fn={elementData:"",for:"htmlFor",retainElement:""},An={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,_element:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1},In={length:1,parentRule:1,style:1},kn={width:1,height:1,top:1,left:1,minWidth:1,minHeight:1,maxWidth:1,maxHeight:1,fontSize:1,"min-width":1,"min-height":1,"max-width":1,"max-height":1,"font-size":1},On={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,HTML:r.isIE11?1:0,BODY:r.isIE11?0:1},Ln=window,Pn=document,_n={},$n=[],Hn=Array.prototype.slice,jn=Promise.resolve(),Bn=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],Nn=e=>e._hidden,zn=(e,t,n)=>"children"===n.key?Ot.mergeItems(e,t,n):Ot.blend(e,t,n),Vn=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")},Wn=document.documentElement.getRootNode?e=>e.getRootNode():e=>{for(;e.parentNode;)e=e.parentNode;return e},Gn=e=>e&&(e===document.body||("offsetParent"in e?e.offsetParent:Gn(e.parentNode))),Un=e=>e&&(document.body.contains(e)||(qn=Wn(e))&&(e=>e.host&&e.host instanceof Element)(qn)&&Un(qn.host)),Yn=e=>e instanceof Node?e:"string"==typeof e?tr.createElementFromTemplate(e):tr.createElement(e);let qn,Kn,Xn,Zn=null,Jn=0,Qn=null;class er{static isFocusable(e,t=!1){if(!t&&(!tr.isVisible(e)||tr.Widget.fromElement(e,Nn)))return!1;const n=e.nodeName;return On[n]||("A"===n||"LINK"===n)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isInView(e,t=!0){let n=nn.from(e),r=!0;const i=n.height,s=n.width;for(;r&&e.parentElement;)e=e.parentElement,n=n.intersect(nn.from(e)),r=n&&(!t||n.height>=i&&n.width>=s);return r}static isVisible(e){const t=e.ownerDocument;for(;e;e=(n=e).parentNode||n.host){if(e===t)return!0;if(e.nodeType===e.ELEMENT_NODE&&!Vn(e))return!1}var n;return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return Ot.blend(e,t,{merge:zn})}static normalizeChildren(e,t,n=!0){var r;let i,s,o,a,l,c=null==e?void 0:e.children;if(!1===(null==e||null===(r=e.syncOptions)||void 0===r?void 0:r.hoistReferences)&&(n=!1),c&&!(e instanceof Node))if(Array.isArray(c))for(s=0;s<c.length;++s)er.normalizeChildren(c[s],t,n);else for(o in a=c,e.children=c=[],a){var d;i=a[o],null!==(d=i)&&void 0!==d&&d.isWidget&&(i=i.element),l=!o.startsWith("$")&&!er.isElement(i),l&&(null==t||t(o,n)),i&&(i instanceof Node||(!1===i.reference?delete i.reference:l&&"string"!=typeof i&&(i.reference=o),er.normalizeChildren(i,t,n)),c.push(i))}return e}static roundPx(e,t=window.devicePixelRatio||1){const n=1/t;return Math.round(e/n)*n}static isCustomElement(e){return Boolean(null==e?void 0:e.shadowRoot)}static elementFromPoint(e,t){let n=document.elementFromPoint(e,t);return tr.isCustomElement(n)&&(n=n.shadowRoot.elementFromPoint(e,t)||n),n}static childFromPoint(e,t,n){const r=null==n?t:new nn(t,n,0,0);let i=null;return Array.from(e.children).some((t=>{if(nn.from(t,e,!0).contains(r))return i=t.children.length&&tr.childFromPoint(t,r)||t,!0})),i}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){var t,n,r;null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element);let i=((null===(n=e)||void 0===n||null===(r=n.getRootNode)||void 0===r?void 0:r.call(n))||document).activeElement;for(;null!==(s=i)&&void 0!==s&&s.shadowRoot;){var s;i=i.shadowRoot.activeElement}return i}static getRootElement(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return(null==n?void 0:n.body)||n||e.ownerDocument.body}static isValidFloatRootParent(e){return e===document.body||"ShadowRoot"===e.constructor.name}static getId(e){return e.id||(e.id="b-element-"+ ++Jn)}static getCommonAncestor(e,t){if(e===t)return e;for(;e&&!(null!==(n=(r=e)[e.isWidget?"owns":"contains"])&&void 0!==n&&n.call(r,t)||e===t);){var n,r;e=e.owner||e.parentNode}return e}static getElement(e){return e instanceof Element?e:Pn.querySelector(e)}static setAttributes(e,t){const n=tr.getElement(e);if(n&&t)for(const e in t)null!=t[e]&&n.setAttribute(e,t[e])}static setLength(e,t,n){return n=1===arguments.length?"number"==typeof e?`${e}px`:e:(e=tr.getElement(e)).style[t]="number"==typeof n?`${n}px`:n}static getChild(e,t){if(r.supportsQueryScope)t=":scope>"+t;else{t=`#${e.id||(e.id="b-element-"+ ++Jn)} > ${t}`}return e.querySelector(t)}static hasChild(e,t){return null!=tr.getChild(e,t)}static children(e,t){if(">"===t[0]||t.startsWith("# "))if("#"===t[0]&&(t=t.substr(2)),r.supportsQueryScope)t=":scope "+t;else{t=`#${e.id||(e.id="b-element-"+ ++Jn)} ${t}`}return Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){if(!e)return null;if(e.matches&&e.matches(t))return e;if(r.supportsQueryScope)t=":scope "+t;else{t=`#${e.id||(e.id="b-element-"+ ++Jn)} ${t}`}return e.querySelector(t)}static isDescendant(e,t){e.contains||(e=e.body);const n=tr.getRootElement(e),r=tr.getRootElement(t);return n!==r&&r.host?tr.isDescendant(n,r.host):e.contains(t)}static getEventElement(e,t="target"){return tr.isElement(e)?e:e[t]}static isElement(e){return(null==e?void 0:e.nodeType)===document.ELEMENT_NODE&&tr.isNode(e)}static isNode(e){return Boolean(e)&&"number"==typeof e.nodeType&&!vn(e)}static forEachSelector(e,t,n){if("string"==typeof e)throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");tr.children(e,t).forEach(n)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){tr.forEachSelector(e,t,(e=>e.remove()))}static removeClsGlobally(e,...t){t.forEach((t=>tr.forEachSelector(e,"."+t,(e=>e.classList.remove(t)))))}static isOrphaned(e){return!Un(e)}static up(e,t){return e&&e.closest(t)}static getAncestor(e,t,n=null){let r,i=!1,s=e;for(Array.isArray(t)||(t=[t]);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(n&&s===n)break;r=s}return i?r||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return null==e?null:String(e).replace(xn,t)}static createElement(e={},t,...n){let r,i,s,o,a,l,c,u,h,g,m=t;if("boolean"==typeof m)u=n[0],h=n[1],t={returnAll:m,refs:u,syncIdField:h};else if(t){var p;s=t.ignoreRefs,g=null===(p=t.hoistReferences)||void 0===p||p,g&&(c=t.refOwner),u=t.refs,m=t.returnAll,h=t.syncIdField}"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent));const f=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:v,html:y,reference:b,syncOptions:C,text:w}=e;if(C&&(h=C.syncIdField||h,C.ignoreRefs&&(s=!0,t=d(d({},t),{},{ignoreRefs:s}))),s&&(c=null),r=e.ns?Pn.createElementNS(e.ns,e.tag||"svg"):Pn.createElement(e.tag||"div"),null!=w?tr.setInnerText(r,w):null!=y&&(y instanceof DocumentFragment?r.appendChild(y):r.innerHTML=y),e.tooltip&&tr.Widget.attachTooltip(r,e.tooltip),e.style&&tr.applyStyle(r,e.style),v)for(a in v)l=v[a],null!=l&&(r.dataset[a]=l);f&&f.insertBefore(r,e.nextSibling),c&&(r.$refOwnerId=c.id),b&&!s&&(c?(r.$reference=b,c.attachRef(b,r,e)):(u||((t=Object.assign({},t)).refs=u={}),u[b]=r,r.setAttribute("data-reference",b)));const S=e.className||e.class,E=Object.keys(e);for(S&&r.setAttribute("class",on.normalize(S)),i=0;i<E.length;++i)a=E[i],l=e[a],null!=(o=Fn[a])?r[o||a]=l:!An[a]&&a&&null!=l&&r.setAttribute(a,l);return!0===m?t.returnAll=m=[r]:Array.isArray(m)&&m.push(r),e.children&&(h&&(r.syncIdMap={}),e.children.forEach((n=>{if(n)if("string"==typeof n){const e=document.createTextNode(n);c&&(e.$refOwnerId=c.id),r.appendChild(e)}else if(isNaN(n.nodeType)){var i,s,o;n.parent=r,!n.ns&&e.ns&&(n.ns=e.ns);const a=tr.createElement(n,d(d({},t),{},{hoistReferences:null!==(i=null===(s=e.syncOptions)||void 0===s?void 0:s.hoistReferences)&&void 0!==i?i:g})),l=null===(o=n.dataset)||void 0===o?void 0:o[h];null!=l&&(r.syncIdMap[l]=a),delete n.parent}else r.appendChild(n)}))),r.lastDomConfig=e,e._element=r,u||m||r}static createElementFromTemplate(e,t=_n){const{array:n,raw:r,fragment:i}=t;let s;if(tr.supportsTemplate){if((Kn||(Kn=Pn.createElement("template"))).innerHTML=e,s=Kn.content,i)return s.cloneNode(!0)}else{if((Xn||(Xn=new DOMParser)).parseFromString(e,"text/html"),s=Xn.parseFromString(e,"text/html").body,i){const e=s?s.childNodes:$n;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}s||(s={children:[],childNodes:[]})}return s=r?s.childNodes:s.children,1!==s.length||n?Hn.call(s):s[0]}static insertFirst(e,t){return t&&t.nodeType!==pn&&t.tag&&(t=tr.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,n){return t&&t.nodeType!==pn&&t.tag&&(t=tr.createElement(t)),n?e.insertBefore(t,n):tr.insertFirst(e,t)}static insertAt(e,t,n){const r=Array.from(e.children);if(n>=r.length)return tr.append(e,t);const i=r[n];return tr.insertBefore(e,t,i)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((e=>Yn(e)))),e.append)e.append(...t);else{const n=document.createDocumentFragment();t.forEach((function(e){n.appendChild(e)})),e.appendChild(n)}return t}return e.appendChild(Yn(t))}static getTranslateX(e){const t=e.style.transform;let n=En.exec(t);return n?parseFloat(n[2]):(n=Sn.exec(t)||Sn.exec(tr.getStyleValue(e,"transform")),n?parseFloat(n[1]||n[3]):0)}static getTranslateY(e){const t=e.style.transform;let n=Dn.exec(t);if(n){const e=parseFloat(n["Y"===n[1]?2:3]);return isNaN(e)?0:e}return n=Sn.exec(t)||Sn.exec(tr.getStyleValue(e,"transform")),n?parseFloat(n[2]||n[4]):0}static getTranslateXY(e){return[tr.getTranslateX(e),tr.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[tr.getOffsetX(e,t),tr.getOffsetY(e,t)]}static focusWithoutScrolling(e){function t(e){e.forEach((({element:e,scrollLeft:t,scrollTop:n})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==n&&(e.scrollTop=n)}))}if(r.chromeVersion>=64||r.firefoxVersion>=68)e.focus({preventScroll:!0});else{const n=tr.getParents(e).map((e=>({element:e,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})));e.focus(),r.isIE11?t(n):setTimeout((()=>t(n)),0)}}static getPageX(e){return e.getBoundingClientRect().left+Ln.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+Ln.pageYOffset}static getExtremalSizePX(e,t){const n=A.hyphenate(t),r=n.split("-")[1];let i=tr.getStyleValue(e,n);return i=/%/.test(i)?e.parentElement?parseInt(tr.getStyleValue(e.parentElement,r),10):NaN:parseInt(i,10),i}static setTranslateX(e,t){const n=tr.getStyleValue(e,"transform").split(/,\s*/);t=tr.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?12:4]=t,e.style.transform=n.join(",")):e.style.transform=`translateX(${t}px)`}static setTranslateY(e,t){const n=tr.getStyleValue(e,"transform").split(/,\s*/);t=tr.roundPx(t),n.length>1?(n[n[0].startsWith("matrix3d")?13:5]=t,e.style.transform=n.join(",")+")"):e.style.transform=`translateY(${t}px)`}static setTop(e,t){tr.setLength(e,"top",t)}static setLeft(e,t){tr.setLength(e,"left",t)}static setTranslateXY(e,t,n){if(null==t)return tr.setTranslateY(e,n);if(null==n)return tr.setTranslateX(e,t);t=tr.roundPx(t),n=tr.roundPx(n);const r=tr.getStyleValue(e,"transform").split(/,\s*/),i=r[0].startsWith("matrix3d");r.length>1?(r[i?12:4]=t,r[i?13:5]=n,e.style.transform=r.join(",")+")"):e.style.transform=`translate(${t}px, ${n}px)`}static addTranslateX(e,t){tr.setTranslateX(e,tr.getTranslateX(e)+t)}static addTranslateY(e,t){tr.setTranslateY(e,tr.getTranslateY(e)+t)}static addLeft(e,t){tr.setLeft(e,tr.getOffsetX(e)+t)}static addTop(e,t){tr.setTop(e,tr.getOffsetY(e)+t)}static alignTo(e,t,n=mn,r){t=t instanceof nn?t:nn.from(t,!0);const i=tr.getTranslateXY(e),s=nn.from(e,!0);r&&(s.roundPx(),t.roundPx());const o=s.alignTo(Object.assign(n,{target:t}));tr.setTranslateXY(e,i[0]+o.x-s.x,i[1]+o.y-s.y)}static getStyleValue(e,t,n,r){const i=n?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){const e={};for(const n of t)e[n]=i.getPropertyValue(A.hyphenate(n));return e}return i.getPropertyValue(A.hyphenate(t))}static getEdgeSize(e,t,n){const r="border"===t?"-width":"",i={raw:{}};for(const s of["top","right","bottom","left"])n&&!n.includes(s[0])||(i[s]=parseFloat(i.raw[s]=tr.getStyleValue(e,`${t}-${s}${r}`)));return i.width=(i.left||0)+(i.right||0),i.height=(i.top||0)+(i.bottom||0),i}static parseStyle(e){if("string"==typeof e){const t=e.split(Tn);e={};for(let n=0,{length:r}=t;n<r;n++){const r=t[n].split(Mn);e[r[0]]=r[1]}}return e||{}}static applyStyle(e,t,n=!1){if("string"==typeof t)n?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){n&&(e.style.cssText=""),t.style&&("string"==typeof t.style?e.style.cssText=t.style:t=Object.assign({},t.style,t));for(const n in t)if(!In[n]){const r=kn[n]&&"number"==typeof t[n]?"px":"";e.style.setProperty(A.hyphenate(n),t[n]+r)}}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const n in e)In[n]||(t+=`${A.hyphenate(n)}:${e[n]};`);return t}static addClasses(e,t){for(let n=0;n<t.length;n++)e.classList.add(t[n])}static removeClasses(e,t){for(let n=0;n<t.length;n++)e.classList.remove(t[n])}static toggleClasses(e,t,n=null){Array.isArray(t)||(t=[t]),!0===n?tr.addClasses(e,t):!1===n?tr.removeClasses(e,t):t.forEach((t=>e.classList.toggle(t)))}static addTemporaryClass(e,t,n,r=window){n>0&&(e.classList.add(t),r.setTimeout((()=>e.classList.remove(t)),n))}static getPropertyTransitionDuration(e,t){const n=window.getComputedStyle(e),r=n.transitionProperty.split(", "),i=n.transitionDuration.split(", "),s=r.indexOf(t);let o;return-1!==s&&(o=1e3*parseFloat(i[s])),o}static getAnimationDuration(e){return 1e3*parseFloat(tr.getStyleValue(e,"animation-duration"))}static highlight(e,t=window){return e instanceof nn?e.highlight():new Promise((n=>{t.setTimeout((()=>{e.classList.add("b-fx-highlight"),t.setTimeout((()=>{e.classList.remove("b-fx-highlight"),n()}),1e3)}),0)}))}static get scrollBarWidth(){if(null===Zn&&Pn.body){const e=tr.createElement({parent:Pn.body,style:"position:absolute;top:-999px;width:100px;height:100px;overflow:scroll"});Zn=e.offsetWidth-e.clientWidth,e.remove()}return Zn}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){Zn=null}static measureText(e,t,r=!1,i=n){const s=tr.getMeasureElement(t,i);s[r?"innerHTML":"innerText"]=e;const o=s.clientWidth;return s.className="",o}static measureSize(e,t,n=!0){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const r=tr.getMeasureElement(t);r.innerHTML="",r.style.width=tr.setLength(e);const i=n?r.offsetWidth:r.getBoundingClientRect().width;return r.style.width=r.className="",i}return/^\d+em$/.test(e)?14*parseInt(e):isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=Pn.body){const n=Ln.getComputedStyle(e),r=t.offScreenDiv=t.offScreenDiv||tr.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},!0)[1];return Bn.forEach((e=>{r.style[e]!==n[e]&&(r.style[e]=n[e])})),r.className=e.className,r.parentElement.parentElement!==t&&t.appendChild(r.parentElement),r}static stripTags(e){return(tr.$domParser||(tr.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=tr.createElementFromTemplate(e)}return tr.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(tr.syncAttributes(e,t),tr.syncContent(e,t),tr.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},n=[];for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r];if(i.specified){const e=i.name.toLowerCase();t[e]=i.value,n.push(e)}}return{attributes:t,names:n}}static syncAttributes(e,t){const{attributes:n,names:r}=tr.getSyncAttributes(e),{attributes:i,names:s}=tr.getSyncAttributes(t),o=r.includes("dataset"),a=r.filter((e=>!s.includes(e))),l=s.filter((e=>!(r.includes(e)||o&&e.startsWith("data-")))),c=r.filter((e=>s.includes(e)));if(a.length>0)for(let e=0;e<a.length;e++){const r=a[e];"style"===r?tr.applyStyle(t,n.style,!0):"dataset"===r?Object.assign(t.dataset,n.dataset):t.setAttribute(r,n[r])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(c.length>0)for(let e=0;e<c.length;e++){const r=c[e];if("style"===r)tr.applyStyle(t,n.style,!0);else if("dataset"===r)Object.assign(t.dataset,n.dataset);else if("class"!==r||!n.class.isDomClassList&&"object"!=typeof n.class)i[r]!==n[r]&&t.setAttribute(r,n[r]);else{let e;e=n.class.isDomClassList?n.class:new on(n.class),e.isEqual(i.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===tr.getChildElementCount(e)&&(t.innerText=e.innerText)}static setInnerText(e,t){const n=e.firstChild;n?n.data=t:e.textContent=t}static syncChildren(e,t){const n=this,r=Hn.call(e.childNodes),i=Hn.call(t.childNodes);for(;r.length;){const e=r.shift(),s=i.shift();if(e&&e.nodeType!==fn&&e.nodeType!==pn)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(s&&s.nodeType!==fn&&s.nodeType!==pn)throw new Error(`Target node type ${s.nodeType} not supported by DomHelper.sync()`);if(s)if(e.nodeType===s.nodeType)e.nodeType===fn?s.data=e.data:e.tagName===s.tagName?n.performSync(e,s):(t.insertBefore(e,s),s.remove());else{if(e.nodeType!==fn||s.nodeType!==pn){const t=e.parentElement||e;throw new Error(`Currently no support for transforming nodeType.\n${t.outerHTML}`)}t.innerText=e.data.trim()}else t.appendChild(e)}i.forEach((e=>{e.remove()}))}static syncClassList(e,t){const n=e.classList,r="string"==typeof t,i=r?t.trim().split(Rn):Array.isArray(t)?t:Ot.getTruthyKeys(t),s=i.length;let o,a=n.length!==s;for(o=0;!a&&o<s;o++)a=!n.contains(i[o]);a&&(e.className=r?t:i.join(" "))}static setTheme(e){e=e.toLowerCase();const t=tr.themeInfo.name.toLowerCase(),n=document.head.querySelector("#bryntum-theme:not([data-loading])")||document.head.querySelector(`[href*="${t}.css"]:not([data-loading])`);if(tr.removeEachSelector(document.head,"#bryntum-theme[data-loading]"),null==n||!n.href.includes(`${t}.css`))throw new Error(`Theme link for ${t} not found`);return n.href.includes(`${e}.css`)?jn:new Promise(((t,r)=>{const i=document.createElement("link"),s=n.nextSibling,o=tr.themeInfo.name.toLowerCase(),a={theme:e,prev:o};i.rel="stylesheet",i.id="bryntum-theme",i.addEventListener("load",(()=>{delete i.dataset.loading,Qn=null,n.remove(),an.trigger("theme",a),t(a)})),i.addEventListener("error",(e=>{delete i.dataset.loading,r(e)})),i.dataset.loading="true",i.href=n.href.replace(o,e),s.parentNode.insertBefore(i,s)}))}static get themeInfo(){if(!Qn){const e=tr.createElement({parent:document.body,className:"b-theme-info"}),t=tr.getStyleValue(e,"content",!1,":before");if(t)try{Qn=JSON.parse(t.replace(/^["']|["']$|\\/g,""))}catch(e){Qn=null}e.remove()}return Qn}static async transition({element:e,selector:t="[data-dom-transition]",duration:n,action:r,thisObj:i=this,addTransition:s={},removeTransition:o={}}){const a=Array.from(e.querySelectorAll(t)),l=new Map(a.map((t=>{let n=0,r=t.parentElement;for(;r&&r!==e;)n++,r=r.parentElement;t.$depth=n;const{parentElement:i}=t,s=nn.from(t,e),o=nn.from(t,i),a=window.getComputedStyle(i),l=parseFloat(a.borderLeftWidth);return l&&(s.left-=l,o.left-=l),[t.id,{element:t,globalBounds:s,localBounds:o,depth:n,parentElement:i}]})));r.call(i);const c=Array.from(e.querySelectorAll(t)),d=new Map(c.map((t=>{const n=nn.from(t,e),r=nn.from(t,t.parentElement),i=window.getComputedStyle(t.parentElement),s=parseFloat(i.borderLeftWidth);return s&&(n.left-=s,r.left-=s),[t.id,{element:t,globalBounds:n,localBounds:r}]}))),u=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[t,n]of l){const r=d.get(t);if(r){const{element:t}=r,{style:i,parentElement:s}=t,o=parseInt(er.getStyleValue(t,"zIndex")),{globalBounds:a,localBounds:l,depth:c,parentElement:d}=n,h=d!==s;let g;Ot.copyProperties(t.$initial={parentElement:s},i,u),h?(r.bounds=r.globalBounds,g=a,e.appendChild(t)):(r.bounds=r.localBounds,g=l,d.appendChild(t)),Object.assign(i,{position:"absolute",top:`${g.top}px`,left:`${g.left}px`,width:`${g.width}px`,height:`${g.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:c+(o||0),overflow:"hidden"}),r.processed=!0}else{const{element:e,localBounds:r,depth:i,parentElement:s}=n;e.$initial={removed:!0},Object.assign(e.style,{position:"absolute",top:`${r.top}px`,left:`${r.left}px`,width:`${r.width}px`,height:`${r.height}px`,minWidth:0,minHeight:0,padding:0,margin:0,zIndex:i,overflow:"hidden"}),s.appendChild(e),d.set(t,{element:e,bounds:r,removed:!0,processed:!0}),c.push(e)}}for(const[,e]of d)if(!e.processed){const{element:t}=e,{style:n,parentElement:r}=t,i=e.bounds=e.localBounds;t.classList.add("b-dom-transition-adding"),Ot.copyProperties(t.$initial={parentElement:r},n,u),Object.assign(n,{position:"absolute",top:s.top?0:`${i.top}px`,left:s.left?0:`${i.left}px`,width:s.width?0:`${i.width}px`,height:s.height?0:`${i.height}px`,opacity:s.opacity?0:null,zIndex:r.$depth+1,overflow:"hidden"})}e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:e,bounds:t,removed:n}]of d)n?Object.assign(e.style,{top:o.top?0:`${t.top}px`,left:o.left?0:`${t.left}px`,width:o.width?0:`${t.width}px`,height:o.height?0:`${t.height}px`,opacity:o.opacity?0:e.$initial.opacity}):Object.assign(e.style,{top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,opacity:e.$initial.opacity});await h.sleep(n),e.classList.remove("b-dom-transition");for(const e of c)e.$initial&&(e.$initial.removed?e.remove():(Ot.copyProperties(e.style,e.$initial,u),e.classList.remove("b-dom-transition-adding"),e.$initial.parentElement.appendChild(e)))}static async loadScript(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)}))}static isNamedColor(e){return e&&!/^(#|hsl|rgb)/.test(e)}}const tr=er;let nr;const rr=()=>tr.isTouchEvent=!1,ir=()=>{tr.isTouchEvent=!0,clearTimeout(nr),nr=setTimeout(rr,400)};if(Pn.addEventListener("touchstart",ir,!0),Pn.addEventListener("touchend",ir,!0),tr.supportsTemplate="content"in Pn.createElement("template"),tr.elementPropKey="$bryntum",tr.numberRe=yn,!("children"in Node.prototype)){const e=e=>e.nodeType===e.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let n=t.length;for(;--n>=0&&t.item(n)!==this;);return n>-1}),Ln.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){let t=this;if(!Pn.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===t.ELEMENT_NODE);return null}:Node.prototype.closest=function(e){var t;return null===(t=this.parentNode)||void 0===t?void 0:t.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})),SVGElement.prototype.contains||(SVGElement.prototype.contains=function(e){do{if(this===e)return!0;e=e.parentNode}while(e);return!1}),"function"!=typeof Ln.CustomEvent){let e,t;Ln.CustomEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:n}){return e=Pn.createEvent("CustomEvent"),e.initCustomEvent(t,r.bubbles,r.cancelable,r.detail),e},t.prototype=Ln.Event.prototype,Ln.MouseEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:n}){return e=Pn.createEvent("MouseEvents"),e.initMouseEvent(t,r.bubbles,r.cancelable,Pn.defaultView||Ln,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,document),e},t.prototype=Ln.Event.prototype,Ln.KeyboardEvent=t=function(t,r={bubbles:!1,cancelable:!1,detail:n}){const i=`${r.shiftKey?"Shift ":""}${r.ctrlKey?"Control":""}`;return e=Pn.createEvent("KeyboardEvent"),e.initKeyboardEvent(t,r.bubbles,r.cancelable,Pn.defaultView||Ln,r.key,r.location,i,!1,""),e},t.prototype=Ln.Event.prototype}if(!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset")||!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset").get){const e={enumerable:!0,get:function(){let e,t,n,r,i,s=this,o={},a=this.attributes,l=a.length,c=function(e){return e.charAt(1).toUpperCase()},d=function(){return this},u=function(e,t){return void 0!==t?this.setAttribute(e,t):this.removeAttribute(e)};for(e=0;e<l;e++)i=a[e],i&&i.name&&/^data-\w[\w-]*$/.test(i.name)&&(t=i.value,n=i.name,r=n.substr(5).replace(/-./g,c),Object.defineProperty(o,r,{enumerable:this.enumerable,get:d.bind(t||""),set:u.bind(s,n)}));return o}};Object.defineProperty(SVGElement.prototype,"dataset",e)}const sr=DOMTokenList.prototype.add,or=DOMTokenList.prototype.remove;DOMTokenList.prototype.add=function(e){Array.isArray(e)?e.forEach((e=>sr.call(this,e))):sr.call(this,...arguments)},DOMTokenList.prototype.remove=function(e){Array.isArray(e)?e.forEach((e=>or.call(this,e))):or.call(this,...arguments)},window.addEventListener("resize",(()=>Zn=null)),er._$name="DomHelper";const ar=[],lr={},cr=Array.prototype.slice;let dr;function ur(e){let t;if(1===e.nodeType){t=document.createElement(e.tagName),er.syncAttributes(e,t);hr(e.childNodes).forEach((e=>t.appendChild(e)))}return 3===e.nodeType&&(t=document.createTextNode(e.wholeText)),t}function hr(e){if(e instanceof Node)return ur(e);{const t=[];for(let n=0,r=e.length;n<r;n++)t.push(ur(e[n]));return t}}er.supportsTemplate=!1;l.apply(class{static get target(){return{class:er}}static getRootElement(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return(null==n?void 0:n.body)||(null==n?void 0:n.firstChild)||n||e.ownerDocument.body}static getChildElementCount(e){return e.children.length}static isValidFloatRootParent(e){return e.isConnected&&!e.parentElement}static createElementFromTemplate(e,t=lr){const{array:n,raw:r,fragment:i}=t;let s;if(s=(dr||(dr=new DOMParser)).parseFromString(e,"text/html").body,i){const e=s?s.childNodes:ar;s=document.createDocumentFragment();for(let t=0,n=e.length;t<n;t++)s.appendChild(hr(e[t]));return s}return s||(s={children:[],childNodes:[]}),s=r?s.childNodes:s.children,s=1!==s.length||n?cr.call(s):s[0],hr(s)}static isDOMEvent(e){return"stopImmediatePropagation"in e}});const gr=Node.prototype.contains;Node.prototype.contains=function(e){return e===this||gr.apply(this,arguments)};l.apply(class{static get target(){return{class:r}}static get supportsPointerEvents(){return"onpointerdown"in HTMLElement.prototype}});const{defineProperty:mr}=Reflect;let pr;pr=r.isBrowserEnv?window.performance:{now:()=>(new Date).getTime()};let fr=null;if(s.isTestEnv){const e=r.global.bryntum||(r.global.bryntum={});fr=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,isEmpty:(e=!1)=>fr.timeouts.size+fr.animationFrames.size+(e?fr.intervals.size:0)===0}}const vr=(e,t,n,r)=>{const i="string"==typeof t,s=r&&r.appendArgs||[],o=()=>{n.timerId=null,n.lastCallTime=pr.now();const r=n.args;n.args=null,i?e[t](...r,...s):t.call(e,...r,...s),n.called=!0,++n.calls};return r&&(e=r.thisObj||e),n.lastCallTime=-9e9,n.calls=0,n.invoker=o,o.wrapFn=n,o},yr=(e,t,n="clearTimeout")=>(t.cancel=()=>{t.isPending&&(e[n](t.timerId),t.args=t.timerId=null)},t.flush=()=>{t.isPending&&(e[n](t.timerId),t.timerId=null,t.invoker())},t.now=(...e)=>{t.cancel(),t.args=e,t.invoker()},t.resume=e=>{const n=t.suspended;t.suspended=e||n<1?0:n-1},t.suspend=()=>{++t.suspended},t.immediate=!1,t.suspended=0,t.timerId=null,mr(t,"isPending",{get:()=>null!==t.timerId}),t);var br=e=>class extends(e||me){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const e=this;super.doDestroy(),e.timeoutIds&&(e.timeoutIds.forEach(((e,t)=>{"function"==typeof e&&e(),clearTimeout(t),fr&&fr.timeouts.delete(t)})),e.timeoutIds=null),e.timeoutMap&&(e.timeoutMap.forEach(((e,t)=>clearTimeout(t))),e.timeoutMap=null),e.intervalIds&&(e.intervalIds.forEach((e=>{clearInterval(e),fr&&fr.intervals.delete(e)})),e.intervalIds=null),e.animationFrameIds&&(e.animationFrameIds.forEach((e=>{cancelAnimationFrame(e),fr&&fr.animationFrames.delete(e)})),e.animationFrameIds=null)}hasTimeout(e){return!(!this.timeoutMap||!this.timeoutMap.has(e))}setTimeout({fn:e,delay:t,name:n,runOnDestroy:r,cancelOutstanding:i,args:s}){(arguments.length>1||"function"==typeof arguments[0])&&([e,t,n,r]=arguments),"string"==typeof e?n=e:n||(n=e.name),i&&this.clearTimeout(n);const o=this,a=o.timeoutIds||(o.timeoutIds=new Map),l=o.timeoutMap||(o.timeoutMap=new Map),c=setTimeout((()=>{"string"==typeof e&&(e=o[n]),a&&a.delete(c),l&&l.delete(n),fr&&fr.timeouts.delete(c),e.apply(o,s)}),t);return a.set(c,!r||e),fr&&fr.timeouts.set(c,{fn:e,delay:t,name:n}),n&&l.set(n,c),c}clearTimeout(e){let t=e;if("string"==typeof t){if(!this.timeoutMap)return;t=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(t),this.timeoutIds&&this.timeoutIds.delete(t),fr&&fr.timeouts.delete(t)}clearInterval(e){clearInterval(e),this.intervalIds&&this.intervalIds.delete(e),fr&&fr.intervals.delete(e)}setInterval(e,t){const n=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(n),fr&&fr.intervals.set(n,{fn:e,delay:t}),n}requestAnimationFrame(e,t=[],n=this){const r=this.animationFrameIds||(this.animationFrameIds=new Set),i=requestAnimationFrame((()=>(fr&&fr.animationFrames.delete(i),r.delete(i),e.apply(n,t))));return r.add(i),fr&&fr.animationFrames.set(i,{fn:e,extraArgs:t,thisObj:n}),i}createOnFrame(e,t=[],n=this,r){let i;const s=(...s)=>{i&&r&&(this.cancelAnimationFrame(i),i=null),i||(i=this.requestAnimationFrame((()=>{"string"==typeof e&&(e=n[e]),i=null,s.push(...t),e.apply(n,s)})))};return s.cancel=()=>this.cancelAnimationFrame(i),s}cancelAnimationFrame(e){cancelAnimationFrame(e),this.animationFrameIds&&this.animationFrameIds.delete(e),fr&&fr.animationFrames.delete(e)}async nextAnimationFrame(){return new Promise((e=>this.requestAnimationFrame(e)))}buffer(e,t){let n=t;t&&"number"!=typeof t?n=t.delay:t=null;const r=(...e)=>{if(r.suspended)return;const{delay:t}=r;r.cancel(),r.called=!1,r.args=e,r.immediate||!t?i():r.timerId=this.setTimeout(i,t)},i=vr(this,e,r,t);return r.delay=n,yr(this,r)}raf(e,t){let n=t;t&&"boolean"!=typeof t?n=t.cancelOutstanding:t=null;const r=(...e)=>{r.suspended||(r.cancelOutstanding&&r.cancel(),r.called=!1,r.args=e,r.immediate?i():r.isPending||(r.timerId=this.requestAnimationFrame(i)))},i=vr(this,e,r,t);return r.cancelOutstanding=n,yr(this,r,"cancelAnimationFrame")}throttle(e,t){let n,r=t;t&&"number"!=typeof t?(r=t.delay,n=t.throttled):t=null;const i=this,s=(...e)=>{if(s.suspended)return;const{delay:t}=s,r=pr.now()-s.lastCallTime;s.args=e,s.immediate||r>=t?(i.clearTimeout(s.timerId),o()):(s.isPending||(s.timerId=i.setTimeout(o,t-r),s.called=!1),n&&(n.wrapFn.args=e,n()))},o=vr(i,e,s,t);return s.delay=r,n&&(n=vr(i,n,(()=>{}),t)),yr(i,s)}static setupDelayable(e){e.setupDelayableMethods(e.delayable)}static setupDelayableMethods(e,t=null){const n=e.static,r=t||this.prototype;n&&delete e.static;for(const t in e){let n=e[t];const i=t+"Now",s=typeof n;r[i]=r[t],"number"===s?n={type:"buffer",delay:n}:"string"===s&&(n={type:n}),mr(r,t,{get(){const e=this[n.type](((...e)=>{this[i](...e)}),n);return mr(this,t,{value:e}),e}})}}get widgetClass(){}};class Cr extends nn{static from(e){const t=e.changedTouches;return new Cr(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}Object.getPrototypeOf(Cr).Point=Cr,Cr._$name="Point";const wr=["clientX","clientY","pageX","pageY","screenX","screenY"],Sr={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1},Er={get:()=>!0},Dr={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},xr={Meta:1,Control:1,Alt:1};function Rr(e,t){let n,r;for(;(e=Object.getPrototypeOf(e))&&!r;)n=Object.getOwnPropertyDescriptor(e,t),r=n&&n.get;return r}class Tr{static normalizeEvent(e){return Ot.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],wr)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const n=Mr.getXY(e),r=Mr.getXY(t);return Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2))}static getPagePoint(e){return new nn.Point(e.pageX,e.pageY)}static getClientPoint(e){return new nn.Point(e.clientX,e.clientY)}static addListener(e,t,n,r){return r=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:n},r):Object.assign({element:e},t):e,Mr.on(r)}static on(e){const t=e.element,n=e.thisObj,i=[];for(const s in e)if(!Sr[s]){let o=e[s];"object"!=typeof o&&(o={handler:o});const a=o.element||t;r.isTouchDevice&&!r.isAndroid&&"contextmenu"===s&&i.push(Mr.addElementListener(a,"touchstart",{handler:Mr.createContextMenuWrapper(o.handler,o.thisObj||n)},e)),i.push(Mr.addElementListener(a,s,o,e))}const s=()=>{for(let e,t=0;t<i.length;t++)e=i[t],Mr.removeEventListener(e[0],e[1],e[2]);i.length=0};return n&&!1!==e.autoDetach&&(n.doDestroy=Se.createInterceptor(n.doDestroy,s,n)),s}static addElementListener(e,t,n,i){const s=Mr.createHandler(e,t,n,i),o="passive"in n,a=n.expires||i.expires;let l=n.capture||i.capture;if((o||"passive"in i)&&r.supportsPassive&&(l={capture:!!l,passive:o?n.passive:i.passive}),e.addEventListener(t,s,l),a){const r=n.thisObj||i.thisObj,o=null!=r&&r.isDelayable?r:window,{alt:l}=a,c=l?a.delay:a,{spec:d}=s;d.expires=a,d.timerId=o["number"==typeof c?"setTimeout":"requestAnimationFrame"]((()=>{d.timerId=null,Mr.removeEventListener(e,t,s),l&&!s.called&&("string"==typeof l?r[l]:l).call(r)}),c,`listener-timer-${performance.now()}`)}return[e,t,s,l]}static fixEvent(e){var t,n,i,s;const{type:o}=e;if(o.startsWith("key")){const t=Dr[e.key];t&&Object.defineProperty(e,"key",{get:()=>t})," "!==e.key||e.code||Object.defineProperty(e,"code",{get:()=>"Space"})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",Er),null!==(t=e.target)&&void 0!==t&&t.shadowRoot&&e.composedPath&&!r.isIE11&&!r.isEdge){const t=e.composedPath()[0],n=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:()=>t,configurable:!0}),Object.defineProperty(e,"originalTarget",{get:()=>n,configurable:!0}))}if(r.isChrome&&e.target&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"offsetX")||Object.defineProperty(e,"offsetX",{get:()=>{const t=Rr(e,"offsetX").call(e),{target:n}=e,{offsetWidth:r}=n,i=Math.min(Math.max(t,0),r-1);return t<0||t>=r?i:t}}),Object.getOwnPropertyDescriptor(e,"offsetY")||Object.defineProperty(e,"offsetY",{get:()=>{const t=Rr(e,"offsetY").call(e),{target:n}=e,{offsetHeight:r}=n,i=Math.min(Math.max(t,0),r-1);return t<0||t>=r?i:t}})),(null===(n=e.target)||void 0===n?void 0:n.nodeType)===Element.DOCUMENT_NODE&&"clientX"in e){const t=er.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{get:()=>t})}if((null===(i=e.target)||void 0===i?void 0:i.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"target",{get:()=>t})}if((null===(s=e.relatedTarget)||void 0===s?void 0:s.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{get:()=>t})}return o.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,t,n,r){const i=n.delay||r.delay,s=n.throttled||r.throttled,o=n.block||r.block,a=n.once||r.once,l=n.thisObj||r.thisObj,c=n.capture||r.capture,d=n.delegate||r.delegate,u=n.handler;let h=(e,...t)=>{if(h.called=!0,!(Mr.playingDemo&&e.isTrusted||l&&l.isDestroyed)){if(e=Mr.fixEvent(e),d){var n;const t=(null===(n=e.target.closest)||void 0===n?void 0:n.call)&&e.target.closest(d);if(!t)return;Object.defineProperty(e,"currentTarget",{get:()=>t,configurable:!0})}("string"==typeof u?l[u]:u).call(l,e,...t)}};if(o){const e=h;let t,n;h=(r,...i)=>{const s=performance.now();(!t||r.target!==n||s-t>o)&&(n=r.target,t=s,e(r,...i))}}if(null!=i){const e=h,t=l&&l.setTimeout?l:window;h=(...n)=>{t.setTimeout((()=>{e(...n)}),i)}}if(null!=s){let e,t=s;s.buffer&&(e=e=>s.alt.call(Mr,Mr.fixEvent(e)),t=s.buffer),h=l&&l.isDelayable?l.throttle(h,{delay:t,throttled:e}):Se.createThrottled(h,t,l,null,e)}if(a){const n=h;h=(...r)=>{Mr.removeEventListener(e,t,h),n(...r)}}return n.thisObj&&!1!==n.autoDetach&&(l.doDestroy=Se.createInterceptor(l.doDestroy,(()=>Mr.removeEventListener(e,t,h)),l)),h.spec={delay:i,throttled:s,block:o,once:a,thisObj:l,capture:c,delegate:d},h}static removeEventListener(e,t,n){const{expires:r,timerId:i,thisObj:s,capture:o}=n.spec;if(null!=r&&r.alt&&i){(null!=s&&s.isDelayable?s:window)["number"==typeof r.delay?"clearTimeout":"cancelAnimationFrame"](i)}e.removeEventListener(t,n,o)}static onTransitionEnd({element:e,property:t,handler:n,mode:r="transition",duration:i=er[`get${"transition"===r?"Property":""}${A.capitalize(r)}Duration`](e,t),thisObj:s=window,args:o=[]}){let a;const l=[e,t,...o],c=s.isDelayable?s:window,d=()=>{u(),s.isDestroyed||(s.callback?s.callback(n,s,l):n.apply(s,l))},u=Mr.on({element:e,[`${r}end`]({propertyName:n,target:r}){n===t&&r===e&&(a&&(c.clearTimeout(a),a=null),d())}});return null!=i&&(a=c.setTimeout(d,i+50)),u}static async waitForTransitionEnd(e){return new Promise((t=>{e.handler=t,Tr.onTransitionEnd(e)}))}static createContextMenuWrapper(e,t){return n=>{if(1===n.touches.length){const r=n.touches[0],i=setTimeout((()=>{o();const i=new MouseEvent("contextmenu",r);Object.defineProperty(i,"target",{get:()=>r.target}),"string"==typeof e&&(e=t[e]),i.browserEvent=n,e.call(t,i),Mr.contextMenuTouchId=r.identifier}),Mr.longPressTime),s=({clientX:e,clientY:t,type:n})=>{let s="touchend"===n||"pointerup"===n;if(!s){const n=Math.abs(e-r.clientX),i=Math.abs(t-r.clientY);s=n>=5||i>=5}s&&(Mr.contextMenuTouchId=null,o(),clearTimeout(i))},o=Mr.on({element:document,touchmove:s,touchend:s,pointermove:s,pointerup:s,capture:!0})}}}static createDblClickWrapper(e,t,n){let r,i,s;return()=>{i||(i=Mr.on({element:e,touchstart:e=>{r=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===r){e.preventDefault(),clearTimeout(s),r=i=null;const o=nn.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-o.x,l=e.changedTouches[0].pageY-o.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperty(d,"target",{get:()=>e.target}),Object.defineProperty(d,"offsetX",{get:()=>a}),Object.defineProperty(d,"offsetY",{get:()=>l}),"string"==typeof t&&(t=n[t]),t.call(n,d)}},once:!0}),s=setTimeout((()=>{i(),r=i=null}),Mr.dblClickTime))}}}const Mr=Tr;Mr.longPressTime=500,Mr.dblClickTime=300,Mr.on({element:document,mousedown({target:e}){if(!er.isTouchEvent){var t;const n=er.getRootElement(e);er.usingKeyboard=!1,null===(t=n.classList)||void 0===t||t.remove("b-using-keyboard"),er.removeClsGlobally(n,"b-using-keyboard")}},touchmove({changedTouches:e}){var t;const n=e[0].target,r=er.getRootElement(n);er.usingKeyboard=!1,null===(t=r.classList)||void 0===t||t.remove("b-using-keyboard"),er.removeClsGlobally(r,"b-using-keyboard")},keydown({target:e,key:t}){if(!xr[t]){er.usingKeyboard=!0;const t=er.getRootElement(e);t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(t.children).forEach((e=>{e.matches(".b-outer")&&e.classList.add("b-using-keyboard")})):t.classList.add("b-using-keyboard")}}}),r.isTouchDevice&&Mr.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),Tr._$name="EventHelper";class Fr extends(me.mixin(br)){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;null===(e=this.mousedownRemover)||void 0===e||e.call(this),super.doDestroy()}cancel(){var e,t,n;const r=this;null===(e=r.activeElement)||void 0===e||e.classList.remove(r.pressedCls),r.activeElement=null,null===(t=r.acceleration)||void 0===t||t.cancel(),r.activeListenerRemover=null===(n=r.activeListenerRemover)||void 0===n?void 0:n.call(r),r.clearTimeout("startAutoRepeat"),r.clearTimeout(r.repeatTimer)}updateElement(e){var t;null===(t=this.mousedownRemover)||void 0===t||t.call(this),this.mousedownRemover=Tr.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const t=this,n=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),n&&(t.activeElement=n,t.triggerEvent=e,n.classList.add(t.pressedCls),t.activeListenerRemover=Tr.on({mouseup:{element:document,handler:"onMouseUp"},mousemove:{element:n,handler:"onTargetMouseMove"},mouseleave:{element:n,handler:"onTargetMouseLeave"},mouseenter:{element:n,handler:"onTargetMouseEnter"},thisObj:t}),t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=Se.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}Fr._$name="ClickRepeater";l.apply(class{static get target(){return{class:Fr}}onMouseDown(e){this._overridden.onMouseDown.apply(this,arguments),this.eventTarget=e.target}fireClick(){var e;const t=this,n={};["altKey","bubbles","button","buttons","cancelBubble","cancelable","clientX","clientY","ctrlKey","layerX","layerY","metaKey","pageX","pageY","returnValue","screenX","screenY","shiftKey"].forEach((e=>{n[e]=t.triggerEvent[e]}));const r=new MouseEvent("click",n);null===(e=t.eventTarget)||void 0===e||e.dispatchEvent(r),t.repeatTimer=t.setTimeout(t.fireClick,t.interval)}});const Ar=on.prototype.process;on.prototype.process=function(e,t){return t=t.map((e=>{if("object"==typeof e&&"DOMTokenList"===e.constructor.name){const t={};return Array.from(e).forEach((e=>t[e]=1)),t}return e})),Ar.call(this,e,t)};l.apply(class{static get target(){return{class:er}}static getActiveElement(e){var t,n,r;return null!==(t=e)&&void 0!==t&&t.isWidget&&(e=e.element),null===(n=e)||void 0===n||null===(r=n.getRootNode)||void 0===r?void 0:r.call(n).activeElement}});l.apply(class{static get target(){return{class:er}}static elementFromPoint(e,t){return document.elementsFromPoint(e,t)[0]}});l.apply(class{static get target(){return{class:er}}static getCommonAncestor(e,t){let n=this._overridden.getCommonAncestor.call(this,e,t);return null!=n&&n.isConnected&&!n.parentElement&&(n=n.firstChild),n}});const Ir=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")};l.apply(class{static get target(){return{class:er}}static isVisible(e){const t=e.ownerDocument;for(;e;e=(n=e).parentNode||n.host){if(e===t)return!0;if(e.nodeType===Element.ELEMENT_NODE&&!Ir(e))return!1;if(!e.parentNode&&e.isConnected)return!0}var n;return!1}});const kr=/-/;l.apply(class{static get target(){return{class:Tr}}static fixEvent(e){if(e=Object.create(e),(e=this._overridden.fixEvent.call(this,e)).target&&e.path&&kr.test(e.target.tagName)){const t=e.path[0],n=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:()=>t}),Object.defineProperty(e,"originalTarget",{get:()=>n}))}return e}});const Or=Array.prototype.slice,Lr=Object.freeze([]),Pr=Object.freeze({}),_r=/[&<]/,{getPrototypeOf:$r}=Object,{toString:Hr}=Object.prototype,{isEqual:jr,isObject:Br}=Ot,Nr={_element:1,parent:1,elementData:1,ns:1,syncOptions:1},zr=()=>({ignore:Nr,refsFound:new Set}),Vr={class:1,className:1,classname:1},Wr={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},Gr={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,_element:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1};class Ur{static checkEquality(e,t,r,i){if(e===t)return!0;if(null==e)return null==t;if(!e||!t)return!1;const s=typeof e;if(s!==typeof t||Wr[s])return!1;let o,a,l,c,d,u,h=r.equalityCache||(r.equalityCache=new Map);if(h=h.get(e)||h.set(e,new Map).get(e),o=h.get(t),o===n){if(o=!0,$r(e)!==$r(t)||e instanceof Node)o=!1;else if(Array.isArray(e)){if(a=e.length,a!==t.length)o=!1;else for(;a-- >0;)if(!Ur.checkEquality(e[a],t[a],r,i)){o=!1;break}}else{var g;for(c in d=e.syncOptions,null!==(g=d)&&void 0!==g&&g.ignoreRefs&&(i=!0),l=r.ignore||Pr,t)if(!(l[c]||c in e||i&&"reference"===c)){o=!1;break}if(o)if("[object Date]"===Hr.call(t))o=e.getTime()===t.getTime();else for(c in e)if(!(l[c]||i&&"reference"===c)){if(!(c in t)){o=!1;break}if(u=e[c],!Ur.checkEquality(u,t[c],r,i)){o=!1;break}}}var m;if(!i&&Br(e)&&e.reference)null===(m=r.refsFound)||void 0===m||m.add(e.reference);h.set(t,o)}return o}static sync(e){const t=e,{refOwner:n}=e,r=null==n?void 0:n.byRef,i=zr();let s,o,a,l,c=e.affected;if("string"==typeof c&&(c=[c]),e=d(d({},e),{},{checkEqualityOptions:i}),n){if(n.byRef={},c)for(o in r)c.includes(o)||(n.byRef[o]=r[o]);e.refsWas=r}if(t.changed=Ur.performSync(e,e.targetElement),n)for(c||(c=Object.keys(r)),s=0;s<c.length;++s)o=c[s],a=r[o],i.refsFound.has(o)||a.retainElement?n.byRef[o]=a:(l=a.lastDomConfig,a.remove(),n.detachRef(o,a,l));return e.targetElement}static performSync(e,t){const{domConfig:n,callback:r}=e,{lastDomConfig:i}=t;return(e.configEquality||Ur.checkEquality)(n,i,e.checkEqualityOptions,e.ignoreRefs)?(n._element||Ur.relinkElements(n,t),null==r||r({action:"none",domConfig:n,targetElement:t}),!1):(n?(n.onlyChildren||(Ur.syncAttributes(n,t,e),Ur.syncContent(n,t)),Ur.syncChildren(e,t),n._element=t):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=null!=n&&n.onlyChildren&&i?d(d({},i),{},{children:n.children}):n,!0)}static relinkElements(e,t){var n;e.retainElement||(e._element=t,null===(n=e.children)||void 0===n||n.forEach(((e,n)=>{!e||"string"==typeof e||e instanceof Node||Ur.relinkElements(e,t.lastDomConfig.children[n]._element)})))}static syncDataset(e,t){const{lastDomConfig:n}=t,r=e===n,i=Object.keys(e.dataset),s=n&&n.dataset&&Object.keys(n.dataset),o=Ce.delta(i,s);let a,l,c,d;for(l=0;l<o.onlyInA.length;l++)a=o.onlyInA[l],d=e.dataset[a],null!=d&&t.setAttribute(`data-${A.hyphenate(a)}`,d);for(l=0;l<o.inBoth.length;l++)a=o.inBoth[l],d=e.dataset[a],(r||d!=n.dataset[a])&&(c=`data-${A.hyphenate(a)}`,null==d?t.removeAttribute(c):t.setAttribute(c,d));for(l=0;l<o.onlyInB.length;l++)t.removeAttribute(`data-${A.hyphenate(o.onlyInB[l])}`)}static addCls(e,t){const{lastDomConfig:n}=t;(e=on.normalize(e,"array")).forEach((e=>{t.classList.add(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)||(i.push(e),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)||r.push(e):r.isDomClassList?r.add(e):Ot.isObject(r)&&(r[e]=1)})(e,n)}))}static removeCls(e,t){const{lastDomConfig:n}=t;(e=on.normalize(e,"array")).forEach((e=>{t.classList.remove(e),((e,t)=>{const n="className"in t?"className":"class",r=t[n];if(r)if("string"==typeof r){const i=r.split(" ");i.includes(e)&&(i.splice(i.indexOf(e),1),t[n]=i.join(" "))}else Array.isArray(r)?r.includes(e)&&r.splice(r.indexOf(e),1):r.isDomClassList?r.remove(e):Ot.isObject(r)&&delete r[e]})(e,n)}))}static syncClassList(e,t,n){let r,i,s,o,a,l,c=e.className||e.class;if(n){for(i=on.normalize(t,"array"),c=on.normalize(c,"object"),l=on.normalize(n.className||n.class,"object"),a=[],s=0,o=i.length;s<o;++s)r=i[s],!c[r]&&r in l||(l[r]=1,a.push(r));for(r in c)l[r]||a.push(r);c=a.join(" ")}else c=on.normalize(c);t.setAttribute("class",c)}static getSyncAttributes(e){const t={},n=[];return e&&Object.keys(e).forEach((r=>{if(!Gr[r]){const i=r.toLowerCase();t[i]=e[r],n.push(i)}})),{attributes:t,names:n}}static syncAttributes(e,t,n){const{lastDomConfig:r}=t,i=e===r,s=Ur.getSyncAttributes(e),{attributes:o,names:a}=s,{attributes:l,names:c}=i?s:Ur.getSyncAttributes(r),{onlyInA:d,onlyInB:u,inBoth:h}=i?{onlyInA:Lr,onlyInB:Lr,inBoth:a}:Ce.delta(a,c);for(let n=0;n<d.length;n++){const r=d[n],i=o[r];"style"===r&&null!=i?er.applyStyle(t,i,!0):"dataset"===r?Ur.syncDataset(e,t):Vr[r]?Ur.syncClassList(e,t):null!=i&&t.setAttribute(r,i)}for(let e=0;e<u.length;e++)t.removeAttribute(u[e]);for(let r=0;r<h.length;r++){const s=h[r],a=o[s],c=l[s];null==a?t.removeAttribute(s):"style"===s?n.strict?i?Ur.syncStyles(t,a):jr(a,c,!0)||Ur.syncStyles(t,a,c):!i&&jr(a,c,!0)||er.applyStyle(t,a,!0):"dataset"===s?Ur.syncDataset(e,t):Vr[s]?Ur.syncClassList(e,t,n.strict&&t.lastDomConfig):(i||a!==c)&&t.setAttribute(s,a)}}static syncStyles(e,t,n){let r,i,s;if(n){if(r={},t=er.parseStyle(t),n=er.parseStyle(n),t)for(i in t)s=t[i],n[i]!==s&&(r[i]=s);for(i in n)i in t||(r[i]="")}else r=t;er.applyStyle(e,r)}static syncContent(e,t){const{html:n,text:r}=e,i=null!=r?r:n;e.elementData&&(t.elementData=e.elementData),i instanceof DocumentFragment?1===t.childNodes.length&&0===er.getChildElementCount(t)&&1===i.childNodes.length&&0===er.getChildElementCount(i)?er.setInnerText(t,i.firstChild.data):(t.innerHTML="",t.appendChild(i)):null!=n&&_r.test(n)?t.innerHTML=String(n):null!=i&&er.setInnerText(t,String(i))}static insertTextNode(e,t,n,r,i=null){const s=document.createTextNode(e);t.insertBefore(s,i),r&&(s.$refOwnerId=r.id),null==n||n({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,n,r,i,s,o){var a;const l=o.ns?document.createElementNS(o.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(l,n),Ur.performSync(o,l),null!=s&&(i[s]=l),r&&(l.$refOwnerId=r.id,s&&(l.$reference=s,r.attachRef(s,l,e))),null===(a=o.callback)||void 0===a||a.call(o,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,t){var n;let r,i,s,{domConfig:o,syncIdField:a,callback:l,releaseThreshold:c,configEquality:d,ns:u,refOwner:h,refsWas:g,strict:m,checkEqualityOptions:p,ignoreRefs:f}=e,v=o.syncOptions||{},y=null,b=!0;if(null!==(n=o.html)&&void 0!==n?n:o.text)return;v.ignoreRefs&&(f=!0),f&&(h=g=null),"strict"in v&&(m=v.strict),!1===v.hoistReferences&&(g=h=b=!1);const C=h?h.byRef:{},w=Or.call(o.children||[]),S=Or.call(t.childNodes),E=g||t.syncIdMap||{},D=t.releasedIdMap||{},x=e=>{for(;S.length&&S[0].parentNode!==t;)S.shift();return(e?S.shift():S[0])||null};a=v.syncIdField||a,m=v.strict||m,l=v.callback||l,d=v.configEquality||d,c="releaseThreshold"in v?v.releaseThreshold:c,a&&(t.syncIdMap=C);const R={checkEqualityOptions:p||zr(),ignoreRefs:f,refOwner:h,refsWas:g,strict:m,syncIdField:a,releaseThreshold:c,callback:l,configEquality:d,hoistReferences:b};for(;w.length;){const e=w.shift();if(s=null,!e)continue;if(e instanceof Node){i=x(),e!==i&&t.insertBefore(e,i),r=S.indexOf(e),r>-1&&S.splice(r,1);continue}const n="string"==typeof e;if(R.domConfig=e,R.ns=e.ns||u,!n){if(h?s=e.reference:a&&e.dataset&&(s=e.dataset[a]),null!=s&&!e.unmatched){const n=E[s]||D[s];if(n){const{lastDomConfig:r}=n;if(n.retainElement)Ur.relinkElements(R.domConfig,n);else if(Ur.performSync(R,n)){var T;null===(T=l)||void 0===T||T({action:"reuseOwnElement",domConfig:e,targetElement:n,lastDomConfig:r,syncId:s})}e.retainElement&&(n.retainElement=!0,e._element=n),C[s]=n,Ce.remove(S,n),delete D[s],n.isReleased=!1,i=x(),(n.parentNode!==t||m&&n.nextSibling!==i)&&t.insertBefore(n,i)}else m?Ur.insertElement(e,t,x(),h,C,s,R):(w.push(e),e.unmatched=!0);continue}e.unmatched&&delete e.unmatched}let o,c=null,d=null;for(;!d&&(o=x(!0));){if(h){if(o.$refOwnerId!==h.id)continue;if(o.$reference){if(!m)continue;c=o;break}d=o}else o.retainElement||(d=o);d||(y||(y=[])).push(o)}if(c||!d)n?Ur.insertTextNode(e,t,l,h,c):Ur.insertElement(e,t,c,h,C,s,R);else if(n||d.nodeType!==Node.ELEMENT_NODE||(e.tag||"div").toLowerCase()!==d.tagName.toLowerCase())n&&d.nodeType===Node.TEXT_NODE?d.data=e:(n?Ur.insertTextNode(e,t,l,h,d):Ur.insertElement(e,t,d,h,C,s,R),d.remove());else{var M,F;const{lastDomConfig:t}=d,n=Ur.performSync(R,d);a&&null!=(null==t||null===(M=t.dataset)||void 0===M?void 0:M[a])&&delete D[t.dataset[a]],null!=s&&(C[s]=d),d.isReleased=!1,n&&(null===(F=l)||void 0===F||F({action:"reuseElement",domConfig:e,targetElement:d,lastDomConfig:t,syncId:s}))}}for(;i=x(!0);)h&&(i.$refOwnerId!==h.id||i.$reference)||(y||(y=[])).push(i);y&&Ur.syncChildrenCleanup(t,y,C,l,h,c,a)}static syncChildrenCleanup(e,t,n,r,i,s,o){let a,l=0;for(const c of t){const{lastDomConfig:t}=c;c.retainElement?o&&t&&(n[c.dataset[o]]=c):!i&&o&&(null==s||l<s)?(c.isReleased||(c.className="b-released",c.isReleased=!0,null!=t&&t.dataset&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[t.dataset[o]]=c),null==r||r({action:"releaseElement",domConfig:t,lastDomConfig:t,targetElement:c}),t&&(t.isReleased=!0,t.className&&(t.className="b-released"),t.style&&(t.style=null))),l++):(c.remove(),i&&(a=c.$reference,a&&i.detachRef(a,c,t)),e.releasedIdMap&&o&&null!=t&&t.dataset&&delete e.releasedIdMap[t.dataset[o]],null==r||r({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c}))}}static removeChild(e,t){if(e.contains(t)){const n=e.syncIdMap;if(n){const e=Object.values(n).indexOf(t);e>-1&&delete n[Object.keys(n)[e]]}e.removeChild(t)}}static addChild(e,t,n){e.appendChild(t),e.syncIdMap[n]=t}static getChild(e,t){const n=String(t).split(".");for(const t of n)e=e.syncIdMap[t];return e}}Ur._$name="DomSync";class Yr{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map((e=>{let n=t+A.capitalize(e);return"moz"===t&&(n=n.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(n="mozCancelFullScreen")),n}));this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const n=["fullscreenchange","fullscreenerror"],r=e=>n.map((t=>e+A.capitalize(t)));this.events="fullscreenEnabled"in document&&n||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullscreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[]}static get enabled(){return document[this.functions[0]]}static request(e){return e[this.functions[1]]()}static exit(){return document[this.functions[2]]()}static get isFullscreen(){return!!document[this.functions[3]]}static onFullscreenChange(e){document.addEventListener(this.events[0],e)}static unFullscreenChange(e){document.removeEventListener(this.events[0],e)}}Yr.init(),Yr._$name="Fullscreen";let qr=null;const Kr=[],Xr=e=>{var t;return e.nodeType===e.ELEMENT_NODE&&"absolute"===(null===(t=e.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(e).getPropertyValue("position"))};class Zr{static addResizeListener(e,t){const n=this;if(e!==document&&e!==window||(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)n.hasWindowResizeListener||(window.addEventListener("resize",n.onWindowResize),n.hasWindowResizeListener=!0);else if(window.ResizeObserver)n.resizeObserver||(n.resizeObserver=new ResizeObserver(n.onElementResize)),n.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[i,s,o]=er.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},!0);s.scrollLeft=s.scrollTop=o.scrollLeft=o.scrollTop=1e6,s.addEventListener("scroll",n.onSizeMonitorScroll,!0),o.addEventListener("scroll",n.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((e=>{const t=[];for(const n of e)"childList"===n.type&&(t.push.apply(t,n.removedNodes),t.push.apply(t,n.addedNodes));t.length>0&&t.every(Xr)||(!r.isEdge&&!r.isIE11||s.classList.contains("b-resize-monitor-expand"))&&s.dispatchEvent(new CustomEvent("scroll",{bubbles:!1}))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=i}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==window||(e=document.body);const n=e._bResizemonitor;let r=0;n&&n.handlers&&(Ce.remove(n.handlers,t),r=n.handlers.length),r||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,n=e._bResizemonitor,r=t.contentRect||e.getBoundingClientRect();if(e.offsetParent&&(!n.rectangle||r.width!==n.rectangle.width||r.height!==n.rectangle.height)){const t=n.rectangle;n.rectangle=r;for(const i of n.handlers)i(e,t,r)}}}static onSizeMonitorScroll(e){var t;if(null!==(t=document.body)&&void 0!==t&&t.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,n=t.parentNode,r=n._bResizemonitor,i=n.getBoundingClientRect();r.rectangle&&i.width===r.rectangle.width&&i.height===r.rectangle.height||(Kr.push([n,r.rectangle,i]),r.rectangle=i,qr||(qr=requestAnimationFrame(Zr.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,n=t._bResizemonitor,r=n.rectangle;n.rectangle=document.documentElement.getBoundingClientRect();for(const e of n.handlers)e(t,r,n.rectangle)}static fireResizeEvents(){for(const e of Kr)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);qr=null,Kr.length=0}}Zr._$name="ResizeMonitor";const Jr=Ot.getPathDefault(r.global,"bryntum.idCounts",Object.create(null));class Qr{static generateId(e="generatedId"){return e+(Jr[e]=(Jr[e]||0)+1)}}Qr._$name="IdHelper";const ei={true:"auto",false:"hidden","hidden-scroll":"auto"},ti="b-widget-scroller",ni={block:"nearest"},ri=Promise.resolve(),ii={x:1};class si extends(br(Be(me))){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}syncOverflowState(){const{element:e}=this,{classList:t}=e;r.isEdge?t[e.scrollWidth-e.clientWidth>1?"add":"remove"]("b-horizontal-overflow"):t[e.scrollWidth>e.clientWidth?"add":"remove"]("b-horizontal-overflow"),t[e.scrollHeight>e.clientHeight?"add":"remove"]("b-vertical-overflow")}hasScrollbar(e="y"){const{element:t}=this;if(t&&er.scrollBarWidth){const n="y"===e,r=n?"Width":"Height",i=t[`client${r}`],s=parseInt(er.getStyleValue(t,`border${n?"Left":"Top"}Width`))+parseInt(er.getStyleValue(t,`border${n?"Right":"Bottom"}Width`)),o=t[`offset${r}`]-s-i;return Math.abs(o-er.scrollBarWidth)<2}}addPartner(e,t=ii){const n=this;"string"==typeof t&&(t={[t]:1}),n.partners||(n.partners={}),n.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=n.x),t.y&&(e.y=n.y),e.isPartneredWith(n)||e.addPartner(n,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){return Boolean(this.partners&&this.partners[e.id])}scrollIntoView(e,t=ni){const n=this,r=e instanceof nn,i=r?e:nn.from(e),{xDelta:s,yDelta:o}=n.getDeltaTo(e,t),a=n.scrollBy(s,o,t);return(t.highlight||t.focus)&&a.then((()=>{r&&(e=i.translate(-s,-o)),t.highlight&&(isNaN(t.highlight)?(n.widget||n).callback(t.highlight,null,[e]):er.highlight(e,n)),t.focus&&e.focus()})),a}scrollBy(e=0,t=0,n=ni){const r=this,i="object"==typeof n?n.animate:n,s=Math.abs(e),o=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=n.silent);let a=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(a&&(s>10||o>10)){const{x:l,y:c}=r;let d=l,u=c;return Math.max(s,o)<50&&(a=Math.min(a,500)),r.scrollAnimation=Se.animate(a,(i=>{const s=1===i;if(e){if(r.x!==d&&!n.force)return r.scrollAnimation&&r.scrollAnimation.cancel();r.x=Math.max(l+(s?e:Math.round(e*i)),0)}if(t){if(r.y!==u&&!n.force)return r.scrollAnimation&&r.scrollAnimation.cancel();r.y=Math.max(c+(s?t:Math.round(t*i)),0)}d=r.x,u=r.y}),r,i.easing),r.element.classList.add("b-scrolling"),r.scrollAnimation.then((()=>{r.isDestroyed||(r.element.classList.remove("b-scrolling"),r.scrollAnimation=null)})),r.scrollAnimation}return e|t?(r.x+=e,r.y+=t,l=r.element,new Promise((e=>Tr.on({element:l,scroll:e,once:!0})))):ri;var l}scrollTo(e,t,n){const{x:r,y:i}=this,s=null==e?0:e-r,o=null==t?0:t-i;return this.scrollBy(s,o,n)}doDestroy(){const e=this;e._element&&(e._element.removeEventListener("scroll",e.scrollHandler),e.wheelListenerRemover&&e.wheelListenerRemover()),e.scrollAnimation&&e.scrollAnimation.cancel(),Object.values(e.partners||{}).forEach((({scroller:t})=>t.removePartner(e))),super.doDestroy()}onElMutation(e){const t=this,[n,r]=er.getTranslateXY(t.element);if(t._x!==-n||t.y!==-r){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onScroll(e){const t=this;t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,t.element.classList.contains("b-scrolling")||t.element.classList.add("b-scrolling"),e.widget=t.widget,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.onScrollEnd(e))}syncPartners(e){const t=this;t.partners&&Object.values(t.partners).forEach((({axes:n,scroller:r})=>{(r!==t.controllingPartner||e)&&r.sync(t,n)}))}onScrollEnd(e){this.silent&&(this.silent=!1),this.trigger("scrollEnd",e),this.controllingPartner=null,this.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const n=this;if(!n.viewport)return{xDelta:0,yDelta:0};const r=e instanceof nn?e:nn.from(e),i=t.block||"nearest",s=n.viewport,o=t.edgeOffset||0,a=s.width>=r.width+2*o?o:0,l=s.height>=r.height+2*o?o:0,c=r.clone().adjust(-a,-l,a,l).constrainTo(new nn(s.x-n.x,s.y-n.y,n.scrollWidth,n.scrollHeight)),d=c.clone();let u=0,h=0;if("start"===i)d.moveTo(s.x,s.y),u=c.x-d.x,h=c.y-d.y;else if("end"===i)d.translate(s.right-d.right,s.bottom-d.bottom),u=c.x-d.x,h=c.y-d.y;else if("center"===i){const e=s.center;d.moveTo(e.x-d.width/2,e.y-d.height/2),u=u||c.x-d.x,h=h||c.y-d.y}else d.width>s.width?u=d.x-s.x:d.right>s.right?u=d.right-s.right:d.x<s.x&&(u=d.x-s.x),d.height>s.height?h=d.y-s.y:d.bottom>s.bottom?h=d.bottom-s.bottom:d.y<s.y&&(h=d.y-s.y);return{xDelta:!1===t.x?0:Math.max(Math.min(Math.round(u),n.maxX-n.x),-n.x),yDelta:!1===t.y?0:Math.max(Math.min(Math.round(h),n.maxY-n.y),-n.y)}}get viewport(){return nn.client(this.element)}updateElement(e,t){const n=this,r=n.scrollHandler||(n.scrollHandler=n.onScroll.bind(n));if(t&&(n.translate?n.mutationObserver&&n.mutationObserver.disconnect(t):(t.removeEventListener("scroll",r),t.classList.remove(ti),t.style.overflowX=t.style.overflowY="")),n.translate){if(n.mutationObserver||(n.mutationObserver=new MutationObserver((e=>n.onElMutation(e)))),n.mutationObserver.observe(e,{attributes:!0}),n._x=n._y=0,document.contains(e)){const[t,r]=er.getTranslateXY(e);n._x=-t,n._y=-r}}else e&&(e.addEventListener("scroll",r),e.classList.add(ti));n.positionDirty&&(n.updateOverflowX(n.overflowX),n.updateOverflowY(n.overflowY)),n.isConfiguring&&(n._x&&n.updateX(n._x),n._y&&n.updateY(n._y)),n.positionDirty=!0}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=er.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._x}changeX(e){if(!this.isConfiguring||e)return e;this._x=e}updateX(e){const{element:t,widget:n}=this;!t||null!=n&&n.isConfiguring||(this.trigger("scrollStart",{x:e}),this.translate?er.setTranslateX(t,-e):t.scrollLeft=e),this.positionDirty=!0}sync(e,t){const{x:n,y:r}=t;null!=n&&this.x!==e.x&&(this.controllingPartner=e,this.x=e.x),null!=r&&this.y!==e.y&&(this.controllingPartner=e,this.y=e.y)}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=er.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:t,widget:n}=this;!t||null!=n&&n.isConfiguring||(this.trigger("scrollStart",{y:e}),this.translate?er.setTranslateY(t,-e):t.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}updateOverflowX(e){const{element:t,translate:n}=this;t&&("hidden-scroll"!==e||n||(t.classList.add("b-hide-scroll"),this.enableWheel()),n||(t.style.overflowX=ei[e]||e)),this.positionDirty=!this.isConfiguring}updateOverflowY(e){const{element:t,translate:n}=this;t&&("hidden-scroll"!==e||n||(t.classList.add("b-hide-scroll"),this.enableWheel()),n||(t.style.overflowY=ei[e]||e)),this.positionDirty=!this.isConfiguring}enableWheel(){r.isChrome||r.isSafari||this.wheelListenerRemover||(this.wheelListenerRemover=Tr.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&!1!==this.overflowX?(this.x+=e.deltaX,e.stopPropagation()):!1!==this.overflowY&&(this.y+=e.deltaY,e.stopPropagation())}get scrollWidth(){return this.element?this.element.scrollWidth:0}set scrollWidth(e){const t=this;let n=t.widthStretcher;n&&null==e?(n.remove(),t.widthStretcher=null):e&&(n||(n=t.widthStretcher=er.createElement({className:"b-scroller-stretcher b-horizontal-stretcher"})),n.style.transform=`translateX(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n)),!1!==t.propagate&&t.eachPartner((({scroller:t})=>{t.propagate=!1,t.scrollWidth=e,delete t.propagate})),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){return this.element?this.element.scrollHeight:0}set scrollHeight(e){const t=this,n=t.stretcher||(t.stretcher=er.createElement({className:"b-scroller-stretcher"}));n.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n),t.positionDirty=!0}get clientWidth(){return this.element?this.element.clientWidth:0}get clientHeight(){return this.element?this.element.clientHeight:0}get id(){return this._id||(this.widget?this._id=`${this.widget.id}-scroller`:this._id=Qr.generateId("scroller-")),this._id}}si._$name="Scroller";const oi="English",ai={localeName:"En",localeDesc:oi,Object:{Yes:"Yes",No:"No",Cancel:"Cancel",Ok:"OK"},Combo:{noResults:"No results"},FilePicker:{file:"File"},Field:{badInput:"Invalid field value",patternMismatch:"Value should match a specific pattern",rangeOverflow:e=>`Value must be less than or equal to ${e.max}`,rangeUnderflow:e=>`Value must be greater than or equal to ${e.min}`,stepMismatch:"Value should fit the step",tooLong:"Value should be shorter",tooShort:"Value should be longer",typeMismatch:"Value is required to be in a special format",valueMissing:"This field is required",invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},NumberFormat:{locale:"en-US",currency:"USD"},DurationField:{invalidUnit:"Invalid unit"},TimeField:{invalidTime:"Invalid time input"},List:{loading:"Loading..."},GridBase:{loadMask:"Loading...",syncMask:"Saving changes, please wait..."},PagingToolbar:{firstPage:"Go to first page",prevPage:"Go to previous page",page:"Page",nextPage:"Go to next page",lastPage:"Go to last page",reload:"Reload current page",noRecords:"No records to display",pageCountTemplate:e=>`of ${e.lastPage}`,summaryTemplate:e=>`Displaying records ${e.start} - ${e.end} of ${e.allCount}`},UndoRedo:{Undo:"Undo",Redo:"Redo",UndoLastAction:"Undo last action",RedoLastAction:"Redo last undone action"},DateHelper:{locale:"en-US",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"},{single:"decade",plural:"decades",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A"},ordinalSuffix:e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t}}};Ve.registerLocale("En",{desc:oi,locale:ai});const{defineProperty:li}=Reflect,ci=Symbol("owner"),di=/[\s,]+/;var ui=e=>class extends(e||me){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(e,t,n=r.global.__BRYNTUM_EXAMPLE){const{factoryable:i}=this.initClass(),{caseless:s,registry:o}=i,a=A.split(e,di);for(let e,r,l=0;l<a.length;++l){if(r=a[l],e=s?r.toLowerCase():r,!n&&e in o)throw new Error(`Type "${r}" already registered with ${i.class.name} factory`);o[r]=o[e]=t.initClass()}}static isA(e,t){return this.isType(e,t,!0)}static isType(e,t,n){const{factoryable:r}=this,{caseless:i,registry:s}=r,o=s[i?t.toLowerCase():t];return!!o&&(n?e instanceof o:e.constructor===o)}static setupAlias(e){e.register(e.alias,e)}static setupFactoryable(e,t){const n=t.super.class;let{factoryable:r}=e;r=d({caseless:!0,defaultType:null,extends:n.factoryable?[n]:null,typeKey:"type"},r),r.class=e,r.registry=Object.create(null),r.extends&&!Array.isArray(r.extends)&&(r.extends=[r.extends]),li(e,"factoryable",{get:()=>r})}static setupType(e){const{type:t}=e;e.register(t,e),li(e.prototype,"type",{value:t})}static create(e,t){return this.reconfigure(null,e,t)}static reconfigure(e,t,n){const r=this,{factoryable:i}=r,{typeKey:s}=i;let o,a,l,c,d,u,h,g,m,p=n;if(n&&!Ot.isClass(n)&&(p=null,h=typeof n,"function"===h?u=n:"string"===h?p=n:Ot.isObject(n)?(o=n.cleanup,a=n.defaults,c=n.owner,u=n.setup,p=n.type,g=n.transform):c=n),g&&(t="string"==typeof g?c[g](t):g(t)),m=t,"string"==typeof m)t={};else if(t){if(!0===t&&(t={}),!Ot.isObject(t)){var f;if(c&&t!==e&&(null==e?void 0:e[ci])===c)"string"==typeof o?c[o](e):null===(f=o)||void 0===f||f(e),e.destroy();return t}m=t[s]}if(m=m&&r.resolveType(m),e){if(t&&(!m||e.constructor===m))return s in t&&delete(t=Ot.assign({},t))[s],e.setConfig(t),e;var v;if(c&&e[ci]===c)"string"==typeof o?c[o](e):null===(v=o)||void 0===v||v(e),e.destroy()}if(t){if(a){if(!(l=m)){if(!(l=a[s]||p||i.defaultType))throw new Error(`No default mergeType defined for ${i.class.name} factory`);l=r.resolveType(l)}l&&(t=l.mergeConfigs(a,t))}if(u){if(d="string"==typeof u?c[u](t,m,a):u(t,m,a),null===d)return d;t=d||t}if(!m){if(!(m=t[s]||p||i.defaultType))throw new Error(`No default type defined for ${i.class.name} factory`);m=r.resolveType(m)}a&&!l&&(t=m.mergeConfigs(a,t)),s in t&&delete(t=Ot.assign({},t))[s],t=new m(t),c&&(t[ci]=c)}return t||null}static resolveType(e,t){if("string"!=typeof e)return e;const{factoryable:n}=this,r=n.extends;let i,s=n.registry[n.caseless?e.toLowerCase():e];for(i=0;!s&&r&&i<r.length;++i)s=r[i].resolveType(e,!0);if(!s&&!t)throw new Error(`Invalid type name "${e}" passed to ${n.class.name} factory`);return s}};const hi=Ot.getPathDefault(r.global,"bryntum.idCounts",Object.create(null)),gi={string:1,number:1};var mi=e=>class extends(e||me){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(e,t){const{identifiable:n}=e;n.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get:()=>n})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(e){return(this.hasGeneratedId=!e)?this.generateAutoId():e}updateId(e,t){const n=this,r=n.constructor;t&&r.unregisterInstance(n,t),n.hasGeneratedId&&!1===r.identifiable.registerGeneratedId||r.registerInstance(n,e)}generateAutoId(){return this.constructor.generateId(`b-${this.$$name.toLowerCase()}-`)}static get all(){return Object.values(this.identifiable.idMap)}static generateId(e="generatedId"){return e+(hi[e]=(hi[e]||0)+1)}static registerInstance(e,t=e.id){const{idMap:n}=this.identifiable;if(t in n&&!this.disableThrow)throw new Error("Id "+t+" already in use");n[t]=e}static unregisterInstance(e,t=e.id){const{idMap:n}=this.identifiable;gi[typeof e]?delete n[e]:n[t]===e&&delete n[t]}static getById(e){const t=this.identifiable.idMap;if(t)return t[e]}static get registeredInstances(){const e=this.identifiable.idMap;return e?Object.values(e):[]}};class pi{constructor(e){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),e&&e(this)}}pi._$name="Promissory";const{defineProperty:fi}=Reflect;class vi extends(me.mixin(Ye,Be,br,mi)){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,t=e.$meta;let r,i,s=t.renderConfigs;if(s===n){for(i in s=null,r=t.configs,r)r[i].render&&(s||(s=new Set)).add(i);t.renderConfigs=e.prototype.$renderConfigs=s}return s}construct(...e){this.$iid=++vi.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==vi.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,t){const n=this;return t&&t.remove(),e&&(e.id=n.id,e=er.createElement(e,{refOwner:n})),e}updateId(e,t){const n=this;if(t){const r=n.element;r.id=e,n.fixRefOwnerId(r,e,t)}}get classes(){return this.element.classList}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;const r=e.$reference;r&&(e.id=`${t}-${r}`);for(const r of e.childNodes)this.fixRefOwnerId(r,t,n)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,t,n){const r=this,i="_"+e,{listeners:s}=n;i in r||fi(r,e,{get:()=>(r.refreshDom.flush(),r[i]),set(e){r[i]=e}}),t.id=`${r.id}-${e}`,r.byRef[e]=t,r[e]=t,s&&(n.listeners={on:s,un:Tr.on(Object.assign({element:t,thisObj:r},s))})}detachRef(e,t,n){n.listeners&&(n.listeners.un(),n.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,t=e.$meta,n=e.constructor;let r=t.renderConfigs||n.renderConfigs,i=e;if(!r){i=Object.create(e),r=new Set;for(const n in t.configs)fi(i,n,{get:()=>(r.add(n),e[n])});i.renderDom=()=>e.renderDom.call(i),e.$renderConfigs=r}return fi(e,"renderContext",{value:i}),i}refreshDom(){Ur.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){"draw"===e&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let t=Object.values(e.byRef).find((e=>e.classList.contains("b-drawable")));t||(t=e.element,t.classList.add("b-drawable")),e.intersector=!0,Tr.on({element:er.createElement({parent:t,class:"b-drawable-el"}),animationend({animationName:t}){"b-drawable-anim"===t&&e.onDraw({count:++e.drawCounter})}})}}onDraw(e){this.trigger("draw",e)}}vi.$idSeed=0,Object.assign(vi.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),vi._$name="Renderable";class yi extends vi{static get $name(){return"Mask"}static get type(){return"mask"}static get configurable(){return{autoClose:null,cover:null,icon:"b-icon b-icon-spinner",errorDefaults:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:null,target:null,text:null,type:null,showDelay:null,useTransition:!1}}static get delayable(){return{deferredClose:0,delayedShow:0}}construct(e){if(e){let t,n=e.element;n&&(s.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=t=Object.assign({},e),delete t.element,t.target=n),n=e.target,"string"==typeof n&&(e=t=t||Object.assign({},e),t.target=e.owner[n])}super.construct(e),this.target||(this.target=document.body),this.show()}doDestroy(){const e=this,{element:t}=e;if("trial"===e.type)return!1;t&&(e.element=null,e.mode.endsWith("blur")&&er.forEachChild(t,(t=>{t.classList.remove(`b-masked-${e.mode}`)})),e.target.classList.remove("b-masked"),e.target[e.maskName]=null),super.doDestroy()}get maskElement(){return this.element}get maskName(){const e=this.type;return`mask${"string"==typeof e?e.trim():""}`}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:t}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,[`b-mask-${e.mode}`]:1,"b-progress":t,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[t?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:`${Math.max(0,Math.min(100,Math.round(e.progress/t*100)))}%`}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?`<i class="b-mask-icon ${e.icon}"></i>`:"")+e.text}]}]}}static mergeConfigs(...e){const t={};for(const n of e)"string"==typeof n?t.text=n:Ot.assign(t,n);return t}static mask(e,t=document.body){return new yi("string"!=typeof e?Object.assign({target:t},e):{target:t,text:e})}static unmask(e=document.body){return e.mask&&e.mask.close()}updateAutoClose(e){const t=this;t.deferredClose.cancel(),e&&(t.deferredClose.delay=e,t.deferredClose())}updateCover(){const e=this.owner;e&&e.syncMaskCover&&e.syncMaskCover(this)}updateShowDelay(e){const t=this.delayedShow;t.delay=e,e||t.flush()}deferredClose(){const e=this.owner;this.close().then((()=>{e&&e.onMaskAutoClose&&e.onMaskAutoClose(this)})),e&&e.onMaskAutoClosing&&e.onMaskAutoClosing(this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:t,target:n,hiding:r,maskName:i}=e;r&&(r.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(t.classList.add("b-delayed-show"),e.delayedShow()),t.classList.add("b-visible"),t.classList.remove("b-hidden"),n.classList.add("b-masked"),n[i]||(n[i]=e,n.appendChild(t)),e.shown=!0,e.mode.endsWith("blur")&&er.forEachChild(n,(n=>{n!==t&&n.classList.add(`b-masked-${e.mode}`)}))}hide(){const e=this,{target:t,element:n}=e;let r=e.hiding;if(!r){if(!e.shown)return Promise.resolve();e.hiding=r=new pi,e.shown=!1,n.classList.remove("b-visible"),n.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&er.forEachChild(t,(t=>{t!==n&&t.classList.remove(`b-masked-${e.mode}`)})),r.promise=r.promise.then((()=>{e.hiding===r&&(e.hiding=null)})),e.setTimeout((()=>r.resolve()),500,"hide")}return r.promise}close(){return this.hide().then((()=>{this.destroy()}))}}yi._$name="Mask";const bi=[],Ci=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,wi={INPUT:1,TEXTAREA:1},Si=(e,t,n)=>{var r;let i=null==n?void 0:n.listeners;i=(null===(r=i)||void 0===r?void 0:r.on)||i,i&&(n.listeners={on:i,un:Tr.on(Ot.assign({element:t,thisObj:e},i))})},Ei=(e,t)=>e&&t&&t[Ot.keys(e)[0]]?Z.merge(e,t):e,Di=e=>{e.isVisible&&e.triggerPaint()},xi=/^:not\((.+)\)$/,Ri=e=>null!=e.scale,{hasOwnProperty:Ti}=Object.prototype,{defineProperty:Mi}=Reflect,Fi=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),Ai=Promise.resolve(),Ii=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"];class ki extends(me.mixin(Ye,Be,br,mi,ui)){static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},contentElementCls:{$config:{merge:"classList"},value:null},dock:null,parent:null,tab:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:null,maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:"t-b",centered:null,constrainTo:n,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:Ei},value:null},showAnimation:{$config:{merge:Ei},value:null},x:null,y:null,scrollable:{$config:["nullify"],value:null},scrollerClass:si,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return ki._recomposeAsync}static set recomposeAsync(e){if(ki._recomposeAsync=e,null!=e){const{all:t}=ki;for(let n=0;n<t.length;++n)t[n].isComposable&&(t[n].recomposeAsync=e)}}isType(e,t){return ki.isType(this,e,t)}static setupRenderConfigs(e,t){let n,{renderConfigs:r}=e;if(r){const e=t.getInherited("renderConfigs",!1)||Object.create(null);if(Array.isArray(r)){for(n=0;n<r.length;++n)e[r[n]]=!0;r=e}else r=Object.assign(e,r)}t.renderConfigs=r}construct(e={},...t){const n=this;n._isAnimatingCounter=0,n.alignConstrained=0,n.byRef=Object.create(null),n.callRealign=n.realign.bind(n),n.doHideOrRealign=n.doHideOrRealign.bind(n),n.onFullscreenChange=n.onFullscreenChange.bind(this),n.domSyncCallback=n.domSyncCallback.bind(n),n._isUserAction=!1,super.construct(e,...t);const{recomposeAsync:r}=ki;null!=r&&null==n.recomposeAsync&&(n.recomposeAsync=r),n.finalizeInit()}startConfigure(e){const t=this,{adopt:n,element:r}=t;n&&(t.adoptElement(r,n,e.id),t.updateElement(t._element,r)),super.startConfigure(e)}finalizeInit(){(this.insertBefore||this.appendTo||this.insertFirst||this.adopt)&&this.render()}doDestroy(){const e=this,{preExistingElements:t,element:n}=e;if(n){var r,i,s;const o=!e._tooltip&&e._rootElement&&(null===(r=ki.Tooltip)||void 0===r?void 0:r.getSharedTooltip(e._rootElement,!0));if((null==o?void 0:o.activeTarget)===n&&o.hide(),e.onExitFullscreen(),e.clearTimeout(e.scrollListenerTimeout),e.clearTimeout(e.resizeListenerTimeout),e.removeTransientListeners(),e.floating||e.positioned?e.hide():e.revertFocus(),Zr.removeResizeListener(n.parentElement,e.onParentElementResize),Zr.removeResizeListener(n,e.onElementResize),e.adopt){for(let r=Array.from(n.childNodes),i=0,{length:s}=r;i<s;i++){const n=r[i];t.includes(n)||n===e.floatRoot||n.remove()}n.className=e.adoptedElementClassName,n.style.cssText=e.adoptedElementCssText}else n.remove();null===(i=e.dragEventDetacher)||void 0===i||i.call(e),null===(s=e.dragOverEventDetacher)||void 0===s||s.call(e),e.dragGhost.remove()}super.doDestroy()}get isComposable(){return!this.compose.$nullFn}adoptElement(e,t,n){const r=this,i="string"==typeof t?document.getElementById(t):t,s=ki.fromElement(i);if(s&&s.adopt&&s!==r){("string"==typeof s.adopt?document.getElementById(s.adopt):s.adopt)===i&&s.destroy()}r.preExistingElements=Array.from(i.childNodes),r.adoptedElementClassName=i.className,r.adoptedElementCssText=i.style.cssText,i.id&&!n&&(r.id=e.id=i.id),er.syncAttributes(e,i);for(let t=0,{length:n}=e.childNodes;t<n;t++)i.appendChild(e.childNodes[0]);delete r._contentRange,r._element=i;const o=e.lastDomConfig,a=null==o?void 0:o.listeners;var l;a&&r.isComposable&&(null===(l=a.un)||void 0===l||l.call(a),Si(r,i,o));i.lastDomConfig=o||i.lastDomConfig,i.$refOwnerId=r.id,r.scaleToFitWidth||r.getConfig("monitorResize")}addRefAccessor(e,t){const{prototype:n}=this.constructor;Mi(n,t,{writable:!0,value:null}),Mi(n,e,{get(){return this.recompose.flush(),this[t]},set(e){this[t]=e}})}attachRef(e,t,n){const r=this,i="_"+e;t.dataset&&(t.dataset.ownerCmp=r.id),r.isComposable&&(i in r||r.addRefAccessor(e,i),Si(r,t,n)),r.byRef[e]=t,r[e]=t}detachRef(e,t,n){n.listeners&&(n.listeners.un(),n.listeners=null),this[e]=null,delete this.byRef[e]}afterRecompose(){}compose(){return{class:on.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:t}=e,n=t.hierarchy;let r,i,s,o,a,l,{composers:c}=t,d=null;if(e.recompose.suspend(),!c){for(s=!0,t.composers=c=[],o=n.indexOf(ki);o<n.length;++o)a=n[o].prototype,Ti.call(a,"compose")&&c.push(a);(l=t.getInherited("renderConfigs",!1))||(l=Object.create(null),e.configObserver={get(e){l[e]=!0}}),t.$renderConfigs=l}for(o=0;o<c.length;++o)r=c[o].compose.call(e,d),d=d?er.merge(d,r):r;return Ti.call(e,"compose")&&(r=e.compose)&&(r=r.call(e,d),er.merge(d,r)),s&&delete e.configObserver,er.normalizeChildren(d,((t,n)=>{n&&(i="_"+t,i in e||e.addRefAccessor(t,i))}))}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(){}changeElement(e){const t=this,n=t.isComposable;if(n&&(e=t.doCompose()),"string"==typeof e)e=er.createElementFromTemplate(e);else if(Ot.isObject(e)){if(t.initialSync){const n=e;e=document.createElement("div"),Ur.sync({targetElement:e,domConfig:n,refOwner:t,callback:t.domSyncCallback,strict:!0}),t.recompose.resume()}else e=er.createElement(e,{refOwner:t}),t.recompose.resume();n&&Si(t,e,e.lastDomConfig)}else 1!==e.nodeType&&(e=er.createElementFromTemplate(t.template(t)));return e.id=t.id,e}updateElement(e){const t=this,{className:n}=e,{contentElement:r,contentElementCls:i}=t,s=!t.isComposable&&e.querySelectorAll("[data-reference]"),o=t.isComposable?[]:t.widgetClassList;if(n&&o.unshift(n),t._hidden&&o.push("b-hidden"),t._readOnly&&o.push("b-readonly"),Se.noThrow(e,"remove"),i&&(r===e?o.push(i):r.className+=" "+i),t.parent||o.push(...ki.outerCls),e.className=o.join(" "),s)for(let e,n=0;n<s.length;++n)e=s[n],t.attachRef(e.getAttribute("data-reference"),e),e.removeAttribute("data-reference");t.adopt||t.scaleToFitWidth||t.getConfig("monitorResize")}async recompose(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};e.transitionRecompose?(e.isTransitioningDom=!0,await er.transition(Ot.assign({element:e.element,action(){Ur.sync(t)}},e.transitionRecompose)),e.isTransitioningDom=!1,e.trigger("transitionedRecompose")):Ur.sync(t),t.changed&&e.afterRecompose(),e.recompose.resume()}render(e=this.appendTo,t=!0){const n=this,{element:r}=n;if(n.emptyCache(),n.syncElement&&n.currentElement)er.sync(r,n.currentElement);else{var i;let t=n.insertBefore;if(n.insertFirst&&(e=n.insertFirst,t=n.insertFirst.firstChild),t){if("string"==typeof t){const e=t;if(t=document.getElementById(t),!t)throw new Error(`No element found with id '${e}'`)}e||(e=t.parentElement)}if("string"==typeof e){const t=e;if(!(e=document.getElementById(e)))throw new Error(`No element found with id '${t}'`)}null===(i=e)||void 0===i||i.insertBefore(r,t),n.currentElement=r}ki.fromElement(r.parentElement)&&er.removeClasses(r,ki.outerCls),n.rendered=!0,t&&(n.getConfig("contentRange"),n.triggerPaint()),n.setupFocusListeners()}template(e){return`<${e.tag} class="${e.html?e.htmlCls:""}" ${e.name?`data-name="${e.name}"`:""}>${e.html||""}</${e.tag}>`}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&null!==(t=this.$meta.$renderConfigs)&&void 0!==t&&t[e]&&this.recompose()}get dataset(){return this.element.dataset}changeDataset(e){Object.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=er.createElement({html:"Â ",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:t}=this;t&&er[e?"removeClasses":"addClasses"](t,ki.outerCls)}get constrainTo(){const e=this._constrainTo;return e===n?window:e}updateCentered(e){const{element:t,_anchorElement:n}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(t.classList.add("b-centered"),t.style.transform=t.style.left=t.style.top="",null==n||n.classList.add("b-hide-display"),t.classList.remove("b-anchored")):t.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,n=e._contentRange||(e._contentRange=r.isIE11?document.createRange():new Range);return n.collapsed&&(n.setStart(t,e.contentRangeStartOffset||0),n.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),n}fixRefOwnerId(e,t,n){if(e.$refOwnerId===n){e.$refOwnerId=t;for(let{childNodes:r}=e,i=r.length;i-- >0;)this.fixRefOwnerId(r[i],t,n)}}updateId(e,t){if(super.updateId(e,t),t){const{byRef:n,element:r}=this;for(const t in n)n[t].dataset&&(n[t].dataset.ownerCmp=e);r.id=e,this.fixRefOwnerId(r,e,t)}}get style(){const{element:e}=this;return e?e.ownerDocument.defaultView.getComputedStyle(e):this._style}updateStyle(e){this.element&&er.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}alignTo(e){var t;const n=this,{lastAlignSpec:i,element:s}=n;if(i&&s.classList.remove(Ii[i.zone]),!e)return n.removeTransientListeners(),void(n.anchor=n.lastAlignSpec=null);(e.nodeType===Element.ELEMENT_NODE||e instanceof ki||"Point"===e.$$name)&&(e={target:e}),n.releaseSizeConstraints();const{scrollable:o,constrainTo:a}=n,l=n.scale||1,c=e.target,d=c&&(c instanceof nn?c:c.element||c),u=nn.from(s,n.positioned?s.offsetParent:null,!0),{width:h,height:g}=u,m=d&&d.nodeType===Element.ELEMENT_NODE,p=(e=Ot.assign({constrainTo:a,align:"b-t",axisLock:n.axisLock,anchor:n.anchor},n.align,e)).minWidth||n.minWidth,f=e.minHeight||n.minHeight;if(u.isAlignRectangle=!0,p&&(u.minWidth=p*l),f&&(u.minHeight=f*l),n.lastAlignSpec=e,m&&d.offsetParent){(e=Object.setPrototypeOf({},e)).target=nn.from(d,n.positioned?s.offsetParent:null,!n.positioned),e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1);const t=n.clippedBy;if(t){const r=e.target.intersect(t);if(!r){const e=n.hide();return n.lastAlignSpec.targetHidden=!0,e}e.target=r}n.anchoredTo=d}else n.anchoredTo=null;if(e.anchor&&(e.anchorSize=n.anchorSize,s.contains(n.anchorPathElement)||s.appendChild(n.anchorElement)),a&&!a.isRectangle&&n.positioned){const t=a===document||a===window;e.constrainTo=nn.from(t?document.body:e.constrainTo,s.offsetParent)}n.isAligning=!0,n.trigger("beforeAlign",e),n.isAligning=!1;const v=u.alignTo(e);let{align:y,anchor:b,x:C,y:w,width:S,height:E}=v;if(n.lastAlignSpec.zone=v.zone,E!=g&&("configuredHeight"in n||(n.configuredHeight=s.style.height),n.height=E/l,n.alignConstrained=1|n.alignConstrained,o&&(o.overflowY=!0)),S!=h&&("configuredWidth"in n||(n.configuredWidth=s.style.width),n.width=S/l,n.alignConstrained=2|n.alignConstrained,o&&(o.overflowX=o.clientWidth>o.scrollWidth)),y&&n.alignConstrained){e.align=y;const t=nn.from(s,n.positioned?s.offsetParent:null,!0).alignTo(e);b=t.anchor,C=t.x,w=t.y,S=t.width,E=t.height}if(n.setXY(C,w),isFinite(v.zone)&&s.classList.add(Ii[v.zone]),null!==(t=b)&&void 0!==t&&t.edge){const{edge:e}=b,{anchorElement:t}=n,r=nn.from(s),i=[];"top"===e||"bottom"===e?(i[0]=b.x,i[1]="top"===e?1:r.height-1):(i[0]="left"===e?1:r.width-1,i[1]=b.y);let o=er.childFromPoint(s,...i);if(o){let e=er.getStyleValue(o,"background-color");for(;e.match(Ci)&&"absolute"!==er.getStyleValue(o,"position");)o=o.parentNode,e=er.getStyleValue(o,"background-color");e.match(Ci)?n.anchorPathElement.setAttribute("fill",n.defaultAnchorBackgroundColor):n.anchorPathElement.setAttribute("fill",e)}t.classList.remove("b-hide-display"),t.style.transform="",t.className=`b-anchor b-anchor-${e}`,b.x&&(b.x/=l),b.y&&(b.y/=l),er.setTranslateXY(t,b.x,b.y),s.classList.add("b-anchored")}else n._anchorElement&&(n.anchorElement.classList.add("b-hide-display"),s.classList.remove("b-anchored"));"hide"!==n.scrollAction||m||(s.style.pointerEvents="none",n.anchoredTo=er.elementFromPoint(C,w),s.style.pointerEvents=""),("realign"===n.scrollAction&&m||"hide"===n.scrollAction)&&!n.documentScrollListener&&(n.clearTimeout(n.scrollListenerTimeout),n.scrollListenerTimeout=n.setTimeout((()=>{n.documentScrollListener=!0,document.addEventListener("scroll",n.doHideOrRealign,!0)}),"hide"===n.scrollAction?n.ignoreScrollDuration:0)),m&&e.monitorResize&&!n.targetResizeListener&&(Zr.addResizeListener(d,n.callRealign),n.targetResizeListener=!0),r.isAndroid||n.constrainListeners||a instanceof nn||(n.clearTimeout(n.resizeListenerTimeout),n.resizeListenerTimeout=n.setTimeout((()=>{n.constrainListeners=!0,Zr.addResizeListener(a||window,n.callRealign)}),n.ignoreScrollDuration))}realign(e){const t=this;if(t.isVisible&&(t.floating||t.positioned)&&t.lastAlignSpec){const n=t.lastAlignSpec.target;if(n&&n.nodeType===Element.ELEMENT_NODE){if(r.isIE11&&!Un(n))return t.hide();const i=ki.fromElement(n),s=nn.from(n),o=(!i||i.isVisible)&&er.isVisible(n);if(s.minHeight=s.minWidth=1,n!==document.body&&!o||e&&e.nodeType===Element.ELEMENT_NODE&&e.contains(n)&&!nn.from(e).intersect(s))return t.hide()}er.addTemporaryClass(t.element,"b-realigning",300),t.alignTo(t.lastAlignSpec)}}rectangle(e,t,n){return"string"!=typeof e?(n=t,t=e,e=""):"border"===e&&(e=""),"boolean"==typeof t&&(n=t,t=null),nn[e||"from"](this.element,t,n)}releaseSizeConstraints(){const e=this,t=e.scrollable;1&e.alignConstrained&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null;if(e&&e.nextSibling){const n=this._toFrontRange||(this._toFrontRange=document.createRange());n.setStartBefore(e.nextSibling),n.setEndAfter(t.lastElementChild),t.insertBefore(n.extractContents(),e)}}updateRef(e){this.element.dataset.ref=e}set clippedBy(e){this._clippedBy=Array.isArray(e)?e:e?[e]:null}get clippedBy(){const e=this._clippedBy;if((null==e?void 0:e.length)>0){let t,n=nn.from(null==e?void 0:e[0],null,!0);for(t=1;t<e.length;t++)n=n.intersect(nn.from(null==e?void 0:e[t],null,!0));return n}}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return"string"==typeof e?{align:e}:e}changeScrollable(e,t){return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):null==t||t.destroy(),e}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const t=this,n=null==e,{element:r,contentElement:i,htmlCls:s}=t;if(r){const o=i===r&&t._anchorElement;s&&s.values.forEach((e=>r.classList[n?"remove":"add"](e))),o&&t.element.removeChild(o),e&&"object"==typeof e?Ur.sync({domConfig:e,targetElement:t.contentElement,onlyChildren:!0}):t.contentElement.innerHTML=n?"":e,o&&r.appendChild(o),t.isComposable?t.recompose():(t.floating||t.positioned)&&(t.isAligning||t.realign())}}updateContent(e){const t=this,n=null==e,{element:r,htmlCls:i}=t;if(r){const{contentRange:s}=t;i&&i.values.forEach((e=>r.classList[n?"remove":"add"](e))),Un(r)?(s.deleteContents(),n||s.insertNode(er.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,!t.floating&&!t.positioned||t.isAligning||t.realign()}}onThemeChange(){var e;null!==(e=this.anchorElement)&&void 0!==e&&e.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const n=parseFloat(er.getStyleValue(e.element,"border-top-width")),r=er.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,{className:s}=i,o=i.firstElementChild,a=e.anchorPathElement=o.lastElementChild,l=e._hidden;i.className="b-anchor b-anchor-top";let c=er.getStyleValue(e.contentElement,"background-color");c.match(Ci)&&(c=er.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,t=i.getBoundingClientRect();const[d,u]=t=e._anchorSize=[t.width,t.height];i.className=s,o.setAttribute("height",u+n),o.setAttribute("width",d),a.setAttribute("d",`M0,${u}L${d/2},0.5L${d},${u}`),n&&(a.setAttribute("stroke-width",n),a.setAttribute("stroke",r)),t[1]-=n,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=an.on({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating&&!(r.isIE11||r.isEdge),n=`${e.id}-shadow-filter`;e._anchorElement=er.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:n,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:`url(#${n})`}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){const t=this,{element:n}=t;var i,s,o;(r.isFirefox||n.setAttribute("draggable",Boolean(e)),e)?(t.dragEventDetacher=Tr.addListener({element:n,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:t}),r.isFirefox&&(t.ffDragDetacher=Tr.on({element:n,mousedown(e){er.up(e.target,".b-field-inner")||n.setAttribute("draggable","true")},thisObj:t}))):(null===(i=t.dragEventDetacher)||void 0===i||i.call(t),null===(s=t.dragOverEventDetacher)||void 0===s||s.call(t),null===(o=t.ffDragDetacher)||void 0===o||o.call(t))}onWidgetDragStart(e){const t=this,{element:n}=t;if(!t.validateDragStartEvent(e))return;t.removeTransientListeners();const i=e.clientX,s=e.clientY,o=document.scrollingElement||document.body,a=t.getXY()[0],l=t.getXY()[1],c={element:t.rootElement,dragover:e=>{n.classList.remove("b-centered"),er.setTranslateXY(n,a+e.clientX-i-o.scrollLeft,l+e.clientY-s-o.scrollTop)}};r.isTouchDevice&&(c.touchmove=e=>e.preventDefault()),t.floatRoot.appendChild(t.dragGhost),t.setDragImage(e),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=Tr.addListener(c),t.alignTo()}validateDragStartEvent(e){const{element:t}=this,n=er.elementFromPoint(e.clientX,e.clientY),{handleSelector:r}=this.draggable;if(r){const i=xi.exec(r)[1];if(i){if(n.closest(`#${t.id} ${i}`))return e.preventDefault(),!1}else if(!n.closest(`#${t.id} ${r}`))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),r.isFirefox&&this.element.removeAttribute("draggable")}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[er.getPageX(this.element),er.getPageY(this.element)]}setXY(e,t){const n=this;(n.floating||n.positioned)&&(null!=e&&(n._x=e,n.centered=!1),null!=t&&(n._y=t,n.centered=!1),er.setTranslateXY(n.element,n._x||0,n._y||0))}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){er.setLength(this.element,"width",e),this._width=null,this._flex=null,this.element.style.flex=""}get maxWidth(){return er.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){er.setLength(this.element,"maxWidth",e)}get minWidth(){return er.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){er.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),"number"!=typeof e&&isNaN(e)||(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove(`b-text-align-${t}`),this.element.classList.add(`b-text-align-${e}`)}updatePlaceholder(e){this.input&&(null==e?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){er.setLength(this.element,"height",e),this._height=null}get maxHeight(){return er.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){const t=this,{element:n}=t;er.setLength(t.maxHeightElement,"maxHeight",e),r.isIE11&&t.contentElement!==n&&(null==e?Zr.removeResizeListener(n,t.boundMaxHeightBugHandler):(Zr.addResizeListener(n,t.boundMaxHeightBugHandler||(t.boundMaxHeightBugHandler=t.fixIEMaxHeightBug.bind(t))),document.body.contains(n)&&t.fixIEMaxHeightBug()))}fixIEMaxHeightBug(){const{element:e,contentElement:t}=this;if("column"===er.getStyleValue(e,"flex-direction")){t.style.maxHeight="";let n=nn.client(e).height;const r=e.childNodes,i=r.length;for(let e=0;e<i;e++){const i=r[e];i===t||i.classList.contains("b-resize-monitors")||(n-=i.offsetHeight)}this.contentElement.style.maxHeight=`${n}px`}}get minHeight(){return er.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){er.setLength(this.element,"minHeight",e)}updateDisabled(e){const t=this,n=t.element,r=t.focusElement;t.trigger("beforeUpdateDisabled",{disabled:e}),e&&t.revertFocus(),n&&(n.classList[e?"add":"remove"]("b-disabled"),r&&(r.disabled=e)),t.onDisabled(e)}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=Yr.request(e.floating?e.floatRoot:e.element);return Yr.onFullscreenChange(e.onFullscreenChange),e.floating||(e.floatRoot._oldParent=e.floatRoot.parentElement,e.element.appendChild(e.floatRoot)),t}exitFullscreen(){return Yr.exit()}onFullscreenChange(){Yr.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){var e,t;const n=this;Yr.unFullscreenChange(n.onFullscreenChange),!n.floating&&null!==(e=n._rootElement)&&void 0!==e&&null!==(t=e.floatRoot)&&void 0!==t&&t._oldParent&&(n.floatRoot._oldParent.appendChild(n.floatRoot),n.floatRoot._oldParent=null)}get tooltip(){if(this._tooltip)return this._tooltip;{var e;const t=null===(e=ki.Tooltip)||void 0===e?void 0:e.getSharedTooltip(this.rootElement);if(t&&t.activeTarget===this._element&&t.isVisible)return t}}changeTooltip(e,t){const n=this;if(e){if(!n.preventTooltipOnTouch||!r.isTouchDevice){if(e.isTooltip||"Object"===e.constructor.name||(e={html:"string"==typeof e?e:n.placeholder,textContent:!0}),!(null!=t&&t.isTooltip||e.newInstance))return n.element.dataset.btip=!0,void(n.tipConfig=e);e.type="tooltip",e.forElement||(e.forElement=n.element),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=ki.reconfigure(t,e,n)}}else if(t){if(null!=e||!t.isTooltip)return void(t.html=null);t.destroy()}else delete n.element.dataset.btip;return e}get tooltipText(){const e=this._tooltip;return e?e.isTooltip?e.contentElement.innerText:"string"==typeof e?e:e.html:this.tipConfig?this.tipConfig.html:void 0}get isVisible(){const e=this,{element:t}=e;return Boolean(t&&!e._hidden&&!e.isDestroying&&Un(t)&&(!e.requireSize||Gn(t))&&(!e.owner||e.owner.isVisible))}focus(){this.isFocusable&&er.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&!this.disabled&&(e===document.body||e.offsetParent)}async show(){return new Promise((e=>{const t=this,{showAnimation:n,element:r}=t,{style:i}=r;let s,o;if(t.isVisible||!1===t.trigger("beforeShow")||t.internalBeforeShow&&!1===t.internalBeforeShow())e();else{if(t.cancelHideShowAnimation(),t.updateCentered(t._centered),t.floating){const e=t.floatRoot;e.contains(r)||(t.rendered?e.appendChild(t.element):t.render(e,!1)),i.transform.includes("scale")&&(t.scale=null,i.transform=i.transformOrigin="");const n=t.closest(Ri);if(n){const{scale:e}=n;t.scale=e,i.transform=`scale(${e})`,i.transformOrigin="0 0"}}if(t._hidden=!1,r.classList.remove("b-hidden"),t.onConfigChange({name:"hidden",value:!1,was:!0,config:t.$meta.configs.hidden}),n){s=Object.keys(n)[0],o=n[s];const a=t.currentAnimation={styleProp:s,resolve:e};t.isAnimating=!0,t.currentAnimation.detacher=Tr.onTransitionEnd({element:r,property:s,duration:Fi(o.duration)+20,handler:()=>t.afterHideShowAnimate(a),thisObj:t}),i[s]=o.from,er.getStyleValue(r,s),i.transition=`${s} ${o.duration} ease ${o.delay}`,i[s]=o.to}t.afterShow(!n&&e),t.inShowBy||!t.floating||!t.forElement||t.centered||t.hidden||t.alignTo(t.forElement)}}))}async showBy(e){const t=this;let n;return t.isVisible?er.addTemporaryClass(t.element,"b-realigning",300):(t.inShowBy=!0,n=t.show(),t.inShowBy=!1),t.isVisible&&t.alignTo(e),n||Ai}async showByPoint(e,t,n){const r=1===arguments.length?e:[e,t];return this.showBy(Object.assign({position:new Cr(r[0]+1,r[1]+1),matchSize:!1,align:"t-b"},n))}afterShow(e){var t,n;const r=this;r.boundMaxHeightBugHandler&&r.boundMaxHeightBugHandler(),r.trigger("show"),r._configuredAnchorState=r.anchor,null===(t=r.parent)||void 0===t||null===(n=t.onChildShow)||void 0===n||n.call(t),r.triggerPaint(),e&&e()}triggerPaint(){const e=this,{element:t}=e,n=!e.isPainted;e.isVisible&&(n&&e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),Zr.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),e.eachWidget(Di,!1),n&&e.isVisible&&(e.rootElement=er.getRootElement(t),e.getConfig("tooltip"),!ki.Ripple&&ki.RippleClass&&(ki.Ripple=new ki.RippleClass({rootElement:e.rootElement}))),e.isPainted=!0,e.trigger("paint",{firstPaint:n}),n&&e.monitorResize&&!e.scaleToFitWidth&&Zr.onElementResize([{target:t}]))}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:n}=e;t&&(e.isAnimating=!1,n.classList.remove("b-hiding"),t.detacher(),t.resolve(),n.style.transition=n.style[t.styleProp]="",e.currentAnimation=null)}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}hide(e=!0){return new Promise((t=>{const n=this,{element:r}=n,{style:i}=r,s=e&&n.hideAnimation;if(n.clearTimeout(n.scrollListenerTimeout),n.clearTimeout(n.resizeListenerTimeout),!n._hidden&&!1!==n.trigger("beforeHide")){if(n._hidden=!0,n.onConfigChange({name:"hidden",value:!0,was:!1,config:n.$meta.configs.hidden}),!r)return void t();if(r.contains(er.getActiveElement(r))&&n.revertFocus(!0),n.isDestroyed)return void t();if(n.cancelHideShowAnimation(),s){const e=Object.keys(s)[0],o=s[e];if(Number(getComputedStyle(n.element)[e])!==o.to){const s=n.currentAnimation={styleProp:e,resolve:t};r.classList.add("b-hiding"),n.isAnimating=!0,n.currentAnimation.detacher=Tr.onTransitionEnd({element:r,property:e,duration:Fi(o.duration)+20,handler:()=>n.afterHideShowAnimate(s),thisObj:n}),i[e]=o.from,er.getStyleValue(r,e),i.transition=`${e} ${o.duration} ease ${o.delay}`,i[e]=o.to}else r.classList.add("b-hidden")}else r.classList.add("b-hidden");n.afterHide(!s&&t,s)}}))}doHideOrRealign(e){var t;const n=this,{anchoredTo:r,lastAlignSpec:i}=n,s=null==i?void 0:i.target,o=null==i?void 0:i.position,a=er.getActiveElement(n),[l,c]=n.getXY();if(!n.element.contains(e.target)&&e.isTrusted&&!((null===(t=e.target)||void 0===t?void 0:t.nodeType)===Element.DOCUMENT_NODE&&n.element.contains(a)&&wi[a]&&window.innerHeight<document.body.offsetHeight)&&(n.realign(e.target),!n.isDestroyed&&"hide"===n.scrollAction)){const[t,i]=n.getXY();(t!==l||i!==c||"Point"===(null==s?void 0:s.$$name)||o)&&(!r||e.target&&er.isDescendant(e.target,r))&&n.hide()}}afterHide(e=null,t=this.hideAnimation){var n,r;const i=this,{lastAlignSpec:s}=i;s&&(s.targetHidden=null),i._anchor=i._configuredAnchorState,i.removeTransientListeners(),t||i.afterHideAnimation(),i.trigger("hide"),null===(n=i.parent)||void 0===n||null===(r=n.onChildHide)||void 0===r||r.call(n),e&&e()}removeTransientListeners(){const e=this;e.clearTimeout(e.resizeListenerTimeout),e.clearTimeout(e.scrollListenerTimeout),e.documentScrollListener&&(document.removeEventListener("scroll",e.doHideOrRealign,!0),e.documentScrollListener=!1),e.targetResizeListener&&(Zr.removeResizeListener(e.lastAlignSpec.target,e.callRealign),e.targetResizeListener=!1),e.constrainListeners&&(Zr.removeResizeListener(e.lastAlignSpec.constrainTo||window,e.callRealign),e.constrainMutationMonitor&&e.constrainMutationMonitor.disconnect(),e.constrainListeners=!1)}afterHideAnimation(){const e=this,{element:t}=e;e.floating&&e.floatRoot.contains(t)?t.remove():t.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let n;return t.isConfiguring?(n=Boolean(e),t.element.classList[e?"add":"remove"]("b-hidden")):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),n}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){let e=this.parent||this._owner;if(!e){var t,n;const r=(null===(t=this.forElement)||void 0===t?void 0:t.nodeType)===Element.ELEMENT_NODE?this.forElement:null===(n=this.element)||void 0===n?void 0:n.parentNode;e=(null==r?void 0:r.closest(".b-widget"))&&ki.fromElement(r)}return e}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const t=this,{parent:n}=t,r=n?n.childItems:Array.from(t.element.parentElement.querySelectorAll(".b-widget"));return n?r[r.indexOf(t)+e]:ki.fromElement(r[r.indexOf(t.element)+e])}up(){const{owner:e}=this;if(e)return e.closest(...arguments)}closest(e,t,n){const r=typeof n,i="number"===r,s="string"===r;for(let r=this,o=1;r;r=r.owner,o++){if(ki.widgetMatches(r,e,t))return r;if(i&&o>=n)return;if(s&&ki.widgetMatches(r,n,t))return;if(r===n)return}}owns(e){if(e){if(e.eventPhase&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=ki.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(!1===e(t))return!1;t=t.owner}return!0}changeMonitorResize(e,t){const n=!this.scaleToFitWidth&&Boolean(e);if(n!==Boolean(t))return n}updateMonitorResize(e){const t=this;Ti.call(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),Zr[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;null===(t=this.element)||void 0===t||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((t=>{"_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly}),!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0){const n=this.childItems,r=n?n.length:0,i={};for(let s=0;s<r;s++){const r=n[s];if(i.down=t,!1===e(r,i))return!1;if(i.down&&r.eachWidget&&!1===r.eachWidget(e,t))return!1}return!0}queryAll(e){const t=[];return this.eachWidget((n=>{e(n)&&t.push(n)})),t}query(e){let t=null;return this.eachWidget((n=>{if(e(n))return t=n,!1})),t}getWidgetByRef(e){var t,n;return e instanceof ki?e:(null==this||null===(t=this.widgetMap)||void 0===t?void 0:t[e])||(null==this||null===(n=this.owner)||void 0===n?void 0:n.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:n}=t;t.containsFocus=!0,t.focusInEvent=e,n.classList.add("b-contains-focus"),n.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=Tr.on({element:n,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.trigger("focusout",e))}captureFocus(){const e=this,t=er.getActiveElement(e),n=e.contains(t)&&e.captureFocusItem(t);return r=>{if(n&&!e.isDestroying){er.getActiveElement(e)!==t&&n(r)}}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():er.focusWithoutScrolling(e))}}contains(e,t){const{element:n}=this;if(e&&n)return e.isWidget&&(e=e.element),n.contains(e)&&(!t||n!==e)}revertFocus(e){var t,n;const r=this,i=er.getActiveElement(r);let s=null===(t=r.focusInEvent)||void 0===t?void 0:t.relatedTarget;(e||r.containsFocus&&(null===(n=s)||void 0===n?void 0:n.nodeType)===Element.ELEMENT_NODE&&r.element.contains(i))&&(s&&er.isFocusable(s)||(s=r.getFocusRevertTarget()),s&&er.isFocusable(s)?er.focusWithoutScrolling(s):null==i||i.blur())}getFocusRevertTarget(){const e=this,{owner:t,focusInEvent:n}=e,r=n&&n.backwards?1:-1;let i=n&&n.relatedTarget;const s=i&&ki.fromElement(i);if(t&&!t.isDestroyed&&(!i||!er.isFocusable(i)||s&&!s.isFocusable)){if(i=null,t.eachWidget){const n=[];if(t.eachWidget((t=>{(t===e||t.isFocusable)&&n.push(t)}),!1),n.length>1){const t=n.indexOf(e);i=n[t+r]||n[t-r]}}!i&&t.isFocusable&&(i=t),i=i?i.focusElement:t.getFocusRevertTarget()}return i}get widgetClassList(){const e=this,t=e.cls,n=e.$meta.hierarchy,i=(null==t?void 0:t.values)||[];for(let t,r,o,a,l=n.indexOf(ki);l<n.length;++l){var s;t=n[l],a=Reflect.getOwnPropertyDescriptor(t.prototype,"widgetClass"),null!==(s=a)&&void 0!==s&&s.get?o=a.get.call(e):(r=Ti.call(t,"$$name")||Ti.call(t,"$name")||Ti.call(t,"_$name")?t.$$name:t.name,(r.length<3||r.includes("$"))&&console.warn(`Class "${r}" which extends "${t.$name}" should have "$name" static getter with no less than 3 chars.`),o=`b-${r.toLowerCase()}`),o&&i.push(...on.normalize(o,"array"))}return e.floating&&i.push("b-floating"),r.isTouchDevice&&i.push("b-touch"),i}changeCls(e){return on.from(e)}changeContentElementCls(e){return on.from(e)}changeHtmlCls(e){return on.from(e)}fromCache(e,t=!1,n=this.element){if(!n)return null;const r=this;return r.cache[e]||(r.cache[e]=t?er.children(n,e):er.down(n,e)),r.cache[e]}emptyCache(){this.cache={}}changeMasked(e,t){if(!0!==e&&""!==e||(e="Â "),t)"string"==typeof e?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const t=ki.resolveType("mask");(e=t.mergeConfigs(this.maskDefaults,e)).owner=this,e=t.mask(e)}return e||null}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,n,r,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e){const t=this,{element:n,scrollable:r}=t,i=t._width,s=t._height,o=n.offsetWidth,a=n.offsetHeight;var l;(t.floating&&t.onFloatingWidgetResize(...arguments),r)&&(null===(l=r.syncOverflowState)||void 0===l||l.call(r));t.suspendResizeMonitor||i===o&&s===a||(t.onInternalResize(n,o,a,i,s),t.trigger("resize",{width:o,height:a,oldWidth:i,oldHeight:s}))}onFloatingWidgetResize(e,t,n){const r=this,{lastAlignSpec:i,constrainTo:s}=r;if(r.isVisible&&i&&i.target){const e=!t||n.height!==t.height,o=!t||n.width!==t.width,a=s&&!nn.from(s).contains(nn.from(r.element,null,!0));(e&&2!==i.zone||o&&1!==i.zone||a)&&r.requestAnimationFrame((()=>r.realign()))}}updateScale(){const e=this,t=e.element,n=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const r=nn.client(n).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(r,1):r;t.style.transform=`scale(${i})`,t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&r>1&&(e.width=e.configuredWidth*r)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const n=e.split(" "),r=n.length;return 1===r?n[1]=n[2]=n[3]=n[0]:2===r?(n[2]=n[0],n[3]=n[1]):3===r&&(n[3]=n[1]),[isFinite(n[0])?`${n[0]}${t}`:n[0],isFinite(n[1])?`${n[1]}${t}`:n[2],isFinite(n[2])?`${n[2]}${t}`:n[3],isFinite(n[3])?`${n[3]}${t}`:n[4]]}get documentRoot(){var e;return(null===(e=this.owner)||void 0===e?void 0:e.documentRoot)||this.element.getRootNode()}get rootElement(){const e=this;if(!e._rootElement){var t;let n=(null===(t=e.owner)||void 0===t?void 0:t.rootElement)||e.forElement instanceof HTMLElement&&er.getRootElement(e.forElement);if(!n){const t=e.element instanceof HTMLElement&&er.getRootElement(e.element);t!==document.body&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE||(n=t)}n||(n=document.body),e._rootElement=n}return e._rootElement}get floatRoot(){var e;const t=this.rootElement||(null===(e=this.owner)||void 0===e?void 0:e.rootElement);let{floatRoot:n}=t;if(n)t.contains(n)||t.appendChild(n);else{var i;const{outerCls:e}=ki,s=null===(i=er.themeInfo)||void 0===i?void 0:i.name;if(!er.isValidFloatRootParent(t))throw new Error("Attaching float root to wrong root");s&&e.push(`b-theme-${s.toLowerCase()}`),n=t.floatRoot=er.createElement({className:`b-float-root ${e.join(" ")}`,parent:t}),bi.push(n),r.isAndroid&&(n.style.height=`${screen.height}px`,Tr.on({element:window,orientationchange:()=>n.style.height=`${screen.height}px`})),!r.isHoverableDevice&&window.visualViewport&&Tr.on({element:window.visualViewport,resize:({target:e})=>n.style.height=`${e.height}px`}),an.on({theme:({theme:e,prev:t})=>{n.classList.add(`b-theme-${e.toLowerCase()}`),n.classList.remove(`b-theme-${t.toLowerCase()}`)}})}return n}static resetFloatRootScroll(){bi.forEach((e=>e.scrollTop=e.scrollLeft=0))}static get floatRoots(){return bi}static removeFloatRoot(e){bi.splice(bi.indexOf(e),1)}static get outerCls(){const e=["b-outer"];return r.isTouchDevice&&e.push("b-touch-events"),er.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),r.isChrome?e.push("b-chrome"):r.isSafari?e.push("b-safari"):r.isFirefox?e.push("b-firefox"):r.isIE11?e.push("b-ie"):r.isEdge&&e.push("b-edge"),window.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this;0===t._isAnimatingCounter&&e?(t.element.classList.add("b-animating"),this.trigger("animationStart")):1!==t._isAnimatingCounter||e||(t.element.classList.remove("b-animating"),this.trigger("animationEnd")),t._isAnimatingCounter+=e?1:-1,t._isAnimatingCounter=Math.max(0,t._isAnimatingCounter)}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,t=!1){const{idMap:n}=ki.identifiable;for(const r in n)if(ki.widgetMatches(n[r],e,t))return n[r];return null}static queryAll(e,t=!1){const{idMap:n}=ki.identifiable,r=[];for(const i in n)ki.widgetMatches(n[i],e,t)&&r.push(n[i]);return r}static fromElement(e,t,n){const r=typeof t;e&&!e.nodeType&&(e=e.target),("number"===r||t&&t.nodeType===Element.ELEMENT_NODE)&&(n=t,t=null);let i,s,o,a=e,l=0;for("number"!=typeof n&&(i=n,n=Number.MAX_VALUE),"string"===r&&(t=t.toLowerCase());a&&a.nodeType===Element.ELEMENT_NODE&&l<n&&a!==i;){if(s=a.dataset&&a.dataset.ownerCmp||a.id,s){if(o=ki.getById(s),o){if(!t)return o;if("function"===r){if(t(o))return o}else if(ki.widgetMatches(o,t,!0))return o}l++}a=a.parentNode}return null}triggerFieldChange(e,t=!0){t&&this.trigger("change",e),this.eachAncestor((t=>{if(t.onFieldChange&&t.onFieldChange(e),t.isolateFields)return!1}))}setupFocusListeners(){an.setupFocusListenersOnce(this._rootElement,Tr)}static widgetMatches(e,t,n){return"*"===t||("function"==typeof t?t(e):ki.isType(e,t,n))}static attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),ki.create(Object.assign({forElement:e},t),"tooltip"),e}}ki.prototype.compose.$nullFn=!0,ki.initClass(),ki.register("mask",yi),er.Widget=ki,an.Widget=ki,yi.identifiable.idMap=ki.identifiable.idMap,Object.assign(window.bryntum||(window.bryntum={}),{get:ki.getById.bind(ki),query:ki.query,queryAll:ki.queryAll,fromElement:ki.fromElement}),ki._$name="Widget";class Oi extends(me.mixin(Be,ui)){static get type(){return"default"}static get configurable(){return{owner:null,containerCls:"b-auto-container",itemCls:null}}static get factoryable(){return{defaultType:"default"}}get contentElement(){var e;return null===(e=this.owner)||void 0===e?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:t,containerCls:n,itemCls:r}=e,{contentElement:i,items:s}=t,o=t.itemCls,a=null==s?void 0:s.length;if(i.classList.add("b-content-element"),n&&i.classList.add(n),a){t.textContent=!1;for(let e=0;e<a;e++){const n=s[e],{element:a}=n;a.dataset.itemIndex=e,r&&a.classList.add(r),o&&a.classList.add(o),a.classList.remove("b-outer"),n.render(i,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const t=this,{element:n}=e,{owner:r,itemCls:i}=t,{contentElement:s}=r,o=r.itemCls;s.contains(n)&&n.remove(),delete n.dataset.itemIndex,i&&n.classList.remove(i),o&&n.classList.remove(o),t.fixChildIndices(),t.syncChildCount()}appendChild(e){const{element:t}=e,{owner:n,itemCls:r}=this,{contentElement:i}=n,s=n.itemCls;t.dataset.itemIndex=n.indexOfChild(e),n.textContent=!1,r&&t.classList.add(r),s&&t.classList.add(s),e.render(i,Boolean(n.isPainted)),this.syncChildCount()}insertChild(e,t){const n=this,{element:r}=e,{owner:i,itemCls:s}=n,{contentElement:o}=i,a=er.getChild(o,`[data-item-index="${t}"]`),l=i.itemCls;i.textContent=!1,s&&r.classList.add(s),l&&r.classList.add(l),o.insertBefore(r,a),e.render(null,Boolean(i.isPainted)),n.fixChildIndices(),n.syncChildCount()}fixChildIndices(){this.owner.items.forEach(((e,t)=>{e.element.dataset.itemIndex=t}))}syncChildCount(){var e;const{owner:t}=this,{length:n}=t.items;null===(e=t.contentElement)||void 0===e||e.classList[1===n?"add":"remove"]("b-single-child")}syncConfigLater(e){const t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}syncConfigStyle(e,t,n){const r=this,{contentElement:i}=r,s=r[e];i?i.style[t]=(null==n?void 0:n[s])||s:r.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:t}=e;let n;if(t)for(e.pendingConfigs=null;n=t.pop();)e[e.$meta.configs[n].updater](e[n])}}Oi.initClass(),Oi._$name="Layout";let Li=0;const Pi=e=>e.ripple;class _i extends ki{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),Tr.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var t;const n=this;n.show();const r=er.getStyleValue(n.circleElement,"animationName");n.hide(),null===(t=n.listenerDetacher)||void 0===t||t.call(n),r&&"none"!==r&&(n.listenerDetacher=Tr.on({mousedown:{element:n.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:n.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:n.circleElement,handler:"onAnimationEnd"},thisObj:n}),"mousedown"===e.type&&(n.onMousedown(e),an.on({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){Li=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-Li>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=ki.fromElement(e.target,Pi);if(t){const n=t.ripple,r=n.delegate?e.target.closest(n.delegate):t.focusElement||t.element;if(r){const i=Ot.assign({event:e,target:r,radius:this.radius},n);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=Tr.getClientPoint(e),target:n=e.target,clip:r=n,radius:i=this.radius,color:s=this.color}){this.clip=r,r=nn.from(r,null,!0);const o=this,a=r.getDelta(t),l=o.rippleElement.style,c=o.circleElement,d=er.getStyleValue(n,"border-radius");o.hide(),o.alignTo(r),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=`${i}px`,o.element.style.borderRadius=d,c.setAttribute("r",i),c.setAttribute("fill",s),o.show(),o.requestAnimationFrame((()=>{document.addEventListener("scroll",o.callRealign,!0),o.documentScrollListener=!0}))}alignTo(e){e.nodeType===Element.ELEMENT_NODE&&(e=nn.from(e,null,!0));const t=this,{x:n,y:r,width:i,height:s}=e;t.x=n,t.y=r,t.height=s,t.width=i}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}realign(){this.isVisible&&this.alignTo(this.clip)}}ki.RippleClass=_i,_i._$name="Ripple";class $i{constructor(e,t){"number"==typeof e?(this._magnitude=e,this._unit=t):("string"==typeof e&&(e=Mt.parseDuration(e)),"object"==typeof e&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=Mt.parseTimeUnit(e)}get isValid(){return null!=this._magnitude&&this._unit}get milliseconds(){return this.isValid?Math.round(Mt.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e&&this.milliseconds===e.milliseconds)}toString(e){const t=this,n=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?`${t._magnitude} ${Mt[n](t._unit,1!==t._magnitude)}`:""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}}$i._$name="Duration";const Hi=(e,t)=>e[t];class ji extends(me.mixin(mi)){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null}}static get configurable(){return{property:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),e.type?"date"===e.type?e.value=new Date(e.value):"duration"===e.type&&(e.value=new $i(e.value)):Mt.isDate(e.value)?e.type="date":e.value instanceof $i&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this._id=this.property||ji.generateId("b-filter"))}set id(e){this._id=e}onChange(e){const t=this;!t.isConfiguring&&t.owner&&!t.owner.isConfiguring&&t.owner.onFilterChanged&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let n;return n=t._propertyItems.length>1?t._propertyItems.reduce(Hi,e):e[t.property],t[t.operator](t.convert(n))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){var t,n;this._value=e,e=null!==(t=null===(n=e)||void 0===n?void 0:n.valueOf())&&void 0!==t?t:e,this._filterValue=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase(),this.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){return this._operator||("string"==typeof this.filterValue?"*":"=")}convert(e){var t,n;"string"==typeof this.filterValue&&e instanceof Date||(e=null!==(t=null===(n=e)||void 0===n?void 0:n.valueOf())&&void 0!==t?t:e);return e=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}"="(e){return Ot.isEqual(e,this.filterValue)}"!="(e){return!Ot.isEqual(e,this.filterValue)}">"(e){return Ot.isMoreThan(e,this.filterValue)}">="(e){return Ot.isMoreThan(e,this.filterValue)||Ot.isEqual(e,this.filterValue)}"<"(e){return Ot.isLessThan(e,this.filterValue)}"<="(e){return Ot.isLessThan(e,this.filterValue)||Ot.isEqual(e,this.filterValue)}"*"(e){return Ot.isPartial(e,this.filterValue)}static generateFiltersFunction(e){return e&&(e.length||e.count)?function(t){let n=!0;for(const r of e)if(r.disabled||(n=r.filter(t)),!n)break;return n}:Se.returnTrue}}ji._$name="CollectionFilter";class Bi extends me{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||Qr.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:n,property:r,useLocaleSort:i}=this,s="desc"===this.direction.toLowerCase()?-1:1;if(e=e[r],t=t[r],n&&(e=n(e),t=n(t)),i&&null!=e&&null!=t){if(!0===i)return String(e).localeCompare(t);if("string"==typeof i)return String(e).localeCompare(t,i);if("object"==typeof i)return String(e).localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*s}static generateSortFunction(e,t){const n=e.isCollection?e.values:e,r=n.length;return(e,i)=>{let s,o;for(o=0;o<r;++o)if(s=n[o].sortFn(e,i),s)return s;return t?t(e,i):0}}}Bi._$name="CollectionSorter";const Ni=()=>0,zi=(e,t)=>t-e,Vi=Symbol("filteredIndicesProperty"),Wi=Object.freeze([]),Gi=Object.freeze({action:"sort",added:Wi,removed:Wi,replaced:Wi}),Ui=Object.freeze({action:"filter",added:Wi,removed:Wi,replaced:Wi}),Yi={string:1,number:1};function qi(e,t,n){if(!1!==t.unique)t.set(n,e);else{let r=t.get(n);r||(r=new Set,t.set(n,r)),r.add(e)}}function Ki(e,t,n,r){for(let i=0;i<e.length;i++){const s=e[i];for(let e=0;e<r;e++){const r=n[e],i=s[r];qi(s,t[r],i)}}}class Xi extends(me.mixin(Be)){static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),null===(e=t._sorters)||void 0===e||e.destroy()}clear(){const e=this,t=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}replaceValues({values:e,filteredValues:t,silent:n=!1,isNewDataset:r=!1}){const i=this;let s,o;if(i.isFiltered&&!r){Boolean(t)?e&&(s=i._values,i._values=e.slice()):(t=e.slice(),e=null),o=i._filteredValues,i._filteredValues=t.slice()}else s=i._values,i._values=e.slice(),t=null,i.isFiltered&&r&&i.autoFilter?(i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction)):i._filteredValues&&(i._filteredValues.length=0);i._indicesInvalid=!0,i.generation++,n||i.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:o,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){for(Array.isArray(e)||(e=[e]);e.length&&e[0]===t;)e.shift();if(!e.length)return;const n=this,{_values:r}=n,i=n.indexOf(e[0],!0);if(1===e.length&&r[i+1]===t)return;n.suspendEvents(),n.remove(e),n.resumeEvents();const s=t?n.indexOf(t,!0):r.length;if(-1===s)throw new Error("Collection move beforeItem parameter must be present in Collection");return r.splice(s,0,...e),n._indicesInvalid=1,n.trigger("change",{action:"move",items:e,from:i,to:s}),s}splice(e=0,t,...n){const r=this,i=r.idProperty,s=r._values,o={},a=[],l=[],c=r.totalCount;let d,u;if(n)if(1===n.length&&Array.isArray(n[0])&&(n=n[0]),c&&n.length){const e=r.indices[i];d=[];for(let t=0;t<n.length;t++){const r=n[t],a=r[i],c=e.get(a),u=c?s.indexOf(c):-1;o[a]=!0,-1!==u?s[u]!==r&&(l.push([s[u],r]),s[u]=r):d.push(r)}}else d=n;if(t){if("number"==typeof t){t=Math.min(t,s.length-e);for(let n=e;t;--t){o[s[n][i]]?(e++,n++):(a.push(s[n]),s.splice(n,1),u=!0)}}else{let e,n=0===d.length;Array.isArray(t)||(t=[t]);const l=t.reduce(((t,i)=>{const s="number"==typeof i,o=s?i:r.indexOf(i,!0);return n&&(null!=e&&o!==e+1||s)&&(n=!1),o>=0&&o<c&&t.push(o),e=o,t}),[]).sort(zi);if(n)l.length&&(a.push.apply(a,t),s.splice(l[l.length-1],l.length),u=!0);else for(let e=0;e<l.length;e++){const t=l[e];if(-1!==t){o[s[t][i]]||(a.unshift(s[t]),s.splice(t,1),u=!0)}}}a.length&&!r._indicesInvalid&&a.forEach(r.removeFromIndices,r)}d.length&&(s.splice(Math.min(e,s.length),0,...d),u=!0,r._indicesInvalid||d.forEach(r.addToIndices,r)),l.length&&!r._indicesInvalid&&l.forEach((e=>{r.removeFromIndices(e[0]),r.addToIndices(e[1])})),u||l.length?(r.isSorted?r.onSortersChanged():r.isFiltered&&(r.autoFilter?r.onFiltersChanged():r._filteredValues.push(...d)),r.generation++,r.trigger("change",{action:"splice",removed:a,added:d,replaced:l,oldCount:c})):r.trigger("noChange",{index:e,toRemove:t,toAdd:n})}changeId(e,t){const n=this,{idProperty:r}=n,i=Yi[typeof e]?e:e[r],s=n.get(i);if(s){const o=n.get(t);if(o&&s!==o)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);n.removeIndexEntry(e,r,i),n.addIndexEntry(e,r,t),s[r]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,n=!1){return this.findItem(e,t,this.isFiltered&&n)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new Xi({values:Array.isArray(e)?e:[e],listeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof Bi?e:new Bi(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean(null===(e=this._sorters)||void 0===e?void 0:e.count)}onSortersChanged(){const e=this;delete e._sortFunction,e._values.sort(e.sortFunction),e.trigger("change",Gi)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=Bi.generateSortFunction(this.sorters.values):this._sortFunction=Ni),this._sortFunction}get filters(){return this._filters||(this._filters=new Xi({listeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof ji?e:new ji(e);return this.filters.add(t),t}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged(){const e=this;e._filterFunction=null,e._filteredValues=e._values.filter(e.filterFunction),e._indicesInvalid=!0,e.trigger("change",Ui)}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=ji.generateFiltersFunction(this.filters.values):this._filterFunction=Se.returnTrue),this._filterFunction}changeExtraKeys(e){return(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{property:e,unique:!0}:e))}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){e&&((this._indices||(this._indices={}))[e.property]=new Map,Object.assign(this._indices[e.property],e),this.invalidateIndices())}findIndex(e,t,n=!1){const r=this.findItem(e,t,n);if(!r)return-1;return(this.isFiltered&&!n?this._filteredValues:this._values).indexOf(r)}findItem(e,t,n=!1){const r=this,{isFiltered:i}=r,s=i&&!n?r.indices[Vi][e]:r.indices[e];if(s){var o;const e=null!==(o=s.get(t))&&void 0!==o?o:"string"==typeof t&&t.length&&!isNaN(t)&&s.get(Number(t))||null;if(null!=e)return e}else{const s=i&&!n?r._filteredValues:r._values,o=s.length;for(let n=0;n<o;n++){const r=s[n];if(r[e]==t)return r}}return null}removeIndex(e){delete this._indices[e]}indexOf(e,t=!1){return this.findIndex(this.idProperty,Yi[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some((e=>this.includes(e))):Boolean(this.findItem(this.idProperty,Yi[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,n=e._indices||(e._indices={}),r=Object.keys(n),i=r.length,s=e._values;let o;t&&(o=n[Vi]={});for(let e=0;e<i;e++){const i=n[r[e]];if(i.clear(),t){let t=o[r[e]];t?t.clear():(t=o[r[e]]=new Map,t.unique=i.unique)}}Ki(s,n,r,i),t&&Ki(e._filteredValues,o,r,i),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[Vi][e]),t}addToIndices(e){Object.keys(this.indices).forEach((t=>{this.addIndexEntry(e,t,e[t])}))}removeFromIndices(e){Object.keys(this.indices).forEach((t=>{this.removeIndexEntry(e,t,e[t])}))}removeIndexEntry(e,t,n){this.getIndices(t).forEach((t=>function(e,t,n){!1!==t.unique?t.delete(n):t.has(n)&&(t.get(n).delete(e),t.get(n).size||t.delete(n))}(e,t,n)))}addIndexEntry(e,t,n){this.getIndices(t).forEach((t=>qi(e,t,n)))}onItemMutation(e,t){!this._indicesInvalid&&Object.keys(this.indices).length>1&&Object.keys(t).forEach((n=>{if(this.indices[n]){const{value:r,oldValue:i}=t[n];this.removeIndexEntry(e,n,i),this.addIndexEntry(e,n,r)}}))}}Xi._$name="Collection";const Zi=new WeakMap,Ji=e=>{if(e&&"object"==typeof e){let t=Zi.get(e);t===n&&(t=Symbol("bscik"),Zi.set(e,t)),e=t}return e};class Qi{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[Ji(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:n,idMap:r,idProperty:i}=t,s=e.length;for(let o=0;o<s;o++){const s=e[o],a=Yi[typeof s]?s:Ji(s[i]),l=r[a];null==l?(r[a]=s,n.add(s),t.generation++):l!==s&&(r[a]=s,n.delete(l),n.add(s))}}remove(e){Array.isArray(e)||(e=[e]);const{items:t,idMap:n,idProperty:r}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],o=Yi[typeof i]?i:Ji(i[r]),a=n[o];null!=a&&(t.delete(a),delete n[o],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let t,n=0;for(t of this.items)e(t)&&++n;return n}changeId(e,t){const n=this,{idMap:r,idProperty:i}=n,s=Yi[typeof e]?e:Ji(e[i]),o=n.get(s);if(o){const e=n.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);o[i]=t,delete r[s],r[t]=o}}includes(e){const t=Yi[typeof e]?e:Ji(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:n}=this,r=new Array(n.size);let i=0;return n.forEach((s=>{r[i]=e.call(t,s,i++,n)})),r}forEach(e,t){return this.items.forEach(e,t)}find(e,t=0){let n,r;for(n of(t<0&&(t=this.countOf(e)+t),this.items))if(e(n)&&!t--){r=n;break}return r}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,t){let n,r=-1;for(n of this.items)if((!t||t(n))&&(++r,n===e))return r;return-1}get values(){return[...this.items]}set values(e){Array.isArray(e)||(e=[e]),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}}Qi._$name="Bag";const es=Object.freeze({}),{isArray:ts}=Array,ns=e=>e.weight,rs=({weight:e},{weight:t})=>"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):(null!=e?e:Number.MAX_SAFE_INTEGER)-(null!=t?t:Number.MAX_SAFE_INTEGER),is=e=>e&&!e.hidden,ss=["display","flex-direction"];class os extends ki{static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,autoUpdateRecord:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1}}static get prototypeProperties(){return{initialItems:!0}}startConfigure(e){const t=e.items||e.lazyItems;(this.hasItems=Boolean(t&&(ts(t)?t:Object.keys(t)).length))||(this.initialItems=!1),super.startConfigure(e)}remove(...e){let t=!0;1===e.length&&(ts(e[0])?e=e[0]:t=!1);const n=this,{_items:r}=n,i=[];for(let t=0;t<e.length;t++){const s=e[t];r.includes(s)&&(r.remove(s),n.layout.removeChild(s),i.push(s),n.onChildRemove(s))}return t?i:i[0]}removeAll(){return this.remove(this.items)}add(...e){const t=this,n=[];let r,i,s,{_items:o}=t,a=!0;for(1===e.length&&(ts(e[0])?e=e[0]:a=!1),o||(t.items=[],o=t._items),i=0;i<e.length;i++){var l;r=e[i],null!=(null===(l=r)||void 0===l?void 0:l.weight)?(s=Ce.findInsertionIndex(r,o.values,rs),n.push(t.insert(r,s))):r&&(r.isWidget?r.parent=t:r=t.createWidget(r),o.includes(r)||(o.add(r),t.onChildAdd(r),t.layout.appendChild(r),n.push(r)))}return a?n:n[0]}insert(e,t){this.items||(this.items=[]);const n=this,{_items:r}=n;e instanceof ki?e.parent=n:e=n.createWidget(e),r.includes(t)&&(t=n.indexOfChild(t)),t=Math.min(t,r.count);const i=r.values;return i.splice(t,0,e),r.values=i,n.onChildAdd(e),n.layout.insertChild(e,t),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,t){const n=this,r=[],i=new Qi;return ts(e)?n.processItemsArray(e,r):e&&n.processItemsObject(e,n.namedItems,r),r.some(ns)&&r.sort(rs),i.add(r),t&&t.forEach((e=>{n.remove(e),i.includes(e)||e._createdBy!==n||e.destroy()})),i}updateItems(e,t){let n=0;e.forEach((e=>{this.onChildAdd(e),t&&!t.temporary&&this.layout.insertChild(e,n),++n})),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new Qi,e._items.temporary=!0}return e._items.values}processItemsArray(e,t){const n=e.length;let r,i;for(r=0;r<n;r++)i=e[r],i instanceof ki?(i.parent=this,er.removeClasses(i.element,ki.outerCls)):i=this.createWidget(i),i&&((i.ref||i.id)&&this.addDescendant(i),t.push(i))}processItemsObject(e,t=es,n){let r,i;for(i in e)r=e[i],r&&(i in t&&(r="object"==typeof r?Ot.merge(Ot.clone(t[i]),r):t[i]),r&&(r instanceof ki?r.parent=this:(r instanceof Object&&(r.ref=i),r=this.createWidget(r)),r&&(r.ref=i,this.addDescendant(r),n.push(r))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let t=this;t;t=t.parent)t.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(){this.syncChildCount(!0)}onChildShow(){this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const t=this,{childItems:n,hasItems:r}=t,{length:i}=n,s=n.filter(is),{length:o}=s;if(t.hideWhenEmpty&&e){const e=Boolean(!o);Boolean(t._hidden)!==e&&(t.hidden=e)}for(let e=0;e<i;e++)n[e].element.classList.remove("b-last-visible-child"),n[e].element.classList.remove("b-first-visible-child");o&&(s[0].element.classList.add("b-first-visible-child"),s[o-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(i),t.contentElement.classList[o?"remove":"add"]("b-no-visible-children"),t.isComposable?r!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}syncFlexDirection(){const{contentElement:e}=this,t=new on(e.className),n=er.getStyleValue(e,ss);t["b-flex-row"]=t["b-flex-column"]=0,"flex"===n.display&&(t[`b-flex-${n["flex-direction"]}`]=1),er.syncClassList(e,t)}addDescendant(e){const t=e.ref||e.id,n=this._widgetMap||(this._widgetMap={});n[t]||(n[t]=e)}onChildRemove(e){const t=e.ref||e.id;if(t)for(let n=this;n;n=n.parent)n.widgetMap[t]===e&&delete n.widgetMap[t];this.layout.onChildRemove(e),this.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=null==e?es:null,e}updateRecord(e){this.trigger("beforeSetRecord",{record:e}),this.setValues(e,!0,!this.$highlight)}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onFieldChange({source:e,userAction:t}){if(this.autoUpdateRecord){const{record:n}=this,{name:r,isValid:i,value:s}=e;n&&t&&r&&i&&(n[r]=s)}}getValues(e){const t={};return this.eachWidget(((n,r)=>{n.isolateFields?r.down=!1:!("name"in n)||e&&!e(n)||(t[n.name]=n.value)}),!0),t}get hasNoChildren(){const e=this,{items:t,lazyItems:n}=e.initialConfig,r=t&&(ts(t)?t:Ot.values(t)),i=n&&(ts(n)?n:Ot.values(n)),s=e.isConfiguring?i||r:e.items;return!(null!=s&&s.filter(is).length)}afterRecompose(){this.realign()}updateTextContent(e){const t=this;t.isComposable||(t.contentElement.classList[e&&t.hasNoChildren?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}updateLayoutStyle(e){er.applyStyle(this.contentElement,e)}onPaint(){var e;null===(e=super.onPaint)||void 0===e||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){const t=this,{element:n,contentElement:r}=t;(e=new MutationObserver((e=>t.onContentElMutation(e)))).observe(r,{attributes:!0}),r!==n&&e.observe(n,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(){this.isVisible&&this.syncFlexDirection()}changeLayout(e,t){return Oi.reconfigure(t,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const n=this;"string"==typeof e?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&(t=ki.resolveType(t,!0));for(let r=(e=(t||ki).mergeConfigs(n.defaults,e,{parent:n})).parent;r;r=r.parent)if(!1===r.processWidgetConfig(e))return null;return!1===n.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}createWidget(e){const t=ki.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}updateDefaults(e,t){if(!this.isConfiguring){const n=Object.entries(e);this.eachWidget((e=>{n.forEach((([n,r])=>{e[n]===t[n]&&(e[n]=r)}))}),!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(e=>e.isFocusable&&"close"!==e.ref));return e?e.focusElement:super.focusElement}doDestroy(){var e;null===(e=this._items)||void 0===e||e.forEach((e=>{var t;return null===(t=e.destroy)||void 0===t?void 0:t.call(e)})),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget((t=>{"isValid"in t&&!t.isValid&&(e=!1)}),!0),e}get values(){const e={};return this.eachWidget(((t,n)=>{t.isolateFields?n.down=!1:"value"in t&&(e[t.name||t.ref||t.id]=t.value)}),!0),e}set values(e){this.setValues(e)}get isSettingValues(){var e;return Boolean(this._isSettingValues||(null===(e=this.parent)||void 0===e?void 0:e.isSettingValues))}setValues(e,t=!1,n=!0){this._isSettingValues={preventHighlight:n},this.eachWidget(((r,i)=>{const s=r.highlightExternalChange,o=t?r.name:r.name||r.ref||r.id;"value"in r&&o&&(n&&(r.highlightExternalChange=!1),r.value=e&&o in e?e[o]:null,r.highlightExternalChange=s),r.isolateFields&&(i.down=!1)}),!0),this._isSettingValues=!1}}os.initClass(),os._$name="Container";const as=Symbol("pendingCreate");class ls extends me{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get:(t,n)=>e.get(n),set:(t,n,r)=>(e.set(n,r),!0),deleteProperty:(t,n)=>(e.set(n,null),!0)})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){const n=this,{transform:r}=n,i=r?r(t,e):t,s=Ot.isInstantiated(i);n.instances[e]=as,s||n.setDefaults(e,i),n.defineProp(e,!0),s&&n.set(e,i)}defineProp(e,t){const n=this,{object:r}=n;n.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(r):r,e,{configurable:!t,enumerable:!0,get:()=>n.get(e),set:t=>n.set(e,t)})}flush(){const e=this;try{var t;e.updating=!0;for(const t in e.defaults)e.get(t);e.afterConfigureOwner=null===(t=e.afterConfigureOwner)||void 0===t?void 0:t.call(e)}finally{e.updating=!1}}get(e){const{defaults:t,instances:n}=this;return n[e]===as&&this.set(e,as),n[e]||t[e]&&null}set(e,t){const n=this,{cleanup:r,configName:i,defaults:s,factory:o,instances:a,owner:l,setup:c,transform:u,updating:h}=n,g=l&&i&&!h,m=a[e]===as?null:a[e],p=o.reconfigure(m,t===as?{}:t||null,{cleanup:r&&(t=>r(t,e)),defaults:s[e]||n.setDefaults(e,{}),owner:n.owner,setup:c&&((t,n,r)=>c(t,e,n,r)),transform:u&&(t=>u(t,e))});if(p!==m){const t=g&&d({},a);var f;if(a[e]=p,p)n.defineProp(e),null===(f=n.created)||void 0===f||f.call(n,p,e);else delete n.object[e],delete a[e];g&&l.onConfigChange({name:i,config:l.$meta.configs[i],value:n.target,was:t})}}setDefaults(e,t){const{defaults:n,factory:r,inferType:i,instances:s,owner:o,ownerName:a}=this,{typeKey:l}=r.factoryable;return t=!0===t?{}:Ot.assign({},t),("name"===i||!0===i&&!t[l])&&(t[l]=e),a&&(t[a]=o),t.beforeConfigure=t=>{s[e]=t},n[e]=t}update(e){const t=this,{owner:n}=t;let r,i;try{if(t.updating=!0,e)for(r in e)i=e[r],t.defaults[r]?t.set(r,i):i&&t.define(r,i);else for(r in t.instances)t.set(r,null)}finally{t.updating=!1}n&&(n.isConfiguring?t.afterConfigureOwner||(t.afterConfigureOwner=Se.before(n,"afterConfigure","flush",t)):t.flush())}}ls.initClass(),ls._$name="DynamicObject";const cs=/^(?:undefined|null|LEFT|RIGHT)$/,ds={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},us=e=>{const t=null==e?void 0:e.toUpperCase();return[t,"LEFT"===t||"RIGHT"===t]};var hs=e=>class extends(e||me){static get $name(){return"Rotatable"}static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:e}=this;return{class:{[`b-rotate-${(e||"").toLowerCase()}`]:e,"b-rotate-vertical":e}}}syncRotationToDock(e){if(cs.test(String(this.rotate))){const[t,n]=us(e);this.rotate=n?this.invertRotate?ds[t]:t:null}}get widgetClass(){return null}};class gs extends(ki.mixin(hs)){static get $name(){return"Tool"}static get type(){return"tool"}static get configurable(){return{align:{value:null,$config:{merge:"replace"}},repeat:null,ariaLabel:null}}compose(){const{align:e,ariaLabel:t}=this;return{tag:"button",class:{[`b-align-${e||"end"}`]:1,"b-icon":1},"aria-label":t,listeners:{click:"onClick"}}}get focusElement(){return this.element}get panel(){return this.parent}changeAlign(e){return e}onClick(e){const{handler:t,panel:n}=this;!1!==(null==n?void 0:n.trigger("toolclick",{domEvent:e,tool:this}))&&t&&this.callback(t,n,[e])}onInternalKeyDown(e){"Enter"===(e.key.trim()||e.code)&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,t){var n;super.updateDisabled(e,t),e&&(null===(n=this.repeat)||void 0===n||n.cancel())}changeRepeat(e,t){return null==t||t.destroy(),e&&Fr.new({element:this.element},e)}}gs.initClass(),gs._$name="Tool";const ms=[],ps=(e,t)=>{const n={};if(e)for(let r,i=0;i<e.length;++i)r=e[i],n[r.ref]=t?r.element:r;return n},fs={align:1,weight:1};var vs=e=>class extends(e||ki){static get $name(){return"Toolable"}static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"},close:{weight:-1e3},collapse:{weight:-990}}}}byWeightSortFn(e,t){return(e.weight||0)-(t.weight||0)}byWeightReverseSortFn(e,t){return(t.weight||0)-(e.weight||0)}get childItems(){return[...this.startTools,...this._items||ms,...this.endTools]}get endTools(){return Ot.values(this.tools,((e,t)=>{var n,r;return"end"!==(null!==(n=null==t||null===(r=t.align)||void 0===r?void 0:r.align)&&void 0!==n?n:null==t?void 0:t.align)})).sort(this.byWeightReverseSortFn)}get endToolRefs(){return ps(this.endTools)}get endToolElementRefs(){return ps(this.endTools,!0)}get startTools(){return Ot.values(this.tools,((e,t)=>{var n,r;return"start"!==(null!==(n=null==t||null===(r=t.align)||void 0===r?void 0:r.align)&&void 0!==n?n:null==t?void 0:t.align)})).sort(this.byWeightSortFn)}get startToolRefs(){return ps(this.startTools)}get startToolElementRefs(){return ps(this.startTools,!0)}changeTools(e,t){const n=this,r=n.$tools||(n.$tools=new ls({configName:"tools",factory:ki,inferType:!1,owner:n,created(e){var t,i;e.innerItem=!1,null===(t=e.syncRotationToDock)||void 0===t||t.call(e,null===(i=n.header)||void 0===i?void 0:i.dock),Se.after(e,"onConfigChange",((e,{name:t})=>{fs[t]&&n.onConfigChange({name:"tools",value:r.target})})),n.onChildAdd(e)},setup:(e,t)=>((e=Ot.merge({},n.toolDefaults["*"],n.toolDefaults[t],e)).parent=n,e.ref=t,e)}));if(r.update(e),!t)return r.target}};const ys=["b-hbox","b-vbox"],bs={false:"nowrap",true:"wrap",reverse:"wrap-reverse"};class Cs extends Oi{static get $name(){return"Box"}static get type(){return"box"}static get alias(){return"hbox"}static get configurable(){return{itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null}}get vertical(){return!1===this.horizontal}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle("align","alignItems")}updateContentAlign(){this.syncConfigStyle("contentAlign","alignContent")}updateDirection(){this.syncConfigStyle("direction","flexDirection")}updateHorizontal(){var e;const t=this,n=null===(e=t.contentElement)||void 0===e?void 0:e.classList,r=Number(t.vertical);n?(n.remove(ys[1-r]),n.add(ys[r])):t.syncConfigLater("horizontal"),t.syncDirection()}updateJustify(){this.syncConfigStyle("justify","justifyContent")}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle("wrap","flexWrap",bs)}syncDirection(){const e=this,{reverse:t}=e;e.direction=t?`${e.vertical?"column":"row"}${t?"-reverse":""}`:null}}Cs.initClass(),Cs._$name="Box";class ws extends Cs{static get $name(){return"VBox"}static get type(){return"vbox"}static get configurable(){return{horizontal:!1}}}ws.initClass(),ws._$name="VBox";var Ss=e=>class extends(e||me){static get $name(){return"Badge"}static get configurable(){return{badge:null}}compose(){const{badge:e}=this;return{dataset:{badge:e},class:{"b-badge":null!=e&&""!==e}}}};const Es=/(?:^|\s)b-icon-/,Ds=/(?:^|\s)b-fa-/,xs=Symbol("defaultToggleable");class Rs extends(ki.mixin(Ss,hs)){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,pressedIcon:null,iconAlign:"start",text:{value:null,$config:null,default:""},color:null,toggleable:xs,pressed:!1,toggleGroup:null,ripple:{radius:75},defaultBindProperty:"text",localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,onMenuHideTimeout:300,testConfig:{onMenuHideTimeout:0}}}compose(){const{color:e,href:t,icon:n,iconAlign:r,pressed:i,pressedIcon:s,target:o,text:a,toggleable:l,toggleGroup:c}=this,u=i&&s?s:n;return{tag:t?"a":"button",href:t,target:o,class:{[`b-icon-align-${r}`]:n,[e]:Boolean(e),"b-pressed":i&&l,"b-text":Boolean(a)},dataset:{group:c},listeners:{click:"onInternalClick"},children:{iconElement:(n||s)&&{tag:"i",class:d(d({},on.normalize(u,"object")),{},{"b-icon":Es.test(u),"b-fa":Ds.test(u)})},label:a&&{tag:"label",text:a}}}}onHide(){var e;null===(e=this._menu)||void 0===e||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var t;super.onFocusOut(e),null===(t=this.menu)||void 0===t||t.hide()}get focusElement(){return this.element}changeText(e){return null==e?"":e}changeToggleable(e){return e===xs?this.toggleGroup||this.config.menu:e}changeMenu(e,t){const n=this;if(e){const r=()=>!n.isDestroying&&n.setTimeout((()=>n.toggle(!1)),n.onMenuHideTimeout);e.isWidget?(e.forElement=n.element,e.owner=n,e.on("hide",r)):("object"!=typeof e||"type"in e||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),e=ki.reconfigure(t,e?j.merge({constrainTo:n.rootElement,forElement:n.element,owner:n,onHide:r},n.menuDefaults,e):null,n))}else t&&t.destroy();return e}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){const t=this;!t.isConfiguring&&e&&t.toggleGroup&&er.forEachSelector(t.rootElement,`button[data-group=${t.toggleGroup}]`,(e=>{e!==t.element&&ki.getById(e.id).toggle(!1)}))}onInternalClick(e){const t=this,n={event:e};if(t.toggleable){if(t.toggleGroup&&t.pressed)return;if(t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",n),t.isDestroyed||t.trigger("action",n),t.href||(e.preventDefault(),e.stopPropagation())}toggle(e=null){const t=this,{menu:n}=t;if(t.toggleable&&(null===e&&(e=!t.pressed),t.pressed!==e)){var r,i;if(t.toggling=!0,t.pressed=e,n)n.initialConfig.minWidth||(n.minWidth=t.width),n.align.constrainTo=window,n.align.constrainPadding=10,n.align.minHeight=null!==(r=n._minHeight)&&void 0!==r?r:100,n.align.minWidth=null!==(i=n._minWidth)&&void 0!==i?i:100,n[e?"show":"hide"]();t.trigger("toggle",{pressed:e}),t.toggling=!1}}}Rs.initClass(),Rs._$name="Button";const Ts=e=>e.isToolbar,Ms=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],Fs={delay:0,startRate:40,endRate:200,accelerateDuration:500};class As extends(os.mixin(vs)){static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:"menu"},toolDefaults:{overflowMenuButton:{type:"button",icon:"b-icon-menu",hidden:!0},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0}},widgetCls:null}}compose(){const{axisProps:e,dock:t,endToolElementRefs:n,startToolElementRefs:r}=this;return{class:{[`b-dock-${t}`]:1,[`b-${t}-toolbar`]:1,[`b-${e.box}`]:1},children:d(d({},r),{},{toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}}},n)}}get axisProps(){return Ms[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return null===(e=this.tools)||void 0===e?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return"string"==typeof e?e:null==e?void 0:e.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),null===(t=e.syncRotationToDock)||void 0===t||t.call(e,this.dock)}processAddedLeafItem(e){Se.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget((e=>this.processAddedLeafItem(e)))}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){const t=this,{layout:n}=t,{vertical:r}=n;if(n.vertical=us(e)[1],!t.initialItems){r!==n.vertical&&t.updateOverflow(t.overflow);for(const n of t.childItems){var i;null===(i=n.syncRotationToDock)||void 0===i||i.call(n,e)}}}updateOverflow(e,t){var n;const r=this,{axisProps:i,contentElement:s,overflowType:o}=r,{flexDir:a}=i,l=null===(n=r.overflowMenuButton)||void 0===n?void 0:n._menu,c={};var d;if(l&&(e?null==l||l.removeAll():l.eachWidget((e=>{e._toolbarOverflowOriginal._toolbarOverflowClone=null}))),"menu"===t?c.overflowMenuButton=null:"scroll"===t&&(c.overflowScrollStart=c.overflowScrollEnd=null),"menu"===o)null===(d=r.scrollable)||void 0===d||d.destroy(),s.style.overflow=s.style.overflowX=s.style.overflowY="",c.overflowMenuButton={cls:{[`b-${a}-menu`]:1,"b-overflow-button":1}};else if("scroll"===o){const t="object"==typeof e&&(null==e?void 0:e.repeat)||Fs;r.scrollable={[i.overflow]:"hidden-scroll",element:s,listeners:{scroll:"onContentScroll",thisObj:r}},c.overflowScrollStart={repeat:t,invertRotate:!0,cls:{[`b-${a}-start-scroller`]:1,"b-icon-angle-left":1,"b-overflow-button":1,"b-icon":1}},c.overflowScrollEnd={repeat:t,invertRotate:!0,cls:{[`b-${a}-end-scroller`]:1,"b-icon-angle-right":1,"b-overflow-button":1,"b-icon":1}}}r.tools=c,o?(s.classList.add("b-overflow"),r.monitorResize=!0,r.syncOverflowVisibility()):(s.classList.remove("b-overflow"),r.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:n,isVisible:r}=e,{clientSizeProp:i,edgeProp:s,sizeProp:o}=e.axisProps,{overflowMenuButton:a,overflowScrollStart:l,overflowScrollEnd:c}=e.tools,d="menu"===t;if(!r||!t)return;e.inSyncOverflowVisibility=!0,null==a||a.hide();let u,h,g,m,p=0;if(e.eachWidget(((e,t)=>{e.floating?t.down=!1:(t.down=!(g=e.overflowable),g&&e.innerItem&&(e._toolbarOverflow&&(e.hidden=e._toolbarOverflow=!1),e.isVisible&&((m||(m=[])).push(e),++p)))})),m&&(h=m[--p].rectangle(n),u=Math.ceil(n[i]+(!l||l.hidden?0:l.rectangle("outer")[o])+(!c||c.hidden?0:c.rectangle("outer")[o]))),m&&Math.floor(h[s])>u)if(d){for(a.show(),u=n[i];p-- >0&&(h=m[p].rectangle(n),!(Math.floor(h[s])<=u)););e.syncOverflowMenuButton(m.slice(p+1))}else c.show(),l.show(),e.syncScrollerState();else d||(null==c||c.hide(),null==l||l.hide());e.inSyncOverflowVisibility=!1}syncOverflowMenuButton(e){var t;const n=this,{axisProps:r,overflowMenuButton:i}=n,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:r.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};for(let t,n=0,{length:r}=e;n<r;n++)t=e[n],t._toolbarOverflowWidth=t.width,t._toolbarOverflow=!0,t.hidden=!0;if(n.addToMenu(s,e.filter((()=>n.overflowItemFilter))),null!==(t=i._menu)&&void 0!==t&&t.isMenu){const e=i.menu,{toAdd:t,toRemove:n}=Ce.delta(s.items,e.items,1);if(e.remove(n),e.items.length)for(let n=t.length-1;n>=0;n--)e.insert(t[n],0);else e.add(t)}else i.menu=s}syncScrollerState(){const{axisProps:e,scrollable:t}=this,{overflowScrollStart:n,overflowScrollEnd:r}=this.tools,i=t[e.pos],s=t[e.max];n.disabled=!i,r.disabled=Math.ceil(i)>=s}overflowItemFilter(e){const t=Boolean(er.getChildElementCount(e)),{filter:n}=this.overflow;return t&&(n?n(e):1)}addToMenu(e,t){const{horizontal:n}=this;for(let r=0,{length:i}=t;r<i;r++){const i=t[r];let s=i._toolbarOverflowClone,o=i.constructor;if(!s){const e=j.clone(i.initialConfig);delete e.id,e.width="",n&&(e.flex=""),e.minWidth=i._toolbarOverflowWidth,e.type=i.type,e._toolbarOverflowOriginal=i,e.disabled=i.disabled,"value"in i&&(e.value=i.value),"button"===e.type&&(e.text||(e.text=i.tooltipText)),i._toolbarOverflowClone=s=o.create(e),s.element.style.margin="",i.isField&&s.on({change:this.onFieldCloneChange})}e.items.push(s)}}onFieldCloneChange({source:e,value:t}){e._toolbarOverflowOriginal.value=t}onLeafItemConfigChange(e,{name:t,value:n}){const r=this,i=r.up(Ts),{_toolbarOverflowClone:s}=r;null!=i&&i.inSyncOverflowVisibility||"hidden"===t&&n===r._toolbarOverflow||(s&&(s[t]=n),null!=i&&i.isPainted&&"overflowMenuButton"!==r.ref&&i.syncOverflowVisibility())}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}}As.initClass(),As._$name="Toolbar";const Is=e=>!e.classList.contains("b-focus-trap")&&er.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,ks=e=>e.element,Os=[],Ls=[Os,Os],Ps=(e,t)=>({children:e.children,class:{[`b-${e.vertical?"v":"h"}box`]:1,"b-box-center":1,"b-panel-bar-wrap":!t}}),_s=(e,t=!1)=>({vertical:t,children:e?[e]:[]}),$s={dock:1,hidden:1,weight:1},Hs={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},js={header:1,"pre-header":1};Is.acceptNode=Is;class Bs extends(os.mixin(vs)){static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],bodyCls:{$config:{merge:"classList"},value:null},trapFocus:null,title:null,header:null,stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:{nullify:!0}},footer:null,tbar:null,bbar:null}}compose(){const e=this,{focusable:t,hasItems:n}=e,r=e.composeBody(),i=e.composeHeader();return{tabIndex:n&&!1!==t||t?0:null,class:{[`b-${(null==i?void 0:i.class["b-dock-left"])||(null==i?void 0:i.class["b-dock-right"])?"h":"v"}box`]:1},children:{topFocusTrap:{tabIndex:0,class:{"b-focus-trap":1}},headerElement:i,bodyWrapElement:r,bottomFocusTrap:{tabIndex:0,class:{"b-focus-trap":1}}}}}composeBody(){const e=this,{bodyCls:t,bodyConfig:n,footer:r}=e,i=Ot.values(e.strips,((e,t)=>!Hs[null==t?void 0:t.dock])).sort(e.byWeightSortFn);let s,o,a,l,c,d,u;for(r&&(a=r.dock||"bottom",i.unshift({dock:a,element:{tag:"footer",reference:"footerElement",html:"string"==typeof r?r:r.html,class:{[`b-dock-${a}`]:1,[`${r.cls||""}`]:1}}})),t&&(n[c="className"]||(c="class"),n[c]=new on(n[c]).assign(t)),l=i.length;l-- >0;)s=i[l],[d,o]=Hs[s.dock],u?u.vertical!==d&&(u=_s(Ps(u),d)):u=_s(n,d),u.children[o?"unshift":"push"](s.element);const h=Ps(u||_s(n),!0);return h.class["b-panel-body-wrap"]=1,h.class[`b-${e.$$name.toLowerCase()}-body-wrap`]=1,h}get hasHeader(){const{header:e,title:t,tools:n,parent:r}=this,i=Object.values(n||{}).some((e=>!e.hidden));return e||!(null!=r&&r.suppressChildHeaders)&&(t||i)}composeHeader(e){const t=this;if(!e&&!t.hasHeader)return;const n=t.splitHeaderItems(),r=t.header||{},[i,s]=n||Ls,o=t.$meta.hierarchy,a=t.composeTitle(r),l=r.dock||"top",c=new on({[`b-dock-${l}`]:1},r.cls);let d,u;for(d=o.indexOf(Bs);d<o.length;++d)u=o[d].$$name,"Grid"!==u&&(c[`b-${u.toLowerCase()}-header`]=1);for(d=0;d<i.length;++d){var h,g;null===(h=(g=i[d]).syncRotationToDock)||void 0===h||h.call(g,l)}for(d=0;d<s.length;++d){var m,p;null===(m=(p=s[d]).syncRotationToDock)||void 0===m||m.call(p,l)}return{tag:"header",class:c,children:[...i.map(ks),a,...s.map(ks)]}}composeTitle(e){const t="string"==typeof e?e:this.title||e.title,n={reference:"titleElement",html:t,class:{[`b-align-${e.titleAlign||"start"}`]:1,"b-header-title":1}};return Ot.isObject(t)&&(delete n.html,Ot.merge(n,t)),n}splitHeaderItems(){const e=this,{endTools:t,startTools:n}=e,r=Ot.values(e.strips,((e,t)=>!js[null==t?void 0:t.dock]));if(r.length+t.length+n.length)return[[...n,...r.filter((e=>"pre-header"===e.dock)).sort(e.byWeightSortFn)],[...r.filter((e=>"header"===e.dock)).sort(e.byWeightReverseSortFn),...t]]}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{hasNoChildren:t,textContent:n}=e,r=Ot.merge({reference:"bodyElement",className:e.classHierarchy(Bs).reduce(((t,n)=>{const{$$name:r}=n,i=Reflect.getOwnPropertyDescriptor(n.prototype,"widgetClass");let s=r;return null!=i&&i.get&&(s=i.get.call(e)),s&&(t[`b-${r.toLowerCase()}-content`]=s),t}),{})},e._bodyConfig);return!e.initializingElement&&e._element||(r.html=e.content||e._html),r.className["b-box-center"]=1,r.className["b-text-content"]=n&&t,r}changeBodyCls(e){return on.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){const e=this,t=Ot.values(e.strips,((e,t)=>!Hs[null==t?void 0:t.dock])).sort(e.byWeightSortFn),[n,r]=e.splitHeaderItems()||Ls;return[...n,...r,...t.filter((e=>Hs[e.dock][1])),...e._items||Os,...t.filter((e=>!Hs[e.dock][1])).reverse()]}changeStrips(e,t){const n=this,r=n.$strips||(n.$strips=new ls({configName:"strips",factory:ki,inferType:!1,owner:n,created(e){var t;const{dock:i}=e;if(!js[i]&&!Hs[i])throw new Error(`Invalid dock value "${i}"; must be: top, left, right, bottom, header, or pre-header`);Se.after(e,"onConfigChange",((e,{name:t})=>{$s[t]&&n.onConfigChange({name:"strips",value:r.target})})),e.innerItem=!1,n.onChildAdd(e),e.parent=n,null===(t=e.layout)||void 0===t||t.renderChildren(),e.hasItems&&(n.hasItems=!0)},setup:(e,t)=>((e=Ot.merge(Ot.clone(n.stripDefaults["*"]),n.stripDefaults[t],e)).parent=n,e.ref=t,e),transform:e=>(Array.isArray(e)&&(e={items:e}),e||null)}));if(r.update(e),!t)return r.target}updateTrapFocus(e){var t;const n=this;n.element.classList[e?"add":"remove"]("b-focus-trapped"),n.focusTrapListener=null===(t=n.focusTrapListener)||void 0===t?void 0:t.call(n),e&&(n.focusTrapListener=Tr.on({element:n.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:n}),n.treeWalker||(n.treeWalker=this.setupTreeWalker(n.element,NodeFilter.SHOW_ELEMENT,Is,!1)))}updateMaxHeight(e){super.updateMaxHeight(e),r.isIE11&&(this.bodyWrapElement.style.flex=`1 1 ${e}px`)}fixIEMaxHeightBug(){const{element:e,contentElement:t,bodyWrapElement:n}=this;if("column"===er.getStyleValue(e,"flex-direction")){t.style.maxHeight="";let r=nn.client(e).height;const i=e.childNodes,s=i.length;for(let e=0;e<s;e++){const s=i[e];s===t||s===n||s.classList.contains("b-resize-monitors")||(r-=s.offsetHeight)}this.contentElement.style.maxHeight=`${r}px`}}setupTreeWalker(e,t,n,r){return document.createTreeWalker(e,t,n,r)}onFocusTrapped(e){const t=this,n=t.treeWalker;e.target===t.bottomFocusTrap?(n.currentNode=t.topFocusTrap,n.nextNode()):(n.currentNode=t.bottomFocusTrap,n.previousNode()),t.requestAnimationFrame((()=>n.currentNode.focus()))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList;var n;e.hasHeader&&t.push("b-panel-has-header",`b-header-dock-${(null===(n=e.header)||void 0===n?void 0:n.dock)||"top"}`);return e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}}Bs.initClass(),Bs._$name="Panel";class Ns extends Bs{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:r.isIE11?null:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:r.isIE11?null:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0}}finalizeInit(){const e=this;e.anchoredTo=e.forElement,e.initialAnchor=e.anchor,e.forElement&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),Tr.on({element:e.forElement,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!0===e.autoShow?e.show():e.setTimeout((()=>e.show()),e.autoShow))}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments);const n=this;n.maximizable&&n.headerElement&&Tr.on({element:n.headerElement,dblclick:n.onHeaderDblClick,thisObj:n})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":Boolean(t&&e)}}}close(){const e=this;if(!e._hidden&&!1!==e.trigger("beforeClose")||e._hidden&&"destroy"===e.closeAction)return e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout((()=>e.element.classList.add("b-using-keyboard")),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){er.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.close(!0))}onDocumentMouseDown({event:e}){const t=this;t.modal&&e.target===Ns.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):t.owns(e.target)||!t.autoClose||t.containsFocus||t.close()}get isTopModal(){return er.isVisible(Ns.modalMask)&&this.element.previousElementSibling===Ns.modalMask}onFocusIn(e){const t=er.getActiveElement(this);super.onFocusIn(e),er.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){window.visualViewport&&window.visualViewport.height<document.documentElement.clientHeight||this.modal||!this.autoClose||this.close(),super.onFocusOut(e)}onShow(){const e=this;e.autoClose&&e.addDocumentMouseDownListener(),e.focusOnToFront&&e.focus(),super.onShow&&super.onShow(),e.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=an.on({globaltap:"onDocumentMouseDown",thisObj:this}))}syncModalMask(){const e=this,{modal:t}=e;if(t&&e.isVisible)"number"!=typeof e._x&&"number"!=typeof e._y&&(e.centered=!0),e.modalMask.classList.remove("b-hide-display"),e.element.classList.add("b-modal");else if(e.isPainted){e.element.classList.remove("b-modal");const t=e.floatRoot.querySelectorAll(".b-modal"),n=t.length?Ns.fromElement(t[t.length-1],"popup"):null;n?n.syncModalMask():Ns.modalMask.classList.add("b-hide-display")}}onHide(){const e=this;e.mouseDownRemover&&(e.mouseDownRemover(),e.mouseDownRemover=null),super.onHide&&super.onHide(),e.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=Ns;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=er.createElement({className:"b-modal-mask b-hide-display"}),Tr.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}}Ns.initClass(),Ns._$name="Popup";const zs={left:!0,right:!0,top:!0,bottom:!0,transform:!0},Vs={true:1,false:1};class Ws extends Ns{static get $name(){return"Tooltip"}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,floating:!0,getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:!1,anchor:!0,align:"b-t",axisLock:!0,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConstruct(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.trackMouse=!0,e.forElement=e.rootElement.host||e.rootElement)),super.afterConstruct(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=Tr.on({element:e.forElement,mouseover:"internalOnPointerOver",mouseout:"internalOnPointerOut",thisObj:e})),e.autoShow&&e.show(),e.allowOver&&Tr.on({element:e.element,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:e})}doDestroy(){this.pointerOverOutDetacher&&this.pointerOverOutDetacher(),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&er.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get trackMouse(){return this._trackMouse&&!this.anchorToTarget}updateAnchorToTarget(e){e||(this.anchor=!1)}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:n}=t;n&&er.isTouchEvent&&e.pageX===n.pageX&&e.pageY===n.pageY&&t.activeTarget.contains(e.target)&&performance.now()-n.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,n=t.forElement,r=t.forSelector,i=t.activeTarget;let s;if(!(t.disabled||t.allowOver&&t.element.contains(e.target))){if(r){if(i&&i.contains(e.target)&&i.contains(e.relatedTarget))return;if(s=e.target.closest(r),s&&e.relatedTarget&&e.relatedTarget.closest(r)===s)return}else{if(n.contains(e.relatedTarget))return;s=n}s?t.handleForElementOver(e,s):i&&t.handleForElementOut()}}onTransitionEnd(e){const t=this,n=Ws.currentOverElement;if(zs[e.propertyName]){if(t.allowOver&&t.element.contains(n))return;t.activeTarget&&t.activeTarget.contains(n)&&!t.trackMouse&&t.realign()}}async handleForElementOver(e,t){const n=this;if(!1===n.trigger("pointerOver",{event:e,target:t}))n.internalOnPointerOut(e);else{let r;if(n.triggeredByEvent=e,n.abortDelayedHide(),!n.hideOnDelegateChange&&n.element.classList.contains("b-hiding")&&(n.element.classList.remove("b-hiding"),r=!0),!r&&!n.isVisible||n.hideOnDelegateChange)n.hideOnDelegateChange&&n.hide(!1),n.updateActiveTarget(t),n.delayShow(t);else{if(n.updateActiveTarget(t),!1===n.trigger("beforeShow"))return n.hide();r&&n.show(!1);const e=n.updateContent();j.isPromise(e)&&!n.loadingMsg&&await e,n.hidden||(n.alignTo({target:n.anchorToTarget?t:new Cr(n.triggeredByEvent.pageX-window.pageXOffset+n.mouseOffsetX,n.triggeredByEvent.pageY-window.pageYOffset+n.mouseOffsetY),overlap:!(n.anchorToTarget&&n.anchor)}),n.trigger("show"),n.afterShowByTarget())}}}async delayShow(e){const t=this;if(t.currentAnimation&&(t.cancelHideShowAnimation(),t._hidden=!0),t.isVisible||t.hasTimeout("show"))t.isVisible&&t.showByTarget(e);else if(!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval){const n=t.updateContent();j.isPromise(n)&&!t.loadingMsg&&await n,t.showByTarget(e)}else t.addDocumentMouseDownListener(),t.listeningForMouseMove||t.anchorToTarget||(t.mouseMoveRemover=Tr.on({element:t.rootElement,mousemove:"onMouseMove",thisObj:t})),t.setTimeout((async()=>{if(!er.isOrphaned(e)){const n=t.updateContent();j.isPromise(n)&&!t.loadingMsg&&await n,t.showByTarget(e)}}),t.triggeredByEvent&&"mouseover"!==t.triggeredByEvent.type?0:t.hoverDelay,"show")}updateContent(){const e=this;if(e.getHtml){const t=e.getHtml({tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent});return e.html=t,t}}get hasContent(){return Boolean(""!==this._html&&"string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){return this.updateContentOnMouseMove||this.hasContent}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html=`\n                <div class="b-tooltip-loading">\n                    <i class="b-icon b-icon-spinner"></i>\n                    ${e}\n                </div>\n            `)}showByTarget(e){const t=this;t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.showBy({target:t.anchorToTarget?e:new Cr(t.triggeredByEvent.pageX-window.pageXOffset+t.mouseOffsetX,t.triggeredByEvent.pageY-window.pageYOffset+t.mouseOffsetY),overlap:!(t.anchorToTarget&&t.anchor)})}afterShowByTarget(){const e=this,t=e.dismissDelay;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront()}updateActiveTarget(e){const t=this,n=t.activeTarget;t.activeTarget=e,t.isConfiguring||t.trigger("overtarget",{newTarget:e,lastTarget:n})}internalOnPointerOut(e){const t=this,n=e.relatedTarget;t.allowOver&&t.element.contains(n)||t.element.contains(e.target)&&t.activeTarget&&t.activeTarget.contains(n)||t.activeTarget&&!t.activeTarget.contains(e.relatedTarget)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;!1!==e.trigger("pointerOut")?(e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())):e.activeTarget=null}show(){const e=this;e.forElement&&e.anchorToTarget&&!e.forSelector&&!e.inShowBy?e.showByTarget(e.forElement):(e.inShowBy&&(e.y=-1e4),super.show()),e.afterShowByTarget(),e.mouseMoveRemover||e._hidden||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=Tr.on({element:e.rootElement,[r.supportsPointerEvents?"pointermove":"touchmove"]:"onMouseMove",thisObj:e})),!e.forElement||e.transitionEndDetacher||e._hidden||(e.transitionEndDetacher=Tr.on({element:e.forElement,transitionend:"onTransitionEnd",thisObj:e}))}hide(...e){const t=this;t.abortDelayedShow(),t.isVisible&&(t.abortDelayedHide(),super.hide(...e),t.lastHidden=Date.now(),t.activeTarget=null,t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.transitionEndDetacher&&(t.transitionEndDetacher(),t.transitionEndDetacher=null),t.listeningForMouseMove=!1)}abortDelayedShow(){const e=this;e.hasTimeout("show")&&(e.mouseDownRemover&&(e.mouseDownRemover(),e.mouseDownRemover=null),e.clearTimeout("show"),e.mouseMoveRemover&&(e.mouseMoveRemover(),e.mouseMoveRemover=null),e.transitionEndDetacher&&(e.transitionEndDetacher(),e.transitionEndDetacher=null))}abortDelayedHide(){this.clearTimeout("hide")}realign(e){const t=this,n=t.lastAlignSpec,r=t.clippedBy;if(!t.isConfiguring&&r&&!t.isVisible&&n&&n.targetHidden){nn.from(n.target,t.positioned?t.element.offsetParent:null,!t.positioned).intersect(r)&&(t.show(),n.targetHidden=!1)}super.realign(e)}alignTo(e){const t=this;t.isVisible&&(!e||t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target)||e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e))}changeHtml(e){const t=this;return!1===e?(s.deprecate("Grid","5.0.0","Setting false to indicate loading is deprecated, in favor of `showAsyncMessage`. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/3.0.1.md for more information"),void this.showAsyncMessage()):j.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((n=>{e.target===t.activeTarget&&(t.html=n)}))):("object"!=typeof e&&(e=null!=e?t.optionalL(String(e)):""),e)}updateHtml(e,t){const n=this;let r=""===e;r||(super.updateHtml(e,t),n.hasContent?(n.isVisible&&n.realign(),j.isPromise(e)||n.trigger("innerHtmlUpdate")):r=!0),r&&n.hide()}onMouseMove(e){const t=this,{forElement:n}=t,r=e.pageX-window.pageXOffset+t.mouseOffsetX,i=e.pageY-window.pageYOffset+t.mouseOffsetY,s=t.hasTimeout("hide"),o=e.target;if(t.triggeredByEvent=e,!t._hidden){let a;const l=t.forSelector&&t.activeTarget&&!s&&o.nodeType===Node.ELEMENT_NODE&&!o.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(o)),c=null!=n&&n.document?n.document.documentElement:n,d=c&&(c.contains?c.contains(o):16&c.compareDocumentPosition(o));l&&(a=t.handleForElementOut()),(a||!s||d)&&(t.dismissDelay&&!s&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.getHtml({tip:t,element:t.element,forElement:t.activeTarget,event:e})),t.trackMouse&&t.alignTo({position:new Cr(r,i),ignorePageScroll:!0}))}}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t){var n,r;let i=null===(n=e.bryntum)||void 0===n||null===(r=n.tooltip)||void 0===r?void 0:r.get(Ws);if(!i&&!t){var s;null!==(s=e.bryntum)&&void 0!==s&&s.tooltip||Ot.setPath(e,"bryntum.tooltip",new Map);const t=e.bryntum.tooltip;t.set(Ws,!0),i=new Ws({forElement:e,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isShared:!0,cls:"b-tooltip-shared",listeners:{pointerOver({source:e,target:t}){for(const t in e.resetCfg)"listeners"===t?e.un(e.resetCfg[t].set):"html"!==t&&(e[t]=e.resetCfg[t].was);e.resetCfg={};const n=ki.getById(t.id),r=(null==n?void 0:n.tipConfig)||e.gatherDataConfigs(t.dataset);if(n&&n.element!==t||!n&&t.matches(".b-widget"))return!1;for(const t in r)e.resetCfg[t]={set:r[t],was:e[t]},"listeners"===t?e.on(r[t]):e[t]=r[t]}},gatherDataConfigs(e){const t=this,n={};for(const r in e)if(r.startsWith("btip"))if(r.length>4){const i=A.uncapitalize(r.substr(4));if(i in t.getDefaultConfiguration()){const t=e[r];n[i]=Vs[t]?"true"===t:isNaN(t)?t:parseInt(t,10)}}else n.html=e[r];return n}}),Tr.on({element:e,mouseenter:e=>Ws.currentOverElement=e.target,capture:!0}),t.set(Ws,i)}return i}}Ws.initClass(),Object.defineProperty(ki,"tooltip",{get:()=>Ws.getSharedTooltip(document.body)}),ki.Tooltip=Ws,Ws._$name="Tooltip";const Gs=(e,t)=>(e.weight||0)-(t.weight||0),Us=(e,t)=>(t.weight||0)-(e.weight||0),Ys={align:!0,weight:!0};class qs extends(ki.mixin(Ss)){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{placeholder:null,value:"",name:null,label:null,labelPosition:"before",labelCls:null,labels:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}},required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,testConfig:{updatedClsDuration:10}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t;const n=this,{triggers:r}=n,i=n.isPainted&&qs.getSharedErrorTooltip(n.rootElement,!0);if(null===(e=n.inputListenerRemover)||void 0===e||e.call(n),null===(t=n.keyListenerRemover)||void 0===t||t.call(n),super.doDestroy(),r)for(const e of Object.values(r))e.destroy();(null==i?void 0:i.field)===n&&i.hide()}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,t){var n;let r=null===(n=e.bryntum)||void 0===n?void 0:n.errorTooltip;return r||t||(e.bryntum=e.bryntum||{},r=new Ws({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:"l-r",scrollAction:"realign",rootElement:e,onBeforeShow(){const e=this,t=ki.fromElement(e.activeTarget);if(t){const n=t.getErrors();if(n)return e.html=n.join("<br>"),e.field=t,!0}return!1}}),e.bryntum.errorTooltip=r),r}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}onFocusIn(e){const t=this;t.valueOnFocus=Ot.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e)}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}compose(){this.getConfig("clearable");const{id:e,innerElements:t,label:n,labels:r=[],labelCls:i,readOnly:s,triggers:o}=this,a=Ot.values(o,((e,t)=>!t)),l=a.filter((e=>"start"===e.align)).sort(Gs),c=a.filter((e=>"start"!==e.align)).sort(Us),d=t=>Ot.assign({tag:"label",for:`${e}-input`,class:`b-label b-align-${t.align||"start"}`},t);return{class:{"b-has-label":Boolean(n)||r.length,"b-has-start-trigger":l.length,"b-readonly":s},children:[...r.filter((e=>e&&"end"!==e.align)).map(d),n?d({reference:"labelElement",class:`b-label b-align-start ${i||""}`,html:n}):null,{class:"b-field-inner",reference:"inputWrap",children:[...l.map((e=>e.element)),...t,...c.map((e=>e.element))]},...r.filter((e=>"end"===(null==e?void 0:e.align))).map(d)]}}updateElement(e,t){var n;const r=this,i=r.initialConfig.value,{input:s}=r;super.updateElement(e,t),null!=i&&(r.value=i),r.syncEmpty(),r.updateInputReadOnly(r.inputReadOnly),r.syncInvalid();const o=s||r.focusElement;null===(n=r.keyListenerRemover)||void 0===n||n.call(r),r.keyListenerRemover=o&&Tr.on({element:o,thisObj:r,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:n,inputCls:r,inputType:i,name:s}=this,o=Ot.assign({reference:"input",tag:"input",type:i,name:s||n,id:`${n}-input`,retainElement:!0},t);r&&(o.class=r);for(let t,n,r=e.length;r-- >0;)t=e[r],n=this[t],null!=n&&(o[t]=n);return o}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){const e=this.input;let t;try{t=[e.selectionStart,e.selectionEnd,e.selectionDirection]}catch(n){t=e.value,t=t?t.length:0,t=[t,t]}return t}set textSelection(e){"number"==typeof e?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,n]=this.textSelection,r=this.input.value;return`${r.substr(0,t)}${e}${r.substr(n||t)}`}select(e,t){const n=this.focusElement;if(n.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;r.isIE11?(n.focus(),n.setSelectionRange(e,t)):n.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){const{isEmptyInput:e,isEmpty:t,element:n,clearIcon:r}=this,i=e&&t;n&&(r&&r.classList[i?"add":"remove"]("b-icon-hidden"),n.classList[i?"add":"remove"]("b-empty"))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:n,hintHtml:r}=e,i=null==t?void 0:t.parentElement;if(t){let s=r||n;const o=e.hintElement||s&&(e.hintElement=er.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));o&&("function"==typeof s&&(s=s({source:e,value:e.value})),o.firstChild[r?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){this.updatingInvalid=!0;const{isPainted:e}=this;if(e){const{isValid:e,element:t,inputWrap:n}=this,r=this.errorTip;t.classList[e?"remove":"add"]("b-invalid"),e?null!=r&&r.isVisible&&r.field===this&&r.hide():r&&n.contains(Ws.currentOverElement)&&(r.activeTarget===n&&r.isVisible?r.onBeforeShow():(r.activeTarget=n,r.showBy(n)))}this.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}updateInputReadOnly(e){const t=this,{input:n,inputListenerRemover:r}=t;n&&(n.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==r?void 0:r():r||(t.inputListenerRemover=Tr.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&Ot.assign({cls:"b-icon-remove",weight:1e3,handler(){t._isUserAction=!0,t.clear(),t._isUserAction=!1}},e)||null}}changeTriggers(e,t){const n=this,r=n.$triggers||(n.$triggers=new ls({configName:"triggers",factory:qs.Trigger,inferType:!1,owner:n,created(e){Se.after(e,"onConfigChange",((e,{name:t})=>{Ys[t]&&n.onConfigChange({name:"triggers",value:r.target})}))},setup(e,t){e.reference=e.ref=t,e.parent=n}}));if(!1===n.stepTriggers&&(e.back||e.forward)&&(delete(e=Ot.assign({},e)).back,delete e.forward),r.update(e),!t)return r.target}updateLabelWidth(e){this.labelElement&&(this.labelElement.style.flex=`0 0 ${er.setLength(e)}`,this.inputWrap.style.flexBasis=null==e?"":0)}updateInputWidth(e){this.input.style.width=er.setLength(e),r.isIE11&&(this.input.parentElement.style.flexBasis=this.input.style.width),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}changeLabel(e){return null==e?"":e}updateLabel(e){this.labelElement&&(this.labelElement.innerHTML=e)}updateLabelPosition(e,t){const{classList:n}=this.element;n.remove(`b-label-${t}`),n.add(`b-label-${e}`)}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get validity(){const e=this.input;return e&&e.validity}changeValue(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}updateValue(e,t){const n=this;n.isConfiguring||(n.syncRequired(),n.inputting||n.triggerChange()),n.inputting||(n._lastValue=e),n.syncInputFieldValue()}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:n,parent:r,inputValueAttr:i,inputValue:s}=t;var o;n&&!t.inputting&&n[i]!==s&&(n[i]=s,t.isConfiguring||t.containsFocus||!t.highlightExternalChange||(n.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),e||r&&(r.isSettingValues||null!==(o=r._isSettingValues)&&void 0!==o&&o.preventHighlight)||t.highlightChanged()));t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&(/text|search|password|tel|url/.test(e.type)||r.isEdge))}internalOnInputFocus(){const e=this,t=e.input.value.length;r.isIE11&&t&&!e.autoSelect&&e.select(t,t),e.autoSelect&&e.selectAll()}internalOnChange(e){const t=this;t.isValid&&t.hasChanged(t._lastValue,t.value)&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const n=this,{value:r,_lastValue:i,isValid:s}=n;n.syncHint(),n.triggerFieldChange({value:r,oldValue:i,event:e,userAction:t,valid:s}),"change"===n.defaultAction&&n.trigger("action",{value:r,oldValue:i,event:e,userAction:t,valid:s})}internalOnInput(e){var t;const n=this;n.inputting=!0,n.value=n.input.value,n.inputting=!1,n.trigger("input",{value:n.value,event:e}),null===(t=n.changeOnKeyStroke)||void 0===t||t.call(n,e)}internalOnKeyEvent(e){const t=this,{value:n}=t;let i=!1;if("keydown"===e.type)if("Escape"!==e.key||t.readOnly||t.disabled)"Enter"===e.key&&r.isIE11&&t.internalOnChange(e);else{const e=t.isValid,r="initialValue"in t?t.initialValue:t.valueOnFocus,s=t.hasChanged(r,n),o=t.input.value!==String(t.inputValue);t.revertOnEscape&&(!e||s||o)?(s&&(t.value=r),o&&t.syncInputFieldValue(!0),t.clearError(),i=s&&t.isValid||e!==t.validOnFocus):t.clearable&&(n||t.input.value)&&t.clear()}t.isDestroyed||(i&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(){this.value=this.nullValue,this.trigger("clear")}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;t.isConfiguring||!t.required||!t.isEmpty||null!==(e=t.parent)&&void 0!==e&&e.isSettingValues?t.clearError("L{fieldRequired}",t.updatingInvalid):t.setError("L{fieldRequired}",t.updatingInvalid)}setError(e,t){(this.errors||(this.errors={}))[this.optionalL(e)]=1,t||this.syncInvalid()}clearError(e,t){const n=this;n.errors&&(e?delete this.errors[this.optionalL(e)]:n.errors={},t||n.syncInvalid())}getErrors(){const e=this;if(!e.isValid){const t=e.validity,n=Ot.keys(t).find((e=>"valid"!==e&&"customError"!==e&&t[e])),r=e.errors&&Object.keys(e.errors);let i;if(i=null!=r&&r.length?r:t.customError?[e.input.validationMessage]:n?[e.L(n,{min:e.min,max:e.max})]:[e.L(e.invalidValueError)],i&&i.length>0)return i}}}qs.Trigger=class extends ki{static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:qs.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null}}get field(){return this.parent}compose(){return{class:{[`b-align-${this.align||"end"}`]:1,"b-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(e){return e}onClick(e){const t=this,{field:n}=t,r="function"==typeof t.handler?t.handler:n[t.handler];n.disabled||n.readOnly||!1!==n.trigger("trigger",{trigger:t})&&(null==r||r.call(n,e))}onMousedown(e){const t=this.field;!("key"in e)&&er.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((()=>t.editable=!0),500)),e.preventDefault(),er.getActiveElement(t.input)!==t.input&&t.focus()}},qs.SpinTrigger=class extends qs.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"b-icon":1,"b-spin-up":1}},downButton:{class:{"b-icon":1,"b-spin-down":1}}}}}updateRepeat(e){var t;null===(t=this.clickRepeater)||void 0===t||t.destroy(),this.clickRepeater=e?Fr.new({element:this.element},e):null}onClick(e){const t=this,{field:n}=t;n.disabled||n.readOnly||(e.target===t.upButton?n.doSpinUp(e.shiftKey):e.target===t.downButton&&n.doSpinDown(e.shiftKey))}},qs.Trigger.initClass(),qs.SpinTrigger.initClass(),ki.register(qs.Trigger,"trigger"),ki.register(qs.SpinTrigger,"spintrigger"),qs._$name="Field";l.apply(class{static get target(){return{class:qs}}static get configurable(){const e=this._overridden.configurable;return e.autoComplete=null,e}});class Ks extends(Be(me)){static get configurable(){return{ownerCmp:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,testConfig:{scrollDuration:1}}}updateOwnerCmp(e){this.itemSelector||(this.itemSelector=`.${this.ownerCmp.itemCls}`)}onKeyDown(e){const t=this,{ownerCmp:n,itemSelector:r,activeItem:i,itemsTabbable:s}=t,{target:o}=e,a=t.target.querySelector(r),l=(e.key||"").trim()||e.code,c=`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${l}`,d=o.matches(r)||o===t.keyEventTarget;if(!t.disabled&&a&&t.target.offsetParent&&d){if(!s){if(null==t.inlineFlow){const e=a.parentNode,n=er.getStyleValue(a,"position"),r=er.getStyleValue(a,"display"),i=er.getStyleValue(a,"float");t.inlineFlow="absolute"===n||"inline"===r||"inline-block"===r||"left"===i||"right"===i||"flex"===er.getStyleValue(e,"display")&&"row"===er.getStyleValue(e,"flex-direction")}t.prevKey||(t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown"))}if(t.processEvent&&!(e=t.processEvent.call(n,e)))return;if(i)switch(l){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigateNext(e);break;default:{const r=t.keys&&t.keys[c];if(r&&!t.disabled?t.callback(r,t.thisObj||n,[e]):n.onInternalKeyDown&&n.onInternalKeyDown(e),er.getActiveElement(o)!==o&&e.preventDefault(),s)return}}else{if(s)return;t.activeItem=t.previousActiveItem||t.getDefaultNavigationItem(e)}t.activeItem!==i&&t.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:n,prevKey:r,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===r?t.querySelector(`${n}:last-of-type`):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(`${n}`):void 0}navigatePrevious(e){const t=this,n=t.previous;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}navigateNext(e){const t=this,n=t.next;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:t.scrollDuration}).then((()=>{t.activeItem=n,t.triggerNavigate(e)}))}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const n=this.treeWalker;if(n.currentNode=t,n[e<0?"previousNode":"nextNode"](),n.currentNode!==this.activeItem)return n.currentNode}onTargetFocusIn(e){const t=this,{target:n}=e,{itemsTabbable:r,skipScrollIntoView:i}=t;if(!n.matches(".b-focus-trap"))if(n.matches(t.itemSelector))t.skipScrollIntoView=!0,t.activeItem=n,t.skipScrollIntoView=i,t.activeItem&&r&&t.triggerNavigate(e);else{const n=ki.fromElement(e.target);var s,o,a;if(!n||!t.owner.owns(n))if(!r&&null!==(s=e.relatedTarget)&&void 0!==s&&null!==(o=s.matches)&&void 0!==o&&o.call(s,t.itemSelector))null===(a=t.owner.previousSibling)||void 0===a||a.focus()}}onTargetFocusOut(e){const t=this,{relatedTarget:n}=e;null!=n&&n.matches(".b-focus-trap")||n&&t.target.contains(n)&&n.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){const t=this,n=e.target.closest(t.itemSelector);t.mouseDownEvent=e,!1===t.ownerCmp.itemsFocusable?t.onFocusGesture(e):n&&(e.preventDefault(),er.focusWithoutScrolling(n))}onTargetClick(e){var t;const n=this,{skipScrollIntoView:r}=n;n.skipNextClick||null!==(t=n.mouseDownEvent)&&void 0!==t&&t.ignoreNavigation?n.skipNextClick=!1:n.disabled||(n.skipScrollIntoView=!0,n.processEvent&&(e=n.processEvent.call(n.ownerCmp,e)),e&&(n.activeItem=e.target.closest(n.itemSelector),n.triggerNavigate(e)),n.skipScrollIntoView=r)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}changeActiveItem(e){return null!=e&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,t){const n=this,{ownerCmp:r}=n,i=t&&n.target.contains(t);if(i&&(n.previousActiveItem=t),null!=e){if(n.skipScrollIntoView||r.scrollable.scrollIntoView(e,{block:"nearest",focus:er.isFocusable(e)&&e!==er.getActiveElement(e),silent:n.scrollSilently}),e===t&&i)return;t&&t.classList.remove(n.focusCls),e.classList.add(n.focusCls),n._activeItem=e}else t&&(t.classList.remove(n.focusCls),t===er.getActiveElement(t)&&r.revertFocus()),n._activeItem=null}updateTarget(e,t){const n=this,r={element:e,thisObj:n,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut"};n.itemsTabbable||(r.mousedown="onTargetMouseDown",r.click="onTargetClick"),Object.prototype.hasOwnProperty.call(n,"acceptNode")||(n.acceptNode=n.acceptNode.bind(n),n.acceptNode.acceptNode=n.acceptNode),Tr.on(r),n.treeWalker=n.setupTreeWalker(e,NodeFilter.SHOW_ELEMENT,n.acceptNode,!1),n.keyEventTarget||(n.keyEventTarget=e),(n.targetMutationMonitor=new MutationObserver(n.onTargetChildListChange.bind(n))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,n,r){return document.createTreeWalker(e,t,n,r)}onTargetChildListChange(){const e=this.activeItem;e&&(this.target.contains(e)?e.classList.add(this.focusCls):this.activeItem=this.target.querySelector(`${this.itemSelector}[data-id="${e.dataset.id}"]`)||null)}changeKeyEventTarget(e){this._keyEventTarget=e,Tr.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var n;const r={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",r),null===(n=this.ownerCmp)||void 0===n||n.trigger("navigate",r)}}Ks._$name="Navigator";const Xs={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3,SHOW_ALL:4294967295,SHOW_ELEMENT:1,SHOW_ATTRIBUTE:2,SHOW_TEXT:4,SHOW_CDATA_SECTION:8,SHOW_ENTITY_REFERENCE:16,SHOW_ENTITY:32,SHOW_PROCESSING_INSTRUCTION:64,SHOW_COMMENT:128,SHOW_DOCUMENT:256,SHOW_DOCUMENT_TYPE:512,SHOW_DOCUMENT_FRAGMENT:1024,SHOW_NOTATION:2048},Zs=Object.create||function(e){function t(){}return t.prototype=e,new t},Js={first:"firstChild",last:"lastChild",next:"firstChild",previous:"lastChild"},Qs={next:"nextSibling",previous:"previousSibling"},eo=Js.toString,to=function(e,t){return eo.call(e).toLowerCase()==="[object "+t.toLowerCase()+"]"},no=function(e,t){return 1<<t.nodeType-1&e.whatToShow?null===e.filter?Xs.FILTER_ACCEPT:e.filter.acceptNode(t):Xs.FILTER_SKIP},ro=function(e,t){let n,r,i,s,o;for(r=e.currentNode[Js[t]];null!==r;){if(s=no(e,r),s===Xs.FILTER_ACCEPT)return e.currentNode=r,r;if(s!==Xs.FILTER_SKIP||(n=r[Js[t]],null===n))for(;null!==r;){if(o=r[Js[t]],null!==o){r=o;break}if(i=r.parentNode,null===i||i===e.root||i===e.currentNode)return null;r=i}else r=n}return null},io=function(e,t){let n,r,i;if(n=e.currentNode,n===e.root)return null;for(;;){for(i=n[Qs[t]];null!==i;){if(n=i,r=no(e,n),r===Xs.FILTER_ACCEPT)return e.currentNode=n,n;i=n[Js[t]],r===Xs.FILTER_REJECT&&(i=n[Qs[t]])}if(n=n.parentNode,null===n||n===e.root)return null;if(no(e,n)===Xs.FILTER_ACCEPT)return null}},so=function(e,t){if(e===t)return null;if(null!==e.nextSibling)return e.nextSibling;for(;null!==e.parentNode;){if((e=e.parentNode)===t)return null;if(null!==e.nextSibling)return e.nextSibling}return null};class oo{constructor(e,t,n){const r=this;let i=!1;if(!e||!e.nodeType)throw new Error("DOMException: NOT_SUPPORTED_ERR");r.root=e,r.whatToShow=Number(t)||0,r.currentNode=e,to(n,"function")?(r.filter=Zs(Xs),r.filter.acceptNode=function(e){let t;if(i)throw new Error("DOMException: INVALID_STATE_ERR");return i=!0,t=n(e),i=!1,t}):r.filter=null}parentNode(){let e=this.currentNode;for(;null!==e&&e!==this.root;)if(e=e.parentNode,null!==e&&no(this,e)===Xs.FILTER_ACCEPT)return this.currentNode=e,e;return null}firstChild(){return ro(this,"first")}lastChild(){return ro(this,"last")}previousSibling(){return io(this,"previous")}nextSibling(){return io(this,"next")}previousNode(){let e,t,n;for(e=this.currentNode;e!==this.root;){for(n=e.previousSibling;null!==n;){for(e=n,t=no(this,e);t!==Xs.FILTER_REJECT&&null!==e.lastChild;)e=e.lastChild,t=no(this,e);if(t===Xs.FILTER_ACCEPT)return this.currentNode=e,e;n=e.previousSibling}if(e===this.root||null===e.parentNode)return null;if(e=e.parentNode,no(this,e)===Xs.FILTER_ACCEPT)return this.currentNode=e,e}return null}nextNode(){let e,t,n;for(e=this.currentNode,t=Xs.FILTER_ACCEPT;;){for(;t!==Xs.FILTER_REJECT&&null!==e.firstChild;)if(e=e.firstChild,t=no(this,e),t===Xs.FILTER_ACCEPT)return this.currentNode=e,e;if(n=so(e,this.root),null===n)return null;if(e=n,t=no(this,e),t===Xs.FILTER_ACCEPT)return this.currentNode=e,e}}}function ao(e,t,r){return t=t===n?Xs.SHOW_ALL:t,r&&to(r.acceptNode,"function")?r=r.acceptNode:to(r,"function")||(r=null),new oo(e,t,r)}l.apply(class{static get target(){return{class:Ks}}setupTreeWalker(e,t,n){return ao(e,Xs.SHOW_ELEMENT,n)}acceptNode(e){var t;return e.offsetParent&&null!==(t=e.matches)&&void 0!==t&&t.call(e,this.itemSelector)?Xs.FILTER_ACCEPT:Xs.FILTER_SKIP}});l.apply(class{static get target(){return{class:j}}static isObject(e){return e!==window&&this._overridden.isObject.call(this,e)}});const lo=e=>!e.classList.contains("b-focus-trap")&&er.isFocusable(e)?Xs.FILTER_ACCEPT:Xs.FILTER_SKIP;l.apply(class{static get target(){return{class:Bs}}setupTreeWalker(e){return ao(e,Xs.SHOW_ELEMENT,lo)}});const co=Object.getOwnPropertyDescriptor(ki.prototype,"floatRoot").get;Object.defineProperty(ki.prototype,"floatRoot",{get:function(){var e;const t=this.rootElement||(null===(e=this.owner)||void 0===e?void 0:e.rootElement);let{floatRoot:n}=t;return n?er.getRootElement(n)!==t&&t.appendChild(n):n=co.call(this),n}});l.apply(class{static get target(){return{class:ki}}setDragImage(){}});l.apply(class{static get target(){return{class:ki}}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null;let n;for(;e&&(n=e.nextSibling);)t.insertBefore(n,e)}});class uo extends(me.mixin(Be,Ye)){static get configurable(){return{clientListeners:null,disabled:!1}}static initPlugins(e,...t){const n=e.plugins||(e.plugins={});for(const r of t)n[r.$$name]=new r(e)}get client(){return this._client}set client(e){this._client=e}getFocusRevertTarget(){var e;return null===(e=this.client)||void 0===e?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let n,[r,i]=e;1===e.length?Ot.isObject(r)&&(i=r,r=i.client):(i=Ot.assign({},i),delete i.client),t.client=r,super.construct(i),t.applyPluginConfig(r),n=t.clientListeners,n&&(n=Ot.assign({},n),n.thisObj=t,r.on(n))}applyPluginConfig(e){const t=this,n=t.pluginConfig||t.constructor.pluginConfig;if(n){const{assign:r,chain:i,after:s,before:o,override:a}=n;r&&t.applyAssign(e,r),(i||s)&&t.applyChain(e,i||s),o&&t.applyChain(e,o,!1),a&&t.applyOverride(e,a)}}applyAssign(e,t){t.forEach((t=>this.assign(e,t)))}applyChain(e,t,n=!0){if(Array.isArray(t))for(const r of t)this.chain(e,r,r,n);else for(const r in t)this.chain(e,r,t[r],n)}applyOverride(e,t){const n=this;n.overridden||(n.overridden={}),t.forEach((t=>{if(!n[t])throw new Error(`Trying to chain fn ${e.$$name}#${t}, but plugin fn ${n.$$name}#${t} does not exist`);"function"==typeof e[t]&&(n.overridden[t]=e[t].bind(e)),e[t]=n[t].bind(n)}))}assign(e,t){const n=this,r=function(e,t){const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t);return n&&(n.get||n.set)?n:null}(n,t);r?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(n),set:r.set&&r.set.bind(n)}):e[t]=n[t].bind(n)}chain(e,t,n,r=!0){const i=this,s=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=i[n]&&i[n].bind(i),a=i.functionChainRunner;if(!o)throw new Error(`Trying to chain fn ${e.$$name}#${n}, but plugin fn ${i.$$name}#${n} does not exist`);if(!s[t]){let n=e[t];n&&(n=n.bind(e),n.$this=e),s[t]=n?[n]:[],e[t]=(...e)=>a(s[t],e)}o.$this=i,s[t][r?"push":"unshift"](o)}functionChainRunner(e,t){let n,r,i;for(r=0;r<e.length&&(n=e[r],n.$this.isDestroyed||(i=n(...t),!1!==i));r++);return i}doDisable(e){const t=this,{constructor:n}=t,r="featureClass"in n?n.featureClass:`b-${n.$$name.toLowerCase()}`;var i,s;r&&(null===(i=t.client)||void 0===i||null===(s=i.element)||void 0===s||s.classList[e?"remove":"add"](r));t.isConfiguring||(e?t.trigger("disable"):t.trigger("enable"))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error(`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`)}get rootElement(){return this.client.rootElement}}uo._$name="InstancePlugin";var ho=e=>class extends(e||me){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),uo.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){uo.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){return"function"==typeof e&&(e=e.$$name),this.plugins&&this.plugins[e]}get widgetClass(){}},go=e=>class extends(e||me){static get $name(){return"State"}get state(){return this._state=this.getState(),this._state}set state(e){this._state=e,this.applyState(e)}get widgetClass(){}};const mo=Symbol("STM_PROP"),po={parentIndex:1};var fo=e=>class extends(e||me){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(e){this.stm||(this.stm=e.stm)}unjoinStore(e){this.stm===e.stm&&(this.stm=null),super.unjoinStore&&super.unjoinStore(e)}get stm(){return this[mo]}set stm(e){this[mo]=e}beforeSet(e,t,n,r){const i=this.stm;if(i&&!i.disabled&&!po[e]&&!this.constructor.nonPersistableFields[e]){var s;const i=(null===(s=super.beforeSet)||void 0===s?void 0:s.call(this,e,t,n,r))||[];let o,a;return"object"==typeof e?[o,a]=Object.keys(e).reduce(((t,n)=>(t[0][n]=e[n],t[1][n]=this.get(n),t)),[{},{}]):(o={[e]:t},a={[e]:this.get(e)}),i.push([o,a]),i}return[]}afterSet(e,t,n,r,i,s){const o=this.stm,a=this.constructor.nonPersistableFields;if(o&&!o.disabled&&!po[e]&&!a[e]){const e=i.pop();if(s){let t;const[n,r]=e,[i,l]=Object.keys(s).reduce(((e,i)=>(a[i]||(t=!0),e[0][i]=n[i],e[1][i]=r[i],e)),[{},{}]);t&&o.onModelUpdate(this,i,l)}}}beforeInsertChild(e){const t=super.beforeInsertChild?super.beforeInsertChild(e):[],r=this.stm;return r&&!r.disabled&&t.push(e.reduce(((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:n}),e)),new Map)),t}afterInsertChild(e,t,n,r){const i=this.stm;if(i&&!i.disabled){const t=n.pop();r&&i.onModelInsertChild(this,e,r,t)}super.afterInsertChild&&super.afterInsertChild(e,t,n,r)}beforeRemoveChild(e,t){const n=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],r=this.stm;return!r||r.disabled||t||n.push(e.reduce(((e,t)=>(e.set(t,t.parentIndex),e)),new Map)),n}afterRemoveChild(e,t,n){const r=this.stm;if(r&&!r.disabled&&!n){const n=t.pop();e&&e.length&&r.onModelRemoveChild(this,e,n)}super.afterRemoveChild&&super.afterRemoveChild(e,t,n)}},vo=e=>class extends(e||me){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:n,constructor:r}=this,i=t[0];if(!0===e)return!!n||[];if(e){Array.isArray(e)||(e=[e]);const t=e.length,n=[];for(let s,o=0;o<t;o++)s=e[o],s=s.isModel?s:i?i.createRecord(s):new r(s,null,null,!0),s=i?i.processRecord(s):s,n.push(s);if(!0===this.children&&i){const e=i.createSorterFn(i.sorters);n.sort(e)}return n}}processChildren(e=this.stores){const t=this,{meta:n}=t;t.inProcessChildren=!0;const r=t.ingestChildren(t.data[t.constructor.childrenField],e);r&&(r.length?(n.isLeaf=!1,!0===t.children&&(t.children=[]),t.appendChild(r,!1,!0)):!0===r?(n.isLeaf=!1,t.children=!0):t.isRoot||(n.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)),t.inProcessChildren=!1}ancestorsExpanded(e=this.firstStore){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e=this.firstStore){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){let e=this,t=-1;for(;e&&!e.isRoot;)++t,e=e.parent;return t}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const n=this.children;return!n||!Array.isArray(n)||e&&!this.isExpanded(t)?0:n.reduce(((t,n)=>t+n.getDescendantCount(e)),n.length)}get allChildren(){const e=this.children;return e?e.reduce(((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e)),[]):[]}get firstChild(){const e=this.children;return e&&e.length&&e[0]||null}get lastChild(){const e=this.children;return e&&e.length&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get root(){return this.parent&&this.parent.root||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){const t=this,{parent:n}=t,r=e&&t.firstStore.getById(e);r!==n&&(n||r)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:r?r.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}traverse(e,t=!1,n=!1){const r=(n?this.unfilteredChildren:this.children)||this.children;t||e.call(this,this);for(let t=0,i=r&&r.length;t<i;t++)r[t].traverse(e,!1,n)}traverseBefore(e,t=!1,n=!1){const r=(n?this.unfilteredChildren:this.children)||this.children;for(let t=0,i=r&&r.length;t<i;t++)r[t].traverse(e,!1,n);t||e.call(this,this)}traverseWhile(e,t=!1,n=!1){const r=this;let i=!0;if(t||(i=!1!==e.call(r,r)),i&&r.isLoaded){i=((n?r.unfilteredChildren:r.children)||this.children).every((t=>t.traverseWhile(e,!1,n)))}return i}bubble(e,t=!1){let n=this;for(t||e.call(n,n);n.parent;)n=n.parent,e.call(n,n)}bubbleWhile(e,t=!1){let n=this,r=!0;for(t||(r=e.call(n,n));r&&n.parent;)n=n.parent,r=e.call(n,n);return r}contains(e){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile((t=>t.id!=e))}getTopParent(e){let t;return e?(t=[],this.bubbleWhile((e=>(t.push(e),e.parent&&!e.parent.isRoot)))):(t=null,this.bubbleWhile((e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot)))),t}appendChild(e,t=!1){return this.insertChild(e,null,t)}insertChild(e,t=null,r=!1){if("number"==typeof e){const n=e;e=t,t=this.children[n]}const i=this,s=i.isLeaf,o=Array.isArray(e);if(Array.isArray(e)||(e=[e]),!r&&!i.stores.every((t=>!1!==t.trigger("beforeAdd",{records:e,parent:i}))))return null;e=i.ingestChildren(e);const a=t?t.parentIndex:i.children?i.children.length:0,l=i.beforeInsertChild?i.beforeInsertChild(e):n,c=i.internalAppendInsert(e,t,r);return s&&c.length&&(i.meta.isLeaf=!1),i.isLeaf===s||i.root.isLoading||r||i.stores.forEach((e=>{const t={isLeaf:{value:!1,oldValue:!0}};e.trigger("update",{record:i,changes:t}),e.trigger("change",{action:"update",record:i,changes:t})})),i.afterInsertChild&&i.afterInsertChild(a,e,l,c),o||!c?c:c[0]}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,n){const r=this,{stores:i,root:s}=r,{firstStore:o}=s,{parentIdField:a}=r.constructor,l=r.isAutoRoot?null:r.id,c={};let d,u,h,g;if(t&&t.parent!==r&&(t=null),r.children){const n=r.children,i=t?t.parentIndex:n.length;if(n[u=i]===e[0]||n[u=i-1]===e[0])for(d=!0,h=0;d&&h<e.length;h++)e[h]!==n[u+h]&&(d=!1)}if(d)return e;for(h=0;h<e.length;h++){const t=e[h],n=t.parent;c[t.id]=t.root===s,o&&!s.isLoading&&t.traverse((e=>{e.root===s&&(c[e.id]=!0)})),n&&!1===n.removeChild(t,c[t.id])?(g||(e=e.slice(),g=!0),e.splice(h--,1)):(t.parent=r,t.data[a]=l,n&&(t.meta.oldParentId=n.id))}if(e.length){const s=r.addToChildren(r.children||(r.children=[]),t,e);r.addToChildren(r.unfilteredChildren,t,e,!0),i.forEach((t=>{t.isChained||(e.forEach((e=>{e.joinStore(t)})),t.onNodeAddChild(r,e,s,c,n),e.forEach((e=>{if(null!=e.meta.oldParentId&&!r.inProcessChildren&&!r.isLoading){const t={[a]:l,[r.getDataSource("parentIndex")]:e.parentIndex},n={},{modified:i,oldParentId:s}=e.meta,o=i.parentIndex;delete e.meta.oldParentId,r.id!==s&&(n[a]={value:l,oldValue:s}),e.parentIndex!==o&&(n.parentIndex={value:e.parentIndex,oldValue:o}),i[a]===r.id?Reflect.deleteProperty(i,a):a in i||(i[a]=s),e.afterChange(t,n)}})))}))}return e}removeChild(e,t=!1,r=!1){const i=this,s=i.isLeaf,{children:o,stores:a}=i;if(Array.isArray(e)||(e=[e]),e=e.filter((e=>e.parent===i)),!r)for(const n of a)if(!n.isChained&&!1===n.trigger("beforeRemove",{parent:i,records:e,isMove:t}))return!1;const l=i.beforeRemoveChild?i.beforeRemoveChild(e,t):n;for(const n of e){const{parentIdField:e}=n.constructor,{modified:s}=n.meta,l=n.parent?n.parent.id:null;e in s||(s[e]=l);const c=i.removeFromChildren(o,n);i.removeFromChildren(i.unfilteredChildren,n,!0),a.forEach((e=>{e.isChained||e.onNodeRemoveChild(i,[n],c,{isMove:t,silent:r})})),t||(n.parent=n.parentIndex=n.unfilteredIndex=n.nextSibling=n.previousSibling=null,n.data[e]=null)}0===(i.unfilteredChildren||o).length&&i.constructor.convertEmptyParentToLeaf.onRemove&&!i.isRoot&&(i.meta.isLeaf=!0),i.isLeaf===s||r||i.stores.forEach((e=>{const t={isLeaf:{value:!0,oldValue:!1}};e.trigger("update",{record:i,changes:t}),e.trigger("change",{action:"update",record:i,changes:t})})),i.afterRemoveChild&&i.afterRemoveChild(e,l,t)}clearParentId(){const e=this;Reflect.deleteProperty(e.data,e.parentIdField),Reflect.deleteProperty(e.originalData,e.parentIdField),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,e.parentIdField)}clearChildren(e=!1){const t=this,{stores:n}=t,r=t.unfilteredChildren||t.children;t.children=[],r&&!0!==r&&(n.forEach((n=>{n.isChained||n.onNodeRemoveChild(t,r,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]))}clear(){const e=this,{stores:t}=e,n=e.children&&e.children.slice();if(e.isRoot&&n){for(const r of t)if(!r.isChained&&!1===r.trigger("beforeRemove",{parent:e,records:n,isMove:!1,removingAll:!0}))return!1;e.children.length=0,t.forEach((e=>{n.forEach((t=>{t.stores.includes(e)&&t.unjoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}updateChildrenIndices(e,t=!1,r=!1){const i=t?"unfilteredIndex":"parentIndex";let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=a[i];"parentIndex"===i?l===n||r?a.setData("parentIndex",o):l!==o&&a.set("parentIndex",o,!0):a[i]=o,t||(a.previousSibling=s,s&&(s.nextSibling=a),o===e.length-1&&(a.nextSibling=null),s=a)}}addToChildren(e,t,n,r=!1){if(e){const i=r?"unfilteredIndex":"parentIndex",s=t?t[i]:e.length;return e.splice(s,0,...n),this.updateChildrenIndices(e,r),s}}removeFromChildren(e,t,n=!1){if(e){const r=t[n?"unfilteredIndex":"parentIndex"];return r>-1&&(e.splice(r,1),this.updateChildrenIndices(e,n)),r}}};const{getOwnPropertyDescriptor:yo}=Reflect;class bo extends(me.mixin(ui)){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:n,persist:!0,readOnly:!1,internal:!1}}construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(e,n)=>t.compare(null==e?void 0:e[t.name],null==n?void 0:n[t.name]))}defineAccessor(e,t){const{name:n,dataSource:r}=this;!t&&n in e&&e.$meta.hierarchy.some((e=>{var t;return!1===(null===(t=yo(e.prototype,n))||void 0===t?void 0:t.enumerable)}))||Reflect.defineProperty(e,n,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(n,r)}:function(){return this.flatGet(n,r)},set(e){const t=this.$meta.fields.map[n];t&&t.readOnly||this.set(n,e)}})}isEqual(e,t){return Ot.isEqual(e,t)}print(e){return null==e?this.nullText:this.printValue(e)}printValue(e){return String(e)}}bo._$name="DataField";class Co extends bo{static get $name(){return"ArrayDataField"}static get type(){return"array"}isEqual(e,t){return e===t}}Co.initClass(),Co._$name="ArrayDataField";class wo extends bo{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}convert(e){return null==e?this.nullable?e:this.nullValue:Boolean(e)}}wo.initClass(),wo._$name="BooleanDataField";class So extends bo{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}get dateFormat(){return this.format}set dateFormat(e){s.deprecate("Core","5.0.0",`DateDataField "${this.name}": dateFormat config has been renamed to "format"`),this.format=e}convert(e){return null==e?this.nullable||(e=this.nullValue):"now"===e?e=new Date:e instanceof Date||(e=(e=Mt.parse(e,this.format||Mt.defaultParseFormat))||n),e}serialize(e){return e instanceof Date&&(e=Mt.format(e,this.format||Mt.defaultFormat)),e}printValue(e){return Mt.format(e,this.format||Mt.defaultFormat)}}So.initClass(),So._$name="DateDataField";class Eo extends bo{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}}Eo.initClass(),Eo._$name="IntegerDataField";class Do extends bo{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}}Do.initClass(),Do._$name="ModelDataField";class xo extends bo{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}convert(e){if(null==e)return this.nullable?e:this.nullValue;e=Number(e);let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}}xo.initClass(),xo._$name="NumberDataField";class Ro extends bo{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}}Ro.initClass(),Ro._$name="ObjectDataField";class To extends bo{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return null==e?this.nullable?e:this.nullValue:String(e)}}To.initClass(),To._$name="StringDataField";const{defineProperty:Mo}=Reflect,{hasOwnProperty:Fo}=Object.prototype,Ao=n,Io={children:1,data:1,meta:1},ko=["name","title","text","label","description"];class Oo extends(me.mixin(fo,vo)){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){return this._childrenField||"children"}get indexPath(){const e=[];let t=this,n=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[n--]=t.parentIndex+1;return e}construct(e={},t=null,n=null,r=!1){const i=this,s=t?Array.isArray(t)?t:[t]:[],{constructor:o,fieldMap:a}=i;let l=null;if(t=s[0],i.meta=d(d({modified:{}},o.metaConfig),n),o.applyConfigs)for(const t in i.getDefaultConfiguration())l||(l={},i.useRawData&&i.useRawData.enabled||(e=d({},e))),t in e&&(l[t]=e[t],delete e[t]);if(super.construct(l),r||o.exposeProperties(e),!Fo.call(o,"idFieldProcessed")){let e=i.meta.idField;e||(o._assignedIdField?e=o.idField:t&&(e=t.idField)),e&&e!==a.id.dataSource&&o.addField({name:"id",dataSource:e,internal:!0}),o.idFieldProcessed=!0}i._internalId=Oo._internalIdCounter++,i.stores=[],i.unjoinedStores=[],i.originalData||(i.originalData=e),i.data=o.processData(e,!1,t,i),null==i.id&&i.setData("id",i.generateId(t)),i.data[o.childrenField]&&i.processChildren(s),i.generation=0}set isCreating(e){const t=this;Boolean(t.meta.isCreating)!==e&&(t.meta.isCreating=e,t.stores.forEach((n=>{n.onIsCreatingToggle(t,e)})))}get isCreating(){return this.meta.isCreating}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,n=0,{length:r}=t;n<r;n++){const r=t[n],{name:i}=r;if("id"!==i&&!r.isEqual(this[i],e[i]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:Ao},this.data),this.stores[0],null,!0)}static processData(e,t=!1,n,r){const{fieldMap:i,defaultValues:s}=this,{useRawData:o={enabled:!1}}=n||{},a=o.enabled?e:Ot.clone(e);let l;if(!(t=t||o.disableDefaultValue))for(l in s)a[l]===Ao&&(a[l]=s[l]);if(!o.disableTypeConversion)for(l in i){const n=i[l],{name:s,dataSource:c}=n,d=c!==s,u=d&&Ot.pathExists(e,c),h=s in e&&(!d||!u),g=!o.disableTypeConversion&&n.convert;if((h||g)&&(!t||h||u)){const e=h?a[s]:Ot.getPath(a,c);Ot.setPath(a,c,g?n.convert(e,r):e),d&&delete a[s]}}return a}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var n,r,i,s,o;const a=Fo.call(e,"fields")&&e.fields,l=t.super.fields,c=t.fields={defs:null!==(n=null==l?void 0:l.defs.slice())&&void 0!==n?n:[],exposedData:!1,defaults:l?d({},l.defaults):{},exposed:Object.create(null!==(r=null==l?void 0:l.exposed)&&void 0!==r?r:null),ordinals:Object.create(null!==(i=null==l?void 0:l.ordinals)&&void 0!==i?i:null),map:Object.create(null!==(s=null==l?void 0:l.map)&&void 0!==s?s:null),sources:Object.create(null!==(o=null==l?void 0:l.sources)&&void 0!==o?o:null)};Fo.call(e,"defaults")&&Object.assign(c.defaults,e.defaults),Fo.call(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),null!=a&&a.length&&a.map(e.addField,e),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e){const t=this,n=t.$meta.fields;if(e&&t.autoExposeFields&&!n.exposedData){let r,i,s;for(r in e)n.exposed[r]||r===t.childrenField||(s=It(e[r]),i={name:r,dataSource:r,fromData:!0},"boolean"!==s&&"number"!==s&&"date"!==s||(i.type=s),t.addField(i));n.exposedData=!0}t.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this.initClass(),n=t.$meta.fields,{ordinals:r}=n,i=n.exposed,{name:s}=e,o=n.map[s],a=e.dataSource||(e.dataSource=s);let l,c;if(!o||e.type&&e.type!==o.type)l=bo.create(e),l.definedBy=o?o.definedBy:t,l.ordinal=o?o.ordinal:r[s]=n.defs.length;else for(c in l=Object.create(o),e)"type"!==c&&(l[c]=e[c]);return l.owner=t,n.defs[l.ordinal]=l,n.map[s]=l,n.sources[a]||(n.sources[a]=l),a.includes(".")&&(l.complexMapping=!0),l.complexMapping?i[a.split(".")[0]]=!0:i[a]=!0,"defaultValue"in l&&(n.defaults[a]=l.defaultValue),Io[s]||l.defineAccessor(t.prototype),t._nonPersistableFields=null,t._alwaysWriteFields=null,l}static removeField(e){const t=this.initClass(),n=t.$meta.fields,r=n.map[e],{ordinals:i}=n,s=i[e];if(r){n.defs.splice(s,1),delete i[e],delete n.defaults[e],delete n.exposed[e],delete n.map[e],delete n.sources[r.dataSource];for(const e in i)i[e]>s&&--i[e];delete t.prototype[e]}}static exposeRelations(){const e=this;Fo.call(e,"relationsExposed")||e.relationConfig&&(e.relationsExposed=!0,e.relations=[],e.relationConfig.forEach((t=>{e.relations.push(t);const n=t.relationName;Reflect.ownKeys(e.prototype).includes(n)||Mo(e.prototype,n,{enumerable:!0,get:function(){return this.getForeign(n)},set:function(e){this.setForeign(n,e,t)}})})))}static get autoExposeFields(){return!0}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}static processField(e,t,n){const r=this.fieldMap[e];return null!=r&&r.convert?r.convert(t,n):t}initRelations(){const e=this;e.constructor.relations&&e.stores.forEach((t=>{var n;t.modelRelations||t.initRelations();const r=[];null===(n=t.modelRelations)||void 0===n||n.forEach((t=>{r.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,r)}))}initRelation(e){const t=this,n=t.get(e.fieldName),r=n!==Ao&&"string"!=typeof e.store&&e.store.getById(n),i={id:n,placeHolder:!0};return t.meta.relationCache||(t.meta.relationCache={}),t.meta.relationCache[e.relationName]=r||(null!=n?i:null),r}removeRelation(e){this.meta.relationCache[e.relationName]&&(delete this.meta.relationCache[e.relationName],e.nullFieldOnRemove&&this.setData(e.fieldName,null))}getForeign(e){var t;return null===(t=this.meta.relationCache)||void 0===t?void 0:t[e]}setForeign(e,t,n){const r=Oo.asId(t);return this.set(n.fieldName,r)}flatGet(e,t){var n;return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:null!==(n=this.data[t])&&void 0!==n?n:this.data[e]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:Ot.getPath(this.data,t)}get(e){if(!e)return;const t=this.fieldMap[e];return!t&&e.includes(".")?this.complexGet(e,e):null!=t&&t.complexMapping?this.complexGet(e,t.dataSource):this.flatGet(e,(null==t?void 0:t.dataSource)||e)}setData(e,t){const{data:n,fieldMap:r}=this;if("string"==typeof e){var i;const s=r[e],o=null!==(i=null==s?void 0:s.dataSource)&&void 0!==i?i:e;null!=s&&s.complexMapping?Ot.setPath(n,o,t):n[o]=t}else{const t=Object.keys(e);for(let i=0;i<t.length;i++){var s;const o=t[i],a=r[o],l=null!==(s=null==a?void 0:a.dataSource)&&void 0!==s?s:o;l&&(null!=a&&a.complexMapping?Ot.setPath(n,l,e[o]):n[l]=e[o])}}}getData(e){var t;const n=this.fieldMap[e],r=null!==(t=null==n?void 0:n.dataSource)&&void 0!==t?t:e;if(r)return null!=n&&n.complexMapping?Ot.getPath(this.data,r):this.data[r]}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const n={id:{value:e,oldValue:t}};this.afterChange(n,n)}}set(e,t,n=!1,r=!1,i=!1){const s=this;if(s.isBatchUpdating)return s.inBatchSet(e,t,n||s.$silenceBatch),null;{var o;const a=s.beforeSet?s.beforeSet(e,t,n,r):Ao,l=s.inSet(e,t,n,r,i);return null===(o=s.afterSet)||void 0===o||o.call(s,e,t,n,r,a,l),l}}fieldToKeys(e,t){return"string"!=typeof e?Ot.assign({},e):{[e]:t}}inBatchSet(e,t,n){const r=this,{meta:i,constructor:s,fieldMap:o}=r,a={};let l,c=!1;if("string"!=typeof e?Object.keys(r.fieldToKeys(e,t)).forEach((n=>{l=o[n]||Ot,t=s.processField(n,e[n],r),l.isEqual(i.batchChanges[n],t)||(a[n]={value:t,oldValue:r.get(n)},i.batchChanges[n]=t,c=!0)})):(l=o[e]||Ot,l.isEqual(i.batchChanges[e],t)||(a[e]={value:t,oldValue:r.get(e)},i.batchChanges[e]=t,c=!0)),c&&(r.generation++,!n)){const e={action:"update",record:r,changes:a};r.stores.forEach((t=>{t.trigger("batchedUpdate",e)}))}}inSet(e,t,n,r,i=!1){const s=this,{data:o,meta:a,fieldMap:l,constructor:c}=s,{prototype:d,childrenField:u}=c,h={},g=s.fieldToKeys(e,t),m=Object.keys(g);let p=!1;if(!n&&!s.triggerBeforeUpdate(g))return null;for(let e=0;e<m.length;e++){var f;const t=m[e];if(t===u)continue;const n=l[t],v=n||Ot,y=null==n?void 0:n.readOnly,b=null!==(f=null==n?void 0:n.dataSource)&&void 0!==f?f:t,C=!i&&!n&&t in d,w=C?s[b]:null!=n&&n.complexMapping?Ot.getPath(o,b):o[b],S=c.processField(t,g[t],s),E=g[t]={value:S},D=s.getRelationConfig(t);y||v.isEqual(w,S)||(s.generation++,E.oldValue=w,p=!0,v.isEqual(s.meta.modified[t],S)?Reflect.deleteProperty(a.modified,t):s.ignoreBag||(t in a.modified||(a.modified[t]=w),E.oldValue===Ao&&Reflect.deleteProperty(E,"oldValue")),h[t]=E,s.applyValue(C,b,S,i,n),D&&!r&&(s.initRelation(D),s.stores.forEach((e=>e.cacheRelatedRecord(s,S,D.relationName,E.oldValue)))))}return p&&s.afterChange(g,h,n,r,i),p?h:null}applyValue(e,t,n,r,i){var s;if(e)this[t]=n;else{if(!i&&t.includes(".")){const e=t.split(".")[0];i=this.constructor.fieldMap[e]}null!==(s=i)&&void 0!==s&&s.complexMapping?Ot.setPath(this.data,t,n):this.data[t]=n}}afterChange(e,t,n,r,i){this.stores.forEach((i=>{i.onModelChange(this,e,t,n,r)}))}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!Ot.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&this.meta.modified[e]}getFieldPersistentValue(e){const t="string"==typeof e?this.getFieldDefinition(e):e,n=(null==t?void 0:t.name)||e;let r;return t&&!t.persist||(r=this[n],null!=t&&t.serialize&&(r=t.serialize(r,this))),r}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach((r=>{const i=e.getFieldPersistentValue(r);i!==Ao&&(t[r]=i,n=!0)})),n?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&Ot.setPath(e,this.constructor.getFieldDefinition(this.constructor.idField).dataSource,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,n={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach((i=>{const s=t[i];if(null!=s&&s.persist){const t=e.getFieldPersistentValue(i);t!==Ao&&(Ot.setPath(n,s.dataSource,t),r=!0)}})),r?n:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields;let t=this.modificationData;return e.length&&(t=Object.assign({},this.modificationData),e.forEach((e=>{t[this.getFieldDefinition(e).dataSource]=this[e]}))),t}get persistableData(){const e=this,t={};return e.fields.forEach((n=>{const r=e.getFieldPersistentValue(n);r!==Ao&&(null!=n&&n.complexMapping?Ot.setPath(t,n.dataSource,r):t[n.dataSource]=r)})),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0){const n=this,{meta:r}=n;r.modified={},r.committing=!1,e&&n.stores.forEach((e=>{if(e.modified.remove(n),e.added.remove(n),t){const t=e.collectDescendants(n).all;e.added.remove(t),e.modified.remove(t)}}))}revertChanges(e=!1){this.set(this.meta.modified,Ao,e)}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return"string"==typeof this.id&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return this.generatedIdIndex||(this.generatedIdIndex=0),`_generated${e}${++this.generatedIdIndex}`}generateId(){return this.constructor.generateId()}static asId(e){return null!=e&&e.isModel?e.id:e}get json(){return A.safeJsonStringify(this)}toJSON(){const{children:e}=this,t=this.persistableData;return e&&(t[this.constructor.childrenField]=e.map((e=>e.toJSON()))),t}toString(){const e=this,t=ko.find((t=>t in e.constructor.fieldMap)),n=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return A.safeJsonStringify(n)}get isBatchUpdating(){return Boolean(this.batching)}hasBatchedChange(e){var t,n;return null===(t=this.meta)||void 0===t||null===(n=t.batchChanges)||void 0===n?void 0:n[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1){const n=this,{parentIdField:r}=n.constructor;if(n.batching&&(n.batching--,n.$silenceBatch&&n.$silenceBatch--,!(n.batching>0||Ot.isEmpty(n.meta.batchChanges)))){const i=d({},n.meta.batchChanges);n.meta.batchChanges=null,i[r]&&(n.parentId=i[r],delete i[r]),n.set(i,Ao,e,!1,t)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:t}=e.meta,n={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(t).forEach((([t,r])=>{n[t]={oldValue:r,value:e[t]}}));const r={action:"update",record:e,changes:n};e.stores.forEach((e=>{e.trigger("batchedUpdate",r)}))}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){return!this.stores.some((t=>!1===t.trigger("beforeUpdate",{record:this,changes:e})))}copy(e=null,t){const r=this,i=d({},r.data),o=r.constructor.idField;let a,l;a=Ot.isObject(t)?t.deep:t,!1!==e&&delete i[o],e&&"object"==typeof e?(l=e.id,"deep"in e?(a=e.deep,s.deprecate("Grid","5.0.0","`deep` attribute deprecated, in favor of a separate second parameter"),delete e.id,delete e.deep):Object.assign(i,e)):l=e,a&&r.children?i.children=r.children.map((e=>e.copy(n,t))):(delete i.children,delete i.expanded),null==i[o]&&(i[o]=l||r.generateId(r.firstStore));const c=new r.constructor(i);return c.originalInternalId=r.internalId,c}remove(e=!1){const t=this,{parent:n}=this;n?n.removeChild(t):t.stores.length&&(t.isSpecialRow||t.stores.forEach((n=>n.remove(t,e,!1,!0))))}get firstStore(){return this.stores.length>0&&this.stores[0]}getRelationConfig(e){var t,n;return null===(t=this.firstStore)||void 0===t||null===(n=t.modelRelations)||void 0===n?void 0:n.find((t=>t.fieldName===e))}get isValid(){return!0}joinStore(e){const t=this,{stores:n}=t;if(!n.includes(e)){const{unjoinedStores:r}=t;super.joinStore(e),e.register(t),n.push(e),r.includes(e)&&r.splice(r.indexOf(e),1),t.isLoaded&&t.children.forEach((t=>t.joinStore(e))),t.initRelations(),e.tree&&!t.isRoot&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,t=!1){const n=this,{stores:r,unjoinedStores:i}=n;var s,o;r.includes(e)&&(e.isDestroying||(e.unregister(n),i.push(e)),null===(s=n.unfilteredChildren||n.children)||void 0===s||null===(o=s.forEach)||void 0===o||o.call(s,(n=>n.unjoinStore(e,t))),r.splice(r.indexOf(e),1),super.unjoinStore&&super.unjoinStore(e,t),e.uncacheRelatedRecord(n))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:t}=this,n=e.id||e;return t.map||(t.map={}),t.map[n]||(t.map[n]={})}get isSpecialRow(){return this.meta.specialRow}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach((t=>{t.persist&&!t.calculated||(e._nonPersistableFields[t.name]=1)}))),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach((t=>{t.alwaysWrite&&e._alwaysWriteFields.push(t.name)}))),e._alwaysWriteFields}}Oo._idField="id",Oo._internalIdCounter=1,Oo._assignedIdField=!1,Oo.exposeProperties(),Oo._$name="Model";class Lo extends Qi{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter((e=>e.isPersistable)))}}Lo._$name="StoreBag";var Po=e=>class extends(e||me){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(e,t=!1){const n=this,{storage:r}=n;if(e instanceof Set&&(e=Array.from(e)),(e=(Array.isArray(e)?e:[e]).reduce(((e,t)=>((t=n.getById(t))&&e.push(t),e)),[])).length){if(n.isRemoving=!0,n.tree){const r=e.reduce(((e,t)=>{const n=t.parent;return n&&(e[n.id]||(e[n.id]=[n,[]]),e[n.id][1].push(t)),e}),{});for(const e of Object.values(r))e[0].removeChild(e[1],!1,t);return n.isRemoving=!1,e}if(n.isGrouped){const t=r.count,i=[],s=new Set;for(const t of e){const{groupParent:e}=t.instanceMeta(n);e&&e.meta.collapsed&&i.push(t),Ce.remove(e.groupChildren,t),e.meta.childCount--,s.add(e)}for(const e of s)e.groupChildren.length>0&&n.onModelChange(e,{},{});i.length&&r.trigger("change",{action:"splice",removed:i,added:[],replaced:[],oldCount:t})}if(!e.length||!t&&!1===n.trigger("beforeRemove",{records:e}))return n.isRemoving=!1,null;t&&n.suspendEvents(),r.remove(e),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),n.isRemoving=!1}return e}clear(e=!1){var t,n;const r=this,{storage:i}=r;if(r.storage.totalCount||null!==(t=r.rootNode)&&void 0!==t&&null!==(n=t.unfilteredChildren)&&void 0!==n&&n.length){if(!e&&!1===r.trigger("beforeRemove",{records:i.allValues,removingAll:!0}))return null;if(r.rootNode)r.isChained||r.rootNode.clearChildren(e);else if(e){const e=r.registeredRecords;for(let t,n=e.length-1;n>=0;n--)t=e[n],t&&!t.isDestroyed&&t.unjoinStore(r)}e&&(r.removed.clear(),i.suspendEvents()),i.clear(),e&&i.resumeEvents(),r.added.clear(),r.modified.clear()}}removeAll(e=!1){const t=this,n=t.storage;let r;if(t.isRemoving=!0,e){n.suspendEvents();const e=t.registeredRecords;for(let n,r=e.length-1;r>=0;r--)n=e[r],!n||n.isDestroyed||n.isRoot||n.unjoinStore(t)}return r=t.tree?!1!==t.rootNode.clear():null!==t.clear(),e&&n.resumeEvents(),t.isRemoving=!1,r}add(e,t=!1){const n=this,r=n.storage;if(Array.isArray(e)){if(!e.length)return}else e=[e];if(n.tree=n.tree||Boolean(n.autoTree&&e[0].children),n.tree){const r=new Map,i=[];return e.forEach((e=>{const t=e[n.modelClass.parentIdField];r.has(t)||r.set(t,[]),r.get(t).push(e)})),r.forEach(((e,r)=>{const s=null==r?n.rootNode:n.getById(r);if(!s)throw new Error(`Parent node with id ${r} not found, cannot add children.`);i.push(...s.appendChild(e,t))})),i}if(!t&&!1===n.trigger("beforeAdd",{records:e}))return null;if(n.tree=n.tree||Boolean(n.autoTree&&e[0].children),n.tree)return n.rootNode.appendChild(e);const i=n.processRecords(e);return t&&n.suspendEvents(),r.add(i),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),i}processRecords(e,t){return e.map((e=>{const n=this.processRecord(e.isModel?e:this.createRecord(e));return null==t||t.call(this,n),n}))}insert(e,t,n=!1){const r=this,i=r.storage,s=r.getAt(e),o=i.values,a=[];if(Array.isArray(t)||(t=[t]),!1===r.trigger("beforeAdd",{records:t}))return null;let l,c,d;if(o[c=e]===t[0]||o[c=e-1]===t[0])for(l=!0,d=0;l&&d<t.length;d++)t[d]!==o[c+d]&&(l=!1);if(l)return null;const u=r.processRecords(t,(t=>{const n=i.indexOf(t);t.children&&t.children.length&&r.autoTree&&(r.tree=!0),n>-1&&(n<e&&s&&e--,a.push(n)),t.meta.previousIndex=n}));if(r.tree){const n=r.rootNode;return n.insertChild(t,n.children&&n.children[e])}return r.suspendEvents(),r.storage.remove(a),r.resumeEvents(),n&&r.suspendEvents(),i.splice(e,0,...u),n&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),u}move(e,t){this.storage.move(e,t)}setMultiple(e,t,n){const r=this,i=[],s=[];r.forEach((r=>{e(r)&&(s.push(r.set(t,n,!0)),i.push(r))})),r.trigger("updateMultiple",{records:i,all:r.records.length===i.length}),r.trigger("change",{action:"updatemultiple",records:i,all:r.records.length===i.length}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}setAll(e,t){const n=this,r=[];n.forEach((n=>{r.push(n.set(e,t,!0))})),n.trigger("updateMultiple",{records:n.records,all:!0}),n.trigger("change",{action:"updatemultiple",records:n.records,all:!0}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}acceptChanges(){const e=this;e.added.forEach((e=>e.clearChanges(!1))),e.modified.forEach((e=>e.clearChanges(!1))),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return!(!e&&!1===this.trigger("beforeCommit",{changes:t}))&&(this.acceptChanges(),e||this.trigger("commit",{changes:t}),t)}revertChanges(){const e=this,{changes:t}=e;e.add(e.removed.values,!0),e.remove(e.added.values,!0),e.modified.forEach((e=>e.revertChanges(!0))),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",{action:"clearchanges",changes:t})}get changes(){const e=this,t=e.modified.values.filter((e=>e.rawModifications));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(e=!0){this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}applyChangesFromStore(e){const t=this,n=e.changes;n&&(n.added&&t.add(n.added),n.removed&&t.remove(n.removed.map((e=>e.id))),n.modified&&n.modified.forEach((e=>{t.getById(e.id).set(e.modifications)})))}},_o=e=>class extends(e||me){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(e){this.storage.autoFilter=e}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(e){const t=this,n=t.filters;if(n.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?n.add(new ji({filterBy:t[1]})):n.add(new ji("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?n.add(...e.map((e=>e instanceof ji?e:new ji(e)))):e.isCollection?n.add(...e.values):n.add(new ji({filterBy:e}));n.forEach((e=>e.owner=t))}}get filters(){return this._filters||(this._filters=new Xi({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:n}=e;if(!e._filtersFunction)if(t.count){const r=ji.generateFiltersFunction(t);e._filtersFunction=e=>n&&e.isSpecialRow?e.groupChildren.some(r):r(e)}else e._filtersFunction=Se.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some((e=>!e.disabled))}traverseFilter(e){const t=this,n=!e.isRoot&&t.filtersFunction(e),r=e.unfilteredChildren||e.children;return r&&r.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((e=>t.traverseFilter(e))),e.updateChildrenIndices(e.unfilteredChildren,!0,!0),e.updateChildrenIndices(e.children,!1,!0),n||Boolean(e.children.length)):n}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.unfilteredChildren.slice(),e.unfilteredChildren=null),e.children&&(e.children.forEach((e=>t.traverseClearFilter(e))),e.updateChildrenIndices(e.children,!1,!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(e,t=!1){return(e=e instanceof ji?e:new ji(e)).owner=this,this.filters.add(e),t||this.filter(),e}filter(e){const t=this,{filters:n}=t;let r=!1;if(e){let i=typeof e;if("object"===i&&("silent"in e||"replace"in e)&&(r=e.silent,e.replace&&n.clear(),i=typeof(e=e.filters)),e&&(t.isConfiguring=!0,Array.isArray(e)?e.forEach((e=>t.addFilter(e,!0)),t):"function"===i?t.addFilter(new ji(e),!0):"string"===i?t.addFilter({property:e,value:arguments[1]},!0):t.addFilter(e,!0),t.isConfiguring=!1,!t.isFiltered))return}t.filtersFunction=null,t.performFilter(r)}performFilter(e){const t=this,{storage:n,filters:r,rootNode:i}=t,s=t.count;t.trigger("beforeFilter",{filters:r}),t.tree?(t.isFiltered?t.traverseFilter(i):t.traverseClearFilter(i),n.replaceValues({values:t.collectDescendants(i).visible,silent:!0})):t.isFiltered?n.addFilter({id:"primary-filter",filterBy:t.filtersFunction}):n.filters.clear(),t.afterPerformFilter(e?null:{action:"filter",filters:r,oldCount:s,records:t.storage.values})}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){this.filter(e)}removeFilter(e,t=!1){const n=this,r=e instanceof ji?e:n.filters.get(e);if(r)return n.filters.remove(r),n._filtersFunction=null,t||n.filter(),r}clearFilters(){this.filters.clear(),this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}doDestroy(){var e;null===(e=this._filters)||void 0===e||e.destroy(),super.doDestroy()}};const $o={add:1,replace:1};var Ho=e=>class extends(e||me){static get $name(){return"StoreGroup"}static get defaultConfig(){return{groupers:null}}construct(e){super.construct(e),this.on("change",this.onDataChanged)}get groupers(){return this._groupers}set groupers(e){const t=this;e&&e.length?t._groupers=e:t.groupers&&(delete t._groupers,t.groupRecords.forEach((e=>{e.meta.collapsed&&t.includeGroupRecords(e)})),t.storage.replaceValues({values:t.removeHeadersAndFooters(t.storage._values),filteredValues:t.storage.isFiltered?t.removeHeadersAndFooters(t.storage._filteredValues):null,silent:!0}),t.group(null,null,null,!1),"groupRecords"in t&&delete t.groupRecords),this._idMap=null}storeCollapsedGroups(){const e=this;return e.collapsedGroupsHash={},!(!e.groupRecords||!e.groupRecords.length)&&(e.groupRecords.forEach((t=>{e.expand(t)&&(e.collapsedGroupsHash[t.id]=!0)})),!0)}restoreCollapsedGroups(){const e=this,{collapsedGroupsHash:t}=e;t&&Object.keys(t).forEach((t=>e.collapse(e.getById(t))))}onDataChange({source:e,action:t,removed:n}){const r=this,{groupers:i}=r;if(i){const s=e.values;i.length?"splice"===t&&n&&n.length&&(r.storeCollapsedGroups()&&r.storage.replaceValues({values:r.removeHeadersAndFooters(s),silent:!0}),r.storage.replaceValues({values:r.prepareGroupRecords(s),silent:!0}),r.restoreCollapsedGroups()):e.replaceValues({values:r.removeHeadersAndFooters(s),silent:!0})}super.onDataChange&&super.onDataChange(...arguments)}collapse(e){return!(!e||e.meta.collapsed)&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,!0)}expand(e){return!(!e||!e.meta.collapsed)&&(this.includeGroupRecords(e),e.meta.collapsed=!1,!0)}removeHeadersAndFooters(e){const t=this;return e.filter((e=>!e.isSpecialRow||(t.unregister(e),!1)),!0)}prepareGroupRecords(e){const t=this;if(e=t.removeHeadersAndFooters(e),!t.isGrouped)return e;const r=[],i=t.groupers[0].field,s=[];let o=null,a=null,l=0;function c(){const e=a.meta.groupRowFor,n=`group-footer-${"number"==typeof e?e:A.createId(e)}`,i=t.getById(n)||new t.modelClass({id:n},t,{specialRow:!0,groupFooterFor:e,groupRecord:a});return i.stores=[t],t.register(i),i.groupChildren=a.groupChildren,s.push(i),r.push(i),t.allRecords.push(i),a.groupChildren.push(i),l++,i}return e.forEach((e=>{const d=e[i]==n?"__novalue__":e[i],u=`group-header-${"number"==typeof d?d:A.createId(d)}`;!e.groupChildren||e.groupChildren.length?(Ot.isEqual(d,o)||(a&&(t.useGroupFooters&&c(),a.meta.childCount=l),a=t.getById(u)||new t.modelClass({id:u},t,{specialRow:!0,groupRowFor:d,groupField:i}),a.stores=[t],t.register(a),a.groupChildren=[],r.push(a),t.allRecords.push(a),s.push(a),o=d,l=0),e.instanceMeta(t.id).groupParent=a,r.push(e),a.groupChildren.push(e),l++):t.unregister(e)})),a&&(t.useGroupFooters&&c(),a.meta.childCount=l),t.groupRecords=s,r}get isGrouped(){return Boolean(this.groupers&&this.groupers.length)}group(e,t,r=!1,i=!0,s=!1){const o=this;let a,l;if(e&&"object"==typeof e&&(t=e.ascending,l=e.fn,e=e.field),r)o.groupers.push(a={field:e,ascending:t,complexMapping:e.includes(".")});else if(e){var c,d;if(t==n)t=(null===(c=o.groupInfo)||void 0===c?void 0:c.field)!==e||(null===(d=o.groupInfo)||void 0===d?void 0:d.fn)!==l||!o.groupInfo.ascending;o.groupInfo=a={field:e,ascending:t,fn:l,complexMapping:e.includes(".")},o.groupers=[o.groupInfo]}if(a){const{prototype:t}=o.modelClass;a.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return Ot.getPath(this,e)}})}!1!==i&&o.sort(null,null,!1,!0),s||(o.trigger("group",{isGrouped:o.isGrouped,groupers:o.groupers,records:o.storage.values}),o.trigger("refresh",{action:"group",isGrouped:o.isGrouped,groupers:o.groupers,records:o.storage.values}))}addGrouper(e,t=!0){this.group(e,t,!0)}removeGrouper(e){const t=this,n=t.groupers.findIndex((t=>t.field===e));n>-1&&(t.groupers.splice(n,1),t.groupers.length?t.group():t.clearGroupers())}clearGroupers(){this.groupers=null}isRecordInGroup(e,t){if(!this.isGrouped)return null;return e[this.groupers[0]&&this.groupers[0].field]===t&&!e.isSpecialRow}isInCollapsedGroup(e){const t=e.instanceMeta(this).groupParent;return t&&t.meta.collapsed}getGroupRecords(e){const t=this;return t.isGrouped?t.storage.values.filter((n=>t.isRecordInGroup(n,e))):null}getGroupTitles(){const e=this;return e.isGrouped?e.getDistinctValues(e.groupers[0]&&e.groupers[0].field):null}onDataChanged({changes:e,action:t}){this.isGrouped&&(!e&&$o[t]||e&&this.groupers.some((t=>t.field in e)))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const n=this,r=n.indexOf(e),i=n.id;if(-1!==r&&!(e.meta.collapsed&&!t||!e.meta.collapsed&&t)){if(e.groupChildren.forEach((e=>e.instanceMeta(i).hiddenByCollapse=!t)),t){const t=e.groupChildren.filter((e=>!n.isAvailable(e)));n.storage.values.splice(r+1,0,...t)}else n.storage.values.splice(r+1,e.groupChildren.length);n.storage._indicesInvalid=!0,n._idMap=null}}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(e,t=!0){return(e?this.storage.allValues:this.storage.values).reduce(((e,n)=>(n.isSpecialRow&&(t&&e.push(n),"groupRowFor"in n.meta&&e.push.apply(e,n.groupChildren)),e)),[])}},jo=e=>class extends(e||me){static get configurable(){return{objectify:null}}initProxy(){if(!r.global.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(e,t){if(t in e)return e[t];if("$store"===t)return e;let n=e.getById(t);return n||isNaN(parseInt(t))||(n=e.getAt(parseInt(t))),n},set:(e,t,n)=>(t in e||e.isDestroying?e[t]=n:e.add(d({[e.modelClass.idField]:t},n)),!0),deleteProperty:(e,t)=>e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length),has(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){const e=A.safeJsonParse(t);t=null==e?void 0:e.id}return e.includes(t)}})}},Bo=e=>class extends(e||me){static get $name(){return"StoreRelation"}initRelations(e){const t=this,n=t.modelClass.relations;e&&t.modelRelations&&t.modelRelations.forEach((e=>{e.storeDetacher&&e.storeDetacher()})),t.modelRelations&&0!==t.modelRelations.length&&!e||!n||(t.modelRelations=[],n&&n.forEach((n=>{const r=Object.assign({},n),i="string"==typeof r.store?t[r.store]:r.store;if(r.dependentStore=t,t.modelRelations.push(r),i){r.storeProperty=r.store,r.store=i;const n=i.dependentStoreConfigs;if(n.has(t)){const i=n.get(t);if(e){const e=i.find((e=>e.relationName===r.relationName));e&&Ce.remove(i,e)}i.push(r)}else n.set(t,[r]);r.collectionName&&i.initRelationCollection(r,t),i.count>0&&i.updateDependentStores("dataset",i.records)}})))}initRelationCollection(e,t){const n=this,r=e.collectionName;n.collectionStores||(n.collectionStores={}),n.collectionStores[r]={store:t,config:e},n[r+"Store"]||(n[r+"Store"]=t),n.count>0&&n.initModelRelationCollection(r,n.records)}initModelRelationCollection(e,t){const n=this;t.forEach((t=>{t.traverse((t=>{const r=e in t?`$related${A.capitalize(e)}`:e;Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n.getCollection(this,e)},set:function(t){return n.setCollection(this,e,t)}})}))}))}resetRelationCache(){this.relationCache={},this.forEach((e=>e.initRelations()))}updateRecordRelationCache(e,t){const r=this;t&&t.forEach((t=>{const i=t.related?t.related.id:e.get(t.config.fieldName);i!==n&&r.cacheRelatedRecord(e,i,t.config.relationName,i)}))}getRelationCollection(e,t){const n=Oo.asId(t);return this.relationCache[e]&&this.relationCache[e][n]||[]}getCollection(e,t){const{config:n,store:r}=this.collectionStores[t];return r.relationCache[n.relationName]&&r.relationCache[n.relationName][e.id]||[]}setCollection(e,t,n){const{config:r,store:i}=this.collectionStores[t];i.relationCache[r.relationName]||(i.relationCache[r.relationName]={});const s=(i.relationCache[r.relationName][e.id]||[]).slice(),o=[],a=[];i.suspendEvents(),s.forEach((e=>{n.includes(e)||(e[r.fieldName]=null,i.remove(e),a.push(e))})),n.forEach((t=>{t instanceof Oo?t.stores.includes(i)||(i.add(t),o.push(t)):([t]=i.add(t),o.push(t)),t[r.fieldName]=e.id})),i.resumeEvents(),a.length&&(i.trigger("remove",{records:a}),i.trigger("change",{action:"remove",records:a})),o.length&&(i.trigger("add",{records:o}),i.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,n,r=null){const i=this,s=i.relationCache[n]||(i.relationCache[n]={});null!==r&&i.uncacheRelatedRecord(e,n,r),null!=t&&Ce.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,n=null){const r=this;function i(t,n){const i=r.relationCache[t],s=i&&i[n];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[n]}}null!=n?i(t,n):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((([e,t])=>{i(e,t&&t.id)}))}updateDependentStores(e,t){this.dependentStoreConfigs.forEach((n=>{n.forEach((n=>{const r=n.dependentStore,i=r.relationCache[n.relationName];return"dataset"===e?(n.collectionName&&this.initModelRelationCollection(n.collectionName,t),void r.forEach((e=>{const t=e.initRelation(n);t&&r.cacheRelatedRecord(e,t.id,n.relationName,t.id)}))):"removeall"===e?(r.forEach((e=>{e.removeRelation(n)})),void delete r.relationCache[n.relationName]):("add"===e&&n.collectionName&&this.initModelRelationCollection(n.collectionName,t),void("add"!==e&&"remove"!==e||t.forEach((t=>{const s=i&&i[t.id];switch(e){case"remove":s&&s.forEach((e=>e.removeRelation(n)));break;case"add":r.forEach((e=>{e.get(n.fieldName)==t.id&&(e.initRelation(n),r.cacheRelatedRecord(e,t.id,n.relationName))}))}}))))}))}))}updateDependentRecordIds(e,t){this.dependentStoreConfigs&&this.dependentStoreConfigs.forEach((n=>{n.forEach((n=>{const r=n.dependentStore,i=r.relationCache[n.relationName],s=i&&i[e]&&i[e].slice();s&&s.forEach((i=>{r.cacheRelatedRecord(i,t,n.relationName,e),i.set(n.fieldName,t,!1,!0)}))}))}))}},No=e=>class extends(e||me){static get $name(){return"StoreSum"}sum(e,t=this.storage.values){return t?t.reduce(((t,n)=>{if(n.isSpecialRow)return t;const r=Number(n[e]);return isNaN(r)?t:t+r}),0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce(((t,n)=>{var r;return"number"===typeof(null===(r=n[e])||void 0===r?void 0:r.valueOf())&&n[e]<t&&(t=n[e]),t}),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce(((t,n)=>{var r;return"number"===typeof(null===(r=n[e])||void 0===r?void 0:r.valueOf())&&n[e]>t&&(t=n[e]),t}),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let n=0;const r=t.reduce(((t,r)=>{if(r.isSpecialRow)return t;const i=parseFloat(r[e]);return isNaN(i)?t:(n++,t+i)}),0);return n>0?r/n:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}};const zo=(e,t)=>-1!==String(e).toLowerCase().indexOf(t),Vo={string:zo,number:zo,boolean:zo,date:(e,t)=>e instanceof Date&&t instanceof Date?String(e)===String(t):-1!==String(e.getMonth()+1).indexOf(t)||-1!==String(e.getDate()).indexOf(t)||-1!==String(e.getFullYear()).indexOf(t)};var Wo=e=>class extends(e||me){static get $name(){return"StoreSearch"}search(e,t=null){const n=this.storage.values,r=n.length,i=[];if(null==e)return null;let s,o,a,l,c;for("string"==typeof e&&(e=String(e).toLowerCase()),s=0;s<r;s++){o=n[s];for(const n of t||o.fieldNames)a=o[n],l=a instanceof Date?"date":typeof a,c=Vo[l],a&&c&&c(a,e)&&i.push({index:s,data:o,field:n,id:o.id})}return i}findByField(e,t){let r,i,s,o=this.storage.values,a=o.length,l=[];for(null!==t&&t!==n&&(t=String(t).toLowerCase()),r=0;r<a;r++){i=o[r],s=i[e];const a=s instanceof Date?"date":typeof s,c={date:()=>Boolean(s)&&s.toLocaleString().includes(t),string:()=>Boolean(s)&&s.toLowerCase().includes(t),number:()=>"number"==typeof s&&s.toString().includes(t),object:()=>s===t,undefined:()=>s===t};((null===t||t===n)&&s===t||t&&c[a]())&&l.push({id:i.id,index:r,data:i})}return l}find(e,t=!1){let n=t?this.storage.allValues:this.storage.values;return this.isGrouped&&(n=this.collectGroupRecords(t,!1)),n.find(e)}findRecord(e,t,n=!1){const r=n=>Ot.isEqual(n[e],t);return this.tree?this.query(r)[0]:(n?this.storage.allValues:this.storage.values).find(r)}query(e,t=!1){let r=t?this.storage.allValues:this.storage.values;if(this.isTree){const r=[];return this.traverse((t=>{e(t)&&r.push(t)}),n,n,t),r}return this.isGrouped&&(r=this.collectGroupRecords(t,!1)),r.filter(e)}some(e,t=!1){let n=t?this.storage.allValues:this.storage.values;return this.isGrouped&&(n=this.collectGroupRecords(t,!1)),n.some(e)}},Go=e=>class extends(e||me){static get $name(){return"StoreSort"}static get defaultConfig(){return{sorters:[],useLocaleSort:null}}static get configurable(){return{reapplySortersOnAdd:!1}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}updateReapplySortersOnAdd(e){this.storage.autoSort=e}sort(e,t,n=!1,r=!1){const i=this,s=i.allRecords,o=i.sorters?i.sorters.slice():[];let a,l=null;if(e)if(Array.isArray(e))i.sorters=e.map((e=>i.normalizeSorterConfig(e,"string"==typeof e||t)));else{const r=i.normalizeSorterConfig(e,t);n?(a=i.getCurrentSorterByField(r.field),a?(l=a.ascending,a.ascending=r.ascending):i.sorters.push(r)):i.sorters=[r]}return r||!1!==i.trigger("beforeSort",{sorters:i.sorters,records:s,currentSorters:o})?i.performSort(r):(i.sorters=o,void(null!==l&&(a.ascending=l)))}normalizeSorterConfig(e,t){const n=this,r={ascending:t};var i;"object"==typeof e?(Ot.assign(r,e),e.fn&&(delete r.fn,r.sortFn=e.fn),r.ascending=null!==(i=e.ascending)&&void 0!==i?i:t):"function"==typeof e?r.sortFn=e:r.field=e;if(null==r.ascending){const e=n.getCurrentSorterByField(r.field);r.ascending=!e||!e.ascending}if(null==r.sortFn){var s,o;const e=null===(s=n.modelClass)||void 0===s||null===(o=s.$meta.fields.map[r.field])||void 0===o?void 0:o.compareItems;e&&(r.sortFn=e)}return r}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find((t=>t.field===e))||null}addSorter(e,t=!0){this.sort(e,t,!0)}removeSorter(e){const t=this.sorters.findIndex((t=>t.field===e||t.sortFn===e));t>-1&&(this.sorters.splice(t,1),this.sort())}clearSorters(){this.sorters.length=0,this.sort()}createSorterFn(e){const t=this.useLocaleSort;return(n,r)=>{for(let i=0;i<e.length;i++){const s=e[i],{field:o,ascending:a=!0,useLocaleSort:l=t}=s,c=s.fn||s.sortFn,d=a?1:-1;if(c){const e=c(n,r);if(null!==e)return e*d}const u=n[o],h=r[o];if(u!==h){if(null==u)return-d;if(null==h)return d;if(l){if(!0===l)return String(u).localeCompare(h)*d;if("string"==typeof l)return String(u).localeCompare(h,l)*d;if("object"==typeof l)return String(u).localeCompare(h,l.locale,l)*d}if(u>h)return d;if(u<h)return-d}}return 0}}performSort(e){const t=this,{rootNode:n,storage:r,sorters:i}=t,s=t.createSorterFn(t.isGrouped?t.groupers.concat(i):i);t.isGrouped&&t.storeCollapsedGroups()&&r.replaceValues({values:t.removeHeadersAndFooters(r.values),silent:!0}),t.tree?(n.traverse((e=>{e.isLoaded&&e.isParent&&(e.children.sort(s),e.updateChildrenIndices(e.children,!1,!0))})),r.replaceValues({values:t.collectDescendants(n).visible,silent:!0})):r.replaceValues({values:r.values.sort(s),silent:!0}),t.afterPerformSort(e)}afterPerformSort(e){const t=this,{storage:n}=t;if(t._idMap=null,t.isGrouped&&(n.replaceValues({values:t.prepareGroupRecords(n.values),silent:!0}),t.restoreCollapsedGroups()),!e){const e={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",e),t.sortParamName||t.trigger("refresh",e)}}};const Uo=()=>!0;var Yo=e=>class extends(e||me){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],keepUncommittedChanges:!1,excludeCollapsedRecords:!0}}static get properties(){return{chainedStores:null}}construct(e){super.construct(e);const t=this,{masterStore:n}=t;n&&(t.methodNamesToRelay.forEach((e=>t[e]=(...n)=>t.relayToMaster(e,n))),t.removeAll=(...e)=>{n.remove(t.getRange(),...e)},n.on({changePreCommit:t.onMasterDataChangedPreCommit,change:t.onMasterDataChanged,prio:1,thisObj:t}),n.chainedStores||(n.chainedStores=[]),n.chainedStores.push(t),t.fillFromMaster())}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||Uo}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter((e=>!t||!this.dontRelayToMaster.includes(e)))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach((e=>e.fillFromMaster()))}fillFromMaster(){const e=this,{masterStore:t,isTree:n}=e;if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(e.keepUncommittedChanges){if(n)throw new Error("Cannot use keepUncommittedChanges on a chained tree store");e.data=[].concat(e.added.values.filter((t=>!e.removed.includes(t))),t.allRecords.filter((t=>!e.removed.includes(t)&&!e.added.includes(t)&&e.chainedFilterFn(t))))}else{let r=t.allRecords.filter(e.chainedFilterFn);if(n&&(e.idRegister={},e.internalIdRegister={},r.forEach((t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords)){const t=e.getChildren(e.rootNode);r=e.doIncludeExclude(t,!0)}e.data=r}}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChangedPreCommit(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}onMasterDataChanged({action:e,changes:t,$handled:n}){var r;this.$masterEventhandled?this.$masterEventhandled=!1:("update"!==e||null!==(r=this.chainedFields)&&void 0!==r&&r.some((e=>e in t)))&&this.fillFromMaster()}makeChained(e=(()=>!0),t,n){return new this.constructor(Object.assign(n||{},{tree:!1,autoTree:!1,masterStore:this,modelClass:this.modelClass,chainedFilterFn:e,chainedFields:t}))}chain(){return this.makeChained(...arguments)}doDestroy(){var e;null===(e=this.chainedStores)||void 0===e||e.forEach((e=>e.destroy())),super.doDestroy()}},qo=e=>class extends(e||me){static get $name(){return"StoreState"}getState(){const{sorters:e,groupers:t,filters:n}=this,r={};return null!=e&&e.length&&(r.sorters=e.map((e=>{const t=Ot.cleanupProperties(Ot.clone(e));return delete t.fn,delete t.sortFn,t}))),null!=t&&t.length&&(r.groupers=t.slice()),null!=n&&n.values.length&&(r.filters=n.values.map((e=>{const t=Ot.cleanupProperties(Ot.clone(e.config));return t.value=e.value,t.caseSensitive&&delete t.caseSensitive,t}))),r}applyState(e){const t=this,{sorters:n=[],groupers:r=[],filters:i=[]}=e;t.sorters=n.slice(),t.groupers=r.slice(),t.sort(),t.filters=i.slice(),t.filter()}};const Ko=Object.freeze([]);var Xo=e=>class extends(e||me){static get $name(){return"StoreTree"}static get configurable(){return{transformFlatData:null}}get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const e=this,t=[];return e.isTree?(e.traverse((e=>{e.isLeaf&&t.push(e)})),t):(e.allRecords.forEach((e=>{e.isLeaf&&t.push(e),e.traverse((e=>{e.isLeaf&&t.push(e)}),!0)})),t)}async loadChildren(e){}onNodeAddChild(e,t,n,r,i=!1){const s=this,o=e===s.rootNode&&e.isLoading,{storage:a}=s,l=[],c=[],d=t[0].previousSibling;let u;if(s.collectDescendants(t,l,c,{inCollapsedBranch:!(e.isExpanded(s)&&e.ancestorsExpanded(s))}),!o&&c.length)for(const e of c)s.modified.includes(e)||r[e.id]||(s.removed.includes(e)?s.removed.remove(e):s.added.add(e));var h;if(o&&s.rootVisible&&(l.unshift(e),c.unshift(e)),l.length&&(u=0!==n&&d?a.indexOf(d)+d.getDescendantCount(!0,s):a.indexOf(e),a.suspendEvents(),s.storage.splice(++u,0,l),a.resumeEvents()),s.updateDependentStores("add",t),o&&l.length){if(s.sorters.length&&s.sort(null,null,!1,!0),null===(h=s.afterLoadData)||void 0===h||h.call(s),!i){const e={action:"dataset",data:s._data,records:l};s.trigger("refresh",e),s.trigger("change",e)}}else if(!i){const n={action:"add",parent:e,isChild:!0,isMove:r,records:t,allRecords:c,index:u};s.trigger("add",n),s.trigger("change",n)}}onNodeRemoveChild(e,t,n,r={isMove:!1,silent:!1,unfiltered:!1}){const i=this,{storage:s}=i,o=[],a=[],{isMove:l,silent:c,unfiltered:d}=r,u=d&&i.isFiltered,h=u&&e.unfilteredChildren?e.unfilteredChildren:t;if(i.collectDescendants(h,o,a,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i)),unfiltered:u}),!l){for(const e of t)e.unjoinStore(i);if(a.length){for(const e of a)e.stores.includes(i)&&e.unjoinStore(i),i.added.includes(e)?i.added.remove(e):i.removed.add(e);i.modified.remove(a)}}if(o.length?(n=s.indexOf(o[0]))>-1&&(s.suspendEvents(),s.splice(n,o.length),s.resumeEvents()):n=-1,!c){const r={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:a,index:n};i.trigger("remove",r),i.trigger("change",r)}}collectDescendants(e,t=[],n=[],r={inCollapsedBranch:!1,unfiltered:!1}){const i=this,{inCollapsedBranch:s,unfiltered:o}=r,a=Array.isArray(e)?e:i.getChildren(e,o);if(a)for(let e,r=0,l=a.length;r<l;r++)e=a[r],s||t.push(e),n.push(e),i.collectDescendants(e,t,n,{inCollapsedBranch:s||!e.isExpanded(i),unfiltered:o});return{visible:t,all:n}}getChildren(e,t=!1){const n=(t||this.isChained)&&e.unfilteredChildren||e.children;return n&&n.length?this.isChained?n.filter(this.chainedFilterFn):n:Ko}internalToggleTreeSubRecords(e,t){const n=this,{storage:r}=n,i=r.indexOf(e),s=n.doIncludeExclude(n.getChildren(e),t);if(n.isFiltered&&t&&e.unfilteredChildren&&n.updateChildrenHiddenState(e),s.length&&!1!==i){if(r.suspendEvents(),t){r.splice(i+1,0,...s);const e={action:"add",isExpand:!0,records:s,index:i+1};n.trigger("add",e),n.trigger("change",e)}else{r.splice(i+1,s.length);const e={action:"remove",isCollapse:!0,records:s,index:i+1};n.trigger("remove",e),n.trigger("change",e)}r.resumeEvents()}}updateChildrenHiddenState(e){var t;null===(t=e.unfilteredChildren)||void 0===t||t.forEach((e=>{e.instanceMeta(this.id).hidden=!1,e.isLeaf||this.updateChildrenHiddenState(e)}))}doIncludeExclude(e,t,n=[]){const r=this,i=(null==e?void 0:e.length)||0;for(let s=0;s<i;s++){const i=e[s];if(!r.isChained||r.chainedFilterFn(i)){const e=i.instanceMeta(r.id);!t&&e.hidden||n.push(i),e.hidden=!t,i.isExpanded(r)&&r.doIncludeExclude(r.getChildren(i),t,n)}}return n}async toggleCollapse(e,t){const r=this,i=r.getById(e),s=i.instanceMeta(r);if(t===n&&(t=!s.collapsed),!s.isLoadingChildren&&!i.isLeaf&&i.isExpanded(r)===t){if(r.trigger("beforeToggleNode",{record:i,collapse:t}),s.collapsed=t,s.collapsed)return r.onNodeCollapse(i),!0;{r.onNodeExpand(i);let e=!0;if(!i.isLoaded){s.isLoadingChildren=!0;try{await r.loadChildren(i)}catch(t){s.collapsed=!0,e=!1,r.trigger("loadChildrenException",{record:i,exception:t})}finally{s.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}transformToTree(e){const{parentIdField:t,idField:r,childrenField:i}=this.modelClass,s=new Map,o=[];for(const l of e){const c=l[t];if(null!=c){let t=s.get(c);var a;if(t===n)t=null!==(a=e.find((e=>e[r]===c)))&&void 0!==a?a:null,s.set(c,t);t&&(t[i]||(t[i]=[]),t[i].push(l))}else o.push(l)}return o}};class Zo{static preWalk(e,t,n){const r=[e];let i,s;for(;r.length;)i=r.pop(),n(i),s=t(i),s&&r.push.apply(r,s.slice().reverse())}static preWalkWithParent(e,t,n){const r=[{node:e,parent:null}];for(;r.length;){const{parent:e,node:i}=r.pop();n(e,i);const s=t(i);s&&r.push(...s.slice().reverse().map((e=>({node:e,parent:i}))))}}static preWalkUnordered(e,t,n){let r,i,s=[e];for(;s.length;)r=s[s.length-1],n(r),i=t(r),i?s.splice(s.length-1,1,...i):s.length=s.length-1}static postWalk(e,t,n){let r,i,s=new Map,o=[e];for(;o.length;)r=o[o.length-1],s.has(r)?(n(r),o.pop()):(i=t(r),i&&(o=o.concat(i.slice().reverse())),s.set(r,r))}static prePostWalk(e,t,n,r){let i,s,o=new Map,a=[e];for(;a.length;)i=a[a.length-1],o.has(i)?(r(i),a.pop()):(n(i),s=t(i),s&&(a=a.concat(s.slice().reverse())),o.set(i,i))}}Zo._$name="WalkHelper";var Jo=e=>class extends(e||me){static get $name(){return"StoreSync"}static get defaultConfig(){return{syncDataOnLoad:null}}syncDataset(e){const t=this,{storage:n}=t,{toAdd:r,toRemove:i,updated:s}=t.tree?t.syncTreeDataset(e):t.syncFlatDataset(e);let{threshold:o}=t.syncDataOnLoad,a=!1;if(o&&("string"==typeof o&&(o=parseInt(o,10)/100*t.count),a=r.length+i.length+s.length>o),t.tree){if(r.length){t.add(r,a).forEach((e=>e.clearParentId()))}t.remove(i,a)}else a&&t.suspendEvents(),t.remove(i),t.add(r),a&&t.resumeEvents();o&&!a&&s.forEach((({record:e,toSet:n,wasSet:r})=>t.onModelChange(e,n,r))),t.acceptChanges();const l={added:r,removed:i,updated:s,thresholdSurpassed:a};a&&this.trigger("refresh",{action:"batch",data:e,records:n.values,syncInfo:l}),t.isFiltered&&t.filter(),t.isGrouped?t.group():t.isSorted&&t.sort(),t.trigger("loadSync",l)}syncFlatDataset(e){if(!e)return;const t=this,n=t.modelClass.idField,r=[],i=[],s=[],o={},{threshold:a}=t.syncDataOnLoad;let l=0;return e.forEach((e=>{const r=e[n],c=t.getById(r);if(c){const t=c.set(e,null,Boolean(a));t&&s.push({record:c,wasSet:t,toSet:e}),l++}else i.push(t.processRecord(t.createRecord(e)));o[r]=1})),l<t.allCount&&t.forEach((e=>{o[e.id]||r.push(e)})),{toAdd:i,toRemove:r,updated:s}}syncTreeDataset(e){if(!e)return;const t=this,{idField:n,parentIdField:r}=t.modelClass,i=[],s=[],o=[],a={},{threshold:l}=t.syncDataOnLoad;return Zo.preWalkWithParent({isRoot:!0,children:e},(e=>e.children),((e,i)=>{if(e){const c=i[n],u=t.getById(c);if(u){const e=u.set(i,null,Boolean(l));e&&o.push({record:u,wasSet:e,toSet:i})}else i[r]=e[n],s.push(d(d({},i),{},{children:[]}));a[c]=1}})),t.traverse((e=>{a[e.id]||i.push(e)})),{toAdd:s,toRemove:i,updated:o}}};const Qo=Symbol("STM_PROP");var ea=e=>class extends(e||me){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null}}get stm(){return this[Qo]}set stm(e){const t=this;t.stm!=e&&(t.stm&&t.stm.hasStore(t)&&t.stm.removeStore(t),t[Qo]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1){let n;const r=this.stm;return this.tree||!r||r.disabled?n=super.add(e,t):(n=super.add(e,t),n&&n.length&&r.onStoreModelAdd(this,n,t)),n}insert(e,t,r=!1){let i;const s=this.stm;if(this.tree||!s||s.disabled)i=super.insert(e,t,r);else{const o=(Array.isArray(t)?t:[t]).reduce(((e,t)=>{const r=t instanceof Oo?this.indexOf(t):n;return r!==n&&-1!==r&&e.set(t,r),e}),new Map);i=super.insert(e,t),i&&i.length&&(e=this.indexOf(i[0]),s.onStoreModelInsert(this,e,i,o,r))}return i}remove(e,t=!1,r){let i;const s=this.stm;if(this.tree||!s||s.disabled)i=super.remove(e,t,r);else{const o=(Array.isArray(e)?e:[e]).map((e=>this.getById(e))).filter((e=>!!e)).reduce(((e,t)=>{const r=this.indexOf(t);return r!==n&&-1!=r&&e.set(t,r),e}),new Map);i=super.remove(e,t,r),i&&i.length&&s.onStoreModelRemove(this,i,o,t)}return i}removeAll(e){const t=this.stm;let n;if(t&&!t.disabled){const{tree:r,rootNode:i,allRecords:s}=this,o=s.length,a=r?i.children.slice():s.slice();n=super.removeAll(e),o&&0===this.count&&t.onStoreRemoveAll(this,a,e)}else n=super.removeAll(e);return n}};class ta extends(me.mixin(mi,Be,ho,go,_o,Po,Bo,No,Wo,Go,Ho,Yo,qo,Xo,ea,Jo,jo)){static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:Oo}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){Object.assign(this,{added:new Lo,removed:new Lo,modified:new Lo,idRegister:{},internalIdRegister:{}}),e.storeId&&(e=Ot.assign({id:e.storeId},e)),super.construct(e),this.initRelations()}static from(e,t={},n=null){return e&&!e.isStore&&("string"==typeof e?e=ta.getStore(e):(Array.isArray(e)&&(n&&(e=e.map((e=>e.isModel?e:n(e)))),e=Ot.assign({},t,{data:e})),e=new ta(e))),e}doDestroy(){var e;const t=this,n=t.registeredRecords;for(let e,i=n.length-1;i>=0;i--){var r;e=n[i],null!==(r=e)&&void 0!==r&&r.isDestroyed||e.unjoinStore(t)}var i;(null===(e=t._storage)||void 0===e||e.destroy(),t.stm&&t.stm.removeStore(t),t.isChained)||(null===(i=t.rootNode)||void 0===i||i.destroy());super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;null!=e&&e.isCollection?t._storage=e:t._storage=new Xi(e),t._storage.autoFilter=t.reapplyFilterOnAdd,t._storage.autoSort=t.reapplySortersOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.on({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.isTree){const t=e.collectDescendants(e.rootNode,n,n,{unfiltered:!0}).all;return e.rootVisible&&t.unshift(e.rootNode),t}return e.isGrouped?e.collectGroupRecords():e.storage.allValues}onIsCreatingToggle(e,t){const n=this,r=e.isPersistable&&!t;n.added[r?"add":"remove"](e),r&&(n.trigger("addConfirmed",{record:e}),n.autoCommit&&n.doAutoCommit())}joinRecordsToStore(e){e.forEach((e=>{e.joinStore(this)}))}onDataChange({source:e,action:t,added:n,removed:r,replaced:i,oldCount:s,items:o,from:a,to:l}){const c=this,d=null==n?void 0:n.length,u=null==r?void 0:r.length;let h,g;if(c._idMap=null,d&&c.joinRecordsToStore(n),null==i||i.forEach((([e,t])=>{e.unjoinStore(c,!0),t.joinStore(c)})),super.onDataChange(...arguments),!c.isTree){if(d){for(const e of n)c.removed.includes(e)?c.removed.remove(e):c.added.add(e);h=!c.remoteFilter&&c.filtered&&c.reapplyFilterOnAdd,h&&c.filter({silent:!0}),g=!c.sortParamName&&c.isSorted&&c.reapplySortersOnAdd,g&&c.sort(null,null,!1,!0)}if(u){for(const e of r)e.cancelBatch(),e.unjoinStore(c),c.added.includes(e)?c.added.remove(e):e._undoingInsertion||e.meta.isCreating||c.removed.add(e);c.modified.remove(r),h=!c.remoteFilter&&c.filtered,h&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(d){c.updateDependentStores("add",n);const t=n.reduce(((e,t)=>{const{previousIndex:n}=t.meta;return n>-1&&n<e&&(e=n),e}),n[0].meta.previousIndex),r={records:n,index:e.indexOf(n[0],!e.autoFilter)};t>-1&&(r.oldIndex=t),c.trigger("add",r),c.trigger("change",Object.assign({action:"add"},r)),h&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues}),g&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}r.length&&(c.updateDependentStores("remove",r),c.trigger("remove",{records:r}),c.trigger("change",{action:"remove",records:r})),i.length&&(c.trigger("replace",{records:i,all:c.records.length===i.length}),c.trigger("change",{action:"replace",replaced:i,all:c.records.length===i.length}));break;case"filter":c.isGrouped?c.group(null,null,null,null,!0):c.isSorted&&c.performSort(!0);break;case"move":for(let e=c.storage.allValues,t=Math.min(a,l);t<=Math.max(a,l);t++)e[t].setData("parentIndex",t);c.trigger("move",{record:o[0],records:o,from:a,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:t,record:o[0],records:o,from:a,to:l})}}onDataReplaced(e,t){var n;const r=this,i=r.storage.allValues;for(let e=0;e<i.length;e++)i[e].joinStore(r);if(r.prepareGroupRecords(r.storage.values),r.restoreCollapsedGroups(),!r.remoteFilter&&r.isFiltered&&r.filter({silent:!0}),r.isGrouped&&r.group(null,null,!1,!r.sorters.length,!0),!r.sortParamName&&r.sorters.length&&r.sort(null,null,!1,!0),!r.useRawData.disableDuplicateIdCheck){const e=r.idMap;if(Object.keys(e).length<r.storage.values.length){const t=[];throw r.storage.values.forEach((n=>e[n.id]?delete e[n.id]:t.push(n))),new Error(`Id collision on ${t.map((e=>e.id))}`)}}const s={action:e,data:t,records:r.storage.values};r.updateDependentStores(e,s.records),null===(n=r.afterLoadData)||void 0===n||n.call(r),r.trigger("refresh",s),r.trigger("change",s)}onModelChange(e,t,n,r,i){const s=this,o=e.constructor.idField,a={record:e,changes:n,batch:null!=e.batching,fromRelationUpdate:i},l=!e.ignoreBag&&s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,n),!r){if(o in n){const{oldValue:n,value:r}=t[o];s.updateDependentRecordIds(n,r),s.onRecordIdChange({record:e,oldValue:n,value:r}),s.trigger("idChange",{store:s,record:e,oldValue:n,value:r})}s.onUpdateRecord(e,n),s.trigger("update",a),s.trigger("change",Object.assign({action:"update"},a))}s.autoCommit&&l&&s.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let n=!1;return e.isModified?t.modified.includes(e)||t.added.includes(e)||!e.isPartOfStore(t)||e.isAutoRoot||(e.isPhantom?t.added.add(e):t.modified.add(e),n=!0):t.modified.remove(e),n}get idMap(){const e=this,t=e.storage.values,n=!e._idMap,r=e._idMap||(e._idMap={});if(n)for(let e,n=0,i=0;n<t.length;n++)e=t[n],r[e.id]={index:n,visibleIndex:i,record:e},e.isSpecialRow||i++;return r}changeModelClass(e){const t=this.fields;let n=null;return n=null!=t&&t.length?class extends e{static get fields(){return t}}:this.preventSubClassingModel?e:class extends e{},n.initClass(),n}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,t){return super.changeId(!0!==e&&e,t)}updateId(e,t){const n=ta.getById(e);n&&ta.unregisterInstance(n),super.updateId(e,t)}generateAutoId(){return ta.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof ta)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let n;const r=e.map((e=>(e instanceof Oo?n=e.constructor:"string"==typeof e&&(e={text:e}),e)));e={autoCreated:!0,data:r,modelClass:n||class extends Oo{},allowNoId:!0},t||(t=ta)}return t?new t(e):void 0}static get stores(){return ta.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const n=this,r=n._rootNode;e!==r&&(r&&n.clear(!0),e instanceof Oo?(e.instanceMeta(n).collapsed=!1,n._rootNode=e):n._rootNode=e=new n.modelClass(Object.assign({expanded:!0,[n.modelClass.idField]:`${n.id}-rootNode`},e),n,null,!0),n._tree=!0,e.isRoot=!0,e.joinStore(n),(null!==(t=e.children)&&void 0!==t&&t.length||n.rootVisible)&&(e.isLoading=!0,n.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),n.trigger("rootChange",{oldRoot:r,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){var t;const n=this,{idField:r,childrenField:i,parentIdField:s}=n.modelClass;if(n.getConfig("plugins"),n.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=Ot.transformNamedObjectToArray(e,r)),n.tree=!n.isChained&&(n.tree||Boolean(n.autoTree&&(null===(t=e)||void 0===t?void 0:t.some((e=>e[i]))))),n.syncDataOnLoad&&n._data)n.syncDataset(e);else{if(n._data=e,n.tree){if(n.transformFlatData){let t=!1,r=!0;for(const n of e){if(n.isModel||n[i]){r=!1;break}null!=n[s]&&(t=!0)}r&&t&&(e=n.transformToTree(e))}const t=n.rootNode;t.isLoading=!0,n.clear(!0),t.appendChild(e),n.updateDependentStores("dataset",[t]),t.isLoading=!1,0===e.length?n.trigger("refresh",{action:"dataset",data:[],records:[]}):n.isFiltered&&n.filter()}else n.loadData(e);n.added.clear(),n.removed.clear(),n.modified.clear()}}loadData(e,t="dataset"){const n=this,{storage:r,allowNoId:i}=n,s=n.modelClass.fieldMap.id.dataSource;if(n.storeCollapsedGroups(),n.removeHeadersAndFooters(n.storage.values),n._idMap=null,e){if(!(e[0]instanceof Oo)){n.modelClass.exposeProperties(e[0]);const t=e.length,o=new Array(t);for(let r=0;r<t;r++){const t=e[r];if(!i&&null==t[s])throw new Error(`Id required but not found on row ${r}`);o[r]=n.processRecord(n.createRecord(t,!0),!0),o[r].setData("parentIndex",r)}n.clear(!0),r.replaceValues({values:o,isNewDataset:!0,silent:!0})}else n.clear(!0),r.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});n.onDataReplaced(t,e)}else n.clear(!0),n._data=null}get data(){return this._data}getRange(e,t,n=!0){return(n?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1){return new this.modelClass(e,this,null,t)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:n}){const r=this,i=r._idMap,{idRegister:s}=r;r.storage._indicesInvalid=!0,i&&(delete i[t],i[n]=e),r.added.changeId(t,n),r.removed.changeId(t,n),r.modified.changeId(t,n),delete s[t],s[n]=e,e.index=r.storage.indexOf(e)}onUpdateRecord(e,t){const{internalId:n}=t,{internalIdRegister:r}=this;n&&(this.storage._indicesInvalid=!0,delete r[n.oldValue],r[n.value]=e),this.reapplyFilterOnUpdate&&this.isFiltered&&this.filter()}get useRawData(){return this._useRawData}set useRawData(e){this._useRawData=!0===e?{enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-((null===(e=this.groupRecords)||void 0===e?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this,n=t.isTree&&t.idRegister[e.id];if(n&&n!==e)throw new Error(`Id collision on ${e.id}`);t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){return null!=e&&e.isModel?e:this.idRegister[e]}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[Oo.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1){if(null!=e&&e.isModel&&!e.stores.includes(this.$store||this))return-1;const n=Oo.asId(e);if(null==n)return-1;if(this.isTree)return this.storage.indexOf(n);const r=this.idMap[n];return r?r[t?"visibleIndex":"index"]:-1}allIndexOf(e){if(this.isTree){const t=this.getById(e);let n=-1;return t&&t.bubble((e=>{e.parent?n+=e.parentIndex+1:e===this.rootNode&&this.rootVisible&&(n+=1)})),n}return this.storage.indexOf(e,!0)}getDistinctValues(e){const t=[],n={};let r;return this.forEach((i=>{i.isSpecialRow||i.isRoot||(r=i.get(e),n[r]||(t.push(r),n[r]=1))})),t}getValueCount(e,t){let n=0;return this.forEach((r=>{Ot.isEqual(r.get(e),t)&&n++})),n}set json(e){"string"==typeof e&&(e=A.safeJsonParse(e)),this.data=e}get json(){return A.safeJsonStringify(this)}get formattedJSON(){return A.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.children:this).map((e=>e.toJSON()))}forEach(e,t=this,r){"boolean"==typeof(r=r!==n&&r)&&(r={includeFilteredOutRecords:r,includeCollapsedGroupRecords:!1});const i=(n,r)=>{if(!n.isRoot&&!n.isSpecialRow)return e.call(t,n,r)};if(this.isTree)this.rootNode.traverseWhile(i,!1,r.includeFilteredOutRecords);else{const e=r.includeFilteredOutRecords?this.storage.allValues:this.storage.values;if(this.isGrouped&&r.includeCollapsedGroupRecords)for(let t=0;t<e.length;t++){const n=e[t];if(n.groupChildren&&!0===n.meta.collapsed)for(let e=0;e<n.groupChildren.length;e++){if(!1===i(n.groupChildren[e],e))return}else if(!1===i(n,t))return}else for(let t=0;t<e.length;t++)if(!1===i(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}reduce(e,t=[],n=this){return n!==this&&(e=e.bind(n)),this.storage.values.reduce(e,t,n)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,r=t===this.rootNode,i){"boolean"==typeof(i=i!==n&&i)&&(i={includeFilteredOutRecords:i,includeCollapsedGroupRecords:!1});const s=this;if(s.isTree){if("boolean"==typeof t&&(r=t,t=s.rootNode),s.isChained){const t=e;e=e=>{s.chainedFilterFn(e)&&t(e)}}t.traverse(e,r,i.includeFilteredOutRecords)}else s.forEach((t=>t.traverse(e,!1,i.includeFilteredOutRecords)),s,i)}traverseWhile(e,t=this.rootNode,n=t===this.rootNode){const r=this;if(r.isTree){if("boolean"==typeof t&&(n=t,t=r.rootNode),r.isChained){const t=e;e=e=>{r.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,n)}else for(const t of r.storage)if(!1===t.traverse(e))break}getNext(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(s>=i.length-1){if(!t)return null;s=-1}const o=i[s+1];return n&&o&&o.isSpecialRow?r.getNext(i[s+1],t,!0):o}getPrev(e,t=!1,n=!1){const r=this,i=r.storage.values;let s=r.indexOf(e);if(0===s){if(!t)return null;s=i.length}const o=i[s-1];return n&&o&&o.isSpecialRow&&s>0?r.getPrev(i[s-1],t,!0):o}getAdjacent(e,t=!0,n=!1,r=!1){return t?this.getNext(e,n,r):this.getPrev(e,n,r)}getNextLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(i>=n.length-1){if(!t)return null;i=-1}return n[i+1]}getPrevLeaf(e,t=!1){const n=this.leaves,r=this.getById(e);let i=n.indexOf(r);if(0===i){if(!t)return null;i=n.length}return n[i-1]}getAdjacentLeaf(e,t=!0,n=!1){return t?this.getNextLeaf(e,n):this.getPrevLeaf(e,n)}}ta.storeMap={},ta._$name="Store";const na=(e,t)=>(Array.isArray(t[1])?t[1].forEach((n=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(n)))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),ra=Promise.resolve();class ia extends ta{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:!1,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:!1,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch((()=>{}))}get isLoading(){return this._isLoading}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...t){const n=e.includes("?"),r=Object.entries(Object.assign({},...t)).reduce(na,[]).join("&");return r?(n?"&":"?")+r:""}performSort(e){const t=this;if(t.sortParamName){const{groupRecords:n}=t,r={};return t.isGrouped&&n&&n.length&&n.forEach((e=>{e.meta.collapsed&&(t.includeGroupRecords(e),r[e.id]=!0)})),t.internalLoad({},"",(n=>{t.data=n.data,t.afterPerformSort(e,r)}))}super.performSort(e)}performFilter(e){const t=this;if(t.remoteFilter){const n=t.count,{filters:r}=t;return t.currentPage=1,t.internalLoad({},"",(i=>{t.data=i.data,t.afterPerformFilter(e?null:{action:"filter",filters:r,oldCount:n,records:t.storage.values})}))}super.performFilter(e)}encodeFilterParams(e){const t=[];for(const{property:n,operator:r,value:i,caseSensitive:s}of e)t.push({field:n,operator:r,value:i,caseSensitive:s});return JSON.stringify(t)}encodeSorterParams(e){return JSON.stringify(e.filter((e=>!e.sortFn)).map((e=>e)))}buildReadUrl(){const{readUrl:e}=this;if(this.restfulFilter&&this.filters.count){return(e.endsWith("/")?e:e+"/")+this.filters.first.value}return e}internalLoad(e,t,n){const r=this,i=Ot.assign({},r.params,e),s=r.buildReadUrl(),o={action:"read"+t,params:i,url:s};return s?new Promise(((e,s)=>{if(!1===r.trigger("beforeLoad"+t,o))return s(!1);if(r._isLoading=!0,r.trigger(`load${t}Start`,o),r.trigger("beforeRequest",o),r.filterParamName&&r.isFiltered&&(i[r.filterParamName]=r.encodeFilterParams(r.filters.values)),r.sortParamName&&r.isSorted&&(i[r.sortParamName]=r.encodeSorterParams(r.groupers?r.groupers.concat(r.sorters):r.sorters)),r.isPaged){if(!i[r.pageParamName]&&!i[r.pageStartParamName]){const e=Math.min(r.currentPage||1,r.allCount?r.lastPage:1/0);r.pageParamName?i[r.pageParamName]=e:i[r.pageStartParamName]=(e-1)*r.pageSize}i[r.pageSizeParamName]=r.pageSize}const a={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(a.method=r.httpMethods.read),be.get(o.url+r.buildQueryString(o.url,i),Ot.assign(a,r.fetchOptions)).then((async a=>{const l=a.parsedJson,c=Array.isArray(l),d=c||l&&!1!==Ot.getPath(l,r.responseSuccessProperty),u=c?null:Ot.getPath(l,r.responseTotalProperty);if(r._isLoading=!1,o.response=a,o.json=l,d){if(null!=u&&(r.remoteTotal=parseInt(u,10)),r.isPaged){if(!(r.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");{const e=r.pageParamName?i[r.pageParamName]:i[r.pageStartParamName]/r.pageSize+1;r.currentPage=Math.min(e,r.lastPage)}}o.data=c?l:Ot.getPath(l,r.responseDataProperty),await n(o),r.trigger("load"+t,o),e(o)}else o.exception=!0,o.exceptionType="server",r.trigger("exception",o),s(o);r.trigger("afterRequest",o)})).catch((e=>{r._isLoading=!1,o.exception=!0,e instanceof Response?(o.exceptionType=e.ok?"server":"network",o.response=e,o.error=e.error):(o.exceptionType="server",o.error=e),r.trigger("exception",o),s(o),r.trigger("afterRequest",o)}))})):null}async load(e){const t=this;return t.isPaged?t.loadPage(t.currentPage||1,e):t.internalLoad(e,"",(e=>{t.data=e.data}))}async loadChildren(e){return this.internalLoad({[this.parentIdParamName]:e.id},"Children",(t=>{t.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)}))}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const n=this,r=n.pageParamName?{[n.pageParamName]:e}:{[n.pageStartParamName]:(e-1)*n.pageSize};return r[n.pageSizeParamName]=n.pageSize,n.internalLoad(Ot.assign(r,t),"Page",(e=>{n.loadData(e.data,"pageLoad")}))}async nextPage(e){return this.isPaged&&this.currentPage!==this.lastPage?this.loadPage(this.currentPage+1,e):ra}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):ra}async commit(){const e=this,{changes:t}=e,n=[];if(e.commitPromise)return!1;if(!t)return e.modified.count&&(e.modified.forEach((e=>e.clearChanges(!1))),e.modified.clear()),ra;if(!1!==e.trigger("beforeCommit",{changes:t})){[...t.added,...t.modified,...t.removed].forEach((e=>e.meta.committing=!0)),e.trigger("commitStart",{changes:t});const r={action:"commit",exception:!1,changes:t};let i=e.commitRemoved(r);return i&&n.push(i),i=e.commitAdded(r),i&&n.push(i),i=e.commitModified(r),i&&n.push(i),n.length?(i=1===n.length?n[0]:Promise.all(n),e.commitPromise=new Promise(((n,s)=>{i.then((()=>{e.commitPromise=null,r.exception?(e.trigger("exception",r),s(r)):(e.trigger("commit",{changes:t}),n(r))})).catch((()=>{e.commitPromise=null,s(r)}))}))):(e.modified.forEach((e=>e.clearChanges(!1))),e.modified.clear(),e.added.forEach((e=>e.clearChanges(!1))),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),ra)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch((e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e}))}commitAdded(e){const t=this,n=t.added,r={action:"create",params:t.params};return n.count&&t.createUrl?new Promise((i=>{const s=n.values.map((e=>e.persistableData));e.create=r;let o=r.body={data:s};if(t.trigger("beforeRequest",r),t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.create),be.post(t.createUrl+t.buildQueryString(t.createUrl,t.params),o,Ot.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,l?(t.processReturnedData(n.values,a?o:o[t.responseDataProperty]),n.clear(),t.trigger("commitAdded"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,e.exceptionType=r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null}commitModified(e){const t=this,{modified:n}=t.changes,r={action:"update",params:t.params},i=n.length&&t.updateUrl?new Promise((i=>{const s=n.map((e=>t.writeAllFields?e.persistableData:e.modificationDataToWrite)).filter((e=>!Ot.isEmpty(e)));if(0===s.length)return t.modified.clear(),n.forEach((e=>e.meta.committing=!1)),void i();e.update=r;let o=r.body={data:s};if(t.trigger("beforeRequest",r),t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),o=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.update),be.post(t.updateUrl+t.buildQueryString(t.updateUrl,t.params),o,Ot.assign(a,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,l?(t.processReturnedData(n,a?o:o[t.responseDataProperty],!0),t.modified.clear(),t.trigger("commitModified"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null;return!n.length&&t.modified.count&&t.modified.clear(),i}processReturnedData(e,t,n=!1){const r=this.modelClass,i=r.fieldMap.id.dataSource;t.forEach(((t,s)=>{const o=e[s];o.clearChanges(!1),o.syncId(t[i]),Object.assign(e[s].data,r.processData(t,n))}))}commitRemoved(e){const t=this,n=t.removed,r={action:"delete",params:t.params};return n.count&&t.deleteUrl?new Promise((i=>{e.delete=r;let s=r.body={ids:n.map((e=>e.id))};if(t.trigger("beforeRequest",r),t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(s.ids)),s=e}const o={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(o.method=t.httpMethods.delete),be.post(t.deleteUrl+t.buildQueryString(t.deleteUrl,t.params),s,Ot.assign(o,t.fetchOptions)).then((s=>{const o=s.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;e.response=s,r.json=o,r.response=s,a?(n.forEach((e=>e.meta.committing=!1)),n.clear(),t.trigger("commitRemoved"),t.trigger("refresh",r),i(e)):(n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),i(e)),t.trigger("afterRequest",r)})).catch((s=>{n.forEach((e=>e.meta.committing=!1)),e.exception=r.exception=!0,s instanceof Response?(e.response=s,r.exceptionType=s.ok?"server":"network",r.response=s,r.error=s.error):(r.exceptionType="server",r.error=s),t.trigger("exception",r),i(e),t.trigger("afterRequest",r)}))})):null}get remoteFilter(){return Boolean(this.filterParamName||this.restfulFilter)}}ia._$name="AjaxStore";class sa{static get(e,t){const n=e._domData||(e._domData={});return null!=t?n[t]:n}static remove(e,t){const{_domData:n}=e,r=null==n?void 0:n[t];return null==n||delete n[t],r}static set(e,t,n){3===arguments.length?(e._domData||(e._domData={}))[t]=n:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}sa._$name="DomDataStore";const oa=()=>{throw new Error("Abstract method call!")};class aa extends me{get type(){return this.constructor.name}undo(){oa()}redo(){oa()}}aa._$name="ActionBase";const la=()=>{throw new Error("Abstract method call!")},ca=()=>{throw new Error("Method cannot be called at this state!")};class da extends me{canUndo(e){la()}canRedo(e){la()}onUndo(e){la()}onRedo(e){la()}onStartTransaction(e){la()}onStopTransaction(e){la()}onStopTransactionDelayed(e){la()}onRejectTransaction(e){la()}onEnable(e){la()}onDisable(e){la()}onAutoRecordOn(e){la()}onAutoRecordOff(e){la()}onResetQueue(e){la()}onModelUpdate(e){la()}onStoreModelAdd(e){la()}onStoreModelInsert(e){la()}onStoreModelRemove(e){la()}onStoreModelRemoveAll(e){la()}onModelInsertChild(e){la()}onModelRemoveChild(e){la()}}da._$name="StateBase";const ua=Symbol("STATE_PROP"),ha=Symbol("STORES_PROP"),ga=Symbol("QUEUE_PROP"),ma=Symbol("POS_PROP"),pa=Symbol("TRANSACTION_PROP"),fa=Symbol("TRANSACTION_TIMER_PROP"),va=Symbol("AUTO_RECORD_PROP"),ya=(Object.freeze([ua,ha,ga,ma,pa,fa,va]),new Map);var ba=(e,t)=>{ya.set(e,t)},Ca=e=>("string"==typeof e&&(e=ya.get(e)),e);const wa=(e,t)=>{const{undo:n,redo:r}=t;let i;return i=n&&!r?{[ga]:e[ga].slice(e.position),[ma]:0}:r&&!n?{[ga]:e[ga].slice(0,e.position)}:{[ga]:[],[ma]:0},[i,()=>{e.notifyStoresAboutQueueReset(t)}]};const Sa=new class extends da{canUndo(){return!1}canRedo(){return!1}onUndo(){ca()}onRedo(){ca()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){ca()}onAutoRecordOn(){return{[va]:!0}}onAutoRecordOff(){return{[va]:!1}}onStartTransaction(){ca()}onStopTransaction(){ca()}onStopTransactionDelayed(){ca()}onRejectTransaction(){ca()}onResetQueue(e,t){return wa(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};ba("disabledstate",Sa);const Ea=Symbol("ACTION_QUEUE_PROP");class Da extends me{get defaultConfig(){return{title:null}}construct(...e){this[Ea]=[],super.construct(...e)}get queue(){return this[Ea].slice(0)}get length(){return this[Ea].length}addAction(e){this[Ea].push(e)}undo(){const e=this[Ea];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[Ea];for(let t=0,n=e.length;t<n;++t)e[t].redo()}}Da._$name="Transaction";class xa extends da{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){const n=e[ga];let r=e.position,i=Math.max(0,r-t);return[{[ua]:"restoringstate",[ma]:i},()=>{for(e.notifyStoresAboutStateRestoringStart();r!=i;)n[--r].undo();return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onRedo(e,t){const n=e[ga];let r=e.position,i=Math.min(n.length,r+t);return[{[ua]:"restoringstate",[ma]:i},()=>{e.notifyStoresAboutStateRestoringStart();do{n[r++].redo()}while(r!=i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onEnable(){ca()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[ua]:"autoreadystate",[va]:!0}}onAutoRecordOff(){ca()}onStartTransaction(e,t){const n=new Da({title:t});return[{[ua]:"recordingstate",[pa]:n},()=>{e.notifyStoresAboutStateRecordingStart(n)}]}onStopTransaction(){ca()}onStopTransactionDelayed(){ca()}onRejectTransaction(){ca()}onResetQueue(e,t){return wa(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}let Ra=new xa;ba("readystate",Ra);class Ta extends da{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[pa];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[ua]:"disabledstate",[pa]:null}}onAutoRecordOn(e){return[{[ua]:"autorecordingstate",[va]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){ca()}onStartTransaction(){ca()}onStopTransaction(e,t){const n=e[pa];let r=e[ma],i=e[ga];return n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),i[r]=n,i.length=++r),[{[ua]:"readystate",[ma]:r,[pa]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onRejectTransaction(e){const t=e[pa];return[{[ua]:"restoringstate",[pa]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){ca()}onQueueReset(){ca()}onModelUpdate(e,t,n,r){e[pa].addAction(e.makeModelUpdateAction(t,n,r))}onModelInsertChild(e,t,n,r,i,s){e[pa].addAction(e.makeModelInsertChildAction(t,n,r,i,s))}onModelRemoveChild(e,t,n,r){e[pa].addAction(e.makeModelRemoveChildAction(t,n,r))}onStoreModelAdd(e,t,n,r){e[pa].addAction(e.makeStoreModelAddAction(t,n,r))}onStoreModelInsert(e,t,n,r,i,s){e[pa].addAction(e.makeStoreModelInsertAction(t,n,r,i,s))}onStoreModelRemove(e,t,n,r,i){e[pa].addAction(e.makeStoreModelRemoveAction(t,n,r,i))}onStoreRemoveAll(e,t,n,r){e[pa].addAction(e.makeStoreRemoveAllAction(t,n,r))}}const Ma=new Ta;ba("recordingstate",Ma);const Fa=new class extends da{canUndo(){return!1}canRedo(){return!1}onUndo(){ca()}onRedo(){ca()}onEnable(){ca()}onDisable(){ca()}onAutoRecordOn(){return{[va]:!0}}onAutoRecordOff(){return{[va]:!1}}onStartTransaction(){ca()}onStopTransaction(){ca()}onStopTransactionDelayed(){ca()}onRejectTransaction(){ca()}onQueueReset(){ca()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};ba("restoringstate",Fa);const Aa=new class extends xa{onAutoRecordOn(){ca()}onAutoRecordOff(){return{[ua]:"readystate",[va]:!1}}onStartTransaction(e,t){const n=new Da({title:t});return[{[ua]:"autorecordingstate",[pa]:n},()=>{e.notifyStoresAboutStateRecordingStart(n),e.stopTransactionDelayed()}]}onModelUpdate(e,t,n,r){e.startTransaction(),e.onModelUpdate(t,n,r)}onModelInsertChild(e,t,n,r,i){e.startTransaction(),e.onModelInsertChild(t,n,r,i)}onModelRemoveChild(e,t,n,r){e.startTransaction(),e.onModelRemoveChild(t,n,r)}onStoreModelAdd(e,t,n,r){e.startTransaction(),e.onStoreModelAdd(t,n,r)}onStoreModelInsert(e,t,n,r,i,s){e.startTransaction(),e.onStoreModelInsert(t,n,r,s)}onStoreModelRemove(e,t,n,r,i){e.startTransaction(),e.onStoreModelRemove(t,n,r,i)}onStoreRemoveAll(e,t,n,r){e.startTransaction(),e.onStoreRemoveAll(t,n,r)}};ba("autoreadystate",Aa);class Ia extends(Ta.mixin(br)){onDisable(e){const t=e[pa],n=e[fa];return n&&this.clearTimeout(n),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[ua]:"disabledstate",[pa]:null,[fa]:null}}onAutoRecordOn(e){ca()}onAutoRecordOff(e){const t=e[fa];return t&&this.clearTimeout(t),{[ua]:"recordingstate",[va]:!1,[fa]:null}}onStopTransaction(e,t){const n=e[pa],r=e[fa];let i=e[ma],s=e[ga];return r&&this.clearTimeout(r),n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),s[i]=n,s.length=++i),[{[ua]:"autoreadystate",[ma]:i,[pa]:null,[fa]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[fa];return t&&this.clearTimeout(t),t=this.setTimeout((()=>{e.stopTransaction()}),e.autoRecordTransactionStopTimeout),{[ua]:ka,[fa]:t}}onRejectTransaction(e){const t=e[pa],n=e[fa];return n&&this.clearTimeout(n),[{[ua]:"restoringstate",[pa]:null,[fa]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}}const ka=new Ia;ba("autorecordingstate",ka);const Oa=Symbol("MODEL_PROP"),La=Symbol("NEW_DATA_PROP"),Pa=Symbol("OLD_DATA_PROP");class _a extends aa{static get defaultConfig(){return{model:n,newData:n,oldData:n}}get type(){return"UpdateAction"}get model(){return this[Oa]}set model(e){this[Oa]=e}get newData(){return this[La]}set newData(e){this[La]=Object.assign({},e)}get oldData(){return this[Pa]}set oldData(e){this[Pa]=Object.assign({},e)}undo(){this.model.set(this.oldData,null,null,null,!0),this.model.$&&Object.assign(this.model,this.oldData)}redo(){this.model.set(this.newData,null,null,null,!0),this.model.$&&Object.assign(this.model,this.newData)}}_a._$name="UpdateAction";const $a=Symbol("PARENT_MODEL_PROP"),Ha=Symbol("CHILD_MODELS_PROP"),ja=Symbol("INSERT_INDEX_PROP"),Ba=Symbol("CONTEXT_PROP");class Na extends aa{static get defaultConfig(){return{parentModel:n,childModels:n,insertIndex:n,context:n}}get type(){return"InsertChildAction"}get parentModel(){return this[$a]}set parentModel(e){this[$a]=e}get childModels(){return this[Ha]}set childModels(e){this[Ha]=e.slice(0)}get insertIndex(){return this[ja]}set insertIndex(e){this[ja]=e}get context(){return this[Ba]}set context(e){this[Ba]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort(((e,n)=>{const{lhsParent:r,lhsIndex:i}=t.get(e)||{},{rhsParent:s,rhsIndex:o}=t.get(n)||{};return r&&r===s?i-o:0})),n.forEach((n=>{const{parent:r,index:i}=t.get(n)||{};if(r)if(r===e){let e;e=i>n.parentIndex?i+1:i,e=i===r.children.length-1?null:e;const t=r.children[e];r.insertChild(n,t)}else r.insertChild(n,r.children[i]);else e.removeChild(n)}))}redo(){const{parentModel:e,insertIndex:t,childModels:n}=this,r=e.children[t];e.insertChild(n,r)}}Na._$name="InsertChildAction";const za=Symbol("PARENT_MODEL_PROP"),Va=Symbol("CHILD_MODELS_PROP"),Wa=Symbol("CONTEXT_PROP");class Ga extends aa{static get defaultConfig(){return{parentModel:n,childModels:n,context:n}}get type(){return"RemoveChildAction"}get parentModel(){return this[za]}set parentModel(e){this[za]=e}get childModels(){return this[Va]}set childModels(e){this[Va]=e.slice(0)}get context(){return this[Wa]}set context(e){this[Wa]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{e.insertChild(t.get(n),n)}))}redo(){this.parentModel.removeChild(this.childModels)}}Ga._$name="RemoveChildAction";const Ua=Symbol("STORE_PROP"),Ya=Symbol("MODEL_LIST_PROP");class qa extends aa{static get defaultConfig(){return{store:n,modelList:n,silent:!1}}get type(){return"AddAction"}get store(){return this[Ua]}set store(e){this[Ua]=e}get modelList(){return this[Ya]}set modelList(e){this[Ya]=e.slice(0)}undo(){const e=this;e.store.remove(e.modelList,e.silent)}redo(){const e=this;e.store.add(e.modelList,e.silent)}}qa._$name="AddAction";const Ka=Symbol("STORE_PROP"),Xa=Symbol("MODEL_LIST_PROP"),Za=Symbol("INSERT_INDEX_PROP"),Ja=Symbol("CONTEXT_PROP");class Qa extends aa{static get defaultConfig(){return{store:n,modelList:n,insertIndex:n,context:n,silent:!1}}get type(){return"InsertAction"}get store(){return this[Ka]}set store(e){this[Ka]=e}get modelList(){return this[Xa]}set modelList(e){this[Xa]=e.slice(0)}get insertIndex(){return this[Za]}set insertIndex(e){this[Za]=e}get context(){return this[Ja]}set context(e){this[Ja]=e}undo(){const{store:e,modelList:t,context:r,silent:i}=this;t.sort(((e,t)=>{const i=r.get(e),s=r.get(t);return i!==n&&s!==n?i-s:0})),t.forEach((t=>{const s=r.get(t);t._undoingInsertion=!0,s!==n?e.insert(s,t,i):e.remove(t,i),t._undoingInsertion=!1}))}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}}Qa._$name="InsertAction";const el=Symbol("STORE_PROP"),tl=Symbol("MODEL_LIST_PROP"),nl=Symbol("CONTEXT_PROP");class rl extends aa{static get defaultConfig(){return{store:n,modelList:n,context:n,silent:!1}}get type(){return"RemoveAction"}get store(){return this[el]}set store(e){this[el]=e}get modelList(){return this[tl]}set modelList(e){this[tl]=e.slice(0)}get context(){return this[nl]}set context(e){this[nl]=e}undo(){const{store:e,context:t,modelList:n,silent:r}=this;n.sort(((e,n)=>t.get(e)-t.get(n))),n.forEach((n=>{const i=t.get(n);e.insert(i,n,r)}))}redo(){const e=this;e.store.remove(e.modelList,e.silent)}}rl._$name="RemoveAction";const il=Symbol("STORE_PROP"),sl=Symbol("ALL_RECORDS_PROP");class ol extends aa{static get defaultConfig(){return{store:n,allRecords:n,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[il]}set store(e){this[il]=e}get allRecords(){return this[sl]}set allRecords(e){this[sl]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:n}=this;e.add(t,n)}redo(){this.store.removeAll(this.silent)}}ol._$name="RemoveAllAction";const al=(e,t,n)=>new _a({model:e,newData:t,oldData:n}),ll=(e,t,n,r)=>new Na({parentModel:e,childModels:n,insertIndex:t,context:r}),cl=(e,t,n)=>new Ga({parentModel:e,childModels:t,context:n}),dl=(e,t,n)=>new qa({store:e,modelList:t,silent:n}),ul=(e,t,n,r,i)=>new Qa({store:e,insertIndex:t,modelList:n,context:r,silent:i}),hl=(e,t,n,r)=>new rl({store:e,modelList:t,context:n,silent:r}),gl=(e,t,n)=>new ol({store:e,allRecords:t,silent:n}),ml=(e,t,...n)=>{const r=e.state,i=t.call(e[ua],e,...n);if("string"==typeof i)e[ua]=Ca(i);else if(i instanceof da)e[ua]=i;else if(Array.isArray(i)){const[t,r]=i;"string"==typeof t?e[ua]=Ca(t):t instanceof da?e[ua]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[ua]=Ca(e[ua])),"function"==typeof r&&ml(e,r,...n)}else i&&"object"==typeof i&&((e=Object.assign(e,i))[ua]=Ca(e[ua]));r!==Ra&&r!==Aa&&i!==Ra&&i!==Aa&&e.trigger("ready")};class pl extends(Be(me)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:al,makeModelInsertChildAction:ll,makeModelRemoveChildAction:cl,makeStoreModelAddAction:dl,makeStoreModelInsertAction:ul,makeStoreModelRemoveAction:hl,makeStoreRemoveAllAction:gl,getTransactionTitle:null}}construct(...e){Object.assign(this,{[ua]:Ra,[ha]:[],[ga]:[],[ma]:0,[pa]:null,[fa]:null,[va]:!1}),super.construct(...e)}get state(){return this[ua]}get position(){return this[ma]}get length(){return this[ga].length}get stores(){return Array.from(this[ha])}hasStore(e){return this[ha].includes(e)}addStore(e){this.hasStore(e)||(this[ha].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[ha]=this[ha].filter((t=>t!==e)),e.stm=null)}forEachStore(e){this[ha].forEach((t=>e(t,t.id)))}get disabled(){return this.state===Sa}set disabled(e){const t=this;t.disabled!=e&&(ml(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===Ra||this.state===Aa}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===Ma||this.state===ka}get autoRecord(){return this[va]}set autoRecord(e){const t=this;t.autoRecord!=e&&ml(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){ml(this,this.state.onStartTransaction,e)}stopTransaction(e=null){ml(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){ml(this,this.state.onStopTransactionDelayed)}rejectTransaction(){ml(this,this.state.onRejectTransaction)}get transaction(){return this[pa]}get queue(){return this[ga].map((e=>e.title))}get isRestoring(){return this.state===Fa}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),ml(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),ml(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){ml(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore((t=>{t.onStmRecordingStart&&t.onStmRecordingStart(this,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore((n=>{n.onStmRecordingStop&&n.onStmRecordingStop(this,e,t)})),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore((e=>{e.onStmRestoringStart&&e.onStmRestoringStart(this)})),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop(){this.forEachStore((e=>{e.onStmRestoringStop&&e.onStmRestoringStop(this)})),this.trigger("restoringStop",{stm:this})}notifyStoresAboutQueueReset(e){this.forEachStore((t=>{t.onStmQueueReset&&t.onStmQueueReset(this,e)})),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,n){ml(this,this.state.onModelUpdate,e,t,n)}onModelInsertChild(e,t,n,r){ml(this,this.state.onModelInsertChild,e,t,n,r)}onModelRemoveChild(e,t,n){ml(this,this.state.onModelRemoveChild,e,t,n)}onStoreModelAdd(e,t,n){ml(this,this.state.onStoreModelAdd,e,t,n)}onStoreModelInsert(e,t,n,r,i){ml(this,this.state.onStoreModelInsert,e,t,n,r,i)}onStoreModelRemove(e,t,n,r){ml(this,this.state.onStoreModelRemove,e,t,n,r)}onStoreRemoveAll(e,t,n){ml(this,this.state.onStoreRemoveAll,e,t,n)}onUndoKeyPress(e){this.disabled||(e.shiftKey?this.canRedo&&(e.preventDefault(),this.redo()):this.canUndo&&(e.preventDefault(),this.undo()))}}pl._$name="StateTrackingManager";const fl=/^b-icon-/,vl=/^b-fa-/;class yl extends ki{static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,name:null,closeParent:null,href:null,target:null,localizableProperties:["text"]}}compose(){const{checked:e,href:t,hasMenu:n,name:r,target:i,text:s}=this,o=this.icon||("boolean"==typeof e?"b-fw-icon":"");return{tag:t?"a":"div",tabIndex:-1,href:t,target:i,class:{"b-has-submenu":n},dataset:{name:r,group:this.toggleGroup},children:{iconElement:o&&{tag:"i",class:d({"b-fa":vl.test(o),"b-icon":fl.test(o),"b-icon-checked":!0===e,"b-icon-unchecked":!1===e,"b-menuitem-icon":1},on.normalize(o,"object"))},textElement:{tag:"span",html:s,class:{"b-menu-text":1}},subMenuIcon:n&&{tag:"i",class:{"b-fw-icon":1,"b-icon-sub-menu":1}}}}}doAction(e){const t=this,n=this.parent,r={menu:n,item:t,element:t.element,bubbles:!0};if("boolean"==typeof t.checked){const e=!t.checked;t.toggleGroup&&!e||(t.checked=!t.checked)}t.trigger("beforeItem",r),t.trigger("item",r),t.closeParent&&n&&(n.rootMenu.close(),e&&!t.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.openMenu()}onFocusOut(e){super.onFocusOut(e),this.closeMenu()}openMenu(e){const t=this.menu;!this.disabled&&t&&(t.focusOnToFront=e,t.show(),this.owner.currentSubMenu=t)}closeMenu(){this._menu instanceof ki&&this.menu.close()}changeToggleGroup(e){return e&&"boolean"!=typeof this.checked&&(this.checked=!1),e}changeChecked(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:n,element:r}=e,i=[];return t&&n&&er.forEachSelector(e.rootElement,`[data-group=${n}]`,(e=>{if(e!==r){const t=ki.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}changeMenu(e,t){const n=this,{constrainTo:r,scrollAction:i}=n.owner;return!e||"object"!=typeof e||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),Cl.reconfigure(t,e,{owner:n,defaults:{type:"menu",align:"l0-r0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:n.element,owner:n,constrainTo:r,scrollAction:i}})}}yl.initClass(),yl._$name="MenuItem";const bl={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1};class Cl extends Ns{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1}}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),Tr.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){const t=this;t.items.some((e=>Boolean(e._menu)))&&t.element.classList.add("b-menu-with-submenu");t.items.some((e=>e.icon))&&t.element.classList.add("b-menu-with-icon"),super.afterShow(e)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=this,n=null===(e=t.parentMenu)||void 0===e?void 0:e.element.contains(er.getActiveElement(t.parentMenu)),r=t.items[0];return!n&&r instanceof yl?t.element:super.focusElement}onDocumentMouseDown(e){this.parentMenu&&this.parentMenu.owns(e.event.target)||super.onDocumentMouseDown(e)}hide(e){const t=this;super.hide(e),t.currentSubMenu&&!t.currentSubMenu.isDestroyed&&t.currentSubMenu.hide(e),t.parentMenu&&(t.parentMenu.currentSubMenu=null)}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&(this.triggerElement(t,e),e.stopImmediatePropagation())}onMouseOver(e){if(!1!==this.focusOnHover){const t=er.up(e.relatedTarget,".b-widget"),n=er.up(e.target,".b-widget"),r=ki.fromElement(n);!er.isTouchEvent&&n&&n!==t&&r.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[r],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseLeave(e){const t=this,{relatedTarget:n}=e,r=n&&t.owns(n);let i=n&&n instanceof HTMLElement&&ki.fromElement(n),s=!r;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!er.getAncestor(i.element,[e.target])}!r&&s&&(t.currentSubMenu&&t.currentSubMenu.hide(),t.currentSubMenu=t.selectedElement=null,t.element.contains(er.getActiveElement(t))&&er.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=ki.fromElement(e),n=t&&t!==this&&!(t instanceof yl);if("Escape"===e.key)return void(n?this:this.rootMenu).close();if(super.onInternalKeyDown(e),n)return;bl[e.key]&&e.preventDefault();const r=this.element,i=er.getActiveElement(r);this.navigateFrom(i!==r&&r.contains(i)?i:null,e.key,e)}navigateFrom(e,t,n){const r=this,i=r.treeWalker,s=e&&r.getItem(e);let o;switch(t){case"ArrowUp":i.currentNode=e||(e=r.bottomFocusTrap),i.previousNode(),o=i.currentNode;break;case"ArrowDown":i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),o=i.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(s&&s.menu?r.openSubMenu(e,s):r.triggerElement(e,n));break;case"ArrowRight":if(e&&s&&s.menu&&!e.classList.contains("b-disabled")){const t=r.openSubMenu(e,s);t&&t.focus()}else i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),o=i.currentNode;break;case"ArrowLeft":r.isSubMenu?r.hide():e||(i.currentNode=e||(e=r.topFocusTrap),i.nextNode(),o=i.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&r.triggerElement(e,n)}o&&(o===r.element?r.navigateFrom(r.bottomFocusTrap,"ArrowUp",n):o===e?r.navigateFrom(r.topFocusTrap,"ArrowDown",n):o.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:e.nodeType===Element.ELEMENT_NODE?ki.fromElement(e,"menuitem",this.contentElement):this.items.find((t=>t.id==e))}triggerElement(e,t){const n=this.getItem(e);n&&!n.disabled&&n.doAction(t)}get isSubMenu(){var e;return this===(null===(e=this.owner)||void 0===e?void 0:e.menu)}openSubMenu(e,t){const n=this,r=t.menu;if(r){if(!r.isVisible){const i={item:t,element:e};if(!1===n.trigger("beforeSubMenu",i))return;if(t.onBeforeSubMenu&&!1===t.onBeforeSubMenu(i))return;r.show()}return n.currentSubMenu=r}}set selectedElement(e){const t=this,n=t._selectedElement;if(n){const e=t.getItem(n),r=e&&e.menu;r&&r.hide(),n.classList.remove("b-active")}if(t._selectedElement=e,e){const n=er.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!n,focus:n})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((()=>e.currentNode.focus()))}get parentMenu(){let e=this.owner;if(e instanceof yl&&(e=e.owner),e instanceof Cl)return e}get rootMenu(){let e=this;for(;e.parentMenu&&e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}Cl.initClass(),Cl._$name="Menu";class wl extends uo{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:window}},menuConfig:null,items:{},triggerEvent:!1}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onElementKeyDown"]}}construct(...e){var t;const n=e[1===e.length?0:1];if(n&&"menuConfig"in n&&(s.deprecate("Grid","5.0.0","`menuConfig` attribute deprecated, in favour of `menu`"),n.menu=n.menuConfig),super.construct(...e),null===(t=this.type)||void 0===t||!t.length)throw new Error("Config 'type' is required to be specified for context menu")}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){this.triggerEvent===e.type&&this.internalShowContextMenu(e)}onElementKeyDown(e){}internalShowContextMenu(e){const t=this;if(t.disabled)return;const n=t.getDataFromEvent(e);t.shouldShowMenu(n)&&t.showContextMenu(n)}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}showContextMenu(e,t){var n;const r=this,i=er.isDOMEvent(e)?r.getDataFromEvent(e):e;if(null===(n=r._menu)||void 0===n||n.hide(),r.disabled)return;r.menuContext=i;const{type:s,client:o,processItems:a}=r,{event:l}=i,c=null!=l?l:nn.from(i.targetElement).center;var d;(j.assign(i,{point:l?[l.clientX+1,l.clientY+1]:[c.x,c.y],items:{},selection:r.client.selectedRecords}),r.callChainablePopulateMenuMethod(i),j.merge(i.items,r.baseItems),a&&!1===a(i)||!r.hasActiveMenuItems(i))||(r.populateItemsWithData(i),r.preventDefaultEvent(i),!1!==r.beforeContextMenuShow(i)&&!1!==o.trigger(`${s}MenuBeforeShow`,i)&&!1!==o.trigger(`${s}ContextMenuBeforeShow`,i)&&(r.menu.items=i.items,t?r.menu.showBy(t):r.menu.showByPoint(i.point),null===(d=r.touchMoveDetacher)||void 0===d||d.call(r),r.touchMoveDetacher=Tr.on({element:o.element,touchmove:()=>r.menu.hide(),once:!0})))}get baseItems(){if(!this._baseItems){const e=this,{namedItems:t}=e,n=e._baseItems=j.assign({},e.items);for(const e in n){const r=n[e];r&&(t&&e in t?n[e]="object"==typeof r?j.merge(j.clone(t[e]),r):t[e]:!0===r&&delete n[e])}}return this._baseItems}hideContextMenu(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}callChainablePopulateMenuMethod(e){var t,n;null===(t=(n=this.client)[`populate${A.capitalize(this.type)}Menu`])||void 0===t||t.call(n,e)}createContextMenuEventForElement(e){const t=nn.from(e).center,n=new MouseEvent(this.triggerEvent,{clientX:t.x,clientY:t.y});return Object.defineProperty(n,"target",{get:()=>e}),n}hasActiveMenuItems(e){return Object.values(e.items).some((e=>e))}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;null===(t=e.event)||void 0===t||t.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,t){const n=this,{client:r,type:i}=n;if(e)return Cl.reconfigure(t,e?Cl.mergeConfigs({owner:r,rootElement:r.rootElement,onItem(e){r.trigger(`${i}MenuItem`,e),r.trigger("contextMenuItem",e),r.trigger(`${i}ContextMenuItem`,e)},onToggle(e){r.trigger(`${i}MenuToggleItem`,e),r.trigger("contextMenuToggleItem",e)},onDestroy(){n.menu=null},onBeforeItem(e){Object.assign(e,n.menuContext)},onShow({source:e}){n.menuContext.menu=e,r.trigger(`${i}MenuShow`,n.menuContext),r.trigger(`${i}ContextMenuShow`,n.menuContext)}},e):null,n);null!=t&&t.isWidget&&t.destroy()}}wl._$name="ContextMenuBase";class Sl{static insertRule(e){const t=this.getStyleSheet(document.head),n=t.cssRules.length;if(t.insertRule(e,0),t.cssRules.length>n)return t.cssRules[0]}static findRule(e){let t,n="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),(r=>{if(t=Array.prototype.find.call(r.sheet.rules||r.sheet.cssRules,(t=>n?e(t):t.selectorText===e)),t)return!0})),t}static getStyleSheet(e=document.head){return e.$bryntumStylesheet||(e.$bryntumStylesheet=er.createElement({tag:"style",id:"bryntum-private-styles",type:"text/css",parent:e}).sheet),e.$bryntumStylesheet}}Sl._$name="CSSHelper";var El=e=>class extends(e||me){static get $name(){return"DragHelperContainer"}initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!er.up(e.target,t.ignoreSelector)){const n=er.getAncestor(e.target,t.containers,t.outerElement);if(n){const r=n.getBoundingClientRect();t.context={element:n,valid:!0,action:"container",offsetX:e.pageX-r.left,offsetY:e.pageY-r.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(e){const{context:t,floatRootOwner:n}=this,{element:r}=t,i=r.cloneNode(!0),s=r.getBoundingClientRect();i.classList.add(this.dragProxyCls),i.classList.add(this.draggingCls),((null==n?void 0:n.floatRoot)||er.getRootElement(r)).appendChild(i),t.dragProxy=i,i.style.width=s.width+"px",i.style.height=s.height+"px",er.setTranslateXY(t.dragProxy,s.left,s.top),t.dragging=r,r.classList.add(this.dropPlaceholderCls)}updateContainerDrag(e){const t=this,n=t.context;if(!n.started||!n.targetElement)return;const r=er.getAncestor(n.targetElement,t.containers,"b-grid"),i=n.dragging&&n.dragging.contains(er.getActiveElement(n.dragging));r&&er.isDescendant(n.element,r)||(i&&an.suspendFocusEvents(),r&&n.valid?t.moveNextTo(r,e):t.revertPosition(),i&&an.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,n=t.context,{dragging:r,dragProxy:i,valid:s,draggedTo:o,insertBefore:a,originalPosition:l}=n;r&&(n.valid=s&&o&&(r!==a||l.parent!==o),n.finalize=(e=n.valid)=>{!e&&this.context&&t.revertPosition(),r.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async?n.awaitingFinalization=!0:n.finalize())}abortContainerDrag(e=!1,t=null,n=!1){const r=this,i=r.context;i.dragging&&(i.dragging.classList.remove(r.dropPlaceholderCls),i.dragProxy.remove(),r.context={}),n||r.trigger(e?"drop":"abort",{context:i,event:t})}updateContainerProxy(e){const t=this,n=t.context,r=n.dragProxy;let i,s=e.pageX-n.offsetX,o=e.pageY-n.offsetY;if("number"==typeof t.minX&&(s=Math.max(t.minX,s)),"number"==typeof t.maxX&&(s=Math.min(t.maxX-r.offsetWidth,s)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-r.offsetHeight,o)),t.lockX?er.setTranslateY(r,o):t.lockY?er.setTranslateX(r,s):er.setTranslateXY(r,s,o),"touchmove"===e.type){const t=e.changedTouches[0];i=er.elementFromPoint(t.clientX,t.clientY)}else i=e.target;n.targetElement=i}moveNextTo(e,t){const n=this.context,r=n.dragging,i=e.parentElement;if(e!==r){const s=e.getBoundingClientRect().left+e.offsetWidth/2;t.pageX<s?(i.insertBefore(r,e),n.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,i.insertBefore(r,e.nextElementSibling)):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(i.appendChild(r),n.insertBefore=null),n.draggedTo=i}}revertPosition(){const e=this.context,t=e.originalPosition;if(t.next){t.next&&t.next.previousSibling===e.dragging||!t.next&&e.dragging===t.parent.lastChild||t.parent.insertBefore(e.dragging,t.next)}else t.parent.appendChild(e.dragging);e.draggedTo=null}};const Dl={pageXOffset:0,pageYOffset:0};var xl=e=>class extends(br(e||me)){static get $name(){return"DragHelperTranslate"}initTranslateDrag(){const e=this;e.mode=e.mode||"translateXY",!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>er.up(t,e.targetSelector))}grabTranslateDrag(e){const t=this,n=t.getTarget(e);return!!n&&(t.context={valid:!0,action:t.mode,element:n,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return er.up(e.target,this.targetSelector)}startTranslateDrag(e){const t=this,n=t.context,{relatedElements:r}=n;let i=n.dragProxy||n.element;if(i&&!n.started){const s=i,o=i.parentElement,a=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body,l=t.outerElement;if(t.cloneTarget){const e=er.getOffsetX(i,a),n=er.getOffsetY(i,a),r=i.offsetWidth,o=i.offsetHeight;i=t.createProxy(i),er.setTranslateXY(i,e,n),i.style.width=`${r}px`,i.style.height=`${o}px`,i.classList.add(t.dragProxyCls),a.appendChild(i),s.classList.add("b-drag-original"),t.hideOriginalElement&&s.classList.add("b-hidden")}Object.assign(t.context,{element:i,grabbed:s,grabbedParent:o,grabbedNextSibling:i.nextElementSibling,elementStartX:er.getTranslateX(i),elementStartY:er.getTranslateY(i),elementX:er.getOffsetX(i,a||l),elementY:er.getOffsetY(i,a||l),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||a===l}),i.classList.add(t.draggingCls),a&&(n.parentElement=i.parentElement,a!==i.parentElement&&a.appendChild(i),t.updateTranslateProxy(e)),r&&r.forEach((e=>{e.classList.add(t.draggingCls)}))}}applyConstraints(e,t,n){const r=this,i=r.dragWithin,{pageXOffset:s,pageYOffset:o}=i===document.body?window:Dl;return i&&r.constrain&&(t<0&&(t=0),t+e.offsetWidth>i.scrollWidth&&(t=i.scrollWidth-e.offsetWidth),n<0&&(n=0),n+e.offsetHeight>i.scrollHeight&&(n=i.scrollHeight-e.offsetHeight)),"number"==typeof r.minX&&(t=Math.max(r.minX+s,t)),"number"==typeof r.maxX&&(t=Math.min(r.maxX+s,t)),"number"==typeof r.minY&&(n=Math.max(r.minY+o,n)),"number"==typeof r.maxY&&(n=Math.min(r.maxY+o,n)),{constrainedX:t,constrainedY:n}}updateTranslateProxy(e,t){const n=this,{mode:r,lockX:i,lockY:s}=n,o=n.context,a=o.dragProxy||o.element,{relatedElements:l,relatedElDragFromPos:c}=o;o.scrollManagerElementContainsDragProxy&&t&&(o.scrollX=t.getRelativeLeftScroll(a),o.scrollY=t.getRelativeTopScroll(a)),o.pageX=e.pageX,o.pageY=e.pageY,o.clientX=e.clientX,o.clientY=e.clientY;let d=o.elementStartX+e.pageX-o.startPageX+o.scrollX,u=o.elementStartY+e.pageY-o.startPageY+o.scrollY;if(n.snapCoordinates){const e=n.snapCoordinates({element:a,newX:d,newY:u});d=e.x,u=e.y}const{constrainedX:h,constrainedY:g}=n.applyConstraints(a,d,u);if("translateXY"!==r||i||s?"translateX"===r||s?er.setTranslateX(a,h):("translateY"===r||i)&&er.setTranslateY(a,g):er.setTranslateXY(a,h,g),l){const e=i||"translateY"===r?0:h-o.elementStartX,t=s||"translateX"===r?0:g-o.elementStartY;l.forEach(((n,r)=>{const[i,s]=c[r];er.setTranslateXY(n,i+e,s+t)}))}o.newX=h,o.newY=g}finishTranslateDrag(e){const t=this,n=t.context,r=n.newX!==n.elementStartX,i=n.newY!==n.elementStartY,s=n.dragProxy||n.element,{relatedElements:o}=n;function a(){s.classList.remove(t.invalidCls),s.classList.remove(t.draggingCls),o&&o.forEach((e=>{e.classList.remove(t.invalidCls),e.classList.remove(t.draggingCls)})),s.classList.contains("b-aborting")||(t.hideOriginalElement&&n.grabbed.classList.remove("b-hidden"),n.grabbed.classList.remove("b-drag-original"))}if(!t.ignoreSamePositionDrop||"translateY"!==t.mode&&r||"translateX"!==t.mode&&i){if(!1===n.valid)t.abortTranslateDrag(!0,e);else{const r=nn.from(t.dragWithin||t.outerElement);!t.minX&&e.pageX<r.left||!t.maxX&&e.pageX>r.right||!t.minY&&e.pageY<r.top||!t.maxY&&e.pageY>r.bottom?(n.valid=!1,t.abortTranslateDrag(!0,e)):(n.finalize=(e=n.valid)=>{n.asyncCleanup&&a(),!e&&t.context?t.abortTranslateDrag(!0,null,!0):(t.cloneTarget||n.dragProxy)&&s.remove(),t.reset()},n.async=!1,t.trigger("drop",{context:n,event:e}),n.async?n.awaitingFinalization=!0:n.finalize())}n.asyncCleanup||a()}else t.abortTranslateDrag(!1,e)}abortTranslateDrag(e=!1,t=null,r=!1){const i=this,s=i.context,{relatedElements:o,relatedElStartPos:a,grabbed:l}=s,c=s.dragProxy||s.element,d=i.cloneTarget&&i.hideOriginalElement?l:c;let{elementStartX:u,elementStartY:h}=s;c&&s.started&&(!i.cloneTarget&&i.dragWithin&&i.dragWithin!==s.grabbedParent&&s.grabbedParent.insertBefore(c,s.grabbedNextSibling),l.classList.remove("b-hidden"),i.cloneTarget&&(i.hideOriginalElement&&([u,h]=er.getTranslateXY(l),er.alignTo(l,c),d.getBoundingClientRect()),c.remove()),d.classList.add("b-aborting"),"translateXY"!==i.mode||i.lockX||i.lockY||(er.setTranslateXY(d,u,h),o&&o.forEach(((e,t)=>{e.classList.add("b-aborting"),er.setTranslateXY(e,a[t][0],a[t][1])}))),("translateX"===i.mode||i.lockY)&&(er.setTranslateX(d,u),o&&o.forEach(((e,t)=>{e.classList.add("b-aborting"),er.setTranslateX(e,a[t][0])}))),("translateY"===i.mode||i.lockX)&&(er.setTranslateY(d,h),o&&o.forEach(((e,t)=>{e.classList.add("b-aborting"),er.setTranslateY(e,a[t][1])}))),i.setTimeout((()=>{d.classList.remove("b-aborting"),l.classList.remove("b-dragging"),l.classList.remove("b-drag-original"),i.cloneTarget||(o&&o.forEach(((e,t)=>{e.classList.remove("b-aborting")})),c.classList.remove("b-aborting"),c.classList.remove(i.draggingCls),c.classList.remove(i.invalidCls))}),i.transitionDuration,n,!0),r||i.trigger(e?"drop":"abort",{context:s,event:t})),i.reset()}};const Rl="onMouseDown",Tl="onMouseMove",Ml="onMouseUp",Fl="onDocumentClick",Al="onTouchStart",Il="onTouchMove",kl="onTouchEnd",Ol="onKeyDown";class Ll extends(me.mixin(Be,El,xl)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:null,isElementDraggable:null,targetSelector:null,dropTargetSelector:null,cloneTarget:!1,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,transitionDuration:300,clickSwallowDuration:50,ignoreSamePositionDrop:!0,floatRootOwner:null,testConfig:{transitionDuration:10,clickSwallowDuration:r.isEdge?300:50}}}construct(e){const t=this;super.construct(e),t.initListeners(),"container"===t.mode?t.initContainerDrag():t.mode.startsWith("translate")&&t.initTranslateDrag(),t.initialMode=t.mode}doDestroy(){this.abort(!0),super.doDestroy()}initListeners(){const e={element:this.outerElement,mousedown:Rl,thisObj:this};r.isTouchDevice&&(e.touchstart=Al),Tr.on(e)}onPointerDown(e){const t=this;if(!er.isVisible(e.target))return;if(t.context)return void(t.context.awaitingFinalization||(t.onMouseUp(e),t.reset()));if(t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;t.startEvent=e;if("container"===t.mode?t.grabContainerDrag(e):!!t.mode.startsWith("translate")&&t.grabTranslateDrag(e)){const n={element:document,thisObj:t,keydown:Ol};if("touches"in e?(n.touchmove={handler:Il,passive:!1},n.touchend=n.pointerup=kl):(n.mousemove=Tl,n.mouseup=Ml),t.removeListeners=Tr.on(n),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const e=nn.from(t.dragWithin,t.outerElement);t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}onTouchStart(e){const t=this;1===e.touches.length&&(t.touchStartTimer=t.setTimeout((()=>{t.touchStartTimer=null}),t.touchStartDelay,"touchStartDelay"),t.onPointerDown(e))}onMouseDown(e){0===e.button&&this.onPointerDown(e)}internalMove(e){const t=this,{context:n}=t,r=Tr.getDistanceBetween(t.startEvent,e);if(t.touchStartTimer&&r>t.dragThreshold)t.abort(!0);else if(!t.touchStartTimer&&n&&n.element&&e.target&&e.target.nodeType===Node.ELEMENT_NODE&&(n.started||r>=t.dragThreshold)){if(!n.started){if(!1===t.trigger("beforeDragStart",{context:n,event:e}))return t.abort();var i;"container"!==t.mode&&(t.lockY?t.mode="translateX":t.lockX?t.mode="translateY":t.mode=t.initialMode),n.action.startsWith("translate")?t.startTranslateDrag(e):"container"===n.action&&t.startContainerDrag(e),n.started=!0,null===(i=t.scrollManager)||void 0===i||i.startMonitoring(Ot.merge({scrollables:[{element:t.dragWithin||t.outerElement}],callback:e=>{null!=n&&n.element&&t.lastMouseMoveEvent&&(t.lastMouseMoveEvent.isScroll=!0,t.update(t.lastMouseMoveEvent,e))}},t.monitoringConfig)),n.outermostEl=e.target.closest(".b-outer")||document.body,n.outermostEl.classList.add("b-draghelper-active"),t.trigger("dragStart",{context:n,event:e})}"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.update(e)}}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const n=this,{context:r}=n,i=r.dragProxy||r.element,s=document.scrollingElement||document.body;let o=e.isScroll?er.elementFromPoint(e.clientX,e.clientY):e.target;if("touchmove"===e.type){const t=e.changedTouches[0];o=er.elementFromPoint(t.clientX+s.scrollLeft,t.clientY+s.scrollTop)}r.target=o,n.dropTargetSelector?r.valid=Boolean(o.closest(n.dropTargetSelector)):r.valid=!0,r.action&&("container"===r.action&&n.updateContainerProxy(e,t),r.action.startsWith("translate")&&n.updateTranslateProxy(e,t)),n.trigger("drag",{context:r,event:e}),"container"===r.action&&n.updateContainerDrag(e,t),i.classList[r.valid?"remove":"add"](n.invalidCls),e&&(n.lastMouseMoveEvent=e)}abort(e=!1){var t,r;const i=this,s=i.context;null===(t=i.scrollManager)||void 0===t||null===(r=t.stopMonitoring)||void 0===r||r.call(t),s&&(s.element.getBoundingClientRect(),s.valid=!1,"container"===s.action?i.abortContainerDrag(n,n,e):i.abortTranslateDrag(n,n,e)),i.reset()}removeListeners(){}reset(e){const t=this,n=t.context;null!=n&&n.started&&n.outermostEl.classList.remove("b-draghelper-active"),t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,n=t.context;var r;(t.removeListeners(),n)&&(null===(r=t.scrollManager)||void 0===r||r.stopMonitoring(),"container"===n.action?t.finishContainerDrag(e):n.started&&n.action.startsWith("translate")&&t.finishTranslateDrag(e),n.started?Tr.on({element:document,thisObj:t,click:Fl,capture:!0,expires:t.clickSwallowDuration,once:!0}):t.reset(!0))}onKeyDown(e){"Escape"===e.key&&this.abort()}createProxy(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}}Ll._$name="DragHelper";const Pl="onMouseDown",_l="onMouseMove",$l="onMouseUp",Hl="onDocumentClick",jl="onTouchStart",Bl="onTouchMove",Nl="onTouchEnd",zl="onKeyDown";class Vl extends(Be(me)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50}}construct(e){const t=this;super.construct(e),t.handleSelector||r.isHoverableDevice||(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>er.up(t,e.targetSelector)),e.grab){const{edge:t,element:n,event:r}=e.grab;e.startEvent=r;const i=e.getCursorOffsetToElementEdge(r,n,t);e.context={element:n,edge:t,valid:!0,async:!1,elementStartX:er.getTranslateX(n)||n.offsetLeft,elementStartY:er.getTranslateY(n)||n.offsetTop,newX:er.getTranslateX(n)||n.offsetLeft,newY:er.getTranslateY(n)||n.offsetTop,elementWidth:n.offsetWidth,elementHeight:n.offsetHeight,cursorOffset:i,startX:r.clientX+i.x+e.scrollLeft,startY:r.clientY+i.y+e.scrollTop,finalize:()=>{var t;return null===(t=e.reset)||void 0===t?void 0:t.call(e)}},n.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:Pl,touchstart:jl,thisObj:e};!e.handleSelector&&r.isHoverableDevice&&(t.mousemove={handler:_l,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),e.removeListeners=Tr.on(t)}removeListeners(){}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:zl,thisObj:this};e?(t.touchmove=Bl,t.touchend=t.pointerup=Nl):(t.mousemove=_l,t.mouseup=$l),this.removeDragListeners=Tr.on(t)}removeDragListeners(){}reset(){var e;null===(e=this.removeDragListeners)||void 0===e||e.call(this),this.context=null}onPointerDown(e,t){const n=this;n.startEvent=t,n.isElementResizable&&!n.isElementResizable(t.target,t)||n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),n.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const n=this,{context:r,direction:i}=n;if(null!=r&&r.element&&(r.started||Tr.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)){var s;if(!r.started)null===(s=n.scrollManager)||void 0===s||s.startMonitoring(Ot.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:i}],callback:e=>{var t;return(null===(t=n.context)||void 0===t?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:r,event:t}),r.started=!0;n.update(t)}else e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var n;const r=this,i=r.context;var s,o;(null===(n=r.removeDragListeners)||void 0===n||n.call(r),i)?(null===(s=r.scrollManager)||void 0===s||s.stopMonitoring(),i.started&&Tr.on({element:document,thisObj:r,click:Hl,expires:r.clickSwallowDuration,capture:!0,once:!0}),r.finishResize(t)):null===(o=r.reset)||void 0===o||o.call(r)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,n=t.context,r=nn.from(t.outerElement);n.currentX=Math.max(Math.min(e.clientX+n.cursorOffset.x,r.right),r.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY+n.cursorOffset.y,r.bottom),r.y)+t.scrollTop,t.updateResize(e),t.trigger("resizing",{context:n,event:e}),n.element.classList[!1===n.valid?"add":"remove"](t.invalidCls),e&&(t.lastMouseMoveEvent=e)}abort(e=!1){var t,n;const r=this;null===(t=r.scrollManager)||void 0===t||null===(n=t.stopMonitoring)||void 0===n||n.call(t),r.context?r.abortResize(null,e):r.isDestroyed||r.reset()}grabResizeHandle(e,t){const n=this;if(n.allowResize&&!n.allowResize(t.target,t))return!1;const r=n.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,s=i.clientX,o=i.clientY,a=n.targetSelector?er.up(t.target,n.targetSelector):t.target;if(a){let l;if(r){if(!t.target.matches(r))return!1;l="horizontal"===n.direction?t.pageX<er.getPageX(a)+a.offsetWidth/2?"left":"right":t.pageY<er.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===n.direction?n.overLeftHandle(t,a)?l="left":n.overRightHandle(t,a)&&(l="right"):n.overTopHandle(t,a)?l="top":n.overBottomHandle(t,a)&&(l="bottom"),!l)return n.context=null,!1;"touchstart"===t.type&&t.preventDefault();const c=n.getCursorOffsetToElementEdge(i,a,l);if(!1!==n.trigger("beforeResizeStart",{element:a,event:t}))return n.context={element:a,edge:l,isTouch:e,valid:!0,async:!1,direction:n.direction,elementStartX:er.getTranslateX(a)||a.offsetLeft,elementStartY:er.getTranslateY(a)||a.offsetTop,newX:er.getTranslateX(a)||a.offsetLeft,newY:er.getTranslateY(a)||a.offsetTop,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,cursorOffset:c,startX:s+c.x+n.scrollLeft,startY:o+c.y+n.scrollTop,finalize:()=>{var e;return null===(e=n.reset)||void 0===e?void 0:e.call(n)}},a.classList.add(n.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,n){const r=nn.from(t);let i=0,s=0;switch(n){case"left":i=r.x-e.clientX;break;case"right":i=r.x+r.width-e.clientX;break;case"top":s=r.y-e.clientY;break;case"bottom":s=r.y+r.height-e.clientY}return{x:i,y:s}}checkResizeHandles(e){const t=this,n=t.targetSelector?er.up(e.target,t.targetSelector):e.target;if(!n||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?er.up(e.target,t.handleContainerSelector):e.target,t.currentElement){let r=!1;r="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n),r?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?er.up(e.target,t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,n=t.context;t.allowEdgeSwitch&&("horizontal"===t.direction?n.edge=n.currentX>n.startX?"right":"left":n.edge=n.currentY>n.startY?"bottom":"top");const r=n.currentX-n.startX,i=n.currentY-n.startY,s=er.getExtremalSizePX(n.element,"minWidth")||t.minWidth,o=er.getExtremalSizePX(n.element,"maxWidth")||t.maxWidth,a=er.getExtremalSizePX(n.element,"minHeight")||t.minHeight,l=er.getExtremalSizePX(n.element,"maxHeight")||t.maxHeight,c="right"===n.edge||"bottom"===n.edge?1:-1,d=n.elementWidth+r*c,u=n.elementHeight+i*c;let h=Math.max(s,d),g=Math.max(a,u);o>0&&(h=Math.min(h,o)),l>0&&(g=Math.min(g,l)),n.element.style.flex&&(n.element.style.flex=""),"horizontal"===t.direction?(n.element.style.width=Math.abs(h)+"px",n.newWidth=h,"left"===n.edge||h<0?(n.newX=Math.max(Math.min(n.elementStartX+n.elementWidth-t.minWidth,n.elementStartX+r),0),t.skipTranslate||er.setTranslateX(n.element,n.newX)):"right"===n.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&er.setTranslateX(n.element,n.elementStartX)):(n.element.style.height=Math.abs(g)+"px",n.newHeight=g,"top"===n.edge||g<0?(n.newY=Math.max(Math.min(n.elementStartY+n.elementHeight-t.minHeight,n.elementStartY+i),0),t.skipTranslate||er.setTranslateY(n.element,n.newY)):"bottom"===n.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&er.setTranslateY(n.element,n.elementStartY))}finishResize(e){const t=this,n=t.context,r={context:n,event:e};if(n.element.classList.remove(t.resizingCls),n.started){let e=!1;e="horizontal"===t.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,t.trigger(e?"resize":"cancel",r),n.async||n.finalize()}else{var i;null===(i=t.reset)||void 0===i||i.call(t)}}abortResize(e=null,t=!1){const n=this,r=n.context;r.element.classList.remove(n.resizingCls),"horizontal"===n.direction?(er.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(er.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&n.trigger("cancel",{context:r,event:e}),n.isDestroyed||n.reset()}highlightHandle(){const e=this,t=e.targetSelector?er.up(e.currentElement,e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?er.up(e.currentElement,e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}overLeftHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.leftHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=nn.from(t);return i.width=n.getDynamicHandleSize(n.rightHandle,r),i.width>0&&i.contains(Tr.getPagePoint(e))}return!1}overRightHandle(e,t){const n=this,{offsetWidth:r}=t;if(n.rightHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=nn.from(t);return i.x=i.right-n.getDynamicHandleSize(n.leftHandle,r),i.width>0&&i.contains(Tr.getPagePoint(e))}return!1}overTopHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.topHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=nn.from(t);return i.height=n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Tr.getPagePoint(e))}return!1}overBottomHandle(e,t){const n=this,{offsetHeight:r}=t;if(n.bottomHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)){const i=nn.from(t);return i.y=i.bottom-n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Tr.getPagePoint(e))}return!1}}Vl._$name="ResizeHelper";const Wl=/>[ \t\r\n]+</g,Gl=/\s\s+/g;class Ul{static tpl(e,...t){let r=0,i=t.map(((t,i)=>{let s=e[i];return Array.isArray(t)?s+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(t===n&&(t=""),s+="string"==typeof t?t.trim():t),r++,s})).join("");return r<=e.length&&(i+=e[e.length-1]),i.replace(Wl,"><").replace(Gl," ").trim()}static docsTpl(e,...t){let r=0,i=t.map(((t,i)=>{let s=e[i];return Array.isArray(t)?s+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(t===n&&(t=""),s+="string"==typeof t?t.trim():t),r++,s})).join("");return r<=e.length&&(i+=e[e.length-1]),i.replace(Wl,"><").trim()}static repeat(e){return function(...t){return Ul.tpl(...t).repeat(e)}}static loop(e){}}Ul._$name="TemplateHelper";class Yl extends ki{static get $name(){return"Toast"}static get type(){return"toast"}static get configurable(){return{testConfig:{destroyTimeout:1,timeout:100},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:t,html:n,showProgress:r,style:i,timeout:s}=this;return{parent:e||this.floatRoot,class:d(d({},on.normalize(t,"object")),{},{"b-toast-hide":1}),html:n,style:i,children:{progressElement:r&&{style:`animation-duration:${s/1e3}s;`,class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:t}=this;return parseInt(t.style.bottom,10)+t.offsetHeight+e}show(){super.show();const e=this,{element:t}=e,{toasts:n}=Yl;var r,i;n.includes(e)||(t.style.bottom=(null!==(r=null===(i=n[0])||void 0===i?void 0:i.nextBottom)&&void 0!==r?r:e.bottomMargin)+"px",n.unshift(e),t.getBoundingClientRect(),t.classList.remove("b-toast-hide"),e.timeout>0&&(e.hideTimeout=e.setTimeout("hide",e.timeout)))}hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=Yl;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){Yl.toasts.slice().reverse().forEach((e=>e.hide()))}static show(e){const t=Yl.new({autoDestroy:!0,rootElement:document.body},"string"==typeof e?{html:e}:e);return t.show(),t}}Yl.toasts=[],Yl.initClass(),Yl._$name="Toast";class ql{static getById(e){return ki.getById(e)}static fromElement(e,t,n){return ki.fromElement(e,t,n)}static createWidget(e={}){return e.isWidget?e:ki.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>ki.create(Ot.assign({},t||{},e))))}static openPopup(e,t){return ki.create(Ot.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){const n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new Cr(...e)}:e instanceof Cr&&(t.forElement={target:e}),n.currentContextMenu=ki.create(t,"menu"),n.currentContextMenu.on("destroy",(()=>{n.currentContextMenu=null})),n.currentContextMenu}static attachTooltip(e,t){return ki.attachTooltip(e,t)}static hasTooltipAttached(e){return ki.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return ki.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),yi.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return Yl.show(e)}}ql._$name="WidgetHelper";class Kl{static convertFromObject(e,t={}){j.assignIf(t,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:n,elementName:r,includeHeader:i,rootElementForArray:s}=t;let{xmlns:o}=t;o=o?` xmlns="${o}"`:"";const a=e=>{const t=[];for(const n in e){const i=e[n];if(Array.isArray(i)){s&&t.push(`<${n}>`);for(const e of i)r.length?t.push(`<${r}>`):t.push(`<${n}>`),t.push(a(e)),r.length?t.push(`</${r}>`):t.push(`</${n}>`);s&&t.push(`</${n}>`)}else j.isObject(i)?t.push(`<${n}>${a(i)}</${n}>`):null==i?t.push(`<${n}/>`):t.push(`<${n}>${A.encodeHtml(i)}</${n}>`)}return t.join("")};return`${i?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':""}<${n}${o}>${a(e)}</${n}>`}}Kl._$name="XMLHelper";class Xl{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){let t,n=this.randomCache;return n[e]?t=n[e]:(t=this.random100.filter((t=>t<e)),n[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}}Xl._$name="RandomGenerator";class Zl{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,t=!1,r=1){const i=this,s=i.rnd,o=i.rndTime,a=i.rndRating,l=i.firstNames,c=i.surNames,d=i.teams,u=i.foods,h=i.colors,g=i.cities;for(let i=0;i<e;i++){const m=s.fromArray(l),p=s.fromArray(c),f=`${m} ${String.fromCharCode(65+i%25)} ${p}`,v=s.nextRandom(60)+1,y=new Date(2019,0,v),b=new Date(2019,0,v+s.nextRandom(30)+2),C={id:r>-1?i+r:n,title:"Row "+i,name:f,firstName:m,surName:p,city:s.fromArray(g),team:s.fromArray(g)+" "+s.fromArray(d),age:10+s.nextRandom(80),food:s.fromArray(u),color:s.fromArray(h),score:10*s.nextRandom(100),rank:s.nextRandom(100)+1,start:y,finish:b,time:Mt.getTime(o.nextRandom(24),5*o.nextRandom(12)),percent:s.nextRandom(100),done:s.nextRandom(100)<50,rating:a.nextRandom(5),relatedTo:Math.min(e-1,i+r+s.nextRandom(10))};t&&(C.rowHeight=5*s.nextRandom(!0===t?20:t)+20),yield C}}static generateData(e,t=!1,n=1,r=!0){r&&this.reset();const i=[],s=Zl.overrideRowCount?Zl.overrideRowCount:e,o=this.generate(s,t,n);for(let e=0;e<s;e++)i.push(o.next().value);return i}static generateRow(){return Zl.generateData(1,!1,-1,!1)[0]}}Object.assign(Zl,{rnd:new Xl,rndTime:new Xl,rndRating:new Xl,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}),Zl._$name="DataGenerator";const Jl=["action","target","to","deltaX","deltaY","x","y","text"];class Ql extends(Be(br())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),Tr.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:er.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",(e=>{e.isTrusted&&t.abort()}))}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),Tr.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,n){if(!e)return null;let r;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();r=new MouseEvent(t,Object.assign({view:window,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},n||{}))}else r=document.createEvent("Event"),r.initEvent(t,!0,!1);return e.dispatchEvent(r),r}handleMouseMove(e,t){const n=this,r=n.mouse;r.classList.add("quick"),n.mouseDown&&r.classList.add("drag");const i=nn.from(r,n.outerElement),s=i.x,o=i.y;let a=0,l=0;if(e.to)if("string"==typeof e.to){const t=n.outerElement.querySelector(e.to);if(t){const e=nn.from(t,n.outerElement),r=e.x+e.width/2,i=e.y+e.height/2;a=(r-s)/10,l=(i-o)/10}}else e.to.x?a=(e.to.x-s)/10:(a=e.to[0]/10,l=e.to[1]/10);else e.deltaX?a=e.deltaX/10:e.x&&(a=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;n.innerIntervalId=n.setInterval((()=>{if(n.shouldPause)return;9==c++&&(clearInterval(n.innerIntervalId),e.then&&e.then());const t=s+a*c,i=o+l*c;r.style.left=t+"px",r.style.top=i+"px";const d=r.getBoundingClientRect(),u=d.left,h=d.top,g=er.elementFromPoint(u,h);g!==n.prevTarget&&(n.prevTarget&&(n.mouseOutElements.push(n.prevTarget),er.isDescendant(n.mouseOutElements[0],g)||(n.mouseOutElements.forEach((e=>n.triggerEvent(e,"mouseout"))),n.mouseOutElements.length=0)),n.prevTarget=g,n.triggerEvent(g,"mouseover")),n.triggerEvent(g,e.action,{clientX:u,clientY:h})}),50)}getTarget(e){const t=this,n=e.target;return n?"function"==typeof n?n(e):document.querySelector(n):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!Jl.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),n=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,n}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<window.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,n=e.normalizeStep(e.steps[e.currentStep++]),r=e.getTarget(n),i=n.action;if(r&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(n,r);else{if(r!==e.prevTarget){const n=nn.from(r,e.outerElement);t.style.left=n.x+n.width/2+"px",t.style.top=n.y+n.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((()=>{if(e.prevTarget=r,t.classList.add(i),"type"===i){const e=ki.fromElement(r),t=n.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(r,i)}),"type"===i?100:550)}}}Ql._$name="DemoBot";const ec=Object.prototype.hasOwnProperty;let tc=null;class nc{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}}class rc{static get(e){if(null==e)return this.NULL;const t="string"==typeof e?e:JSON.stringify(e),n=this.cache;let r=n.get(t);return r||(tc=t,r=new this(e),n.set(t,r)),r}static get cache(){return ec.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return ec.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=tc,tc=null,t.initialize(),null===e)t.formatter=new nc(t);else{t.configure(e);for(const[e,n]of Object.entries(t.resolvedOptions()))null!=n&&e in t.defaults&&(t[e]=n)}}get parser(){return e=this,t=new this.constructor.Parser(this),Object.defineProperty(e,"parser",{value:t}),t;var e,t}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}}rc._$name="Formatter";const ic=A.escapeRegExp,sc=/[\d+-]/g,oc=(e,t)=>new Intl.NumberFormat(e||n,t),ac=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/;class lc extends rc{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return null==e?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;"string"!=typeof e?Object.assign(t,e):t.template=e;const n={},r=t.locale?Ve.locales[t.locale]:Ve.locale,i=r&&r.NumberFormat,s=t.template;if(i)for(const e in i)null==t[e]&&"function"!=typeof i[e]&&(t[e]=i[e]);if(s){const e=ac.exec(s),n=e[2],r=e[4];t.useGrouping=!!e[3],t.style=e[1]?"currency":e[6]?"percent":"decimal",n&&(t.integer=+n),"*"===r?t.fraction=[0,20]:null!=r&&(t.fraction=[e[5].length,r.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const e in t.defaults)null!=t[e]&&(n[e]=t[e]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=oc(t.locale,n)}as(e,t=null){const n=this.resolvedOptions()||{template:"9.*"},r=this._as;let i=t&&r[t];return i||("string"==typeof e?n.style=e:Object.assign(n,e),n.from=this,i=new lc(n)),t&&(r[t]=i),i}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}format(e){if("string"==typeof e){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,n=t.maximumFractionDigits,{truncator:r}=t;let i,s=t.parse(e);return r&&(s=r.format(s),i=s.indexOf(r.parser.decimal),i>-1&&s.length-i-1>n&&(s=s.substr(0,i+n+1)),s=r.parse(s)),s}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)e[t]===n&&(e[t]=this[t]);return e}_minMax(e,t,n){const r=this,i=r[e];if(null!=i){const s=A.capitalize(e),o=`maximum${s}Digits`,a=`minimum${s}Digits`;"number"==typeof i?(t&&(r[a]=i),n&&(r[o]=i)):(r[a]=i[0],r[o]=i[1])}}}lc.Parser=class{constructor(e){const t=this,n=e.locale,r=oc(n,{maximumFractionDigits:3}),i=e.is.currency?t._decodeStyle(n,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(n,{style:"percent"}):null,o=r.format(1.2).replace(sc,"")[0],a=r.format(1e9).replace(sc,"")[0]||"";Object.assign(t,{currency:i,decimal:o,formatter:e,grouper:a,percent:s}),t.decimal=o,t.decimalRe=ic(o,"g"),t.grouper=a,t.stripRe=new RegExp(`(?:\\s+|${ic(a)})`+(i?`|(?:${ic(i.text)})`:"")+(s?`|(?:${ic(s.text)})`:""),"g")}decimalPlaces(e){const t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,"."),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const n=oc(e,t),r=oc(e,Object.assign(n.resolvedOptions(),{style:"decimal"})),i=n.format(0),s=r.format(0);return{suffix:i.startsWith(s),text:i.replace(s,"").trim()}}},Object.assign(lc.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(lc.prototype,lc.prototype.defaults),rc.number=(e,t)=>lc.format(e,t),lc._$name="NumberFormat";var cc=e=>class extends(e||me){static get $name(){return"Finalizable"}construct(...e){super.construct(...e),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const e=this;let t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}async _awaitFinalizer(){const e=this;try{await e.finalizer}finally{e.finalizing=null,e.isFinalized=!0,e.doFinalize()}}};const dc=Symbol("dragAbort"),uc=Symbol("dragInit"),hc=Symbol("dragDrag"),gc=Symbol("dragDrop"),mc={x:"horizontal",y:"vertical"};class pc extends(me.mixin(cc,br)){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}construct(...e){super.construct(...e);const t=this,{event:n}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:n.target,endEvent:null,lastMoveEvent:null,metaKey:null,scrollerAction:null,shiftKey:null,state:uc,startEvent:n,touchStartTimer:null,_valid:!0}),"touches"in n&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"))}doDestroy(){const e=this,{source:t,target:n}=e;e.cleanup(),(null==n?void 0:n.dropping)===e&&(n.dropping=null),(null==t?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}get aborted(){return this.state===dc}get completed(){return this.aborted||null!==this.endEvent}get started(){return this.state!==uc&&!this.aborted}get valid(){return this.started&&null!=this.targetElement&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map((e=>this.get(e))));let t=this.data.get(e);return"function"==typeof t&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((e=>this.peek(e)));let t=this.data.get(e);return"function"==typeof t&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const n=this;n._target=e,t&&(t.dropping=null),e&&(e.dropping=n,e.dropping!==n&&(e=null,n.valid=!1)),n._target=t}return e}updateTarget(e,t){const n=this;t&&n.source.dragLeaveTarget(n,t),e&&(n.valid=!0,e.dragMove(n),n.source.dragEnterTarget(n))}updateTargetElement(e){let t,n,r,i,s;for(s=e;s;s=s.parentElement)if(n=sa.get(s,"droppables"),n)for(i=0;i<n.length;++i)if(t=n[i],t.dropRootElement.contains(e)&&(r=t.droppableSelector,(!r||e.closest(`#${er.getId(t.dropRootElement)} ${r}`))&&(this.target=t,this.target===t)))return}abort(){const e=this,{element:t,source:n}=e;null==t||t.getBoundingClientRect(),e.state!==gc&&(e.state=dc,e.cleanup()),null==n||n.endDrag(e)}begin(){const e=this,{source:t}=e;!1!==t.beforeDrag(e)&&(t.dragging=e)}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:n,target:r}=t,{dragSwallowClickTime:i}=t.source;t.event=t.endEvent=e,t.syncFlags(),t.started&&((null==n?void 0:n.clientX)===e.clientX&&(null==n?void 0:n.clientY)===e.clientY&&(null==n?void 0:n.target)===e.target||t.track(),i&&Tr.on({element:document,capture:!0,expires:i,once:!0,click(e){e.stopPropagation()}}),t.state=gc,r!==t.source&&(null==r||r.dragDrop(t)))}fakeKey(e,t){const n=this,{lastMoveEvent:r}=n;if(r&&n.element){let i;r.isKey=!0,"Alt"===e.key?n.altKey!==t&&(n.altKey=t,i=!0):"Control"===e.key&&n.ctrlKey!==t&&(n.ctrlKey=t,i=!0),i&&(n.event=r,n.track())}}keyDown(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return Tr.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return"Control"===e||"Alt"===e}move(e){const t=this,{target:n}=e,r=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)r&&t.abort();else if(n&&n.nodeType===Node.ELEMENT_NODE){if(r&&!t.started&&(t.event=e,!1===t.start()))return void t.abort();t.started&&(t.lastMoveEvent=t.event=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:n,source:r}=e,{draggingBodyCls:i,dragLock:s}=r,o=r.dragRootElement;if(e.state=hc,t){const r=t.startMonitoring(j.merge({scrollables:[{element:o}],direction:mc[s]||s||"both",callback(t){const{lastMoveEvent:n}=e;n&&e.element&&(n.isScroll=!0,e.event=n,e.scrollerAction=t,e.track(),e.scrollerAction=null)}},n));e.cleaners.push(r)}const a=r.dragRootElement.closest(".b-outer")||document.body;if(a.classList.add(i),e.cleaners.push((()=>a.classList.remove(i))),!1===r.startDrag(e))return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:n,target:r}=e;let i,s=t.target;"touchmove"===t.type&&(i=t.changedTouches[0],s=er.elementFromPoint(i.clientX,i.clientY)),e.targetElement=s,r===e.target&&(null==r||r.dragMove(e)),n.trackDrag(e)}}pc.prototype.STATE=pc.STATE=Object.freeze({ABORTED:dc,INIT:uc,DRAGGING:hc,DROPPED:gc}),pc._$name="DragContext";class fc extends(me.mixin(ui)){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:fc}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}}fc.initClass(),fc._$name="DragProxy";var vc=e=>class extends(e||me){static get $name(){return"Draggable"}static get configurable(){return{dragging:null,draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:r.isEdge?300:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}dragStart(e){}dragOver(e){}dragEnterTarget(e){}dragLeaveTarget(e,t){}dragDrop(e){}dragEnd(e){}get activeDrag(){const{dragging:e}=this;return null!=e&&e.started&&!e.completed?e:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:e,dragRootElement:t}=this;return e?null==t?void 0:t.closest(e):t}beforeDrag(e){const{dragSelector:t}=this;return!t||Boolean(e.element.closest(t))}beginDrag(e){const{draggingCls:t,draggingClassElement:n}=this;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t))))}async endDrag(e){const t=this,{dragEventer:n,dragProxy:r}=t;e.valid&&await t.dragDrop(e),t.dragEnd(e),null==r||r.dragEnd(e),null==n||n.trigger(e.valid?"drop":"dragCancel",{drag:e,event:e.event}),t.finalizeDrag(e)}async finalizeDrag(e){await e.finalize()}moveDrag(e){if(!1!==this.dragOver(e)){const{dragEventer:t,dragProxy:n}=this;null==n||n.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}setupDragContext(e){const t=this,{dragItemSelector:n}=t,{target:r}=e;return{event:e,itemElement:n?r.closest(n):r,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}startDrag(e){const{draggingStartedCls:t,draggingClassElement:n,draggingItemCls:r,dragEventer:i,dragProxy:s}=this,{itemElement:o}=e;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&n&&(n.classList.add(t),e.cleaners.push((()=>n.classList.remove(t)))),r&&o&&(o.classList.add(r),e.cleaners.push((()=>o.classList.remove(r)))),null==s||s.dragStart(e);const a=this.dragStart(e);return!1!==a&&(null==i||i.trigger("dragStart",{drag:e,event:e.event})),a}trackDrag(e){var t;const{dropTargetSelector:n}=this;e.valid=!(n&&(null===(t=e.targetElement)||void 0===t||!t.closest(n))),this.moveDrag(e)}configureListeners(e){const t=Ot.assign({thisObj:this},this.dragDocumentListeners);return"touches"in e.startEvent?(delete t.mousemove,delete t.mouseup):(delete t.contextmenu,delete t.touchmove,delete t.touchend,delete t.pointerup),t}updateDragging(e){const t=this;if(e){const n=t.configureListeners(e);e.cleaners.push(Tr.on(n)),t.beginDrag(e)}}changeDragProxy(e,t){return fc.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateDragRootElement(e,t){var n;const r=this,{draggableCls:i,dragItemSelector:s,onDragItemMouseMove:o}=r;if(null==t||t.classList.remove(i),null===(n=r._dragRootDetacher)||void 0===n||n.call(r),e){const t={thisObj:r,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart"};o&&(t.mousemove={delegate:s,handler:"onDragItemMouseMove"}),(r.dragItemOverCls||o||r.onDragItemMouseEnter||r.onDragItemMouseLeave)&&Object.assign(t,{mouseover:{delegate:s,handler:"onDragItemMouseOver"},mouseout:{delegate:s,handler:"onDragItemMouseOut"}}),e.classList.add(i),r._dragRootDetacher=Tr.on(t)}}onDragItemMouseOver(e){this.overItem=e}onDragItemMouseOut(e){this.dragging||(this.overItem=e)}changeOverItem(e){var t;return this.enterLeaveEvent=e,"mouseout"===e.type?(null===(t=e.relatedTarget)||void 0===t?void 0:t.closest(this.dragItemSelector))||null:e.target.closest(this.dragItemSelector)}updateOverItem(e,t){const{dragItemOverCls:n}=this;var r,i;t&&(n&&t.classList.remove(n),null===(r=this.onDragItemMouseLeave)||void 0===r||r.call(this,this.enterLeaveEvent,t));e&&(n&&e.classList.add(n),null===(i=this.onDragItemMouseEnter)||void 0===i||i.call(this,this.enterLeaveEvent,e))}onDragContextMenu(e){e.preventDefault()}onDragKeyDown(e){this.dragging.keyDown(e)}onDragKeyUp(e){this.dragging.keyUp(e)}onDragMouseDown(e){0===e.button&&this.onDragPointerDown(e)}onDragPointerDown(e){let{dragging:t}=this;t?t.isFinalizing||t.abort():(t=this.setupDragContext(e),t&&new pc(t).begin())}onDragPointerMove(e){const{dragging:t}=this;t&&!t.completed&&(null==t||t.move(e))}onDragPointerUp(e){const{dragging:t}=this;t&&!t.completed&&(t.end(e),this.endDrag(t))}onDragTouchStart(e){1===e.touches.length&&this.onDragPointerDown(e)}},yc=e=>class extends(e||me){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get droppableCls(){return"b-droppable"}dragEnter(e){}dragMove(e){}dragDrop(e){}dragLeave(e){}changeDropping(e,t){if(e!==t){const n=this;t&&(!t.aborted&&t.completed||n.dragLeave(t)),e&&(n._dropping=e,!1===n.dragEnter(e)&&(e=null),n._dropping=t)}return e}updateDropRootElement(e,t){const n=this,{droppableCls:r}=n;let i,s,o;t&&(i=sa.get(t,"droppables"),o=!0,Array.isArray(i)&&(s=i.indexOf(n))>-1&&(i.length<2?sa.remove(t,"droppables"):(i.splice(s,1),i.forEach((e=>{r===e.droppableCls&&(o=!1)})))),o&&t.classList.remove(r)),e&&(i=sa.get(e,"droppables"),i?i.push(n):sa.set(e,"droppables",[n]),e.classList.add(r))}};const bc="b-hover-edge",Cc="b-hover-top",wc="b-hover-right",Sc="b-hover-bottom",Ec="b-hover-left",Dc={[bc]:1,[Cc]:1,[wc]:1,[Sc]:1,[Ec]:1},xc={t:[bc,Cc],r:[bc,wc],b:[bc,Sc],l:[bc,Ec],tr:[bc,Cc,wc],bl:[bc,Sc,Ec],tl:[bc,Cc,Ec],br:[bc,Sc,wc]};var Rc=e=>class extends e{static get $name(){return"LoadMaskable"}static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"b-icon b-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"]}}applyLoadMask(){const e=this,{loadMask:t}=e;t&&(e.masked=yi.mergeConfigs(e.loadMaskDefaults,t))}applyMaskError(e){const{loadMaskError:t,masked:n}=this;n&&(Ot.assign(n.errorDefaults,t),n.error=e)}get widgetClass(){}};class Tc extends(br(me)){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:0},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0}}}changeMonitoring(e,t){return null==t||t.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return 0!==Object.keys(this.activeScroll).length}startMonitoring(e={}){const t=this,{element:n,direction:r}=t,{scrollables:i=[],direction:o=r,callback:a}=e,l=[];return e.element&&(s.deprecate("core","5.0.0","`element` config is deprecated, please use `scrollables` instead."),i.push({element:e.element})),i.length||i.push({element:n}),i.forEach((e=>{const r=e.element;"string"==typeof r?er.forEachSelector(n,r,(n=>{t.createMonitor(n,e.direction||o,e.callback||a),l.push(n)})):(t.createMonitor(r,e.direction||o,e.callback||a),l.push(r))})),function(){t.stopMonitoring(l)}}createMonitor(e,t,n){const{monitoring:r}=this;r.has(e)||r.set(e,new Mc({scrollManager:this,element:e,direction:t,callback:n}))}stopMonitoring(e){const t=this,{monitoring:n}=t;if(e&&!Array.isArray(e)&&(e=[e]),n){if(!e)return void n.forEach((e=>t.stopMonitoring(e.element)));e.forEach((e=>{const t=n.get(e);t&&(t.destroy(),n.delete(e))}))}}requestScroll(e,t){const{activeScroll:n}=this;return(!(e in n)||n[e]===t)&&(n[e]=t,!0)}releaseScroll(e){const{activeScroll:t={}}=this;Object.keys(t).forEach((n=>{t[n]===e&&delete t[n]}))}getRelativeScroll(e,t="left"){let n=0;return this.monitoring.forEach(((r,i)=>{er.isDescendant(i,e)&&(n+="left"===t?r.scrollRelativeLeft:r.scrollRelativeTop)})),n}}class Mc extends me{construct(e){const{element:t}=e,n=t.scrollLeft,r=t.scrollTop;Object.assign(e,{startScrollLeft:n,startScrollTop:r}),super.construct(e),Tr.on({element:t,scroll:"onElementScroll",mousemove:"onMouseMove",touchmove:"onMouseMove",capture:!0,thisObj:this}),Tr.on({element:t,pointerleave:"onPointerLeave",thisObj:this})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){this.scrolling=!0,this.performScroll()}stopScroll(){const e=this;e.scrolling=!1,e.scrollRequested&&(e.scrollManager.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),e.scrollManager.clearTimeout(e.scrollTimeout),e.scrollManager.releaseScroll(e),e.scrollTimeout=null}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const t=this,{scrollManager:n}=t,r=t.element.getBoundingClientRect(),i=n.zoneWidth,s=n.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,"vertical"!==t.direction){const{scrollLeft:n,scrollWidth:o,clientWidth:a}=t.element;e.clientX>r.right-i&&o-n-a>=1?t.scrollDeltaX=Math.round((i-(r.right-e.clientX))/s)+1:e.clientX<r.left+i&&n>0&&(t.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/s)-1)}if("horizontal"!==t.direction){const{scrollTop:n,scrollHeight:o,clientHeight:a}=t.element;e.clientY>r.bottom-i&&o-n-a>=1?t.scrollDeltaY=Math.round((i-(r.bottom-e.clientY))/s)+1:e.clientY<r.top+i&&n>0&&(t.scrollDeltaY=-Math.round((i+(r.top-e.clientY))/s)-1)}0===t.scrollDeltaX||n.requestScroll("horizontal",t)||(t.scrollDeltaX=0),0===t.scrollDeltaY||n.requestScroll("vertical",t)||(t.scrollDeltaY=0),0===t.scrollDeltaX&&0===t.scrollDeltaY?t.stopScroll():t.scrollTimeout||(t.scrollTimeout=n.setTimeout((()=>t.startScroll()),n.startScrollDelay))}performScroll(){const e=this,{element:t}=e;if(e.scrolling&&!e.scrollRequested){if(0!==e.scrollDeltaX){const n=t.scrollLeft,r=Math.min(n+e.scrollDeltaX,t.scrollWidth-t.clientWidth);r!==n&&(t.scrollLeft=r)}if(0!==e.scrollDeltaY){const n=t.scrollTop,r=Math.min(n+e.scrollDeltaY,t.scrollHeight-t.clientHeight);r!==n&&(t.scrollTop=r)}e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame((()=>{e.scrollRequested=!1,e.performScroll(e)}))}}onElementScroll(){var e,t;null===(e=this.config)||void 0===e||null===(t=e.callback)||void 0===t||t.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}}Tc._$name="ScrollManager";class Fc extends fc{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}dragMove(e){const{offset:t,tooltip:n}=this,{event:r}=e;n&&(n.isVisible||n.show(),n.alignTo({align:this.align,target:new nn(r.clientX-t,r.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return ki.reconfigure(t,e,this)}}Fc.initClass(),Fc._$name="DragTipProxy";const Ac=6e4,Ic=36e5,kc=864e5,Oc=/(\d+)?:?(\d*)/;class Lc{static format(e){const t=Math.floor(e/Ic),n=Math.floor(e/Ac)%60;return`${t}:${n<10?"0":""}${n}`}static parse(e){const t=typeof e;if("string"===t){const t=Oc.exec(e);e=Number(t[1]||0)*Ic+Number(t[2]||0)*Ac}else"number"!==t?e=Mt.getTimeOfDay(e):e<=24&&(e*=Ic);return Math.min(Math.max(Math.floor(e),0),kc)}constructor(e){let t,n,r=0;null!=e&&e.isDayView?(r=e.dayStartShift,t=e.dayStartTime,n=e.dayEndTime):"number"==typeof e?r=t=n=e:e&&(r=e.startShift,t=e.timeStart,n=e.timeEnd),this.startShift=r=Lc.parse(r||0),this.timeEnd=(null==n?(r+kc)%kc:Lc.parse(n))||kc,this.timeStart=null==t?r:Lc.parse(t)}get startHour(){return Math.floor(this.timeStart/Ic)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?kc-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),Mt.makeKey(e)}dayOfDate(e){return this.shiftDate(Mt.clearTime(e))}dayOfWeek(e){return(e=this.shiftDate(e,-1)).getDay()}delta(e,t="ms"){const{timeStart:n}=this,r=Lc.parse(e),i=(r<n?r+kc:r)-n;return"ms"===t?i:Mt.as(t,i,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:n}=this,r=t<n?n-t:kc-t+n;return"ms"===e?r:Mt.as(e,r,"ms")}equals(e){return this.startShift===(null==e?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const n=this,{timeStart:r,timeEnd:i}=n,[s,o]=n._dateRangeArgs(e,t),[a,l]=n.timeRange(s,o);return r<i?a<l?a<i&&r<=l:a<i||r<=l:!(a<l)||a<i||r<=l}isIntraDay(e,t){const[n,r]=this._dateRangeArgs(e,t),i=this.startOfDay(n),s=kc-Mt.diff(i,r,"ms");return!(s<0)&&(s>0||i<n)}outside(e){const{startShift:t,timeStart:n,timeEnd:r}=this,i=Lc.parse(e);return n<r?i<n?i<t?1:-1:i<r?0:i<t?-1:1:i<r||i>=n?0:i<t?1:-1}shiftDate(e,t=1){const{startShift:n}=this;return e="number"==typeof e?new Date(e):e,t&&n?Mt.add(e,t>0?n:-n,"ms"):e}startOfDay(e){return e=this.shiftDate(e,-1),e=Mt.clearTime(e),e=this.shiftDate(e)}timeRange(e,t){const[n,r]=this._dateRangeArgs(e,t);return[Mt.getTimeOfDay(n),Mt.getTimeOfDay(r)]}toString(){const{startShift:e,timeEnd:t,timeStart:n}=this,r=e?`@${Lc.format(e)}`:"",i=Lc.format(n);return n===t?e?r:i:`${i}-${Lc.format(t)}${r}`}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}}Lc.MIDNIGHT=new Lc({startShift:0,startTime:0,endTime:24}),Lc.MILLIS_PER_MINUTE=Ac,Lc.MILLIS_PER_HOUR=Ic,Lc.MILLIS_PER_DAY=kc,Lc._$name="DayTime";class Pc extends(Be(me)){static get configurable(){return{date:{$config:{equal:"date"},value:Mt.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date)}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?Mt.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("Month date ingestion must be passed a Date, or a valid YYYY-MM-DD date string");return e}}updateDate(e,t){const n=this,{dayColumnIndex:r}=n,i=Mt.getFirstDateOfMonth(e),s=Mt.getLastDateOfMonth(i),o=r[i.getDay()],a=r[s.getDay()],l=!t||e.getFullYear()!==t.getFullYear(),c=n.eventListeners&&(t?e.getDate()!==t.getDate()|(n.getWeekId(e)!==n.getWeekId(t))<<1|(e.getMonth()!==t.getMonth())<<2|l<<3:15);if(n._year=e.getFullYear(),n._month=e.getMonth(),n.startDayOfMonth=1-o,n.endDayOfMonth=s.getDate()+(6-a),n.sixWeeks&&(n.endDayOfMonth+=7*(6-n.weekCount)),n.weekBase&&!l||n.calculateWeekBase(),c){const r={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&c),m:Boolean(12&c),y:Boolean(8&c)}};n.trigger("dateChange",r),2&c&&n.trigger("weekChange",r),12&c&&n.trigger("monthChange",r),8&c&&n.trigger("yearChange",r)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,n=new Date(e.year,0,1),r=new Date(e.year,11,31),i=e.month?e.getOtherMonth(n):e;e.dayColumnIndex[n.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);const s=Math.floor(Mt.diff(e.weekBase,r,"day")/7);e.has53weeks=53===s&&t[r.getDay()]>2}getWeekStart(e){if("number"==typeof e)return Mt.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[n,r]=e;return n===t.year?t.getWeekStart(r):t.getOtherMonth(new Date(n,0,1)).getWeekStart(r)}getOtherMonth(e){const t=this,n=t===_c?new Pc(null):_c;return n.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),n.date=e,n.updateDate(n.date,n.date),n}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:Mt.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||Mt.nonWorkingDays}changeNonWorkingDays(e){return Ot.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:n}=t;for(let r=t.startDayOfMonth,i=0;i<n;i++){const n=[],i=t.getWeekNumber(new Date(t.year,t.month,r));for(let e=0;e<7;e++,r++)n.push(new Date(t.year,t.month,r));e(i,n)}}getWeekNumber(e){const t=this;if((e=Mt.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let n=Math.floor(Mt.diff(t.weekBase,e,"day")/7),r=e.getFullYear();return n?(53!==n||t.has53weeks?n>53&&(n%=52):(n=1,r++),[r,n]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e,t,n=Lc.MIDNIGHT){const r=this,i=e.getDay(),s=r.visibleDayColumnIndex[i],o=r.nonWorkingDays[i],a=r.hideNonWorkingDays&&o;return(e<r.startDate||e>r.endDate)&&(r.month=e.getMonth()),{day:i,dayTime:n,visibleColumnIndex:s,isNonWorking:o,week:r.getOtherMonth(e).getWeekNumber(e),key:Mt.format(e,"YYYY-MM-DD"),columnIndex:r.dayColumnIndex[i],date:new Date(e),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!a&&e>=t.startDate&&e<Mt.add(t.endDate,1,"day"),tomorrow:n.dayOfDate(Mt.add(e,1,"day")),isRowStart:0===s,isRowEnd:s===r.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:n,hideNonWorkingDays:r}=e,i=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],o=e.visibleDayColumnIndex=[];let a=0;for(let e=0;e<7;e++){const l=(t+e)%7;s[e]=l,i[l]=e,r&&n[l]||(o[l]=a++)}e.visibleColumnCount=a,e.weekLength=r?7-Ot.keys(n).length:7}}const _c=new Pc(null);Pc._$name="Month";let $c=0;const Hc=new WeakMap,jc=e=>{const t=new Map;return(...r)=>{const i=((...e)=>e.map((e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=Hc.get(e),t===n&&(t=++$c,Hc.set(e,t))):t=String(e),t})).join("-"))(r);let s=t.get(i);return s===n&&(s=e(...r),t.set(i,s)),s}},Bc=e=>{const t=new Map,r=e=>e[0],i=e=>e[1],s=(e,t)=>r(e).push(t);return(o,a)=>{const l=(e=>{let r=t.get(e);return r===n&&(r=[[],[]],t.set(e,r)),r})(o);(e=>!i(e).length&&!r(e).length)(l)?(s(l,a),e(o,(e=>{((e,t)=>i(e).some((e=>Ot.isEqual(e,t))))(l,e)||(((e,t)=>{i(e).push(t)})(l,e),r(l).forEach((t=>t(e))))}))):(s(l,a),i(l).forEach((e=>a(e))))}},Nc=Symbol("success"),zc=Symbol("failure"),Vc=(e,t)=>[Nc,e,t],Wc=e=>[zc,e],Gc=e=>e.length&&e[0]===Nc,Uc=e=>"function"!=typeof e||e.length?e:e(),Yc=jc((e=>Bc(((t,n)=>n(Vc(e,t)))))),qc=jc((e=>Bc(((t,n)=>{const r=Math.min(e.length,t.length),i=t.substr(0,r),s=t.substr(r);n(i===e?Vc(i,s):Wc(s))})))),Kc=(e,t)=>(n,r)=>Uc(e)(n,(e=>{if(Gc(e)){const[,n,i]=e;t(n)(i,r)}else r(e)})),Xc=jc(((...e)=>{const t=jc(((e,t)=>Bc(Kc(e,(e=>Kc(t,(t=>Yc([].concat(e,t)))))))));return e.reduce(t,Yc([]))})),Zc=jc(((...e)=>Bc(((t,n)=>e.forEach((e=>Uc(e)(t,n))))))),Jc=jc((e=>(t,n)=>{const r=new RegExp(`^${e}`).exec(t);if(r){const e=r[0],i=t.substr(e.length);n(Vc(e,i))}else n(Wc(t))})),Qc=jc(((e,t)=>Kc(e,((...e)=>Yc(t(...[].concat.apply([],e))))))),ed=(e,t)=>{const n=[];return e(t,(e=>{if(Gc(e)){const[,,t]=e;""===t&&n.push(e)}})),n};var td={memo:jc,memoCps:Bc,success:Vc,failure:Wc,isSuccess:Gc,resolveParser:Uc,succeed:Yc,string:qc,bind:Kc,seq:Xc,alt:Zc,regexp:Jc,red:Qc,runParser:ed,defineParser:e=>(t,n)=>n?Uc(e)(t,n):ed(Uc(e),t)};class nd extends qs{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){"hidden"===e.inputType&&(e.hidden=!0),super.construct(...arguments)}}nd.initClass(),nd._$name="TextField";class rd extends nd{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;null===(e=this.globalTapListener)||void 0===e||e.call(this),super.doDestroy()}updateEditable(e){const t=this,n=t.element;var r;(super.updateEditable(...arguments),!1===e)?(null===(r=t.globalTapListener)||void 0===r||r.call(t),n.classList.add("b-not-editable"),Tr.on({element:t.input,click:"onTriggerClick",thisObj:t})):t.globalTapListener=an.on({globaltap:"showKeyboard",thisObj:t})}changePicker(e,t){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){if(this._picker)return[this.picker]}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let n=!0;if("keydown"===e.type&&!t.disabled)if(t.pickerVisible){const{picker:r}=t;"Escape"===e.key?(e.stopImmediatePropagation(),t.hidePicker(),n=!1):r.onInternalKeyDown?r.onInternalKeyDown(e):"ArrowDown"===e.key&&r.focusable&&r.focus()}else"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));n&&super.internalOnKeyEvent(e)}onFocusIn(e){super.onFocusIn(e),this.autoExpand&&(this.minChars=0,this.onTriggerClick(e))}onFocusOut(e){this.autoClosePicker(),super.onFocusOut(e)}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;er.isTouchEvent&&er.getActiveElement(t)===t&&e.target===t&&(an.suspendFocusEvents(),t.blur(),t.focus(),an.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,{picker:n}=t;t.pickerHideShowListenersAdded||(n.on({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),n.autoClose=t.autoClose,n.show(),n.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=an.on({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=Tr.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){const e=this;e.pickerVisible=!1,e.element.classList.remove("b-open"),e.trigger("togglePicker",{show:!1}),e.pickerTapOutRemover&&e.pickerTapOutRemover(),e.pickerKeyDownRemover&&e.pickerKeyDownRemover()}onPickerTapOut({event:e}){this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key){const t=er.getActiveElement(this.input),n=new KeyboardEvent("keydown",e);this.input.dispatchEvent(n),n.defaultPrevented&&e.preventDefault(),er.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;er.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((()=>e.readOnly=!1),500)),super.focus()}}rd._$name="PickerField";const id=document.createRange();class sd extends ki{static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"b-icon-check",items:null,store:null,navigator:!0,scrollable:{x:!1,y:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,selectAllItem:!1,itemTpl:e=>A.encodeHtml(e.text),groupHeaderTpl:(e,t)=>A.encodeHtml(t),allowGroupSelect:!0,selected:{},activateOnMouseover:null}}construct(e,...t){const n=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:r}=n,{classList:i}=r;n.multiSelect&&i.add("b-multiselect"),n.store&&n.store.count?n.refresh():i.add("b-empty"),n.store.isGrouped&&(i.add("b-grouped"),n.store.on({groupchange:()=>n.refresh(),thisObj:n})),Tr.on({element:r,delegate:n.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:n})}doDestroy(){var e;this.detachListeners("store"),null===(e=this.navigator)||void 0===e||e.destroy(),super.doDestroy()}onFocusIn(e){const t=e._target.classList.contains(this.itemCls)?e._target.dataset.id:0;this.restoreActiveItem(this.navigator.previousActiveItem||this.getItem(t)),super.onFocusIn(e)}contentTpl(){const e=this,t=e.store.records.map(((t,n)=>e.itemWrapperTpl(t,n)));return e.multiSelect&&!1!==e.selectAllItem&&t.unshift(e.selectAllItemTpl()),Ul.tpl`${t}`}itemWrapperTpl(e,t){return Ul.tpl`<div class="${this.getItemClasses(e,t)}" data-index="${t}" data-id="${A.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>
            ${this.itemContentTpl(e,t)}
            </div>`}itemContentTpl(e,t){return"groupRowFor"in e.meta?this.groupHeaderTpl(e,A.capitalize(e.groupChildren[0][e.meta.groupField])):`${this.itemIconTpl(e,t)}${this.itemTpl(e,t)}`}itemIconTpl(e,t){return this.multiSelect?`<div class="b-selected-icon b-icon ${this.selectIconCls}"></div>`:""}selectAllItemTpl(){return`<div class="${this.itemCls} b-select-all-item" data-noselect data-select-all data-id="select-all">${this.itemIconTpl()}<div>${this.optionalL("Select All")}</div></div>`}getItemClasses(e){var t;const n=this,r=null===(t=n._navigator)||void 0===t?void 0:t.activeItem,i=(null==r?void 0:r.dataset.id)==e.id,s="groupRowFor"in e.meta?"b-list-item-group-header":"",o=n.selected.includes(e);return`${n.itemCls} ${e.cls||""} ${o?n.selectedCls:""} ${i?n.navigator.focusCls:""} ${s}`}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:n,record:r,changes:i}){const s=this;switch(t){case"remove":s.selected.remove(n);break;case"clear":s.selected.clear();break;case"update":{const{id:e}=i;return e&&er.setAttributes(s.contentElement.querySelector(`[data-id="${A.encodeHtml(e.oldValue)}"]`),{"data-id":e.value}),void s.refreshItem(r)}}s.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;if(e.isVisible){const{activeItem:t}=e.navigator;e.paintListener=null;const n=er.createElementFromTemplate(e.contentTpl(),{fragment:!0});e.clearItems().insertNode(n),t&&e.restoreActiveItem(t),e.refreshCount=(e.refreshCount||0)+1,e.element.classList[e.store.count>0?"remove":"add"]("b-empty")}else e.paintListener||(e.paintListener=e.on({paint:"refresh",thisObj:e,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),n=e.contentElement.lastChild;if(t){const n=e.contentElement.querySelectorAll(`${e.itemSelector}:not(.b-mask)`);id.setStartBefore(t),id.setEndAfter(n[n.length-1]),id.deleteContents()}else n?(id.setStartAfter(n),id.setEndAfter(n)):(id.setStart(e.contentElement,0),id.setEnd(e.contentElement,0));return id}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const n=this.store.indexOf(t),r=er.createElementFromTemplate(this.itemWrapperTpl(t,n));er.sync(r,e)}}}getItem(e){var t;if(null!=e)return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e}"]`):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),null!=(null===(t=e)||void 0===t?void 0:t.id)&&(e=e.id),this.contentElement.querySelector(`[data-id="${A.encodeHtml(e)}"]`))}getRecord(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=ta.getStore(e)}updateSelected(e){e&&e instanceof Xi||(e=new Xi(e)),this._selected=e,e.on({change:"onSelectionChange",thisObj:this})}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this._thisIsAUsedExpression(this.items),this._store}changeStore(e){const t=this;if(e instanceof ta||(e=new ta(e)),t.detachListeners("store"),e){const n={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(n.beforeLoad="onBeforeStoreLoad",n.afterRequest="onAfterStoreRequest"),e.on(n)}return e}updateStore(){this.refresh()}changeNavigator(e){const t=this,{element:n}=t;return n&&(e=(e.class||Ks).new({ownerCmp:t,target:n,keyEventTarget:n},e)).keyEventTarget===n&&(n.tabIndex=0),e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return this.store.count?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator.activeItem=null,super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight;const n=super.show();return this.refreshCount===e&&this.restoreActiveItem(t,!0),n}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const n=this,{navigator:r,lastAlignSpec:i}=n;if(null!=e){if("string"!=typeof t){const e=i?i.zone:1;t=1&e?"nearest":e?"start":"end"}(e=n.getItem(e))&&(n.scrollable.scrollIntoView(e,{block:t}),r.activeItem=e)}}onMouseOver(e){const t=this,n=e.currentTarget;!er.isTouchEvent&&n&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[n],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;switch(e.key){case" ":if("INPUT"===e.target.nodeName.toUpperCase()&&!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const n=this,r=parseInt(e.dataset.index);let i=n.store.getAt(r);if(n._isUserAction=!0,n.trigger("item",{item:e,record:i,index:r,event:t,userAction:!0}),n.allowGroupSelect||!i.isSpecialRow){if(e.contains(t.target.closest("[data-noselect]")))e.contains(t.target.closest("[data-select-all]"))&&n.onSelectAllClick(e,t);else{const e=n.selected;let r=e.includes(i);n.multiSelect?(n.toggleAllIfCtrlPressed&&t.ctrlKey?i=n.store.getRange():n.allowGroupSelect&&i.isSpecialRow&&(r=!i.groupChildren.some((t=>!e.includes(t))),i=i.groupChildren),e[r?"remove":"add"](i)):e.splice(0,e.count,i)}n.lastClicked=i,n._isUserAction=!1}}onSelectionChange({action:e,removed:t,added:n,replaced:r}){const i=this,{selectedCls:s,unselectedCls:o}=i;let a,l;if("clear"===e)for(l of i.element.querySelectorAll(`.${s}`))l.classList.remove(s),o&&l.classList.remove(o);else{for(a of t)l=i.getItem(a),l&&l.classList.remove(s);for(a of n)l=i.getItem(a),l&&l.classList.add(s)}i.selectAllItem&&i.updateSelectAllState()}onSelectAllClick(e,t){const n=this,r=e.classList.contains(n.selectedCls);n.selected[r?"remove":"add"](n.store.getRange())}updateSelectAllState(){const e=this,t=e.element.querySelector(".b-select-all-item"),n=e.selected.count===e.store.count?"add":"remove";t.classList[n](e.selectedCls)}}sd.initClass(),sd.prototype.navigatorClass=Ks,sd._$name="List";class od extends sd{static get $name(){return"ChipView"}static get type(){return"chipview"}static get configurable(){return{itemCls:"b-chip",closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){const n=this;return Ul.tpl`${n.iconTpl?this.iconTpl(e):""}
            ${n.itemTpl(e,t)}
            ${n.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){this.closable&&this.selected.count&&("Delete"===e.key||"Backspace"===e.key)?this.callback(this.closeHandler,this.owner,[this.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator.disabled=!e,this.isConfiguring||this.refresh()}onClick(e){const t=this,n=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(n.dataset.index));t.callback(t.closeHandler,t.owner,[[e]])}else super.onClick(e)}}od.initClass(),od._$name="ChipView";const ad="L{Field.fieldRequired}",ld="L{Field.validateFilter}";class cd extends rd{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:n,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map((e=>e.value)),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=null===e.valueField,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;"_value"in e||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:t}=this,n=[];return e&&n.push(e),t&&n.push(t),n}get innerElements(){var e;const t=null===(e=this._chipView)||void 0===e?void 0:e.element,{input:n,inputElement:r}=this;return t&&Ur.sync({targetElement:n,domConfig:r}),[t||r]}changeChipStore(e){return!e||e instanceof ta||(e=new ta(ta.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){null==t||t.destroy()}changeChipView(e,t){const n=this;if(n.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:r}=n;return n.chipStore||(n.chipStore={}),dd.reconfigure(t,e,{defaults:{parent:n,insertBefore:r,store:n.chipStore,closable:!n.readOnly,navigator:{class:ud,keyEventTarget:r}}})}null==t||t.destroy()}updateChipView(e){var t;const n=this;n._chipViewEventDetacher=null===(t=n._chipViewEventDetacher)||void 0===t?void 0:t.call(n),n.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(n.input),n._chipViewEventDetacher=Tr.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:n}))}updateMultiSelect(e,t){const n=this,{input:r,element:i}=n,s=!n.isConfiguring;let{value:o}=n;if(i.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:e}=n,{parentNode:t}=r,i=null==e?void 0:e.element;i&&i!==t&&(t.insertBefore(i,r),i.appendChild(r),n.chipView.refresh()),r.value="",s&&!Array.isArray(o)&&(o=o?[o]:null)}else{const e=n._chipView,{parentNode:t}=r,a=null==e?void 0:e.element;a===t&&(a.parentNode.insertBefore(r,a),a.remove(),i.classList.remove("b-uses-chipview")),s&&"string"!=typeof o&&(o=o&&o.length?o[0]:null)}s&&(n.value=o)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){const t=this;e&&(t.filterList=t.buffer(t.doFilter,e))}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return null!=e?e:this.remoteFilter?4:1}get items(){return this.store.allRecords}changeItems(e){const t=this;if(null==e){if(t.store&&!t.store.isItemStore)return;e=[]}if(e instanceof ta)return void(t.store=e);const n=t.displayField;let r,i,s=t.valueField;if(Array.isArray(e)?i=e.map((e=>{let i=e;return e instanceof Oo?(r=e.constructor,s||(t.valueField=s=r.idField)):"string"==typeof e||"number"==typeof e?(s||(t.valueField=s=t.displayField),i={[s]:e,[n]:e}):(s||(t.valueField=s="value"),Array.isArray(e)&&(i={[s]:e[0],[n]:e[1]})),e.selected&&(t.value=i),i})):(s||(t.valueField=s="value"),i=[],Object.entries(e).forEach((([e,t])=>{i.push({[s]:e,[n]:t})}))),t.store)t.store.data=i;else{const e=s===n?{name:"value",dataSource:n}:s;t.store=new ta({isItemStore:!0,data:i,idField:s,modelClass:r||class extends Oo{static get idField(){return t.valueField}static set idField(e){super.idField=e}static get fields(){return[e,n]}}})}}get value(){const e=this,{valueCollection:t,valueField:n}=e;if(null==n)return e.multiSelect?t.values.slice():t.first;let r;return r=e.multiSelect?t.count?t.map((e=>e[n])):e._lastValue||[]:t.count?t.first[n]:e._lastValue,r}set value(e){super.value=e}changeValue(e,t){var n;const r=this;if(e===t)return void r.syncInputFieldValue(!0);if(!r.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiSelect Combo");r.triggerConfig("items");const{valueField:i,displayField:s,store:o,valueCollection:a,_picker:l}=r,{storage:c}=o,d=null!==(n=r.hidePickerOnSelect)&&void 0!==n?n:!r.multiSelect,u=r._isUserAction||(null==l?void 0:l._isUserAction)||d&&r.pickerVisible||!1;if(!r.remoteFilter&&o.isAjaxStore&&!o.count)return o.on("load",(()=>r.value=e),{once:!0,thisObj:r}),void(r._lastValue=e);if(r.remoteFilter){if(null!=e){if(j.isObject(e)||e.isModel)this.store.data=[e],this.valueCollection.splice(0,this.valueCollection.count,this.store.first);else{const t=r.isConfiguring;r.primaryFilter.setConfig({value:e,disabled:!1}),o.performFilter(!0).then((()=>{const{isConfiguring:e}=r;r.isConfiguring=t,a.splice(0,a.count,o.allRecords),r.isConfiguring=e}))}return}}else o.filtered&&(r.primaryFilter.disabled=!0,o.filter());let h;if(null!=e){const n=Array.isArray(e),l=n?e.slice():[e];for(let e=0,t=l.length;e<t;e++){let n=l[e];if(n instanceof Oo)c.includes(n)||o.add(n);else{const r=Ot.isObject(n);r&&(n=n[i]),h=c.getBy(s,n)||c.getBy(i,n)||a.getBy(s,n)||a.getBy(i,n),h instanceof Set&&(h=[...h][0]),h?(r&&h.set(l[e]),l[e]=h):(l.splice(e,1),t--,e--)}}const d=!l.length,m=a.generation;var g;if(a.splice(0,a.count,l),d)r._value=n?null!==(g=e[0])&&void 0!==g?g:null:e,r._lastValue=r._value;(d||a.generation===m)&&r.syncInputFieldValue(),r.syncEmpty(),d&&!r.isConfiguring&&r.triggerFieldChange({value:e,oldValue:t,userAction:u,valid:r.isValid})}else if(a.count)a.clear();else{const t=r._value;r._value=null,r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||r.triggerFieldChange({value:e,oldValue:t,userAction:u,valid:r.isValid})}r._lastValue=r._value}hasChanged(e,t){return this.multiSelect?!Ot.isEqual(e,t):super.hasChanged(...arguments)}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){this.usesChipView||super.syncInputFieldValue(e)}get usesChipView(){return Boolean(this.multiSelect&&this._chipView)}get isEmpty(){return 0===this.valueCollection.count}get inputValue(){const e=this;let t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}changeValueCollection(e,t){if(null==t||t.destroy(),e)return e.isCollection||(e=new Xi({listeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e instanceof ji||("function"==typeof e&&(e={filterBy:e}),e=new ji(d({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive},e))),e}changeStore(e){if(!Array.isArray(e)){if(e){"string"==typeof e?e=ta.getStore(e):Ot.isObject(e)&&(e=new(e.readUrl?ia:ta)(e),this.destroyStore=!0);const t=this,n=t.remoteFilter||e.restfulFilter,{filterParamName:r,valueCollection:i}=t,s=[];n&&r&&(e.filterParamName=r,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),s.push(t.primaryFilter),n?t.filterSelected&&(e.storage.autoFilter=!0,e.storage.addFilter({id:`${t.id}-selected-filter`,filterBy:e=>!i.includes(e)})):t.filterSelected&&(t.selectedItemsFilter=e=>!i.includes(e),s.push(t.selectedItemsFilter),e.reapplyFilterOnAdd=!0),i.addIndex({property:t.displayField,unique:!1}),i.addIndex({property:t.valueField,unique:!0}),e.filter(s)}return e}this.items=e}updateStore(e,t){const n=this,{_picker:r}=n;let i;if(this.destroyStore&&t&&t.destroy(),r&&(r.store=e),e.storage.addIndex({property:n.displayField,unique:!1}),e.storage.addIndex({property:n.valueField,unique:!0}),n.remoteFilter&&(i={filter:"onRemoteFilter"}),n.displayValueRenderer&&((i||(i={})).change="onComboStoreChange",n.syncInputFieldValue()),n.detachListeners("store"),t){const e=n.value;n.isConfiguring=!0,n.value=null,n.isConfiguring=!1,n.value=e}i&&(i.name="store",i.thisObj=n,e.on(i))}get remoteFilter(){var e;return Boolean(this.filterParamName||(null===(e=this._store)||void 0===e?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){return this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(ld),e.syncInputFieldValue()),e.required&&!t&&e.setError(ad)}onTriggerClick(){var e;const t=this;if(!t.remoteFilter||!t.filterOnEnter)if(t.pickerVisible)t.hidePicker();else if(!t.readOnly&&!t.disabled)switch(null===(e=t.triggerAction)||void 0===e?void 0:e.toLowerCase()){case"all":t.doFilter(null);break;case"last":t.doFilter(t.lastQuery);break;default:t.doFilter(t.input.value)}}internalOnInput(e){const t=this,n=t.input.value,r=n.length;t.editable&&(t.syncEmpty(),t.syncInputWidth(),t.inputting=!0,r>=t.minChars&&!t.filterOnEnter?t.filterList(n):(t.validateFilter&&!t.remoteFilter&&t[r?"setError":"clearError"](ld),t.hidePicker()),t.inputting=!1,t.trigger("input",{value:n,event:e}))}syncInputWidth(){const e=this;if(e.usesChipView){const t=e.input,n=e._inputPadding||(e._inputPadding=er.getEdgeSize(t,"padding","lr")),r=t.value||"",i=er.measureText(r+"W",t,!1,e.element)+n.width;t.style.flex=`1 1 ${Math.ceil(i)}px`}}filterList(e){this.doFilter(e)}doFilter(e){const t=this,{store:n,_picker:r}=t,i=null==e||""===e;t.lastQuery=e,t.primaryFilter.setConfig({value:e,disabled:i}),t.remoteFilter&&n.clear(!0),t.getConfig("picker"),n.filter(),null!=r&&r.isVisible?0===r.lastAlignSpec.zone&&r.realign():t.showPicker(),n.count?i||(t.picker.navigator.activeItem=0):t.remoteFilter||i||!t.validateFilter||t.setError(ld)}onRemoteFilter(){const e=this,t=e._picker;e.store.count?t&&(t.navigator.activeItem=0):e.validateFilter&&e.setError(ld),e.filterSelected&&e.valueCollection.count&&(e.store.storage.onFiltersChanged(),t&&t.refresh())}onValueCollectionChange({source:e}){var t;const n=this,{multiSelect:r,_picker:i}=n,s=null!==(t=n.hidePickerOnSelect)&&void 0!==t?t:!r,o=r?e.values.slice():e.first,a=e.values.slice(),l=n._isUserAction||(null==i?void 0:i._isUserAction)||s&&n.pickerVisible||!1,c=n._value;s&&n.hidePicker(),!e.count&&n.required?n.setError(ad):(n.clearError(ad),n.clearError(ld)),n.validateFilter&&o&&n.clearError(ld),n.filterSelected&&(n.remoteFilter?(n.store.storage.onFiltersChanged(),n._picker&&n._picker.refresh()):n.store.filter()),n._value=null,n._lastValue=null;const d=n.cacheCurrentValue(n.value);n.syncInputFieldValue(),n.syncEmpty(),n.isConfiguring||(n.triggerFieldChange({value:d,oldValue:c,userAction:l,valid:n.isValid}),n.trigger("select",{record:o,records:a,userAction:l}),"select"===n.defaultAction&&n.trigger("action",{value:d,record:o,records:a,userAction:l}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){const e=this,{picker:t}=e;e.readOnly||(t.multiSelect=e.multiSelect,super.showPicker(),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),!e.multiSelect&&e.selected&&t.restoreActiveItem(e.selected,!0),e.input.focus())}changePicker(e,t){var n;const r=this,i=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width);return(e=sd.reconfigure(t,e?sd.mergeConfigs({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,itemTpl:r.listItemTpl||(e=>A.encodeHtml(e[r.displayField])),forElement:r[r.pickerAlignElement],align:{matchSize:null==i,anchor:r.overlayAnchor,target:r[r.pickerAlignElement],minHeight:40*Math.min(3,r.store.count)},width:i,navigator:{keyEventTarget:r.input}},e):null,r))&&(e.element.dataset.emptyText=r.emptyText||r.L("L{noResults}")),e}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}internalOnKeyEvent(e){const t=this,n=t.input.value,r=n.length;super.internalOnKeyEvent(...arguments),"keydown"===e.type&&"Enter"===e.key&&t.filterOnEnter&&r>=t.minChars&&(e.stopPropagation(),t.filterList(n))}}class dd extends od{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return A.encodeHtml(e[this.owner.displayField])},scrollable:{overflowY:"auto"}}}}class ud extends Ks{static get defaultConfig(){return{allowShiftKey:!0}}onTargetClick(e){const t=e.target.closest(this.itemSelector);!t||e.shiftKey||t.contains(e.target.closest("[data-noselect]"))||this.ownerCmp.selected.clear(),this.inClickHandler=!0,this.activeItem=t,this.inClickHandler=!1}onKeyDown(e){"Enter"!==e.key&&super.onKeyDown(e)}updateActiveItem(e,t){const n=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&n.selected.add(n.getRecord(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}cd.initClass(),dd.initClass(),cd._$name="Combo";class hd extends os{static get $name(){return"UndoRedoBase"}static get type(){return"undoredobase"}static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"b-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"No items in the undo queue",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"b-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}}}}afterConstruct(){this.updateUndoRedoControls()}changeStm(e){return e.on({recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this}),e}changeItems(e){const{undoBtn:t,redoBtn:n}=e;return this.color&&(t&&(t.color=this.color),n&&(n.color=this.color)),this.text&&(t&&(t.text="L{UndoRedo.Undo}"),n&&(n.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=this.stm.queue.map(((e,t)=>[t,e||`Transaction ${t}`])))}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:n,redoBtn:r}=this.widgetMap;n.badge=e.position||(t?"0":""),r.badge=e.length-e.position||(t?"0":""),n.disabled=!e.canUndo,r.disabled=!e.canRedo,this.fillUndoRedoCombo()}transactionsDisplayValueRenderer(e,t){var n;const r=(null===(n=this.stm)||void 0===n?void 0:n.position)||0;return`${r} undo actions / ${t.store.count-r} redo actions`}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const t=this.stm,n=e.value;n>=0&&(t.canUndo&&n<t.position?t.undo(t.position-n):t.canRedo&&n>=t.position&&t.redo(n-t.position+1))}}hd._$name="UndoRedoBase";class gd extends cd{static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const n=this;return super.changeStore(new ta({data:[{id:n.positiveValue,text:n.positiveText||n.L("L{Object.Yes}")},{id:n.negativeValue,text:n.negativeText||n.L("L{Object.No}")}]}),t)}}gd.initClass(),gd._$name="BooleanCombo";class md extends(os.mixin(hs)){static get $name(){return"ButtonGroup"}static get type(){return"buttongroup"}static get configurable(){return{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0}}onChildAdd(e){super.onChildAdd(e),e.on({click:"onItemClick",thisObj:this,prio:1e4})}onChildRemove(e){e.un({click:"onItemClick",thisObj:this}),super.onChildRemove(e)}onItemClick(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=md.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=100/t.columns+"%"),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget((t=>{!1!==t.rotate&&(t.rotate=e)}))}get value(){if(!this._value){const e=[];this.items.forEach((t=>{t.pressed&&t.value!==n&&e.push(t.value)})),this._value=e.join(this.valueSeparator)}return this._value}set value(e){Array.isArray(e)||(e=e===n||null===e?[]:"string"==typeof e?e.split(this.valueSeparator):[e]),this._value=e,this.items.forEach((t=>{t.value!==n&&(t.pressed=e.indexOf(t.value)>-1)}))}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.items.forEach((t=>t.disabled=e))}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}}md.initClass(),md._$name="ButtonGroup";class pd extends Bs{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null}}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;null===(t=super.onPaint)||void 0===t||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;null===(e=this.tip)||void 0===e||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(er.getStyleValue(this.element,"--min-row-height"),10)||75;return null==e?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach((t=>er.setLength(t,"flexBasis",e))),this.scrollable={overflowY:!!e&&"auto"}}changeMinColumnWidth(e){const t=parseInt(er.getStyleValue(this.element,"--min-column-width"),10)||75;return null==e?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach((t=>er.setLength(t,"minWidth",e))),t.cellElements.forEach((n=>n.matches(`.${t.dayCellCls}`)&&er.setLength(n,"minWidth",e))),t.scrollable={overflowX:!!e&&"auto"},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest(`#${this.id} [data-date]`);if(t)return Mt.parseKey(t.dataset.date)}changeTip(e,t){const n=this;return Ws.reconfigure(t,e,{owner:n,defaults:{type:"tooltip",owner:n,id:`${n.id}-cell-tip`,forElement:n.bodyElement,forSelector:`.${n.dayCellCls}`}})}updateTip(e){this.detachListeners("tip"),null==e||e.on({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const n=this;super.updateElement(e,t),n.updateHideNonWorkingDays(n.hideNonWorkingDays),n.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),n.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),n.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),n.cellElements=[];for(let e=0,{length:t}=n.weekDayElements;e<t;e++)n.cellElements.push(n.weekDayElements[e].previousSibling,...n.weekDayElements[e].children)}changeDate(e){if(e="string"==typeof e?Mt.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a YYYY-MM-DD date string");return Mt.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(Mt.format(e,this.dayNameFormat))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:Mt.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList[e?"add":"remove"](this.hideNonWorkingDaysCls),null===(t=this.scrollable)||void 0===t||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e)}get nonWorkingDays(){return this._nonWorkingDays||Mt.nonWorkingDays}changeNonWorkingDays(e){return Ot.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null===(t=this.scrollable)||void 0===t||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return Mt.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return Mt.add(e,1,"day")}changeMonth(e,t){const n=this;if(!(e instanceof Pc)){if("number"==typeof e){if(t)return void(t.month=e);const r=n.date||Mt.clearTime(new Date);r.setMonth(e),e={date:r}}e=Pc.new({weekStartDay:n.weekStartDay,nonWorkingDays:n.nonWorkingDays,hideNonWorkingDays:n.hideNonWorkingDays,sixWeeks:n.sixWeeks},e)}return e.on({dateChange:"onMonthDateChange",thisObj:n}),e}onMonthDateChange({source:e,newDate:t,oldDate:n,changes:r}){const i=this;i.year=e.year,i.isConfiguring||((r.m||r.y)&&i.refresh(),i.trigger("dateChange",{value:t,oldValue:n}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){this.getConfig("element");const e=this,t=Mt.clearTime(new Date),{cellElements:n,weekElements:r,weekDayElements:i,date:s,month:o,dayCellCls:a,dayHeaderCls:l,disabledCls:c,otherMonthCls:d,weekendCls:u,todayCls:h,nonWorkingDayCls:g,nonWorkingDays:m,canonicalDayNumbers:p}=e;s||(e.date=t),e.getConfig("dayNameFormat");for(let e=0,t=n.length;e<t;e++)n[e].className=a;for(let t=0;t<7;t++){const n=e.weekdayCells[t],r=e.canonicalDayNumbers[t],i=n.classList;n.className=n.innerHTML="",e.headerRenderer?e.callback(e.headerRenderer,e,[n,t,r]):n.innerHTML=e.shortDayNames[r],i.add(l),Mt.weekends[r]&&i.add(u),m[r]&&i.add(g),n.dataset.columnIndex=t,n.dataset.cellDay=r}let f=0,v=0,y=6;for(let e=6;e>=0;e--)if(!m[p[e]]){y=e;break}for(o.eachWeek(((n,s)=>{const a=i[f],l=[a.previousSibling,...a.children];r[f].dataset.week=`${n[0]},${n[1]}`,r[f].classList.remove("b-hide-display"),l[0].className="b-week-number-cell",e.weekRenderer?e.callback(e.weekRenderer,e,[l[0],n]):l[0].innerHTML=n[1];for(let i=0;i<7;i++){const a=s[i],p=a.getDay(),b=l[i+1],C=b.classList;e.isDisabledDate(a)&&C.add(c),a.getMonth()!==o.month&&C.add(d),Mt.weekends[p]&&C.add(u),a.getTime()===t.getTime()&&C.add(h),m[p]&&C.add(g),C[i===y?"add":"remove"]("b-last-working-day"),b.dataset.date=Mt.makeKey(a),b.dataset.cellIndex=v,b.dataset.columnIndex=i,b.lastDomConfig&&(delete b.lastDomConfig.class,delete b.lastDomConfig.className),e.cellRenderer?e.callback(e.cellRenderer,e,[{cell:b,date:a,day:p,row:r[f],rowIndex:f,cellIndex:v,columnIndex:i,visibleColumnIndex:e.visibleDayColumnIndex[p],week:n}]):b.innerHTML=a.getDate(),v++}f++})),e.visibleWeekCount=f;f<6;f++)r[f].classList[e.sixWeeks?"remove":"add"]("b-hide-display");e.floating&&(e.isAligning||e.realign()),e.refreshCount=(e.refreshCount||0)+1,e.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:n,nonWorkingDays:r}=this;return!(!this.disableWeekends||!r[t])||(n?Array.isArray(n)?(e=Mt.clearTime(e,!0),n.some((t=>!(Mt.clearTime(t,!0)-e)))):this.callback(this.disabledDates,this,[e]):void 0)}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...Ce.fill(7,{class:this.dayHeaderCls}),er.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let e=0;e<6;e++){const e={className:"b-calendar-row b-calendar-week",children:[{},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(e)}return e}get firstVisibleDate(){for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}getCell(e){return"string"!=typeof e&&(e=Mt.makeKey(e)),this.weeksElement.querySelector(`[data-date="${e}"]`)}onTipOverCell({source:e,target:t}){e.date=Mt.parseKey(t.dataset.date)}updateLocalization(){this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}}pd.initClass(),pd._$name="CalendarPanel";class fd extends qs{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",text:"",color:null,value:"",toggleGroup:null,defaultBindProperty:"value",localizableProperties:["label","text"]}}construct(e){"checked"in e&&((e=Ot.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get innerElements(){return[this.inputElement,{tag:"label",class:"b-checkbox-label",for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get inputElement(){const e=this,t=super.inputElement;return e.readOnly&&(t.disabled=!0),e.toggleGroup&&(t.dataset={group:e.toggleGroup}),t}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){const t=this,n=t.input.checked!==e;t.input.checked=e,n&&!t.inputting&&(t.uncheckToggleGroupMembers(),t.isConfiguring||t.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const n=this.element.classList;t&&n.remove(t),e&&n.add(e)}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:n,input:r}=e,i=[];return t&&n&&er.forEachSelector(e.rootElement,`input[type=checkbox][data-group=${n}]`,(e=>{if(e!==r){const t=ki.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}updateReadOnly(e){this.input&&(this.input.disabled=e),super.updateReadOnly(e)}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnChange(e){const t=this;t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0),t.inputting=!1)}triggerChange(e){const t=this,{checked:n}=t.input,r={checked:n,value:n,userAction:e,valid:!0};if(!(!n&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!1===t.trigger("beforeChange",r)))return t.triggerFieldChange(r,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",r),t.trigger("change",r),!0;t.input.checked=t._value=!n}}fd.initClass(),fd._$name="Checkbox";const vd=()=>Mt.getMonthNames().map(((e,t)=>[t,e])),yd=[],bd=(new Date).getFullYear();for(let e=bd-20;e<bd+21;e++)yd.push(e);(class extends cd{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},highlightExternalChange:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}onSelect({record:e}){this.value=e.value}set value(e){super.value=e,this.input.innerHTML=this.input.value}get value(){return super.value}}).initClass();class Cd extends pd{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:null,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:[{ref:"prevMonth",cls:"b-icon b-icon-prev",onAction:"up.gotoPrevMonth"},{type:"container",flex:1,defaultType:"readonlycombo",cls:"b-datepicker-title",items:[{ref:"monthField",cls:"b-datepicker-monthfield",items:vd(),listeners:{select:"up.onMonthPicked"}},{ref:"yearField",cls:"b-datepicker-yearfield",items:yd,listeners:{select:"up.onYearPicked"}}]},{ref:"nextMonth",cls:"b-icon b-icon-next",onAction:"up.gotoNextMonth"}]},date:new Date,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,editOnHover:!0,editMonth:!0,dayNameFormat:"dd"}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;e.editOnHover&&s.deprecate("Grid","5.0.0","`editOnHover` config deprecated, it now has no effect and will be removed in 5.0"),t.selection=e.date?[e.date]:[],super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),Tr.on({element:t.weeksElement,click:"onCellClick",delegate:`.${t.dayCellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`,thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearField.readOnly=!t.editMonth}doDestroy(){var e,t;null===(e=this.yearField)||void 0===e||e.destroy(),null===(t=this.monthField)||void 0===t||t.destroy(),super.doDestroy()}get focusElement(){return this.element}internalCellRenderer({cell:e,date:t}){var n;const r=this,{activeCls:i,selectedCls:s}=r,o=e.classList;e.innerHTML=t.getDate(),e.setAttribute("aria-label",Mt.format(t,"MMMM D, YYYY")),r.isActiveDate(t)?(o.add(i),e.id=`${r.id}-active-day`):e.removeAttribute("id"),r.isSelectedDate(t)&&o.add(s),(r.minDate&&t<r.minDate||r.maxDate&&t>r.maxDate)&&o.add(r.outOfRangeCls),null===(n=r.externalCellRenderer)||void 0===n||n.call(r,...arguments)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(Mt.parseKey(t.dataset.date),e)}onUIDateSelect(e,t){const n=this,{lastClickedDate:r,selection:i}=n;n.activeDate=e,n.lastClickedDate=e,n.isDisabledDate(e)||(n.activatingEvent=t,n.multiSelect?n.multiRange||r&&e.getTime()===r.getTime()||(r&&t.shiftKey?(i[1]=e,i.sort()):(i.length=0,i[0]=e),n.trigger("selectionChange",{selection:i,userAction:Boolean(t)})):n.value&&n.value.getTime()===e.getTime()?n.floating&&n.hide():n.value=e,n.activatingEvent=null),n.refresh()}onInternalKeyDown(e){const t=this,n=e.key.trim()||e.code,r=t.activeDate;let i=new Date(r);if("Escape"===n&&t.floating)return t.hide();if(r&&e.target===t.focusElement){do{switch(n){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i=t.gotoPrevMonth():i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i=t.gotoNextMonth():i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(r,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}changeMinDate(e){return e?this.changeDate(e):null}updateMinDate(){this.refresh()}changeMaxDate(e){return e?this.changeDate(e):null}updateMaxDate(){this.refresh()}updateDate(e){super.updateDate(e),this.activeDate=e}changeActiveDate(e){if(e=e?this.changeDate(e):this.date||(this.date=Mt.clearTime(new Date)),isNaN(e))throw new Error("DatePicker date ingestion must be passed a Date, or a YYYY-MM-DD date string");return e}updateActiveDate(e){this.month.date=e,this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearField.value=e.getFullYear(),this.refresh()}set value(e){const t=this,{selection:r}=t;let i;if(e){if((e=t.changeDate(e,t.value))===n)return;t.value&&e.getTime()===t.value.getTime()||(r.length=0,r[0]=e,i=!0),t.date=e}else i=r.length,r.length=0,t.date=new Date;i&&t.trigger("selectionChange",{selection:r,userAction:Boolean(t.activatingEvent)})}get value(){return this.selection[this.selection.length-1]}gotoPrevMonth(){const e=this,{activeDate:t}=e,n=t&&e.getCell(t)?t:e.date,r=Mt.add(n,-1,"month");if(!e.minDate||r>=e.minDate)return e.date=r}gotoNextMonth(){const e=this,{activeDate:t}=e,n=t&&e.getCell(t)?t:e.date,r=Mt.add(n,1,"month");if(!e.maxDate||r<=e.maxDate)return e.date=r}isActiveDate(e){return this.activeDate&&this.changeDate(e).getTime()===this.activeDate.getTime()}isSelectedDate(e){return this.selection.some((t=>Mt.isEqual(t,e,"day")))}onMonthPicked({record:e}){this.activeDate=Mt.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),this.focusElement.focus()}onYearPicked({record:e}){const t=new Date(this.activeDate);t.setFullYear(e.value),this.activeDate=t,this.focusElement.focus()}get yearItems(){const e=[],t=(new Date).getFullYear();for(let n=t-20;n<t+21;n++)e.push(n);return e}updateLocalization(){const e=this.widgetMap.monthField,t=vd();t[e.value].selected=!0,e.items=t,super.updateLocalization()}}Cd.initClass(),Cd._$name="DatePicker";class wd extends rd{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"b-icon b-icon-angle-left b-step-trigger",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon b-icon-angle-right b-step-trigger",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const n=this,r={owner:n,forElement:n[n.pickerAlignElement],minDate:n.min,maxDate:n.max,weekStartDay:n._weekStartDay,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onSelectionChange:({selection:e,source:t})=>{t.isVisible&&(n._isUserAction=!0,n._isPickerInput=!0,n.value=e[0],n._isPickerInput=!1,n._isUserAction=!1,t.hide())}};return n.calendarContainerCls&&(r.cls=n.calendarContainerCls),n.value?r.value=n.value:r.date=new Date,Cd.reconfigure(t,e,{owner:n,defaults:r})}get backShiftDate(){return Mt.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=e.backShiftDate;(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get forwardShiftDate(){return Mt.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=e.forwardShiftDate;(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const{_picker:t}=this;t&&(t.value=this.value),super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:n,max:r}=e;if(t=t.getTime(),n&&n.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(r&&r.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}transformDateValue(e){return null!=e&&(Mt.isDate(e)||(e="string"==typeof e?Mt.parse(e,this.format)||Mt.parse(e,this.fallbackFormat):new Date(e)),Mt.isValidDate(e))?this.transformTimeValue(e):null}transformTimeValue(e){const t=this,{keepTime:n}=t;if(e=Mt.clone(e),n)if("entered"!==n){const r=Mt.parse(n,t.timeFormat);Mt.isValidDate(r)?Mt.copyTimeValues(e,r):Mt.isValidDate(t.value)&&Mt.copyTimeValues(e,t.value)}else t._isPickerInput&&Mt.isValidDate(t.value)&&Mt.copyTimeValues(e,t.value);else Mt.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),n&&(n.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:n}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),n&&(n.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:Mt.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const n=this,r=n.transformDateValue(e);if(!e||r){if(n.clearError("L{invalidDate}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue()}else n.setError("L{invalidDate}")}updateValue(e,t){const n=this._picker;n&&!this.inputting&&(n.value=e),super.updateValue(e,t)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===n&&(e=Mt.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return null!=e&&e.getTime&&null!=t&&t.getTime&&"entered"!==this.keepTime?!Mt.isEqual(Mt.clearTime(e),Mt.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?Mt.format(e,this.format):""}updateFormat(){this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}wd.initClass(),wd._$name="DateField";class Sd extends qs{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let n=!isNaN(e);if(n&&!this.hasTextSelection){n=!1;const e=this.input.value,r=parseFloat(e);e!==t&&(n=!this.acceptValue(r,e))}return n}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,n=e.key;let r;if("ArrowUp"===n)t.doSpinUp(e.shiftKey),r=!0;else if("ArrowDown"===n)t.doSpinDown(e.shiftKey),r=!0;else if(!e.altKey&&!e.ctrlKey&&n&&1===n.length){const e=t.getAfterValue(n),i=t.formatter.parseStrict(e);r=!(i===t.value||"-"===e&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(i,e)}"Enter"===n&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),r&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;let n=(t.value||0)+(e?t.largeStep:t.step);t.okMin(n)||(n=t.min),t.okMax(n)&&t.applySpinChange(n)}doSpinDown(e=!1){const t=this;let n=(t.value||0)-(e?t.largeStep:t.step);t.okMax(n)||(n=t.max),t.okMin(n)&&t.applySpinChange(n)}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){super.onFocusOut(...arguments);const t=this,{input:n}=t,r=n.value,i=t.formatter.truncate(r),s=isNaN(i)?r:t.formatValue(i);r!==s&&(n.value=s),t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:n,input:r}=t,{parser:i}=n,s=r.value,o=i.decimalPlaces(s);if(n.truncator&&o){let e=s;const a=n.truncate(s);if(!isNaN(a)&&(e=t.formatValue(a),i.decimalPlaces(e)<o)){const n=s.length-t.caretPos;r.value=e,t.caretPos=e.length-n}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(""===e){const{leadingZeroes:n,decimalPrecision:r}=t;e=n?`${n}>9`:null,null!=r?e=`${e||""}9.${"#".repeat(r)}`:e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let n=e._formatter;return n&&e._lastFormat===t||(n=lc.get(e._lastFormat=t),e._formatter=n),n}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const r=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?r.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&r.format&&(e=r.formatter.round(e))}else e=n;return super.changeValue(e,t)}get inputValue(){let e=this.value;return null!=e&&this.format&&(e=this.formatValue(e)),e}}Sd.initClass(),Sd._$name="NumberField";class Ed extends Ns{static get $name(){return"TimePicker"}static get type(){return"timepicker"}static get defaultConfig(){return{items:[{type:"number",ref:"fieldHours",min:0,max:23,highlightExternalChange:!1,format:"2>9"},{html:"<label>:</label>"},{type:"number",ref:"fieldMinutes",min:0,max:59,highlightExternalChange:!1,format:"2>9"},{type:"button",text:"AM",toggleGroup:"am-pm",ref:"buttonAM",cls:"b-blue"},{type:"button",text:"PM",toggleGroup:"am-pm",ref:"buttonPM",cls:"b-blue"}],float:"1",autoShow:!1,trapFocus:!0,value:Mt.getTime(0),format:null}}construct(e){const t=this;super.construct(e),t._pm=!1,t.fieldHours.on("change",t.onFieldChange,t),t.fieldMinutes.on("change",t.onFieldChange,t),t.buttonAM.on("click",t.onButtonAMClick,t),t.buttonPM.on("click",t.onButtonPMClick,t),Tr.on({element:t.element,keydown:"onPickerKeyDown",thisObj:t}),Tr.on({element:t.fieldHours.element,keydown:"onPickerKeyDown",thisObj:t}),Tr.on({element:t.fieldMinutes.element,keydown:"onPickerKeyDown",thisObj:t}),t.refresh()}onFieldChange(){const e=this;e._time&&(e.value=e.pickerToTime())}onButtonAMClick(){const e=this;e._pm=!1,e._time&&(e.value=e.pickerToTime())}onButtonPMClick(){const e=this;e._pm=!0,e._time&&(e.value=e.pickerToTime())}onPickerKeyDown(e){const t=this;switch(e.key&&e.key.trim()||e.code){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();break;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault()}}pickerToTime(){const e=this,t=e._pm;e.fieldHours.format=e._is24Hour?"2>9":null;let n=e.fieldHours.value,r=new Date(e._time);return e._is24Hour||(t&&n<12&&(n+=12),t||12!==n||(n=0)),r.setHours(n),r.setMinutes(e.fieldMinutes.value),e._min&&(r=Mt.max(e._min,r)),e._max&&(r=Mt.min(e._max,r)),r}triggerTimeChange(e){this.trigger("timeChange",{time:e})}set value(e){const t=this;let n=!1;e&&t._time?e.getTime()!==t._time.getTime()&&(t._time=e,n=!0):(t._time=Ed.defaultConfig.value,n=!0),n&&(t.isVisible&&t.triggerTimeChange(t.value),t.refresh())}get value(){return this._time}set format(e){const t=this;t._format=e,t._is24Hour=Mt.is24HourFormat(t._format),t.refresh()}get format(){return this._format}set min(e){this._min=e}get min(){return this._min}set max(e){this._max=e}get max(){return this._max}set initialValue(e){this.value=e,this._initialValue=e}get initialValue(){return this._initialValue}get buttonAM(){return this.widgetMap.buttonAM}get buttonPM(){return this.widgetMap.buttonPM}get fieldHours(){return this.widgetMap.fieldHours}get fieldMinutes(){return this.widgetMap.fieldMinutes}refresh(){const e=this;if(!e.isConfiguring){const t=e._time,n=e._is24Hour,r=t.getHours(),i=e._pm=r>=12,s=e.fieldHours;e.element.classList[n?"add":"remove"]("b-24h"),s.min=n?0:1,s.max=n?23:12,s.value=n?r:r%12||12,e.fieldMinutes.value=t.getMinutes(),e.buttonAM.pressed=!i,e.buttonPM.pressed=i,e.buttonAM.hidden=e.buttonPM.hidden=n}}}Ed.initClass(),Ed._$name="TimePicker";class Dd extends rd{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",floating:!0,align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"b-icon-clock-live":1}}]})},back:{align:"start",cls:"b-icon b-icon-angle-left b-step-trigger",handler:"onBackClick"},forward:{align:"end",cls:"b-icon b-icon-angle-right b-step-trigger",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null}}changePicker(e,t){const n=this;return Ed.reconfigure(t,e,{owner:n,defaults:{forElement:n[n.pickerAlignElement],owner:n,align:{anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},onTimeChange({time:e}){n._isUserAction=!0,n.value=e,n._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=Mt.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=Mt.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(e){const t=this,{picker:n}=t;t.readOnly||(n.initialValue=t.value,n.format=t.format,n.maxTime=t.max,n.minTime=t.min,t.value=n.value,super.showPicker(e))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=null===(e=this.pickerKeyDownRemover)||void 0===e?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&(Mt.isDate(e)||(e="string"==typeof e?Mt.parse(e,this.format):new Date(e)),Mt.isValidDate(e))?Mt.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const n=this,r=n.transformTimeValue(e);if(e&&!r||n.isRequired&&""===e)n.setError("L{invalidTime}");else{if(n.clearError("L{invalidTime}"),n.hasChanged(t,r))return super.changeValue(r,t);n.inputting||n.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:n}=this.triggers;n&&e&&(n.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){const n=typeof e;return e?("number"===n?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===n&&(e=Mt.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return Mt.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}}Dd.initClass(),Dd._$name="TimeField";class xd extends qs{static get configurable(){return{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>""}}static get $name(){return"DateTimeField"}static get type(){return"datetimefield"}static get alias(){return"datetime"}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const t=this,n=Dd.new({revertOnEscape:t.revertOnEscape,syncInvalid(...e){const n=t.updatingInvalid;Dd.prototype.syncInvalid.apply(this,e),t.timeField&&!n&&t.syncInvalid()}},e);return Tr.on({element:n.element,keydown:"onTimeFieldKeyDown",thisObj:t}),t.readOnly&&(n.readOnly=!0),n}updateTimeField(e){const t=this;e.on({change({userAction:e,value:n}){if(e&&!t.$settingValue){const e=t.dateField.value;t._isUserAction=!0,t.value=e?Mt.copyTimeValues(e,n):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,n=(null==e?void 0:e.type)||"datefield",r=ki.resolveType(e.type||"datefield"),i=ki.create(Ot.assign({type:n,revertOnEscape:t.revertOnEscape,syncInvalid(...e){const n=t.updatingInvalid;r.prototype.syncInvalid.apply(this,e),t.dateField&&!n&&t.syncInvalid()}},e));return Tr.on({element:i.element,keydown:"onDateFieldKeyDown",thisObj:t}),t.readOnly&&(i.readOnly=!0),i.on({keydown:({event:e})=>{var t;"Tab"===e.key&&!e.shiftKey&&null!==(t=this.timeField)&&void 0!==t&&t.isVisible&&(e.stopPropagation(),e.cancelBubble=!0)}}),i}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.on({change({userAction:e,value:n}){e&&!t.$isInternalChange&&(t._isUserAction=!0,t.value=n,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t,n;return"number"==typeof e?e:null!==(t=null===(n=this.dateField)||void 0===n?void 0:n.weekStartDay)&&void 0!==t?t:Mt.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0),e||this.highlightExternalChange||(e=!0);const t=this,n=t.dateField.highlightExternalChange,r=t.timeField.highlightExternalChange;t.$isInternalChange=!0,t.dateField.highlightExternalChange=!1,t.dateField.value=null,t.dateField.highlightExternalChange=n,e&&(t.timeField.highlightExternalChange=t.dateField.highlightExternalChange=!1),t.timeField.value=t.dateField.value=t.inputValue,t.dateField.highlightExternalChange=n,t.timeField.highlightExternalChange=r,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if("Enter"===e.key||"Tab"===e.key){const e=t.dateField.value;t._isUserAction=!0,t.value=e?Mt.copyTimeValues(e,t.timeField.value):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;"Tab"===e.key&&(e.stopPropagation(),e.preventDefault(),t.timeField.focus()),"Enter"===e.key&&(t.value=t.dateField.value)}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){return!Mt.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach((n=>n.setError(e,t)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach((n=>n.clearError(e,t)))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach((e=>e.updateInvalid())),this.updatingInvalid=!1}}xd.initClass(),xd._$name="DateTimeField";class Rd extends nd{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",html:this.template?this.template(this.value):A.encodeHtml(this.value)}}}Rd.initClass(),Rd._$name="DisplayField";class Td extends nd{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return"string"==typeof e?new $i(e):e}changeMax(e){return"string"==typeof e?new $i(e):e}changeAllowedUnits(e){return"string"==typeof e&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp(`(${e.join("|")})`,"i")}get inputValue(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?Ot.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,n=t.value,r=t._lastValue;t.hasChanged(r,n)&&(t._lastValue=n,t.triggerFieldChange({value:n,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){return this.syncInputFieldValue(!0),super.onFocusOut(e)}set value(e){const t=this;let n,r;if(this.clearError("L{invalidUnit}"),"number"==typeof e)n=e,r=t._unit;else if("string"==typeof e){const i=Mt.parseDuration(e,t.allowDecimals,t._unit||Td.defaultConfig.defaultUnit);i&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(i.unit)?(r=i.unit,n=i.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(r=e.unit,n=e.magnitude):(r=null,n=null);t._magnitude===n&&t._unit===r||(t._magnitude=n,t._unit=r,super.value=t.calcValue())}okMax(e){return null==this.max||e<=this.max}okMin(e){return null==this.min||e>=this.min}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return t._unit&&null!=t._magnitude||!t.clearable?new $i(e?this.roundMagnitude(t._magnitude):this._magnitude,t._unit||Td.defaultConfig.defaultUnit):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),(e.okMin(t)&&e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}}Td.initClass(),Td._$name="DurationField";class Md extends Oi{static get $name(){return"Fit"}static get type(){return"fit"}static get configurable(){return{containerCls:"b-fit-container",itemCls:"b-fit-item"}}}Md.initClass(),Md._$name="Fit";class Fd extends os{static get $name(){return"Editor"}static get type(){return"editor"}static get configurable(){return{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0}}afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),(e.completeKey||e.cancelKey)&&Tr.on({element:e.element,keydown:"onKeyDown",thisObj:e}),e.on({hide:"afterEditorHide",thisObj:e}),Ve.on({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}startEdit({target:e,align:t=this.align,hideTarget:r=!1,matchSize:i=!0,matchFont:s=!0,fitTargetContent:o=!1,value:a,record:l,field:c=this.inputField.name,focus:u=!0}){const h=this,{inputField:g}=h,m=er.getStyleValue(e,"font-size"),p=er.getStyleValue(e,"font-family");if(!1!==h.trigger("beforeStart",{value:a})){var f;if(l&&c&&a===n&&(h.record=l,h.dataField=c,a=l[c]),i&&(e instanceof HTMLElement&&h.updateSize(e),e instanceof HTMLElement&&Zr.addResizeListener(e,h.onTargetSizeChange)),g.input&&(s?(g.input.style.fontSize=m,g.input.style.fontFamily=p):g.input.style.fontSize=g.input.style.fontFamily=""),h._isSettingValues=!0,g.clearError&&g.clearError(),g.value=a,h._isSettingValues=!1,h.showBy(d({target:e},t)),o){const e=g.input.scrollWidth-g.input.clientWidth;e>0&&(h.width+=e+er.scrollBarWidth)}return u&&h.inputField.focus&&h.inputField.focus(),e.nodeType===Element.ELEMENT_NODE&&(e.classList.add("b-editing"),r&&e.classList.add("b-hide-visibility")),h.editing=!0,h.trigger("start",{value:g.value}),Array.isArray(g.value)&&g.editingRecords&&null!==(f=g.value[0])&&void 0!==f&&f.isModel?h.oldValue=g.value.map((e=>e.copy(e.id))):(h.oldValue=g.value,Array.isArray(h.oldValue)&&(h.oldValue=h.oldValue.slice())),g.initialValue=h.oldValue,!0}return!1}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:n}=this;if(e&&t){const r=e[t];Ot.isEqual(n.value,r)||(n.value=r)}}}finishEdit(){const{target:e}=this.lastAlignSpec;e.nodeType===Element.ELEMENT_NODE&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var t;const n=this;switch(e.key){case n.completeKey:n.completeEdit(null,e),e.stopImmediatePropagation();break;case n.cancelKey:n.cancelEdit(e),e.stopImmediatePropagation()}null===(t=n.trigger)||void 0===t||t.call(n,"keydown",{event:e})}onFocusOut(e){super.onFocusOut(e);const t=this;if(!t.isFinishing&&t.editing){const e=t[`${t.blurAction}Edit`];null==e||e.call(t)}}async completeEdit(e,t){const n=this,{inputField:r,oldValue:i,record:s}=n,o=r.invalidAction||(!1===r.allowInvalid?"block":n.invalidAction),{value:a}=r;if(n.isVisible){if(r.isValid||"allow"===o){if(Ot.isEqual(a,i))return n.cancelEdit(t),!0;{const t={inputField:r,record:s,value:a,oldValue:i};if(!1!==n.trigger("beforeComplete",t)){if(e||(e=t.finalize||t.editorContext&&t.editorContext.finalize),e){let s=await e(t);if(!0===s)n.onEditComplete();else{if(r.setError){const e=s||r.invalidValueError,t=()=>{n(),r.clearError(e)},n=r.on({change:t,input:t});r.setError(e)}"block"===o?r.focus&&r.focus():"revert"===o&&(r.value=i,s=!0),s=!1}return s}return n.onEditComplete(),!0}r.focus&&r.focus()}}else{if("block"===o)return r.focus&&r.focus(),!1;if("revert"===o)return n.cancelEdit(t),!0}return!1}}cancelEdit(e){const t=this,{inputField:n,oldValue:r}=t,{value:i}=n;t.editing&&!t.isFinishing&&!1!==t.trigger("beforeCancel",{value:i,oldValue:r,event:e})&&(t.isFinishing=!0,t.hide(),t.trigger("cancel",{value:i,oldValue:r,event:e}),t.finishEdit(),t.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:n,inputField:r,oldValue:i}=e,{value:s}=r;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e=`set${A.capitalize(n)}`;t[e]?t[e](s):t[n]=s}e.trigger("complete",{value:s,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||ki.fromElement(this.element.parentNode)}changeInputField(e,t){const n=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof ki||(e=ki.create(e),n.createdInputField=!0),n.completeOnChange&&e.on({change:"onInputFieldChange",thisObj:n}),e.parent=n,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,n){t&&n&&this.updateSize(e)}updateSize(e){const t=e.getBoundingClientRect();this.width=t.width-this.align.offset[0],this.height=t.height}afterEditorHide(){Zr.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}}Fd.initClass(),Fd._$name="Editor";class Ad extends qs{static get $name(){return"FileField"}static get type(){return"filefield"}internalOnChange(e){super.internalOnInput(e),super.internalOnChange(e)}internalOnInput(){}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}}Ad.initClass(),Ad._$name="FileField";class Id extends os{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.on({click:t.onButtonClick,thisObj:t}),t.fileField.on({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new Ws({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",listeners:{beforeshow(){const t=this,n=e.files;return!(!n||!n.length)&&(t.html=`${Array.from(n).map((e=>e.name)).join("<br>")}`,!0)}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.button.badge=t.files.length||"",t.triggerFieldChange({files:t.files,valid:e})}}Id.initClass(),Id._$name="FilePicker";class kd extends nd{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:n,filterFunction:r}=this;if(t){const i=`${n||this.id}-Filter`;if(0===e.length)t.removeFilter(i);else{let s;r?s=t=>r(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=t=>t.get(n).match(new RegExp(e,"i"))),t.filter({id:i,filterBy:s})}}}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onChange({value:e})}}kd.initClass(),kd._$name="FilterField";class Od extends ki{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}}u(Od,"$name","Label"),u(Od,"type","label"),u(Od,"configurable",{text:null}),Od.initClass(),Od._$name="Label";const Ld=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];r.isWindows&&Ld.reverse();class Pd extends Ns{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:"Â ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},bbar:{items:Ld}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return ki.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:n="Â ",cancelButton:r,okButton:i,rootElement:s=document.body}){const o=this;return o.rootElement=s,o.getConfig("lazyItems"),o.title=o.optionalL(n),o.widgetMap.message.html=o.optionalL(t),o.element.classList.remove(o.showClass),o.showClass=`b-messagedialog-${e}`,o.element.classList.add(o.showClass),i&&(i="string"==typeof i?{text:i}:i),r&&(r="string"==typeof r?{text:r}:r),i=Object.assign({},o.widgetMap.okButton.initialConfig,i),r=Object.assign({},o.widgetMap.cancelButton.initialConfig,r),i.text=o.optionalL(i.text),r.text=o.optionalL(r.text),ki.reconfigure(o.widgetMap.okButton,i),ki.reconfigure(o.widgetMap.cancelButton,r),o.show(),o.promise=new Promise((e=>{o.resolve=e}))}doResolve(e){const t=this,{resolve:n}=t;if(n){const r="b-messagedialog-prompt"===t.showClass;if(r&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,n(r?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.onCancelClick()),"Enter"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(_d.okButton)}onCancelClick(){this.doResolve(_d.cancelButton)}}Pd.initClass();const _d=new Pd;class $d extends As{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"b-icon-first"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"b-icon-previous"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text"},nextPageButton:{onClick:"up.onNextPageClick",icon:"b-icon-next"},lastPageButton:{onClick:"up.onLastPageClick",icon:"b-icon-last"},separator:{type:"widget",cls:"b-toolbar-separator"},reloadButton:{onClick:"up.onReloadClick",icon:"b-icon-reload"},spacer:{type:"widget",cls:"b-toolbar-fill"},dataSummary:{type:"widget",cls:"b-toolbar-text"}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const t=this,n={beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t};t.store&&t.store.un(n),t._store=e,e&&(e.on(n),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget((e=>e.disable()))}updateLocalization(){const e=this,{reloadButton:t,firstPageButton:n,previousPageButton:r,nextPageButton:i,lastPageButton:s}=e.widgetMap;n.tooltip=e.L("L{firstPage}"),r.tooltip=e.L("L{prevPage}"),i.tooltip=e.L("L{nextPage}"),s.tooltip=e.L("L{lastPage}"),t.tooltip=e.L("L{reload}"),e.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:n}=e.widgetMap;let r,i,s,o,a;if(r=i=s=o=a=0,e.store){const{store:t}=e,{pageSize:n,currentPage:l}=t;r=t.count,i=t.lastPage,a=t.allCount,s=Math.max(0,(l-1)*n+1),o=Math.min(a,s+n-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:i}),n.html=r?e.L("L{summaryTemplate}")({start:s,end:o,allCount:a}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:t,store:n}=e,{count:r,lastPage:i,currentPage:s}=n,{pageNumber:o,pageCount:a,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=t;e.eachWidget((e=>e.enable())),o.value=s,o.max=i,h.disabled=o.disabled=a.disabled=!r,l.disabled=c.disabled=s<=1||!r,d.disabled=u.disabled=s>=i||!r,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}}$d.initClass(),$d._$name="PagingToolbar";class Hd extends ki{static get $name(){return"Slider"}static get type(){return"slider"}static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"]}}compose(){const{id:e,min:t,max:n,showValue:r,step:i,text:s,value:o}=this,a=`${e}-input`,l=Boolean(s||r);return{class:{"b-has-label":l,"b-text":l},children:{input:{tag:"input",type:"range",id:a,reference:"input",min:t,max:n,step:i,value:o,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:a,html:r?s?`${s} (${o})`:o:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){this.value=parseInt(this.input.value,10),this.trigger("input",{value:this.value})}onInternalMouseOver(){var e;null===(e=this.tooltip)||void 0===e||e.showBy({target:this.calcThumbPosition(),offset:5})}onInternalMouseOut(){var e;null===(e=this.tooltip)||void 0===e||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}updateMin(e){const t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}changeTooltip(e,t){return e&&(e.owner=this),Ws.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)}})}updateValue(e){const t=this,{input:n,_tooltip:r}=t;r&&(r.html=t.value),n&&n.value!==String(e)&&(n.value=e,t.triggerChange(!1)),t.updateUI()}calcThumbPosition(){const e=this,t=nn.from(e.input),n=(t.width-e.thumbSize)*e.percentProgress/100;return new nn(t.x+n,t.y+t.height/2-e.thumbSize/2,e.thumbSize,e.thumbSize)}updateUI(){var e;null===(e=this._tooltip)||void 0===e||e.alignTo({target:this.calcThumbPosition(),offset:5})}}Hd.initClass(),Hd._$name="Slider";class jd extends fd{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){null!=e&&e.checked&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){return[this.inputElement,this.toggleElement,{tag:"label",class:"b-slidetoggle-label",for:`${this.id}-input`,reference:"textLabel",html:this.text||""}]}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}}jd.initClass(),jd._$name="SlideToggle";const Bd=e=>parseInt(er.getStyleValue(e,"flex-basis"),10)||parseInt(er.getStyleValue(e,"flex-grow"),10);class Nd extends ki{static get $name(){return"Splitter"}static get type(){return"splitter"}static get defaultConfig(){return{orientation:"auto"}}doDestroy(){this.mouseDetacher&&this.mouseDetacher(),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:d({pointerdown:"onMouseDown"},!r.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"})}}get currentOrientation(){return this._currentOrientation}get orientation(){return this._orientation}set orientation(e){this._orientation=e,this._currentOrientation="auto"===e?null:e,this.updateOrientation()}updateOrientation(){const e=this,{element:t}=this;if(e._prevOrientation&&t.classList.remove(e._prevOrientation),!e._currentOrientation&&e.rendered&&t.offsetParent){const n=er.getStyleValue(t.parentElement,"flex-direction");if(n)e._currentOrientation=n.startsWith("column")?"horizontal":"vertical";else{const n=t.previousElementSibling,r=t.nextElementSibling;if(!n||!r)return;const i=n.getBoundingClientRect(),s=r.getBoundingClientRect(),o=i.top<s.top?i:s,a=o===s?i:s;e._currentOrientation=o.top!==a.top?"horizontal":"vertical"}}e._currentOrientation&&t.classList.add(`b-${e._currentOrientation}`),e._prevOrientation=e._currentOrientation}onMouseDown(e){e.preventDefault(),e.touches&&(e=e.touches[0]);const t=this,{element:n}=t,i=n.previousElementSibling,s=n.nextElementSibling,o=Bd(i),a=Bd(s),l=[];t.mouseDetacher&&t.mouseDetacher();for(const e of n.parentElement.children)Bd(e)&&e!==n&&l.push({element:e,width:e.offsetWidth,height:e.offsetHeight});t.context={startX:e.pageX,startY:e.pageY,prevWidth:i.offsetWidth,prevHeight:i.offsetHeight,nextWidth:s.offsetWidth,nextHeight:s.offsetHeight,prevHasFlex:o,nextHasFlex:a,flexed:l,prev:i,next:s};const c={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:t};r.supportsPointerEvents||(c.mousemove="onMouseMove",c.touchmove="onMouseMove",c.mouseup=c.touchend="onMouseUp"),t.mouseDetacher=Tr.on(c)}onMouseMove(e){const t=this,{context:n}=t,r=e.pageX-n.startX,i=e.pageY-n.startY;if(e.preventDefault(),Object.assign(n,{deltaX:r,deltaY:i}),n.started||(n.started=!0,t.trigger("start",{context:n,event:e}),n.flexed.forEach((e=>{"vertical"===t.currentOrientation?e.element.style.flexGrow=e.width:e.element.style.flexGrow=e.height,e.element.style.flexBasis="0"}))),"vertical"===t.currentOrientation){const e=n.prevWidth+r,t=n.nextWidth-r;n.prevHasFlex?n.prev.style.flexGrow=e:n.prev.style.width=`${e}px`,n.nextHasFlex?n.next.style.flexGrow=t:n.next.style.width=`${t}px`}else{const e=n.prevHeight+i,t=n.nextHeight-i;n.prevHasFlex?n.prev.style.flexGrow=e:n.prev.style.height=`${e}px`,n.nextHasFlex?n.next.style.flexGrow=t:n.next.style.height=`${t}px`}t.trigger("move",{context:n,event:e})}onMouseUp(e){const t=this;t.mouseDetacher&&t.mouseDetacher(),t.mouseDetacher=null,t.context.started&&t.trigger("end",{context:t.context,event:e}),t.context=null}render(){super.render(...arguments);const e=this;e._currentOrientation||(e.updateOrientation(),e._currentOrientation||e.requestAnimationFrame((()=>e.updateOrientation())))}}Nd.initClass(),Nd._$name="Splitter";class zd extends Rs{static get $name(){return"Tab"}static get type(){return"tab"}static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title"}}compose(){const{active:e,cls:t,index:n,isFirst:r,isLast:i}=this;return{tabindex:-1,class:d({"b-tabpanel-tab":1,"b-active":e,"b-tab-first":r,"b-tab-last":i},t),dataset:{index:n}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var n,r;const i=this;(null==t?void 0:t.tab)===i&&(t.tab=null),e&&(e.tab=i,i[i.titleProperty]=e[i.titleSource],i.itemCls=e.cls),null===(n=i.itemChangeDetacher)||void 0===n||n.call(i),i.itemChangeDetacher=e&&Se.after(e,"onConfigChange","onItemConfigChange",i,{return:!1}),null===(r=i.itemHideDetacher)||void 0===r||r.call(i),i.itemHideDetacher=null==e?void 0:e.on({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:i,prio:1e3}),i.syncMinMax()}updateItemCls(e,t){const{element:n}=this,r=n&&on.from(null==n?void 0:n.classList,!0);n&&(r.remove(t).add(e),n.className=r.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:n}=e;let{_minWidth:r,_minHeight:i,_maxWidth:s,_maxHeight:o}=e;if(n){const{tabMinWidth:a,tabMaxWidth:l}=n;null!=a&&(t?(r===a&&(r=null),i=a):(i===a&&(i=null),r=a)),null!=l&&(t?(s===l&&(s=null),o=l):(o===l&&(o=null),s=l)),e.minWidth=r,e.minHeight=i,e.maxWidth=s,e.maxHeight=o}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:n}=this;this.hidden=t,t&&e===n.activeItem&&n.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:n}=this;this.disabled=t,e===n.activeItem&&n.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}}zd.initClass(),zd._$name="Tab";const Vd=e=>e.isTab;class Wd extends As{static get $name(){return"TabBar"}static get type(){return"tabbar"}static get configurable(){return{defaultType:"tab",overflow:"scroll"}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(Vd)}get tabs(){return Ce.from(this._items,Vd)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,Vd)}onChildAdd(e){super.onChildAdd(e),null==e.index&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}syncTabs(){const{tabs:e}=this;for(let t=0,n=e.length;t<n;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===n-1}tabAt(e){return this._items.find(Vd,e)||null}}Wd.initClass(),Wd._$name="TabBar";const Gd=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];class Ud extends Oi{static get $name(){return"Card"}static get type(){return"card"}static get configurable(){return{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}}onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:n,owner:r}=t,i=null!=r.activeIndex?r.activeIndex:t.activeIndex||0,s=r.items.indexOf(e),o=null!=n?e===n:s===i;e.on({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t}),o?(e.show(),t._activeIndex=s,t._activeItem=e):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e),this._activeItem===e&&this.activateSiblingOf(e),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:this})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,n=t.items.slice(),r=n.indexOf(e);n.splice(r,1),this.activeIndex=Math.min(r,n.length-1)}setActiveItem(e,t=this.activeIndex){const n=this,{owner:r}=n,{items:i}=r,s=e instanceof ki,o=i[t],a=r.items[e=s?e=i.indexOf(e):parseInt(e)],l={prevActiveIndex:t,prevActiveItem:o};if(a&&!a.$isActivating&&a!==o){var c;const i=o&&o.element,s=a&&a.element;if(n.animateDetacher){const e=n.animateDetacher.event;n.animateDetacher(),er.removeClasses(e.prevActiveItem.element,Gd),er.removeClasses(e.activeItem.element,Gd),n.animateDetacher=null}if(l.activeIndex=e,l.activeItem=a,!1===r.trigger("beforeActiveItemChange",l))return null;null===(c=r.onBeginActiveItemChange)||void 0===c||c.call(r,l),l.promise=new Promise(((c,d)=>{if(i&&r.isVisible&&n.animateCardChange){const u=o.monitorResize;o.monitorResize=!1,n.contentElement.style.overflowX="hidden",o._hidden=!0,a.$isActivating=!0,a.show(),a.$isActivating=!1,i.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),s.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),r.isAnimating=!0,n.animateDetacher=Tr.onTransitionEnd({mode:"animation",element:s,once:!0,thisObj:o,handler(){n.animateDetacher?(n.animateDetacher=null,r.isAnimating=!1,er.removeClasses(s,Gd),i&&(er.removeClasses(i,Gd),o.$isDeactivating=!0,o._hidden=!1,o.hide(),o.monitorResize=u,o.$isDeactivating=!1),n.contentElement.style.overflowX="",n.onActiveItemChange(l,c)):n.setActiveItem(e,t)}}),n.animateDetacher.reject=d,n.animateDetacher.event=l}else a.$isActivating=!0,a.show(),a.focus(),a.$isActivating=!1,o&&(o.$isDeactivating=!0,o.hide(),o.$isDeactivating=!1),n.onActiveItemChange(l,c)}))}return l}onActiveItemChange(e,t){const n=this;n._activeItem=e.activeItem,n._activeIndex=e.activeIndex,n.owner.trigger("activeItemChange",e),e.activeItem.focus(),t(e)}renderChildren(){const{owner:e}=this;r.isIE11&&(this.animateCardChange=!1),e.contentElement.classList[e.suppressChildHeaders?"add":"remove"](this.hideChildHeaderCls),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}}Ud.initClass(),Ud._$name="Card";class Yd extends Bs{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:n,tabBar:r}=this;return n.indexOf(null===(e=r.tabs[t])||void 0===e?void 0:e.item)}get bodyConfig(){return Ot.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return(null==t?void 0:t.focusElement)||(null==t||null===(e=t.tab)||void 0===e?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:n}=e,r=e.tabBar.tabs;if(!(t>=0&&t<r.length))throw new Error(`Invalid activeTab ${t} (${r.length} tabs)`);n.activeIndex=e.items.indexOf(r[t].item),n.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const t=this,{tabBar:n}=t,r=t.makeTabConfig(e),i=r&&n.firstTab,s=i&&n._items,o=i&&Ce.from(t._items,(t=>t.tab||t===e)),a=i?o.indexOf(e)+s.indexOf(i):0;r&&(i&&null==e.weight&&a<s.count-1?n.insert(r,a):n.add(r))}}onChildRemove(e){var t,n;null===(t=e.tab)||void 0===t||null===(n=t.destroy)||void 0===n||n.call(t),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,n=null==t?void 0:t[e];return n&&(n.disabled||n.hidden)}findAvailableTab(e,t=1){const{tabs:n}=this.tabBar,r=n.length,i=Math.max(0,n.indexOf(e.tab));let s;i&&(t=-t);for(let e=1;e<=r&&(s=(i+(t<0?r:0)+e*t)%r,this.isDisabledOrHiddenTab(s));++e);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e){const t=this,{tabBar:n}=t,{tabCount:r}=n;if(e.isWidget||Ot.isObject(e)?(-1===t.items.indexOf(e)&&(e=t.add(e)),e=n.indexOfTab(e.tab)):e=parseInt(e,10),!t.initialItems&&(e<-1||e>=r))throw new Error(`Invalid activeTab ${e} (${r} tabs)`);return t.isDisabledOrHiddenTab(e)&&(e=t.findAvailableTab(e)),e}updateActiveTab(){if(!this.initialItems){const{activeTabItemIndex:e}=this;e>-1&&(this.layout.activeIndex=e)}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,n={item:e,type:"tab",tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,listeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return!1===t?null:Ot.isObject(t)?zd.mergeConfigs(n,t):n}updateItems(e,t){const n=this,{activeTab:r,initialItems:i}=n;let s,o=0;super.updateItems(e,t),i&&(s=Array.from(e,(e=>n.makeTabConfig(e))).filter((e=>{if(e)return e.index=o++,!0})),o&&(s[0].isFirst=!0,s[o-1].isLast=!0,s[r].active=!0,n.tabBar.add(s),n.activeTab=r))}updateTabMinWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.minWidth=e)}))}updateTabMaxWidth(e){var t;null===(t=this.tabBar)||void 0===t||t.items.forEach((t=>{t.isTab&&(t.maxWidth=e)}))}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&an.on({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:t,activeTab:n,element:r}=e,{animateCardChange:i}=t;t.animateCardChange=!1,e.height=null,e.height=Math.max(...e.items.map((t=>(e.activeTab=t,r.clientHeight))))+1,e.activeTab=n,t.animateCardChange=i,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:n,prevActiveItem:r}=e;this.activeTab=t.indexOf(null==n?void 0:n.tab),null!=r&&r.tab&&(r.tab.active=!1),null!=n&&n.tab&&(n.tab.active=!0,n.tab.show())}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onPaint(){super.onPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}}Yd.initClass(),Yd._$name="TabPanel";class qd extends rd{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{picker:{type:"widget",cls:"b-textareafield-picker",floating:!0,scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:null,inline:!0,resize:"none",inputType:null}}startConfigure(e){this.getConfig("inline"),super.startConfigure(e)}get inputElement(){const e=super.inputElement,{inline:t,resize:n}=this;return t?(e.tag="textarea",e.style=(e.style||"")+`;resize:${n}`):(e.readOnly="readonly",e.reference="displayElement"),e}get focusElement(){return this.inline||this._picker&&this._picker.isVisible?this.input:this.displayElement}showPicker(){const e=this,{picker:t}=e;e.inline||(t.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,n=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const r=super.onPickerKeyDown(e);return t.input=n,r}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return null==e?"":e}updateInline(e){e||this.triggers||(this.triggers={})}changeTriggers(e,t){return this.inline||((e||(e={})).expand={cls:"b-icon-picker",handler:"onTriggerClick"}),super.changeTriggers(e,t)}changePicker(e,t){var n;const r=this,i=r.pickerWidth||(null===(n=e)||void 0===n?void 0:n.width);if(e=qd.reconfigure(t,e?j.merge({owner:r,forElement:r[r.pickerAlignElement],align:{matchSize:null==i,anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},html:`<textarea id="${r.id+"-input"}" style="resize:${r.resize}">${r.value}</textarea>`},e):null,r)){const t=r.input=e.element.querySelector(`#${r.id}-input`);r.inputListenerRemover=Tr.on({element:t,thisObj:r,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}}qd.initClass(),qd._$name="TextAreaField";const Kd="http://www.w3.org/2000/svg",Xd={bar:1,outline:2,text:3},Zd=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),Jd=e=>e.field,Qd=()=>!1;class eu extends ki{static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:Kd,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:Kd,tag:"g",reference:"scaledSvgGroup"},{ns:Kd,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){var t;const n=this;null===(t=n.tip)||void 0===t||t.destroy(),n._tip=e?Ws.new({owner:n,forElement:n.svgElement,forSelector:"rect",listeners:{beforeShow:"up.onBeforeTipShow"}},e):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform",`scale(${e.width} ${e.height})`)}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}set series(e){const t=this._series={};for(const n in e)if(!1!==e[n]){const r=t[n]=Object.assign({},e[n]);!r.type&&e[n].type&&(r.type=e[n].type),!r.field&&e[n].field&&(r.field=e[n].field),"order"in t||(r.order=Xd[r.type]),r.id=n}this.scheduleRefresh()}get series(){return this._series}set data(e){const t=this;if(t._data=e,!t.topValue){const n=Object.values(t.series).map(Jd);for(let r=0,{length:i}=e;r<i;r++)for(let i=0,{length:s}=n;i<s;i++)t.topValue=Math.max(t.topValue||0,e[r][n[i]])}t.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:t,_tip:n}=e,r=[];for(const n in t){const i=t[n],s=e[`draw${A.capitalize(i.type)}`](i);Array.isArray(s)?r.push.apply(r,s):r.push(s)}r.sort(Zd),Ur.syncChildren({domConfig:{children:r},configEquality:Qd},e.scaledSvgGroup),Ur.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),n&&n.isVisible&&e.onBeforeTipShow({source:n})}drawBar(e){const t=this,{topValue:n,data:i,omitZeroHeightBars:s,barStyle:o}=t,{field:a,order:l}=e,c=1/i.length,d=[];let u;for(let h=0,g=0,{length:m}=i;h<m;h++,g+=u){const m=i[h],p=m[a],f=(p>n?n:p)/n,v=1-f,y=m.rectConfig={ns:Kd,tag:"rect",dataset:{}};if(u=m.width||c,r.isEdge||r.isIE11){const e=t.svgElement.getBoundingClientRect();y.dataset.scaleX=e.width,y.dataset.scaleY=e.height}o?y.style=o:delete y.style,Object.assign(y.dataset,{index:h,order:l}),Object.assign(y,{x:g,y:v,width:u,height:f,class:t.callback("getRectClass",t,[e,y,m,h])});const b=t.callback("getBarTip",t,[e,y,m,h]);b?y.dataset.btip=b:delete y.dataset.btip,!f&&s||d.push(y)}return d}drawOutline(e){const t=this,{topValue:n,data:i}=t,{field:s,order:o}=e,a=1/i.length,l=["M 0,1"],c=e.outlineElement||(e.outlineElement={ns:Kd,tag:"path",dataset:{order:o}});if(r.isEdge||r.isIE11){const e=t.svgElement.getBoundingClientRect();c.style=`stroke-width: ${1/Math.min(e.width,e.height)}px`}let d,u="M",h="L";for(let e=0,t=0,{length:r}=i;e<r;e++){const r=1-i[e][s]/n;d=i[e].width||a,l.push(`${u} ${t},${r} ${h} ${t+=d},${r}`),u=h=""}return c.d=l.join(" "),c}drawText(){const e=this,{data:t}=e,n=1/t.length,r=[];for(let i,s=0,o=0,{length:a}=t;s<a;s++,o+=i){i=t[s].width||n;e.callback("getBarText",e,[t[s],s])&&r.push({ns:Kd,tag:"text",className:"b-bar-legend",html:e.callback("getBarText",e,[t[s],s]),x:100*(o+i/2)+"%",y:"100%",dataset:{index:s}})}return r}getBarText(e,t){return""}getBarTip(e,t,n,r){}getRectClass(e,t,n,r){return""}}eu.initClass(),eu._$name="Histogram";const tu="http://www.w3.org/2000/svg";class nu extends ki{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:tu,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:tu,tag:"g",reference:"scaledSvgGroup",children:[{ns:tu,tag:"path",reference:"pathElement"}]},{ns:tu,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove(`b-align-${t}`),this.element.classList.add(`b-align-${e}`)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:t,width:n,height:r,align:i,scalePoints:s,scaleMaxPadding:o}=e,a=s[s.length-1].value,l=[],c=[],d=1/(a+o*a);e.scaledSvgGroup.setAttribute("transform",`scale(${t?n:1} ${t?1:r})`);for(const e of s){const s=Boolean(e.text),o=d*e.value;if(s){const s={ns:tu,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};t?(s.x=100*o+"%",s.y="top"===i?"1.6em":r-12):(s.x="left"===i?"12":""+(n-12),s.y=100*(1-o)+"%"),c.push(s)}t?"top"===i?l.push(`M${o},0 L${o},${s?10:5}`):l.push(`M${o},${r} L${o},${r-(s?10:5)}`):"left"===i?l.push(`M0,${1-o} L${s?10:5},${1-o}`):l.push(`M${n},${1-o} L${n-(s?10:5)},${1-o}`)}e.pathElement.setAttribute("d",l.join("")),Ur.syncChildren({domConfig:{children:c}},e.unscaledSvgGroup)}}nu._$name="Scale";class ru extends me{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-"}}updateElement(e){Tr.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar({initials:e,color:t,iconCls:n,imageUrl:r,defaultImageUrl:i,dataset:s={},alt:o}){return this.getImageConfig(e,t,r,i,s,o)||this.getIconConfig(n,s)||this.getResourceInitialsConfig(e,t,s)}getImageConfig(e,t,n,r,i,s){if(n=this.failedUrls.has(n)?r:n||r)return{tag:"img",draggable:"false",class:{"b-resource-avatar":1,"b-resource-image":1},ontouchstart:"return false",alt:s,elementData:{defaultImageUrl:r,imageUrl:n,initials:e,color:t,dataset:i},src:n,dataset:i}}getIconConfig(e,t){if(e)return e&&{tag:"i",class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,n){const r=er.isNamedColor(t)&&t,i=!r&&t;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[`${this.colorPrefix}${r}`]:r},style:{backgroundColor:i||null},children:[A.encodeHtml(e)],dataset:n}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:t,initials:n,color:r,imageUrl:i,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const t=er.createElement(this.getResourceInitialsConfig(n,r,s));e.parentElement.replaceChild(t,e)}this.failedUrls.add(i)}}ru._$name="AvatarRendering",window&&!window.bryntum&&(window.bryntum={});const iu=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px"));class su extends(Be(Ye(Oo))){static get fields(){return["text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},{name:"editor",defaultValue:{}},"finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t){if(!e)return!1;const n={};return"function"==typeof e?n.sortFn=e.bind(t):"object"==typeof e&&(Object.assign(n,e),n.fn&&(n.sortFn=n.fn,delete n.fn)),n}},{name:"searchable",defaultValue:!0},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;const t={columnOwned:!0};return"function"==typeof e?t.filterFn=e:"object"==typeof e&&Object.assign(t,e),t}},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},"type",{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"}]}static get autoExposeFields(){return!1}construct(e,t){const n=this;n.masterStore=t,t&&(n._grid=Array.isArray(t)?t[0].grid:t.grid),n.localizableProperties=e.localizableProperties||["text"],e.localeClass&&(n.localeClass=e.localeClass),super.construct(e,t,null,!1),"field"in n.data||(n.field="_"+(n.type||"")+ ++su.emptyCount,n.noFieldSpecified=!0),n.hasComplexMapping=n.field&&n.field.includes("."),n.width||n.flex||n.children||n.set({width:su.defaultWidth,flex:null},null,!0)}doDestroy(){var e,t,n;null===(e=this.data)||void 0===e||null===(t=e.editor)||void 0===t||null===(n=t.destroy)||void 0===n||n.call(t),super.doDestroy()}remove(){const{subGrid:e,grid:t}=this,n=e&&t&&t.focusedCell;n&&n.columnId===this.id&&(t.owns(er.getActiveElement(t))?t.navigateRight():n.columnId=e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0).id),super.remove()}getRawValue(e){const t=this;return t.hasComplexMapping?Ot.getPath(e,t.field):e[t.field]}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(!this.parent||this.parent.isLastInSubGrid)}get element(){return this.grid.getHeaderElement(this)}get textWrapper(){return er.getChild(this.element,".b-grid-header-text")}get textElement(){return er.down(this.element,".b-grid-header-text-content")}get contentElement(){return er.down(this.element,".b-grid-header-children")}get editor(){let e=this.data.editor;if(e&&!(e instanceof ki)){const t=this.grid.processCellEditor({editor:e,field:this.field});t?e=this.data.editor=t.editor:("string"==typeof e&&(e={type:e}),e=this.data.editor=ki.create(Ot.merge(this.defaultEditor,e,{owner:this.grid})))}return e}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}get isFocusable(){return this.isLeaf}static get type(){return"column"}static get text(){return this.$meta.fields.defaults.text}get grid(){return this._grid||this.parent&&this.parent.grid}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get headerText(){return this.htmlEncodeHeaderText?A.encodeHtml(this.text):this.text}hide(e=!1){const t=this,n=t.parent;if(!t.hidden){if(t.hidden=!0,n&&!n.isRoot){n.children.some((e=>!0!==e.hidden))||n.hidden||(e=!0,n.hide())}t.children&&t.children.forEach((e=>e.hide(!0))),e||t.stores.forEach((e=>e.trigger("columnHide",{column:t})))}}show(e=!1){const t=this,n=t.parent;t.hidden&&(t.hidden=!1,n&&n.hidden&&n.show(),t.children&&t.children.forEach((e=>e.show(!0))),e||t.stores.forEach((e=>e.trigger("columnShow",{column:t}))))}toggle(e=null){return this.hidden&&e===n||!0===e?this.show():!this.hidden&&e===n||!1===e?this.hide():void 0}generateId(){return su.generatedIdIndex||(su.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++su.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return iu(e)&&iu(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}set subGrid(e){this._subGrid=e}get subGrid(){return this._subGrid||(this.grid?this.grid.getSubGridFromColumn(this):n)}get subGridElement(){return this.subGrid.element}measureSize(e){return er.measureSize(e,this.subGrid?this.subGrid.element:n)}calculateMinWidth(){const e=this,t=e.measureSize(e.width),n=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,n,r)}resizeToFitContent(e,t,n=!1){const r=this,{grid:i,element:s,fitMode:o}=r,{rowManager:a,store:l}=i,{count:c}=l;if(c<=0||"none"===r.fitMode||!r.fitMode)return;const[d]=a.rows,{rowElement:u,cellElement:h}=i.beginGridMeasuring();let g,m,p,f,v,y,b=0,C={length:0,record:null};if(h._domData={columnId:r.id,row:d,rowElement:u},h.innerHTML="",i.resizeToFitIncludesHeader){if(!i.$headerPadding){const e=window.getComputedStyle(s);i.$headerPadding=parseInt(e.paddingLeft)}const e=s.querySelector(".b-grid-header-text-content");e.style.cssText="flex: none; width: auto",b=e.offsetWidth+2*i.$headerPadding+2,e.style.cssText=""}for(c>1e3?(g=Math.max(Math.min(a.topIndex+Math.round(a.rowCount/2)-500,c-1e3),0),m=g+1e3):(g=0,m=c),p=g;p<m;p++){if(f=l.getAt(p),v=r.getRawValue(f),"value"===o)y=String(v).length;else if(d.renderCell({cellElement:h,record:f,updatingSingleRow:!0,isMeasuring:!0}),"textContent"===o)y=h.textContent.length;else{const e=h.offsetWidth;e>b&&(b=e)}y>C.length&&(C={record:f,length:y})}return"value"!==o&&"textContent"!==o||(d.renderCell({cellElement:h,record:C.record,updatingSingleRow:!0,isMeasuring:!0}),b=Math.max(b,h.offsetWidth)),Array.isArray(e)&&([e,t]=e),b=Math.max(b,e||0),b=Math.min(b,t||1e6),n||i.endGridMeasuring(),r.width=b,b}getState(){const e=this,t={id:e.id,[e.flex?"flex":"width"]:e.flex?e.flex:e.width,hidden:e.hidden,region:e.region,locked:e.locked};return e.children&&(t.children=e.children.map((e=>e.getState()))),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=n:"flex"in e&&t.width&&(t.width=n),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden)}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(t!==n)return t}return!0}}su.emptyCount=0,su.defaultWidth=100,su.exposeProperties(),su._$name="Column";const ou={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}};class au extends(Ye(ta)){static get defaultConfig(){return{modelClass:su,tree:!0,autoAddField:!1}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`,e.grid.on({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.on({change:t.onStoreChange,thisObj:t,prio:1})}get modelClass(){return this._modelClass}set modelClass(e){this._modelClass=e}doDestroy(){const e=[];this.isChained||this.traverse((t=>e.push(t))),super.doDestroy(),this.isChained||e.forEach((e=>e.destroy()))}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((n,r)=>e.call(t,n,r)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}calculateFixedWidth(e){return e.flex?e.measureSize(su.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>!(e.hidden||e.subGrid&&e.subGrid.collapsed)))),e._visibleColumns}onStoreChange({action:e,changes:t}){("update"!==e||"hidden"in t)&&this.clearCaches()}clearSubGridCaches(e){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,null===(e=this.masterStore)||void 0===e||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),("update"!==e.action||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,n=!1){const r=this.visibleColumns,i=e instanceof su?e:this.getById(e);let s=r.indexOf(i)+(t?1:-1);if(!r[s]){if(!n)return null;s=t?0:r.length-1}return r[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,n;const{grid:r={}}=this,{store:i}=r,s=null==i||null===(t=i.modelClass)||void 0===t||null===(n=t.fieldMap)||void 0===n?void 0:n[e.field];let o=this.modelClass;if(null!=s&&s.column&&(e=j.merge({},s.column,e)),e.type&&(o=au.getColumnClass(e.type),!o))throw new Error(`Column type '${e.type}' not registered`);e.locked&&(e.region="locked",delete e.locked);const a=new o(e,this);if(a.data.region||(a.data.region=r.defaultRegion||"normal"),this.autoAddField&&!a.noFieldSpecified&&i&&!s){let e=a.field;a.constructor.fieldType&&(e={name:a.field,type:a.constructor.fieldType}),i.modelClass.addField(e)}return a}indexOf(e){const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}get usesAutoHeight(){return this.find((e=>e.autoHeight))}get usesFlexAutoHeight(){return this.find((e=>e.autoHeight&&null!=e.flex))}static registerColumnType(e,t=!1){au.columnTypes||(au.columnTypes={}),e.simpleRenderer=t,au.columnTypes[e.type]=e}static getColumnClass(e){return au.columnTypes&&au.columnTypes[e]}generateColumnForField(e,t){var n;"string"==typeof e&&this.grid&&(e=null===(n=this.grid.store)||void 0===n?void 0:n.modelClass.fieldMap[e]);let r=e.column||ou[e.type]||{};return"string"==typeof r&&(r={type:r}),r=Object.assign({text:e.text||A.separate(e.name),field:e.name},t,r),null!=e.precision&&(r.format.maximumFractionDigits=e.precision),e.columnType&&(r.type=e.columnType),this.createRecord(r)}}au.registerColumnType(su,!0),au._$name="ColumnStore";class lu extends su{static get type(){return"action"}static get fields(){return["actions",{name:"disableIfGridReadOnly",defaultValue:!1}]}static get defaults(){return{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30}}get groupHeaderReserved(){return!0}construct(e,t){const n=this;n.internalCellCls="b-action-cell",super.construct(...arguments),e.width||e.flex||n.grid.on("paint",n.updateAutoWidth,n),n.disableIfGridReadOnly&&n.grid.element.classList.add("b-actioncolumn-readonly")}renderer({column:e,record:t}){var n;const r=t&&"groupRowFor"in t.meta;return{className:{"b-action-ct":1},children:null===(n=e.actions)||void 0===n?void 0:n.map(((n,i)=>{if("visible"in n){if("function"==typeof n.visible&&!1===n.visible({record:t}))return"";if(!1===n.visible)return""}if(r&&!n.showForGroup||!r&&n.showForGroup)return"";let s;if(s="function"==typeof n.tooltip?n.tooltip({record:t}):n.tooltip||"",n.renderer&&"function"==typeof n.renderer){const r=n.renderer({index:i,record:t,column:e,tooltip:s,action:n});return"string"==typeof r?{tag:"span",dataset:{index:i},html:r}:(r.dataset=r.dataset||{},r.dataset.index=i,r)}return{tag:"i",dataset:{index:i,btip:s},className:{"b-action-item":1,[n.cls]:n.cls}}}))}}onCellClick({grid:e,column:t,record:n,target:r}){var i;if(t!==this||!r.classList.contains("b-action-item"))return;let s=r.dataset.index;s||(s=r.parentElement.dataset&&r.parentElement.dataset.index);const o=null===(i=t.actions)||void 0===i?void 0:i[s],a=o&&o.onClick;a&&this.callback(a,t,[{record:n,action:o}])}updateAutoWidth(){var e;const t=this,n=[];if(!t.element)return;let r=[];null===(e=t.actions)||void 0===e||e.forEach((e=>{const t=d({},e);delete t.visible,t.showForGroup?(delete t.showForGroup,n.push(t)):r.push(t)})),n.length>r.length&&(r=n);const i=er.createElement(t.renderer({column:{actions:r}})).outerHTML;t.width=er.measureText(i,t.element,!0,t.element.parentElement)}}au.registerColumnType(lu),lu.exposeProperties(),lu._$name="ActionColumn";class cu extends su{static get type(){return"aggregate"}static get fields(){return["function"]}static get defaults(){return{function:"sum"}}construct(e,t){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:n}=t;n&&(this.owner=n,n.on({paint:"onGridPaint",thisObj:this,prio:1e3}))}onGridPaint({source:e}){this.store=e.store}set store(e){const t=this,n={update:"onRecordUpdate",thisObj:t,prio:1e3},r=t._store;if(e!==r){r&&r.un(n),t._store=e;const{modelClass:i}=e,s=i.fieldMap[t.field];s&&"number"===s.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.on(n)}}canEdit(e){return e.isLeaf}get store(){return this._store}sum(...e){let t=0;for(let n=0,{length:r}=e;n<r;n++)t+=parseInt(e[n]||0,10);return t}avg(...e){let t=0;const{length:n}=e;for(let r=0;r<n;r++)t+=parseInt(e[r]||0,10);return t/n}onRecordUpdate({record:e,changes:t}){const n=this,{rowManager:r}=n.grid;n.field in t&&e.isLeaf&&e.bubble((e=>{const t=r.getRowFor(e);if(t){const r=t.getCell(n.field);r&&t.renderCell({cellElement:r,record:e})}}),!0)}getRawValue(e){let t=0;if(e.children){const n=this,r=n.function,i="string"==typeof r&&"function"==typeof Math[r],{handler:s,thisObj:o}=i?{handler:Math[r],thisObj:Math}:n.resolveCallback(r);for(let r=0,{length:i}=e.children;r<i;r++)t=s.call(o,t,n.getRawValue(e.children[r]));e.setData(n.field,t)}else t=e[this.field];return t}}au.registerColumnType(cu,!0),cu.exposeProperties(),cu._$name="AggregateColumn";class du extends su{static get type(){return"widget"}static get fields(){return["widgets"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1}}construct(e,t){const n=this;n.widgetMap={},n.internalCellCls="b-widget-cell",super.construct(...arguments),n.externalRenderer=n.renderer,n.renderer=n.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}internalRenderer(e){var t;const n=this,{cellElement:r,column:i,value:s,record:o,isExport:a}=e,l=i.widgets;if(!a&&l&&(r.widgets||n.clearCell(r),r.widgets=e.widgets=l.map(((t,a)=>{var l,c;let d,u;if(r.widgets&&(d=r.widgets[a],u=d.element.nextElementSibling,t.recreate&&d&&(delete n.widgetMap[d.id],d.destroy(),r.widgets[a]=null)),d||(n.onBeforeWidgetCreate(t,e),t.recomposeAsync=!1,d=ql.append(t,u?{insertBefore:u}:r)[0],n.widgetMap[d.id]=d,n.onAfterWidgetCreate(d,e)),d.cellInfo={cellElement:r,value:s,record:o,column:i},n.grid&&!n.isSelectionColumn&&(d.readOnly=n.grid.readOnly),!1!==(null===(l=n.onBeforeWidgetSetValue)||void 0===l?void 0:l.call(n,d,e))&&!t.noValueOnRender){const e=t.valueProperty||"value"in d&&"value";e?d[e]=s:d.defaultBindProperty?d[d.defaultBindProperty]=s:d.text=d.value=s}return null===(c=n.onAfterWidgetSetValue)||void 0===c||c.call(n,d,e),d}))),null===(t=this.externalRenderer)||void 0===t||t.call(this,e),a)return null}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach((e=>{delete this.widgetMap[e.id],e.destroy()})),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}au.registerColumnType(du),du.exposeProperties(),du._$name="WidgetColumn";class uu extends du{static get type(){return"check"}static get fields(){return["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue"]}static get defaults(){return{align:"center",checkCls:null,showCheckAll:!1,widgets:[{type:"checkbox",valueProperty:"checked"}]}}construct(e,t){var n;super.construct(...arguments);const r=this;r.externalHeaderRenderer=r.headerRenderer,r.externalOnBeforeWidgetSetValue=r.onBeforeWidgetSetValue,r.externalOnAfterWidgetSetValue=r.onAfterWidgetSetValue,r.onBeforeWidgetSetValue=r.internalOnBeforeWidgetSetValue,r.onAfterWidgetSetValue=r.internalOnAfterWidgetSetValue,r.headerRenderer=r.internalHeaderRenderer,r.internalCellCls="b-check-cell",null===(n=r.grid)||void 0===n||n.on({destroy:()=>{var e;return null===(e=r.headerCheckbox)||void 0===e?void 0:e.destroy()},thisObj:r})}internalHeaderRenderer({headerElement:e,column:t}){let r;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new fd({appendTo:e,owner:this.grid,listeners:{change:({checked:e})=>{t.trigger("toggleAll",{checked:e})}}})):r=t.headerText,r=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):r,t.showCheckAll?n:r}updateCheckAllState(e){this.headerCheckbox&&(this.suspendEvents(),this.headerCheckbox.checked=e,this.resumeEvents())}internalRenderer({value:e,isExport:t}){return t?null==e?"":e:super.internalRenderer(...arguments)}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.on({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,null===(t=this.externalOnBeforeWidgetSetValue)||void 0===t||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,null===(t=this.externalOnAfterWidgetSetValue)||void 0===t||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t}){if(!this.isInitialSet)return this.trigger("beforeToggle",{record:e.cellInfo.record,checked:t})}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const n=e.cellInfo.record,r=this.field;if(r){const e=`set${A.capitalize(r)}`;n[e]?n[e](t):n.set(r,t)}this.trigger("toggle",{record:n,checked:t})}}onCellKeyDown({event:e,cellElement:t}){if(" "===e.key){const n=t.widget;null==n||n.toggle(),e.preventDefault()}}}au.registerColumnType(uu,!0),uu._$name="CheckColumn";class hu extends su{static get $name(){return"DateColumn"}static get type(){return"date"}static get fieldType(){return"date"}static get fields(){return["format","pickerFormat","step"]}static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}constructor(e,t){super(...arguments),this.internalCellCls="b-date-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=Mt.parse(e,this.format||n)),Mt.format(e,this.format||n)}set format(e){const t=this,n=t.data.editor;t.set("format",e),n&&(n.format=t.format)}get format(){return this.get("format")}get defaultEditor(){const e=this;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:e.format,step:e.step}}}au.registerColumnType(hu,!0),hu.exposeProperties(),hu._$name="DateColumn";class gu extends su{static get type(){return"number"}static get fieldType(){return"number"}static get fields(){return["format","min","max","step","largeStep","unit"]}static get defaults(){return{filterType:"number",format:""}}constructor(e,t){super(...arguments),this.internalCellCls="b-number-cell"}get defaultEditor(){const{format:e,name:t,max:n,min:r,step:i,largeStep:s,align:o}=this;return Ot.cleanupProperties({type:"numberfield",format:e,name:t,max:n,min:r,step:i,largeStep:s,textAlign:o})}get formatter(){const e=this,{format:t}=e;let n=e._formatter;return n&&e._lastFormat===t||(e._formatter=n=lc.get(e._lastFormat=t)),n}defaultRenderer({value:e}){return null!=e&&(e=this.formatter.format(e),this.unit&&(e=`${e}${this.unit}`)),e}}au.registerColumnType(gu,!0),gu.exposeProperties(),gu._$name="NumberColumn";class mu extends su{static get type(){return"percent"}static get fieldType(){return"number"}static get fields(){return["showValue","lowThreshold"]}static get defaults(){return{editor:{type:"number",min:0,max:100},showValue:!1,lowThreshold:20,filterType:"number",htmlEncode:!1,searchable:!1,summaryRenderer:e=>`${e}%`,fitMode:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return{className:"b-percent-bar-outer",children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===(e=e||0),"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:n]}]}}resizeToFitContent(){}}mu.sum="average",au.registerColumnType(mu,!0),mu._$name="PercentColumn";class pu extends gu{static get type(){return"rating"}static get fieldType(){return"number"}static get fields(){return["emptyIcon","filledIcon","editable"]}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}constructor(e,t){super(...arguments),this.internalCellCls="b-rating-cell"}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:Ce.populate(this.max,(t=>{const n=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":n,"b-empty":!n,[n?this.filledIcon:this.emptyIcon]:!0}}}))}}onCellClick({grid:e,column:t,record:n,target:r,event:i}){if(r.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===n.get(t.field)&&0===e&&(e=-1),n.set(t.field,e+1)}}}au.registerColumnType(pu,!0),pu.exposeProperties(),pu._$name="RatingColumn";class fu extends su{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1}}construct(e){super.construct(...arguments);const t=this,{grid:n}=t;t.internalCellCls="b-row-number-cell",n&&(n.on({bindStore:"bindStore",thisObj:t}),t.bindStore({store:n.store,initial:!0}),n.store.count&&!n.rendered&&n.on({paint:"resizeToFitContent",thisObj:t,once:!0}))}static get type(){return"rownumber"}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const n=this;n.detachListeners("grid"),e.on({name:"grid",[`change${n.grid.asyncEventSuffix}`]:"onStoreChange",thisObj:n}),t||n.resizeToFitContent()}onStoreChange({action:e}){"dataset"!==e&&"add"!==e&&"remove"!==e&&"removeall"!==e||this.resizeToFitContent()}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:t}=e,{count:n}=t;if(n&&!this.hidden){const t=e.element.querySelector(`.b-grid-cell[data-column-id="${this.id}"]`);if(t){const e=parseInt(er.getStyleValue(t,"padding-left")),r=er.measureText(n,t);this.width=Math.max(this.minWidth,r+2*e)}}}set flex(e){}}au.registerColumnType(fu,!0),fu._$name="RowNumberColumn";class vu extends su{static get fields(){return["template"]}static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}static get type(){return"template"}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}au.registerColumnType(vu,!0),vu.exposeProperties(),vu._$name="TemplateColumn";class yu extends su{static get type(){return"time"}static get fieldType(){return"date"}static get fields(){return["format"]}static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}constructor(e,t){super(...arguments),this.internalCellCls="b-time-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){const t=this;return"string"==typeof e&&(e=Mt.parse(e,t.format)),Mt.format(e,t.format)}set format(e){const t=this,n=t.editor;t.set("format",e),n&&(n.format=t.format)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}au.registerColumnType(yu,!0),yu.exposeProperties(),yu._$name="TimeColumn";let bu=!1;class Cu extends su{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.7},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"}]}static get type(){return"tree"}constructor(e,t){super(...arguments);const n=this;n.internalCellCls="b-tree-cell",n.shouldHtmlEncode=n.htmlEncode,n.setData("htmlEncode",!1),n.renderer&&(n.originalRenderer=n.renderer),n.renderer=n.treeRenderer.bind(n)}treeRenderer(e){const t=this,{grid:n,column:r,cellElement:i,row:s,record:o,isExport:a}=e,l=o.instanceMeta(n.store),c={className:"b-tree-cell-value"},d=[c],u={className:"b-tree-cell-inner",tag:o.href?"a":"div",href:o.href,target:o.target,children:d},h={"b-tree-parent-row":0,"b-tree-collapsed":0,"b-tree-expanded":0,"b-loading-children":0};let g,m,{value:p}=e;if(t.originalRenderer){var f;const s=t.originalRenderer(e),o=null===(f=n.hasFrameworkRenderer)||void 0===f?void 0:f.call(n,{cellContent:s,column:r});g="object"==typeof s&&!o,p=o?"":!1===s?i.innerHTML:s,e.rendererHtml=s}var v;g||(p=String(null!==(v=p)&&void 0!==v?v:""));if(a)return p;if(o.isLeaf)i.classList.add("b-tree-leaf-cell"),m=e.iconCls||o.iconCls||t.leafIconCls;else{const n=l.collapsed,r=n?t.expandIconCls:t.collapseIconCls,s=n?t.collapsedFolderIconCls:t.expandedFolderIconCls;h["b-tree-parent-row"]=1,h["b-tree-collapsed"]=n,h["b-tree-expanded"]=!n,h["b-loading-children"]=l.isLoadingChildren,i.classList.add("b-tree-parent-cell"),d.unshift({className:"b-tree-expander",children:r?[{tag:"i",className:{[r]:1}}]:null}),bu=m=e.iconCls||o.iconCls||s}s.isRow&&s.assignCls(h),g||t.shouldHtmlEncode||!p.includes("<")?(g&&Object.assign(c,p),c.children=c.children||[],c.children.unshift(m?{tag:"i",className:{"b-tree-icon":1,[m]:1}}:null,g?null:p)):c.html=`${m?`<i class="b-tree-icon ${m}"></i>`:""}${p}`;const y=o.childLevel*t.indentSize+(o.isLeaf?bu?2:m?.5:.4:0);return u.style=`padding-left:${y}em`,u}}au.registerColumnType(Cu,!0),Cu.exposeProperties(),Cu._$name="TreeColumn";class wu extends Oo{static get fields(){return[{name:"iconCls",internal:!0},{name:"expanded",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}}wu.exposeProperties(),wu._$name="GridRowModel";const Su=new Map,Eu=new Map,Du="Grid",xu={Grid:"GridBase",Scheduler:"SchedulerBase",Gantt:"GanttBase"},Ru=/\$\d+$/;class Tu{static registerFeature(e,t=!1,n=null,r=null){r=(r=A.uncapitalize(r||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(Ru,""),Array.isArray(n)||(n=[n||Du]),n.forEach((n=>{const i=xu[n]||n,s=Su.get(i)||new Map,o=Eu.get(i)||new Map;s.set(r,e),o.set(e,t),Su.set(i,s),Eu.set(i,o)}))}static getTypeNameFeatures(e="Grid"){const t=xu[e]||e,n=Su.get(t),r={};return n&&n.forEach(((e,t)=>r[t]=e)),r}static getTypeNameDefaultFeatures(e="Grid"){const t=xu[e]||e,n=Su.get(t),r=Eu.get(t),i={};return n&&r&&n.forEach(((e,t)=>{r.get(e)&&(i[t]=e)})),i}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[n,r])=>(this.isDefaultFeatureForTypeName(r,t)?e[n]=r:delete e[n],e)),e)),{})}static isDefaultFeatureForTypeName(e,t="Grid"){const n=xu[t]||t,r=Eu.get(n);return r&&r.get(e)||!1}static isDefaultFeatureForInstance(e,t){const n=t.$meta.names.slice().reverse();let r=null;for(let t=0,i=n.length;t<i&&null===r;++t){const i=Eu.get(n[t]);i&&i.has(e)&&(r=i.get(e))}return r||!1}static reset(){Su.clear(),Eu.clear()}}Tu._$name="GridFeatureManager";const Mu={Enter:1,F2:1},Fu={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1};class Au extends(br(uo)){static get $name(){return"CellEdit"}static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",addNewAtEnd:null,autoEdit:!1,editorClass:Fd,triggerEvent:"celldblclick",focusCellAnimationDuration:!1}}static get pluginConfig(){return{assign:["startEditing"],before:["onElementKeyDown","onElementMouseDown"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const n=this,r={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:n};n.grid=e,"cellclick"!==n.triggerEvent&&(r[n.triggerEvent]="onTriggerEditEvent"),e.on(r),e.rowManager.on({changeTotalHeight:"onGridRefreshed",thisObj:n}),n.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.on({name:"store",update:"onStoreUpdate",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(_d.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await _d.confirm(e),_d.owner=null),t===_d.yesButton}doDestroy(){this.grid.columns.allRecords.forEach((e=>{var t;null===(t=e._cellEditor)||void 0===t||t.destroy()})),super.doDestroy()}doDisable(e){e&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null===(e=this.editorContext)||void 0===e?void 0:e.record)||null}getEditorForCell({cell:e,column:t,selector:n,editor:r}){const i=this,{grid:s}=i;let o=t._cellEditor,a=0;if(t.editTargetSelector){a=e.querySelector(t.editTargetSelector).offsetLeft}return r.autoSelect=i.autoSelect,o?(o.inputField!==r&&(o.remove(o.items[0]),o.add(r)),o.align.offset[0]=a):o=t._cellEditor=new i.editorClass({constrainTo:null,cls:"b-cell-editor",inputField:r,blurAction:"none",invalidAction:t.invalidAction,completeKey:!1,cancelKey:!1,owner:s,align:{align:"t0-t0",offset:[a,0]},listeners:i.getEditorListeners()}),t.instantUpdate&&!r.cellEditValueSetter&&(Ot.wrapProperty(r,"value",null,(e=>{const{editorContext:t}=i;null!=t&&t.editor.isValid&&!Ot.isEqual(t.record[t.column.field],e)&&(t.record[t.column.field]=e)})),r.cellEditValueSetter=!0),Object.assign(o.element.dataset,{rowId:n.id,columnId:n.columnId,field:t.field}),o.inputField.revertOnEscape=t.revertOnEscape,i.editor=o}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:this}}onEditorStart({source:e}){const t=this,n=t.editorContext=e.cellEditorContext;if(n){const{grid:e}=t,{cell:r}=n;r.classList.add("b-editing"),"cellclick"!==t.triggerEvent&&e.on({cellclick:"onCellClickWhileEditing"},t),t.removeEditingListeners=an.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:n})}}onEditorBeforeComplete(e){const{grid:t}=this,n=e.source.cellEditorContext;return e.grid=t,e.editorContext=n,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,n=e.cellEditorContext;n.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:n}),this.cleanupAfterEdit(n)}onEditorCancel({event:e}){const{editorContext:t,muteEvents:n,grid:r}=this;t&&this.cleanupAfterEdit(t),n||r.trigger("cancelCellEdit",{grid:r,event:e})}cleanupAfterEdit(e){const t=this,{editor:n}=e;e.cell.classList.remove("b-editing"),n.cellEditorContext=t.editorContext=null,t.grid.un({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},t),t.removeEditingListeners(),an.suspendFocusEvents(),n.element.remove(),an.resumeFocusEvents()}getAdjacentEditableCell(e,t){const{grid:n}=this,{store:r,columns:i}=n,{visibleColumns:s}=i;let o=e.id,a=i.getAdjacentVisibleLeafColumn(e.columnId,t);for(;o;)if(a){if(a.editor&&a.canEdit(r.getById(o)))return{id:o,columnId:a.id};a=i.getAdjacentVisibleLeafColumn(a,t)}else{const n=r.getAdjacent(e.id,t,!1,!0);o=null==n?void 0:n.id,n&&(a=t?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e="object"==typeof this.addNewAtEnd?Ot.clone(this.addNewAtEnd):{},{grid:t}=this,n=t.store.add(e)[0];return t.rowManager.getRowFor(n)||t.rowManager.displayRecordAtBottom(),n}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{grid:t}=this,r=t.columns.getById(e.columnId),i=t.store.getById(e.id);if(r&&!r.hidden&&r.editor&&i&&!i.isSpecialRow&&r.canEdit(i)){const t=null==i?void 0:i[r.field];return{column:r,record:i,value:t===n?null:t,selector:e,editor:r.editor}}return!1}startEditing(e={}){const t=this;if(!t.disabled){const{grid:n}=t,r=n.normalizeCellContext(e),i=t.getEditingContext(r);if(!i)return!1;if(t.editorContext&&t.cancelEditing(),n.focusCell(e),i.cell=n.getCell(e),!1===n.trigger("beforeCellEditStart",{grid:n,editorContext:i}))return!1;er.focusWithoutScrolling(n.focusElement);const s=i.editor=t.getEditorForCell(i),{cell:o,record:a,column:l}=i;return s.inputField.highlightExternalChange=!1,s.cellEditorContext=i,s.render(t.grid.getSubGridFromColumn(l).element),s.startEdit({target:o,record:a,field:s.inputField.name||i.column.field}),!0}return!1}cancelEditing(e=!1,t){const n=this,{editorContext:r,editor:i,grid:s}=n;r&&(i.containsFocus&&(n.editorContext=null,!s.isDestroying&&i.inputField.owns(er.getActiveElement(s))&&er.focusWithoutScrolling(s.focusElement),n.editorContext=r),n.muteEvents=e,i.cancelEdit(t),n.muteEvents=!1)}async finishEditing(){const e=this,{editorContext:t}=e;let n=!1;if(t){const{column:r}=t;e.finishEditingPromise=t.editor.completeEdit(r.bindCallback(r.finalizeCellEdit)),n=await e.finishEditingPromise,await e.grid.waitForAnimations(),e.finishEditingPromise=null}return n}async onCellClickWhileEditing({event:e,cellSelector:t}){const n=this;n.finishEditingPromise||n.editorContext&&!n.editorContext.editor.owns(e.target)&&(n.getEditingContext(t)?await n.finishEditing()?n.startEditing(t):(n.grid.focusCell(n.editorContext.selector),n.editor.inputField.focus()):n.finishEditing())}onCellClick({source:e,cellSelector:t,target:r,event:i,column:s}){if(s.onCellClick)return;const o=e.focusedCell||{};if(r.closest(".b-tree-expander"))return this.cancelEditing(n,i),!1;er.isTouchEvent&&t.id==o.id&&t.columnId==o.columnId?this.startEditing(t):"cellclick"===this.triggerEvent&&this.onTriggerEditEvent({cellSelector:t,target:r})}async onTriggerEditEvent({cellSelector:e,target:t}){t.closest(".b-tree-expander")||this.editorContext&&!await this.finishEditing()||this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:n}=this;null!=n&&n.editor.isVisible&&t===n.record&&n.editor.dataField in e&&n.editor.refreshEdit()}onGridRefreshed(){const e=this,{grid:t}=e;if(e.editorContext&&t.focusedCell){const n=t.getCell(t.focusedCell);n?e.editorContext.editor.showBy(n):e.cancelEditing()}}async onElementKeyDown(e){const t=this;if(!e.handled&&t.grid.focusElement.contains(e.target))if(t.editorContext){switch(e.key){case"Enter":t.onEnterKeyPress(e);break;case"F2":e.preventDefault(),t.finishEditing();break;case"Escape":e.stopPropagation(),e.preventDefault(),t.cancelEditing(n,e);break;case"Tab":t.onTabKeyPress(e)}Fu[e.key]&&(e.handled=!0)}else{const{key:n}=e,r="Backspace"===n,i=t.autoEdit&&(1===n.length||r);if((i||Mu[n])&&t.grid.focusedCell){if(t.startEditing(t.grid.focusedCell)){const{inputField:s}=t.editor,{input:o}=s;i&&o&&(s.internalOnKeyEvent(e),e.defaultPrevented||(o.value=r?"":n,s.internalOnInput(e),s.moveCaretToEnd()))}e.preventDefault()}}}async onEnterKeyPress(e){const t=this,{grid:n}=t;if(e.preventDefault(),e.stopPropagation(),await t.finishEditing()){if(t.isDestroyed)return;if(!t.isEditing){if(e.ctrlKey||e.metaKey||e.altKey||n.touch)return;if(e.shiftKey)n.internalNextPrevRow(!1,!0,e,!1)&&t.startEditing(n.focusedCell);else{if(t.addNewAtEnd){var r;n.store.getById(null===(r=n.focusedCell)||void 0===r?void 0:r.id)===n.store.last&&await t.doAddNewAtEnd()}n.internalNextPrevRow(!0,!0)&&t.startEditing(n.focusedCell)}}}}async onTabKeyPress(e){e.preventDefault();const t=this,{focusedCell:n}=t.grid;if(n){const r=!e.shiftKey;let i=t.getAdjacentEditableCell(n,r);if(!i&&r&&t.addNewAtEnd){!0===await t.finishEditing()&&(await this.doAddNewAtEnd(),i=t.getAdjacentEditableCell(n,r))}if(i){let e=!0;t.isEditing&&(e=await t.finishEditing()),e&&(t.grid.focusCell(i,{animate:t.focusCellAnimationDuration}),t.startEditing(i))}}}onElementMouseDown(e){2===e.button&&this.editorContext&&e.preventDefault()}onEditorFocusOut(e){const t=this,{grid:r,editor:i,editorContext:s}=t;s&&!i.isFinishing&&i.inputField.owns(e._target)&&(e.toWidget!==r||r.isLocationEqual(r.focusedCell,s.selector))&&("cancel"===t.blurAction?t.cancelEditing(n,e):t.finishEditingPromise||t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)||t.editor.owns(e.target)||("cancel"===t.blurAction?t.cancelEditing(n,e):t.finishEditing())}onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&this.finishEditing()}}Au._$name="CellEdit",Tu.registerFeature(Au,!0);class Iu extends wl{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,id:n,event:r}=e;this.client.focusCell(t,{doSelect:!this.client.isSelected(n),event:r}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){return Ot.assign(super.getDataFromEvent(e),this.client.getCellDataFromEvent(e))}beforeContextMenuShow(e){e.record&&!e.record.isSpecialRow||(e.items.removeRow=!1)}populateCellMenu({items:e,column:t}){const{client:n}=this;null!=t&&t.cellMenuItems&&(Array.isArray(t.cellMenuItems)&&s.deprecate("Grid","5.0.0","`cellMenuItems` column config specified as an array is deprecated, need to specify the config as a named object. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."),Ot.merge(e,t.cellMenuItems)),n.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",name:"removeRow",cls:"b-separator",weight:100,onItem:()=>n.store.remove(n.selectedRecords)},n.showRemoveRowInContextMenu||(s.deprecate("Grid","5.0.0","`showRemoveRowInContextMenu` config is deprecated, in favor of `CellMenu` feature configuration. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."),e.removeRow=!1))}get showMenu(){return!0}}Iu.featureClass="",Iu._$name="CellMenu",Tu.registerFeature(Iu,!0,["Grid","Scheduler"]),Tu.registerFeature(Iu,!1,["Gantt"]);class ku extends uo{static get $name(){return"CellTooltip"}static get defaultConfig(){return{tooltipRenderer:null}}construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=Ws.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),listeners:{pointerOver:"onPointerOver",thisObj:e}},e.initialConfig),e.relayEvents(e.tip,["beforeshow","show"])}onPointerOver({target:e}){return!1!==this.client.getColumnFromElement(e).tooltipRenderer}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:n}){const r=this,i=r.client.getRecordFromElement(t),o=r.client.getColumnFromElement(t);let a;return r.forSelector||i!==r.lastRecord||o!==r.lastColumn?(r.lastRecord=i,r.lastColumn=o,o.tooltipRenderer?(a=o.tooltipRenderer({cellElement:t,record:i,column:o,event:n,tip:e,cellTooltip:r}),!1===a&&s.deprecate("Grid","5.0.0","Returning false to indicate loading is deprecated. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/3.0.1.md for more information")):r.tooltipRenderer&&!1!==o.tooltipRenderer&&(a=r.tooltipRenderer({cellElement:t,record:i,column:o,event:n,tip:e,cellTooltip:r}),!1===a&&s.deprecate("Grid","5.0.0","Returning false to indicate loading is deprecated. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/3.0.1.md for more information")),a):r.tip._html}}ku._$name="CellTooltip",Tu.registerFeature(ku);const Ou="store";class Lu extends(br(uo)){static get $name(){return"ColumnAutoWidth"}construct(e){var t;super.construct(e);const n=null===(t=this.client)||void 0===t?void 0:t.store;n&&this.bindStore(n)}static get defaultConfig(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.on({name:Ou,[`change${this.client.asyncEventSuffix}`]:"onStoreChange"},this)}unbindStore(){this.detachListeners(Ou)}get columnAutoWidthPending(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if("move"!==e){var t;const e=this;++e.storeGeneration,null!==(t=e.client.features.cellEdit)&&void 0!==t&&t.isEditing?e.syncAutoWidthColumns():e.hasTimeout("syncAutoWidthColumns")||e.setTimeout("syncAutoWidthColumns",e.delay)}}syncAutoWidthColumns(){const e=this,t=e.client,n=e.storeGeneration;if(e.lastSync!==n){let r,i;e.lastSync=n;for(const n of t.columns.visibleColumns)r=n.autoWidth,r&&(!0===r&&(r=e.default),t.resizingColumns=i=!0,n.resizeToFitContent(r));i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}}Lu.prototype.storeGeneration=0,Lu._$name="ColumnAutoWidth",Tu.registerFeature(Lu,!0);class Pu extends(br(uo)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.on("beforedestroy",this.onColumnReorderBeforeDestroy,this),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.on({gridheaderdragstart({context:n}){const r=t.columns.getById(n.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,n=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),n.forEach((e=>{e.text=e.localeClass.L(e.text);let t=r.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},r.push(t)),t.buttons.push(e)})),t.element=er.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=n,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await Tr.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const n=this;if(e.dragProxy.getBoundingClientRect().top-n.grid.element.getBoundingClientRect().top>100?n.element.classList.add("b-closer"):n.element.classList.remove("b-closer"),n.hoveringButton&&(n.hoveringButton.classList.remove("b-hover"),n.hoveringButton=null),null!==(t=e.targetElement)&&void 0!==t&&t.closest(".b-columndragtoolbar")){n.element.classList.add("b-hover");const t=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");t&&(t.classList.add("b-hover"),n.hoveringButton=t)}else n.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const n=e.targetElement,r=t.buttons.find((e=>e.name===n.dataset.name));r&&(n.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),r.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return Ul.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map((e=>Ul.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map((e=>Ul.tpl`
                        <div class="b-target-button" data-name="${e.name}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `))}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `))}
            </div>`}}Pu.featureClass="b-hascolumndragtoolbar",Pu._$name="ColumnDragToolbar",Tu.registerFeature(Pu,r.isTouchDevice);class _u extends uo{static get $name(){return"ColumnPicker"}static get configurable(){return{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}}static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}construct(e,t){this.grid=e,super.construct(e,t)}getColumnPickerItems(e){const t=this,{createColumnsFromModel:n}=t;let r;if(t.groupByRegion)r=t.grid.regions.map((e=>{const n=t.grid.getSubGrid(e).columns.topColumns;return{text:A.capitalize(e),menu:t.buildColumnMenu(n),disabled:0===n.length,region:e}})),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const i={};e.topColumns.forEach((e=>{e.tags&&e.hideable&&e.tags.forEach((e=>{i[e]||(i[e]=1)}))})),r=Object.keys(i).sort().map((e=>({text:A.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:n})=>{t.refreshTagMenu(e,n)}}))),n&&r.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else r=t.buildColumnMenu(e.topColumns),n&&r.items.push(...Ot.transformNamedObjectToArray(t.createAutoColumnItems()));return r}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:n,store:r}=t,{modelClass:i}=r,{allFields:s}=i,o={};for(let t=0,{length:r}=s;t<r;t++){const r=s[t],i=r.name;n.get(i)||r.internal||(o[i]={text:r.text||A.separate(r.name),checked:!1,onToggle:t=>{const s=n.get(i);s?s[t.checked?"show":"hide"]():n.add(n.generateColumnForField(r,{region:e.forColumn.region})),t.bubbles=!1}})}return o}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const n=e.items.find((e=>e.column===t));n&&(n.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:n}=this,r=e.reduce(((e,r)=>{const i=n.columns.visibleColumns.filter((e=>e.region===r.region));if(!1!==r.hideable){const s={grid:n,text:r.headerText,column:r,name:r.id,checked:!0!==r.hidden,disabled:!0!==r.hidden&&1===i.length,cls:r.region!==t?"b-separator":""};t=r.region,r.children&&(s.menu=this.buildColumnMenu(r.children)),e.push(s)}return e}),[]);return{cls:this.menuCls,items:r}}populateHeaderMenu({column:e,items:t}){const n=this,{columns:r}=n.grid;if(n.forColumn=e,!1!==e.showColumnPicker&&r.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:n,name:"columnPicker",icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:200,menu:n.getColumnPickerItems(r),onToggle:n.onColumnToggle,disabled:n.disabled}),!1!==e.hideable){const i=r.visibleColumns.filter((t=>t.region===e.region));t.hideColumn={text:"L{hideColumn}",localeClass:n,icon:"b-fw-icon b-icon-hide-column",weight:210,name:"hideColumn",disabled:1===i.length||n.disabled,onItem:()=>e.hide()}}}onColumnToggle({menu:e,item:t,checked:n}){if(!!t.column.hidden!=!n){t.column[n?"show":"hide"]();const{grid:r,column:i}=t,{columns:s,features:o}=r,a=e.items,l=s.visibleColumns.filter((e=>e.region===t.column.region)),{contextMenu:c,headerMenu:d}=o,u=c&&!c.disabled,h=u?c:d,g=h&&h[u?"currentMenu":"menu"],m=u?g.items.find((e=>"hideColumn"===e.name)):g.widgetMap.hideColumn;if(1===l.length){const e=a.find((e=>e.name===l[0].id));e&&(e.disabled=!0),m&&i.region===t.column.region&&(m.disabled=!0)}else l.forEach((e=>{const t=a.find((t=>t.column===e));t&&(t.disabled=!1)})),m&&i.region===t.column.region&&(m.disabled=!1);t.menu&&t.menu.eachWidget((e=>{e.checked=n}));const p=e.owner;p&&p.column===i.parent&&(p.checked=a.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const n=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&n.length>1&&t.push({text:"L{hideColumnShort}",group:"L{column}",localeClass:this,icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",onDrop:({column:e})=>e.hide()}),t}}_u._$name="ColumnPicker",Tu.registerFeature(_u,!0);class $u extends(br(uo)){static get $name(){return"ColumnReorder"}construct(e,t){this.ignoreSelectors=[".b-grid-header-resize-handle",".b-field"],this.grid=e,super.construct(e,t)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e,n=t.element,r=er.children(n,".b-grid-headers");r.push(...er.children(n,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=r:(e.dragHelper=new Ll({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,outerElement:n.querySelector("header.b-grid-header-container"),containers:r,isElementDraggable(n){if(Boolean(er.up(n,e.ignoreSelectors.join(",")))||e.disabled)return!1;const r=er.up(n,this.targetSelector),i=r&&t.columns.getById(r.dataset.columnId),s=i&&0===i.childLevel&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onDrag({context:e,event:t}){const n=ki.fromElement(t.target,"gridheader");n&&n.subGrid.sealedColumns?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onDragStart(){const e=this;if(!e.grid.features.columnDragToolbar){const t=e.grid.element.querySelector(".b-grid-header-container").getBoundingClientRect();e.dragHelper.minY=t.top,e.dragHelper.maxY=t.bottom}this.grid.headerContainer.classList.add("b-dragging-header")}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,n=t.grid,r=e.dragging,i=er.up(e.target,".b-grid-header"),s=n.columns.get(i.dataset.column),o=e.draggedTo.dataset.region||s.region,a=e.insertBefore,l=n.columns.getById(r.dataset.columnId),c=a?n.columns.getById(a.dataset.columnId):n.subGrids[o].columns.last.nextSibling;let d;if(c)d=c.parent;else{const e=er.up(i.parentElement,".b-grid-header");d=e?n.columns.getById(e.dataset.columnId):n.columns.rootNode}if(n.headerContainer.classList.remove("b-dragging-header"),o===l.region&&(s===l.previousSibling||c===l.nextSibling))return void t.dragHelper.abort();const u=l.parent&&1===l.parent.children.length&&l.parent;u&&u.parent.removeChild(u),r.remove(),l.region=o,d.insertChild(l,c)}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}}$u.featureClass="b-column-reorder",$u._$name="ColumnReorder",Tu.registerFeature($u,!0);class Hu extends uo{static get $name(){return"ColumnResize"}static get defaultConfig(){return{liveResize:"auto"}}construct(e,t){const n=this;n.grid=e,super.construct(e,t),n.resizer=new Vl({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,listeners:{beforeresizestart:n.onBeforeResizeStart,resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,thisObj:n}})}static get pluginConfig(){return[]}set liveResize(e){"auto"===e&&(e=!r.isMobileSafari),this._liveResize=e}get liveResize(){return this._liveResize}doDestroy(){this.resizer&&this.resizer.destroy(),super.doDestroy()}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:n}=this,r=e.column=t.columns.getById(e.element.dataset.columnId),{scrollable:i}=t.subGrids[r.region];n.minWidth=r.minWidth,i.scrollWidth=i.scrollWidth,e.element.style.minWidth="",t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:n}=e;if(t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized()):n.width=e.newWidth,r.isIE11&&n.parent&&n.parent.flex)){const e=n.parent;t.getHeaderElement(e.id).style.flexBasis=e.children.reduce(((e,n)=>e+t.getHeaderElement(n.id).offsetWidth),0)+"px"}}}Hu._$name="ColumnResize",Tu.registerFeature(Hu,!0);class ju extends uo{static get $name(){return"ContextMenu"}static get defaultConfig(){return{headerItems:[],processHeaderItems:null,cellItems:[],processCellItems:null,triggerEvent:null,disableCellContextMenu:null}}construct(e,t){super.construct(e,t),this.grid=e,s.deprecate("Grid","5.0.0","`ContextMenu` feature is deprecated, in favor of `CellMenu` and `HeaderMenu` features. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/3.1.0.md for more information."),e.features.cellMenu&&(e.features.cellMenu.disabled=!0),e.features.headerMenu&&(e.features.headerMenu.disabled=!0)}doDestroy(){this.currentMenu&&this.currentMenu.destroy(),super.doDestroy()}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onElementKeyDown"]}}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showContextMenu(e)}onElementKeyDown(e){if(!e.handled&&e.target.matches(".b-grid-header.b-depth-0"))switch(e.key){case" ":case"ArrowDown":this.showContextMenu(e)}}showContextMenu(e){if(!this.disabled){const t=er.up(e.target,".b-grid-header"),n=this.grid.getCellDataFromEvent(e);t?this.handleHeaderContextMenu(t,e):n&&!this.disableCellContextMenu&&this.handleCellContextMenu(n,e)}}handleHeaderContextMenu(e,t){if(e.dataset.column){const n=this,r=n.grid,i=r.columns.getById(e.dataset.columnId);if(!1!==i.enableHeaderContextMenu){const s=[...n.headerItems,...i.headerMenuItems||[]],o=Ot.transformArrayToNamedObject(s),a={owner:n.client,constrainTo:document,cls:"b-context-menu",scrollAction:"hide",onItem({item:e,element:t}){r.trigger("contextMenuItem",{source:r,item:e,column:i,element:t})},onToggle({item:e,checked:t,element:n}){r.trigger("contextMenuToggleItem",{source:r,item:e,column:i,checked:t,element:n})},onDestroy(){n.currentMenu=null},listeners:{show({source:e}){d.menu=e,r.trigger("headerContextMenuShow",d)}}};r.populateHeaderMenu({column:i,items:o,menu:a});const l=Ot.transformNamedObjectToArray(o),{processHeaderItems:c}=n,d={items:l,column:i,event:t,element:e};Ot.merge(a,{items:l}),(!c||!1!==c(d))&&l.length>0&&(t.preventDefault(),l.sort(((e,t)=>(e.weight||150)-(t.weight||150))),!1!==r.trigger("headerContextMenuBeforeShow",d)&&(n.currentMenu=ql.showContextMenu("keydown"===t.type?e:[t.clientX+1,t.clientY+1],a),n.currentMenu.eachWidget((e=>{!e.column&&e instanceof yl&&(e.column=i)}),!0)))}}}handleCellContextMenu(e,t){const n=this,r=n.grid,i=r.columns.getById(e.columnId);if(!1!==i.enableCellContextMenu){r.focusCell(e.cellSelector,{doSelect:!r.isSelected(e.id),event:t});const s=e.record,o=[...n.cellItems||[],...i.cellMenuItems||[]],a=Ot.transformArrayToNamedObject(o);r.populateCellMenu({column:i,record:s,items:a});const l=Ot.transformNamedObjectToArray(a),{processCellItems:c}=n,d=e.cellElement,u={items:l,column:i,event:t,record:s,element:d},h={owner:n.client,items:l,onBeforeItem:e=>{Object.assign(e,u)},onItem({item:e}){r.trigger("contextMenuItem",{source:r,item:e,column:i,record:s,cell:d})},onClose({reason:e}){"outside"!==e&&r.focus()},onDestroy(){n.currentMenu=null},listeners:{show({source:e}){u.menu=e,r.trigger("cellContextMenuShow",u)}}};(!c||!1!==c(u))&&l.length>0&&(l.forEach((e=>{e.column=i,e.record=s})),t.preventDefault(),l.sort(((e,t)=>(e.weight||150)-(t.weight||150))),!1!==r.trigger("cellContextMenuBeforeShow",u)&&(n.currentMenu=ql.showContextMenu([t.clientX+1,t.clientY+1],h)))}}hideContextMenu(e){var t;null===(t=this.currentMenu)||void 0===t||t.hide(e)}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}ju.featureClass="",ju._$name="ContextMenu",Tu.registerFeature(ju);const Bu={date:"date",integer:"number",number:"number",string:"text",duration:"duration"};class Nu extends uo{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const n=this;if(n.grid=e,n.closeFilterEditor=n.closeFilterEditor.bind(n),super.construct(e,t),n.bindStore(e.store),t&&"object"==typeof t){const n=Ot.clone(t);delete n.prioritizeColumns,Ot.isEmpty(n)||e.store.filter(n,null,e.isConfiguring)}}doDestroy(){var e,t;null===(e=this.filterTip)||void 0===e||e.destroy(),null===(t=this.filterEditorPopup)||void 0===t||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,n=t.grid,r=n.headerContainer;if(r){er.children(r,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),t.filterTip||(t.filterTip=new Ws({forElement:r,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText})),n.store.isFiltered||t.filterTip.hide();for(const e of n.columns)if(!1!==e.filterable){const n=t.store.filters.getBy("property",e.field),r=e.element;if(r){const i=e.textWrapper;let s,o=null==i?void 0:i.querySelector(".b-filter-icon");if(n){let r=n.displayValue||n.value||"";e.formatValue&&(r=e.formatValue(r)),s=t.L("L{filter}")+": "+("string"==typeof n?n:`${n.operator} ${r}`)}else s=t.L("L{applyFilter}");o?o.dataset.filterText=s:(o=er.createElement({parent:i,tag:"div",className:"b-filter-icon",dataset:{filterText:s}}),r.classList.add("b-filterable")),e.field===t.store.latestFilterField&&o.classList.add("b-latest"),r.classList[n?"add":"remove"]("b-filter")}e.meta.isFiltered=!!n}e&&n.refreshRows()}}applyFilter(e,t){this.store.filter(d(d(d({},e.filterable),t),{},{property:e.field}))}removeFilter(e){this.store.removeFilter(e.field)}getPopupDateItems(e,t,n,r,i,s,o,a){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n,displayValue:t._value,type:"date"}))}return[Ot.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:u,onChange:h,onClose:c,onClear:d},a),Ot.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onClose:c,onClear:d},a),Ot.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onClose:c,onClear:d},a)]}getPopupNumberItems(e,t,n,r,i,s,o,a){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:n}){null==n?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:n}))}return[Ot.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onKeydown:u,onChange:h,onEsc:c,onClear:d},a),Ot.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:c,onClear:d},a),Ot.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onKeydown:u,onChange:h,onEsc:c,onClear:d},a)]}clearSiblingsFields(e){var t;null===(t=this.filterEditorPopup)||void 0===t||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,n,r,i,s,o,a){const l=this,c=s,d=o;function u({source:t,value:n}){null==n?o():(l.applyFilter(e,{operator:t.operator,value:n}),s())}return[Ot.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:"="===(null==n?void 0:n.operator)?n.value:r,operator:"=",onChange:u,onEsc:c,onClear:d},a),Ot.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:"<"===(null==n?void 0:n.operator)?n.value:null,operator:"<",onChange:u,onEsc:c,onClear:d},a),Ot.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:">"===(null==n?void 0:n.operator)?n.value:null,operator:">",onChange:u,onEsc:c,onClear:d},a)]}getPopupStringItems(e,t,r,i,s,o,a,l){const c=this;return[Ot.assign({type:t,cls:"b-last-row",placeholder:"L{filter}",localeClass:c,clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:r?r.value||r:i,operator:"*",onChange({source:t,value:r}){""===r?a():(c.applyFilter(e,{operator:t.operator,value:r,displayValue:t.displayField&&t.records?t.records.map((e=>e[t.displayField])).join(", "):n}),t.multiSelect||o())},onClose:o,onClear:a},l)]}getPopupItems(e,t,n,r,i,s,o,a){switch(t){case"date":return this.getPopupDateItems(...arguments);case"number":return this.getPopupNumberItems(...arguments);case"duration":return this.getPopupDurationItems(...arguments);default:return this.getPopupStringItems(...arguments)}}showFilterEditor(e,t){const n=this,{store:r}=n,i="string"==typeof e?n.grid.columns.getById(e):e,s=i.element,o=r.modelClass.fieldMap[i.field],a=r.filters.getBy("property",i.field),l=i.filterType,c=l?Bu[l]:Bu[i.type]||o&&Bu[o.type]||"text";if(!1===i.filterable)return;n.closeFilterEditor();const d=n.getPopupItems(i,c,a,t,r,n.closeFilterEditor,(()=>{n.removeFilter(i),n.closeFilterEditor()}),i.filterable.filterField);d.forEach((e=>e.placeholder=this.L(e.placeholder))),n.filterEditorPopup=ql.openPopup(s,{owner:n.grid,width:"16em",cls:"b-filter-popup",scrollAction:"realign",items:d})}closeFilterEditor(){var e;null===(e=this.filterEditorPopup)||void 0===e||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}populateCellMenuWithDateItems({column:e,record:t,items:n}){const r=e.field,i=t.getFieldDefinition(r);if("date"===(e.filterType||(null==i?void 0:i.type)||e.type)){const i=this,s=t[r],o=t=>{i.applyFilter(e,{operator:t,value:s,displayValue:e.formatValue?e.formatValue(s):s,type:"date"})};n.filterDateEquals={text:"L{on}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDateEquals",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterDateBefore={text:"L{before}",localeClass:i,icon:"b-fw-icon b-icon-filter-before",name:"filterDateBefore",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterDateAfter={text:"L{after}",localeClass:i,icon:"b-fw-icon b-icon-filter-after",name:"filterDateAfter",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithNumberItems({column:e,record:t,items:n}){const r=e.field,i=t.getFieldDefinition(r);if("number"===(e.filterType||e.type||(null==i?void 0:i.type))){const i=this,s=t[r],o=t=>{i.applyFilter(e,{operator:t,value:s})};n.filterNumberEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterNumberEquals",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterNumberLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",name:"filterNumberLess",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterNumberMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",name:"filterNumberMore",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithDurationItems({column:e,record:t,items:n}){const r=e.field,i=t.getFieldDefinition(r);if("duration"===(e.filterType||(null==i?void 0:i.type)||e.type)){const i=this,s=t[r],o=t=>{i.applyFilter(e,{operator:t,value:s})};n.filterDurationEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDurationEquals",weight:300,disabled:i.disabled,onItem:()=>o("=")},n.filterDurationLess={text:"L{lessThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-less",name:"filterDurationLess",weight:310,disabled:i.disabled,onItem:()=>o("<")},n.filterDurationMore={text:"L{moreThan}",localeClass:i,icon:"b-fw-icon b-icon-filter-more",name:"filterDurationMore",weight:320,disabled:i.disabled,onItem:()=>o(">")}}}populateCellMenuWithStringItems({column:e,record:t,items:n}){const r=e.field,i=t.getFieldDefinition(r),s=e.filterType||(null==i?void 0:i.type)||e.type;if(!/(date|number|duration)/.test(s)){var o,a;const i=this,s=t[r],l=null!==(o=null===(a=e.filterable.filterField)||void 0===a?void 0:a.operator)&&void 0!==o?o:"*";n.filterStringEquals={text:"L{equals}",localeClass:i,icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterStringEquals",weight:300,disabled:i.disabled,onItem:()=>i.applyFilter(e,{value:s,operator:l})}}}populateCellMenu({column:e,record:t,items:n}){const r=this;!1!==e.filterable&&(r.populateCellMenuWithDateItems(...arguments),r.populateCellMenuWithNumberItems(...arguments),r.populateCellMenuWithDurationItems(...arguments),r.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(n.filterRemove={text:"L{removeFilter}",localeClass:r,icon:"b-fw-icon b-icon-clear",cls:"b-separator",weight:400,name:"filterRemove",disabled:r.disabled,onItem:()=>r.removeFilter(e)}))}populateHeaderMenu({column:e,items:t}){const n=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:n,name:"editFilter",weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:n,name:"removeFilter",weight:110,icon:"b-fw-icon b-icon-remove",disabled:n.disabled,onItem:()=>n.removeFilter(e)}):!1!==e.filterable&&(t.filter={text:"L{filter}",localeClass:n,name:"filter",weight:100,icon:"b-fw-icon b-icon-filter",cls:"b-separator",disabled:n.disabled,onItem:()=>n.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var n;const i=e.getAt(r),s=(i.columnOwned||this.prioritizeColumns)&&t.get(i.property);null!=s&&null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new ji({columnOwned:!0,property:i.property,operator:i.operator,value:i.value,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,operator:this.operator,property:this.property})}})),s.$filter.value=i.value,s.$filter.displayValue=i.displayValue,s.$filter.operator=i.operator,e.splice(r,1,s.$filter))}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick(e){const t=e.target;if(this.filterEditorPopup&&this.closeFilterEditor(),t.classList.contains("b-filter-icon")){const e=er.up(t,".b-grid-header");return this.showFilterEditor(e.dataset.columnId),!1}}}Nu._$name="Filter",Tu.registerFeature(Nu);class zu extends uo{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const n=this;n.grid=e,n.onColumnFilterFieldChange=n.onColumnFilterFieldChange.bind(n),super.construct(e,Array.isArray(t)?{filter:t}:t),n.bindStore(e.store),n.filter&&e.store.filter(n.filter),n.gridDetacher=e.on("beforeelementclick",n.onBeforeElementClick,n)}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null===(e=this.gridDetacher)||void 0===e||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;null==t||t.forEach((t=>{const n=this.getColumnFilterField(t);n&&(n.disabled=e)})),super.doDisable(e)}static get pluginConfig(){return{before:["onElementKeyDown"],chain:["renderHeader","populateHeaderMenu","bindStore"]}}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const n=this._columnFilters[t];n.placeholder=e?n.column.headerText:null}}destroyFilterBar(){var e;null===(e=this.grid.columns)||void 0===e||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null===(e=t.grid.columns)||void 0===e||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.renderFilterBar(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.columns.visibleColumns.forEach((e=>this.renderColumnFilterField(e))),this.rendered=!0}renderColumnFilterField(e){const t=this,n=t.grid,r=t.getColumnFilterable(e);if(r&&!e.hidden){const i=e.element,s=n.store.filters.getBy("property",e.field);let o=t.getColumnFilterField(e);if(o)t.onColumnFilterFieldChange({source:o,value:o.value}),o.render(i),o.show();else{const n=`${e.filterType||"text"}field`;o=ql.append(Ot.assign({type:n,column:e,owner:t.grid,clearable:!0,name:e.field,value:s&&!s._filterBy&&t.buildFilterString(s),cls:t.filterFieldCls,inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null},r.filterField),i)[0],t.setColumnFilterField(e,o)}i.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const{columns:e,store:t}=this.grid;let n,r;for(const i of e.visibleColumns)n=this.getColumnFilterField(i),n&&(r=t.filters.getBy("property",i.field),r?r._filterBy?n.value=r.value:n.value=this.buildFilterString(r):n.value="")}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,n))}hideColumnFilterField(e,t){const n=this,{store:r}=n.grid,i=e.element,s=n.getColumnFilterField(e);s&&(n.isDestroying||s.hide(),n.clearStoreFiltersOnHide&&e.field&&r.removeFilter(e.field,t),null==i||i.classList.remove(n.filterableColumnCls))}getColumnFilterField(e){var t;return null===(t=this._columnFilters)||void 0===t?void 0:t[e.data.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e){if(Array.isArray(e))return{value:e};const t=String(e).match(this.filterParseRegExp);return{operator:t[1]||"*",value:t[2]}}buildFilterString(e){return("*"===e.operator?"":e.operator)+e.value}onStoreBeforeFilter({filters:e}){const{columns:t}=this.client;for(let r=0;r<e.count;r++){var n;const i=e.getAt(r),s=(i.columnOwned||this.prioritizeColumns)&&t.get(i.property);null!==(n=s.filterable)&&void 0!==n&&n.filterFn&&(s.$filter||(s.$filter=new ji({columnOwned:!0,property:i.property,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,property:this.property})}})),s.$filter.value=i.value,e.splice(r,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}onElementKeyDown(e){if(!e.handled&&e.target.matches(this.filterFieldInputSelector))switch(e.key){case"ArrowLeft":case"ArrowRight":e.handled=!0}}onBeforeElementClick({event:e}){if(e.target.closest(`.${this.filterFieldCls}`))return!1}onColumnFilterFieldChange({source:e,value:t}){const n=this,{store:r}=n.grid;n.suspendStoreTracking(),null==t||""===t||Array.isArray(t)&&0===t.length?r.removeFilter(e.name):r.filter(d({columnOwned:!0,property:e.name},n.parseFilterValue(t))),n.resumeStoreTracking()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,name:"toggleFilterBar",weight:120,icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}}zu.featureClass="b-filter-bar",zu._$name="FilterBar",Tu.registerFeature(zu);class Vu extends uo{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null}}construct(e,t){const n=this;e.features.tree||(n._thisIsAUsedExpression(e.features.groupSummary),t=n.processConfig(t),n.grid=e,n.rowManager=e.rowManager,super.construct(e,t),n.bindStore(e.store),n.rowManager.on({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:n}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.on({name:"store",group:"onStoreGroup",thisObj:this})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),t.clearGroupers(),t.sort(e)}super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","onElementKeyDown","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,r=!1){const i=this,s=i.store,o=s.getById(e),a=o.meta;a.groupRowFor!==n&&((t=t===n?!a.collapsed:t)?s.excludeGroupRecords(o):s.includeGroupRecords(o),a.collapsed=t,i.grid.trigger("toggleGroup",{groupRecord:o,collapse:t}),r||i.rowManager.renderFromRecord(o))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!0,!0))),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!1,!0))),e.grid.refreshRows())}onBeforeRenderRow({row:e,record:t}){const n=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||n&&"groupRowFor"in n.meta}renderCell(e){const t=this,{cellElement:n,row:r,column:i}=e,s=e.record.meta,o={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped)if("groupRowFor"in s){if("action"===i.type)return;i.clearCell(n),o["b-grid-group-collapsed"]=s.collapsed,o["b-group-row"]=1,i===t.groupHeaderColumn&&n.classList.add("b-group-title"),t.buildGroupHeader(e)}else n.classList.remove("b-group-title");r.assignCls(o)}buildGroupHeader(e){const t=this,{record:n,cellElement:r,column:i,persist:s}=e,o=t.grid,a=n.meta,l=a.childCount-(o.features.groupSummary?1:0);let c=null,d=!0;if(s||i){const s=o.columns.get(a.groupField),u=e.isFirstColumn=i===t.groupHeaderColumn;null!=s&&s.groupRenderer?u&&(c=s.groupRenderer(Object.assign({},e,{groupRowFor:a.groupRowFor,groupRecords:n.groupChildren,groupColumn:s,count:l})),d=!1):t.groupRenderer&&(c=t.groupRenderer(Object.assign({},e,{groupRowFor:a.groupRowFor,groupRecords:n.groupChildren,groupColumn:s,count:l,isFirstColumn:u}))),u&&null==c&&d&&0===er.getChildElementCount(r)&&(c=A.encodeHtml(`${"__novalue__"===a.groupRowFor?"":a.groupRowFor} (${l})`))}else t.groupRenderer&&(c=t.groupRenderer(e));return"string"==typeof c?r.innerHTML=c:"object"==typeof c&&Ur.sync({targetElement:r,domConfig:{onlyChildren:!0,children:Array.isArray(c)?c:[c]}}),er.getChildElementCount(r)>0&&(r._hasHtml=!0),r.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find((e=>!e.groupHeaderReserved))}renderHeader(e){const{store:t,grid:n}=this;if(t.isGrouped)for(const e of t.groupers){const t=n.columns.get(e.field),r=t&&n.getHeaderElement(t.id);r&&(r.classList.add("b-group"),r.classList.add(e.ascending?"b-asc":"b-desc"))}}populateHeaderMenu({column:e,items:t}){const n=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:n,icon:"b-fw-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:400,disabled:n.disabled,onItem:()=>n.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:n,icon:"b-fw-icon b-icon-group-desc",name:"groupDesc",weight:410,disabled:n.disabled,onItem:()=>n.store.group(e.field,!1)}),n.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:n,icon:"b-fw-icon b-icon-clear",name:"groupRemove",cls:e.groupable?"":"b-separator",weight:420,disabled:n.disabled,onItem:()=>n.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var n;const r=this,i=r.store;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,disabled:r.disabled,onDrop:({column:e})=>i.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-group-desc",name:"groupDesc",weight:110,disabled:r.disabled,onDrop:({column:e})=>i.group(e.field,!1)});const s=(null===(n=i.groupers)||void 0===n?void 0:n.some((t=>t.field===e.field)))&&!r.disabled;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:r,icon:"b-icon b-icon-clear",name:"groupRemove",disabled:!s,weight:110,onDrop:({column:e})=>i.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:n}=t,r=n&&er.children(n,".b-grid-header.b-group");if(n){for(const e of r)er.removeClasses(e,["b-group","b-asc","b-desc"]);if(e)for(const n of e){const e=t.getHeaderElementByField(n.field);e&&er.addClasses(e,["b-group",n.ascending?"b-asc":"b-desc"])}}}onElementTouchStart(e){const t=this,n=e.target,r=er.up(n,".b-grid-header"),i=r&&t.grid.getColumnFromElement(r);e.touches.length>1&&i&&!1!==i.groupable&&!t.disabled&&t.store.group(i.field)}onElementClick(e){const t=this,{store:n}=t,{target:r}=e,i=er.up(r,".b-group-row"),s=er.up(r,".b-grid-header"),o=null==s?void 0:s.dataset.column;if(!(r.classList.contains("b-resizer")||t.disabled||r.classList.contains("b-action-item"))){if(s&&o){var a;const r=null===(a=n.groupers)||void 0===a?void 0:a.find((e=>e.field===o));if(r&&!e.shiftKey)return n.group(o,!r.ascending),!1;if(e.shiftKey){!1!==t.grid.columns.get(o).groupable&&(e.altKey?n.removeGrouper(o):n.group(o))}}return i?(t.internalToggleCollapse(sa.get(i).id),!1):void 0}}onElementKeyDown(e){const t=this;!t.disabled&&t.store.isGrouped&&e.target===t.grid.focusElement&&" "===e.key&&t.grid.focusedCell&&(e.preventDefault(),t.internalToggleCollapse(t.grid.focusedCell.id))}}Vu._$name="Group",Tu.registerFeature(Vu,!0,["Grid","Scheduler"]);var Wu=e=>class extends(e||me){static get $name(){return"SummaryFormatter"}generateHtml(e,t,n,r,i,s){const o=this.store,a=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let l=`<table class="${n}">`;return a.forEach((n=>{let r=n.sum,i=null;switch(!0===r&&(r="sum"),r){case"sum":case"add":i=o.sum(e.field,t);break;case"max":i=o.max(e.field,t);break;case"min":i=o.min(e.field,t);break;case"average":case"avg":i=o.average(e.field,t);break;case"count":i=t.length;break;case"countNotEmpty":i=t.reduce(((t,n)=>t+(null!=n[e.field]?1:0)),0)}if("function"==typeof r&&(i=t.reduce(r,"seed"in n?n.seed:0)),null!==i){const e="b-grid-summary-value",t=n.label?`<td class="b-grid-summary-label">${n.label}</td>`:"";let r,s=n.renderer?n.renderer({config:n,sum:i}):i;null==s&&(s=""),r=String(s).includes("<td>")?s:t?`${t}<td class="${e}">${s}</td>`:`<td colspan="2" class="${e}">${s}</td>`,l+=`<tr>${r}</tr>`}})),l+"</table>"}};class Gu extends(Wu(uo)){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null}}construct(e,t){if(this.grid=e,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.on({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.on({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.store.useGroupFooters=!e,this.isConfiguring||this.store.group(),super.doDisable(e)}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:t,row:n,record:r,size:i,isFirstColumn:s}){const o=this,{meta:a}=r,l="groupRowFor"in a,c="groupFooterFor"in a,d={"b-group-footer":0,"b-header-summary":0};if(o.store.isGrouped&&(c||o.collapseToHeader&&l&&a.collapsed&&!s)){const s=l?r:a.groupRecord;n.isGroupFooter=c,n.isGroupHeader=l,c?d["b-group-footer"]=1:d["b-header-summary"]=1;const u=o.updateSummaryHtml(t,e,s),h="number"==typeof u?u:u.count;h>1&&(i.height=o.grid.rowHeight+(r.meta.collapsed?0:h*o.grid.rowHeight*.1)),u.height&&(i.height+=u.height)}n.assignCls(d)}updateSummaryHtml(e,t,n){const r=n.groupChildren.slice();r.pop();const i=this.generateHtml(t,r,"b-grid-group-summary",n,n.meta.groupField,n.meta.groupRowFor);return e.children.length?er.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find((e=>e.field in t)))return;Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach((e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)}))}hasSummary(e){return e.sum||e.summaries}}Gu.featureClass="b-group-summary",Gu._$name="GroupSummary",Tu.registerFeature(Gu);class Uu extends wl{static get $name(){return"HeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"header",_showForTimeAxis:!1}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}onElementKeyDown(e){if(!e.handled&&e.target.matches(".b-grid-header.b-depth-0"))switch(e.key){case" ":this.internalShowContextMenu(this.createContextMenuEventForElement(e.target))}}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&(this._showForTimeAxis||t!==this.client.timeAxisColumn)}showContextMenu({column:e}){super.showContextMenu(...arguments),e===this.client.timeAxisColumn&&this.menu&&(this.menu.scrollAction="realign")}getDataFromEvent(e){return Ot.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){return null!=t&&t.headerMenuItems&&(Array.isArray(t.headerMenuItems)&&s.deprecate("Grid","5.0.0","`headerMenuItems` column config specified as an array is deprecated, need to specify the config as a named object. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."),Ot.merge(e,t.headerMenuItems)),e}}Uu.featureClass="",Uu._$name="HeaderMenu",Tu.registerFeature(Uu,!0);class Yu extends uo{static get $name(){return"QuickFind"}static get defaultConfig(){return{mode:"header",find:""}}static get pluginConfig(){return{chain:["onElementKeyDown","onElementKeyPress","onCellNavigate"]}}construct(e,t){this.grid=e,super.construct(e,t)}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[n,r,i]=er.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},!0);"header"===e.mode?t.appendChild(n):(n.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(n)),e.headerField={header:n,field:r,badge:i,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.on({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this,{grid:t,headerField:n}=e;for(const n of e.prevFound||e.found){const r=t.getRowById(n.id);if(r){r.forceInnerHTML=!0;const t=r.getCell(e.columnId);t._content=null,r.renderCell({cellElement:t,record:n.data}),r.forceInnerHTML=!1}}n&&(n.header.parentNode.removeChild(n.header),n.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId){const n=this,{grid:r}=n,i=r.columns.getById(t)||r.columns.get(t),s=n.store.findByField(i.field,e);let o=1;Object.assign(n,{foundMap:{},prevFound:n.found,found:s,find:e,columnId:i.id}),e?n.showQuickFind():n.hideQuickFind();for(const e of er.children(r.element,".b-quick-hit")){e.classList.remove("b-quick-hit"),e.classList.remove("b-quick-hit-cell");const t=sa.get(e).row;e._content=e.lastDomConfig=null,e.innerHTML="",t.renderCell({cellElement:e})}if(s){s.length>0&&n.gotoClosestHit(r.focusedCell,s);for(const e of s){n.foundMap[e.id]=o++;const t=r.getRowById(e.data.id);if(null==t||t.renderCell({cellElement:t.getCell(i.id)}),o>1e3)break}r.trigger("quickFind",{find:e,found:s})}}clear(){var e;null!==(e=this.found)&&void 0!==e&&e.length&&this.search("")}get foundCount(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id}),!!t}gotoClosestHit(e,t){const n=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort(((e,t)=>Math.abs(e.index-n)-Math.abs(t.index-n)));this.gotoHit(t.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e;const t=this,{grid:n}=t,r=n._focusedCell?n._focusedCell.id:null===(e=n.lastFocusedCell)||void 0===e?void 0:e.id,i=n.store.indexOf(r)||0,s=t.found.find((e=>e.index>i));s?n.focusCell({columnId:t.columnId,id:s.id}):t.gotoFirstHit()}gotoPrevHit(){var e;const t=this,{grid:n,found:r}=t,i=n._focusedCell?n._focusedCell.id:null===(e=n.lastFocusedCell)||void 0===e?void 0:e.id,s=n.store.indexOf(i)||0;let o;if(r.length){for(let e=r.length-1;e--;e>=0)if(r[e].index<s){o=r[e];break}o?n.focusCell({columnId:t.columnId,id:o.id}):t.gotoLastHit()}}renderCell(e){var t;const n=this,r=e.cellElement,i=n.columnId===e.column.id&&(null===(t=n.foundMap)||void 0===t?void 0:t[e.record.id]);if(i){const t=e.column.htmlEncode||e.column.shouldHtmlEncode;if(r.classList.add("b-quick-hit"),t){var s;const e=er.down(r,".b-grid-cell-value,.b-tree-cell-value")||r;let t=A.encodeHtml(e.innerText);const o=null===(s=t)||void 0===s?void 0:s.toLowerCase().indexOf(n.find.toLowerCase());if(o>-1){const r=o+n.find.length,s=t.slice(o,r);let a="";" "===t[o-1]&&(a="&nbsp;"),t=t.slice(0,o)+`<span class="b-quick-hit-text">${a}${s}</span>`+t.slice(r),e.innerHTML=t+`<div class="b-quick-hit-cell-badge">${i}</div>`}else r.classList.add("b-quick-hit-cell")}else r.classList.add("b-quick-hit-cell")}}onElementKeyDown(e){const t=this,n=t.grid.features.filter;t.disabled||er.up(e.target,r.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")||t.find.length>0&&("Backspace"===e.key?(e.preventDefault(),t.find=t.find.substr(0,t.find.length-1),t.search(t.find)):"Escape"===e.key?(e.preventDefault(),t.find="",t.search(t.find)):"F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit()):n&&t.columnId&&t.foundCount&&e.ctrlKey&&e.shiftKey&&"F"===e.key&&(t.clear(),n.showFilterEditor(t.grid.columns.getById(t.columnId),t.find)))}onElementKeyPress(e){const t=this,{grid:n}=t;if(!t.disabled&&!er.up(e.target,r.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")&&"Enter"!==e.key&&n._focusedCell){const r=n.columns.getById(n._focusedCell.columnId);var i;if(r&&!1!==r.searchable)t.columnId=n._focusedCell.columnId,1===(null===(i=e.key)||void 0===i?void 0:i.length)&&(t.find+=e.key,t.search(t.find))}}onCellNavigate(e,t,n){const r=this;!(r.prevFound||r.found)||n&&n.columnId===r.columnId||r.clear()}}Yu._$name="QuickFind",Tu.registerFeature(Yu);class qu extends uo{static get $name(){return"RegionResize"}construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementTouchStart","onElementTouchMove","onElementTouchEnd","onElementMouseDown","onElementMouseMove","onElementDblClick","onElementMouseUp","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,n=t.grid,r=er.up(e.target,".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let e=r.dataset.region,i=n.getSubGrid(e);i.collapsed||(e=n.getLastRegions()[1],i=n.getSubGrid(e)),i.expand().then((()=>t.expanding=!1))}}startMove(e,t){const{grid:n}=this,r=e.dataset.region,i=n.element,s=n.regions[n.regions.indexOf(r)+1],o=n.getSubGrid(s),a=n.getSubGrid(r);let l=a,c=1;if(null!=l.flex&&null==o.flex&&(l=o,c=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const d=l.element.offsetWidth+o.element.offsetWidth;this.dragContext={element:e,headerEl:l.header.element,subGridEl:l.element,subGrid:l,splitterSubGrid:a,originalWidth:l.element.offsetWidth,originalX:t,minWidth:l.minWidth||0,maxWidth:Math.min(d,l.maxWidth||d),flip:c},i.classList.add("b-moving-splitter"),a.toggleSplitterCls("b-moving")}endMove(){const e=this.dragContext;e&&(this.grid.element.classList.remove("b-moving-splitter"),e.splitterSubGrid.toggleSplitterCls("b-moving",!1),this.dragContext=null)}onCollapseClick(e,t){const n=this.grid,r=t.dataset.region,i=n.getLastRegions();if(i[0]===r){const e=n.getSubGrid(i[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const n=this.grid,r=t.dataset.region,i=n.getLastRegions();if(i[0]!==r||e.collapsed)e.expand();else{n.getSubGrid(i[1]).collapse()}}updateMove(e){const{dragContext:t}=this;if(t){const n=e-t.originalX,r=Math.min(t.maxWidth,t.originalWidth+n*t.flip);t.subGrid.width=Math.max(r,t.minWidth)}}onElementTouchStart(e){const t=e.target.closest(".b-grid-splitter");t&&this.startMove(t,e.touches[0].clientX)}onElementTouchMove(e){this.dragContext&&(this.updateMove(e.touches[0].clientX),e.preventDefault())}onElementTouchEnd(e){this.dragContext&&(this.endMove(),e.preventDefault())}onElementMouseDown(e){const t=this,n=e.target,r=n.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),i=r&&t.grid.getSubGrid(r.dataset.region);0===e.button&&(n.classList.contains("b-grid-splitter")||n.classList.contains("b-grid-splitter-inner")?t.startMove(r,e.clientX):n.classList.contains("b-icon-collapse-gridregion")?t.onCollapseClick(i,r):n.classList.contains("b-icon-expand-gridregion")&&t.onExpandClick(i,r))}onElementMouseMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementMouseUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse(e){const t=this.grid.resolveSplitter(e);this.grid.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand(e){this.grid.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}render(){const{regions:e,subGrids:t}=this.grid;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}qu.featureClass="b-split",qu._$name="RegionResize",Tu.registerFeature(qu);class Ku extends uo{static get $name(){return"RowCopyPaste"}static get type(){return"rowCopyPaste"}static get pluginConfig(){return{assign:["copyRows","pasteRows"],chain:["onElementKeyDown","populateCellMenu"]}}static get properties(){return{recordsFromClipboard:[]}}static get configurable(){return{copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText"]}}construct(e,t){super.construct(e,t),e.rowManager.on({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:t}){e.cls["b-cut-row"]=t.meta.isCut}onElementKeyDown(e){if(e.ctrlKey)switch(e.key.toLowerCase()){case"c":this.onCtrlCKey();break;case"x":this.onCtrlXKey();break;case"v":this.onCtrlVKey()}}copyRows(e=!1){const t=this,{client:n}=t;n.readOnly||(t._isCut=e,t.recordsFromClipboard=[...n.selectedRecords],n.store.forEach((e=>{e.meta.isCut=t._isCut&&t.recordsFromClipboard.includes(e)})),n.refreshRows())}onCtrlCKey(){this.copyRows()}onCtrlXKey(){this.copyRows(!0)}onCtrlVKey(){this.pasteRows()}pasteRows(e){const t=this,n=t.recordsFromClipboard,r=e||t.client.selectedRecord,i=[],s=[];n.length&&(n.forEach((e=>{const n={};t._isCut?(i.push(e),e.meta.isCut=!1):(n.name=`${e.name} - copy`,s.push(e.copy(n)))})),s.length?t.doCloneRecords(r,s):i.length&&t.doMoveRecords(r,i,n),t._isCut&&(t._isCut=!1,t.recordsFromClipboard=[]))}doCloneRecords(e,t){const{store:n}=this.client,r=n.indexOf(e);return n.tree?e.parent.insertChild(t,e):n.insert(r,t)}doMoveRecords(e,t){const{store:n}=this.client;if(n.tree)return e.parent.insertChild(t,e);n.move(t,e)}populateCellMenu({record:e,items:t}){const n=this;if(!n.client.readOnly&&e&&!e.isSpecialRow){t.copyRow={text:n.copyRecordText,localeClass:n,icon:"b-icon b-icon-copy",name:"copyRow",weight:10,onItem:()=>n.copyRows()},t.cutRow={text:n.cutRecordText,localeClass:n,icon:"b-icon b-icon-cut",name:"cutRow",weight:10,onItem:()=>n.copyRows(!0)};n.recordsFromClipboard.length&&(t.pasteRow={text:n.pasteRecordText,localeClass:n,icon:"b-icon b-icon-paste",name:"pasteRow",weight:10,onItem:()=>n.pasteRows(e)})}}}Ku.featureClass="b-row-copypaste",Ku._$name="RowCopyPaste",Tu.registerFeature(Ku,!0,"Grid"),Tu.registerFeature(Ku,!1,"Gantt"),Tu.registerFeature(Ku,!1,"SchedulerPro"),Tu.registerFeature(Ku,!1,"ResourceHistogram");class Xu extends(br(uo)){static get $name(){return"RowReorder"}static get defaultConfig(){return{hoverExpandTimeout:1e3}}construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){var e;null===(e=this.dragHelper)||void 0===e||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=new Ll({name:"rowReorder",mode:"translateXY",cloneTarget:!0,dragThreshold:10,targetSelector:".b-grid-row",lockX:!0,transitionDuration:t.transitionDuration,scrollManager:t.scrollManager,dragWithin:t.element,outerElement:t.verticalScroller,monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},ignoreSamePositionDrop:!1,createProxy(e){const n=e.cloneNode(!0),r=document.createElement("div");if(n.removeAttribute("id"),n.style.transform="",r.appendChild(n),t.selectedRecords.length>1){const e=n.cloneNode(!0);e.classList.add("b-row-dragging-multiple"),r.appendChild(e)}return er.removeClsGlobally(r,"b-selected","b-hover","b-focused"),r},listeners:{beforedragstart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,reset:e.onReset,prio:1e4,thisObj:e}}),e.dropIndicator=er.createElement({parent:t.bodyContainer,className:"b-row-drop-indicator"}),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow")}static get pluginConfig(){return{after:["onPaint"]}}onBeforeDragStart({context:e}){const t=this.grid,n=t.regions[0],r=t.subGrids[n].element;if(this.disabled||t.readOnly||!r.contains(e.element))return!1;const i=e.records=t.selectedRecords.slice().sort(((e,n)=>t.store.indexOf(e)-t.store.indexOf(n)));return e.startRecord=t.getRecordFromElement(e.element),e.originalRowTop=t.rowManager.getRowFor(e.startRecord).top,e.record=e.startRecord,i.length>0&&!i.some((e=>e.isSpecialRow))}onDragStart({context:e}){var t,n,r;const i=this,{cellEdit:s,contextMenu:o,cellMenu:a,headerMenu:l}=i.grid.features;s&&(i.cellEditDisabledState=s.disabled,s.disabled=!0),null==o||null===(t=o.hideContextMenu)||void 0===t||t.call(o,!1),null==a||null===(n=a.hideContextMenu)||void 0===n||n.call(a,!1),null==l||null===(r=l.hideContextMenu)||void 0===r||r.call(l,!1),i.grid.element.classList.add("b-row-reordering");const c=e.element.querySelector(".b-focused");null==c||c.classList.remove("b-focused"),er.removeClasses(e.element.firstElementChild,["b-selected","b-hover"])}onDrag({context:e,event:t}){const n=this,{grid:r}=n,{store:i,rowManager:s}=r,{dragWithin:o}=n.dragHelper;if(!o.contains(t.target))return void(e.valid=!1);let a,l,c,d,u=e.valid,h=r.rowManager.getRowAt(t.clientY);if(h){const e=h.top+r._bodyRectangle.y-r.scrollable.y+h.height/2;l=h.dataIndex,a=i.getAt(l),c=t.clientY>e}else t.clientY<r._bodyRectangle.y?(l=0,a=i.first,c=!1):(l=i.count-1,a=i.last,c=!0),h=r.rowManager.getRow(l);if(a!==n.overRecord||n.after!==c){if(n.overRecord=a,n.after=c,a===e.startRecord&&(u=!1),i.tree){if(d=c?a.nextSibling:a,e.records.some((e=>e.contains(a)))&&(u=!1),e.parent){const t=s.getRowById(e.parent);null==t||t.removeCls("b-row-reordering-target-parent")}if(e.parent=a.parent,!e.parent.isRoot){const t=s.getRowById(e.parent);null==t||t.addCls("b-row-reordering-target-parent")}n.clearTimeout(n.hoverTimer),a&&a.isParent&&!a.isExpanded(i)&&(n.hoverTimer=n.setTimeout((()=>r.expand(a)),n.hoverExpandTimeout))}else d=c?i.getAt(l+1):a;er.setTranslateY(n.dropIndicator,h.top+(c?h.height:0)),e.insertBefore=d,e.valid=n.reorderValid=u}else e.valid=n.reorderValid}async onDrop(e){const t=this,n=e.context;if(n.valid=n.valid&&t.reorderValid,n.valid){n.asyncCleanup=n.async=!0;!1===await t.trigger("gridRowBeforeDropFinalize",e)&&(n.valid=!1),n.valid,n.element.classList.add("b-dropping"),await Tr.waitForTransitionEnd({element:n.element.firstElementChild,property:"transform",thisObj:t.client}),await t.finalizeReorder(n)}t.clearTimeout(t.hoverTimer),t.trigger("gridRowDrop",e)}async finalizeReorder(e){const{grid:t}=this,{store:n}=t;let r=e.records;if(e.valid=e.valid&&!r.some((e=>!n.includes(e))),e.valid){let i;n.tree?(r=r.filter((e=>!e.parent||!r.includes(e.parent))),i=await e.parent.tryInsertChild(r,e.insertBefore),t.rowManager.forEach((e=>e.removeCls("b-row-reordering-target-parent"))),e.valid=!1!==i):n.move(r,e.insertBefore),n.clearSorters()}e.finalize(e.valid),t.element.classList.remove("b-row-reordering")}onReset(){const e=this,t=e.grid.features.cellEdit;e.grid.element.classList.remove("b-row-reordering"),t&&(t.disabled=e.cellEditDisabledState),er.removeClsGlobally(e.grid.element,"b-row-reordering-target-parent")}onPaint(){this.init()}}Xu.featureClass="",Xu._$name="RowReorder",Tu.registerFeature(Xu,!1),Tu.registerFeature(Xu,!0,"Gantt");class Zu extends uo{static get $name(){return"Search"}static get configurable(){return{limit:1e3}}static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text",hitColumns:new Set}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,find:"",hitEls:[]})}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu","onElementKeyDown"]}}search(e,t=!0,n=!1){const r=this;if(!e)return r.clear();if(!n&&e===r.find||r.disabled)return;const{grid:i,store:s}=r,o=i.columns.visibleColumns.filter((e=>!1!==e.searchable)).map((e=>e.field)),a=s.search(e,o);let l=1;if(Object.assign(r,{foundMap:{},prevFound:r.found,found:a,find:e}),r.clearHits(),a){r.hitColumns.forEach((e=>{e.disableHtmlEncode=!1})),r.hitColumns.clear();for(const e of a){r.foundMap[e.field+"-"+e.id]=l++;const t=i.columns.get(e.field);if(t&&!r.hitColumns.has(t)&&(t.disableHtmlEncode=!0,r.hitColumns.add(t)),l>r.limit)break}return r.listenersInitialized||(i.rowManager.on({name:"renderCell",renderCell:"renderCell",thisObj:r}),s.on({name:"storeRefresh",[`refresh${i.asyncEventSuffix}`]:"onStoreRefresh",thisObj:r}),r.listenersInitialized=!0),i.refreshRows(),i.trigger("search",{grid:i,find:e,found:a}),t&&!r.isHitFocused&&r.gotoNextHit(!0),a}}clearHits(){for(const e of er.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls),e.classList.remove(this.hitCellCls);const t=sa.get(e).row;t.forceInnerHTML=!0,t.renderCell({cellElement:e}),t.forceInnerHTML=!1}}clear(e=!1){const t=this,{grid:n}=t;t.foundMap&&delete t.foundMap,delete t.find,t.clearHits(),t.listenersInitialized&&(this.detachListeners("renderCell"),this.detachListeners("storeRefresh"),t.listenersInitialized=!1),e||n.trigger("clearSearch",{grid:n})}get foundCount(){var e,t;return null!==(e=null===(t=this.found)||void 0===t?void 0:t.length)&&void 0!==e?e:0}get isHitFocused(){const{grid:e}=this,t=e.focusedCell?e.store.indexOf(e.focusedCell.id):-1,n=e.focusedCell?e.columns.getById(e.focusedCell.columnId):null;return-1!==t&&this.found.some((e=>e.index===t&&n&&e.field===n.field))}gotoNextHit(e=!1){var t;const n=this;if(null===(t=n.found)||void 0===t||!t.length)return;const{grid:r}=n,i=r.focusedCell||r.lastFocusedCell,s=i&&!e?r.store.indexOf(i.id):-1,o=n.found.findIndex((e=>e.index>s));-1!==o&&n.gotoHit(o)}gotoPrevHit(){var e;const t=this;if(null===(e=t.found)||void 0===e||!e.length)return;const{grid:n,found:r}=t,i=n.focusedCell||n.lastFocusedCell,s=i?n.store.indexOf(i.id):0;for(let e=r.length-1;e--;e>=0){if(r[e].index<s){t.gotoHit(e);break}}}gotoHit(e){const{grid:t}=this,n=this.found[e];return n&&t.focusCell({field:n.field,id:n.id}),Boolean(n)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:n,value:r}){var i;const s=this,o=null===(i=s.foundMap)||void 0===i?void 0:i[t.field+"-"+n.id];if(o){e.classList.add(s.hitCls);const t=e.innerHTML,n=er.down(e,".b-grid-cell-value")||e,i=String(s.find).toLowerCase();if(String(r).toLowerCase()===i)n.innerHTML=`<span class="${s.hitTextCls}">${t}</span><div class="${s.hitCellBadgeCls}">${o}</div>`;else{const r=null==t?void 0:t.toLowerCase().indexOf(i);if(t&&r>-1){const e=r+i.length,a=t.slice(r,e);n.innerHTML=`${t.slice(0,r)}<span class="${s.hitTextCls}">${a}</span>${t.slice(e)}<div class="${s.hitCellBadgeCls}">${o}</div>`}else e.classList.add(s.hitCellCls)}s.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:n}){const r=this;e.searchable&&(n.search={text:"L{searchForValue}",localeClass:r,icon:"b-fw-icon b-icon-search",cls:"b-separator",name:"search",weight:200,disabled:r.disabled,onItem:()=>{let n=window.getSelection().toString();n||(n=t[e.field]),r.search(n)}})}onElementKeyDown(e){const t=this;t.find&&""!==t.find&&("F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit())}onStoreRefresh(){this.search(this.find,!1,!0)}}Zu.featureClass="b-search",Zu._$name="Search",Tu.registerFeature(Zu);class Ju extends uo{static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(e.store),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){const e=this,{grid:t}=e;if(!t.hideHeaders&&t.isPainted){const r=e.store.sorters,i=r.length,s=new on;let o;for(const a of t.columns.visibleColumns){var n;const t=a.element,l=null===(n=a.textWrapper)||void 0===n?void 0:n.dataset;(null==l?void 0:l.sortIndex)&&delete l.sortIndex,s.value=t.classList,!1!==a.sortable?(s.add(e.sortableCls),o=r.find((e=>e.field===a.field||e.sortFn&&e.sortFn===a.sortable.sortFn)),o?(i>1&&l&&(l.sortIndex=r.indexOf(o)+1),s.add(e.sortedCls),o.ascending?(s.add(e.sortedAscCls),s.remove(e.sortedDescCls)):(s.add(e.sortedDescCls),s.remove(e.sortedAscCls))):(s.remove(e.sortedCls),s["b-group"]||(s.remove(e.sortedAscCls),s.remove(e.sortedDescCls)))):s.remove(e.sortableCls),er.syncClassList(t,s)}}}populateHeaderMenu({column:e,items:t}){const n=this,{store:r}=n,i=d(d({},e.sortable),{},{field:e.field,columnOwned:!0});if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:n,icon:"b-fw-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:300,disabled:n.disabled,onItem:()=>r.sort(i,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:n,icon:"b-fw-icon b-icon-sort-desc",name:"sortDesc",weight:310,disabled:n.disabled,onItem:()=>r.sort(i,!1)},n.multiSort&&n.grid.columns.records.some((e=>e.sortable)))){const s=r.sorters.find((t=>t.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===t.sortFn));t.multiSort={text:"L{multiSort}",localeClass:n,icon:"b-fw-icon b-icon-sort",name:"multiSort",weight:320,disabled:n.disabled,menu:{addSortAsc:{text:s?"L{toggleSortAscending}":"L{addSortAscending}",localeClass:n,icon:"b-fw-icon b-icon-sort-asc",name:"addSortAsc",disabled:s&&(null==s?void 0:s.ascending),weight:330,onItem:()=>r.addSorter(i,!0)},addSortDesc:{text:s?"L{toggleSortDescending}":"L{addSortDescending}",localeClass:n,icon:"b-fw-icon b-icon-sort-desc",name:"addSortDesc",disabled:s&&!s.ascending,weight:340,onItem:()=>r.addSorter(i,!1)},removeSorter:{text:"L{removeSorter}",localeClass:n,icon:"b-fw-icon b-icon-remove",name:"removeSorter",weight:350,disabled:!s,onItem:()=>{r.removeSorter(i.field)}}}}}}getColumnDragToolbarItems(e,t){const n=this,{store:r,disabled:i}=n;if(!1!==e.sortable){const s=r.sorters.find((t=>t.field===e.field));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:n,icon:"b-icon b-icon-sort-desc",name:"sortDesc",weight:105,disabled:i,onDrop:({column:e})=>r.sort(e.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-asc",name:"multisortAddAsc",disabled:i||s&&s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-sort-desc",name:"multisortAddDesc",disabled:i||s&&!s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:n,icon:"b-icon b-icon-remove",name:"multisortRemove",weight:105,disabled:i||!s,onDrop:({column:e})=>r.removeSorter(e.field)})}return t}onStoreBeforeSort({sorters:e}){const{columns:t}=this.client;for(let r=0;r<e.length;r++){var n;const i=e[r],s=(i.columnOwned||this.prioritizeColumns)&&t.get(i.field);null!=s&&null!==(n=s.sortable)&&void 0!==n&&n.sortFn&&(e[r]=d(d(d({},i),s.sortable),{},{columnOwned:!0}))}}onElementClick(e){const t=this,n=t.store,r=e.target,i=er.up(r,".b-grid-header.b-sortable"),s=null==i?void 0:i.dataset.column;if(!t.ignoreRe.test(r.className)&&!t.disabled&&i&&s){const r=t.grid.columns.getById(i.dataset.columnId);if(n.isGrouped&&n.groupers.find((e=>e.field===s))&&!e.shiftKey)return;if(r.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)n.removeSorter(r.field);else{const t={columnOwned:!0,field:r.field};"object"==typeof r.sortable&&Ot.assign(t,r.sortable),n.sort(t,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}}Ju.featureClass="b-sort",Ju._$name="Sort",Tu.registerFeature(Ju,!0);class Qu extends uo{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,t){super.construct(e,t),e.on({scroll:"onGridScroll",thisObj:this}),Object.assign(this,er.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]},!1,{})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:t,element:n,contentElement:r}=e,i=nn.client(t.bodyContainer).roundPx(),s=t.rowManager.getRowAt(i.y),o=s!==e.currentTopRow;if(s){o&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),r.innerHTML="",r.appendChild(e.updateStickyContent()));const t=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[t?"add":"remove"]("b-hide-visibility"),e.currentTopRow[t?"addCls":"removeCls"]("b-not-enough-height"),i.y+=e.stickyContentTop,er.alignTo(n,e.stickyEls[0],{align:"t0-t0",constrainTo:i},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:t,removeClasses:n}=e,r={"b-grid-sticky-row":1},i={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),o=e.stickyEls||(e.stickyEls=[]);for(o.forEach((e=>{e.classList.remove("b-sticky-content-el")})),o.length=0,t.eachElement((t=>{o.push(...t.querySelectorAll(e.contentSelector))}));s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,o.map((t=>{t.closest(".b-grid-cell").classList.forEach((e=>i[e]=1)),t.closest(".b-grid-row").classList.forEach((e=>r[e]=1)),Object.assign(i,n),Object.assign(r,n);const o=t.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,o),t.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-t.offsetTop+o),t.style.alignSelf="";const a=t.cloneNode(!0);return t.classList.add("b-sticky-content-el"),s.appendChild(a),a})),i["b-focused"]=!1,er.syncClassList(e.contentElement,i),er.syncClassList(e.element,r),s}}Qu._$name="StickyCells",Tu.registerFeature(Qu,!1);class eh extends uo{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.rowManager.on({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,n=e.dataIndex%2==0;e.assignCls({"b-even":!t&&n,"b-odd":!t&&!n})}}eh._$name="Stripe",Tu.registerFeature(eh);class th extends(Wu(uo)){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.on({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e),e?this.grid.element.classList.add("b-summary-disabled"):(this.updateSummaries(),this.grid.element.classList.remove("b-summary-disabled"))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:n}=e,r=er.children(t.element,".b-grid-footer"),i=e.selectedOnly&&t.selectedRecords.length>0,s=n.storage.values.filter((e=>!e.isSpecialRow&&(!i||t.isSelected(e))));t.columns.forEach((e=>{e.summaries&&e.summaries.forEach((e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}))})),r.forEach((n=>{if(!n.dataset.column)return;const r=t.columns.get(n.dataset.column),i=e.generateHtml(r,s,"b-grid-footer-summary");(r.summaries?r.summaries.length:!!r.sum)&&(n.children.length?er.sync(i,n.firstElementChild):n.innerHTML=i)}))}onStoreChange({action:e,changes:t}){let n=!0;this.disabled||("update"===e&&(n=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))),n&&this.updateSummaries())}updateSelectedOnly(e){const t=this;t.detachListeners("selectionChange"),e&&t.grid.on({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}refresh(){this.updateSummaries()}}th.featureClass="b-summary",th._$name="Summary",Tu.registerFeature(th);const nh=Promise.resolve();class rh extends(uo.mixin(br)){static get $name(){return"Tree"}static get defaultConfig(){return{expandOnCellClick:!1}}static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],before:["navigateRight","navigateLeft"],chain:["onElementClick","onElementKeyDown","bindStore"]}}construct(e,t){super.construct(e,t);const n=e.columns.find((e=>e instanceof Cu));Object.assign(this,{grid:e,rowManager:e.rowManager,treeColumn:n}),e.store&&this.bindStore(e.store)}doDisable(e){}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.on({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,t,n=!1){const r=this,{store:i,grid:s}=r,{rowManager:o}=s,a=i.getById(e),l=a.instanceMeta(i);if(await i.toggleCollapse(a,t)){const e=o.getRowFor(a);if(e){const t=e.getCell(r.treeColumn.id);t&&e.renderCell({cellElement:t,record:a})}r.isTogglingNode||(s.element.classList.add("b-toggling-node"),r.isTogglingNode=!0,r.requestAnimationFrame((()=>{s.element.classList.remove("b-toggling-node"),r.isTogglingNode=!1}))),s.trigger(l.collapsed?"collapseNode":"expandNode",{source:s,record:a}),s.trigger("toggleNode",{source:s,record:a,collapse:l.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.grid.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const n=e.getById(t[e.modelClass.idField]),r=this.grid.rowManager.getRowFor(n);r&&r.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const n=e.getById(t[e.modelClass.idField]),r=this.grid.rowManager.getRowFor(n);r&&r.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.grid.rowManager.getRowFor(e);t&&t.removeCls("b-loading-children")}expandOrCollapseAll(e=!0,t=this.store.rootNode){const{grid:n,store:r}=this,i=[],s=[];return n.trigger("beforeToggleAllNodes",{source:n,collapse:e}),r.suspendEvents(),r.traverse((t=>{const n=t.instanceMeta(r);t.isLeaf||(e&&!n.collapsed?(this.toggleCollapse(t,!0,!0),s.push(...t.children)):!e&&n.collapsed&&(Array.isArray(t.children)&&s.push(...t.children),i.push(this.toggleCollapse(t,!1,!0))))}),t,t===r.rootNode),r.resumeEvents(),(e?nh:Promise.all(i)).then((()=>{n.refreshRows(e),s.length&&(e?r.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):r.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),n.trigger("toggleAllNodes",{source:n,collapse:e})}))}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e){const t=this,n=t.store.getById(e);if(!1===n.instanceMeta(t.store).hiddenByCollapse)return;let r=!1,i=n.parent;const s=[];for(;i&&!i.isRoot;)s.push(i),i=i.parent;await s.reverse().forEach((async e=>{e.instanceMeta(t.store).collapsed&&(r=!0),await t.toggleCollapse(e,!1,!0)})),r&&t.grid.refreshRows(),await t.grid.scrollRowIntoView(n)}onElementClick(e){const t=this,n=e.target,r=t.grid.getCellDataFromEvent(e),i=n.closest(".b-tree-expander");(i||t.expandOnCellClick&&r&&r.record.isParent)&&(i&&e.preventDefault(),t.toggleCollapse(r.record))}onElementKeyDown(e){const t=this.grid;e.target===t.focusElement&&" "===e.key&&t.focusedCell&&(e.preventDefault(),this.toggleCollapse(t.focusedCell.id))}navigateRight(e){const t=this,n=t.grid,r=n.focusedCell;if(r){const i=n.store.getById(r.id);if(n.columns.getById(r.columnId).tree&&(e.shiftKey||1===n.columns.count))return i.isParent&&i.instanceMeta(n.store).collapsed?t.expand(i):n.navigateDown(e),!1}}navigateLeft(e){const t=this,n=t.grid,r=n.focusedCell;if(r){const i=n.store.getById(r.id);if(n.columns.getById(r.columnId).tree&&(e.shiftKey||1===n.columns.count))return i.isParent&&!i.instanceMeta(n.store).collapsed?t.collapse(i):i.parent&&n.focusCell({id:i.parent.id,columnId:r.columnId}),!1}}}rh.featureClass="b-tree",rh._$name="Tree",Tu.registerFeature(rh,!1,"Grid"),Tu.registerFeature(rh,!0,"TreeGrid");const ih={all:"all",visible:"visible"},sh={A6:{width:4.13,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},oh={portrait:"portrait",landscape:"landscape"},ah={pdf:"pdf",png:"png"},lh={pdf:"application/pdf",png:"image/png"};var ch=e=>class extends(e||cd){static get $name(){return"LocalizableComboItems"}static get defaultConfig(){return{items:!0}}set items(e){!0===e&&(e=this.buildLocalizedItems()),super.items=e}get items(){return super.items}construct(...e){this.inConstruct=!0,super.construct(...e),this.inConstruct=!1}buildLocalizedItems(){return[]}updateLocalizedItems(){const e=this;if(e.store&&!e.inConstruct){const{value:t}=e;e.store.data=e.buildLocalizedItems(),e.value=null,e.value=t,e.syncInputFieldValue(!0)}}updateLocalization(){this.updateLocalizedItems(),super.updateLocalization()}};class dh extends(ch(cd)){static get $name(){return"LocalizableCombo"}static get type(){return"localizablecombo"}}dh.initClass(),dh._$name="LocalizableCombo";class uh extends dh{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return[{id:ih.all,text:this.L("L{all}")},{id:ih.visible,text:this.L("L{visible}")}]}}uh.initClass(),uh._$name="ExportRowsCombo";class hh extends dh{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return[{id:oh.portrait,text:this.L("L{portrait}")},{id:oh.landscape,text:this.L("L{landscape}")}]}}hh.initClass(),hh._$name="ExportOrientationCombo";class gh extends Ns{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get defaultConfig(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,hidePNGMultipageOption:!0,exporterType:"singlepage",orientation:"portrait",paperFormat:"A4",fileFormat:"pdf",alignRows:!1,rowsRange:"all",title:"L{exportSettings}",defaults:{localeClass:this},bbar:{defaults:{type:"button",localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const t=this,{client:n}=e;if(!n)throw new Error("`client` config is required");const r=t.buildDialogItems(e);e.items?Array.isArray(e.items)?e.items.push(...r):r.forEach((t=>{e.items[t.ref]=t,delete t.ref})):e.items=r,e.width=e.width||t.L("L{width}"),super.construct(e),Ve.on({locale:"onLocaleChange",prio:-1,thisObj:t})}get fieldProperties(){return["exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"]}getDefaultFieldValues(e){const t=Ot.copyProperties({},e,this.fieldProperties);return Ot.copyPropertiesIf(t,this.getDefaultConfiguration(),this.fieldProperties)}buildDialogItems(e){const t=this,{exporters:n,client:r}=e,{exporterType:i,orientation:s,paperFormat:o,fileFormat:a,alignRows:l,rowsRange:c,repeatHeader:d}=t.getDefaultFieldValues(e),u=t.L("L{ExportDialog.labelWidth}");function h(e,t=(e=>e)){return Object.keys(e).map((e=>({id:e,text:t(e)})))}return t.columnsStore=r.columns.chain((e=>e.isLeaf&&e.exportable)),[{labelWidth:u,type:"combo",ref:"columnsField",label:"L{ExportDialog.columns}",store:t.columnsStore,value:null,valueField:"id",displayField:"text",multiSelect:!0},{labelWidth:u,type:"exportrowscombo",ref:"rowsRangeField",label:"L{ExportDialog.rows}",value:c},{labelWidth:u,type:"localizablecombo",ref:"exporterTypeField",label:"L{ExportDialog.exporterType}",editable:!1,value:i,buildLocalizedItems:()=>n.map((e=>({id:e.type,text:t.optionalL(e.title,this)}))),onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden="singlepage"===e,this.owner.widgetMap.repeatHeaderField.hidden="multipagevertical"!==e}},{labelWidth:u,type:"checkbox",ref:"alignRowsField",label:"L{ExportDialog.alignRows}",checked:l,hidden:"singlepage"===i},{labelWidth:u,type:"checkbox",ref:"repeatHeaderField",label:"L{ExportDialog.repeatHeader}",localeClass:this,value:d,hidden:"multipagevertical"!==i},{labelWidth:u,type:"combo",ref:"fileFormatField",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:a,items:h(ah,(e=>e.toUpperCase())),onChange({value:e,oldValue:n}){if(t.hidePNGMultipageOption){const r=t.widgetMap.exporterTypeField,i=r.store.find((e=>"singlepage"===e.id));e===ah.png&&i?(this._previousDisabled=r.disabled,r.disabled=!0,this._previousValue=r.value,r.value="singlepage"):n===ah.png&&this._previousValue&&(r.disabled=this._previousDisabled,r.value=this._previousValue)}}},{labelWidth:u,type:"combo",ref:"paperFormatField",label:"L{ExportDialog.paperFormat}",editable:!1,value:o,items:h(sh)},{labelWidth:u,type:"exportorientationcombo",ref:"orientationField",label:"L{ExportDialog.orientation}",value:s}]}onShow(){var e;null===(e=super.onShow)||void 0===e||e.call(this,...arguments),this.widgetMap.columnsField.value=this.columnsStore.query((e=>!e.hidden))}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((t=>{t instanceof qs&&(t.labelWidth=e)}))}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,t={};return this.eachWidget((n=>{e.test(n.ref)&&(t[n.ref.replace(e,"")]=n instanceof fd?n.checked:n.value)})),t}}gh._$name="ExportDialog";class mh extends(br(Be(Ye(me)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0}}pageTpl(e){const{title:t,header:n,footer:i,styles:s,htmlClasses:o,bodyStyle:a,bodyClasses:l=[],paperHeight:c,paperWidth:d,html:u}=e;return l.push(`b-${this.constructor.type}`),er.scrollBarWidth?l.push("b-visible-scrollbar"):l.push("b-overlay-scrollbar"),r.isChrome?l.push("b-chrome"):r.isSafari?l.push("b-safari"):r.isFirefox?l.push("b-firefox"):r.isIE11?l.push("b-ie"):r.isEdge&&l.push("b-edge"),Ul.tpl`
            <!DOCTYPE html>
            <html class="${o}" style="width: ${d}in; height: ${c}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>${t}</title>
                    ${s.join("")}
                </head>
                <body class="b-export ${l.join(" ")}" style="width: ${d}in; height: ${c}in; ${a}">
                    <div class="b-export-content">
                        ${n&&`<div class="b-export-header" style="width: 100%">${n}</div>`}
                        <div class="b-export-body"><div class="b-export-viewport">${u}</div></div>
                        ${i&&`<div class="b-export-footer" style="width: 100%">${i}</div>`}
                    </div>
                </body>
            </html>`}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,n=window.origin,i=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),s=[];return i.forEach((i=>{if(i=i.cloneNode(!0),t&&i.href){let e;e=!0===t?i.href:this.keepPathName?i.href.replace(n,t):new URL(i.getAttribute("href"),t),i.setAttribute("href",e)}let o;if(o=r.isIE11&&i.styleSheet&&/style/i.test(i.tagName)?`<style type="text/css">${i.styleSheet.cssText}</style>`:i.outerHTML,t&&/style/i.test(i.tagName)){const n=e.getStyleTagURLConverter(t);o=o.replace(/url\(['"]?(.+?)['"]?\)/g,n)}s.push(o)})),s.push("<style>\n                body, html {\n                    overflow: auto;\n                }\n                body {\n                    position: relative;\n                    margin: 0;\n                }\n            </style>"),e._stylesheets=s}set stylesheets(e){this._stylesheets=e}getStyleTagURLConverter(e){return function(t,n){let r;try{let i;/^#/.test(n)?r=t:(i=!0===e?window.location.href:this.keepPathName?window.location.href.replace(window.location.origin,e):e,r=`url('${new URL(n,i).href}')`)}catch(e){r=t}return r}.bind(this)}saveState({client:e}){this.state=e.state;const{tbar:t,bbar:n}=e;t&&(this.state.tbar_hidden=t.hidden,t.hide(!1)),n&&(this.state.bbar_hidden=n.hidden,n.hide(!1))}async restoreState({client:e}){const t=[],n=new Set,{tbar:r,bbar:i}=e;n.add(e.scrollable.on({scroll(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid((({header:e,scrollable:r})=>{n.add(r.on({scroll(){t.push(r.await("scrollEnd"))}})),n.add(e.scrollable.on({scroll(){t.push(e.scrollable.await("scrollEnd"))}}))})),r&&(r.hidden=this.state.tbar_hidden,delete this.state.tbar_hidden),i&&(i.hidden=this.state.bbar_hidden,delete this.state.bbar_hidden),e.state=this.state,await Promise.all(t),n.forEach((e=>e()))}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,n=!0){n&&(t.innerHTML=""),r.isChrome?t.appendChild(e.cloneNode(!0)):t.innerHTML=e.outerHTML,er.removeEachSelector(t,".b-grid-row");const i=t.querySelector(".b-gridbase > .b-mask");i&&i.remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=er.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:`<div style="height: 1px"></div>${e}<div style="height: 1px"></div>`}),n=t.offsetHeight-2;return t.remove(),n}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=er.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),n=t.querySelectorAll("img");for(let e=0,t=n.length;e<t;e++)n[e].setAttribute("src",n[e].src);const r=t.innerHTML;return t.remove(),r}createPlaceholder(e,t=!0){return t&&(e.innerHTML=""),er.createElement({parent:e,id:Qr.generateId("export")})}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid((e=>{e.overflowingHorizontally&&(t=er.scrollBarWidth)})),0===t?t:t+1}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}getVisibleRowsCount(e){const t=e.rowManager,n=t.rows.indexOf(t.firstVisibleRow),r=t.rows.indexOf(t.lastVisibleRow);let i;return i=-1!==n?-1===r?e.store.count-n:r-n+1:e.store.count,i}async export(e){const t=this;let n;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{n=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise((e=>t.requestAnimationFrame(e))),await t.restoreState(e)}return n}async getPages(e){const t=this.pagesExtractor(e),n=[];let r;for(;(r=await t.next())&&!r.done;)n.push(r.value);return n}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:n}=e;this.oldRowManagerConfig={prependRowBuffer:n.prependRowBuffer,appendRowBuffer:n.appendRowBuffer};const r=Math.ceil(t/n.rowOffsetHeight);n.prependRowBuffer=r,n.appendRowBuffer=r,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:n,columns:r,rowsRange:i,keepRegionSizes:s}=e,{rowManager:o}=n,a=t.exportMeta={totalWidth:0,totalHeight:0-t.getVirtualScrollerHeight(n),subGrids:{}};if(n.columns.forEach((e=>{r.includes(e.id)?e.show():e.hide()})),n.rowManager.rowCount>0)if(i===ih.all)a.firstVisibleDataIndex=o.rows[0].dataIndex,await n.scrollRowIntoView(n.store.first,{block:"start"});else{const t=a.firstVisibleDataIndex=o.firstVisibleRow.dataIndex;await n.scrollRowIntoView(n.store.getAt(t),{block:"start"}),e.alignRows=!0}this.cloneElement(n.element);const{element:l}=t;n.eachSubGrid((e=>{var r;const i=t.createPlaceholder(l.querySelector(`[id="${e.id}"]`),!1);let o;o=null!=s&&s[e.region]?e.element.offsetWidth:e.columns.visibleColumns.reduce(((e,t)=>("number"==typeof t.width?e+=t.width:e+=n.getHeaderElement(t.id).offsetWidth,e)),0),a.totalWidth+=o;const c=(null===(r=e.splitterElement)||void 0===r?void 0:r.offsetWidth)||0;a.totalWidth+=c,a.subGrids[e.region]={id:e.id,headerId:e.header&&e.header.id||null,footerId:e.footer&&e.footer.id||null,rows:[],splitterWidth:c,placeHolder:i,width:o}}))}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach((({width:t,id:n,headerId:r,footerId:i})=>{[n,r,i].forEach((n=>{if(n){const r=e.querySelector(`[id="${n}"]`);r&&(r.style.width=`${t}px`,r.style.flex="")}}))})),e.innerHTML}async restoreComponent(e){}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise((e=>this.requestAnimationFrame(e)))}}mh.prototype.pagesExtractor=async function*(){yield""},mh._$name="Exporter";class ph extends mh{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this;++t.currentPage,++t.verticalPosition,delete t.lastExportedRowBottom,t.verticalPosition>=t.verticalPages&&(t.verticalPosition=t.currentPageTopMargin=0,++t.horizontalPosition,await this.scrollRowIntoView(e,t.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a}=e,l=sh[e.paperFormat],c=e.orientation===oh.portrait,d=c?l.width:l.height,u=c?l.height:l.width,h=t.inchToPx(d),g=t.inchToPx(u),m=Math.ceil(n.totalWidth/h);let p=n.totalHeight+r.height-r.bodyHeight+r.scrollable.scrollHeight,f=g;i&&(f-=t.measureElement(i({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1}))),s&&(f-=t.measureElement(s({totalWidth:n.totalWidth,totalPages:-1,currentPage:-1})));let v,y=r.store.count;if(a===ih.visible){y=t.getVisibleRowsCount(r);const e=r.rowManager.rows[y-1].bottom;p=p-r.scrollable.scrollHeight+e}if(o&&a!==ih.visible){const e=r.rowManager.rowOffsetHeight,t=Math.floor((f-r.headerHeight)/e),n=Math.floor(f/e),i=y-t;v=1+Math.ceil(i/n)}else v=Math.ceil(p/f);Object.assign(n,{paperWidth:d,paperHeight:u,pageWidth:h,pageHeight:g,horizontalPages:m,verticalPages:v,totalHeight:p,contentHeight:f,totalRows:y,totalPages:m*v,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0}),this.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),this.restoreRowBuffer(e.client)}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o}=e,{totalWidth:a,totalPages:l,currentPage:c,subGrids:d,currentPageTopMargin:u,verticalPosition:h,totalRows:g}=n,{rowManager:m}=r,{rows:p}=m;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===ih.all&&(n.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-t.getVirtualScrollerHeight(r));let f,v,y,b=0,C=0,w=e.rowsRange===ih.visible?p.findIndex((e=>e.bottom>r.scrollable.y)):p.findIndex((e=>e.bottom+u+r.headerHeight>0));const S=w,E=0===h?0:p[w].top+u+r.headerHeight;i&&(v=t.prepareHTML(i({totalWidth:a,totalPages:l,currentPage:c})),b=t.measureElement(v)),s&&(y=t.prepareHTML(s({totalWidth:a,totalPages:l,currentPage:c})),C=t.measureElement(y)),f=n.pageHeight-b-C-E,0===h&&(f-=r.headerHeight);let D,x=0;for(;f>0;){const n=p[w];o&&f<n.offsetHeight?(x=-f,f=0,t.exportMeta.lastExportedRowBottom=p[w-1].bottom):(t.collectRow(n),f-=n.offsetHeight,D=n.dataIndex,(++w===p.length&&f>0||e.rowsRange===ih.visible&&w-S===g)&&(f=0))}const R=p[w-1];if(R&&(n.exactGridHeight=R.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(p.slice(S,w),e),e.rowsRange===ih.visible)n.exactGridHeight-=n.scrollableTopMargin=r.scrollable.y;else{const e=m.on("offsetrows",(({offset:e})=>x+=e));await t.scrollRowIntoView(r,D+1),e()}return{html:t.buildPageHtml(),header:v,footer:y,offset:x}}async onRowsCollected(){}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach((([e,n])=>{t[e].rows.push(n.outerHTML)}))}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n})=>{const r=e.outerHTML;t=t.replace(r,n.join(""))})),t}prepareExportElement(){const{element:e,exportMeta:t}=this;return t.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop=`-${t.scrollableTopMargin}px`),super.prepareExportElement()}}ph.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,totalPages:s,paperWidth:o,paperHeight:a,contentHeight:l}=n;let c;for(;(c=n.currentPage)<s;){t.trigger("exportStep",{text:t.L(ph.exportingPageText,{currentPage:c,totalPages:s}),progress:Math.round((c+1)/s*90)});const{html:d,header:u,footer:h,offset:g}=await t.buildPage(e),m=[...r,`\n                <style>\n                    #${e.client.id} {\n                        height: ${n.exactGridHeight}px !important;\n                        width: ${i}px !important;\n                    }\n                    .b-export-body .b-export-viewport {\n                        margin-left : ${-o*n.horizontalPosition}in;\n                        margin-top  : ${n.currentPageTopMargin}px;\n                    }\n                </style>\n            `];n.currentPageTopMargin-=l+g,await t.stateNextPage(e),yield{html:t.pageTpl({html:d,header:u,footer:h,styles:m,paperWidth:o,paperHeight:a})}}},ph._$name="MultiPageExporter";class fh extends mh{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:n,processedRows:r,totalPages:i}=t;++t.currentPage,++t.verticalPosition,t.currentPage===i&&r.size!==n&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,rowsRange:a,repeatHeader:l}=e,{pageWidth:c,pageHeight:d,totalWidth:u}=n,h=t.getScaleValue(c,u);let g,m=0-t.getVirtualScrollerHeight(r)+r.height-r.bodyHeight+r.scrollable.scrollHeight,p=d/h,f=r.store.count,v=0;if(i&&(p-=t.measureElement(i({totalWidth:u,totalPages:-1,currentPage:-1}))),s&&(p-=t.measureElement(s({totalWidth:u,totalPages:-1,currentPage:-1}))),l&&(p-=r.headerHeight,m-=r.headerHeight),a===ih.visible){const e=r.rowManager,n=e.firstVisibleRow,i=e.lastVisibleRow;v=n.top,f=t.getVisibleRowsCount(r),m=m-r.scrollable.scrollHeight+i.bottom-n.top}if(o&&!l&&a!==ih.visible){const e=r.rowManager.rowOffsetHeight,t=Math.floor((p-r.headerHeight)/e),n=Math.floor(p/e),i=f-t;g=1+Math.ceil(i/n)}else g=Math.ceil(m/p);Object.assign(n,{scale:h,contentHeight:p,totalRows:f,totalHeight:m,verticalPages:g,initialScroll:v,horizontalPages:1,totalPages:g})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:n}=t,{client:r}=e,i=sh[e.paperFormat],s=e.orientation===oh.portrait,o=s?i.width:i.height,a=s?i.height:i.width,l=t.inchToPx(o),c=t.inchToPx(a);Object.assign(n,{paperWidth:o,paperHeight:a,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,processedRows:new Set}),t.estimateTotalPages(e),t.adjustRowBuffer(r)}async restoreComponent(e){await super.restoreComponent(e),this.restoreRowBuffer(e.client)}async buildPage(e){const t=this,{exportMeta:n}=t,{client:r,headerTpl:i,footerTpl:s,alignRows:o,repeatHeader:a}=e,{totalWidth:l,totalPages:c,currentPage:d,subGrids:u,currentPageTopMargin:h,verticalPosition:g,totalRows:m,contentHeight:p}=n,f=a?0:r.headerHeight,{rowManager:v}=r,{rows:y}=v;Object.values(u).forEach((e=>e.rows=[])),e.rowsRange===ih.all&&(n.totalHeight=r.height-r.bodyHeight+r.scrollable.scrollHeight-t.getVirtualScrollerHeight(r));let b,C,w,S=e.rowsRange===ih.visible?y.findIndex((e=>e.bottom>r.scrollable.y)):y.findIndex((e=>e.bottom+h+f>0));const E=S,D=0===g?0:y[S].top+h+f;i&&(C=t.prepareHTML(i({totalWidth:l,totalPages:c,currentPage:d}))),s&&(w=t.prepareHTML(s({totalWidth:l,totalPages:c,currentPage:d}))),b=p-D,0===g&&(b-=f);let x,R=0;for(;b>0;){const r=y[S];o&&b<r.offsetHeight?(R=-b,b=0):(t.collectRow(r),b-=r.offsetHeight,b>0&&n.processedRows.add(r.dataIndex),x=r.dataIndex,(++S===y.length&&b>0||e.rowsRange===ih.visible&&S-E===m)&&(b=0))}const T=y[S-1];if(T&&(n.exactGridHeight=T.bottom+r.footerContainer.offsetHeight+r.headerContainer.offsetHeight),await t.onRowsCollected(y.slice(E,S),e),e.rowsRange===ih.visible)n.scrollableTopMargin=r.scrollable.y;else{const e=v.on("offsetrows",(({offset:e})=>R+=e));await t.scrollRowIntoView(r,x+1),e()}return{html:t.buildPageHtml(),header:C,footer:w,offset:R}}async onRowsCollected(){}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach((([e,n])=>{t[e].rows.push(n.outerHTML)}))}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:n})=>{const r=e.outerHTML;t=t.replace(r,n.join(""))})),t}}fh.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:n,stylesheets:r}=t,{totalWidth:i,paperWidth:s,paperHeight:o,contentHeight:a,scale:l,initialScroll:c}=n;let d,{totalPages:u}=n;for(;(d=n.currentPage)<u;){t.trigger("exportStep",{text:t.L(fh.exportingPageText,{currentPage:d,totalPages:u}),progress:Math.round((d+1)/u*90)});const{html:h,header:g,footer:m,offset:p}=await t.buildPage(e),f=[...r,`\n                <style>\n                    #${e.client.id} {\n                        width: ${i}px !important;\n                    }\n                    .b-export .b-export-content {\n                        transform: scale(${l});\n                        transform-origin: top left;\n                        height: auto;\n                    }\n                </style>\n            `];if(e.repeatHeader){const t=n.exactGridHeight?`${n.exactGridHeight+n.currentPageTopMargin}px`:"100%";f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t} !important;\n                    }\n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    .b-export-body {\n                        height: 100%;\n                        display: flex;\n                    }\n                    .b-export-viewport {\n                        height: 100%;\n                    }\n                    .b-grid-vertical-scroller {\n                        margin-top: ${n.currentPageTopMargin-c}px;\n                    }\n                </style>\n                `)}else{const t=n.exactGridHeight||a-n.currentPageTopMargin;f.push(`\n                <style>\n                    #${e.client.id} {\n                        height: ${t}px !important;\n                    }\n                    .b-export-body {\n                        overflow: hidden;\n                    }\n                    .b-export .b-export-content {\n                        height: ${100/l}%;\n                    }\n                    .b-export-body .b-export-viewport {\n                        margin-top: ${n.currentPageTopMargin}px;\n                    }\n                    .b-grid-vertical-scroller {\n                        margin-top: -${c}px;\n                    }\n                </style>\n                `)}n.currentPageTopMargin-=a+p,await t.stateNextPage(e),({totalPages:u}=n),yield{html:t.pageTpl({html:h,header:g,footer:m,styles:f,paperWidth:s,paperHeight:o})}}},fh._$name="MultiPageVerticalExporter";class vh extends mh{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e){let t=0;return e.map((([e,n])=>{const r=e.replace(/translate\(\d+px, \d+px\)/,`translate(0px, ${t}px)`);return t+=n,r}))}collectRow(e){const t=this.exportMeta.subGrids;Object.entries(e.elements).forEach((([n,r])=>{t[n].rows.push([r.outerHTML,e.offsetHeight])}))}buildPageHtml(){const e=this,{subGrids:t}=e.exportMeta;let n=e.prepareExportElement();return Object.values(t).forEach((({placeHolder:t,rows:r})=>{const i=t.outerHTML;n=n.replace(i,e.positionRows(r).join(""))})),n}}vh.prototype.pagesExtractor=async function*(e){const t=this,{client:n}=e,{rowManager:i,store:s}=n,o=t.stylesheets,a=e.orientation===oh.portrait,l=sh[e.paperFormat],c=a?l.width:l.height,d=a?l.height:l.width,u=e.rowsRange===ih.visible&&s.count?t.getVisibleRowsCount(n):s.count;let h,g,{totalHeight:m,totalWidth:p}=t.exportMeta,f=0,v=-1;if(i.rows.length>0)for(e.rowsRange===ih.visible&&(v=i.firstVisibleRow.dataIndex-1);f<u;){const r=i.rows,s=r[r.length-1],o=f;r.forEach((e=>{e.dataIndex>v&&f<u&&(++f,m+=e.offsetHeight,t.collectRow(e))}));const a=r.findIndex((e=>e.dataIndex===v+1)),l=a+(f-o);await t.onRowsCollected(r.slice(a,l),e),f<u&&(v=s.dataIndex,await t.scrollRowIntoView(n,v+1))}const y=t.buildPageHtml();m+=n.height-n.bodyHeight;const b=m;if(e.headerTpl){h=t.prepareHTML(e.headerTpl({totalWidth:p}));const n=t.measureElement(h);m+=n}if(e.footerTpl){g=t.prepareHTML(e.footerTpl({totalWidth:p}));const n=t.measureElement(g);m+=n}const C=Math.min(1,t.getScaleValue(t.inchToPx(c),p)),w=Math.min(1,t.getScaleValue(t.inchToPx(d),m)),S=Math.min(C,w);o.push(`<style>\n                #${n.id} {\n                    height: ${b}px !important;\n                    width: ${p}px !important;\n                }\n                .b-export-content {\n                    ${t.centerContentHorizontally?"left: 50%;":""}\n                    transform: scale(${S}) ${t.centerContentHorizontally?"translateX(-50%)":""};\n                    transform-origin: top left;\n                    height: ${1===S?"inherit":"auto !important"};\n                }\n            </style>`),r.isIE11&&o.push(`<style>\n                .b-export-body {\n                   min-height: ${b}px !important;\n                }\n         </style>`),yield{html:t.pageTpl({html:y,header:h,footer:g,styles:o,paperWidth:c,paperHeight:d})}},vh._$name="SinglePageExporter";class yh extends uo{static get $name(){return"PdfExport"}static get defaultConfig(){return{exportServer:n,fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[vh,ph,fh],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",localizableProperties:["exportMask","exportProgressMask"]}}doDestroy(){this.exportDialog&&this.exportDialog.destroy(),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:n}=t,{type:r}=e;let i;if(n.has(r))i=n.get(r);else{const s=this.exporters.find((e=>e.type===r));if(!s)throw new Error(`Exporter type ${r} is not found. Make sure you've configured it`);delete(e=Ot.clone(e)).type,i=new s(e),i.relayAll(t),n.set(r,i)}return i}buildRequest(e,t){return{html:JSON.stringify(e),fileFormat:t.fileFormat,format:t.paperFormat,orientation:t.orientation}}buildExportConfig(e={}){const{client:t,exportServer:n,clientURL:r,fileFormat:i,fileName:s,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,exporters:h,translateURLsToAbsolute:g,keepPathName:m,sendAsBinary:p,headerTpl:f,footerTpl:v}=this;e.columns||(e.columns=t.columns.visibleColumns.map((e=>e.id)));const y=Ot.assign({client:t,exportServer:n,clientURL:r,fileFormat:i,paperFormat:o,rowsRange:a,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:g,keepPathName:m,sendAsBinary:p,headerTpl:f,footerTpl:v,exporterType:h[0].type,fileName:s||t.$$name},e);if("multipagevertical"!==y.exporterType&&(y.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(y.alignRows=!0),!("keepRegionSizes"in e)&&!y.keepRegionSizes){const e=[],n={};t.eachSubGrid((t=>t.collapsed&&e.push(t.region))),e.length&&(t.eachSubGrid((t=>{e.includes(t.region)||(n[t.region]=!0)})),y.keepRegionSizes=n)}return y}async export(e={}){const t=this,{client:n,pagesPerRequest:r}=t;let i;if((e=t.buildExportConfig(e)).exporterConfig=Ot.assign({type:e.exporterType,translateURLsToAbsolute:e.translateURLsToAbsolute,keepPathName:e.keepPathName},e.exporterConfig||{}),!1!==n.trigger("beforeExport",e)){n.mask(t.exportMask);try{const s=t.getExporter(e.exporterConfig);if(0===r){const n=await s.export(e);t.trigger("exportStep",{progress:90,text:t.exportProgressMask});const r=await t.receiveExportContent(n,e);i={response:r},await t.processExportContent(r,e)}}catch(e){throw i=e instanceof Response?{response:e}:{error:e},e}finally{t.exportDialog&&t.exportDialog.close(),n.unmask(),t.trigger("export",i),i.error?Yl.show({html:t.L("L{Export failed}"),rootElement:this.rootElement}):i.response.ok||Yl.show({html:t.L("L{Server error}"),rootElement:this.rootElement}),n.trigger("export",i)}}return i}async receiveExportContent(e,t){return be.post(t.exportServer,{html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary},Object.assign({credentials:"omit"},this.fetchOptions))}async processExportContent(e,t){const n=this;if(e.ok&&n.openAfterExport){const i=(e=e.clone()).headers.get("content-type");if(i.match(/application\/octet-stream/)){const r=lh[t.fileFormat],i=await n.responseBlobToObjectURL(e,r);n.getDownloadLink(t.fileName,i).click()}else if(i.match(/application\/json/)){const i=await e.json();if(i.success)if(r.isIE11)window.open(i.url,"ExportedPanel");else{n.getDownloadLink(t.fileName,i.url).click()}else Yl.show({html:i.msg,rootElement:this.rootElement})}}}async responseBlobToObjectURL(e,t){const n=await e.blob();return URL.createObjectURL(n.slice(0,n.size,t))}getDownloadLink(e,t){const n=document.createElement("a");return n.download=e,n.href=t,this.openInNewTab&&(n.target="_blank"),n}get defaultExportDialogConfig(){return Ot.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}showExportDialog(){const e=this;return e.exportDialog||(e.exportDialog=gh.new({rootElement:e.rootElement,listeners:{export:e.onExportDialogExport,thisObj:e}},e.defaultExportDialogConfig)),e.exportDialog.show()}onExportDialogExport({values:e}){const t=this;t.mask=new yi({progress:0,maxProgress:100,text:t.exportMask,target:t.exportDialog.element});const n=t.on({export(){t.mask.close(),n()},exportstep({progress:e,text:n}){t.mask.progress=e,null!=n&&(t.mask.text=n)}});t.currentExportPromise=t.export(e),t.currentExportPromise.then((()=>t.currentExportPromise=null))}}yh._$name="PdfExport",Tu.registerFeature(yh,!1,"Grid");class bh extends me{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"Â Â Â Â "}}export(e={}){const t=this;return e=Ot.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter((e=>!1!==e.exportable));e.columns=t.map((e=>"string"==typeof e?this.target.columns.find((t=>t.field===e))||{field:e}:e))}generateColumns(e){return e.columns.map((t=>this.processColumn(t,e)))}generateRows(e){const{columns:t}=e;if(!t.length)return[];const n=this,{target:r}=n;return r.store.map((r=>n.processRecord(r,t,e))).filter((e=>null==e?void 0:e.length))}getColumnType(e,t=this.target.store){let r=e.exportedType||"object";if(e.exportedType===n&&e.field){const n=t.modelClass.getFieldDefinition(e.field);n&&"auto"!==n.type&&(r=n.type)}return r}processColumn(e,t){const{target:n}=this,{defaultColumnWidth:r}=t;let{field:i,text:s,width:o,minWidth:a}=e;if(i in n.store.modelClass.fieldMap||(i=""),!s||!o){const e=n.columns.find((e=>e.field===i));s||(s=e&&e.text||i),null==o&&(o=e&&e.width||r)}return o=Math.max(o||r,a||r),{field:i,value:s,width:o,type:this.getColumnType(e)}}processRecord(e,t,n){const{target:r}=this,{showGroupHeader:i,indent:s,indentationSymbol:o}=n;let a;return e?e.isSpecialRow?i&&e.meta.groupRowFor&&(a=t.map((t=>r.features.group.buildGroupHeader({cellElement:er.createElement(),grid:r,record:e,column:t})))):a=t.map((t=>{var i;let a=null!==(i=t.field)&&void 0!==i&&i.includes(".")?e.get(t.field):e[t.field],l=t.renderer||t.defaultRenderer;return!l||a&&t.isDateColumn&&n.exportDateAsInstance||(a=l.call(t,{value:a,record:e,column:t,grid:r,isExport:!0})),s&&t.tree&&(a=`${o.repeat(e.childLevel)}${a}`),a})):a=t.map((()=>"")),a}}bh._$name="TableExporter";class Ch{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"âœ“":""}}Ch._$name="BooleanUnicodeSymbol";class wh extends uo{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:bh,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return e===n||null===e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:n,columns:r}=t.exporter.export(e.exporterConfig);return{rows:n.map((n=>n.map(((n,i)=>{var s;n instanceof Date?n=Mt.format(n,e.dateFormat):"boolean"==typeof n&&(n=new Ch(n)),t.convertEmptyValueToEmptyString&&(n=t.processValue(n));return{value:n,type:"number"===(null===(s=r[i])||void 0===s?void 0:s.type)?"number":"string"}})))),columns:r.map((e=>{let{field:t,value:n,width:r,type:i}=e;return i="string",{field:t,value:n,width:r,type:i}}))}}export(e={}){const t=this,n=t.zipcelx||window.zipcelx;if(!n)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;(e=Ot.assign({},t.config,e)).filename||(e.filename=t.client.$$name);const{filename:r}=e,{rows:i,columns:s}=t.generateExportData(e);n({filename:r,sheet:{data:[s].concat(i),cols:s}})}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=window.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}}wh._$name="ExcelExporter",Tu.registerFeature(wh,!1,"Grid");class Sh extends(br(me)){static get configurable(){return{cls:{$config:{equal:(e,t)=>(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)},value:"b-grid-row"}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1},e),super.construct()}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((t=>t.dataset.index=e)))}get id(){return this._id}set id(e){const t=this,n={id:e},r=t.rowManager.idMap;t._id===e&&r[e]===t||(r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e,t.eachElement((t=>{sa.assign(t,n),t.dataset.id=e})),t.eachCell((e=>sa.assign(e,n))))}addElement(e,t){const n=this;let r=t.firstElementChild;for(n._elements[e]=t,n._elementsArray.push(t),n._regions.push(e),sa.assign(t,{index:n.index}),n._cells[e]=[];r;)n._cells[e].push(r),n._allCells.push(r),sa.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:n}),r=r.nextElementSibling;t.dataset.index=n.index}getElement(e){return this._elements[e]}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find((t=>{const n=sa.get(t);return n.columnId===e||n.column===e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(){const e=this;e.rowManager.storeKnownHeight(e.id,e.height),e.lastHeight!==e.height&&(this.eachElement((t=>t.style.height=`${e.offsetHeight}px`)),e.lastHeight=e.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return null!=e&&e.isDomClassList?e:new on(e)}updateCls(e){this.eachElement((t=>er.syncClassList(t,e)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translateElements(e){const t=this,n=t.grid.positionMode;t.lastTop!==t.top&&(t.eachElement((e=>{const r=e.style;"translate"===n?r.transform=`translate(0,${t.top}px)`:"translate3d"===n?r.transform=`translate3d(0,${t.top}px,0)`:"position"===n&&(r.top=`${t.top}px`)})),e||t.rowManager.trigger("translateRow",{row:t}),t.lastTop=t.top)}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,n=!0,r=!1){var i,s,o;const a=this,{cls:l,cells:c,grid:d,rowManager:u,height:h,_id:g}=a,m=sa.get(a._elementsArray[0]),p=u._rowHeight;let f,v,y=0;t||!1===t||(t=d.store.getById(m.id),e=d.store.indexOf(t));const b=null===(i=t)||void 0===i?void 0:i.cls,C=b?b.isDomClassList?b:new on(b):null;l.assign({"b-grid-row-updating":n&&d.transitionDuration,"b-selected":d.isSelected(null===(s=t)||void 0===s?void 0:s.id)}),a.lastRecordCls&&l.remove(a.lastRecordCls),C?(l.add(C),a.lastRecordCls=Object.assign({},C)):a.lastRecordCls=null,a.updateCls(l),u.trigger("beforeRenderRow",{row:a,record:t,recordIndex:e,oldId:g}),n&&d.transitionDuration&&a.setTimeout((()=>{l.remove("b-grid-row-updating"),a.updateCls(l)}),d.transitionDuration),a.id=t.id,a.dataIndex=e;const w=!d.fixedRowHeight&&d.getRowHeight(t)||p;let S=a.maxRequestedHeight=null;for(y=0;y<c.length;y++)f=c[y],v=a.renderCell({cellElement:f,record:t,height:w,maxRequestedHeight:S,updatingSingleRow:n}),u.fixedRowHeight||null!=v.height&&(a.maxRequestedHeight=S=Math.max(S,v.height));a.height=null!==(o=S)&&void 0!==o?o:w,a.updateElementsHeight(),n&&(h!==a.height&&u.translateFromRow(a,r),u.trigger("updateRow",{row:a,record:t,recordIndex:e,oldId:g}),u.trigger("renderDone")),u.trigger("renderRow",{row:a,record:t,recordIndex:e,oldId:g}),a.forceInnerHTML=!1}renderCell({cellElement:e,record:t,height:i,maxRequestedHeight:s,updatingSingleRow:o=!0,isMeasuring:a=!1}){var l;const c=this,{grid:d}=c,u=sa.get(e),h=d.columns.getById(u.columnId),g=u.rowElement,m=sa.get(g),{internalCellCls:p,cellCls:f,align:v,renderer:y,defaultRenderer:b,id:C}=h,w={columnId:C,id:m.id};if(!t){if(null===m.id)return void(e.className="b-grid-cell");if(!(t=d.store.getById(m.id)))return}let S=h.getRawValue(t);const E=t.fieldMap[h.field],D={configuredHeight:i,height:null,maxRequestedHeight:s},x={cellElement:e,dataField:E,rowElement:g,value:S,record:t,column:h,size:D,grid:d,row:u.row,updatingSingleRow:o,isMeasuring:a},R={"b-grid-cell":1,[p]:p,[f]:t.isSpecialRow&&"b-check-cell"===h.internalCellCls?n:f,"b-cell-dirty":t.isFieldModified(h.field),[`b-grid-cell-align-${v}`]:v,"b-selected":d.isSelected(w),"b-focused":d.isFocused(w),"b-auto-height":h.autoHeight},T=y||b;er.syncClassList(e,R);let M=!0;T?(S=T.call(h,x),S===n&&(M=!1)):E&&(S=E.print(S));const F=null===(l=d.hasFrameworkRenderer)||void 0===l?void 0:l.call(d,{cellContent:S,column:h});F&&t.isSpecialRow&&(S="");const A=F&&!h.data.tree&&!t.isSpecialRow;if(M&&!A){const t=null!=S&&"object"==typeof S,n="string"==typeof S,i=t||null==S?"":String(S);c.forceInnerHTML&&(e.innerHTML="",delete e._content,e.lastDomConfig=null),t||!h.htmlEncode||h.disableHtmlEncode?!h.autoSyncHtml||n&&!er.getChildElementCount(e)?t?Ur.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.isArray(S)?S:[S]}}):e._content!==i&&(e.innerHTML=e._content=i):n?er.sync(i,e.firstElementChild):t&&Ur.sync({domConfig:S,targetElement:e}):r.isLinux||e._hasHtml?(e.innerText=i,e._hasHtml=!1):er.setInnerText(e,i)}var I;t.isSpecialRow||(null===(I=d.processCellContent)||void 0===I||I.call(d,{cellElementData:u,rendererData:x,rendererHtml:x.rendererHtml||S}));return h.autoHeight&&null==D.height&&(e.classList.add("b-measuring-auto-height"),D.height=e.offsetHeight,e.classList.remove("b-measuring-auto-height")),a||c.rowManager.trigger("renderCell",x),D}}Sh._$name="Row";class Eh extends ki{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this;let t,n=!1;e.columns.traverse((i=>{const s=e.getBarCellElement(i.id),o=er.setLength(i.width),a=er.setLength(i.minWidth);if(s){if(t=r.isIE11?`calc(${o} - ${e.getLrPadding(s)}px)`:o,n=n||Boolean(i.flex),i.isParent&&null==i.width&&null==i.flex){const e=i.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);s.style.flex=e>0?`${e} 0 auto`:"",e>0&&i.traverse((e=>e.data.minWidth=null))}else if(parseInt(i.minWidth)>=0&&(s.style.minWidth=a),s.style.flex=s.style.flexBasis=s.style.width="",i.flex)!isNaN(parseInt(i.flex))&&i.children?s.style.flex=`${i.flex} 0 auto`:s.style.flex=i.flex;else if(parseInt(i.width)>=0){const n=i.parent;!e.isHeader||n.isRoot||n.width?s.style.flexBasis=t:s.style.width=o}i.height>=0&&(s.style.height=er.setLength(i.height))}})),e.element.classList[n?"add":"remove"]("b-has-flex")}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}Eh.initClass(),Eh._$name="Bar";class Dh extends Eh{static get $name(){return"Footer"}static get type(){return"gridfooter"}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return Ul.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>e.hidden?"":Ul.tpl`
                <div
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}"
                    data-column="${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    >
                    ${e.footerText||""}
                </div>`)).join("")}fixFooterWidths(){this.fixCellWidths()}}Dh.initClass(),Dh._$name="Footer";class xh extends uo{static get pluginConfig(){return{chain:["getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement","destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach((e=>e.destroy())),super.doDestroy()}initWithHeight(e,t=!1){const n=this;return n.autoHeight&&(e=n.store.allCount*n.preciseRowOffsetHeight),n.viewHeight=e,n.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const n=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:r}=t;r&&(r.dataIndex=t.topIndex,r.setTop(n,!0)),t.estimateTotalHeight(),t.renderFromRow(r)}matchRowCount(e=!1){const t=this,{rows:n,grid:r}=t,i=n.length,s=i-t.rowCount;if(s)if(s<0){const s=[];for(let e=i,o=i?n[i-1].dataIndex+1:0;e<t.rowCount;e++,o++)s.push(new Sh({rowManager:t,grid:r,index:e,dataIndex:o}));n.push.apply(n,s),t.trigger("addRows",{rows:s}),e||t.renderFromRow(n[Math.max(0,i-1)])}else{const e=n.splice(i-s,s);t.trigger("removeRows",{rows:e}),e.forEach((e=>e.destroy()))}}calculateRowCount(e=!1,t=!0,n=!1){var r;const i=this,{store:s}=i,o=Math.ceil(i.viewHeight/i.minRowOffsetHeight),a=o+i.prependRowBuffer+i.appendRowBuffer;return null===(r=i.grid.columns)||void 0===r||!r.count||isNaN(o)?(i.rowCount=0,0):(a<i.rowCount&&!t||(i.visibleRowCount=o,i.rowCount=Math.min(s.count,a),e||(i.rows&&i.rowCount!==i.rows.length?i.matchRowCount(n):i.rowCount||i.trigger("changeTotalHeight",{totalHeight:i.totalHeight}),i.grid.toggleEmptyText())),i.rowCount)}removeAllRows(){const e=this,{topRow:t}=e,n=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,r=e.rows.slice();return e.trigger("removeRows",{rows:r}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},n}setPosition(e){const{topRow:t}=this,{topRowIndex:n,topRowTop:r}=e;t.setTop(r),t.dataIndex=n}get store(){return this.client.store}get rows(){return this._rows}getRow(e){return this.rowCount&&this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=nn.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=er.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find((e=>e.bottom>this.grid.scrollable.y))}get firstFullyVisibleRow(){return this.rows.find((e=>e.top>=this.grid.scrollable.y))}get lastVisibleRow(){const e=this.grid;return Ce.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:n}=t;for(let r=0;r<n;r++)t[r].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:n,fixedRowHeight:r}=t,i=t.rowHeight;if(Ot.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,r&&(t.averageRowHeight=e),t.rows.length){const s=n.scrollable.y,o=t.getRowAt(s,!0),a=o?o.top-s:0;let l,c;r?(l=e,c=i):(c=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+n._rowBorderHeight),!0),t.refresh();s*(l/c)!==s&&n.scrollRowIntoView(o.id,{block:"start",edgeOffset:a})}t.trigger("rowHeight",{height:e})}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const n=this,{heightMap:r}=n;n.fixedRowHeight||(r.has(e)&&(n.totalKnownHeight-=r.get(e)),r.set(e,t),n.totalKnownHeight+=t,t<n.minRowHeight&&(n.minRowHeight=t),n.averageRowHeight=n.totalKnownHeight/r.size)}getOffsetHeight(e){const t=this;return(t.heightMap.get(e.id)||t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:n}=t;Array.isArray(e)||(e=[e]),e.forEach((e=>{e&&n.has(e.id)&&(t.totalKnownHeight-=n.get(e.id),n.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/n.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let n=0;for(let r=0;r<e;r++){const e=t.getAt(r);n+=this.getOffsetHeight(e)}return Math.floor(n)}getRecordCoords(e,t=!1,n=!1){const r=this,i="string"==typeof e||"number"==typeof e?e:e.id,s=r.getRowById(e);let o=r.client._bodyRectangle;return t||(o=r.client._bodyRectangle=nn.client(r.client.bodyContainer)),s?new nn(o.x,t?Math.round(s.top):Math.round(s.top+o.y-r.client.scrollable.y),o.width,s.offsetHeight):r.getRecordCoordsByIndex(r.store.indexOf(i),t,n)}getRecordCoordsByIndex(e,t=!1,n=!1){const r=this,{topRow:i,bottomRow:s}=r,o=r.client._bodyRectangle,{id:a}=r.store.getAt(e),l=r.preciseRowOffsetHeight,c=i.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:i.top,from:"topRow"}:{index:e,y:0,from:"top"},h=r.allHeightsKnown&&!n?r.calculateTop(e):Math.floor(u.y+u.index*l),g=new nn(o.x,t?h:h+o.y-r.client.scrollable.y,o.width,Math.floor(r.heightMap.get(a)||l));return g.virtual=!0,g.block=g.bottom<o.y?"start":g.y>o.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const n=this.getRowFor(e);if(n){const e=n.getCell(t);if(e)return n.renderCell({cellElement:e}),!0}return!1}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:n,store:r}=t,i=r.count;if(0===t.calculateRowCount(!1,i<n.length,!0))return;let s,o=e?n.indexOf(e):0,a=e?e.dataIndex:n[0].dataIndex,l=i-a-1,c=Math.min(n.length-1,o+l),d=n.length-c-1,u=o>0?n[o-1].bottom:n[o].top;for(let e=o;e<=c;e++)s=n[e],s.dataIndex=a,s.setTop(u,!0),s.render(a,r.getAt(a++),!1),u+=s.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,n=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const r of e)t=r.height,r.render(null,null,!1),n|=r.height!==t;n&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const n=this;let r,i,s=e.bottom;for(i=e.dataIndex+1,r=n.getRow(i);r;r=n.getRow(++i))r.setTop(s),s+=r.offsetHeight;t||n.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;t&&(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const n=this,{store:r,heightMap:i}=n,s=r.count;if(n.allHeightsKnown&&!n.fixedRowHeight){const t=e-n.prependBufferHeight,o=n.grid._rowBorderHeight;let a=0,l=0;for(;a<t;){const e=r.getAt(l);a+=i.get(e.id)+o,l++}const c=Math.max(Math.min(l,s-n.rowCount),0);n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=c,n.topRow.setTop(n.calculateTop(c),!1),n.refresh()}else{const r=n.preciseRowOffsetHeight,i=null==t?Math.floor(e/r)-n.prependRowBuffer:t-Math.floor(n.rowCount/2),o=Math.max(Math.min(i,s-n.rowCount),0),a=n.client.scrollable.y,l=Math.min(n.client._bodyRectangle.height+a+n.appendBufferHeight,n.totalHeight);if(n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=o,n.topRow.setTop(Math.floor(o*r),!1),n.refresh(),n.bottomRow.bottom<l)for(n.calculateRowCount(!1,!1,!1);n.bottomRow.bottom<l&&n._rows[n.prependRowBuffer].top<a&&n.bottomRow.dataIndex<s-1;)n.displayRecordAtBottom();n.estimateTotalHeight()}if(null!=t){const{scrollable:r}=n.grid,i=n.getRow(t),s=i&&nn.from(i._elementsArray[0]).center.y,o=r.viewport.center.y;i&&(r.y=e=Math.floor(r.y+(s-o)))}return e}warpIfNeeded(e){const t=this,n={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(n.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),n.newScrollTop=t.jumpToPosition(e,r),n.deltaTop=0}return n}updateRenderedRows(e,t,n=!1){const r=this,i=r.client._bodyRectangle;if(0===r.rowCount)return 0;let s=r.totalHeight;if(t||Math.abs(e-r.lastScrollTop)>=r.rowOffsetHeight||r.topRow.top>e||r.bottomRow.bottom<e+i.height){const t=r.warpIfNeeded(e);r.scrollTargetRecordId=null,r.lastScrollTop=t.newScrollTop,t.deltaTop>0?r.fillBelow(t.newScrollTop):t.deltaTop<0&&r.fillAbove(t.newScrollTop),r.fixedRowHeight||n||r.correctError(t,i,e),s=r.estimateTotalHeight()}return s}correctError(e,t,n){const r=this;let i=0;(r.allHeightsKnown||e.deltaTop<0&&n<2*t.height||e.deltaTop>0&&n>r.totalHeight-2*t.height-3)&&(i=r.topRow.top-r.calculateTop(r.topRow.dataIndex)),i&&(r.offsetRows(-i),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-i)}fillAbove(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>n&&t.topIndex>0;)r-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight,r=t.store.count,i=t.rowCount;let s=0;for(;s<n&&t.topIndex+i<r&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const n=t.store.count,r=n-t.heightMap.size,{bottomRow:i}=t;let s;if(t.fixedRowHeight)s=n*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+r*t.preciseRowOffsetHeight,i&&r){const e=i.bottom;(e>s||t.topIndex+t.rowCount>=n&&s>e&&e>0)&&(s=e,i.dataIndex<n-1&&(s+=(n-1-i.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})&&(t._totalHeight=s),s}displayRecordAtTop(){const e=this,t=e.topIndex-1,n=e.store.getAt(t),r=e.bottomRow,i=r.top;return e.trigger("beforeTranslateRow",{row:r,newRecord:n}),r._top=e.topRow.top-e.getOffsetHeight(n),r.estimatedTop=!e.fixedRowHeight,r.render(t,n,!1),r._top=i,r.setBottom(e.topRow.top),r.estimatedTop=!1,e.topIndex--,e._rows.unshift(e._rows.pop()),r.offsetHeight}displayRecordAtBottom(){const e=this,t=e.topIndex+e.rowCount,n=e.store.getAt(t),r=e.topRow;return e.trigger("beforeTranslateRow",{row:r,newRecord:n}),r.dataIndex=t,r.setTop(e.bottomRow.bottom),r.render(t,n,!1),e.topIndex++,e._rows.push(e._rows.shift()),r.offsetHeight}}xh.featureClass="",xh._$name="RowManager";const Rh={x:1};class Th extends si{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=Rh){"string"==typeof t&&(t={[t]:1}),t.x&&this.xScrollers.forEach(((t,n)=>t.addPartner(e.xScrollers[n],"x"))),t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach(((t,n)=>{t.isDestroyed||t.removePartner(e.xScrollers[n])})),super.removePartner(e)}updateOverflowX(e){this.xScrollers&&this.xScrollers.forEach((t=>t.overflowX=e)),this.widget.virtualScrollers.classList[!1===e?"add":"remove"]("b-hide-display")}scrollIntoView(e,t){if(e.nodeType!==Element.ELEMENT_NODE)return super.scrollIntoView(e,t);for(const n of this.xScrollers)if(n.element.contains(e))return n.scrollIntoView(e,t)}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}}Th._$name="GridScroller";class Mh extends Eh{static get $name(){return"Header"}static get type(){return"gridheader"}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){return this.subGrid&&this.subGrid.region}template(){const e=this.region;return Ul.tpl`
            <div class="b-grid-header-scroller b-grid-header-scroller-${e}">
                <div data-reference="headersElement" class="b-grid-headers b-grid-headers-${e}" data-region="${e}" data-max-depth="${this.maxDepth}" data-reference="headersElement"></div>
            </div>
        `}get overflowElement(){return this.headersElement}contentTemplate(e){const t=this;return e.hidden?"":Ul.tpl`
                <div class="b-grid-header" data-column="${e.field||""}" data-column-id="${e.id}" ${e.isFocusable?'tabindex="0"':""} ${e.tooltip?`data-btip="${e.tooltip}"`:""}>
                    <div class="b-grid-header-text">
                        <div class="b-grid-header-text-content"></div>
                    </div>
                    ${e.children?`\n                    <div class="b-grid-header-children">\n                            ${e.children.map((e=>t.contentTemplate(e))).join("")}\n                    </div>\n                    `:""}
                    <div class="b-grid-header-resize-handle"></div>
                </div>
            `}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>{const n=e.getBarCellElement(t.id);if(n){const r=new on({"b-grid-header":1,"b-grid-header-parent":t.isParent,[`b-level-${t.childLevel}`]:1,[`b-depth-${t.meta.depth}`]:1,[`b-grid-header-align-${t.align}`]:t.align,"b-grid-header-resizable":t.resizable&&t.isLeaf,[t.cls]:t.cls,"b-last-parent":t.isParent&&t.isLastInSubGrid,"b-last-leaf":t.isLeaf&&t.isLastInSubGrid});let i=t.headerText;n.className=r,t.headerRenderer&&(i=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:n})),t.icon&&(i=`<i class="${A.encodeHtml(t.icon)}"></i>`+(i||""));const s=n.querySelector(".b-grid-header-text-content");s&&(s.innerHTML=i||"")}})),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.on({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){let n=this,r=0;t&&t.meta&&t.meta.depth++;for(const i of e)i.meta.depth=0,i.children&&(n.initDepths(i.children.filter(n.columns.chainedFilterFn),i),i.meta.depth&&t&&(t.meta.depth+=i.meta.depth)),i.meta.depth>r&&(r=i.meta.depth);return t||(n.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;e.content=e.columns.topColumns.map((t=>e.contentTemplate(t))).join(""),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}}Mh.initClass(),Mh._$name="Header";const Fh={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keydown:"onElementKeyDown",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu"};var Ah=e=>class extends(e||me){static get $name(){return"GridElementEvents"}static get configurable(){return{longPressTime:400,enableUndoRedoKeys:!0}}initInternalEvents(){const e=Object.keys(Fh),t=e.length,n={element:this.bodyElement,thisObj:this};for(let r=0;r<t;r++)n[e[r]]="handleEvent";Tr.on(n),Tr.on({focus:"onGridElementFocus",element:this.focusElement,thisObj:this})}getCellDataFromEvent(e){const t=this,n=er.up(e.target,".b-grid-cell");if(n){const e=sa.get(n),{id:r,columnId:i}=e,s=t.store.getById(r),o=t.columns.getById(i);return s?{cellElement:n,cellData:e,columnId:i,id:r,record:s,column:o,cellSelector:{id:r,columnId:i}}:null}}getHeaderDataFromEvent(e){const t=er.up(e.target,".b-grid-header");if(t){const e=Ot.assign({},t.dataset),{columnId:n}=e,r=this.columns.getById(n);return r?{headerElement:t,headerData:e,columnId:n,column:r}:null}}handleEvent(e){this.disabled||Fh[e.type]&&this[Fh[e.type]](e)}onElementTouchStart(e){const t=this,n=t.getCellDataFromEvent(e);er.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime)),n&&!e.defaultPrevented&&t.onFocusGesture(n,e)}onElementTouchMove(e){const t=this;t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t){const n=this,r=n.getCellDataFromEvent(t);if(r){const s=n.columns.getById(r.columnId),o={grid:n,record:r.record,column:s,cellSelector:r.cellSelector,cellElement:r.cellElement,target:t.target,event:t};var i;if(n.trigger("cell"+A.capitalize(e),o),"click"===e)null===(i=s.onCellClick)||void 0===i||i.call(s,o)}}onElementMouseDown(e){const t=this,n=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e),n&&!e.defaultPrevented&&t.onFocusGesture(n,e))}isScrollbarClick({target:e,x:t,y:n}){if(e.matches(".b-vertical-overflow")){return t>e.getBoundingClientRect().right-er.scrollBarWidth}if(e.matches(".b-horizontal-overflow")){return n>e.getBoundingClientRect().bottom-er.scrollBarWidth}}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,n=t.getCellDataFromEvent(e);n&&(t.triggerCellMouseEvent("click",e),sa.get(n.cellElement).row.removeCls("b-hover"))}onFocusGesture(e,t){e&&!t.target.matches(".b-icon-tree-expand, .b-icon-tree-collapse")&&this.focusCell(e.cellSelector,{scroll:!1,doSelect:!0,event:t})}onElementDblClick(e){const{target:t}=e;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){const e=er.up(t,".b-grid-header");this.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t=er.up(e.target,".b-grid-cell");if(t){const n=sa.get(t).row;!n||"number"==typeof e.buttons&&0!==e.buttons||(this.hoveredRow=n),this.triggerCellMouseEvent("mouseOver",e)}this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){if(this.hoveredRow=null,!this.scrolling){er.up(e.target,".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",e),this.trigger("mouseOut",{event:e})}}set hoveredRow(e){const t=this;t._hoveredRow&&!t._hoveredRow.isDestroyed&&(t._hoveredRow.removeCls("b-hover"),t._hoveredRow=null),e&&!t.scrolling&&(t._hoveredRow=e,e.addCls("b-hover"))}onElementKeyDown(e){var t;const n=this,{target:i,currentTarget:s,ctrlKey:o,key:a}=e;if(e.handled)return;const l=n.focusedCell,c=n.store.stm;if(c&&o&&"z"===a.toLowerCase()&&n.enableUndoRedoKeys&&(null===(t=n.features.cellEdit)||void 0===t||!t.isEditing)&&c.onUndoKeyPress(e),i.matches(".b-grid-header.b-depth-0"))n.handleHeaderKeyDown(e);else if(i===n.focusElement||r.isIE11&&s===n.focusElement){if(n.handleViewKeyDown(e),l){var d;const t=l.element,r=n.columns.getById(t.dataset.columnId);null===(d=r.onCellKeyDown)||void 0===d||d.call(r,{event:e,cellElement:t})," "===a&&r.onCellClick&&r.onCellClick({grid:n,column:r,record:n.store.getById(l.id),cellElement:t,target:i,event:e})}}else if("Escape"===a&&n.isActionableLocation){const e=Ot.clone(l);e.element=null,n.focusCell(e),er.focusWithoutScrolling(n.element)}}handleViewKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":return e.preventDefault(),t.navigateLeft(e);case"ArrowRight":return e.preventDefault(),t.navigateRight(e);case"ArrowUp":return e.preventDefault(),t.navigateUp(e);case"ArrowDown":return e.preventDefault(),t.navigateDown(e)}}handleHeaderKeyDown(e){const t=this,n=t.columns.getById(e.target.dataset.columnId);switch(n.onKeyDown&&n.onKeyDown(e),e.key){case"ArrowLeft":t.onHeaderLeftKey(n);break;case"ArrowRight":t.onHeaderRightKey(n);break;case"ArrowDown":e.preventDefault(),t.onHeaderDownKey(n);break;case"Enter":t.onHeaderEnterKey(n)}}onHeaderLeftKey(e){const t=this.columns.getAdjacentVisibleLeafColumn(e,!1);t&&this.getHeaderElement(t.id).focus()}onHeaderRightKey(e){const t=this.columns.getAdjacentVisibleLeafColumn(e,!0);t&&this.getHeaderElement(t.id).focus()}onHeaderDownKey(e){const t=this.firstFullyVisibleRow;t&&this.focusCell({columnId:e.id,id:t.id})}onHeaderEnterKey(e){this.getHeaderElement(e.id).click()}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,n=t.getCellDataFromEvent(e);n&&(t.triggerCellMouseEvent("contextMenu",e),er.isTouchEvent&&t.onFocusGesture(n,e))}onInternalResize(e,t,n,r,i){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==window.devicePixelRatio&&er.resetScrollBarWidth(),s._devicePixelRatio=window.devicePixelRatio,s._bodyRectangle=nn.client(s.bodyContainer),super.onInternalResize(...arguments),n!==i&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.isPainted&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),t!==r&&s.setTimeout((()=>{s.isDestroyed||s.updateResponsive(t,r)}),0)}get widgetClass(){}};const Ih={string:1,object:1,function:1};var kh=e=>class extends(e||me){static get $name(){return"GridFeatures"}set features(e){const t=this,n=Tu.getInstanceDefaultFeatures(this);e=t._features=Ot.assign({},e),n&&Object.keys(n).forEach((t=>{t in e||(e[t]=!0)}));const r=Tu.getInstanceFeatures(this);for(const n of Object.keys(e)){const i=e[n];if(i){const s=!window.__bryntum_code_editor_changed;if(A.uncapitalize(n)!==n){const e=`Invalid feature name '${n}', must start with a lowercase letter`;if(s)throw new Error(e);console.error(e),t._errorDuringConfiguration=e}const o=r[n];if(!o){const e=`Feature '${n}' not available, make sure you have imported it`;if(s)throw new Error(e);return console.error(e),void(t._errorDuringConfiguration=e)}Reflect.defineProperty(e,n,t.createFeatureInitializer(e,n,o,i))}}}get features(){return this._features}createFeatureInitializer(e,t,n,r){const i=[this],s=n.prototype.construct;return Ih[typeof r]&&(i[1]=r),{configurable:!0,get:()=>(delete e[t],n.prototype.construct=function(...r){e[t]=this,s.apply(this,r),n.prototype.construct=s},new n(...i))}}hasFeature(e){const{features:t}=this;if(t){const t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}get widgetClass(){}};const Oh=Object.freeze({doSelect:!0}),Lh=Object.freeze({x:!1,y:!1});var Ph=e=>class extends(e||me){static get $name(){return"GridNavigation"}get focusedCell(){const e=this._focusedCell;if(e&&this.getCell(e))return e;this.clearFocus()}get isActionableLocation(){const e=this._focusedCell;return Boolean(e&&e.element&&this.getCell(e).contains(e.element))}set focusedCell(e){this.focusCell(e,{doSelect:!1})}get focusedRecord(){if(this._focusedCell)return this.store.getById(this._focusedCell.id)}get cellCSSSelector(){const e=this._focusedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.index}] [data-column-id=${e.columnId}]`:""}onGridElementFocus(e){const t=this,n={doSelect:!1,event:e};if(t._initialFocusedCellContext){const{cellSelector:e,options:n}=t._initialFocusedCellContext;t._focusedCell=null,t.focusCell(e,n),t._initialFocusedCellContext=null}else if(t._focusedCell)t.focusCell(t._focusedCell,n);else{const r=t.element.contains(e.relatedTarget)?null:t.lastFocusedCell;if(r){const e=t.getCell(r);if(!e||!er.isVisible(e)||!t.store.getById(r.id))return void t.revertFocus();t.returningFocus=!0,t.focusCell(r,n),t.returningFocus=!1}else if(!t.scrolling&&!t.skipFocusSelection&&t.store.first){const{mouseMoveEvent:e,rowManager:r,_bodyRectangle:i}=t,s=e&&r.getRowAt(Math.min(Math.max(e.clientY,i.y),i.bottom))||t.firstFullyVisibleRow,o=e&&t.getCellDataFromEvent(e)||{id:s.id,columnId:t.columns.visibleColumns[0].id};t.getCell(o)&&t.focusCell(o,n)}}t.skipFocusSelection=!1}onFocusOut(e){super.onFocusOut(e),this.clearFocus()}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=this.mouseMoveEvent=null}isFocused(e){return Boolean(this._focusedCell)&&this.isLocationEqual(e,this._focusedCell)}focusCell(e,t=Oh){var n,i,s;if(!document.hasFocus()&&r.isMac&&2===(null===(n=t)||void 0===n||null===(i=n.event)||void 0===i?void 0:i.button))return;const o=this,a=er.getActiveElement(o);e=o.normalizeCellContext(e===Object?Object.assign({},e):e);const l=!1!==t.doSelect,{event:c,scroll:d}=t,u=o.lastFocusedCell=o._focusedCell,h=o.isLocationEqual(e,u),g=u&&o.getCell(u),m=o.getSubGridFromColumn(e.columnId);let p=o.getCell(e);if(c&&"mousedown"===c.type)for(let t=c.target;t!==p;t=t.parentElement)if(er.isFocusable(t))return void(e.element=t);if(h)return c&&o.onCellNavigate&&o.onCellNavigate(o,null,o._focusedCell,c,l),e;g&&g.classList.remove("b-focused");const f=p||o.getCell({row:o.rowManager.topIndex,columnId:e.columnId}),v=nn.from(m.element),y=nn.from(o.bodyContainer),b=nn.from(f).moveTo(null,v.y);return!1===d?t=Object.assign({},t,Lh):(t=Object.assign({},t,d),b.width>v.width||b.height>y.height?t.x=t.y=!1:t.column=e.columnId,o.scrollRowIntoView(e.id,t)),a===o.focusElement||o.focusElement.contains(a)||(null===(s=ki.fromElement(a))||void 0===s?void 0:s.owner)===o?(p=o.getCell(e),p&&(e.element=p,p.classList.add("b-focused")),o._focusedCell=e,o.onCellNavigate&&o.onCellNavigate(o,u,o._focusedCell,c,l),o.trigger("navigate",{lastFocusedCell:u,focusedCell:o._focusedCell,event:c}),e):(o._initialFocusedCellContext={cellSelector:e,options:t},er.focusWithoutScrolling(o.focusElement),void(o.isLocationEqual(e,o._focusedCell)||r.isIE11||(o._initialFocusedCellContext=null)))}isLocationEqual(e,t){return e&&t&&e.id===t.id&&e.columnId===t.columnId&&(!e.element||!t.element||e.element===t.element)}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(e){const t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}internalNextPrevCell(e=!0,t){const n=this,r=n._focusedCell;return r?n.focusCell({id:r.id,columnId:n.columns.getAdjacentVisibleLeafColumn(r.columnId,e,!0).id},{doSelect:!0,event:t}):null}navigateRight(e){return this.internalNextPrevCell(!0,e)}navigateLeft(e){return this.internalNextPrevCell(!1,e)}internalNextPrevRow(e,t=!0,n,r=!0){const i=this,s=i._focusedCell;if(!s)return!1;const o=i.store["get"+(e?"Next":"Prev")](s.id,!1,t);return o?i.focusCell({id:o.id,columnId:s.columnId,scroll:{x:!1}},{doSelect:!0,event:n}):!e&&r?(this.clearFocus(),this.getHeaderElement(s.columnId).focus()):void 0}navigateDown(e){return this.internalNextPrevRow(!0,!1,e)}navigateUp(e){return this.internalNextPrevRow(!1,!1,e)}get widgetClass(){}},_h=e=>class extends(e||me){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const t=this,n=Object.keys(Ot.assign({},t.responsiveLevels));let r=null,i=99995,s=null;return n.forEach((n=>{let o=t.responsiveLevels[n];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)s=n;else if(e<o){const t=o-e;t<i&&(i=t,r=n)}})),r||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const n=this,r=n.getClosestBiggerLevel(t),i=n.getClosestBiggerLevel(e);if(0===t||r!==i){const s=n.responsiveLevels[i];["number","string"].includes(typeof s)||n.applyState(s),n.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),n.element.classList.remove("b-responsive-"+r),n.element.classList.add("b-responsive-"+i),n.trigger("responsive",{level:i,width:e,oldLevel:r,oldWidth:t})}}get widgetClass(){}};const $h={string:1,number:1},Hh={dataset:1,batch:1};var jh=e=>class extends(e||me){static get $name(){return"GridSelection"}static get defaultConfig(){return{selectionMode:{row:!0,cell:!0,rowCheckboxSelection:!1,multiSelect:!0,checkbox:!1,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0},selectedRecordCollection:{}}}afterConfigure(){const e=this;if(e.selectionMode.checkbox){const t=au.getColumnClass("check");if(!t)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const n=e.checkboxColumn=new t({id:`${e.id}-selection-column`,width:"4em",minWidth:"4em",field:null,cellCls:"b-checkbox-selection",region:e.items[0].region,showCheckAll:e.selectionMode.showCheckAll},e.columns);n.isSelectionColumn=!0,n.meta.depth=0,n._grid=e;const r=n.renderer;n.renderer=t=>{t.value=e.isSelected(t.record),r.call(n,t)},n.on({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:e});const i=e.columns.indexOf(e.columns.findRecord("type","rownumber"))+1;e.columns.insert(i,n)}super.afterConfigure()}bindStore(e){var t;this.detachListeners("selectionStoreFilter"),e.on({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null===(t=super.bindStore)||void 0===t||t.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({records:e}){if(this.selectionMode.deselectFilteredOutRecords){const{filtersFunction:e}=this.store,t=this.selectedRecordCollection.values.filter((t=>!e(t)));this.selectedRecordCollection.remove(t)}}onStoreRecordIdChange({record:e,oldValue:t}){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onSelectedRecordCollectionChange({source:e,action:t,added:n=[],removed:r}){const i=this;i._selectedCell&&!i.isSelectable(i._selectedCell)&&i.deselectCell(i._selectedCell),n=n.filter((e=>i.isSelectable(e))),i.triggerChangeEvent({mode:"row",action:n.length?"select":"deselect",selection:i.selectedRecords,selected:n,deselected:r},i.silent)}onCheckChange({source:e,checked:t,record:n}){const r=this,{selectionMode:i,store:s}=r,o=[n,...i.includeChildren&&!1!==i.multiSelect&&!n.isLeaf&&n.allChildren||[]];t?(r.selectRows(o,!1!==i.multiSelect),e.headerCheckbox&&r.selectedRecords.length===s.count-(s.groupRecords?s.groupRecords.length:0)&&(e.suspendEvents(),e.headerCheckbox.checked=!0,e.resumeEvents())):(r.deselectRows(o),e.headerCheckbox&&(e.suspendEvents(),e.headerCheckbox.checked=!1,e.resumeEvents()))}onCheckAllChange({checked:e}){this[e?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}set selectedRecordCollection(e){e instanceof Xi||(e=new Xi(e)),this._selectedRecordCollection=e,e.on({change:"onSelectedRecordCollectionChange",thisObj:this})}get selectedRecordCollection(){return this._selectedRecordCollection}spliceSelectedRecords(e,t,n){this._selectedRecordCollection.splice(e,t,n)}isSelected(e){var t;const n=this;return null!==(t=e)&&void 0!==t&&t.isModel&&(e=e.id),$h[typeof e]?n.selectedRecordCollection.includes(e):n._selectedCell&&n._selectedCell.id==e.id&&n._selectedCell.columnId===e.columnId}isSelectable(e){if(!e)return!1;const t=this.store.getById(e.id||e);return t&&!(t.meta&&t.isSpecialRow)}get selectedCell(){return this._selectedCell}set selectedCell(e){this.selectCell(e)}set selectionMode(e){e&&e.rowCheckboxSelection&&(e.row=e.checkbox=!0,e.cell=!1),this._selectionMode=e}get selectionMode(){return this._selectionMode}get selectedRecord(){return this.selectedRecordCollection.last||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}get selectedCellCSSSelector(){const e=this._selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectRow({record:e,column:t=this.columns.visibleColumns[0],scrollIntoView:n=!0,addToSelection:r=!1}){const i=this;(e=arguments[0].isModel?arguments[0]:i.store.getById(e))?i.selectCell({id:e.id,column:t},n,r):i.deselectAll()}selectCell(e,t=!1,n=!1,r=!1){const i=this,{selectedRecordCollection:s,selectionMode:o}=i,a=i.normalizeCellContext(e),l=a.record||i.store.getById(a.id);if(i.isSelectable(l)){if(t&&i.scrollRowIntoView(a.id,{column:a.columnId}),o.row&&(r&&(i.silent=(i.silent||0)+1),n?s.add(l):s.splice(0,s.count,l),r&&i.silent--,1===i.selectedRecordCollection.count&&(i.startCell=a,i.lastRange=null)),o.cell&&(a.columnId||a.column)&&!i.isSelected(a)){const e=i._selectedCell?[i._selectedCell]:[];i._selectedCell=a,i.triggerChangeEvent({mode:"cell",action:"select",selected:[a],deselected:e,selection:[a]},r)}return a}i.deselectAll()}selectAll(){const e=this;e.store.isFiltered&&!e.selectionMode.deselectFilteredOutRecords?e.selectedRecordCollection.add(...e.store.records.filter((e=>!e.isSpecialRow))):e.selectRows(e.store.allRecords.filter((e=>!e.isSpecialRow)),!0)}deselectAll(e=!1){const t=this;e?t.selectedRecordCollection.remove(...t.store.records):t.selectedRecordCollection.clear(),t._selectedCell&&t.deselectCell(t._selectedCell)}deselectRow(e){this.deselectRows(e)}selectRows(e,t=!1){const{store:n}=this,r=[];e=Array.isArray(e)?e:null==e?[]:[e];for(let t of e)t=n.getById(t),t&&r.push(t);t?this.selectedRecordCollection.add(r):this.selectedRecordCollection.splice(0,this.selectedRecordCollection.count,r)}deselectRows(e){const t=(e=Array.isArray(e)?e:[e]).map((e=>this.store.getById(e)));this.selectedRecordCollection.remove(t)}deselectCell(e){const t=this,n=t.normalizeCellContext(e),r=t.selectionMode,i=n.record||t.store.getById(n.id),s=t._selectedCell;return r.row&&t.selectedRecordCollection.remove(i),r.cell&&n.columnId&&s&&s.id===n.id&&s.columnId===n.columnId&&(t._selectedCell=null,t.triggerChangeEvent({mode:"cell",action:"deselect",selected:[],deselected:[n],selection:[]})),n}selectRange(e,t){const{store:n,selectedRecordCollection:r}=this,i=n.indexOf(e),s=n.indexOf(t),o=Math.min(i,s),a=Math.max(i,s);if(-1===o||-1===a)throw new Error("Record not found in selectRange");r.splice(0,r.count,n.getRange(o,a+1,!1))}onStoreRemove(e){super.onStoreRemove&&super.onStoreRemove(e),e.isCollapse||this.selectedRecordCollection.remove(e.records)}onStoreDataChange({action:e,source:t}){const n=this,{selectionMode:r,checkboxColumn:i,selectedRecordCollection:s}=n;if(super.onStoreDataChange&&super.onStoreDataChange(...arguments),"pageLoad"===e)r.preserveSelectionOnPageChange||n.deselectAll(),null==i||i.updateCheckAllState(!t.find((e=>!s.includes(e))));else if(Hh[e]){const e=[];!1===r.preserveSelectionOnDatasetChange?n.deselectAll():(s.forEach((n=>{const r=t.getById(n.id);if(r){const e=s.indexOf(n);s.splice(e,1,r)}else e.push(n)})),s.remove(e))}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(),this.deselectAll()}handleMouseMultiSelect(e,t){const n=this,r=e.id;(t.metaKey||t.ctrlKey)&&n.isSelected(r)?n.deselectRow(r):n.selectionMode.multiSelect&&(t.shiftKey&&n.startCell?function(e,t){const{store:r,selectedRecordCollection:i}=n,s=r.indexOf(e),o=r.indexOf(t),a=Math.min(s,o),l=Math.max(s,o);if(-1===a||-1===l)throw new Error("Record not found in selectRange");const c=r.getRange(a,l+1,!1).filter((e=>n.isSelectable(e)));i.splice(0,n.lastRange||0,c),n.lastRange=c}(n.startCell.id,r):(t.ctrlKey||t.metaKey)&&n.selectRow({record:r,scrollIntoView:!1,addToSelection:!0}))}onCellNavigate(e,t,n,r,i=!0){if(e.columns.getById(n.columnId)===e.checkboxColumn||e.selectionMode.rowCheckboxSelection)return;if(!i||e.returningFocus||r&&r.target.closest(".b-tree-expander"))return;const s=t&&n.id===t.id,o=r&&"mousedown"===r.type&&r.ctrlKey;if(!r||r.button&&2!==r.button||!r.shiftKey&&!o){const t=s&&(!r||r.shiftKey||r.ctrlKey),i=r&&e.isSelected(n.id),a=o;e.selectCell(n,!1,t||a||i)}else e.handleMouseMultiSelect(n,r);e.startCell&&!o||(e.startCell=n,e.lastRange=null)}triggerChangeEvent(e,t){const n=this,{mode:r,selected:i,deselected:s}=e;let o,a,l,c;if("row"===r){for(o=0,a=i.length;o<a;o++)l=n.getRowFor(i[o]),l&&(l.addCls("b-selected"),!n.checkboxColumn||n.checkboxColumn.hidden||i[o].isSpecialRow||(l.getCell(n.checkboxColumn.id).widget.checked=!0));for(o=0,a=s.length;o<a;o++)l=n.getRowFor(s[o]),l&&(l.removeCls("b-selected"),!n.checkboxColumn||n.checkboxColumn.hidden||s[o].isSpecialRow||(l.getCell(n.checkboxColumn.id).widget.checked=!1))}else if("cell"===r){for(o=0,a=i.length;o<a;o++)c=n.getCell(i[o]),c&&c.classList.add("b-selected");for(o=0,a=s.length;o<a;o++)c=n.getCell(s[o]),c&&c.classList.remove("b-selected")}t||n.trigger("selectionChange",e)}onCellClick({event:e,record:t}){const n=this;n.selectionMode.checkbox||!n.selectionMode.multiSelect||e.shiftKey||e.metaKey||e.ctrlKey||n.deselectRows(n.selectedRecords.filter((e=>e!==t)))}doDestroy(){var e;null===(e=this.selectedRecordCollection)||void 0===e||e.destroy(),super.doDestroy()}get widgetClass(){}};const Bh=e=>e.columns.suspendEvents(),Nh=e=>e.columns.resumeEvents(),zh=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},Vh=(e,t)=>e.stateSortIndex-t.stateSortIndex;var Wh=e=>class extends(e||me){static get $name(){return"GridState"}getState(){const e=this,t=e.element.style.cssText,n={rowHeight:e.rowHeight,readOnly:e.readOnly};if(t&&(n.style=t),e.selectedCell){const{id:t,columnId:r}=e.selectedCell;n.selectedCell={id:t,columnId:r}}return n.selectedRecords=e.selectedRecords.map((e=>e.id)),n.columns=e.columns.map((e=>e.getState())),n.store=e.store.state,n.scroll=e.storeScroll(),n.subGrids={},e.eachSubGrid((e=>{var t;const r=n.subGrids[e.region]=n.subGrids[e.region]||{};null==e.flex&&(r.width=e.width),r.collapsed=null!==(t=e.collapsed)&&void 0!==t&&t,r.collapsed&&(r._beforeCollapseState=e._beforeCollapseState)})),n}applyState(e){const t=this;if("columns"in e){let n=!1,r=!1;t.columns.suspendEvents(),t.eachSubGrid(Bh),e.columns.forEach(((e,i)=>{const s=t.columns.getById(e.id);if(s){const t=s.generation;s.applyState(e),n=n||s.generation!==t,s.stateSortIndex=i,s.allIndex!==i&&(r=n=!0)}})),n&&t.eachSubGrid(zh),r&&(t.eachSubGrid((e=>{e.columns.records.sort(Vh),e.columns.allRecords.sort(Vh)})),t.columns.sort({fn:Vh,ascending:!0})),t.isPainted&&n&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(Nh)}"subGrids"in e&&t.eachSubGrid((t=>{if(t.region in e.subGrids){const n=e.subGrids[t.region];"width"in n&&(t.width=n.width),"collapsed"in n&&(t.collapsed=n.collapsed,t._beforeCollapseState=n._beforeCollapseState)}})),"readOnly"in e&&(t.readOnly=e.readOnly),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),"scroll"in e&&t.restoreScroll(e.scroll)}get widgetClass(){}};const Gh=Promise.resolve(),Uh={block:"nearest"};class Yh extends si{scrollIntoView(e,t=Uh){const{xDelta:n,yDelta:r}=this.getDeltaTo(e,t),i=n||r?this.scrollBy(n,r,t):Gh;return(t.highlight||t.focus)&&i.then((()=>{t.highlight&&(e instanceof nn?e.translate(-n,-r).highlight():er.highlight(e)),t.focus&&e.focus&&e.focus()})),i}scrollBy(e,t,n){const r=t&&this.yScroller.scrollBy(0,t,n),i=e&&super.scrollBy(e,0,n);if(i&&i.cancel&&r&&r.cancel){const e=i.cancel,t=r.cancel;return i.cancel=r.cancel=()=>{e(),t()},Promise.all([i,r])}return i||r||Gh}scrollTo(e,t,n){const r=null!=t&&this.yScroller.scrollTo(null,t,n),i=null!=e&&super.scrollTo(e,null,n);if(n&&n.animate||this.syncPartners(),i&&i.cancel&&r&&r.cancel){const e=i.cancel,t=r.cancel;return i.cancel=r.cancel=()=>{e(),t()},Promise.all([i,r])}return i||r||Gh}get viewport(){const e=nn.from(this.element);return e.intersect(nn.from(this.yScroller.element))||new nn(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}Yh._$name="SubGridScroller";class qh extends ki{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{localizableProperties:["emptyText"],insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,collapsed:null,scrollable:{overflowX:!0},scrollerClass:Yh,hasCalculatedWidth:null,sealedColumns:null,emptyText:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null}}construct(e){super.construct(e),this.rowManager.on("addrows",this.onAddRow,this)}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null===(e=t.fakeScroller)||void 0===e||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElement.remove(),t.headerSplitter.remove(),t.scrollerSplitter.remove(),t.footerSplitter.remove(),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:n}=e.element.style,r={subGrid:e,parent:e};return n?r.flex=n:t&&(r.width=t),r}changeHeader(e){return new this.headerClass(Ot.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(Ot.assign({id:this.id+"-footer"},this.barConfig,e))}toggleSplitterCls(e,t=!0){const n=this;[n.splitterElement,n.headerSplitter,n.footerSplitter,n.scrollerSplitter].forEach((n=>null==n?void 0:n.classList[t?"add":"remove"](e)))}changeElement(e,t){const{region:n}=this;return super.changeElement({className:{"b-grid-subgrid":1,[`b-grid-subgrid-${n}`]:n,"b-grid-horizontal-scroller":1,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:n}},t)}get rowElementConfig(){return{className:"b-grid-row",children:this.columns.visibleColumns.map((e=>({className:"b-grid-cell",dataset:{column:e.field||"",columnId:e.id}})))}}changeVirtualScrollerElement(){const e=er.createElement({reference:"virtualScrollerElement",className:"b-virtual-scroller",dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=er.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{tag:"i",className:"b-icon b-icon-collapse-gridregion"},{tag:"i",className:"b-icon b-icon-expand-gridregion"}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return er.createElement(this.splitterConfig)}changeScrollerSplitter(){return er.createElement(this.splitterConfig)}changeFooterSplitter(){return er.createElement(this.splitterConfig)}hideSplitter(){this.splitterElement.classList.add("b-hide-display"),this.headerSplitter.classList.add("b-hide-display"),this.scrollerSplitter.classList.add("b-hide-display"),this.footerSplitter.classList.add("b-hide-display"),this.$showingSplitter=!1}showSplitter(){this.splitterElement.classList.remove("b-hide-display"),this.headerSplitter.classList.remove("b-hide-display"),this.scrollerSplitter.classList.remove("b-hide-display"),this.footerSplitter.classList.remove("b-hide-display"),this.$showingSplitter=!0}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),Tr.on({element:t.grid.element,delegate:`.b-grid-splitter[data-region=${t.region}]`,mouseover:"onSplitterMouseOver",mouseout:"onSplitterMouseOut",thisObj:t}),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;null===(e=this.footer)||void 0===e||e.refreshContent()}eachWidget(e,t=!0){const n=[this.header,this.footer];for(let r=0;r<n.length;r++){const i=n[r];if(!1===e(i))return;t&&i.eachWidget&&i.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:t}=this.columns;let n=e.firstElementChild,i=0;for(;n;){const e=t[i];e.minWidth&&(n.style.minWidth=er.setLength(e.minWidth)),e.flex?(n.style.flex=e.flex,n.style.width=""):e.width?(n.style.width=er.setLength(e.width),r.isIE11&&(n.style.flex="",n.style.minWidth=er.setLength(e.calcMinWidth))):n.style.flex=n.style.width=n.style.minWidth="",n=n.nextElementSibling,i++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:n,footer:r}=e;if(!e.collapsed){if(e.flex)n.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let i=e.width;if(!i){i=0;for(const t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=`${i}px`,n.width=i,r&&(r.width=i)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(r.isSafari||r.isEdge){const e=this,{region:t,header:n}=e,r=n.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const n=e.getElement(t);n&&(n.style.width=`${r}px`)})),n.headersElement.style.width=`${r}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,n,r,i){const s=this,{grid:o}=s;super.onInternalResize(e,t,n,r,i),o&&(s.syncSplitterButtonPosition(),t!==r&&(o.trigger("horizontalScroll",{subGrid:s,grid:o,scrollLeft:s.scrollable.x}),s.refreshFakeScroll(),s.fixRowWidthsInSafariEdge()),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const t=this,{grid:n}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const r=n.getSubGrid(n.getPreviousRegion(t.region));r&&r.splitterElement&&r.syncParallelSplitters(e)}}onSplitterMouseOver(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseOut(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.on({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const e=this;e.splitterButtons.style.transform=`translateY(${e.grid.scrollable.y+e.grid.bodyHeight/2-(e.headerSplitter?e.grid.headerHeight:0)}px)`}get viewRectangle(){const{scrollable:e}=this;return new nn(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){const e=this.columns.visibleColumns.some((e=>e.flex));er.toggleClasses(this.element,["b-has-flex"],e)}updateResizable(e){const t=this;[t.splitterElement,t.headerSplitter,t.scrollerSplitter,t.footerSplitter].forEach((t=>er.toggleClasses(t,["b-disabled"],!e)))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((e=>{e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}get overflowingHorizontally(){const{scrollable:e}=this;return e.scrollWidth>e.clientWidth+(r.isEdge?1:0)}get overflowingVertically(){const{scrollable:e}=this;return e.scrollHeight>e.clientHeight+(r.isEdge?1:0)}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:n,virtualScrollerWidth:r,totalFixedWidth:i,store:s,header:o,footer:a,scrollable:l}=e;l.scrollWidth=null!=s&&s.count?null:i,n.style.width=t.style.width,n.style.flex=t.style.flex,e.collapsed||(e.overflowingHorizontally?(r.style.width=`${(null==l?void 0:l.scrollWidth)||0}px`,o.element.classList.add("b-overflowing"),a.element.classList.add("b-overflowing"),e.grid.virtualScrollers.classList.remove("b-hide-display")):(r.style.width=0,o.element.classList.remove("b-overflowing"),a.element.classList.remove("b-overflowing")))}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:n}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),r.isFirefox&&t.element.addEventListener("wheel",(e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())})),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new si({element:n,overflowX:!0}),t.on({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x")}onSubGridScrollEnd(){this.forceScrollUpdate||this.syncScrollingPartners(),this.scrolling=!1}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:n}=t;!t.scrolling&&e&&(t.scrolling=!0),n.trigger("horizontalScroll",{subGrid:t,grid:n,scrollLeft:t.scrollable.x})}scrollColumnIntoView(e,t){const n=this,r=n.header.scrollable;if(e=e instanceof su?e:n.columns.get(e)||n.columns.getById(e)||n.columns.getAt(e)){const i=n.header.getHeader(e.id);if(i)return r.scrollIntoView(nn.from(i,null,!0),t)}}onAddRow({rows:e}){const t=this,n=t.rowElementConfig,r=document.createDocumentFragment();e.forEach((e=>{const i=er.createElement(n);r.appendChild(i),e.addElement(t.region,i),t.fixCellWidths(i)})),t.fixRowWidthsInSafariEdge(),t.element.insertBefore(r,t.insertRowsBefore)}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=er.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.element.dataset.emptyText=e}get store(){return this.grid.store}get rowManager(){var e;return null===(e=this.grid)||void 0===e?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,n=t.grid,r=n.getSubGrid(n.getNextRegion(t.region)),i=n.resolveSplitter(r);r.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,t=e.grid,n=t.getSubGrid(t.getNextRegion(e.region)),r=e.splitterElement?e:e.previousSibling;let i=0;return t.eachSubGrid((t=>{t!==e&&!t._collapsed&&++i})),0===i&&await n.expand(),new Promise((t=>{if(!e._beforeCollapseState){e._beforeCollapseState={};let r=!1;e.width&&(r=!0,e.on({afterinternalresize:()=>{t(e)},thisObj:e,once:!0})),e._beforeCollapseState.width=e.width,e._beforeCollapseState.elementWidth=e.element.style.width,""===n.element.style.flex&&(e._beforeCollapseState.nextRegionWidth=n.width,n.width+=e._beforeCollapseState.width),""!==e.element.style.flex&&(e._beforeCollapseState.flex=e.element.style.flex,e.header.element.style.flex=e.element.style.flex=""),e.element.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e.width="",e._collapsed=!0,r||(e.syncParallelSplitters(!0),t(!1))}})).then((t=>{if(!e.isDestroyed){var n;if(!1!==t)e.syncParallelSplitters(!0),null===(n=r.startSplitterButtonSyncing)||void 0===n||n.call(r);e.grid.trigger("subGridCollapse",e)}}))}async expand(){const e=this,t=e.grid,n=t.getSubGrid(t.getNextRegion(e.region)),r=e.splitterElement?e:e.previousSibling;return new Promise((t=>{if(null!=e._beforeCollapseState){let r=!1;e.width!==e._beforeCollapseState.elementWidth&&(r=!0,e.on({afterinternalresize:()=>{e.setTimeout((()=>t(e)),10)},thisObj:e,once:!0})),""===n.element.style.flex&&(n.width=e._beforeCollapseState.nextRegionWidth),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),e._beforeCollapseState.flex?(e.width=e._beforeCollapseState.width,e.header.flex=e.flex=e._beforeCollapseState.flex,e.footer.flex=e._beforeCollapseState.flex,e._width=null):e.width=e._beforeCollapseState.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,r||t(!1),delete e._beforeCollapseState}})).then((t=>{!1!==t&&(r.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1),e.grid.trigger("subGridExpand",e))}))}}qh.initClass(),qh._$name="SubGrid";var Kh=e=>class extends(e||me){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){const t=this,n=new Set;for(const r of t.columns){const{region:t}=r;t&&(e[t]||(e[t]={}),n.add(t))}e.normal&&Ot.isEmpty(e.normal)&&(e.normal=tg.defaultConfig.subGridConfigs.normal);for(const r of n)t.createSubGrid(r,e[r]);return t.items=t.subGrids,e}createSubGrid(e,t=null){const n=this,r=n.columns.makeChained((t=>t.region===e),["region"]),i=Ot.assign({type:"subgrid",id:`${n.id}-${e}Subgrid`,grid:n,region:e,headerClass:n.headerClass,footerClass:n.footerClass,columns:r,weight:e},t||n.subGridConfigs[e]);let s=!1;i.flex||i.width||(i.width=r.totalFixedWidth,s=!0);const o=n.subGrids[e]=qh.create(i);return o.hasCalculatedWidth=s,e===n.regions[0]&&(o.isFirstRegion=!0),o}onChildAdd(e){if(e.isSubGrid){const t=this,{items:n,headerContainer:r,virtualScrollers:i,footerContainer:s}=t,o=2*n.indexOf(e);t.hideHeaders||(er.insertAt(r,e.headerSplitter,o),er.insertAt(r,e.header.element,o)),er.insertAt(i,e.scrollerSplitter,o),er.insertAt(i,e.virtualScrollerElement,o),er.insertAt(s,e.footerSplitter,o),er.insertAt(s,e.footer.element,o),n.forEach(((e,t)=>{t<n.length-1&&e.showSplitter()}))}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:t}=this;delete this.subGrids[e.region],Ce.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((n,r)=>{n.isSubGrid&&e.call(t||n,n,r++)}))}callEachSubGrid(e,...t){let n=null;return this.items.forEach(((r,i)=>{if(r[e]){const s=r[e](...t);0===i&&(n=s)}})),n}get regions(){return this.items.map((e=>e.region))}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof su?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let n=e instanceof qh?e.region:e;return t[1]===n&&(n=t[0]),this.subGrids[n].splitterElement}get widgetClass(){}};const Xh=Ne.mergeLocales(ai,{ColumnPicker:{column:"Column",columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide",newColumns:"New columns"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{group:"Group",groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},Search:{searchForValue:"Search for value"},Sort:{sort:"Sort",sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},GridBase:{loadFailedMessage:"Data loading failed!",syncFailedMessage:"Data synchronization failed!",unspecifiedFailure:"Unspecified failure",networkFailure:"Network error",parseFailure:"Failed to parse server response",noRows:"No records to display",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",removeRow:"Delete",moveColumnTo:e=>`Move column to ${e}`},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages..."},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"Export settings",export:"Export",exporterType:"Control pagination",cancel:"Cancel",fileFormat:"File format",rows:"Rows",alignRows:"Align rows",columns:"Columns",paperFormat:"Paper format",orientation:"Orientation",repeatHeader:"Repeat header"},ExportRowsCombo:{all:"All rows",visible:"Visible rows"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>`Exporting page ${e}/${t}`}});Ve.registerLocale("En",{desc:"English",locale:Xh});const Zh=new Promise((e=>e())),Jh="GridBase:store",Qh={block:"nearest",inline:"nearest"},eg={dataset:1,pageLoad:1,filter:1};class tg extends(Bs.mixin(ho,go,Ah,kh,Ph,_h,jh,Wh,Kh,Rc)){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,emptyText:"L{noRows}",fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,showRemoveRowInContextMenu:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!r.isIE11,disableGridRowModelWarning:null,headerClass:Mh,footerClass:Dh,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:Th,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:""}}static getLKey(){return"4fec9e57-e475-11eb-a5fc-d094663d5c88"}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}static get deprecatedEvents(){return{cellContextMenuBeforeShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`cellContextMenuBeforeShow` event is deprecated, in favor of `cellMenuBeforeShow` event. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."},cellContextMenuShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`cellContextMenuShow` event is deprecated, in favor of `cellMenuShow` event. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."},headerContextMenuBeforeShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`headerContextMenuBeforeShow` event is deprecated, in favor of `headerMenuBeforeShow` event. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."},headerContextMenuShow:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`headerContextMenuShow` event is deprecated, in favor of `headerMenuShow` event. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."},contextMenuItem:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`contextMenuItem` event is deprecated, in favor of `cellMenuItem` and `headerMenuItem` events. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."},contextMenuToggleItem:{product:"Grid",invalidAsOfVersion:"5.0.0",message:"`contextMenuToggleItem` event is deprecated, in favor of `cellMenuToggleItem` and `headerMenuToggleItem` events. Please see https://bryntum.com/docs/grid/#Grid/guides/upgrades/4.0.0.md for more information."}}}finishConfigure(e){const t=this;super.finishConfigure(e),Ve.on({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),Ve.on({locale:"onLocaleChange",prio:-1,thisObj:t}),an.on({theme:"onThemeChange",thisObj:t}),t.on({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",350,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return null==t||t.destroy(),e?Tc.new({element:this.element},e):null}doDestroy(){var e;const t=this;t.detachListeners(Jh),null===(e=t.scrollManager)||void 0===e||e.destroy();for(const e of Object.values(t.features)){var n;null===(n=e.destroy)||void 0===n||n.call(e)}t.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach((t=>{if(t.disabled)return;let n;n=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:`b-${t instanceof me?t.$$name:t.constructor.name}`,n&&e.add(n.toLowerCase())}))}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:n,fillLastColumn:r,positionMode:i,showDirty:s}=this;return{class:{[`b-grid-${i}`]:1,"b-enable-sticky":t,"b-grid-notextselection":!n,"b-autoheight":e,"b-fill-last-column":r,"b-show-dirty":s}}}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:i}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},children:{headerContainer:{tag:"header",className:{"b-grid-header-container":1,"b-hidden":i}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:r.isFirefox?{height:`${er.scrollBarWidth}px`}:n},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}get focusElement(){return this.bodyContainer}updateHideFooters(e){var t;null===(t=this.footerContainer)||void 0===t||t.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,t){const n=this;if(!e&&t)return n.isDestroying?t.owner===n&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===n&&t.destroy(),e.grid=n,e;if(Array.isArray(e)){if(t)return t.data=e,t;e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return au.new({grid:n,owner:n},e)}updateColumns(e){const t=this;var n,i;e.on("change",t.onColumnsChanged,t),e.on((n=t.onColumnsResized,i=t,{update:({store:e,record:t,changes:r})=>{let s=!0;return("width"in r||"minWidth"in r||"flex"in r)&&(s=n.call(i,{store:e,record:t,changes:r})),s}})),r.isTouchDevice&&(t.touch=!0,e.forEach((e=>{const{touchConfig:t}=e;t&&e.applyState(t)})))}onColumnsChanged({action:e,changes:t,record:n}){const r=this;if(r.isPainted){if("update"===e){if("width"in t||"minWidth"in t||"flex"in t){const e=n.region;return void r.columns.visibleColumns.forEach((t=>{t.region===e&&t.repaintOnResize&&r.refreshColumn(t)}))}if("hidden"in t){const e=r.getSubGridFromColumn(n.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}}if("dataset"===e||"update"===e&&"region"in t){const e=r.columns.getDistinctValues("region"),{toRemove:t,toAdd:n}=Ce.delta(e,r.regions,!0);r.remove(t.map((e=>r.getSubGrid(e)))),r.add(n.map((e=>r.createSubGrid(e))))}r._suspendRenderContentsOnColumnsChanged||r.renderContents()}}onColumnsResized({changes:e,record:t}){const n=this;if(n.isConfiguring)return;const i=er.setLength(t.width),s=er.setLength(t.minWidth),o=n.getSubGridFromColumn(t.id);o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),n.cellEls&&t===n.lastColumnResized||(n.cellEls=er.children(n.element,`.b-grid-cell[data-column-id="${t.id}"]`),n.lastColumnResized=t);for(const o of n.cellEls){var a;if("width"in e&&(o.style.width=i,r.isIE11&&(o.style.flex="",o.style.minWidth=er.setLength(t.calcMinWidth))),"minWidth"in e&&(o.style.minWidth=s),"flex"in e)o.style.flex=null!==(a=t.flex)&&void 0!==a?a:null}n.resizingColumns||n.afterColumnsResized()}afterColumnsResized(){const e=this;e.eachSubGrid((e=>{e.collapsed||(e.fixWidths(),e.fixRowWidthsInSafariEdge())})),e.lastColumnResized=e.cellEls=null,e.bufferedAfterColumnsResized(),e.onHeightChange()}bufferedAfterColumnsResized(){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((e=>{e.collapsed||e.refreshFakeScroll()}))}processCellEditor(e){}bufferedElementResize(e,t,n,r){this.isPainted&&t!==r&&this.columns.usesFlexAutoHeight&&this.refreshRows()}onInternalResize(e,t,n,r,i){er.scrollBarWidth&&t<r&&this.eachSubGrid((e=>{e.flex&&e.onElementResize(e.element)})),super.onInternalResize(...arguments),this.bufferedElementResize(...arguments)}changeRowManager(e,t){const n=this;if(n._isRowMeasured||n.measureRowHeight(),null==t||t.destroy(),e){const t=xh.new({grid:n,rowHeight:n.rowHeight,rowScrollMode:n.rowScrollMode||"move",autoHeight:n.autoHeight,fixedRowHeight:n.fixedRowHeight,listeners:{changeTotalHeight:n.onRowManagerChangeTotalHeight,requestScrollChange:n.onRowManagerRequestScrollChange,thisObj:n}},e);return n._rowManager=null,t}}getRowHeight(e){return e.rowHeight}bindStore(e){const t=this.asyncEventSuffix;e.on({name:Jh,[`refresh${t}`]:"onStoreDataChange",[`add${t}`]:"onStoreAdd",[`remove${t}`]:"onStoreRemove",[`move${t}`]:"onStoreMove",[`replace${t}`]:"onStoreReplace",[`removeAll${t}`]:"onStoreRemoveAll",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",clearChanges:"onStoreDataChange",exception:"onStoreException",commit:"onStoreCommit",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(Jh),this.destroyStore&&e.destroy()}changeStore(e){if(null==e)return null;var t;("string"==typeof e&&(e=ta.getStore(e)),e instanceof ta)||((e=Ot.assign({data:this.data,tree:Boolean(null===(t=this.initialConfig.features)||void 0===t?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=class extends wu{}),e=new(e.readUrl?ia:ta)(e));return e}updateStore(e,t){const n=this;var r;(t&&n.unbindStore(t),e&&(t&&n.deselectAll(),n.bindStore(e)),n.trigger("bindStore",{store:e,oldStore:t}),n.isDestroying||!n.isPainted||n.refreshSuspended)||(null===(r=n._rowManager)||void 0===r||r.reinitialize())}onStoreUpdateRecord({source:e,record:t,changes:n}){const r=this;if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let i;if(t.isFieldModified("id")&&(i=r.getRowFor(t.meta.modified.id)),i=i||r.getRowFor(t),!i)return;if(r.fullRowRefresh||t.isSpecialRow){const n=e.indexOf(t);-1!==n&&i.render(n,t)}else r.columns.visibleColumns.forEach((e=>{const r=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||n[r]){const e=i.getCell(r);e&&i.renderCell({cellElement:e,record:t})}}))}}refreshFromRowOnStoreAdd(e,t){const n=this,{rowManager:r}=n;r.renderFromRow(e),r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),1===n.store.count&&n.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:n,oldIndex:r,isChild:i,oldParent:s,isMove:o,isExpandAll:a}){if(!this.isPainted||a)return;if(i&&!t[0].ancestorsExpanded(e))return;this.rowManager.calculateRowCount(!1,!0,!0),e.isFiltered&&(n=e.indexOf(t[0]));const l=this,{rowManager:c}=l,{topIndex:d,rows:u,rowCount:h}=c,g=c.topIndex+c.rowCount-1,m=n,p=n+t.length-1,f=g>=e.count-t.length-1;if(s||r>-1||i&&o)c.refresh();else if(m>=d&&m<d+h)l.refreshFromRowOnStoreAdd(u[m-d],...arguments);else if(p>=d&&p<d+h)c.refresh();else{const{totalHeight:e}=c;f&&n>g&&c.fillBelow(l._scrollTop||0),e!==c.totalHeight&&c.trigger("changeTotalHeight",{totalHeight:c.totalHeight})}}onStoreException({action:e,type:t,response:n,exceptionType:r,error:i}){const s=this;let o;switch(t){case"server":o=n.message||s.L("L{unspecifiedFailure}");break;case"exception":o="network"===r?s.L("L{networkFailure}"):i&&i.message||s.L("L{parseFailure}")}s.applyMaskError(`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${s.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")}</div>\n                <div class="b-grid-load-fail">${n&&n.url?n.url+" responded with":""}</div>\n                <div class="b-grid-load-fail">${o}</div>\n            </div>`)}onStoreDataChange({action:e,changes:t,source:n}){if(this.refreshSuspended)return;super.onStoreDataChange&&super.onStoreDataChange(...arguments);const r=this,i=n.isGrouped&&t&&n.groupers.some((e=>e.field in t));"dataset"===e&&r.rowManager.clearKnownHeights(),r.isPainted&&!i&&r.renderRows(Boolean(!(e in eg)||r.preserveScrollOnDatasetChange)),r.toggleEmptyText()}onStoreRecordIdChange(){super.onStoreRecordIdChange&&super.onStoreRecordIdChange(...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove(){const e=this._features;return(null==e?void 0:e.group)&&!e.group.disabled||(null==e?void 0:e.groupSummary)&&!e.groupSummary.disabled}onStoreRemove({records:e,isCollapse:t,isChild:n,isMove:r,isCollapseAll:i}){if(!this.isPainted||r||i)return;super.onStoreRemove&&super.onStoreRemove(...arguments);let s=2**53-1;const o=this,{rowManager:a}=o,l=e.reduce(((e,t)=>{const n=a.getRowById(t.id);return n&&(e.push(n),s=Math.min(s,a.rows.indexOf(n))),e}),[]);if(a.invalidateKnownHeight(e),o.animateRemovingRows&&l.length&&!t&&!n){const e=l[0];o.isAnimating=!0,Tr.onTransitionEnd({element:e._elementsArray[0],property:"left",duration:o.transitionDuration,thisObj:o,handler(){o.isAnimating=!1,l.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),a.refresh(),o.trigger("rowRemove")}}),l.forEach((e=>e.addCls("b-removing")))}else o.needsFullRefreshOnStoreRemove(...arguments)?a.refresh():(a.calculateRowCount(!1,!0,!0),a.rows[s]?a.renderFromRow(a.rows[s]):a.trigger("changeTotalHeight",{totalHeight:a.totalHeight}),o.trigger("rowRemove",{isCollapse:t}))}onStoreMove({from:e,to:t}){const{rowManager:n}=this,{topIndex:r,rowCount:i}=n,[s,o]=[e,t].sort();s>=r&&s<r+i?n.renderFromRow(n.rows[s-r]):o>=r&&o<r+i&&n.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:n}=this;if(t)n.clearKnownHeights(),n.refresh();else{const t=e.reduce(((e,[,t])=>{const n=this.getRowFor(t);return n&&e.push(n),e}),[]);n.invalidateKnownHeight(e),n.renderRows(t)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const n=this.rowManager.getRowFor(e);n&&t.push(n)})),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.eachSubGrid((t=>t.emptyText=e))}populateHeaderMenu({column:e,items:t}){const n=this,{subGrids:r,regions:i}=n;let s=!0;Object.entries(r).forEach((([o,a])=>{if(!a.sealedColumns&&e.draggable&&o!==e.region&&(!e.parent&&r[e.region].columns.count>1||e.parent&&e.parent.children.length>1)){const l=a.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=i.length>2?n.L("L{moveColumnTo}",n.optionalL(o)):n.L(l?"L{moveColumnRight}":"L{moveColumnLeft}");t[`${o}Region`]={targetSubGrid:o,text:c,icon:"b-fw-icon "+(l?"b-icon-column-move-right":"b-icon-column-move-left"),name:"moveColumn",cls:s?"b-separator":"",onItem:({item:t})=>{e.traverse((e=>e.region=o)),n.columns.insert(n.columns.indexOf(r[t.targetSubGrid].columns.last)+1,e),n.scrollColumnIntoView(e)}},s=!1}}))}populateCellMenu({record:e,items:t}){var n;const r=this;(null===(n=r.features)||void 0===n?void 0:n.contextMenu)&&!r.features.contextMenu.disabled&&r.showRemoveRowInContextMenu&&!r.readOnly&&e&&!e.isSpecialRow&&(t.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon b-icon-trash",name:"removeRow",onItem:()=>r.store.remove(r.selectedRecords)})}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const{columns:t,store:n}=this;if(e instanceof n.modelClass)return{record:e,id:e.id,columnId:t.visibleColumns[0].id};if(!("columnId"in e)){if("field"in e){const n=t.get(e.field);e.columnId=n&&n.id}else if("column"in e){const n="number"==typeof e.column?t.visibleColumns[e.column]:e.column;e.columnId=n&&n.id}"columnId"in e||(e.columnId=t.visibleColumns[0].id)}if("id"in e){if(e.element&&!n.getById(e.id)){const t=this.getRecordFromElement(e.element);t&&(e.id=t.id)}}else{const t="row"in e?n.getAt(e.row):e.record;t&&(e.id=t.id)}return e}getCell(e){let t,n=null;return"id"in(e=this.normalizeCellContext(e))&&(t=this.getRowById(e.id)),t&&"columnId"in e&&(n=t.getCell(e.columnId)),n}getHeaderElement(e){return"string"!=typeof e&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=er.up(e,".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const n=sa.get(t);return this.columns.getById(n.columnId)}updateAutoHeight(e){Ot.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){Ot.assertBoolean(e,"columnLines"),er.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}fixSizes(){this.callEachSubGrid("fixWidths")}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const n=this;if(n.renderingRows||!n.isVisible)return!1;n.rowManager.bottomRow&&(e=Math.max(e,n.rowManager.bottomRow.bottom));const r=n.scrollable,i=Math.abs(n.virtualScrollHeight-e),s=n._bodyRectangle.height;if(i){const o=e-s-n._scrollTop<2*s||n._verticalScrollHeight&&n._verticalScrollHeight-s<n._scrollTop;r.scrollHeight=n.virtualScrollHeight=e,n.isPainted&&(n.scrolling&&!o||i<100)&&!t?n.bufferedFixElementHeights():(n.virtualScrollHeightDirty&&n.virtualScrollHeightDirty(),n.bufferedFixElementHeights.cancel(),n.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,n=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=n,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=n,e._bodyHeight=t,e._bodyRectangle=nn.client(e.bodyContainer)),e.refreshVirtualScrollbars()}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.startMonitoring({scrollables:[{element:e.scrollable.element,direction:"horizontal"},{element:this.scrollable.element,direction:"vertical"}]})}disableScrollingCloseToEdges(e){"string"==typeof e&&(e=this.subGrids[e]),this.scrollManager.stopMonitoring([e.element,this.scrollable.element])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this;if(!e.scrollInitialized){let t;const n=e.createOnFrame((()=>{t=e.scrollable.y,t!==e._scrollTop&&(e._scrollTop=t,e.scrolling||(e.scrolling=!0,e.eachSubGrid((e=>e.suspendResizeMonitor=!0))),e.rowManager.updateRenderedRows(t),e.trigger("scroll",{scrollTop:t}))}));e.scrollInitialized=!0,e.scrollable.on({scroll:n,scrollend(){e.scrolling=!1,e.eachSubGrid((e=>e.suspendResizeMonitor=!1))}}),e.callEachSubGrid("initScroll")}}async scrollRowIntoView(e,t=Qh){const n=this,r=t.block||"nearest",{rowManager:i}=n,s=n.store.getById(e);if(s){let e;if(-1===n.store.indexOf(s))return Zh;let a=n.scrollable,l=n.getRecordCoords(s);const c=nn.from(a.element);if(!l.virtual){let{column:e}=t;if(e){if("string"==typeof e&&(e=n.columns.getById(e)||n.columns.get(e)),e){a=n.getSubGridFromColumn(e).scrollable;const t=nn.from(i.getRowFor(s).getCell(e.id));l.x=t.x,l.width=t.width}}else t.x=!1;return a.scrollIntoView(l,t)}{const d=l.block,u="nearest"!==r?t:{block:d};if(e=a.scrollIntoView(l,{block:"center"}),i.scrollTargetRecordId=s,i.updateRenderedRows(a.y,!0),l=n.getRecordCoords(s),i.lastScrollTop=a.y,l.virtual)return Zh;var o;if(t.animate)a.suspendEvents(),"end"===r||"nearest"===r&&"end"===d?a.y-=c.bottom-l.bottom:("start"===r||"nearest"===r&&"start"===d)&&(a.y+=l.y-c.y),i.updateRenderedRows(a.y,!1,!0),"end"===d?a.y-=i.appendRowBuffer*i.rowHeight-1:a.y+=i.prependRowBuffer*i.rowHeight-1,a.scrollIntoView(n.getRecordCoords(s),Object.assign({},t,u)),a.resumeEvents();else t.recursive||await e,await(null===(o=n.scrollRowIntoView)||void 0===o?void 0:o.call(n,s,Object.assign({recursive:!0},t,u)))}}}scrollColumnIntoView(e,t){return e=e instanceof su?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid((e=>{t.scrollLeft[e.region]=e.scrollable.x})),t}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{var n;const r=e.scrollLeft[t.region];t.scrollable.updateX(r),t.header.scrollable.updateX(r),t.footer.scrollable.updateX(r),null===(n=t.fakeScroller)||void 0===n||n.updateX(r)})),this.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=er.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:r.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,n=er.getRootElement("string"==typeof t?document.getElementById(t):t);e.adopt&&n.contains(e.element)||(n.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),n=er.getStyleValue(t,["height","border-top-width","border-bottom-width"]),i=parseInt(n.height),s=r.isFirefox?devicePixelRatio:1,o=n["border-top-width"]?Math.round(s*parseFloat(n["border-top-width"])):0,a=n["border-bottom-width"]?Math.round(s*parseFloat(n["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(i)&&i?i:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=o+a,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){const t=this;t.isVisible?t.measureRowHeight():-1===t.findListener("paint","measureRowHeight",t)&&t.on({paint:"measureRowHeight",thisObj:t,once:!0}),t.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:n}=this;t.classList.add("b-notransition"),e?n.returnToTop():n.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){if(!e.hidden){const{field:t}=e;this.rowManager.forEach((e=>{const n=e.getCell(t);e.renderCell({cellElement:n})}))}}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:n,virtualScrollers:r,hasVerticalOverflow:i}=e,{classList:s}=r,o=!s.contains("b-hide-display"),a=Object.values(e.subGrids).some((e=>e.overflowingHorizontally)),l=a!==o,c=i?"add":"remove";l&&r.classList[a?"remove":"add"]("b-hide-display"),er.scrollBarWidth&&(t.classList[c]("b-show-yscroll-padding"),n.classList[c]("b-show-yscroll-padding"),r.classList[c]("b-show-yscroll-padding"),l&&(a&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()))}get hasVerticalOverflow(){const{scrollable:e}=this;return r.isEdge||r.isIE11?Math.abs(e.scrollHeight-e.clientHeight)>1:e.scrollHeight>e.clientHeight}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.on({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||(this._bodyRectangle=nn.client(this.bodyContainer)),super.triggerPaint()}onHeightChange(){const e=this;e._bodyRectangle=nn.client(e.bodyContainer),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}renderHeader(e,t){}renderFooter(e,t){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh"))}renderRows(e=!0){const t=this,n=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(n),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:n,footerContainer:r,rowManager:i}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",n),e.callEachSubGrid("refreshFooter",r),e.renderHeader(n,t),e.renderFooter(r,t),e.fixSizes();const s=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.rowCount&&(i.setPosition(s),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){const t=this;if(t.onPaintOverride()||!e)return;const{rowManager:n,store:r,element:i,headerContainer:s,bodyContainer:o,footerContainer:a}=t,l=er.scrollBarPadElement;let c,d=0;t.columns.on({change:()=>c=!0,once:!0}),t.updateResponsive(t.width,0),c&&(t.callEachSubGrid("refreshHeader",s),t.callEachSubGrid("refreshFooter",a)),t.renderHeader(s,i),t.renderFooter(a,i),er.append(s,l),er.append(a,l),er.append(t.virtualScrollers,l),t._bodyRectangle=nn.client(t.bodyContainer);const u=t.bodyContainer.offsetHeight;if(t.autoHeight?(t._bodyHeight=n.initWithHeight(i.offsetHeight-s.offsetHeight-a.offsetHeight,!0),o.style.height=t.bodyHeight+"px"):(t._bodyHeight=u,n.initWithHeight(t._bodyHeight,!0)),t.eachSubGrid((e=>{e.header.maxDepth>d&&(d=e.header.maxDepth)})),s.dataset.maxDepth=d,t.fixSizes(),!r.count&&r.isLoading||t.renderRows(),t.columns.usesAutoHeight){const{fonts:e}=document;"loaded"!==(null==e?void 0:e.status)&&e.ready.then((()=>!t.isDestroyed&&t.refreshRows()))}t.initScroll(),t.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),"minHeight"in e.initialConfig||"height"in e.initialConfig||parseInt(window.getComputedStyle(e.element).minHeight)!==e.height||console.warn(`The ${e.$$name} is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.`))}maskBody(e){const t=this;if(t.bodyContainer){t.unmaskBody();const{maskElement:n}=t.activeMask=yi.mask(e,t.element);return n.style.marginTop=`${t.bodyContainer.offsetTop}px`,n.style.height=t.virtualScrollers.offsetTop+t.virtualScrollers.offsetHeight-t.bodyContainer.offsetTop+"px",t.activeMask}}unmaskBody(){const e=this;e.loadmaskHideTimer&&e.clearTimeout(e.loadmaskHideTimer),e.loadmaskHideTimer=null,e.activeMask&&e.activeMask.destroy(),e.activeMask=null}toggleEmptyText(){this.bodyContainer&&er.toggleClasses(this.bodyContainer,"b-grid-empty",!(this.rowManager.rowCount>0||this.store.isLoading||this.store.isCommitting))}}tg.initClass(),s.setVersion("grid","4.2.1"),tg._$name="GridBase";class ng extends tg{static get $name(){return"Grid"}static get type(){return"grid"}}ng.initClass(),ng._$name="Grid";class rg extends ng{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,t){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,t)}}rg.initClass(),rg._$name="TreeGrid";class ig extends Error{}class sg extends ig{constructor(e={}){var t,n;super(e.message||e.request&&A.capitalize(null===(t=e.request)||void 0===t?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=null===(n=this.request)||void 0===n?void 0:n.type}}const og=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},ag=function(e,t){return og(e,t,"loadPriority")},lg=function(e,t){return og(e,t,"syncPriority")};var cg=e=>{e.$$meta=e.$meta;const t=[];return e.isEvents||t.push(Be),e.isDelayable||t.push(br),class extends((e||me).mixin(...t)){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,autoSyncTimerId:null,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}doAutoLoad(){return this.load().catch((e=>{}))}getStoreDescriptor(e){return e?e instanceof ta?this.crudStores.find((t=>t.store===e)):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(ta.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:n=this.storeIdProperty,modelClass:r}=t;return e.storeId||(e.storeId=t[n]),e.idField||(e.idField=r.idField),e.phantomIdField||(e.phantomIdField=r.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=r.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){if(!e)throw new Error("Iterator function must be provided");this.crudStores.every((n=>!1!==e.call(t,n.store,n.storeId,n)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let n;return e instanceof ta?n={store:e}:"object"==typeof e?(e.stores?(Array.isArray(e.stores)||(e.stores=[e.stores]),e.stores.forEach(((t,n)=>{let r=t;"string"==typeof t&&(r={storeId:t}),r.masterStoreInfo=e,e.stores[n]=r}))):e.store||(e={storeId:e.id,store:new ta(e)}),n=e):n={store:ta.getStore(e)},t.fillStoreDescriptor(n),(e=n.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,e.load&&(e.autoCommit=!1,e.autoLoad=!1),t.bindCrudStoreListeners(e),n}addCrudStore(e,t,n){if(!e)return;if(Array.isArray(e)||(e=[e]),!e.length)return;const r=this,i=e.map(r.internalAddCrudStore,r);void 0===t?r.crudStores.push(...i):(n&&((n instanceof ta||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),t+=r.crudStores.indexOf(n)),r.crudStores.splice(t,0,...i)),r.orderedCrudStores.push(...i),r.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||this.addCrudStore(e,Ce.findInsertionIndex(e,t.crudStores,ag)),t.hasApplySequenceStore(e)||this.addStoreToApplySequence(e,Ce.findInsertionIndex(e,t.syncApplySequence,lg))}hasCrudStore(e){var t;return null===(t=this.crudStores)||void 0===t?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,n=t.crudStores,r=n.find((t=>t===e||t.store===e||t.storeId===e));if(!r)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(r.store),delete t.crudStoresIndex[r.storeId],Ce.remove(n,r),t.syncApplySequence&&t.removeStoreFromApplySequence(e)}bindCrudStoreListeners(e){e.on({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,n){if(!e)return;Array.isArray(e)||(e=[e]);const r=this,i=e.reduce(((e,t)=>{const n=r.getStoreDescriptor(t);return n&&e.push(n),e}),[]);if(void 0===t)r.syncApplySequence.push(...i);else{let e=t;n&&((n instanceof ta||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),e+=r.syncApplySequence.indexOf(n)),r.syncApplySequence.splice(e,0,...i)}const s=r.syncApplySequence.map((({storeId:e})=>e));r.orderedCrudStores=[...r.syncApplySequence],r.crudStores.forEach((e=>{s.includes(e.storeId)||r.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex((t=>t===e||t.store===e||t.storeId===e));t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreDestroy({source:e}){this.removeCrudStore(e)}onCrudStoreChange(){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges()?(e.trigger("hasChanges"),e.autoSync&&e.scheduleAutoSync()):e.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,t.autoSync&&e&&t.sync())}scheduleAutoSync(){const e=this;e.autoSyncTimerId||e.autoSyncSuspendCounter||(e.autoSyncTimerId=e.setTimeout((()=>{e.autoSyncTimerId=null,e.sync().catch((e=>{}))}),e.autoSyncTimeout))}async triggerFailedRequestEvents(e,t,n,r){const{options:i,type:s}=e;this.trigger("requestFail",{requestType:s,response:t,responseText:n,responseOptions:r}),this.trigger(s+"Fail",{response:t,responseOptions:r,responseText:n,options:i})}async internalOnResponse(e,t,n){const r=this,i=t?r.decode(t):null,{options:s,type:o}=e;return t&&!i&&console.error("Failed to parse response: "+t),null!=i&&i.success?!1!==r.trigger("beforeResponseApply",{requestType:o,response:i})&&!1!==r.trigger("before"+A.capitalize(o)+"Apply",{response:i,options:s})&&(r.crudRevision=i.revision,await r.applyResponse(e,i,s),r.trigger("requestDone",{requestType:o,response:i,responseOptions:n}),r.trigger(o,{response:i,responseOptions:n,options:s}),"load"!==o&&r.crudStoreHasChanges()||(r.trigger("noChanges"),"load"===o&&r.emitCrudStoreEvents(e.pack.stores,"afterRequest"))):r.triggerFailedRequestEvents(e,i,t,n),i}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some(this.isCrudStoreDirty)}isCrudStoreDirty(e){return Boolean(null==e?void 0:e.store.changes)}emitCrudStoreEvents(e,t,n){const r=d({action:"read"+t},n);for(const n of this.crudStores)e.includes(n.storeId)&&n.store.trigger(t,r)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return delete r.request,t.stores=n.map((e=>{var t;const n=null==r?void 0:r[e.storeId],i=e.pageSize||(null===(t=e.store)||void 0===t?void 0:t.pageSize);if(n||i){const t=Object.assign({storeId:e.storeId,page:1},n);return i&&(t.pageSize=i),e.currentPage=t.page,n&&delete r[e.storeId],t}return e.storeId})),Object.assign(t,r),t}loadCrudStore(e,t,n){const r=null==t?void 0:t.rows;null!=n&&n.append||null!=t&&t.append?e.add(r):e.data=r,e.trigger("load",{data:r})}loadDataToCrudStore(e,t,n){const r=this,i=e.store,s=e.stores,o=e.idField||"id",a=i.tree,l=null==t?void 0:t.rows;if(i.__loading=!0,l){let c;s&&(c=r.getSubStoresData(l,s,o,a)),r.loadCrudStore(i,t,n,e),c&&c.forEach((e=>{r.loadDataToCrudStore(Object.assign({store:i.getById(e.id).get(e.storeDesc.storeId)},e.storeDesc),e.data)}))}i.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach((n=>{const r=n.storeId,i=e[r];i&&this.loadDataToCrudStore(n,i,t[r])})),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(e){const t=this,n=t.getLoadPackage(e);return new Promise(((r,i)=>{if(!1!==t.trigger("beforeLoad",{pack:n})){const{load:s}=t.activeRequests;s&&(t.cancelRequest(s.desc,s.reject),t.trigger("loadCanceled",{pack:n}));const o=j.assign({id:n.requestId,data:t.encode(n),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null==e?void 0:e.request);t.activeRequests.load={type:"load",options:e,pack:n,resolve:r,reject(...e){o.success=o.failure=null,i(...e)},id:n.requestId,desc:t.sendRequest(o)},t.emitCrudStoreEvents(n.stores,"loadStart"),t.trigger("loadStart",{pack:n})}else t.trigger("loadCanceled",{pack:n}),i({cancelled:!0})}))}getActiveCrudManagerRequest(e){let t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}getSubStoresData(e,t,n,r){if(!e)return;const i=[];function s(e,t){t.forEach((t=>{const r=t.storeId;e[r]&&(i.push({id:e[n],storeDesc:t,data:e[r]}),delete e[r])}))}return r?e.forEach((e=>{s(e,t);const r=this.getSubStoresData(e.children,t,n,!0);r&&i.push(...r)})):e.forEach((e=>s(e,t))),i}prepareAdded(e,t){const{store:n,stores:r}=t,{isTree:i}=n,s=t.phantomIdField||this.phantomIdField,o=t.phantomParentIdField||this.phantomParentIdField;return e.filter((e=>e.isValid)).map((e=>{const t=e.constructor,n=Object.assign(e.persistableData,{[s]:e.id});if(i){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(n[o]=t.id)}return this.resetIdsBeforeSync&&Ot.deletePath(n,t.getFieldDataSource(t.idField)),r&&this.processSubStores(e,n,r),n}))}prepareUpdated(e,t){const{store:n,stores:r}=t,{isTree:i}=n,s=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,o=t.phantomParentIdField||this.phantomParentIdField;if(t.store.tree){const n=t.store.rootNode;e=e.filter((e=>e!==n))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let n;if(n=s?t.persistableData:t.modificationDataToWrite,i){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(n[o]=e.id)}return r&&this.processSubStores(t,n,r),Ot.isEmpty(n)||e.push(n),e}),[])}prepareRemoved(e){return e.map((e=>{const t=e.constructor;return Ot.setPath({},t.getFieldDataSource(t.idField),e.id)}))}processSubStores(e,t,n){n.forEach((n=>{const r=n.storeId,i=e.get(r);if(i){const e=this.getCrudStoreChanges(Object.assign({store:i},n));e?t[r]=Object.assign(e,{$store:!0}):delete t[r]}else delete t[r]}))}getCrudStoreChanges(e){const{store:t}=e;let n,{added:r=[],modified:i=[],removed:s=[]}=t.changes||{};return r.length&&(r=this.prepareAdded(r,e)),i.length&&(i=this.prepareUpdated(i,e)),s.length&&(s=this.prepareRemoved(s)),(r.length||i.length||s.length)&&(n={},r.length&&(n.added=r),i.length&&(n.updated=i),s.length&&(n.removed=s)),n}getChangeSetPackage(){const e=this.changes;return e?Object.assign({type:"sync",requestId:this.requestId,revision:this.crudRevision},e):null}get changes(){const e={};return this.crudStores.forEach((t=>{const n=this.getCrudStoreChanges(t);n&&(e[t.storeId]=n)})),Object.keys(e).length>0?e:null}applyChangesToRecord(e,t,n){const r=this,i=e.constructor,{fieldDataSourceMap:s}=i,o=i.prototype,a={},l=e.data,c={[r.phantomIdField]:!0};let d;n&&n.forEach((n=>{const i=n.storeId;if(Object.prototype.hasOwnProperty.call(t,i)){c[i]=!0;const s=e.get(i);s?r.applyChangesToStore(Object.assign({store:s},n),t[i]):console.log("Can't find store for the response sub-package")}}));const u={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&!c[e]&&(u[e]=t[e]);const h=Ot.pathifyKeys(u);for(const t in h){const n=s[t],r=n?n.name:t,c=i.processField(r,h[t]),u=t in o?e[r]:Ot.getPath(l,t);(null!=n&&n.isEqual?n.isEqual(u,c):Ot.isEqual(u,c))||(d=!0,a[r]=c)}if(d){r.suspendChangesTracking();for(const t in a)e[t]=a[t];r.resumeChangesTracking(!0)}r.clearRecordChanges(e,a)}clearRecordChanges(e,t){e.clearChanges(!0,!1)}applyRemovals(e,t,n){const{removed:r,modelClass:i}=e,s=i.getFieldDataSource(i.idField);let o=0;return null==t||t.forEach((t=>{const n=t[s];let i=!1;if(r.includes(n)&&(r.remove(n),i=!0,o++),!i){const t=e.getById(n);t?(this.suspendChangesTracking(),t.remove(),r.remove(t),o++,this.resumeChangesTracking(!0)):console.log("Can't find record to remove from the response package")}})),o}getRowsToApplyChangesTo({store:e,storeId:t},n,r){var i,s;const o=this,{modelClass:a}=e,l=a.getFieldDataSource(a.idField),{updated:c,removed:d}=r||{};let u,h;if(n){const e={};u=n.rows||[],h=n.removed||[],[...u,...h].forEach((t=>{const n=Ot.getPath(t,l);e[n]=!0})),o.supportShortSyncResponse&&(null==c||c.forEach((t=>{const n=Ot.getPath(t,l);e[n]||u.push({[l]:n})})),null==d||d.forEach((t=>{const n=Ot.getPath(t,l);e[n]||h.push({[l]:n})})))}else(c||d)&&(u=c,h=d);return u=null!==(i=u)&&void 0!==i&&i.length?u:null,h=null!==(s=h)&&void 0!==s&&s.length?h:null,{rows:u,removed:h}}applyChangesToStore(e,t,n){const r=this,i=e.phantomIdField||r.phantomIdField,{store:s,stores:o}=e,{modelClass:a}=s,l=a.getFieldDataSource(a.idField),{rows:c,removed:d}=r.getRowsToApplyChangesTo(e,t,n);null==c||c.forEach((e=>{const t=e[i],n=Ot.getPath(e,l);let a=null;null!=t?a=s.getById(t):null!=n&&(a=s.getById(n)),a?r.applyChangesToRecord(a,e,o,s):(r.suspendChangesTracking(),a=s.add(e)[0],r.resumeChangesTracking(!0),a.clearChanges())})),d&&r.applyRemovals(s,d)&&s.trigger("dataChanged",{source:s})}applySyncResponse(e,t){const n=this,r=n.orderedCrudStores;n.applyingSyncResponse=!0;for(const s of r){var i;n.applyChangesToStore(s,e[s.storeId],null==t||null===(i=t.pack)||void 0===i?void 0:i[s.storeId])}n.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,n){let r=e.type;switch(this.trackResponseType&&(r=t.type||e.type),r){case"load":this.applyLoadResponse(t,n);break;case"sync":this.applySyncResponse(t,e)}}get requestId(){return Number.parseInt(`${Date.now()}${this._requestId++}`)}sync(){const e=this;return e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,n)=>{const r=e.getChangeSetPackage();r?!1!==e.trigger("beforeSync",{pack:r})?(e.trigger("syncStart",{pack:r}),e.activeRequests.sync={type:"sync",pack:r,resolve:t,reject:n,id:r.requestId,desc:e.sendRequest({id:r.requestId,data:e.encode(r),type:"sync",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:r}),n({cancelled:!0})):t(null)})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onCrudRequestSuccess(e,t,n){var r;const i=this,{type:s,id:o}=n;if(i.isDestroyed)return;let a="";n=i.activeRequests[s];try{a=await e.text()}catch(e){}if(i.isDestroyed)return;if((null===(r=n)||void 0===r?void 0:r.id)!==o)throw new Error(`Interleaved ${s} operation detected`);i.activeRequests[s]=null;const l=await i.internalOnResponse(n,a,t);i.isDestroyed||(null!=l&&l.success||n.reject(new sg({rawResponse:e,response:l,request:n})),i["crud"+A.capitalize(n.type)+"ed"]=!0,n.resolve({response:l,rawResponse:e,responseText:a,request:n}))}async onCrudRequestFailure(e,t,n){var r;if(this.isDestroyed)return;n=this.activeRequests[n.type];const i=null==t||null===(r=t.abortController)||void 0===r?void 0:r.signal;if(!Boolean(null==i?void 0:i.aborted)){let r="";try{r=await e.text()}catch(e){}if(this.isDestroyed)return;if(this.triggerFailedRequestEvents(n,null,r,t),this.isDestroyed)return;n.reject(new sg({rawResponse:e,request:n}))}this.activeRequests[n.type]=null}commitCrudStores(){s.deprecate("Scheduler","5.0.0","commitCrudStores is deprecated, in favor of acceptChanges"),this.acceptChanges()}acceptChanges(){this.crudStores.forEach((e=>e.store.acceptChanges()))}revertChanges(){this.orderedCrudStores.forEach((e=>e.store.revertChanges()))}rejectCrudStores(){s.deprecate("Scheduler","5.0.0","rejectCrudStores is deprecated, in favor of revertChanges"),this.revertChanges()}doDestroy(){const e=this,{load:t,sync:n}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),n&&e.cancelRequest(n.desc,n.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}}};class dg extends(me.mixin(cg)){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return A.safeJsonStringify(this)}set json(e){"string"==typeof e&&(e=A.safeJsonParse(e)),this.forEachCrudStore((t=>{const n=`${t.storeId}Data`;e[n]&&(t.data=e[n])}))}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore(((t,n)=>e[`${n}Data`]=t.toJSON())),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}commit(){s.deprecate("Scheduler","5.0.0","commit is deprecated, in favor of acceptChanges"),this.commitCrudStores()}reject(){s.deprecate("Scheduler","5.0.0","reject is deprecated, in favor of revertChanges"),this.revertChanges()}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}dg._$name="AbstractCrudManager";var ug=e=>class t extends(e||me){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){var n;null===(n=e.abort)||void 0===n||n.call(e),t({cancelled:!0})}shouldUseBodyForRequestData(e,t,n){return!("HEAD"===t||"GET"===t||n)}sendRequest(e){const n=this,{data:r}=e,i=n.transport[e.type]||{},s=j.assign({},i,i.requestConfig);s.method=s.method||t.defaultMethod[e.type],s.params=j.assign(s.params||{},e.params);let{paramName:o}=s;if(n.shouldUseBodyForRequestData(i,s.method,o)?(s.body=r,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(o=o||"data",s.params[o]=r),!s.url)throw new Error("Trying to request without URL specified");delete s.requestConfig,delete s.paramName,n.trigger("beforeSend",{params:s.params,type:e.type,requestConfig:s,config:e}),s.queryParams=s.params,delete s.params;let a,l=!1;const c=j.assign({},s,s.fetchOptions),d=be.fetch(s.url,c);d.catch((e=>{var t;d.done=!0;const n=null===(t=c.abortController)||void 0===t?void 0:t.signal;return n&&(l=n.aborted,l||console.warn(e)),{error:e,cancelled:l}})).then((t=>{d.done=!0;const r=null!=t&&t.ok?e.success:e.failure;a=null==r?void 0:r.call(e.thisObj||n,t,c,e)}));const u=Promise.all([d,a]);return u.abort=()=>{var e;d.done||(null===(e=d.abort)||void 0===e||e.call(d))},u}},hg=e=>class extends(e||me){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(e){var t;return e=Object.assign({},null===(t=this.encoder)||void 0===t?void 0:t.requestData,e),A.safeJsonStringify(e)}decode(e){return A.safeJsonParse(e)}},gg=e=>class extends(e.mixin(Rc)){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:e,project:t}=this;this.loadMask&&(e||t).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:e}=this;e&&(this.masked=yi.mergeConfigs(this.loadMaskDefaults,e))}bindCrudManager(e){this.detachListeners("crudManager"),null==e||e.on({name:"crudManager",loadStart:"onCrudManagerLoadStart",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",thisObj:this})}onCrudManagerLoadStart(){var e;this.applyLoadMask(),null===(e=this.toggleEmptyText)||void 0===e||e.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerRequestFinalize(e=!0,t,n){const r=this;var i;e?(r.masked=null,null===(i=r.toggleEmptyText)||void 0===i||i.call(r)):r.applyMaskError(`<div class="b-grid-load-failure">\n                    <div class="b-grid-load-fail">${r.L(`L{GridBase.${t}FailedMessage}`)}</div>\n                    ${n&&n.message?`<div class="b-grid-load-fail">${r.L("L{CrudManagerView.serverResponseLabel}")} ${n.message}</div>`:""}\n                </div>`)}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){this.onCrudManagerRequestFinalize(!0,"sync"),this.refresh()}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}get widgetClass(){}},mg=e=>class extends(e||me){static get $name(){return"PartOfProject"}onIsCreatingToggle(e,t){var n;super.onIsCreatingToggle(e,t),!e.isCreating&&null!==(n=this.project)&&void 0!==n&&n.autoSync&&this.project.sync()}},pg=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){null!=(e=e||{}).eventId&&(e.event=e.eventId),null!=e.resourceId&&(e.resource=e.resourceId),super.construct(e,...t)}get eventResourceKey(){const e=this;return`${e.event?e.eventId:e.getData("eventId")||e.internalId}-${e.resource?e.resourceId:e.getData("resourceId")||e.internalId}`}set(e,t,...n){const r=this.fieldToKeys(e,t);var i,s;"resource"in r&&(r.resourceId=null===(i=r.resource)||void 0===i?void 0:i.id);"event"in r&&(r.eventId=null===(s=r.event)||void 0===s?void 0:s.id);super.set(r,null,...n)}set resourceId(e){const{resource:t}=this;null!=t&&t.isModel&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return this.get("resourceId")||(null===(e=this.resource)||void 0===e?void 0:e.id)}set eventId(e){const{event:t}=this;null!=t&&t.isModel&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return this.get("eventId")||(null===(e=this.event)||void 0===e?void 0:e.id)}get eventName(){var e;return null===(e=this.event)||void 0===e?void 0:e.name}get resourceName(){var e;return null===(e=this.resource)||void 0===e?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){const{event:e,resource:t,unjoinedStores:n,assignmentStore:r}=this,i=null==r?void 0:r.crudManager;let s;return s=r?this.isValid&&e.isPersistable&&(i||!e.hasGeneratedId&&!t.hasGeneratedId):!this.isPhantom&&Boolean(n[0]),s&&super.isPersistable}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?`${this.resourceName} ${this.units}%`:""}};function fg(e){const t=[],n=[];let r;return[function*(){for(r||(r=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),r;){const{value:t,done:i}=r.next();if(i){r=null,e=null;break}n.push(t),yield t}}(),function*(){for(r||(r=e[Symbol.iterator]());n.length&&(yield*n,n.length=0),r;){const{value:n,done:i}=r.next();if(i){r=null,e=null;break}t.push(n),yield n}}()]}class vg{constructor(e){if(this.iterable=n,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=n,new vg(e)}copy(){const[e,t]=fg(this.iterable);return this.iterable=t,new vg(e)}split(){const[e,t]=fg(this.iterable);return[new vg(e),this.derive(t)]}inBatchesBySize(e){return this.derive(function*(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const n=[];for(const r of e)n.length===t&&(yield n,n.length=0),n.push(r);n.length>0&&(yield n)}(this.iterable,e))}filter(e){return this.derive(function*(e,t){let n=0;for(const r of e)t(r,n++)&&(yield r)}(this.iterable,e))}drop(e){return this.derive(function*(e,t){let n=0;for(const r of e)++n>t&&(yield r)}(this.iterable,e))}map(e){return this.derive(function*(e,t){let n=0;for(const r of e)yield t(r,n++)}(this.iterable,e))}reduce(e,t){return function(e,t,n){let r=0,i=n;for(const n of e)i=t(i,n,r++);return i}(this,e,t)}concat(){return this.derive(function*(e){for(const t of e)yield*t}(this.iterable))}uniqueOnly(){return this.derive(function*(e){const t=new Set;for(const n of e)t.has(n)||(t.add(n),yield n)}(this.iterable))}uniqueOnlyBy(e){return this.derive(function*(e,t){const n=new Set;for(const r of e){const e=t(r);n.has(e)||(n.add(e),yield r)}}(this.iterable,e))}every(e){return function(e,t){let n=0;for(const r of e)if(!t(r,n++))return!1;return!0}(this,e)}some(e){return function(e,t){let n=0;for(const r of e)if(t(r,n++))return!0;return!1}(this,e)}takeWhile(e){return this.derive(function*(e,t){let n=0;for(const r of e){if(!t(r,n++))return;yield r}}(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=n,yield*e,e=n}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new bg(this)}}const yg=e=>new vg(e);class bg extends vg{constructor(){super(...arguments),this.elements=[],this.$iterator=n}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new vg(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,n=e.length;for(n>0&&(yield*e);;){if(e.length>n){for(let t=n;t<e.length;t++)yield e[t];n=e.length}if(!t)break;const{value:r,done:i}=t.next();i?(t=this.$iterator=null,this.$iterable=null):(e.push(r),n++,yield r)}}else yield*e}}const Cg=e=>new bg(e),wg=Symbol("MixinIdentity"),Sg=Symbol("MixinStateProperty");let Eg=1;const Dg=e=>class extends e{};class xg{}class Rg{constructor(){this.id=Eg++,this.requirements=[],this.baseClass=xg,this.identitySymbol=n,this.mixinLambda=Dg,this.walkDepthState=n,this.$minimalClass=n,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=class{constructor(){this.baseEl=n,this.sourceEl=n,this.$elementsByTopoLevel=n,this.$topoLevels=n,this.linearizedByTopoLevelsSource=Cg(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return this.$topoLevels!==n?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return this.$elementsByTopoLevel!==n?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let n=e.get(t);return n||(n=[],e.set(t,n)),n}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?yg(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,n=yg(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[n,r])=>(n>e&&(e=n),this.getOrCreateLevel(t,n).push(r),t)),new Map);return this.getOrCreateLevel(n,e+1).push([this.sourceEl]),yg(n).map((([e,n])=>[e,yg(n).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*yg(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}}.new({sourceEl:t,baseEl:Tg(t.baseClass)});const r=t.mixinLambda,i=t.identitySymbol=Symbol(r.name),s=Object.assign((function(e){const t=r(e);return t.prototype[i]=!0,t}),{[wg]:i,[Sg]:t});return Object.defineProperty(s,Symbol.hasInstance,{value:Mg}),t.mixinLambda=s,t}get minimalClass(){return this.$minimalClass!==n?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,r=t.baseClassesIds.get(e);if(r!==n)return r;const i=Eg++;return t.baseClassesIds.set(e,i),i}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const n=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,n)=>{const{cls:r,hash:i}=t,s=i+String.fromCharCode(n.id);let o=e.minimalClassesByLinearHash.get(s);return o||(o=n.mixinLambda(r),n.name=o.name,e.minimalClassesByLinearHash.set(s,o)),t.cls=o,t.hash=s,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,r=Object.assign(n,{[wg]:this.identitySymbol,[Sg]:this,mix:this.mixinLambda,derive:e=>Ag([r,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(r,Symbol.hasInstance,{value:Mg}),r}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>`${t.name}(${e})`),this.baseClass.name)}}Rg.minimalClassesByLinearHash=new Map,Rg.baseClassesIds=new Map;const Tg=e=>Object.getPrototypeOf(e.prototype).constructor[Sg],Mg=function(e){return Boolean(e&&e[this[wg]])},Fg=(e,t)=>Boolean(e&&e[t[wg]]),Ag=(e,t)=>{let r;if(e.length>0){const t=e[e.length-1];i=t,Object.getPrototypeOf(i.prototype).constructor.hasOwnProperty(Sg)||t===xg||(r=t)}var i;const s=[];e.forEach(((t,i)=>{const o=t[Sg];if(o!==n){const e=o.baseClass;if(e!==xg)if(r){if(r!==e){const t=e.prototype.isPrototypeOf(r.prototype),n=r.prototype.isPrototypeOf(e.prototype);if(!t&&!n)throw new Error("Base class mismatch");r=n?e:r}}else r=e;s.push(o)}else if(i!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}));return Rg.new({requirements:s,mixinLambda:t,baseClass:r||xg}).minimalClass};class Ig extends(Ag([],(e=>{e.prototype;return class extends e{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}}}))){}class kg extends(Ag([Ig],(e=>{e.prototype;return class extends e{get eventStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.eventStore}get resourceStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.resourceStore}get assignmentStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore}get dependencyStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null===(e=this.project)||void 0===e?void 0:e.calendarManagerStore}getEventById(e){var t;return null===(t=this.eventStore)||void 0===t?void 0:t.getById(e)}getDependencyById(e){var t;return null===(t=this.dependencyStore)||void 0===t?void 0:t.getById(e)}getResourceById(e){var t;return null===(t=this.resourceStore)||void 0===t?void 0:t.getById(e)}getAssignmentById(e){var t;return null===(t=this.assignmentStore)||void 0===t?void 0:t.getById(e)}getCalendarById(e){var t;return null===(t=this.calendarManagerStore)||void 0===t?void 0:t.getById(e)}}}))){}class Og extends(Ag([Ig,ta],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isLoadingData=!1}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,n){const r=this,{asyncEvents:i,project:s}=r,o=null==i?void 0:i[e];return o&&(!0===o||o[n.action])?(t.trigger.call(r,`${e}PreCommit`,Object.assign({},n)),!s||s.isEngineReady()&&!s.isWritingData?t.trigger.call(r,e,n):r.eventsSuspended||null==s||s.on({dataReady(){t.trigger.call(r,e,n)},once:!0,thisObj:this}),!0):t.trigger.call(r,e,n)}calculateProject(){return this.project}setStoreData(e){var n;this.project&&(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null===(n=this.project)||void 0===n||n.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const n=this.add(e,t);return await this.project.commitAsync(),n}async insertAsync(e,t,n){const r=this.insert(e,t,n);return await this.project.commitAsync(),r}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}}}))){}class Lg extends(Ag([Ig,Oo],(e=>{const t=e.prototype;return class extends e{joinStore(e){let n=!1;if(Fg(e,Og)){const t=e.getProject();!t||t.isRepopulatingStores||this.getProject()||(this.setProject(t),n=!0)}t.joinStore.call(this,e),n&&this.joinProject()}unjoinStore(e,n=!1){t.unjoinStore.call(this,e,n);const r=this.getProject(),i=Fg(e,Og)&&r===e.getProject();r&&!r.isDestroying&&!r.isRepopulatingStores&&i&&(this.leaveProject(n),this.setProject(null)),i&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find((e=>Fg(e,Og)&&!!e.getProject()));return null==e?void 0:e.getProject()}async setAsync(e,t,n){var r;const i=this.set(e,t,n);return await(null===(r=this.project)||void 0===r?void 0:r.commitAsync()),i}async getAsync(e){var t;return await(null===(t=this.project)||void 0===t?void 0:t.commitAsync()),this.get(e)}}}))){}class Pg extends(Ag([Lg,kg,Oo],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}joinProject(){this.invalidate()}leaveProject(e=!1){var n;t.leaveProject.call(this,e),null===(n=this.project)||void 0===n||n.bufferedCommitAsync()}invalidate(){var e;null===(e=this.project)||void 0===e||e.invalidate(this)}getCurrentOrProposed(e){var t;return e in this.$changed?this.$changed[e]:null!==(t=this.get(e))&&void 0!==t?t:null}hasCurrentOrProposed(e){return null!=this.$changed[e]||null!=this.get(e)}propose(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.$changed[r]=e[r]}this.invalidate()}setChanged(e,t,n=!0,r=!1){const i=this;i.$changed[e]=t,r&&(e in i.$beforeChange||(i.$beforeChange[e]=i.get(e)),i.setData(e,t)),n&&i.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){}class _g extends(Ag([Pg],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"string",defaultValue:"day"}]}get startDate(){var e,t;return null!==(t=null!==(e=this._startDate)&&void 0!==e?e:this.get("startDate"))&&void 0!==t?t:null}get endDate(){var e,t;return null!==(t=null!==(e=this._endDate)&&void 0!==e?e:this.get("endDate"))&&void 0!==t?t:null}get duration(){var e,t;return null!==(t=null!==(e=this._duration)&&void 0!==e?e:this.get("duration"))&&void 0!==t?t:null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}getStartDate(){return this.startDate}proposeStartDate(e,t=!0){this._startDate=e,this.propose({startDate:e,keepDuration:t})}async setStartDate(e,t=!0){var n;return this.proposeStartDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){this._endDate=e,this.propose({endDate:e,keepDuration:t})}async setEndDate(e,t=!1){var n;return this.proposeEndDate(e,t),null===(n=this.project)||void 0===n?void 0:n.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,n=!0){this._duration=e,this.propose({duration:e,keepStart:n}),t&&this.propose({durationUnit:t})}async setDuration(e,t,n=!0){var r;return this.proposeDuration(e,t,n),null===(r=this.project)||void 0===r?void 0:r.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var e;const n=this,r=n.$changed,i=n.getCurrentOrProposed("startDate"),s=n.getCurrentOrProposed("endDate"),o=n.getCurrentOrProposed("duration");if(null!=i&&(r.startDate=n._startDate=i),null!=s&&(r.endDate=n._endDate=s),null!=o&&(r.duration=n._duration=o),n.eventStore&&!n.eventStore.isLoadingData){const t=null===(e=n.assignmentStore)||void 0===e?void 0:e.storage.findItem("event",null);if(t)for(const e of t)e.getCurrentOrProposed("event")===n.id&&e.setChanged("event",n)}t.joinProject.call(n)}applyValue(e,n,r,i,s){"startDate"!==n&&"duration"!=n&&"endDate"!==n||(e=!0,this["_"+n]=r),i&&(e=!1),t.applyValue.call(this,e,n,r,i,s)}afterChange(e,n,r,i,s){this.$isCalculating||s||this.setData(this.$changed),t.afterChange.call(this,e,n,r,i,s)}calculateInvalidated(){const e=this,t=e.$changed,r="startDate"in t,i="endDate"in t,s="duration"in t,{startDate:o,endDate:a,duration:l,keepDuration:c,keepStart:d}=t;let u=null;!r||i||s?r||!i||s?r||i||!s?r&&i&&!s?null===o&&null===a?t.duration=null:u="duration":r&&!i&&s?u="endDate":!r&&i&&s?u="startDate":r&&i&&s&&(u=null==l?"duration":null==o?"startDate":"endDate"):null===l?t.endDate=null:!e.hasCurrentOrProposed("startDate")||!d&&e.hasCurrentOrProposed("endDate")?e.hasCurrentOrProposed("endDate")&&(u="startDate"):(d&&t.duration<0&&(t.duration=0),u="endDate"):null===a?t.startDate=null:e.hasCurrentOrProposed("startDate")&&a<e.getCurrentOrProposed("startDate")&&!c?(t.startDate=a,t.duration=0):!e.hasCurrentOrProposed("duration")||!c&&e.hasCurrentOrProposed("startDate")?e.hasCurrentOrProposed("startDate")&&(u="duration"):u="startDate":null===o?t.endDate=null:e.hasCurrentOrProposed("endDate")&&o>e.getCurrentOrProposed("endDate")&&!c?(t.endDate=o,t.duration=0):!e.hasCurrentOrProposed("duration")||!c&&e.hasCurrentOrProposed("endDate")?e.hasCurrentOrProposed("endDate")&&(u="duration"):u="endDate";const h=e.getCurrentOrProposed("startDate"),g=e.getCurrentOrProposed("endDate"),m=e.getCurrentOrProposed("duration"),p=e.getCurrentOrProposed("durationUnit");let f,v;switch(u){case"startDate":t.startDate=Mt.add(g,-m,p);break;case"endDate":f=Mt.as("hour",m,p),v=Mt.as(p,f,"h"),t.endDate=Mt.add(h,v,p);break;case"duration":f=Mt.diff(h,g,"h"),t.duration=Mt.as(p,f,"h")}t.startDate!==n&&(this._startDate=t.startDate),t.endDate!==n&&(this._endDate=t.endDate),t.duration!==n&&(this._duration=t.duration),delete t.keepDuration,delete t.keepStart}}}))){}class $g extends(Ag([Pg],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null===(e=this.assignmentStore)||void 0===e||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this)))),t.joinProject.call(this)}leaveProject(e=!1){if(this.assigned&&!e){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,n,r,i,s){"id"===s.name&&this.assigned.forEach((e=>{e.set("resourceId",r)})),t.applyValue.call(this,e,n,r,i,s)}}}))){}class Hg extends(Ag([Pg],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){const{assignmentStore:i,eventStore:s,resourceStore:o,project:a}=this;let l=!1;if("event"===e){const e=Fg(n,_g)?n:null==s?void 0:s.getById(n);e&&(l=!0),n=e||n}if("resource"===e){const e=Fg(n,$g)?n:null==o?void 0:o.getById(n);e&&(l=!0),n=e||n}t.setChanged.call(this,e,n,r,!0),!i||!l||a.isPerformingCommit||i.isLoadingData||o.isLoadingData||i.skipInvalidateIndices||i.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var e,t;let{event:n=this.event,resource:r=this.resource}=this.$changed;if(null!==n&&!Fg(n,_g)){const t=null===(e=this.eventStore)||void 0===e?void 0:e.getById(n);t&&this.setChanged("event",t,!1)}if(null!==r&&!Fg(r,$g)){const e=null===(t=this.resourceStore)||void 0===t?void 0:t.getById(r);e&&this.setChanged("resource",e,!1)}}finalizeInvalidated(e){var n,r;(null===(n=this.$changed.resource)||void 0===n?void 0:n.isModel)&&(this.$changed.resourceId=this.$changed.resource.id),(null===(r=this.$changed.event)||void 0===r?void 0:r.isModel)&&(this.$changed.eventId=this.$changed.event.id),t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e)}get event(){const e=this.get("event");return Fg(e,_g)?e:null}set resource(e){this.setChanged("resource",e)}get resource(){const e=this.get("resource");return Fg(e,$g)?e:null}}}))){}const jg=Hg;class Bg extends(pg(mg(jg.derive(Oo)))){static get $name(){return"AssignmentModel"}}Bg.exposeProperties(),Bg._$name="AssignmentModel";var Ng=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e,...t){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++){let n=e[t];if(n instanceof Oo||(e[t]=n=this.createRecord(n)),-1!==this.storage.findIndex("eventResourceKey",n.eventResourceKey,!0))throw new Error(`Duplicate assignment Event: ${n.eventId} to resource: ${n.resourceId}`)}return super.add(e,...t)}includesAssignment(e,t){return-1!==this.storage.findIndex("eventResourceKey",`${e}-${t}`,!0)}setStoreData(e){super.setStoreData(e)}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||null==t||!t.isOccurrence)return e;const n=this;return{id:`${t.id}:a${e.id}`,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return n.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const n=this,r=t.id||t,{id:i}=e;let{occurrenceMeta:s}=n;return s||(s=n.occurrenceMeta={}),s[i]||(s[i]={}),s[i][r]||(s[i][r]={})}mapAssignmentsForEvent(e,t,n){e=this.eventStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}mapAssignmentsForResource(e,t,n){e=this.resourceStore.getById(e);const r=Boolean(t),i=Boolean(n);return r||i?e.assignments.reduce(((e,s)=>{const o=r?t(s):s;return i&&!n(o)||e.push(o),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){return(e=this.resourceStore.getById(e))&&e.events}assignEventToResource(e,t,n=(e=>e),r=!1){var i;const s=this,o=r?new Set(e.assignments):null;if(t=Array.isArray(t)?t:[t],null!==(i=s.eventStore)&&void 0!==i&&i.usesSingleAssignment&&e.assignments.length)return s.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];let a=[];return s.suspendAutoCommit(),t.forEach((t=>{const i=s.getAssignmentForEventAndResource(e,t);if(i)r&&o.delete(i);else{const r=n({event:e,resource:t});a.push(r)}})),a=s.add(a),r&&s.remove(Array.from(o)),s.resumeAutoCommit(),a}unassignEventFromResource(e,t){const n=this,r=[];if(!t)return n.removeAssignmentsForEvent(e);Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)n.isEventAssignedToResource(e,t[i])&&r.push(n.getAssignmentForEventAndResource(e,t[i]));return n.remove(r)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){let n;return(e=this.eventStore.getById(e))&&(n=e.assignments)&&(t=this.resourceStore.getById(t))?this.getOccurrence(n.find((e=>e.resource===t)),e):null}};class zg extends(Ag([Og,kg,ta],(e=>{const t=e.prototype;return class extends e{setProject(e){const n=t.setProject.call(this,e);return e&&this.joinProject(e),n}joinProject(e){}onCommitAsync(){}}}))){}const Vg=e=>e instanceof Set||e instanceof Array?yg(e):yg([e]);class Wg extends(Ag([Og],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,n){this.assignmentsForRemoval=Vg(e).toSet();const r=t.remove.call(this,e);return this.assignmentsForRemoval.clear(),r}removeAll(e){this.allAssignmentsForRemoval=!0;const n=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,n}}}))){}const Gg=new Set;class Ug extends(Ag([Wg,zg],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:Hg,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e)||Gg}getResourcesAssignments(e){return this.storage.findItem("resource",e)||Gg}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}linkAssignments(e,t){const n=this.count&&this.storage.findItem(t,null);if(n){for(const r of n){const n=e.getById(r.getCurrentOrProposed(t));n&&r.setChanged(t,n)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach((t=>{var n,r,i;return t.setChanged(e,null!==(i=null!==(r=null===(n=t[e])||void 0===n?void 0:n.id)&&void 0!==r?r:t[e])&&void 0!==i?i:t[e+"Id"])})),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}const Yg=mg(Ug.derive(ia));class qg extends(Ng(Yg)){static get defaultConfig(){return{modelClass:Bg}}}qg._$name="AssignmentStore";var Kg=e=>class extends(e||me){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:n}){super.onRecordIdChange({record:e,oldValue:t,value:n}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}},Xg=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){e.forEach((e=>{e.resource=this}))}getEvents(){return this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const t=e.split(" ");return t[0][0]+(t.length>1?t[t.length-1][0]:"")}};const Zg=$g;class Jg extends(Xg(mg(Zg.derive(wu)))){static get $name(){return"ResourceModel"}}Jg.exposeProperties(),Jg._$name="ResourceModel";class Qg extends(Ag([Og],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var t;super.onDataChange(e),(null===(t=e.removed)||void 0===t?void 0:t.length)&&this.afterResourceRemoval()}remove(e,n){const r=t.remove.call(this,e);return this.afterResourceRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterResourceRemoval(),n}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}processRecord(e,t=!1){const n=this.getById(e.id);if(n&&n!==e)for(const t of n.assigned)t.resource=e;return e}}}))){}class em extends(Ag([Qg,zg],(e=>{const t=e.prototype;return class extends e{static get defaultConfig(){return{modelClass:$g}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}afterLoadData(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"resource")}clear(e){var n;t.clear.call(this,e),null===(n=this.assignmentStore)||void 0===n||n.unlinkAssignments("resource")}}}))){}const tm=mg(em.derive(ia));class nm extends(Kg(tm)){static get defaultConfig(){return{modelClass:Jg}}}nm._$name="ResourceStore";const rm={date:"_dateIndex",startDate:"_startDateIndex"},im=Object.values(rm),sm=Object.freeze([]),{MILLIS_PER_DAY:om}=Lc;class am{constructor(e,t){this.dayTime=t||Lc.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,n){const r=this[rm[e]],i=this.dayTime.dateKey(t);(r[i]||(r[i]=new Set)).add(n)}addEvent(e){var t;let n,r=null===(t=this.dayTime.startOfDay(e.startDate))||void 0===t?void 0:t.getTime();if(r){var i,s;n=null!==(i=null===(s=e.endDate)||void 0===s?void 0:s.getTime())&&void 0!==i?i:r,this.add("startDate",r,e);do{this.add("date",r,e),r+=om}while(r<n)}}clear(){im.forEach((e=>this[e]=Object.create(null)))}get(e,t,n){!this.initialized&&this.initialize();let r,i=this[rm[e]];return t&&(r=this.dayTime.dateKey(t),i=n?[i[r],r]:i[r]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,im.forEach((e=>this[e]=null))}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,n){const r=this[rm[e]][this.dayTime.dateKey(t)];r&&r.delete(n)}removeEvent(e,t,n){var r;let i,s=null===(r=this.dayTime.startOfDay(t))||void 0===r?void 0:r.getTime();if(s){var o;i=null!==(o=null==n?void 0:n.getTime())&&void 0!==o?o:s,this.remove("startDate",s,e);do{this.remove("date",s,e),s+=om}while(s<i)}}sync(e,t,n,r,i){var s,o;n=n||sm;const a=this,l=(t=t||sm).length,c=n.length,d=null==r?void 0:r.length;let u,h,g;if(a.initialized)switch(e){case"clear":a.clear();break;case"splice":if(d)for(t=t.slice(),n=n.slice(),u=0;u<d;u++)n.push(r[u][0]),t.push(r[u][1]);if(c)for(u=0;u<c;u++)g=n[u],a.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=t[u],h.isScheduled&&a.addEvent(h);break;case"reschedule":g=t[0],a.removeEvent(g,(null===(s=i.startDate)||void 0===s?void 0:s.oldValue)||g.startDate,(null===(o=i.endDate)||void 0===o?void 0:o.oldValue)||g.endDate),a.sync("splice",t)}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,n=t.indexOf(e);return n>-1&&t.splice(n,1),!t.length}}const lm=am.prototype;im.forEach((e=>lm[e]=null)),lm.initialized=!1,am._$name="EventDayIndex";const{MIDNIGHT:cm}=Lc,dm=()=>!0,um=e=>!e.isRecurring;var hm=e=>class extends(e||me){static get $name(){return"EventStoreMixin"}construct(e){super.construct(e),this.autoTree=!0,this.dayIndices=null}afterLoadData(){this.syncIndices("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:n,replaced:r}){this.syncIndices(e,t,n,r),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}onModelChange(e,t,n,r,i){("startDate"in n||"endDate"in n)&&this.syncIndices("reschedule",[e],null,null,n),super.onModelChange(...arguments)}set filtersFunction(e){super.filtersFunction=e}get filtersFunction(){const e=super.filtersFunction;return e&&e!==Se.returnTrue?t=>t.meta.isCreating||e(t):e}getEventsInTimeSpan(e,t,n=!0,r=!1){return s.deprecate("Scheduler","5.0.0","`getEventsInTimeSpan` method deprecated, in favor of `getEvents`"),this.getEvents({startDate:e,endDate:t,allowPartial:n,onlyAssigned:r})}getEventsByStartDate(e){return s.deprecate("Scheduler","5.0.0","`getEventsByStartDate` method deprecated, in favor of `getEvents`"),this.getEvents({startDate:e,startOnly:!0})}getEvents({filter:e,date:t,startDate:n,endDate:r,startOnly:i,includeOccurrences:s,allowPartial:o,onlyAssigned:a=!1,dateMap:l=!1,dayTime:c=null,getDateIndex:d}){const u=this,h=arguments[0],{lastDateRange:g,added:m,filtersFunction:p}=u,f=e;if(a&&(h.filter=f?e=>f(e)&&e.resources.length:e=>e.resources.length),"startDate"in h||(n=h.startDate=t),"includeOccurrences"in h||(s=h.includeOccurrences=!0),"allowPartial"in h||(o=h.allowPartial=!i),h.storeFilterFn=u.isFiltered?u.reapplyFilterOnAdd?p:e=>m.includes(e)?u.indexOf(e)>-1:p(e):null,!r)if(n)(r=h.endDate=Mt.clearTime(n)).setDate(r.getDate()+1);else{if(s)throw new Error("getEvents MUST be passed startDate and endDate if recurring occurrences are requested");h.dateFilter=dm}h.dateFilter||(h.dateFilter=i?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate;return t&&!(Mt.clearTime(t)-n)}:o?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&Mt.intersectSpans(t,i,n,r)}:e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=n&&i<=r});const v={startDate:n,endDate:r};return(!g||g.startDate-v.startDate||g.endDate-v.endDate)&&(u.processConfiguredListeners(),u.trigger("loadDateRange",{old:g||{},new:Object.assign({},v)}),u.lastDateRange=v),l?u.getEventsAsMap(h):u.getEventsAsArray(h)}getEventsAsArray({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dayTime:a=null,dateFilter:l,storeFilterFn:c,getDateIndex:d}){const u=this,h=[];if(u.count){let e=n?u.getEventsForResource(n):null;if(!n){const t=u.useDayIndex(a),n=new Set,o=s?"startDate":"date";u.recurringEvents.forEach((e=>{t.dayTime.startOfDay(e.startDate)<=r&&n.add(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){const r=t.get(d?d(e):o,e);null==r||r.forEach((e=>n.add(e)))}e=[...n]}c&&(e=e.filter(c));for(let t=0,{length:n}=e;t<n;t++){const n=e[t];o&&n.isRecurring?h.push.apply(h,n.getOccurrencesForDateRange(r,i).filter(l)):l(n)&&h.push(n)}}return e?h.filter(e):h}getEventsAsMap({filter:e,date:t,resourceRecord:n,startDate:r=t,endDate:i,startOnly:s,includeOccurrences:o=!0,dateMap:a,dayTime:l=null,storeFilterFn:c,getDateIndex:d}){const u=this;if(a.clear?a.clear():a=new Map,u.count){const t=u.useDayIndex(l),h=s?"startDate":"date",g=[],m=t=>(!e||e(t))&&(!c||c(t));if(l=t.dayTime,n)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");u.recurringEvents.forEach((e=>{l.startOfDay(e.startDate)<i&&g.push(e)}));for(const e=new Date(r);e<i;e.setDate(e.getDate()+1)){let[n,r]=t.get(d?d(e):h,e,!0);n&&(n=[...n].filter(um).filter(m),(a.get(r)||a.set(r,[]).get(r)).push(...n))}for(let e=0,{length:t}=g;e<t;e++){const t=g[e],n=(o?t.getOccurrencesForDateRange(r,i):[t]).filter(m);for(let e,t=0,{length:r}=n;t<r;t++){const r=n[t],i=l.startOfDay(r.startDate),o="startDate"===(d?d(i):s?"startDate":"date")?Mt.add(i,1,"day"):r.endDate||Mt.add(r.startDate,r.duration,r.durationUnit);for(;i<o;i.setDate(i.getDate()+1)){const t=l.dateKey(i);(e=a.get(t))||a.set(t,e=[]),e.push(r)}}}}return a}forEachScheduledEvent(e,t=this){this.forEach((n=>{const{startDate:r,endDate:i}=n;if(r&&i)return e.call(t,n,r,i)}))}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach((n=>{n.startDate&&(e=Mt.min(n.startDate,e)),n.endDate&&(t=Mt.max(n.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(e,t,n,r){const i=new Set(this.getEventsForResource(r));if(null!=n&&n.isAssignment){n.event.resources.forEach((e=>{e.id!==n.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))}))}if(n){const e=n.isAssignment?n.event:n;i.delete(e)}return!Array.from(i).some((n=>n.isScheduled&&Mt.intersectSpans(e,t,n.startDate,n.endDate)))}filterEventsForResource(e,t,n=this){return e.getEvents(this).filter(t.bind(n))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,r=!1){return this.assignmentStore.assignEventToResource(e,t,n,r)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,n){const r=this,i=Oo.asId(n),s=r.assignmentStore.getAssignmentForEventAndResource(e,t);s?s.resourceId=i:r.assignmentStore.assignEventToResource(e,n)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}invalidateDayIndices(){var e;null===(e=this.dayIndices)||void 0===e||e.forEach((e=>e.invalidate()))}registerDayIndex(e){const t=this,n=t.dayIndices||(t.dayIndices=[]);let r,i;for(i=0;!r&&i<n.length;++i)n[i].matches(e)&&(r=n[i]).register(e);return!r&&n.push(r=new am(t,e)),r}syncIndices(...e){var t;null===(t=this.dayIndices)||void 0===t||t.forEach((t=>t.sync(...e)))}unregisterDayIndex(e){const{dayIndices:t}=this;for(let n=null==t?void 0:t.length;n-- >0;)if(t[n].matches(e)){t[n].unregister(e)&&t.splice(n,1);break}}useDayIndex(e){const t=this,{dayIndices:n}=t;e=e||cm;for(let t=0;n&&t<n.length;++t)if(n[t].matches(e))return n[t];if(e.startShift)throw new Error(`No day index registered for ${e} on ${t.id}`);return t.registerDayIndex(cm)}},gm=e=>class extends e{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0}}construct(e){if(super.construct(e,!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(e){return this.add(e)}get project(){return super.project}set project(e){super.project=e,this.detachListeners("project"),e&&(e.on({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}),e.assignmentStore&&e.assignmentStore.isAssignmentStore&&this.attachToAssignmentStore(e.assignmentStore))}processRecords(e){var t;const{assignmentStore:r}=this,i=[];return e=super.processRecords(e,r&&!(null!==(t=this.stm)&&void 0!==t&&t.isRestoring)&&(e=>{const t=e.get("resourceId");e.reassignedFromReplace||null==t||r.includesAssignment(e.id,t)||i.push({id:r.modelClass.generateId(""),resourceId:t,eventId:e.id}),e.reassignedFromReplace=!1})||n),null==r||r.add(i),e}joinRecordsToStore(e){this.assignmentStore?(this.assignmentStore.skipInvalidateIndices=!0,super.joinRecordsToStore(e),this.assignmentStore.storage.invalidateIndices(),this.assignmentStore.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,t=!1){const n=(e=super.processRecord(e,t)).get("resourceId");if(null!=n){const r=this,{assignmentStore:i}=r,s=r.getById(e.id);if(s&&s!==e&&!t){const t=i.find((t=>t.eventId===e.id));t&&(t.resource=n,e.reassignedFromReplace=!0)}else r.$processResourceIds=!0;r.usesSingleAssignment=!0}return e}processResourceIds(){const{assignmentStore:e}=this;if(this.$processResourceIds&&null!=e&&e.isAssignmentStore){const t=[];this.forEach((n=>{const{resourceId:r,id:i}=n;null!=r&&t.push({id:e.modelClass.generateId(""),resourceId:r,eventId:i})})),e.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},e.usesSingleAssignment=!1,e.data=t,e.usesSingleAssignment=!0,this.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const n=this;if(n.removeUnassignedEvent&&!n.isRemoving&&!n.isSettingData&&(null===(t=n.stm)||void 0===t||!t.isRestoring)&&!n.usesSingleAssignment){const t=new Set;e.forEach((n=>{const{event:r}=n;r&&!r.isRemoved&&r.assignments.every((t=>e.includes(t)))&&t.add(r)})),t.size&&n.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.on({name:"assignmentStore",addPreCommit({records:e}){!t.usesSingleAssignment||t.isSettingData||t.isAssigning||e.forEach((e=>{const{event:t}=e;null!=t&&t.isEvent&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.usesSingleAssignment&&e.forEach((e=>{var n;null===(n=t.getById(e.eventId))||void 0===n||n.set("resourceId",null)}))},removeAllPreCommit(){t.usesSingleAssignment&&!t.isSettingData&&t.allRecords.forEach((e=>e.set("resourceId",null)))},update({record:e,changes:n}){if(t.usesSingleAssignment&&"resourceId"in n){const{event:t}=e;t.meta.isAssigning=!0,t.set("resourceId",n.resourceId.value),t.meta.isAssigning=!1}},thisObj:t}))}set data(e){this.isSettingData=!0,this.usesSingleAssignment&&!this.syncDataOnLoad&&this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,t){const{changes:n}=t||{};return n&&"resourceId"in n&&1===Object.keys(n).length&&(t.isAssign=!0),super.trigger(...arguments)}};const mm=Object.freeze([]);var pm=e=>class extends(e||me){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){this.globalOccurrences=new Map,this.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:n,replaced:r}){this.refreshRecurringEventsCache(e,t,n,r),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=mm,n=mm,r){const{recurringEvents:i}=this,s=null==r?void 0:r.length;switch(e){case"clear":i.clear();break;case"splice":if(s){t=t.slice(),n=n.slice();for(let e=0;e<s;e++)n.push(r[e][0]),t.push(r[e][1])}const e=t.length,o=n.length;if(o&&i.size)for(let e=0;e<o;e++){const t=n[e];t.isRecurring&&i.delete(t)}if(e)for(let n=0;n<e;n++){const e=t[n];e.isRecurring&&i.add(e)}}}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,n,r,i){const s=this.isRecurrenceRelatedFieldChange(e,n);if(s&&!r&&e.removeOccurrences(),super.onModelChange(...arguments),s&&!r){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,n){const r=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,n,(e=>r.push(e))),r}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},fm=e=>class extends(pm(e||me)){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}};class vm extends Oo{static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{name:"durationUnit",type:"string",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"},internal:!0},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}afterConstruct(){super.afterConstruct(),this.normalize()}get eventStore(){const e=this;if(e.isOccurrence)return e.recurringTimeSpan.eventStore;var t;e._eventStore||(e._eventStore=null===(t=e.stores)||void 0===t?void 0:t.find((e=>e.isEventStore)));return e._eventStore}normalize(){const e=this,{startDate:t,endDate:n,duration:r,durationUnit:i}=e,s=null!=r;t&&n&&!s?e.setData("duration",Mt.diff(t,n,i,!0)):t&&!n&&s?e.setData("endDate",Mt.add(t,r,i)):!t&&n&&s&&e.setData("startDate",Mt.add(n,-r,i))}get cls(){return this._cls||(this._cls=new on(super.get("cls"))),this._cls}set cls(e){const t=this;t._cls?t._cls.value=e:t._cls=new on(e),t.set("cls",t._cls.value)}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){const n={duration:e=parseFloat(e),durationUnit:t};this.startDate?n.endDate=Mt.add(this.startDate,e,t):this.endDate&&(n.startDate=Mt.add(this.endDate,-e,t)),this.set(n)}getDurationInUnit(e,t){return this.starDate&&this.endDate?Mt.getDurationInUnit(this.startDate,this.endDate,e,t):Mt.as(e,this.duration,this.durationUnit)}get fullDuration(){return new $i({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){"string"==typeof e&&(e=Mt.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const n=this,r={startDate:e};if(e){let i;if(t)i=null!=n.duration;else if(n.endDate){if(r.duration=Mt.diff(e,n.endDate,n.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(r.endDate=Mt.add(e,n.getDurationInUnit("h"),"h"))}else r.duration=null;n.set(r)}setEndDate(e,t=!1){const n=this,r={endDate:e};if(e){let i;if(!0===t)i=null!=n.duration;else if(n.startDate){if(r.duration=Mt.diff(n.startDate,e,n.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(r.startDate=Mt.add(e,-n.duration,n.durationUnit))}n.set(r)}setStartEndDate(e,t,n){this.set({startDate:e,endDate:t},null,n)}get dates(){const e=[],t=Mt.startOf(this.startDate,"day"),n=this.endDate;for(let r=t;r<n;r=Mt.add(r,1,"day"))e.push(r);return e}get startDateMS(){var e;return null===(e=this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)||void 0===e?void 0:e.getTime()}get endDateMS(){var e;return null===(e=this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)||void 0===e?void 0:e.getTime()}get durationMS(){const e=this;return e.endDate&&e.startDate?e.endDateMS-e.startDateMS:Mt.asMilliseconds(e.duration||0,e.durationUnit)}get isMilestone(){return 0===this.durationMS}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:n,duration:r,durationUnit:i=this.durationUnit}=e;return"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof n&&(n=this.getFieldDefinition("endDate").convert(n)),"duration"in e?(t&&!n&&(n=Mt.add(t,r,i,!0,!0)),!t&&n&&(t=Mt.add(n,-r,i,!0,!0))):t&&n&&(r=Mt.as(i,Mt.diff(t,n,"h",!0),"h")),t&&(e.startDate=t),n&&(e.endDate=n),null!=r&&(e.duration=r),e}}inSet(e,t,n,r,i){return i||(e=this.inSetNormalize(e)||e),super.inSet(e,t,n,r,i)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const e=this;return Boolean(e.startDate&&e.endDate&&e.hasValidDates)}get isValid(){let e=!0;if(e){const{startDate:t,endDate:n}=this;e=!t||!n||n-t>=0}return e}get hasValidDates(){const{startDateMS:e,endDateMS:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const n=e;e=t,t=n}return this.setStartDate(Mt.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const n=this.startDate,r=this.endDate;return n&&r&&Mt.intersectSpans(n,r,e,t)}split(e=.5){const t=this,n=t.copy(),{eventStore:r,assignmentStore:i}=t,s=t.duration*e,o=t.duration-s;if(e<=0||e>=1)throw new Error("Split point must be > 0 and < 1");return n.startDate=Mt.add(t.startDate,s,t.durationUnit),n.duration=o,t.duration=s,r&&(r.add(n),i&&!r.usesSingleAssignment&&i.add(t.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:n.id,event:null,resource:null});return delete t.id,t})))),n}toICSString(e={}){if(!this.isScheduled)return"";const t=Mt.toUTC(new Date),n=Mt.toUTC(this.startDate),r=Mt.toUTC(this.endDate),i="YYYYMMDDTHHmmss",o=e.DTSTAMP||Mt.format(t,i)+"Z";delete e.DTSTAMP;let a={};if(this.allDay){const e="YYYYMMDD";a={"DTSTART;VALUE=DATE":Mt.format(n,e),"DTEND;VALUE=DATE":Mt.format(r,e)}}else a={DTSTART:Mt.format(n,i)+"Z",DTEND:Mt.format(r,i)+"Z"};const l={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:`-//Bryntum AB//Bryntum Scheduler ${s.scheduler&&s.getVersion("scheduler")||s.calendar&&s.getVersion("calendar")||""} //EN`,END:"VCALENDAR"},c=d(d(d(d({BEGIN:"VEVENT",UID:this.id+"@bryntum.com",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:o},a),this.recurrenceRule?{RRULE:this.recurrenceRule}:{}),e),{},{END:"VEVENT"}),u=Object.keys(l).map((e=>`${e}:${l[e]}`)),h=Object.keys(c).map((e=>`${e}:${c[e]}`));return u.splice(u.length-1,0,...h),u.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});r.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(e){return!!this.getFieldDefinition(e)||n}isFieldModified(e){return"fullDuration"===e?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}}vm._$name="TimeSpan";const ym=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,bm=["SU","MO","TU","WE","TH","FR","SA"];class Cm extends me{static decodeDay(e){let t,n;return(t=ym.exec(e))&&(n=[bm.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),n.push(t[1]))),n}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+bm[e]}static decode(e){let t,n=[];if(e)for(let r=0;r<e.length;r++)(t=this.decodeDay(e[r]))&&n.push(t);return n}static encode(e){let t,n=[];if(e)for(let r=0;r<e.length;r++)(t=this.encodeDay(e[r]))&&n.push(t);return n}}Cm._$name="RecurrenceDayRuleEncoder";const wm=/ly$/i,Sm=e=>{const t=e.replace(wm,"");return"DAI"===t?"DAY":t},Em=(e,t,n,r)=>r.buildOccurrence(e,n),Dm=e=>xm=e;let xm;class Rm extends me{static processIterationConfig(e){const{recurrence:t}=e,{frequency:n,interval:r,timeSpan:i,endDate:s,count:o}=t;if(!e.syncingStartDate&&!i.meta.isSyncedWithRule){const s=Mt.add(i.startDate,r,Sm(n)),o=Mt.min(s,e.endDate||s);this.forEachDate({syncingStartDate:!0,startDate:i.startDate,endDate:o,recurrence:t,fn:Em})}const a=i.startDate;let{startDate:l=a,endDate:c=s}=e;l<a&&(l=a),s?(!c||c>s)&&(c=s):o&&l>a&&(this.forEachDate({recurrence:t,fn:Dm}),(!c||c>xm)&&(c=xm));const d=l;return e.startOnly||(l=new Date(Mt.max(Mt.add(l,-r,Sm(n)),a))),Object.assign({extraArgs:[],startOnly:!Boolean(i.durationMS)},e,{startDate:l,endDate:c,timeSpan:i,timeSpanStart:a,earliestVisibleDate:d,durationMS:i.durationMS,spansStart:l<=a&&c>a})}static get frequency(){return"NONE"}static get MAX_OCCURRENCES_COUNT(){return 1e6}static getOccurrenceIndex(e){if(e.isOccurrence)return Mt.diff(e.recurringTimeSpan.startDate,e.startDate,Sm(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,n,r){let i,s,o;if(r){const a=864e5,l=6048e5;r>0?(s=1,o=e):(s=-1,o=t);const c=n-o.getDay();s*c<0&&(r+=s),i=new Date(o.getTime()+(r-s)*l+c*a),(i<e||i>t)&&(i=null)}return i}static buildDate(e,t,n){const r=new Date(e,t,n);if(r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n)return r}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,n,r){const i=e.length,s={};for(let o=0;o<t.length;o++){const a=t[o];if(this.isValidPosition(a)){const t=a>0?e[a-1]:e[i+a];if(t&&!s[t.getTime()]&&(s[t.getTime()]=!0,!1===n.call(r,t)))return!1}}}static isInView(e,t,n,r,i){return(e?t>=n:t.valueOf()+r>n)&&!i.hasException(t)}}Rm._$name="AbstractRecurrenceIterator";class Tm extends Rm{static get frequency(){return"DAILY"}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g}=c,m=n-s,p=864e5*g,f=Math.floor(m/p);let v=c.count,y=0,b=Mt.add(s,f*g,"day");for(r||v||(v=this.MAX_OCCURRENCES_COUNT);!r||b<=r;){if(y++,this.isInView(t,b,o,a,i)&&(r&&b>r||!1===d.apply(h,[b,y,1===y&&l,i,...u])||v&&y>=v))break;b=Mt.add(b,g,"day")}}}Tm._$name="DailyRecurrenceIterator";class Mm extends Rm{static get frequency(){return"WEEKLY"}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m}=c;let p,f,v=0,{count:y}=c,b=Cm.decode(m);for(b&&b.length?b.sort(((e,t)=>e[0]-t[0])):b=[[s.getDay()]],p=Mt.getNext(y||g>1?s:n,"week",0,0),r||y||(y=this.MAX_OCCURRENCES_COUNT);!r||p<=r;){for(let e=0;e<b.length;e++)if(f=Mt.copyTimeValues(Mt.add(p,b[e][0],"day"),s),f>=s){if(v++,this.isInView(t,f,o,a,i)&&(r&&f>r||!1===d.apply(h,[f,v,1===v&&l,i,...u])||y&&v>=y))return}p=Mt.getNext(p,"week",g,0)}}}Mm._$name="WeeklyRecurrenceIterator";class Fm extends Rm{static get frequency(){return"MONTHLY"}static getNthDayOfMonth(e,t){const n=Mt.daysInMonth(e);let r=null;return t&&Math.abs(t)<=n&&(r=new Date(e.getFullYear(),e.getMonth(),t<0?n+t+1:t)),r}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=Cm.decode(m),y=f&&f.length,b={};let C,w,S,E,D,x,{monthDays:R}=c,T=0;for(w=Mt.startOf(p||g>1?s:n,"month"),S=new Date(Mt.getNext(w,"month",1)-1),R&&R.length||v&&v.length||(R=[s.getDate()]),v&&v.length&&v.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!r||r>=w)&&(!p||T<p);){if(E=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),x=n;x<=r;x++)(D=this.getNthDayInPeriod(w,S,t,x))&&(D=Mt.copyTimeValues(D,s),b[D.getTime()]||(b[D.getTime()]=!0,E.push(D)))})),E.sort(((e,t)=>e-t)),!y)for(x=0;x<E.length;x++)if(D=E[x],D>=s){const e=this.isInView(t,D,o,a,i);if(T++,e&&(r&&D>r||!1===d.apply(h,[D,T,1===T&&l,i,...u])||p&&T>=p))return!1}}else{const e=[];for(x=0;x<R.length;x++)(D=this.getNthDayOfMonth(w,R[x]))&&!b[D.getTime()]&&(b[D.getTime()]=!0,e.push(D));for(e.sort(((e,t)=>e-t)),x=0;x<e.length;x++)if(D=Mt.copyTimeValues(e[x],s),y)E.push(D);else if(D>=s){const e=this.isInView(t,D,o,a,i);if(T++,e&&(r&&D>r||!1===d.apply(h,[D,T,1===T&&l,i,...u])||p&&T>=p))return}}y&&E.length&&this.forEachDateAtPositions(E,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,n&&(!r||e<=r)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),w=Mt.getNext(w,"month",g),S=new Date(Mt.getNext(w,"month",1)-1)}}}Fm._$name="MonthlyRecurrenceIterator";class Am extends Rm{static get frequency(){return"YEARLY"}static forEachDate(e){const{startOnly:t,startDate:n,endDate:r,timeSpan:i,timeSpanStart:s,earliestVisibleDate:o,durationMS:a,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:m,count:p,positions:f}=c,v=Cm.decode(m),y=f&&f.length,b={};let C,w,S,E,D,x,{months:R}=c,T=0;for(E=Mt.startOf(p||g>1?s:n,"year"),D=new Date(Mt.getNext(E,"year",1)-1),R&&R.sort(((e,t)=>e-t)),R&&R.length||v&&v.length||(R=[s.getMonth()+1]),v&&v.length&&v.forEach((e=>{e[1]&&(x=x||{},x[e[0]]=e[1])}));(!r||r>=E)&&(!p||T<p);){if(S=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let n=1,r=53;for(e[1]&&(n=r=e[1]),C=n;C<=r;C++)(w=this.getNthDayInPeriod(E,D,t,C))&&(w=Mt.copyTimeValues(w,s),b[w.getTime()]||(b[w.getTime()]=!0,S.push(w)))})),S.sort(((e,t)=>e-t)),!y)for(C=0;C<S.length;C++)if(w=S[C],w>=s){const e=this.isInView(t,w,o,a,i);if(T++,e&&(r&&w>r||!1===d.apply(h,[w,T,1===T&&l,i,...u])||p&&T>=p))return}}else for(C=0;C<R.length;C++)if((w=this.buildDate(E.getFullYear(),R[C]-1,s.getDate()))&&(w=Mt.copyTimeValues(w,s),!b[w.getTime()]))if(b[w.getTime()]=!0,y)S.push(w);else if(w>=s){const e=t?w>=o:w.valueOf()+a>o&&!i.hasException(w);if(T++,e&&(r&&w>r||!1===d.apply(h,[w,T,1===T&&l,i,...u])||p&&T>=p))return}y&&S.length&&this.forEachDateAtPositions(S,f,(e=>{if(e>=s){const n=t?e>=o:e.valueOf()+a>o&&!i.hasException(e);if(T++,n&&(!r||e<=r)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||p&&T>=p))return!1}})),E=Mt.getNext(E,"year",g),D=new Date(Mt.getNext(E,"year",1)-1)}}}Am._$name="YearlyRecurrenceIterator";const Im={};function km(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function Om(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function Lm(e,t){return String(e)===String(t)}function Pm(e){return this.defaultValue&&e===n?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?n:e)}[Tm,Mm,Fm,Am].forEach((e=>{Im[e.frequency]=e}));class _m extends Oo{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:Pm},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:Pm},{name:"days",convert:Om,isEqual:Lm},{name:"monthDays",convert:km,isEqual:Lm},{name:"months",convert:km,isEqual:Lm},{name:"positions",convert:km,isEqual:Lm}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return Im[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push(`FREQ=${e.frequency}`),e.interval>1&&t.push(`INTERVAL=${e.interval}`),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push(`COUNT=${e.count}`),e.endDate&&t.push("UNTIL="+Mt.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this;if(t.beginBatch(),e){const n=e.split(";");for(let e=0,r=n.length;e<r;e++){const r=n[e].split("="),i=r[1];switch(r[0]){case"FREQ":t.frequency=i;break;case"INTERVAL":t.interval=i;break;case"COUNT":t.count=i,t.until=null;break;case"UNTIL":t.endDate=i?Mt.parse(i,t.dateFormat):null,t.count=null;break;case"BYDAY":t.days=i;break;case"BYMONTHDAY":t.monthDays=i;break;case"BYMONTH":t.months=i;break;case"BYSETPOS":t.positions=i}}t.sanitize()}else t.set({frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null});t.endBatch()}construct(e={}){const t=this,{rule:n,timeSpan:r}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),n&&(t.suspendTimeSpanNotifying(),t.rule=n,t.resumeTimeSpanNotifying()),t.timeSpan=r}forEachOccurrence(e,t,n){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn(e,t,r,i){n(i.buildOccurrence(e,r),r,t,e)}})}sanitize(){const e=this,t=e.timeSpan,n=t&&t.startDate;switch(e.beginBatch(),e.isSanitizing=!0,e.frequency){case"DAILY":e.positions=null,e.days=null,e.monthDays=null,e.months=null;break;case"WEEKLY":e.positions=null,e.monthDays=null,e.months=null;const t=e.days;n&&t&&1==t.length&&t[0]==Cm.encodeDay(n.getDay())&&(e.days=null);break;case"MONTHLY":e.monthDays&&e.monthDays.length&&(e.positions=null,e.days=null),e.months=null;const r=e.monthDays;n&&r&&1==r.length&&r[0]==n.getDate()&&(e.monthDays=null);break;case"YEARLY":e.monthDays=null;const i=e.months;n&&i&&1==i.length&&i[0]==n.getMonth()+1&&(e.months=null)}e.isSanitizing=!1,e.endBatch()}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,n){const r=super.afterChange(e,t,n),{timeSpan:i}=this;if(this.isSanitizing||this.sanitize(),i){if("endDate"in t){const e=Mt.clearTime(t.endDate.value),{exceptionDates:n}=i;if(i.removeOccurrencesFrom(e),n)for(const t in n){Mt.parseKey(t)>=e&&delete n[t]}}this.isTimeSpanNotifyingSuspended||i.onRecurrenceChanged()}return r}get count(){return this.get("count")}set count(e){e&&(this.endDate=null),this.set("count",e)}get endDate(){return this.get("endDate")}set endDate(e){e&&(this.count=null),this.set("endDate",e)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}}function $m(e){const t={},{dateFormat:n}=this;return e&&(e="string"==typeof e?e.split(","):Array.isArray(e)?e:[e]).forEach((e=>{"string"==typeof e&&(e=Mt.parse(e,n)),isNaN(e)||(t[Mt.makeKey(e)]=1)})),t}function Hm(e){const t=[],{dateFormat:n}=this;for(const r in e)e[r]&&t.push(Mt.format(Mt.parseKey(r),n));return t}_m._$name="RecurrenceModel";const jm=[];var Bm=e=>class extends(e||vm){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:$m,serialize:Hm,internal:!0}]}remove(){if(!this.isOccurrence)return super.remove(...arguments);this.cancelBatch(),this.detachFromRecurringEvent()}get eventStore(){var e;let t=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!t&&null!==(e=this.firstStore)&&void 0!==e&&e.isRecurringTimeSpansMixin&&(t=this.firstStore),t}get recurrenceModel(){return this._recurrenceModel||_m}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,n){const r=this;let i;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),n&&(n instanceof Date?e.endDate=n:e.count=n)),e=new r.recurrenceModel(e)),e.timeSpan=r,i=e.rule),r.recurrence=e,r.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:`${e.id}-recurrence`})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return jm}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e){var t;const n=e.isTimeSpan?e.occurrenceDate:e;null===(t=this.eventStore)||void 0===t||t.globalOccurrences.delete(this.createRecurrenceKey(n)),this.occurrenceMap.delete(Mt.makeKey(n))}removeOccurrencesFrom(e){this.occurrenceMap.forEach(((t,n)=>{Mt.parseKey(n)>=e&&this.removeOccurrence(t)}))}removeOccurrences(){[this,...this.occurrences].forEach((e=>this.removeOccurrence(e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null===(e=this.recurrence)||void 0===e?void 0:e.rule)||null}get occurrenceDate(){var e;return(null===(e=this.meta.modified)||void 0===e?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return Rm.getOccurrenceIndex(this)}buildOccurrence(e,t){var r;const i=this,{occurrenceMap:s,recurrence:o,meta:a}=i,l=null===(r=i.eventStore)||void 0===r?void 0:r.globalOccurrences,c=i.createRecurrenceKey(e),d=!(e-i.startDate),{fieldMap:u}=i.constructor;let h=null==l?void 0:l.get(c),{duration:g}=i;!i.endDate||!i.allDay&&g||(g=Mt.as(i.durationUnit,i.endDate.getTime()-i.startDate.getTime()));const m=g!==n?Mt.add(e,g,i.durationUnit):n;return h||(t||d?(h=i,d||(i.setStartEndDate(e,m,!0),o.suspendTimeSpanNotifying(),o.sanitize(),o.resumeTimeSpanNotifying()),a.isSyncedWithRule=!0):(h=i.copy({[u.id.dataSource]:c,[u.startDate.dataSource]:e,[u.endDate.dataSource]:m,[u.duration.dataSource]:g}),h.recurringTimeSpan=i),null==l||l.set(c,h),s.set(Mt.makeKey(e),h)),h}createRecurrenceKey(e=this.startDate){return`_generated:${this.id}:${Mt.format(e,"YYYYMMDD")}`}afterChange(e,t,n,...r){const i=this,{eventStore:s}=i;if("recurrenceRule"in t&&(i._recurrence=null,null==s||s.recurringEvents[t.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence){var o,a;const{recurringTimeSpan:e,resource:n,occurrenceIndex:r,recurrence:s}=i,l=(null===(o=t.startDate)||void 0===o?void 0:o.value)||i.startDate,c=s&&e.recurrence.count,d=(null===(a=t.resourceRecords)||void 0===a?void 0:a.value)||i.data.newResource;e.beginBatch(),i.detachFromRecurringEvent(),i.clearChanges(),i.setData("id",i.generateId(e.eventStore)),d&&delete i.data.resourceId,e.eventStore.add(i,!0),i.startDate=l,c&&(i.recurrence.count=c-r),i.assign(d||n),delete i.data.resourceRecords,delete t.resourceRecords,e.endBatch()}else"newExceptionDate"in t&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(t.newExceptionDate.value));return super.afterChange(e,t,n,...r)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:t,occurrenceDate:n,startDate:r}=e;e.recurringTimeSpan=null,t.addExceptionDate(n),e.recurrenceRule&&(t.recurrence.endDate=Mt.add(r,-1,"minute"))}set newExceptionDate(e){if(e){(this.exceptionDates||(this.exceptionDates={}))[Mt.makeKey(e)]=1}}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(e){var t;return null===(t=this.exceptionDates)||void 0===t?void 0:t[Mt.makeKey(e)]}};var Nm=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"$highlight",persist:!1,internal:!0},{name:"stickyContents",internal:!0}]}get resources(){return this.assignments.reduce(((e,t)=>(t.resource&&e.push(t.resource),e)),[])}set resources(e){Array.isArray(e)||(e=[e]);const t=this,n=e.map(t.constructor.asId),r=t.assignments.map((e=>e.resource.id)),{onlyInA:i,onlyInB:s}=Ce.delta(n,r);t.assignmentStore.add(i.map((e=>({resource:e,event:t})))),t.assignmentStore.remove(s.map((e=>t.assignments.find((t=>t.resource.id===e)))))}forEachResource(e,t=this){for(const n of this.resources)if(!1===e.call(t,n))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){let e;var t;this.isOccurrence?e=this.get("startDate"):e=null!==(t=this._startDate)&&void 0!==t?t:super.startDate;return this.allDay&&(e=this.constructor.getAllDayStartDate(e)),e}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){let e;var t;this.isOccurrence?e=this.get("endDate"):e=null!==(t=this._endDate)&&void 0!==t?t:super.endDate;return this.allDay&&(e=this.constructor.getAllDayEndDate(e)),e}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get isEvent(){return!0}get isDraggable(){return this.draggable}get isResizable(){return!this.isMilestone&&this.resizable}get isPersistable(){return super.isPersistable&&!this.meta.isCreating}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach((e=>{e.stores.forEach((t=>{t.updateModifiedBagForRecord(e)}))}))}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null===(e=this.resource)||void 0===e?void 0:e.id}set resourceId(e){this.applyResourceId(e)}applyResourceId(e,t=!1){const n=this,{assignments:r,assignmentStore:i,eventStore:s}=n;if(s)if(null!=e)if(n.skipEnforcingSingleAssignment||(s.usesSingleAssignment=!0),null!=r&&r.length&&e!==r[0].resourceId){const t=Boolean(s.eventsSuspended);t&&i.suspendEvents(),r[0].resource=e,t&&i.resumeEvents()}else i.assignEventToResource(n,e);else i.remove(n.assignments);else t||n.set({resourceId:e})}applyValue(e,t,n,r,i){if(i&&"resourceId"===i.name&&!this.meta.isAssigning){const{eventStore:e}=this;e&&(e.isAssigning=!0),this.applyResourceId(n,!0),e&&(e.isAssigning=!1)}super.applyValue(e,t,n,r,i)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:n}=this;n&&!n.usesSingleAssignment?n.assignEventToResource(this,e,t):(this.resourceId=this.constructor.asId(e),n||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,t=!1){var n;const r=this;e=r.constructor.asId(e),r.meta.removingResource=t,null===(n=r.eventStore)||void 0===n||n.unassignEventFromResource(r,e),r.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){return[...this.incomingDeps]}get successors(){return[...this.outgoingDeps]}get dependencies(){return[...this.incomingDeps,...this.outgoingDeps]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=864e5)return!0;const{endDate:t,startDate:n}=this,r=Mt.clearTime(n);return n&&t?(r.setDate(r.getDate()+1),(t||Mt.add(n,e))>r):void 0}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=Mt.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=Mt.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),Mt.clearTime(e,!0)}static getAllDayDisplayEndDate(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),Mt.clearTime(t,!0).valueOf()===t.valueOf()?t=Mt.add(t,Mt.DAY,-1):e.valueOf()!==t.valueOf()&&(t=Mt.clearTime(t,!0))),t}isEditable(e){switch(e){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(e)}};class zm extends(Ag([Lg],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){for(const t of this.assigned)if(t.resource===e)return t;return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){if(this.getAssignmentFor(e))throw new Error("Resource can't be assigned twice to the same task");const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);if(!t)throw new Error(`Can't unassign resource \`${e}\` from task \`${this}\` - resource is not assigned to the task!`);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){}class Vm extends(Ag([_g,zm],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;const t=null===(e=this.project)||void 0===e?void 0:e.assignmentStore.getEventsAssignments(this);return t?this.$cachedAssignments=t:this.$cachedAssignments}applyValue(e,n,r,i,s){var o;"id"===n&&(null===(o=this.assigned)||void 0===o||o.forEach((e=>e.set("eventId",r)))),t.applyValue.call(this,e,n,r,i,s)}copy(e=null,n=null){const r=t.copy.call(this,e,n);return(Ot.isObject(n)&&!n.skipFieldIdentifiers||!Ot.isObject(n))&&(r.$cachedAssignments=this.assigned),r}}}))){}class Wm extends(Ag([_g],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){}class Gm extends(Ag([_g,Vm,Wm],(e=>{e.prototype;return class extends e{}}))){}const Um=Gm;class Ym extends(Um.derive(vm).mixin(Bm,mg,Nm)){static get $name(){return"EventModel"}}Ym.exposeProperties(),Ym._$name="EventModel";class qm extends(Ag([Og],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var t;super.onDataChange(e),(null===(t=e.removed)||void 0===t?void 0:t.length)&&this.afterEventRemoval()}remove(e,n){const r=t.remove.call(this,e);return this.afterEventRemoval(),r}removeAll(e){const n=t.removeAll.call(this,e);return this.afterEventRemoval(),n}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const n=this.getAssignmentStore();if(n&&!n.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!n.assignmentsForRemoval.has(e)));t.length>0&&n.remove(t)}e.clear();const r=this.getDependencyStore();if(r&&!r.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!r.dependenciesForRemoval.has(e)));e.length>0&&r.remove(e)}t.clear()}processRecord(e,t=!1){var n;if(!(null===(n=this.project)||void 0===n?void 0:n.isRepopulatingStores)){const t=this.getById(e.id);if(t&&t!==e)for(const n of t.assigned)n.event=e}return e}}}))){}class Km extends(Ag([qm,zg],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:Gm}}joinProject(){var e;null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null===(e=this.assignmentStore)||void 0===e||e.linkAssignments(this,"event")}}}))){}const Xm=mg(Km.derive(ia));class Zm extends(Xm.mixin(gm,fm,hm)){static get defaultConfig(){return{modelClass:Ym}}}Zm._$name="EventStore";const Jm=["SS","SF","FS","FF"];class Qm extends Oo{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"}]}get sourceEvent(){return s.deprecate("scheduler","5.0.0","Deprecated in favor of fromEvent"),this.fromEvent}set sourceEvent(e){this.fromEvent=e}get targetEvent(){return s.deprecate("scheduler","5.0.0","Deprecated in favor of toEvent"),this.toEvent}set targetEvent(e){this.targetEvent=e}construct(e){null!=e.from&&(e.fromEvent=e.from),null!=e.to&&(e.toEvent=e.to),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||(null===(e=this.unjoinedStores[0])||void 0===e?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;null!=t&&t.isModel&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){"number"==typeof e?this.set({lag:e}):this.setLag(e)}setLag(e,t){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=Mt.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${Mt.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return new $i({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:n}=e,r=t[0];let i;if(r){const{fromEvent:t,toEvent:n}=e,s=r.crudManager;i=t&&(s||!t.hasGeneratedId)&&n&&(s||!n.hasGeneratedId)}else i=Boolean(n[0]);return i&&super.isPersistable}getSourceEvent(){return s.deprecate("scheduler","5.0.0","Deprecated in favor of fromEvent"),this.fromEvent}getTargetEvent(){return s.deprecate("scheduler","5.0.0","Deprecated in favor of toEvent"),this.toEvent}getDateRange(e=!1){const{fromEvent:t,toEvent:n}=this;if(t&&n&&t.isScheduled&&n.isScheduled){const r=Qm.Type;let i,s;switch(this.type){case r.StartToStart:i=t.startDate,s=n.startDate;break;case r.StartToEnd:i=t.startDate,s=n.endDate;break;case r.EndToEnd:i=t.endDate,s=n.endDate;break;case r.EndToStart:i=t.endDate,s=n.startDate;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:e?i:Mt.min(i,s),end:e?s:Mt.max(i,s)}}return null}highlight(e){const t=this.highlighted?this.highlighted.split(" "):[];t.includes(e)||(this.highlighted=t.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const n=t.split(" "),r=n.findIndex((t=>t===e));r>=0&&(n.splice(r,1),this.highlighted=n.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=Jm[this.type];return e?t:this.type===Qm.Type.EndToStart?"":t}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}get isValid(){const{from:e,to:t,type:n}=this;return"number"==typeof n&&e&&""!==e&&null!=t&&""!==t&&e!==t}get fromEventName(){var e;return(null===(e=this.fromEvent)||void 0===e?void 0:e.name)||""}get toEventName(){var e;return(null===(e=this.toEvent)||void 0===e?void 0:e.name)||""}}Qm.exposeProperties(),Qm._$name="DependencyBaseModel";class ep extends(Ag([Pg],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,n,r){var i,s,o;let a=!1;if("fromEvent"===e||"toEvent"===e){const e=Fg(n,_g)?n:null===(i=this.eventStore)||void 0===i?void 0:i.getById(n);e&&(a=!0),n=e||n}t.setChanged.call(this,e,n,r,!0),!a||this.project.isPerformingCommit||(null===(s=this.dependencyStore)||void 0===s?void 0:s.isLoadingData)||null===(o=this.dependencyStore)||void 0===o||o.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var e,t;let{fromEvent:n,toEvent:r}=this.$changed;if(null!==n&&!Fg(n,_g)){const t=null===(e=this.eventStore)||void 0===e?void 0:e.getById(n);t&&(this.$changed.fromEvent=t)}if(null!==r&&!Fg(r,_g)){const e=null===(t=this.eventStore)||void 0===t?void 0:t.getById(r);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return Fg(e,_g)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return Fg(e,_g)?e:null}}}))){}const tp=ep;class np extends(mg(tp.derive(Qm))){static get $name(){return"DependencyModel"}getTypeFromSides(e,t,n){const r=Qm.Type,i=n?"right":"left",s=n?"left":"right";return e===i?t===i?r.StartToStart:r.StartToEnd:t===s?r.EndToEnd:r.EndToStart}}np.exposeProperties(),np._$name="DependencyModel";var rp=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,t,n,r=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=Array.isArray(e)?e:[e]).reduce(((e,n)=>{n.children&&!r?n.traverse((n=>{e=i(n).reduce(t,e)})):e=i(n).reduce(t,e)}),n),n}mapEventDependencies(e,t,n,r,i){return this.reduceEventDependencies(e,((e,t)=>(n(t)&&e.push(t),e)),[],r,i)}mapEventPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}mapEventSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,((e,t)=>(n(t)&&e.push(t),e)),[],r)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}getEventPredecessors(e){return s.deprecate("scheduler","5.0.0","Superfluous, will be removed in favour of `event.predecessors`"),e.predecessors}getEventSuccessors(e){return s.deprecate("scheduler","5.0.0","Superfluous, will be removed in favour of `event.successors`"),e.successors}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=Oo.asId(e),t=Oo.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}isValidDependency(e,t,n){return 1===arguments.length&&(t=e.to||e.toEvent,e=e.from||e.fromEvent),e instanceof vm&&t instanceof vm?this.project.isValidDependency(e,t,n):null!=e&&null!=t&&e!==t}isValidDependencyToCreate(e,t,n){return this.isValidDependency(e,t,n)}getHighlightedDependencies(e){return this.records.reduce(((t,n)=>(n.isHighlightedWith(e)&&t.push(n),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}};class ip extends(Ag([Og],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,n){this.dependenciesForRemoval=Vg(e).toSet();const r=t.remove.call(this,e);return this.dependenciesForRemoval.clear(),r}removeAll(e){this.allDependenciesForRemoval=!0;const n=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,n}}}))){}const sp=new Set;class op extends(Ag([ip,zg],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:ep,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||sp}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||sp}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){}const ap=mg(op.derive(ia));class lp extends(rp(ap.derive(ia))){static get defaultConfig(){return{modelClass:np}}}lp._$name="DependencyStore";var cp=e=>class extends((e||me).mixin(cg,ug,hg)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}loadCrudManagerData(e,t={}){const n=this,{project:r}=n;n.suspendChangesTracking(),super.loadCrudManagerData(...arguments),null!=e&&e.project&&(n.applyingProjectResponse=!0,Object.assign(r,e.project),n.applyingProjectResponse=!1),n.resumeChangesTracking()}async sync(){const{project:e}=this;let t;this.suspendAutoSync(),e&&await e.commitAsync();try{t=await super.sync()}finally{this.resumeAutoSync(!1)}return t}async applyResponse(e,t,n){var r;const i=this;if(!(i.isDestroyed||null!==(r=i.project)&&void 0!==r&&r.isDestroyed)&&(i.trigger("startApplyResponse"),i.clearCrudStoresChanges({clearRemovedCollection:!1}),await super.applyResponse(e,t,n),i.clearCrudStoresChanges({removeAddedRecords:!1,clearAddedCollection:!1,clearModifiedCollection:!1,clearRemovedCollection:!0}),null!=t&&t.project&&(i.applyingProjectResponse=!0,Object.assign(i,t.project),i.applyingProjectResponse=!1),i.project)){let n=e.type;i.trackResponseType&&(n=t.type||n);const r=`propagating${A.capitalize(n)}Changes`;i[r]=!0,await i.project.commitAsync(),i[r]=!1,this.commitRespondedChanges()}}commitRespondedChanges(){this._changesToClear.forEach(((e,t)=>{Object.entries(e).forEach((([e,n])=>{const r=t.getFieldDefinition(e),i=t[e];(null!=r&&r.isEqual?r.isEqual(i,n):Ot.isEqual(i,n))&&delete t.meta.modified[e]}))})),this._changesToClear.clear()}clearRecordChanges(e,t){super.clearRecordChanges(e,t),this.project&&this._changesToClear.set(e,t)}clearCrudStoresChanges(e={removeAddedRecords:!0,clearAddedCollection:!0,clearModifiedCollection:!0,clearRemovedCollection:!0}){const{removeAddedRecords:t,clearAddedCollection:n,clearModifiedCollection:r,clearRemovedCollection:i}=e;this.forEachCrudStore((e=>{t&&e.remove(this.added,!0),r&&(e.modified.forEach((e=>e.clearChanges(!1))),e.modified.clear()),n&&e.added.clear(),i&&e.removed.clear()}))}};class dp extends vm{static get $name(){return"ResourceTimeRangeModel"}static get fields(){return["resourceId","timeRangeColor"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"timeRanges",nullFieldOnRemove:!0}]}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}}dp._$name="ResourceTimeRangeModel";class up extends ia{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:dp,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}}up._$name="ResourceTimeRangeStore";var hp=e=>class extends(e||Oo){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},eventModelClass:Ym,dependencyModelClass:np,timeRangeModelClass:vm,resourceTimeRangeModelClass:dp,resourceModelClass:Jg,assignmentModelClass:Bg,eventStoreClass:Zm,dependencyStoreClass:lp,resourceStoreClass:nm,assignmentStoreClass:qg,timeRangeStoreClass:ta,resourceTimeRangeStoreClass:up,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangeStore:null,resourceTimeRangeStore:null}}static get configurable(){return{json:null}}get inlineData(){return A.safeJsonParse(super.json)}set inlineData(e){this.json=e}construct(e={}){super.construct(...arguments);const t=this;t.timeRangeStore||(t.timeRangeStore=new t.timeRangeStoreClass({modelClass:t.timeRangeModelClass,storeId:"timeRanges"})),t.resourceTimeRangeStore||(t.resourceTimeRangeStore=new t.resourceTimeRangeStoreClass({modelClass:t.resourceTimeRangeModelClass})),t.resourceTimeRangesData&&(t.resourceTimeRangeStore.data=t.resourceTimeRangesData),t.timeRangesData&&(t.timeRangeStore.data=t.timeRangesData)}toJSON(){const e=this,t={eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON()};return e.eventStore.usesSingleAssignment||(t.assignmentsData=e.assignmentStore.toJSON()),t}get json(){return super.json}changeJson(e){return"string"==typeof e&&(e=A.safeJsonParse(e)),e}updateJson(e){e&&this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}};class gp extends me{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.on({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.on({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.on({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.on({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){let t,n,r=e.added||[];for(n=r.length-1;n>=0;--n)t=r[n],t.isPersistable||r.splice(r.indexOf(t),1);0===r.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}gp._$name="ModelPersistencyManager";const mp=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var i=r>=0?r:Math.max(n-Math.abs(r),0);i<n;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,i=0!==n[0],s=0,o=t.length-1;o>-1;--o){if((r=t[o])===e)return r;if(!(r>e||0===r&&i&&n[1]>e))break;s=o}return t[s]},e.array.nextInvalid=function(e,t,r){for(var i=r[0],s=r[1],o=t.length,a=0===t[o-1]&&0!==i?s:0,l=e,c=t.indexOf(e),d=l;l===(t[c]||a);)if(++l>s&&(l=i),++c===o&&(c=0),l===d)return n;return l},e.array.prev=function(e,t,n){for(var r,i=t.length,s=0!==n[0],o=i-1,a=0;a<i;a++){if((r=t[a])===e)return r;if(!(r<e||0===r&&s&&n[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,r){for(var i=r[0],s=r[1],o=t.length,a=0===t[o-1]&&0!==i?s:0,l=e,c=t.indexOf(e),d=l;l===(t[c]||a);)if(--l<i&&(l=s),-1===--c&&(c=o-1),l===d)return n;return l},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),i=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>i?i:n||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var i=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return i.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):i},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),i=e.dc.extent(r)[1];return n=n>i?i:n||i,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),i=e.dy.extent(r)[1];return n=n>i?i:n||i,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),i=e.s.val(t),s=n>59?60-r:n<=r?60-r+n:n-r,o=new Date(t.getTime()+s*e.MIN-i*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(s+120)*e.MIN-i*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),i=n>59?60-r:n<=r?60-r+n:n-r,s=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&s.getTime()<=t.getTime()&&(s=new Date(t.getTime()+(i+7200)*e.SEC)),s},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?1:n||i,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),i=e.wm.extent(r)[1];return n=n>i?i:n||i,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),i=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.start(i);return n=n>s?1:n||s,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],o=e.wy.end(i);return n=n>s?s:n||s,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var r,i=[],s=0;for(var o in t){var a=o.split("_"),l=a[0],c=a[1],d=t[o],u=c?e.modifier[c](e[l],d):e[l];i.push({constraint:u,vals:d}),s++}return i.sort((function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0})),r=i[s-1].constraint,{start:function(t,n){for(var o,a=n,l=e.array[t],c=1e3;c--&&!o&&a;){o=!0;for(var d=0;d<s;d++){var u=i[d].constraint,h=u.val(a),g=u.extent(a),m=l(h,i[d].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?r.start(a):r.end(a)),a},end:function(t,r){for(var o,a=e.array[t+"Invalid"],l=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),c=s-1;c>=0;c--){var d,u=i[c].constraint,h=u.val(r),g=u.extent(r),m=a(h,i[c].vals,g);m!==n&&(!(d=u[t](r,m))||o&&!l(o,d)||(o=d))}return o},tick:function(t,n){return new Date("next"===t?r.end(n).getTime()+e.SEC:r.start(n).getTime()-e.SEC)},tickStart:function(e){return r.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var r=[],i=t.schedules.length,s=[],o=t.exceptions?t.exceptions.length:0,a=0;a<i;a++)r.push(e.compile(t.schedules[a]));for(var l=0;l<o;l++)s.push(e.compile(t.exceptions[l]));function c(t,i,a,l,c){var C,w,S,E=y(t),D=i,x=1e3,R=[],T=[],M=[],F="next"===t,A=F?0:1,I=F?1:0;if(!(a=a?new Date(a):new Date)||!a.getTime())throw new Error("Invalid start date.");for(!function(e,t,n,r){for(var i=0,s=t.length;i<s;i++)n[i]=t[i].start(e,r)}(t,r,R,a),function(t,n,r,i){for(var s=0,o=n.length;s<o;s++){var a=n[s].start(t,i);r[s]=a?[a,n[s].end(t,a)]:e.NEVER}}(t,s,T,a);x--&&D&&(C=b(R,E))&&(!l||!E(C,l));)if(o&&(h(t,s,T,C),w=p(t,T,C)))u(t,r,R,w);else{if(c){var k=f(T,E);w=v(t,r,R,C,k);var O=F?[new Date(Math.max(a,C)),w?new Date(l?Math.min(w,l):w):n]:[w?new Date(l?Math.max(l,w.getTime()+e.SEC):w.getTime()+e.SEC):n,new Date(Math.min(a,C.getTime()+e.SEC))];if(S&&O[A].getTime()===S[I].getTime()?(S[I]=O[I],D++):(S=O,M.push(S)),!w)break;u(t,r,R,w)}else M.push(F?new Date(Math.max(a,C)):m(r,R,C,l)),g(t,r,R,C);D--}for(var L=0,P=M.length;L<P;L++){var _=M[L];M[L]="[object Array]"===Object.prototype.toString.call(_)?[d(_[0]),d(_[1])]:d(_)}return 0===M.length?e.NEVER:1===i?M[0]:M}function d(e){return e instanceof Date&&!isNaN(e.valueOf())?new Date(e):n}function u(e,t,n,r){for(var i=y(e),s=0,o=t.length;s<o;s++)n[s]&&!i(n[s],r)&&(n[s]=t[s].start(e,r))}function h(t,n,r,i){for(var s=y(t),o=0,a=n.length;o<a;o++)if(r[o]&&!s(r[o][0],i)){var l=n[o].start(t,i);r[o]=l?[l,n[o].end(t,l)]:e.NEVER}}function g(e,t,n,r){for(var i=0,s=t.length;i<s;i++)n[i]&&n[i].getTime()===r.getTime()&&(n[i]=t[i].start(e,t[i].tick(e,r)))}function m(e,t,n,r){for(var i,s=0,o=t.length;s<o;s++)if(t[s]&&t[s].getTime()===n.getTime()){var a=e[s].tickStart(n);if(r&&a<r)return r;(!i||a>i)&&(i=a)}return i}function p(e,t,n){for(var r,i=y(e),s=0,o=t.length;s<o;s++){var a=t[s];!a||i(a[0],n)||a[1]&&!i(a[1],n)||r&&!i(a[1],r)||(r=a[1])}return r}function f(e,t){for(var n,r=0,i=e.length;r<i;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function v(e,t,n,r,i){for(var s,o=y(e),a=0,l=t.length;a<l;a++){var c=n[a];if(c&&c.getTime()===r.getTime()){var d=t[a].end(e,c);if(i&&(!d||o(d,i)))return i;s&&!o(d,s)||(s=d)}}return s}function y(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function b(e,t){for(var n=e[0],r=1,i=e.length;r<i;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return c("next",1,t,t)!==e.NEVER},next:function(e,t,n){return c("next",e||1,t,n)},prev:function(e,t,n){return c("prev",e||1,t,n)},nextRange:function(e,t,n){return c("next",e||1,t,n,!0)},prevRange:function(e,t,n){return c("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,r){var i,s=e.schedule(r);return t&&function e(){var r=Date.now(),o=s.next(2,r);if(!o[0])return void(i=n);var a=o[0].getTime()-r;a<1e3&&(a=o[1]?o[1].getTime()-r:1e3);i=a<2147483647?setTimeout(t,a):setTimeout(e,2147483647)}(),{isDone:function(){return!i},clear:function(){clearTimeout(i)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout((function s(){i||(t(),r=e.setTimeout(s,n))}),n),i=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){i=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,i,s){return new Date(e,t,n,r,i,s)}:function(e,t,n,r,i,s){return new Date(Date.UTC(e,t,n,r,i,s))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,r,i,s,o,a){return e.date.build(t,r!==n?r-1:0,i!==n?i:1,s||0,o||0,a||0)},e.date.nextRollover=function(t,n,r,i){var s=r.val(t),o=r.extent(t)[1];return(n||o)<=s||n>o?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,n,r,i,s,o){var a=arguments.length;return n=a<2?11:n-1,r=a<3?e.D.extent(e.date.next(t,n+1))[1]:r,i=a<4?23:i,s=a<5?59:s,o=a<6?59:o,e.date.build(t,n,r,i,s,o)},e.date.prevRollover=function(e,t,n,r){return t>=n.val(e)||!t?r.start(r.prev(e,r.val(e)-1)):r.start(e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function o(e,t,n,r,i){var s=n;for(e[t]||(e[t]=[]);s<=r;)e[t].indexOf(s)<0&&e[t].push(s),s+=i||1;e[t].sort((function(e,t){return e-t}))}function a(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),o(t,"d",n,n),o(t,"dc",r,r)}function l(e,t,r,i,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=i-1),null!==(d=s(e,c,l))?o(g,r,d,d):null!==(d=s(e.replace("W",""),c,l))?function(e,t,r){var i={},s={};1===r?(o(t,"D",1,3),o(t,"d",n.MON,n.FRI),o(i,"D",2,2),o(i,"d",n.TUE,n.FRI),o(s,"D",3,3),o(s,"d",n.TUE,n.FRI)):(o(t,"D",r-1,r+1),o(t,"d",n.MON,n.FRI),o(i,"D",r-1,r-1),o(i,"d",n.MON,n.THU),o(s,"D",r+1,r+1),o(s,"d",n.TUE,n.FRI)),e.exceptions.push(i),e.exceptions.push(s)}(t,g,d):null!==(d=s(e.replace("L",""),c,l))?a(h,g,d,i-1):2===(u=e.split("#")).length?a(h,g,d=s(u[0],c,l),s(u[1])):function(e,t,n,r,i,a){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");r=s(u[0],a,i),i=s(u[1],a,i)||i}o(t,n,r,i,c)}(e,g,r,i,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var t,n,r,s,o={schedules:[{}],exceptions:[]},a=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((r=a[(n=i[t])[0]])&&"*"!==r&&"?"!==r){var c,u=(s=r.split(",").sort(d)).length;for(c=0;c<u;c++)l(s[c],o,t,n[1],n[2],n[3])}return o}(t?u:"0 "+u)},e.parse.recur=function(){var t,n,r,i,s,o,a,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=s?e+"_"+s:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],i){for(r=[],l=d;l<=u;l+=i)r.push(l);c={n:e,x:i,c:n.length,m:u}}var g=(r=o?[d]:a?[u]:r).length;for(l=0;l<g;l+=1){var m=r[l];n.indexOf(m)<0&&n.push(m)}r=i=s=o=a=0}return{schedules:d,exceptions:u,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return s="a",r=[e],this},before:function(e){return s="b",r=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return g("fd"),this},customModifier:function(t,n){var i=e.modifier[t];if(!i)throw new Error("Custom modifier "+t+" not recognized!");return s=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return g(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,n){return t[c.n]=t[c.n].splice(0,c.c),i=c.x,g(c.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var r,i=e.parse.recur,s=0,o="",a={eof:/^$/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},l={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function c(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function d(e){var t,n,r,i,a,l,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),a=s;!t||t.type===u;){l=-1,n=o.substring(a),t=c(a,a,o.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(r=(i=d[h]).exec(n))&&0===r.index&&r[0].length>l&&(t=c(a,a+(l=r[0].length),n.substring(0,l),i));t.type===u&&(a=t.endPos)}return t}function u(e){var t=d(e);return s=t.endPos,t}function h(e){for(var t=+b(e),n=v(a.through)?+b(e):t,r=[],i=t;i<=n;i++)r.push(i);return r}function g(e){for(var t=h(e);v(a.and);)t=t.concat(h(e));return t}function m(e){var t,n,r,i;v(a.weekend)?e.on(l.sun,l.sat).dayOfWeek():v(a.weekday)?e.on(l.mon,l.tue,l.wed,l.thu,l.fri).dayOfWeek():(t=b(a.rank),e.every(t),n=f(e),v(a.start)?(t=b(a.rank),e.startingOn(t),y(n.type)):v(a.between)&&(r=b(a.rank),v(a.and)&&(i=b(a.rank),e.between(r,i))))}function p(e){v(a.first)?e.first():v(a.last)?e.last():e.on(g(a.rank)),f(e)}function f(e){var t=y([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(t.type){case a.second:e.second();break;case a.minute:e.minute();break;case a.hour:e.hour();break;case a.dayOfYear:e.dayOfYear();break;case a.dayOfWeek:e.dayOfWeek();break;case a.dayInstance:e.dayOfWeekCount();break;case a.day:e.dayOfMonth();break;case a.weekOfMonth:e.weekOfMonth();break;case a.weekOfYear:e.weekOfYear();break;case a.month:e.month();break;case a.year:e.year();break;default:r=s}return t}function v(e){var t=d(e).type===e;return t&&u(e),t}function y(e){var t=u(e);return t.type?t.text=function(e,t){var n=e;switch(t){case a.time:var r=e.split(/(:|am|pm)/),i="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],s=r[2].trim();n=(1===i.length?"0":"")+i+":"+s;break;case a.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case a.monthName:case a.dayName:n=l[e.substring(0,3)]}return n}(t.text,e):r=s,t}function b(e){return y(e).text}return function(e){s=0,o=e,r=-1;for(var t=i();s<o.length&&r<0;){switch(y([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]).type){case a.every:m(t);break;case a.after:d(a.time).type!==n?(t.after(b(a.time)),t.time()):(t.after(b(a.rank)),f(t));break;case a.before:d(a.time).type!==n?(t.before(b(a.time)),t.time()):(t.before(b(a.rank)),f(t));break;case a.onthe:p(t);break;case a.on:t.on(g(a.dayName)).dayOfWeek();break;case a.of:t.on(g(a.monthName)).month();break;case a.in:t.on(g(a.yearIndex)).year();break;case a.at:for(t.on(b(a.time)).time();v(a.and);)t.on(b(a.time)).time();break;case a.and:break;case a.also:t.and();break;case a.except:t.except();break;default:r=s}}return{schedules:t.schedules,exceptions:t.exceptions,error:r}}(t.toLowerCase())},e}();mp.date.localTime();class pp extends(Ag([Lg],(e=>{e.prototype;return class extends e{static get fields(){return["name",{name:"startDate",type:"date",format:"YYYY-MM-DDTHH:mm:ssZ"},{name:"endDate",type:"date",format:"YYYY-MM-DDTHH:mm:ssZ"},"recurrentStartDate","recurrentEndDate",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){if(e&&e!==Object(e)&&((e=mp.parse.text(e))!==Object(e)||e.error>0))try{e=JSON.parse(e)}catch(e){return null}return e}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=mp.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=mp.schedule(e)}}}))){}class fp extends(Ag([Og],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:pp}}}}))){}var vp,yp,bp,Cp,wp,Sp,Ep,Dp;!function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(vp||(vp={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(yp||(yp={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(bp||(bp={})),function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"}(Cp||(Cp={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(wp||(wp={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(Sp||(Sp={})),function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"}(Ep||(Ep={})),function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"}(Dp||(Dp={}));const xp=new Date(-864e13),Rp=new Date(864e13);var Tp,Mp;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(Tp||(Tp={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"}(Mp||(Mp={}));class Fp{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new Fp({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new Fp({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=(n=e,Array.from(new Set(n)));var n;return t.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t}}const Ap=(e,t,n=((e,t)=>e-t))=>{let r=0,i=t.length;for(;r<i;){const s=(r+i)/2|0,o=n(e,t[s]);if(0===o)return{found:!0,index:s};o<0?i=s:r=s+1}return{found:!1,index:i}};var Ip;!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(Ip||(Ip={}));class kp{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const n=Ap(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}insertAt(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}setValueAt(e,t){this.values[e]=t}get(e){const t=Ap(e,this.keys,this.comparator);return t.found?this.values[t.index]:n}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:n}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=Ap(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=Ap(e,this.keys,this.comparator);return{found:t.found?Ip.Exact:Ip.Next,index:t.index}}map(e){const t=this.keys,n=this.values,r=[];for(let i=0;i<t.length;i++)r.push(e(n[i],t[i],i));return r}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}}class Op{constructor(e){if(this.points=new kp(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=xp,this.rightInfinityKey=Rp,Object.assign(this,e),this.emptyInterval===n||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=Tp.Left){let n,{found:r,index:i}=this.indexOf(e);return n=t===Tp.Left&&r===Ip.Exact?i:i-1,this.getIntervalWithStartDateIndex(n)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,n){const r=this.points,{found:i,index:s}=r.indexOfKey(e);let o,a;if(i==Ip.Exact){const e=n(a=r.getValueAt(s));r.setValueAt(s,e),o=s+1}else{const t=n(a=r.getValueAt(s-1));r.insertAt(s,e,t),o=s+1}for(;o<r.size();){if(r.getKeyAt(o).getTime()>=t.getTime())break;const e=n(a=r.getValueAt(o));r.setValueAt(o,e),o++}if(o===r.size())r.insertAt(r.size(),t,this.emptyInterval);else{r.getKeyAt(o).getTime()===t.getTime()||r.insertAt(o,t,a)}}includeWrappingRange(e,t,n){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,(e=>this.combineIntervalsFn(e,r.cacheInterval))),!(r.endDate.getTime()>n.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class Lp extends class{constructor(e){this.cacheFilledStartDate=Rp,this.cacheFilledEndDate=xp,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=vp.Day,this.maxCacheExtendCycles=100,this.maxRange=15552e7,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}ensureCacheFilledForInterval(e,t){const n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==Rp.getTime()){const i=e.getTime(),s=t.getTime();if(n<=i&&s<=r)return;if(s<=n)t=new Date(n-1);else if(i>=r)e=new Date(r+1);else if(n<=i&&i<=r)e=new Date(r+1);else{if(!(n<=s&&s<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===Rp.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===xp.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=Rp,this.cacheFilledEndDate=xp,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,n){var r;n=n||this;const i=e.startDate,s=e.endDate,o=i&&i.getTime(),a=s&&s.getTime(),l=null!==(r=e.maxRange)&&void 0!==r?r:this.maxRange,c=!1!==e.isForward;if(c?!i:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const d=this.intervalCache;let u=c?i:s,h=c?i:s;const g=h.getTime();for(let e=1;e<this.maxCacheExtendCycles;e++){c?this.ensureCacheFilledForInterval(u,s||Mt.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(i||Mt.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let e=d.getIntervalOf(h,c?Tp.Left:Tp.Right);for(;e;){const r=e.startDate,u=e.endDate;if(c&&a&&r.getTime()>=a||!c&&o&&u.getTime()<=o)return Mp.FullRangeIterated;if(c&&r.getTime()-g>=l||!c&&g-u.getTime()>=l)return Mp.MaxRangeReached;if(c&&r.getTime()>this.cacheFilledEndDate.getTime()||!c&&u.getTime()<this.cacheFilledStartDate.getTime())break;h=c?u:r;const m=o&&r.getTime()<o?i:r,p=a&&u.getTime()>a?s:u;if(!1===t.call(n,m,p,e.cacheInterval))return Mp.StoppedByIterator;e=c?d.getNextInterval(e):d.getPrevInterval(e)}if(c&&h.getTime()===Rp.getTime()||!c&&h.getTime()===xp.getTime())return Mp.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return Mp.MaxCacheExtendCyclesReached}}{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new Op({emptyInterval:new Fp({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const n=e.getTime(),r=t.getTime();if(n>r)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval((i=>{const s=i.getStartDateSchedule(),o=i.getEndDateSchedule();let a=s.prev(1,e),l=o.next(1,t);if(a!==mp.NEVER&&a.getTime()===n){const t=s.prev(2,e);t!==mp.NEVER&&2===t.length&&(a=t[1])}if(l!==mp.NEVER&&l.getTime()===r){const e=o.next(2,t);e!==mp.NEVER&&2===e.length&&(l=e[1])}const c=s.next(1/0,a!==mp.NEVER?a:e,l!==mp.NEVER?new Date(l.getTime()-1):t);if(c===mp.NEVER)return;const d=o.next(1/0,new Date(c[0].getTime()+1),l!==mp.NEVER?l:t);d.length>c.length?d.length=c.length:d.length<c.length&&(c.length=d.length),c.forEach(((e,t)=>{const n=e,r=d[t];this.intervalCache.addInterval(n,r,(e=>e.includeInterval(i)))}))}))}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval((e=>{this.intervalCache.addInterval(e.startDate,e.endDate,(t=>t.includeInterval(e)))}))}forEachStaticInterval(e){this.intervalStore.forEach((t=>{t.isStatic()&&e(t)}))}forEachRecurrentInterval(e){this.intervalStore.forEach((t=>{t.isRecurrent()&&e(t)}))}}class Pp extends(Ag([pp],(e=>{e.prototype;return class extends e{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}}))){}class _p extends(Ag([Lg],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},"intervals"]}get intervalStoreClass(){return fp}afterConstruct(){t.afterConstruct.call(this);const e=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass;this.intervalStore=new this.intervalStoreClass({calendar:this,modelClass:e}),this.intervals&&this.intervals.length&&this.addIntervals(this.intervals)}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,n){return this.calendarCache.forEachAvailabilityInterval(e,t,n)}accumulateWorkingTime(e,t,n){if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let r=e;return this.forEachAvailabilityInterval(n?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,i,s)=>{let o=!0;if(s.getIsWorking()){const s=e.getTimezoneOffset()-i.getTimezoneOffset(),a=i.getTime()-e.getTime()+60*s*1e3;t<=a?(r=n?new Date(e.getTime()+t):new Date(i.getTime()-t),t=0,o=!1):(r=n?i:e,t-=a)}return o})),{finalDate:new Date(r),remainingDurationInMs:t}}calculateDurationMs(e,t){let n=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,r)=>{if(r.getIsWorking()){const r=e.getTimezoneOffset()-t.getTimezoneOffset();n+=t.getTime()-e.getTime()+60*r*1e3}})),n}calculateEndDate(e,t){const n=t>=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}calculateStartDate(e,t){const n=t<=0,r=this.accumulateWorkingTime(e,Math.abs(t),n);return 0===r.remainingDurationInMs?r.finalDate:null}skipNonWorkingTime(e,t=!0){let n;const r=this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,r,i)=>{if(i.getIsWorking())return n=t?e:r,!1}));return r===Mp.MaxRangeReached||r===Mp.FullRangeIterated?"empty_calendar":n?new Date(n):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(this.$calendarCache!==n)return this.$calendarCache;const e=new Pp({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new Lp({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=n}resetPriorityOfAllIntervals(){this.traverse((e=>{e.intervalStore.forEach((e=>e.resetPriority()))}))}insertChild(e,n,r){let i=t.insertChild.call(this,...arguments);return Array.isArray(i)||(i=[i]),i.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),i}joinProject(){t.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){t.leaveProject.call(this),this.intervalStore.setProject(null),this.intervalStore.destroy(),this.clearCache()}doDestroy(){this.leaveProject(),super.doDestroy()}isDayHoliday(e){const t=Mt.clearTime(e),n=Mt.getNext(e,vp.Day);let r=!1;return this.forEachAvailabilityInterval({startDate:t,endDate:n,isForward:!0},((e,t,n)=>(r=n.getIsWorking(),!r))),!r}getDailyHolidaysRanges(e,t){const n=[];for(e=Mt.clearTime(e);e<t;)this.isDayHoliday(e)&&n.push({startDate:e,endDate:Mt.getStartOfNextDay(e,!0,!0)}),e=Mt.getNext(e,vp.Day);return n}getNonWorkingTimeRanges(e,t){const n=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,r)=>{if(!r.getIsWorking()){const i=r.intervals[0];n.push({name:i.name,startDate:e,endDate:t})}})),n}isWorkingTime(e,t){const n=this.skipNonWorkingTime(e);return!(!n||"empty_calendar"===n)&&n<t}}}))){}class $p extends(Ag([_p,Pg],(e=>{e.prototype;return class extends e{}}))){}class Hp extends(Ag([Og],(e=>{e.prototype;return class extends e{doDestroy(){const e=[];this.traverse((t=>e.push(t))),super.doDestroy(),e.forEach((e=>e.destroy()))}}}))){}class jp extends(Ag([Hp,zg],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:$p}}}}))){}class Bp extends(Ag([],Be)){}class Np extends(Ag([],br)){}class zp extends(Ag([Bp,Np,Oo],(e=>{const t=e.prototype;return class extends e{get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1,t.construct.call(this,e),this.silenceInitialCommit=!("silenceInitialCommit"in e)||e.silenceInitialCommit}repopulateStore(e){}repopulateReplica(){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}}}))){}class Vp extends(Ag([],Be)){}class Wp extends(Ag([],br)){}class Gp extends(Ag([zp,kg,Vp,Wp,Oo],(e=>{const t=e.prototype;class n extends e{static get defaultConfig(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:Gm,assignmentModelClass:Hg,resourceModelClass:$g,dependencyModelClass:ep,calendarModelClass:$p,eventStoreClass:Km,assignmentStoreClass:Ug,resourceStoreClass:em,dependencyStoreClass:op,calendarManagerStoreClass:jp,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){this.$invalidated=new Set,this.isPerformingCommit=!1,this.silenceInitialCommit=!0,this.ongoing=Promise.resolve(),t.construct.call(this,e),this.defaultCalendar=new this.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this;const{calendarsData:n,eventsData:r,dependenciesData:i,resourcesData:s,assignmentsData:o}=this;Boolean(n||r||i||s||o)?(this.loadInlineData({calendarsData:n,eventsData:r,dependenciesData:i,resourcesData:s,assignmentsData:o}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.bufferedCommitAsync()}doDestroy(){var e,n,r,i,s,o;const a=this;null===(e=a.eventStore)||void 0===e||e.destroy(),null===(n=a.dependencyStore)||void 0===n||n.destroy(),null===(r=a.assignmentStore)||void 0===r||r.destroy(),null===(i=a.resourceStore)||void 0===i||i.destroy(),null===(s=a.calendarManagerStore)||void 0===s||s.destroy(),a.defaultCalendar.destroy(),null===(o=a.stm)||void 0===o||o.destroy(),t.doDestroy.call(this)}async loadInlineData(e){this.isLoadingInlineData=!0,e.calendarsData&&(this.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(this.resourceStore.data=e.resourcesData),e.assignmentsData&&(this.assignmentStore.data=e.assignmentsData),e.eventsData&&(this.eventStore.data=e.eventsData),e.tasksData&&(this.eventStore.data=e.tasksData),e.dependenciesData&&(this.dependencyStore.data=e.dependenciesData),await this.commitLoad(),this.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((n=>{n!==e.rootNode&&t(n)})):e.forEach(t)}resolveStoreAndModelClass(e,t){const n=(null==t?void 0:t.storeClass)||this[`${e}StoreClass`];let r=null==t?void 0:t.modelClass;return r||(r=this.getDefaultConfiguration()[`${e}ModelClass`]!==n.getDefaultConfiguration().modelClass?n.getDefaultConfiguration().modelClass:this[`${e}ModelClass`]),{storeClass:n,modelClass:r}}get eventStore(){return this.$eventStore}setEventStore(e){this.eventStore=e}set eventStore(e){const t=this,{stm:n}=t,r=t.$eventStore;if(e instanceof ta)e.project=t,n.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:i}=t.resolveStoreAndModelClass("event",e);e=new r(Ot.assign({modelClass:i,project:t,stm:n},e))}if(r&&n.hasStore(r)){n.removeStore(r),t.unJoinStoreRecords(r);const{assignmentsForRemoval:i}=r;i.forEach((t=>{const n=t.event;if(n){const r=e.getById(n.id);r&&(t.event=r,i.delete(t))}})),r.afterEventRemoval()}e.setProject(t),t.$eventStore=e,t.trigger("eventStoreChange",{store:e})}get assignmentStore(){return this.$assignmentStore}setAssignmentStore(e){this.assignmentStore=e}set assignmentStore(e){const t=this,{stm:n}=t,r=t.$assignmentStore;if(r&&n.hasStore(r)&&(n.removeStore(r),t.unJoinStoreRecords(r)),e instanceof ta)e.project=t,n.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:i}=t.resolveStoreAndModelClass("assignment",e);e=new r(Ot.assign({modelClass:i,project:t,stm:n},e))}e.setProject(t),t.$assignmentStore=e,t.trigger("assignmentStoreChange",{store:e})}get resourceStore(){return this.$resourceStore}setResourceStore(e){this.resourceStore=e}set resourceStore(e){const t=this,{stm:n}=t,r=t.$resourceStore;if(e instanceof ta)e.project=t,n.addStore(e),t.joinStoreRecords(e);else{const{storeClass:r,modelClass:i}=t.resolveStoreAndModelClass("resource",e);e=new r(Ot.assign({modelClass:i,project:t,stm:n},e))}if(r&&n.hasStore(r)){n.removeStore(r),t.unJoinStoreRecords(r);const{assignmentsForRemoval:i}=r;i.forEach((t=>{const n=t.resource;if(n){const r=e.getById(n.id);r&&(t.resource=r,i.delete(t))}})),r.afterResourceRemoval()}e.setProject(t),t.$resourceStore=e,t.trigger("resourceStoreChange",{store:e})}get dependencyStore(){return this.$dependencyStore}setDependencyStore(e){this.dependencyStore=e}set dependencyStore(e){const t=this;if(e instanceof ta)e.project=t,t.stm.addStore(e),t.joinStoreRecords(e);else{const{storeClass:n,modelClass:r}=t.resolveStoreAndModelClass("dependency",e);e=new n(Ot.assign({modelClass:r,project:t,stm:t.stm},e))}t.$dependencyStore=e,t.trigger("dependencyStoreChange",{store:e})}get calendarManagerStore(){return this.$calendarManagerStore}setCalendarManagerStore(e){this.calendarManagerStore=e}set calendarManagerStore(e){const t=this;if(e instanceof ta)t.stm.addStore(e);else{const n=(null==e?void 0:e.storeClass)||t.calendarManagerStoreClass,r=(null==e?void 0:e.modelClass)||n.getDefaultConfiguration().modelClass||t.calendarModelClass;e=new n(Ot.assign({modelClass:r,project:t,stm:t.stm},e))}e.setProject(t),t.$calendarManagerStore=e,t.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;var t;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await(t=0,new Promise((e=>setTimeout(e,t)))),!e.isDestroyed){for(const t of e.$invalidated)t.calculateInvalidated();const{isInitialCommit:t,silenceInitialCommit:n}=e,r=t&&n;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const i=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(i.forEach((e=>{var t;return null===(t=e.suspendAutoCommit)||void 0===t?void 0:t.call(e)})),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:t}),r)for(const t of e.$invalidated)t.finalizeInvalidated(!0);else{for(const t of e.$invalidated)t.beginBatch(!0),t.finalizeInvalidated();for(const t of e.$invalidated)t.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),i.forEach((e=>{var t;return null===(t=e.resumeAutoCommit)||void 0===t?void 0:t.call(e)})),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(...e){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new pl(Ot.assign({disabled:!0},e))).on({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return n.applyConfigs=!0,n}))){}const Up=Gp;class Yp extends(hp(Up)){static get $name(){return"ProjectModel"}construct(...e){super.construct(...e),s.isTestEnv&&(r.global.bryntum.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new gp({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}}Yp.applyConfigs=!0,Yp._$name="ProjectModel";class qp extends(dg.mixin(cp,ug,hg)){static get defaultConfig(){return{projectClass:Yp,resourceStoreClass:nm,eventStoreClass:Zm,assignmentStoreClass:qg,dependencyStoreClass:lp,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return Ot.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const t=this;e!==t._project&&(t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}))}get project(){return this._project}get timeRangesStore(){return this.timeRangeStore}get timeRangeStore(){var e;return null===(e=this._timeRangeStore)||void 0===e?void 0:e.store}set timeRangeStore(e){var t;this.setFeaturedStore("_timeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return null===(e=this._resourceTimeRangeStore)||void 0===e?void 0:e.store}set resourceTimeRangeStore(e){var t;this.setFeaturedStore("_resourceTimeRangeStore",e,null===(t=this.project)||void 0===t?void 0:t.resourceTimeRangeStoreClass)}get resourceStore(){var e;return null===(e=this._resourceStore)||void 0===e?void 0:e.store}set resourceStore(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}get eventStore(){var e;return null===(e=this._eventStore)||void 0===e?void 0:e.store}set eventStore(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}get assignmentStore(){var e;return null===(e=this._assignmentStore)||void 0===e?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return null===(e=this._dependencyStore)||void 0===e?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,n){var r;const i=this,s=null===(r=i[e])||void 0===r?void 0:r.store;var o;s!==t&&(t=ta.getStore(t,(null===(o=t)||void 0===o?void 0:o.storeClass)||n),s&&i.removeStore(s),i[e]=t&&{store:t}||null,i.addPrioritizedStore(i[e]));return i[e]}getChangeSetPackage(){const e=super.getChangeSetPackage();return e&&this.eventStore.usesSingleAssignment&&(delete e[this.assignmentStore.storeId],!this.crudStores.some((t=>e[t.storeId])))?null:e}}qp._$name="CrudManager";class Kp extends Oo{static get fields(){return[{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(e){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:n}=t,r=[];let i=Object.getPrototypeOf(t.data).id;if(!i){for(let{length:e}=n,t=e-1;t>=0;t--)r.push(t?n[t].unit:A.capitalize(n[t].unit));i=r.join("And")}return e.includes(i)&&(i+=`-${t.tickWidth}by${t.tickHeight||t.tickWidth}`,e.includes(i)&&(i+=`-${t.bottomHeader.increment}`,e.includes(i)&&(i=Qr.generateId(`${i}-`)))),i}normalizeUnits(){const e=this,{timeResolution:t,headers:n}=e;for(let e=0,{length:t}=n;e<t;e++){const t=n[e];t.unit=Mt.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=Mt.normalizeUnit(t.splitUnit)),"increment"in t||(n[e]=Object.assign({increment:1},t))}t&&(t.unit=Mt.normalizeUnit(t.unit)),e.shiftUnit&&(e.shiftUnit=Mt.normalizeUnit(e.shiftUnit))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:n,mainHeaderLevel:r}=e,i=e.headers=[];if(t.top&&("top"===n&&(e.columnLinesFor=0),"top"===r&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===n&&(e.columnLinesFor=i.length),"middle"===r&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==n?e.columnLinesFor=i.length-1:"bottom"===n&&(e.columnLinesFor=i.length),null==r&&(e.mainHeaderLevel=i.length-1),"bottom"===r&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:n}=t;switch(n){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get mainUnit(){return this.mainHeader}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(Mt.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const n of e.headers)t=t&&Boolean(Mt.normalizeUnit(n.unit));return e.timeResolution&&(t=t&&Mt.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&Mt.normalizeUnit(e.shiftUnit)),t}}Kp._$name="ViewPreset";class Xp extends(Ye(ta)){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:Kp,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const n=e.bottomHeader,r=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||xt[n.unit]-xt[r.unit]||n.increment-r.increment)*this.zoomOrder}))}get storage(){return super.storage}createRecord(e,...t){if(e.base){const t=this.getById(e.base)||Zp.getById(e.base);e=Ot.assign({},e),Object.setPrototypeOf(e,t.data)}return super.createRecord(e,...t)}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let n=e.optionalL(t.id);"string"==typeof n&&t.baseId&&(n=e.optionalL(t.baseId)),n&&"object"==typeof n&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&n.topDateFormat&&(n.middleDateFormat=n.middleDateFormat||n.topDateFormat),t.setData("displayDateFormat",n.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const r=t.headerConfig[e],i=n[e+"DateFormat"];r&&(r.originalDateFormat||(r.originalDateFormat=r.dateFormat),i&&r.renderer&&(r.renderer=null),r.dateFormat=i||r.originalDateFormat)})))}))}}Xp._$name="PresetStore";const Zp=new class extends Xp{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"llll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Hours",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Hours 2",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>`\n                                    <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${Mt.format(e,"HH")}</span>\n                                    <span class="b-sch-calendarcolumn-minutes">${Mt.format(e,"mm")}</span></div>\n                                `}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                    <div class="sch-calendarcolumn-ct">\n                                    <span class="sch-calendarcolumn-hours">${Mt.format(e,"HH")}</span>\n                                    <span class="sch-calendarcolumn-minutes">${Mt.format(e,"mm")}</span>\n                                    </div>\n                                `}]},dayAndWeek:{name:"Days 2",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:e=>Mt.getShortNameOfUnit("week")+"."+Mt.format(e,"WW MMM YYYY")},{unit:"day",dateFormat:"dd DD"}]},weekAndDay:{name:"Days",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks 2",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Weeks 3",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,n)=>Mt.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Years 2",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",dateFormat:"YYYY",increment:5},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","weekAndDay",{width:54,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],listeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const n in e)e[n].id=n,t[n]=this.createRecord(e[n])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:r}=e;t<r;t++){const r=e[t],i="string"==typeof r,s=i?r:r.preset;let o;if(i)o=this.basePresets[s];else{const e=Object.setPrototypeOf(Ot.clone(this.basePresets[s].data),{id:s}),{timeResolution:t}=e,i=e.headers[e.headers.length-1];e.id=n,"width"in r&&(e.tickWidth=r.width),"height"in r&&(e.tickHeight=r.height),"increment"in r&&(i.increment=r.increment),"resolution"in r&&(t.increment=r.resolution),"resolutionUnit"in r&&(t.unit=Mt.getUnitByName(r.resolutionUnit)),o=this.createRecord(e),o.baseId=s}this.add(o)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const n=this.createRecord(Object.assign({id:e},t)),r=this.find((e=>e.equals(n)));if(r)return r;if(!n.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(n),n}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof Kp||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof Kp))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=Ot.merge(Ot.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(Ot.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}};class Jp extends ta{static get defaultConfig(){return{modelClass:vm,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,defaultSpan:1,tickCache:{},viewPreset:null}}construct(e){const t=this;if(t.generateTicksValidatorFn=()=>!0,super.construct(e),t.originalContinuous=t.continuous,t.on({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,n=!1){const r=this,i=r.getAdjustedDates(e.startDate,e.endDate),s={};if(!1!==r.trigger("beforeReconfigure",{startDate:i.startDate,endDate:i.endDate,config:e})){r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate;for(const t in e)s[t]=r[t];if(Object.assign(r,e),!1===r.internalOnReconfigure(n))return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:s})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const n=t.getAdjustedDates(t.startDate,t.endDate,!0),r=t.getAdjustedDates(t.startDate,t.endDate),i=r.startDate,s=r.endDate;if(i>=s)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${i}. End date: ${s}.`);const o=t.unit,a=t.increment||1,l=t.generateTicks(i,s,o,a);t.suspendEvents(),t.data=l;const{count:c}=t;if(0===c){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.resumeEvents();const d=t.last.endDate;t.isContinuous?(t.adjustedStart=n.startDate,t.adjustedEnd=Mt.getNext(c>1?l[c-1].startDate:n.startDate,o,a,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=d);do{t.visibleTickStart=(t.startDate-t.adjustedStart)/(Mt.asMilliseconds(o)*a),t.autoAdjust&&(t.visibleTickStart=Math.floor(t.visibleTickStart)),t.visibleTickStart>=1&&(t.adjustedStart=Mt.getNext(t.adjustedStart,o,a,t.weekStartDay))}while(t.visibleTickStart>=1);do{t.visibleTickEnd=c-(t.adjustedEnd-d)/(Mt.asMilliseconds(o)*a),c-t.visibleTickEnd>=1&&(t.adjustedEnd=Mt.getNext(t.adjustedEnd,o,-1,t.weekStartDay))}while(c-t.visibleTickEnd>=1);t.fullTicks=!t.visibleTickStart&&t.visibleTickEnd===c,t.updateTickCache(!0)}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!((e=Zp.getPreset(e))instanceof Kp))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}set weekStartDay(e){this._weekStartDay=e}get weekStartDay(){return null==this._weekStartDay?Mt.weekStartDay:this._weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this._resolutionUnit}set resolutionUnit(e){this._resolutionUnit=e}get resolutionIncrement(){return this._resolutionIncrement}set resolutionIncrement(e){this._resolutionIncrement=e||1}set mainUnit(e){this._mainUnit=e}get mainUnit(){return this._mainUnit}set shiftUnit(e){this._shiftUnit=e}get shiftUnit(){return this._shiftUnit||this._mainUnit}set shiftIncrement(e){this._shiftIncrement=e}get shiftIncrement(){return this._shiftIncrement||1}set unit(e){this._unit=e}get unit(){return this._unit}set increment(e){this._increment=e}get increment(){return this._increment}get defaultSpan(){return this._defaultSpan}set defaultSpan(e){this._defaultSpan=e}setTimeSpan(e,t,n=!1){t&&e-t==0&&(t=null);const r=this,{startDate:i,endDate:s}=r.getAdjustedDates(e,t);if(r.startDate-i!=0||r.endDate-s!=0)return r.reconfigure({startDate:i,endDate:s},!1,n)}shift(e,t=this.shiftUnit){const n=this;let{startDate:r,endDate:i}=n;n.isFiltered&&(r=n.allRecords[0].startDate,i=n.allRecords[n.allCount-1].endDate);let s=0;do{r=Mt.add(r,e,t),i=Mt.add(i,e,t)}while(s++<100&&!1===n.setTimeSpan(r,i,{preventThrow:!0}))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){const n=this;n.filters.clear(),super.filterBy(((n,r)=>e.call(t,n.data,r))),0===n.count&&(n.trigger("invalidFilter"),n.clearFilters())}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.filtered}getAdjustedDates(e,t,n=!1){const r=this;return t&&e-t==0&&(t=null),e=e||r.startDate,t=t||Mt.add(e,r.defaultSpan,r.mainUnit),r.autoAdjust||n?{startDate:r.floorDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1),endDate:r.ceilDate(t,!1,r.autoAdjust?r.mainUnit:r.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=Mt.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=Mt.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,n,r){const i=this,s=(t=!1!==t)?Mt.clone(i.startDate):null,o=r||i.resolutionIncrement,a=n||(t?i.resolutionUnit:i.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(Mt.diff(s,e,a),o);return Mt.add(s,t,a)}let c=Mt.clone(e);if("week"===a){const e=c.getDay()||7,t=i.weekStartDay||7;c=Mt.add(Mt.startOf(c,"day"),e>=t?t-e:-(7-t+e),"day"),c.getDay()!==t&&23===c.getHours()&&(c=Mt.add(c,1,"hour"))}else{c=Mt.startOf(c,a);const e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,n=l(Mt.get(c,t)-e,o)+e;c=Mt.set(c,t,n)}return c}roundDate(e,t,n=this.resolutionUnit,r=this.resolutionIncrement||1){const i=this,s=Mt.clone(e);switch(t=Mt.clone(t||i.startDate),n){case"week":Mt.startOf(s,"day");let e,o=s.getDay()-i.weekStartDay;return o<0&&(o=7+o),e=1===Math.round(o/7)?7-o:-o,Mt.add(s,e,"day");case"month":const a=Mt.diff(t,s,"month")+Mt.as("month",s.getDay()/Mt.daysInMonth(s)),l=Math.round(a/r)*r;return Mt.add(t,l,"month");case"quarter":return Mt.startOf(s,"month"),Mt.add(s,"month",3-s.getMonth()%3);default:const c=Mt.as(n,Mt.diff(t,s)),d=Mt.as(n,t.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),u=Math.round((c+d)/r)*r;return Mt.add(t,u-d,n)}}ceilDate(e,t,n,r){const i=this;t=!1!==t,r=r||(t?this.resolutionIncrement:1);let s=Mt.clone(e),o=!1,a=n||(t?i.resolutionUnit:i.mainUnit);switch(a){case"minute":o=!Mt.isStartOf(s,"minute");break;case"hour":o=!Mt.isStartOf(s,"hour");break;case"day":case"date":o=!Mt.isStartOf(s,"day");break;case"week":s=Mt.startOf(s,"day"),o=s.getDay()!==i.weekStartDay||!Mt.isEqual(s,e);break;case"month":s=Mt.startOf(s,"day"),o=1!==s.getDate()||!Mt.isEqual(s,e);break;case"quarter":s=Mt.startOf(s,"day"),o=s.getMonth()%3!=0||1!==s.getDate()||!Mt.isEqual(s,e);break;case"year":s=Mt.startOf(s,"day"),o=0!==s.getMonth()||1!==s.getDate()||!Mt.isEqual(s,e)}return o?Mt.getNext(s,a,r,i.weekStartDay):s}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,n){const{include:r}=this;return!!r&&Object.entries(r).some((([r,i])=>{if(!i)return!1;const{from:s,to:o}=i;if(Mt.compareUnits("day",n)>=0&&Mt.getLargerUnit(r)===n&&(s&&Mt.set(e,r,s),o)){let e=n;"day"===n&&(e="date"),Mt.set(t,{[e]:Mt.get(t,e)-1,[r]:o})}if(Mt.compareUnits(r,n)>=0){const t="day"===r?e.getDay():Mt.get(e,r);if(s&&t<s||o&&t>=o)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:n,to:r}=t;t.lengthFactor=Mt.getUnitToBaseUnitRatio(e,Mt.getLargerUnit(e))/(r-n),t.lengthFactorExcl=Mt.getUnitToBaseUnitRatio(e,Mt.getLargerUnit(e))/(r-n-1),t.center=n+n/(t.lengthFactor-1)}}))}generateTicks(e,t,n=this.unit,r=this.increment){const i=this,s=[],o=Boolean(i.include);let a,l,c,d=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t);for(i.tickCache={},o&&i.initExclusion();u<h;){if(a=Mt.getNext(u,n,r,i.weekStartDay),!i.autoAdjust&&a>h&&(a=h),"hour"===n&&r>1&&s.length>0&&0===d){const e=s[s.length-1];d=(e.startDate.getHours()+r)%24-e.endDate.getHours(),0!==d&&(a=Mt.add(a,d,"hour"))}c=!1,o?(l=new Date(a.getTime()),c=i.processExclusion(u,a,n)):l=a,i.generateTicksValidatorFn(u)&&!c&&(s.push({id:s.length+1,startDate:u,endDate:a}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){const t=this,n=t.records,r=e.getTime();let i,s,o,a,l=0,c=n.length-1;if(!n.length||e<n[0].startDate||e>n[c].endDate)return-1;if(t.isContinuous){for(;l<c;)i=l+c+1>>1,r>n[i].endDate.getTime()?l=i+1:r<n[i].startDate.getTime()?c=i-1:l=i;return s=n[l],o=s.startDate.getTime(),r>o&&(a=s.endDate.getTime(),l+=(r-o)/(a-o)),Math.min(Math.max(l,t.visibleTickStart),t.visibleTickEnd)}for(let t=0;t<=c;t++)if(a=n[t].endDate,e<=a)return o=n[t].startDate,s=t+(e>o?(e-o)/(a-o):0),s}getDateFromTick(e,t){const n=this;if(e===n.visibleTickEnd)return n.endDate;const r=Math.floor(e),i=e-r,s=n.getAt(r);if(!s)return null;let o=0===r?n.adjustedStart:s.startDate,a=r===n.count-1&&n.isContinuous?n.adjustedEnd:s.endDate,l=Mt.add(o,i*(a-o),"millisecond");return t&&(l=n[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,n)=>t.tickCache[e.startDate.getTime()]=n)))}dateInAxis(e,t=!1){const n=this,r=n.startDate,i=n.endDate;if(n.isContinuous)return t?Mt.betweenLesserEqual(e,r,i):Mt.betweenLesser(e,r,i);{let r,i,s,o=n.getCount();for(let a=0;a<o;a++)if(s=n.getAt(a),r=s.startDate,i=s.endDate,t&&e<=i||!t&&e<i)return e>=r}return!1}timeSpanInAxis(e,t){const n=this;return t&&t.getTime()!==e.getTime()?n.isContinuous?Mt.intersectSpans(e,t,n.startDate,n.endDate):e<n.startDate&&t>n.endDate||n.getTickFromDate(e)!==n.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:n,endMS:r}=t,{startDateMS:i,endDateMS:s}=e;if(!i||!s)return!1;if(s===i)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>n&&i<r;const o=t.getTickFromDate(e.startDate),a=t.getTickFromDate(e.endDate);return!(o===t.count&&Mt.isEqual(e.startDate,t.last.endDate)||0===a&&Mt.isEqual(e.endDate,t.first.startDate))&&(i<n&&s>r||o!==a)}forEachAuxInterval(e,t=1,n,r=this){let i,s=this.endDate,o=this.startDate,a=0;if(o>s)throw new Error("Invalid time axis configuration");for(;o<s;)i=Mt.min(Mt.getNext(o,e,t,this.weekStartDay),s),n.call(r,o,i,a,i>=s),o=i,a++}}Jp._$name="TimeAxis";class Qp extends(Ye()){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>!Mt.nonWorkingDays[t])).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>Mt.nonWorkingDays[t])).join(",")}static getLegend(e,t){const n=this,{timeSpan:r,interval:i,days:s,monthDays:o,months:a,positions:l}=e,c=t||r.startDate,d={interval:i};let u;switch(e.frequency){case"DAILY":return 1===i?n.L("L{Daily}"):n.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=n.getDaysLegend(s):c&&(d.days=Mt.getDayName(c.getDay())),n.L(1===i?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=n.getDaysLegend(s,l):o&&o.length?(o.sort(((e,t)=>e-t)),d.days=n.arrayToText(o)):c&&(d.days=c.getDate()),n.L(1===i?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=n.getDaysLegend(s,l):d.days=c.getDate(),a&&a.length?(a.sort(((e,t)=>e-t)),u=a.length>2?e=>Mt.getMonthShortName(e-1):e=>Mt.getMonthName(e-1),d.months=n.arrayToText(a,u)):d.months=Mt.getMonthName(c.getMonth()),n.L(1===i?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,t){const n=this,r={position:""};let i;if(t&&t.length&&(r.position=n.arrayToText(t,(e=>n.L(`L{position${e}}`)))),e.length)switch(e.sort(((e,t)=>Cm.decodeDay(e)[0]-Cm.decodeDay(t)[0])),e.join(",")){case n.allDaysValue:r.days=n.L("L{day}");break;case n.workingDaysValue:r.days=n.L("L{weekday}");break;case n.nonWorkingDaysValue:r.days=n.L("L{weekend day}");break;default:i=e.length>2?e=>Mt.getDayShortName(Cm.decodeDay(e)[0]):e=>Mt.getDayName(Cm.decodeDay(e)[0]),r.days=n.arrayToText(e,i)}return n.L("L{daysFormat}",r)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}}Qp._$name="RecurrenceLegend";var ef=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){super.afterConstruct();const e=this,t=e.client||e.grid,{project:n}=t;t.projectSubscribers.push(e),n&&(e.attachToProject(n),e.attachToResourceStore(n.resourceStore),e.attachToEventStore(n.eventStore),e.attachToAssignmentStore(n.assignmentStore),e.attachToDependencyStore(n.dependencyStore),e.attachToCalendarManagerStore(n.calendarManagerStore))}attachToProject(e){this.detachListeners("project"),this._project=e}attachToEventStore(e){this.detachListeners("eventStore")}attachToResourceStore(e){this.detachListeners("resourceStore")}attachToAssignmentStore(e){this.detachListeners("assignmentStore")}attachToDependencyStore(e){this.detachListeners("dependencyStore")}attachToCalendarManagerStore(e){this.detachListeners("calendarManagerStore")}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},tf=e=>class extends(e||me){static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:Yp,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(e){this.getConfig("project"),super.startConfigure(e)}changeProject(e,t){const n=this,{projectStoreNames:r,projectDataNames:i}=n.constructor;if(n.projectCallbacks=new Set,e){if(n.buildingProjectConfig=!0,!e.isModel){if(n.isConfiguring){n._project=e;const{crudManager:t}=n;if(t){const{isCrudManager:e}=t;for(const i of r)t[i]&&(n[i]=t[i],e||delete t[i])}n.getConfig("projectStores");for(const e of i)n.getConfig(e)}const{eventStore:t}=e;t&&!t.isEventStoreMixin&&t.autoLoad&&!t.count&&(t.autoLoad=!1,n.delayAutoLoad=!0),e=n._sharedProject||new n.projectModelClass(e),delete n._project}n.buildingProjectConfig=!1}return e}updateProject(e,t){const n=this,{projectListeners:r,crudManager:i}=n;if(n.detachListeners("projectConsumer"),delete n._crudManager,e){r.thisObj=n,e.on(r),e.isCrudManager?n.crudManager=e:i&&(i.project=e,n.crudManager=i),n.projectSubscribers.forEach((t=>t.attachToProject(e)));for(const t of n.constructor.projectStoreNames)n[t]=e[t];n.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load())}n.trigger("projectChange",{project:e})}changeCrudManager(e){if(!this.buildingProjectConfig)return super.changeCrudManager(e);this._crudManager=e.isCrudManager?e:Object.assign({},e)}onProjectDataReady(){this.projectCallbacks.size&&(this.projectCallbacks.forEach((e=>e())),this.projectCallbacks.clear())}whenProjectReady(e){this.isEngineReady?e():this.projectCallbacks.add(e)}get isEngineReady(){var e,t;return Boolean(null===(e=(t=this.project).isEngineReady)||void 0===e?void 0:e.call(t))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:e}=this.constructor;return e.map((e=>this[e]))}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce(((e,t)=>{const{dataName:n}=this.projectStores[t];return n&&e.push(n),e}),[])}static setupProjectStores(e,t){const{projectStores:n}=e;if(n){const e={name:"projectConsumer",dataReady:"onProjectDataReady"},r={projectListeners:e};for(const i in n){const{dataName:s}=n[i];r[i]=null,s&&Object.defineProperty(t.class.prototype,s,{get(){var e;return null===(e=this.project[i])||void 0===e?void 0:e.records},set(e){const{project:t}=this;this.buildingProjectConfig?t[`${s}Data`]=e:t[i].data=e}}),this.createStoreDescriptor(t,i,n[i],e)}this.setupConfigs(t,r)}}static createStoreDescriptor(e,t,{listeners:n},r){const{prototype:i}=e.class,s=A.capitalize(t);r[`${t}Change`]=function({store:e}){this[t]=e},i[`change${s}`]=function(e,r){var i;const o=this,{project:a}=o,l=null===(i=e)||void 0===i?void 0:i.project;return o.buildingProjectConfig?(l&&l.isProjectModel&&(o._sharedProject=l),void(a[t]=e)):(o.initializingProject||a[t]!==e&&(a[`set${s}`](e),e=a[t]),e!==r&&(n&&(n.thisObj=o,n.name=`${t}Listeners`,o.detachListeners(n.name),e.on(n)),o.projectSubscribers.forEach((t=>{var n;null===(n=t[`attachTo${s}`])||void 0===n||n.call(t,e)}))),e)}}get widgetClass(){}};class nf extends me{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return`<div class="b-sch-clockwrap b-sch-clock-${e.mode||this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${Mt.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${Mt.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${A.encodeHtml(e.text)}</span>\n                </div>`}}}generateContent(e){const t=this,n=e.date,r=t.template(e),i=t.div;return i.innerHTML=r,t.updateDateIndicator(i,n),i.innerHTML}updateDateIndicator(e,t){const n=null==e?void 0:e.querySelector(".b-sch-hour-indicator"),r=null==e?void 0:e.querySelector(".b-sch-minute-indicator");t&&n&&r&&("hour"===this.mode?(n.style.transform=`rotate(${t.getHours()%12*30}deg)`,r.style.transform=`rotate(${6*t.getMinutes()}deg)`):(n.style.transform="none",r.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=Mt.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=Mt.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}}nf._$name="ClockTemplate";class rf extends uo{static get defaultConfig(){return{tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,constrainDragToResource:!0,showTooltip:!0,showExactDropPosition:!1,constrainDragToTimeline:!0,store:null,dragHelperConfig:null,tooltipCls:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){var t;const n=this,{client:r,constrainDragToTimeline:i,constrainDragToResource:o,constrainDragToTimeSlot:a,dragHelperConfig:l}=n,{timeAxisViewModel:c,isHorizontal:d}=r,u=d?o:a,h=d?a:o,g=[];null===(t=n.drag)||void 0===t||t.destroy(),h||g.push({element:r.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),u||g.push({element:r.scrollable.element,direction:"vertical"}),n.drag=Ll.new({name:n.constructor.name,mode:"translateXY",lockX:h,lockY:u,minX:!0,maxX:!0,constrain:!1,cloneTarget:!i,dragWithin:i?null:document.body,hideOriginalElement:!0,outerElement:r.timeAxisSubGridElement,targetSelector:r.eventSelector,scrollManager:i?r.scrollManager:null,transitionDuration:r.transitionDuration,snapCoordinates:({element:e,newX:t,newY:s})=>{if(i&&!n.constrainDragToTimeSlot&&(n.showExactDropPosition||c.snap)){const i=n.dragData,o=c.getDateFromPosition(n.getCoordinate(i.draggedEntities[0],e,[t,s]),"round"),a=o&&c.getPositionFromDate(o);o&&o>=r.startDate&&null!=a&&(d?t=a:s=a)}return{x:t,y:s}},listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",reset:"onDragReset",thisObj:n},monitoringConfig:{scrollables:g}},l,{isElementDraggable:(e,t)=>(!l||!l.isElementDraggable||l.isElementDraggable(e,t))&&n.isElementDraggable(e,t)}),e&&(r.rowManager.on({changeTotalHeight:"updateYConstraint",thisObj:n}),n.dragTipTemplate&&s.deprecate("Scheduler","5.0.0","Deprecated in favor of `tooltipTemplate`, will be removed in 5.0")),n.showTooltip&&(n.clockTemplate=new nf({scheduler:r}))}doDestroy(){var e,t,n;null===(e=this.drag)||void 0===e||e.destroy(),null===(t=this.clockTemplate)||void 0===t||t.destroy(),null===(n=this.tip)||void 0===n||n.destroy(),super.doDestroy()}onBeforeDragStart({context:e,event:t}){const n=this,{client:r}=n,i=r.scheduledEventName,s=n.getMinimalDragData(e,t),o=null==s?void 0:s[`${i}Record`];if(n.disabled||!o||!1===o.isDraggable)return!1;e.pointerStartDate=r.getDateFromXY([e.startClientX,e.startPageY],null,!1);const a=!1!==r.trigger(`before${i}Drag`,d(d({},s),{},{event:t,context:d(d({},e),s)}));return a&&n.updateYConstraint(o),a}set constrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this._constrainDragToTimeSlot=e,this.drag&&(this.drag[t]=e)}get constrainDragToTimeSlot(){return this._constrainDragToTimeSlot}set constrainDragToResource(e){const t=this.client.isHorizontal?"lockY":"lockX";this._constrainDragToResource=e,this.drag&&(this.drag[t]=e)}get constrainDragToResource(){return this._constrainDragToResource}onDragStart({context:e}){const t=this,{client:n}=t;t.currentOverClient=n,t.onMouseOverNewTimeline(n,!0);const r=t.dragData=t.getDragData(e);if(e.element.retainElement=!0,t.showTooltip){const i=r.context.dragProxy?r.context.dragProxy.firstChild:e.element;t.tip?t.tip.showBy(i):(t.tip=new Ws({id:`${n.id}-event-drag-tip`,align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,clippedBy:t.constrainDragToTimeline?[n.timeAxisSubGridElement,n.bodyContainer]:null,forElement:i,getHtml:t.getTipHtml.bind(t),style:"pointer-events:none",cls:t.tooltipCls}),t.tip.on("innerhtmlupdate",t.updateDateIndicator,t))}t.triggerDragStart(r);const{eventMenu:i,taskMenu:s,eventContextMenu:o,taskContextMenu:a}=n.features,l=i||s||o||a;null==l||l.hideContextMenu(!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:n}=this,r=n.element.querySelector(".b-sch-tooltip-enddate");this.clockTemplate.updateDateIndicator(n.element,e),r&&this.clockTemplate.updateDateIndicator(r,t)}onDrag({context:e,event:t}){const n=this,r=n.dragData,i=r.startDate;let s;if(n.constrainDragToTimeline)s=n.client;else{let e=t.target;if(/^touch/.test(t.type)){const t=nn.from(r.context.element,null,!0).center;e=er.elementFromPoint(t.x,t.y)}s=ki.fromElement(e,"timelinebase")}const o=n.client.features.dependencies;if(!s)return void(o&&o.updateDependenciesForTimeSpan(r.draggedEntities[0],r.context.element));s!==n.currentOverClient&&n.onMouseOverNewTimeline(s),n.updateDragContext(e,t),n.triggerEventDrag(r,i);let a=n.checkDragValidity(r,t);a&&"boolean"!=typeof a&&(e.message=a.message||"",a=a.valid),e.valid=!1!==a,n.showTooltip&&n.tip.realign(),o&&o.updateDependenciesForTimeSpan(r.draggedEntities[0],r.context.element.querySelector(s.eventInnerSelector),r.newResource)}onMouseOverNewTimeline(e,t){const n=this,{drag:{lockX:r,lockY:i}}=n,s=[];n.currentOverClient.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||n.currentOverClient.scrollManager.stopMonitoring(),r||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s}),n.currentOverClient=e}onDrop({context:e,event:t}){var n;const r=this,{currentOverClient:i,dragData:s}=r;let o=!1;r.updateDragContext(e,t),null===(n=r.tip)||void 0===n||n.hide(),e.valid&&s.startDate&&s.endDate&&(s.finalize=async(...t)=>{await r.finalize(...t),e.finalize(...t)},i.trigger(`before${i.capitalizedEventName}DropFinalize`,{context:s,event:t}),e.async=s.async,!e.async&&r.isValidDrop(s)&&(o=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)),e.async||r.finalize(s.valid&&e.valid&&o)}onDragAbort({context:e}){var t;const n=this;n.client.currentOrientation.onDragAbort({context:e,dragData:n.dragData}),n.resumeElementRedrawing(n.dragData.record),null===(t=n.tip)||void 0===t||t.hide(),n.triggerDragAbort(n.dragData)}onDragReset({source:e}){var t;const n=this,r=n.currentOverClient;if(null==r||r.scrollManager.stopMonitoring(),e.context&&e.context.started){const{eventBarEls:e}=n.dragData;e[0].classList.remove("b-drag-main"),e.forEach((e=>e.classList.remove("b-dragging")))}null==r||r.element.classList.remove("b-dragging-"+n.currentOverClient.scheduledEventName),!1===(null===(t=n.dragData)||void 0===t?void 0:t.context.valid)&&null!=r&&r.features.dependencies&&(null==r||r.features.dependencies.scheduleDraw(!0)),n.dragData=null}onInternalInvalidDrop(){var e;null===(e=this.tip)||void 0===e||e.hide(),this.triggerAfterDrop(this.dragData,!1),this.drag.abort()}async finalize(e){const t=this,{dragData:n}=t,{context:r,draggedEntities:i}=n;let s;return i.forEach(((e,r)=>{t.resumeElementRedrawing(e),n.eventBarEls[r].classList.remove(t.drag.draggingCls),n.eventBarEls[r].retainElement=!1})),e?(s=t.updateRecords(n),j.isPromise(s)&&(r.async=!0,await s),n.valid?(t.drag.reset(),t.triggerAfterDrop(n,!0)):t.onInternalInvalidDrop()):t.onInternalInvalidDrop(),s}updateDragContext(e,t){const n=this,{drag:r}=n,i=n.dragData,s=n.currentOverClient,{isHorizontal:o}=s,{stickyEvents:a}=s.features,l=i.draggedEntities[0],c=l.isAssignment?l.event:l,d=n.constrainDragToTimeSlot||(o?r.lockX:r.lockY);if(i.browserEvent=t,d)i.timeDiff=0;else{if(s.timeAxis.isContinuous){const{dateConstraints:t}=i,{timeAxisSubGrid:r}=s,{scrollable:o}=r,a=o.viewport,l=s.isHorizontal?e.pageX-a.x+o.x:e.pageY-a.y+o.y,d=s.timeAxisViewModel.getDateFromPosition(l,null,!0),u=i.timeDiff=d-e.pointerStartDate;i.startDate=n.adjustStartDate(i.origStart,u),t&&(i.startDate=Mt.constrain(i.startDate,t.start,new Date(t.end-c.durationMS))),i.endDate=new Date(i.startDate-0+i.duration)}else{const t=n.resolveStartEndDates(e.element);i.valid=Boolean(t.startDate&&t.endDate),i.valid&&(i.startDate=t.startDate,i.endDate=t.endDate)}i.valid&&(i.timeDiff=i.startDate-i.origStart)}if(Object.assign(i,n.getProductDragContext(i)),i.valid)if(i.endDate<=s.timeAxis.startDate||i.startDate>=s.timeAxis.endDate)i.context.valid=!1,i.context.message=n.L("L{EventDrag.noDropOutsideTimeline}");else{const e=!t||n.checkDragValidity(i,t);e&&"boolean"!=typeof e?(i.context.valid=!1!==e.valid,i.context.message=e.message):(i.context.valid=!1!==e,i.context.message="")}else i.context.valid=!1;i.context.valid&&a&&i.eventBarEls.forEach(((e,t)=>a.onEventDrag(e)))}suspendElementRedrawing(e,t=!0){const n=this.getRecordElement(e);n&&(n.retainElement=t),e.instanceMeta(this.client).retainElement=t}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:n,drag:r}=t,{record:i,dateConstraints:s,eventBarEls:o,draggedEntities:a}=t.setupProductDragData(e),{startEvent:l}=r,c=i.isAssignment?i.event:i,d=c.startDate,u=c.endDate,h=n.timeAxis,g=d<h.startDate,m=u>h.endDate,p=t.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),f=t.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);a.forEach((e=>t.suspendElementRedrawing(e))),i.isAssignment?n.selectAssignment(i,l.ctrlKey):n.selectEvent(i,l.ctrlKey);const v={context:e,dateConstraints:s,eventBarEls:o,record:i,draggedEntities:a,sourceDate:g?d:n.getDateFromCoordinate(p),screenSourceDate:n.getDateFromCoordinate(f,null,!1),startDate:d,endDate:u,timeDiff:0,origStart:d,origEnd:u,startsOutsideView:g,endsOutsideView:m,duration:u-d,browserEvent:l};if(o.forEach((e=>{e.classList.add(r.draggingCls),e.classList.remove("b-sch-event-hover"),e.classList.remove("b-active")})),o.length>1)if(t.constrainDragToTimeline?e.relatedElements=o.slice(1):e.relatedElements=o.slice(1).map((e=>{const t=er.getOffsetX(e,r.dragWithin),n=er.getOffsetY(e,r.dragWithin),i=e.offsetWidth,s=e.offsetHeight,o=r.createProxy(e);return er.setTranslateXY(o,t,n),o.style.width=`${i}px`,o.style.height=`${s}px`,r.dragWithin.appendChild(o),e.classList.add("b-drag-original"),r.hideOriginalElement&&e.classList.add("b-hidden"),o})),e.relatedElStartPos=[],e.relatedElDragFromPos=[],t.unifiedDrag){t.client.isAnimating=!0,o.forEach((e=>{e.classList.add("b-drag-animation")})),Tr.onTransitionEnd({element:o[1],property:"transform",handler(){t.client.isAnimating=!1,o.forEach((e=>{e.classList.remove("b-drag-animation")}))},thisObj:t.client,once:!0}),o[0].classList.add("b-drag-main");let[n,r]=er.getTranslateXY(e.element);e.relatedElements.forEach(((t,i)=>{e.relatedElStartPos[i]=er.getTranslateXY(t),n+=10,r+=10,er.setTranslateXY(t,n,r),e.relatedElDragFromPos[i]=[n,r]}))}else e.relatedElements.forEach(((t,n)=>{e.relatedElStartPos[n]=e.relatedElDragFromPos[n]=er.getTranslateXY(t)}));return v}setupConstraints(e,t,n,r){const i=this,s=!i.showExactDropPosition&&n>1?n:0;r?i.setXConstraint(e.left,e.right-t.width,s):i.setXConstraint(!0,!0,s),i.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e){const t=this,{client:n}=t,{context:r}=t.drag,i=n.timeAxisViewModel.snapPixelAmount;if(r&&!t.drag.lockY){let s;if(!t.constrainDragToTimeline)return void t.setYConstraint(null,null,i);s=n.getScheduleRegion(null,e),t.setYConstraint(s.top,s.bottom-r.element.offsetHeight,i)}else t.setYConstraint(null,null,i)}setXConstraint(e,t,n){const{drag:r}=this;r.leftConstraint=e,r.rightConstraint=t,r.minX=e,r.maxX=t}setYConstraint(e,t,n){const{drag:r}=this;r.topConstraint=e,r.bottomConstraint=t,r.minY=e,r.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:n}=t,r=nn.from(e,t.timeAxisSubGridElement),i=this.dragData;let{start:s,end:o}=t.getStartEndDatesFromRectangle(r,"round",i.duration,!n.isContinuous);if(s&&o)if(s=this.adjustStartDate(s,0),i.startsOutsideView)i.endsOutsideView||(s=o&&Mt.add(o,-i.duration,"ms"));else{if(!t.timeAxis.dateInAxis(s,!1)){const e=t.timeAxis.getTickFromDate(s);e>=0&&(s=t.timeAxis.getDateFromTick(e))}o=s&&Mt.add(s,i.duration,"ms")}return{startDate:s,endDate:o}}getTipHtml(){const e=this,{dragData:t,client:n}=e,{startDate:r,endDate:i,draggedEntities:s}=t,o=n.getFormattedDate(r),a=n.getFormattedEndDate(i,r),{valid:l,message:c}=t.context,d=s[0],u=d.isTask?d:d.event;return(e.tooltipTemplate||e.dragTipTemplate)({valid:l,startDate:r,endDate:i,startText:o,endText:a,dragData:t,message:c||"",[n.scheduledEventName+"Record"]:u,startClockHtml:e.clockTemplate.template({date:r,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:u.isMilestone?"":e.clockTemplate.template({date:i,text:a,cls:"b-sch-tooltip-enddate"})})}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,n){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}}rf._$name="DragBase";const sf={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b100-t100"};class of extends(uo.mixin(vc,yc)){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:10,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:30,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated"]}}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.handleSelector||r.isHoverableDevice||(e.handleSize=e.touchHandleSize),e.handleVisibilityThreshold=e.handleVisibilityThreshold||2*e.handleSize,e.dragLock=t.isVertical?"y":"x"}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:n}){var r;this.dragging&&e===(null===(r=this.dragging.context)||void 0===r?void 0:r.eventRecord)&&(t["b-active"]=1,t[this.draggingItemCls]=1,t["b-over-resize-handle"]=1,n["b-resize-handle"]=1,n[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:n,dragging:r}=this,{visibleDateRange:i,isHorizontal:s}=n,o=e[`page${s?"X":"Y"}`]+((null===(t=r.context)||void 0===t?void 0:t.offset)||0),a=n.timeAxisSubGridElement.getBoundingClientRect(),[l,c]=s?[a.left,a.right]:[a.top,a.bottom];r.date=o<l?i.startDate:o>c?i.endDate:n.getDateFromCoordinate(o,null,!1),super.onDragPointerMove(e)}beforeDrag(e){const{client:t}=this;return!this.disabled&&!t.readOnly&&!1!==super.beforeDrag(e)&&(e.mousedownDate=e.date=t.getDateFromCoordinate(e.event["page"+(t.isHorizontal?"X":"Y")],null,!1),this.triggerBeforeResize(e))}dragStart(e){var t;const n=this,{client:r,tip:i}=n,s=r.scheduledEventName,o=r.resolveEventRecord(e.itemElement),{isBatchUpdating:a}=o,l=a?o.get("startDate"):o.startDate,c=a?o.get("endDate"):o.endDate,u="x"===n.dragLock,h=n.isOverEndHandle(e.startEvent,e.itemElement),g=h?"endDate":"startDate",m=h?"startDate":"endDate",p=h?"setEndDate":"setStartDate",f=h?"setStartDate":"setEndDate",v=e.itemElement,y=v.getBoundingClientRect(),b=u?e.startEvent.clientX:e.startEvent.clientY,C=h?u?y.right:y.bottom:u?y.left:y.top,w=r.resolveTimeSpanRecord(v),S=e.context={eventRecord:o,timespanRecord:w,element:v,taskRecord:o,owner:n,valid:!0,oldValue:h?c:l,startDate:l,endDate:c,offset:C-b,edge:u?h?"right":"left":h?"bottom":"top",finalize:n.finalize,event:e.event,draggingEnd:h,toSet:g,otherEnd:m,setMethod:p,setOtherMethod:f};o.meta.isResizing=!0,r.element.classList.add(n.dragActiveCls),r.listenToBatchedUpdates||r.beginListeningForBatchedUpdates(),a||o.beginBatch(),n.setupProductResizeContext(S,e.startEvent),n.triggerEventResizeStart(`${s}ResizeStart`,d({[`${s}Record`]:o,event:e.startEvent},n.getResizeStartParams(S))),S.resizedRecord=(null===(t=r.resolveAssignmentRecord)||void 0===t?void 0:t.call(r,S.element))||o,i&&(i.show(),i.align=sf[e.context.edge],i.showBy(n.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:t}=this,n=t.scheduledEventName,r=t.resolveTimeSpanRecord(e.itemElement);return t.trigger(`before${t.capitalizedEventName}Resize`,d({[n+"Record"]:r,event:e.event},this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})))}triggerEventResizeStart(e,t){this.client.trigger(e,t)}dragEnter(e){return e.context.owner===this}moveDrag(e){const{client:t,tip:n}=this,r=t.isHorizontal?"X":"Y",i=t.scheduledEventName,{dependencies:s}=t.features,{visibleDateRange:o,enableEventAnimations:a,timeAxis:l}=t,{event:c,context:d}=e,{eventRecord:u,offset:h}=d,{isOccurrence:g}=u,m=u.get("startDate"),p=u.get("endDate"),f="x"===this.dragLock,v=c[`client${r}`]+h,y=t.timeAxisSubGridElement.getBoundingClientRect(),[b,C]=f?[y.left,y.right]:[y.top,y.bottom];d.event=c,c.isScroll&&(e.date=t.getDateFromCoordinate(c[`page${r}`]+h,null,!1));let w,S,E,{toSet:D,otherEnd:x,draggingEnd:R}=d;if(w=v<b?e.date=o.startDate:v>C?e.date=o.endDate:e.date,"endDate"===D?w<m&&(S=-1):w>p&&(S=1),S&&this.onDragEndSwitch&&(this.onDragEndSwitch(d,w,S),x=d.otherEnd,R=d.draggingEnd,D=d.toSet),t.snapRelativeToEventStartDate&&(w=l.roundDate(w,d.oldValue)),d.snappedDate=Mt.round(w,l.resolution),Mt.diff(R?d[x]:w,R?w:d[x],t.timeAxis.resolutionUnit)<t.timeAxis.resolutionIncrement)if(this.allowResizeToZero)d.snappedDate=w=d[x];else{const e="startDate"===x?1:-1;d.snappedDate=w=Mt.add(u.get(x),t.timeAxis.resolutionIncrement*e,t.timeAxis.resolutionUnit),E=!0}if(d.dateConstraints&&(w=Mt.constrain(w,d.dateConstraints.start,d.dateConstraints.end),d.snappedDate=Mt.constrain(d.snappedDate,d.dateConstraints.start,d.dateConstraints.end)),!d.date||w-d.date||E){if(d.date=w,d[D]=this.showExactResizePosition||t.timeAxisViewModel.snap?d.snappedDate:w,!(d[D]-d["startDate"===D?"endDate":"startDate"]||this.allowResizeToZero))return void(d.valid=!1);if(u.get(D)-d[D]&&(d.valid=this.checkValidity(d,c),d.message="",d.valid&&"boolean"!=typeof d.valid&&(d.message=d.valid.message,d.valid=d.valid.valid),d.valid=!1!==d.valid,d.valid)){const n={[`${i}Record`]:u,startDate:m,endDate:p,element:e.itemElement,context:d};n[D]=d[D],t.trigger(`${i}PartialResize`,n),g&&u.stores.push(t.eventStore),t.enableEventAnimations=!1,u.set(D,d[D]),t.enableEventAnimations=a,g&&(u.stores.length=0),s&&!s.isDisabled&&s.updateDependenciesForTimeSpan(u,e.itemElement)}}n&&(n.align=sf[e.context.edge],n.alignTo(this.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||Tr.getPagePoint(e.event).equals(Tr.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){e[e.toSet]=e.snappedDate;const{client:n}=this,{startDate:r,endDate:i}=e;let s;this.tip.hide(),e.valid=r&&i&&(this.allowResizeToZero||i-r>0)&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(n.trigger(`before${n.capitalizedEventName}ResizeFinalize`,{context:e,event:t}),s=!0),e.async||await e.finalize(s)}async finalize(e){const t=this.owner,n=this,{eventRecord:r,oldValue:i,toSet:s}=n,{snapRelativeToEventStartDate:o,timeAxis:a}=t.client;let l=!1;e?(o&&(n[s]=n.snappedDate=a.roundDate(n.date,i)),l=await t.internalUpdateRecord(n,r)):r.cancelBatch(),t.cleanup(n,l)}cleanup(e,t){var n;const r=this,{client:i}=r,{element:s,eventRecord:o}=e,{dependencies:a}=i.features,l=i.scheduledEventName;o.meta.isResizing=!1,i.endListeningForBatchedUpdates(),null===(n=r.tip)||void 0===n||n.hide(),r.unHighlightHandle(s),i.element.classList.remove(r.dragActiveCls),a&&(a.scheduleDraw(!0),t&&a.showTerminals(o,s)),i.trigger(`${l}ResizeEnd`,d({changed:t,[`${l}Record`]:o},r.getResizeEndParams(e)))}async internalUpdateRecord(e,t){const{client:n}=this,{generation:r}=t;if(t.isOccurrence)n.endListeningForBatchedUpdates(),t[t.batching>1?"endBatch":"cancelBatch"](),t.set(vm.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate}));else{const r={[e.toSet]:e[e.toSet]};if(t.isEntity){const{startDate:i,endDate:s,draggingEnd:o}=e;e.duration=r.duration=Mt.diff(i,s,t.durationUnit),e.duration=r.duration=t.run("calculateProjectedDuration",i,s),r[e.toSet]=t.run("calculateProjectedXDateWithDuration",o?i:s,o,e.duration),r[e.otherEnd]=e[e.otherEnd],t.set(r),n.endListeningForBatchedUpdates(),t.cancelBatch(),await Promise.all([t[e.setOtherMethod](r[e.otherEnd],!1),t[e.setMethod](r[e.toSet],!1),t.setDuration(e.duration)]),t.endBatch()}else n.endListeningForBatchedUpdates(),t.cancelBatch(),t[e.setMethod](r[e.toSet],!1)}return t.generation!==r}onDragItemMouseMove(e){"touch"===e.pointerType||this.handleSelector||this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:n}=t;if(n&&(!t.allowResize||t.allowResize(n,e))){let r=!1;r="x"===t.dragLock?t.isOverLeftHandle(e,n)||t.isOverRightHandle(e,n):t.isOverTopHandle(e,n)||t.isOverBottomHandle(e,n),r?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){const e=this;e.overItem.querySelector(e.client.eventInnerSelector).classList.add("b-resize-handle"),e.overItem.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){if(e){const t=e.querySelector(this.client.eventInnerSelector);t.classList.remove("b-resize-handle"),t.classList.remove(this.resizingItemInnerCls),e.classList.remove("b-over-resize-handle"),e.classList.remove(this.draggingItemCls)}}isOverAnyHandle(e,t){return this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t)}isOverStartHandle(e,t){return"x"===this.dragLock?this.isOverLeftHandle(e,t):this.isOverTopHandle(e,t)}isOverEndHandle(e,t){return"x"===this.dragLock?this.isOverRightHandle(e,t):this.isOverBottomHandle(e,t)}getDynamicHandleSize(e,t){const n=e?2:1,{handleSize:r}=this;return this.dynamicHandleSize&&r*n>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/n),0):r}isOverLeftHandle(e,t){const n=this,{offsetWidth:r}=t,i=n.client.resolveTimeSpanRecord(t),s=null==i?void 0:i.isResizable;if(!n.disabled&&n.leftHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)&&(!0===s||"start"===s)){const i=nn.from(t);return i.width=n.getDynamicHandleSize(n.rightHandle,r),i.width>0&&i.contains(Tr.getPagePoint(e))}return!1}isOverRightHandle(e,t){const n=this,{offsetWidth:r}=t,i=n.client.resolveTimeSpanRecord(t),s=null==i?void 0:i.isResizable;if(!n.disabled&&n.rightHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)&&(!0===s||"end"===s)){const i=nn.from(t);return i.x=Math.floor(i.right-n.getDynamicHandleSize(n.leftHandle,r)),i.width>0&&i.contains(Tr.getPagePoint(e))}return!1}isOverTopHandle(e,t){const n=this,{offsetHeight:r}=t,i=n.client.resolveTimeSpanRecord(t),s=null==i?void 0:i.isResizable;if(!n.disabled&&n.topHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)&&(!0===s||"start"===s)){const i=nn.from(t);return i.height=n.getDynamicHandleSize(n.bottomHandle,r),i.height>0&&i.contains(Tr.getPagePoint(e))}return!1}isOverBottomHandle(e,t){const n=this,{offsetHeight:r}=t,i=n.client.resolveTimeSpanRecord(t),s=null==i?void 0:i.isResizable;if(!n.disabled&&n.bottomHandle&&(r>=n.handleVisibilityThreshold||n.dynamicHandleSize)&&(!0===s||"end"===s)){const i=nn.from(t);return i.y=Math.floor(i.bottom-n.getDynamicHandleSize(n.bottomHandle,r)),i.height>0&&i.contains(Tr.getPagePoint(e))}return!1}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const n=super.setupDragContext(e);return n.scrollManager=t.client.scrollManager,n}}changeTip(e,t){const n=this;if(e)e.isTooltip?e.owner=n:e=Ws.reconfigure(t,Ws.mergeConfigs({id:`${n.client.id}-event-resize-tip`},e,{getHtml:n.getTipHtml.bind(n),owner:n.client},n.tip),{owner:n,defaults:{type:"tooltip"}}),e.on({innerhtmlupdate:"updateDateIndicator",thisObj:n}),n.clockTemplate=new nf({scheduler:n.client});else if(t){var r;t.destroy(),null===(r=n.clockTemplate)||void 0===r||r.destroy()}return e}isElementResizable(e,t){const n=this,{client:r}=n,i=r.resolveTimeSpanRecord(e);if(r.readOnly)return!1;let s=i&&i.isResizable;const o=(e=er.up(t.target,r.eventSelector))?e.firstElementChild:e,a=t.target.closest('[class$="-handle"]');if(!s||a&&a!==o)return!1;const l=e.classList.contains("b-sch-event-startsoutside"),c=e.classList.contains("b-sch-event-endsoutside");if(!0===s){if(l&&c)return!1;if(l)s="end";else{if(!c)return n.isOverStartHandle(t,e)||n.isOverEndHandle(t,e);s="start"}}return!(l&&"start"===s||c&&"end"===s)&&!!(n.isOverStartHandle(t,e)&&"start"===s||n.isOverEndHandle(t,e)&&"end"===s)}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:t,draggingEnd:n,snappedDate:r}=this.dragging.context,i=n?t.get("startDate"):r,s=n?r:t.get("endDate"),{element:o}=this.tip;e.updateDateIndicator(o.querySelector(".b-sch-tooltip-startdate"),i),e.updateDateIndicator(o.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget(e){const t=this,n=nn.from(e.itemElement,null,!0);return"x"===t.dragLock?("right"===e.context.edge&&(n.x=n.right-1),n.width=t.tip.anchorSize[0]/2):("bottom"===e.context.edge&&(n.y=n.bottom-1),n.height=t.tip.anchorSize[1]/2),{target:n}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{startDate:n,endDate:r,toSet:i,snappedDate:s,valid:o,message:a="",timespanRecord:l}=t.dragging.context;if(!n||!r)return e.html;const c={record:l,valid:o,message:a,startDate:n,endDate:r,[i]:s};return c.startText=t.client.getFormattedDate(c.startDate),c.endText=t.client.getFormattedDate(c.endDate),c.startClockHtml=t.clockTemplate.template({date:c.startDate,text:c.startText,cls:"b-sch-tooltip-startdate"}),c.endClockHtml=t.clockTemplate.template({date:c.endDate,text:c.endText,cls:"b-sch-tooltip-enddate"}),t.tooltipTemplate(c)}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,t){var n,r;const{client:i}=this,{element:s}=e,o=i.resolveEventRecord(s),a=null===(n=i.resolveResourceRecord)||void 0===n?void 0:n.call(i,s),l=null===(r=i.resolveAssignmentRecord)||void 0===r?void 0:r.call(i,s);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:a,assignmentRecord:l,dateConstraints:i.getDateConstraints(a,o)})}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&this.basicValidityCheck(e,t)}}of._$name="EventResize",Tu.registerFeature(of,!0,"Scheduler"),Tu.registerFeature(of,!1,"ResourceHistogram");const af=function(e){var t,n;return(null===(t=this.source)||void 0===t||null===(n=t.client.features.taskEdit)||void 0===n||!n._canceling)&&Tr.getDistanceBetween(this.startEvent,e)};class lf extends of{static get configurable(){return{showTooltip:!0,dragTolerance:2,preventMultiple:!1,validatorFnThisObj:null,proxyCls:"b-sch-dragcreator-proxy",tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,dragActiveCls:"b-dragcreating"}}static get pluginConfig(){return{chain:["render"],before:["onElementContextMenu"]}}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:n,timeAxis:r}=t,{eventRecord:i,draggingEnd:s}=e,o="x"===this.dragLock,{mousedownDate:a}=this.dragging;t.enableEventAnimations=!1,s?(i.set("endDate",e.endDate=Mt.ceil(a,r.resolution),!0),e.toSet="startDate",e.otherEnd="endDate",e.setMethod="setStartDate",e.edge=o?"left":"top"):(i.set("startDate",e.startDate=Mt.floor(a,r.resolution),!0),e.toSet="endDate",e.otherEnd="startDate",e.setMethod="setEndDate",e.edge=o?"right":"bottom"),e.draggingEnd=this.draggingEnd=!s,t.enableEventAnimations=n}beforeDrag(e){const t=super.beforeDrag(e);return(!1===t||!(this.preventMultiple&&!this.isRowEmpty(e.rowRecord)||this.disabled))&&t}startDrag(e){const t=super.startDrag(e);return!1!==t&&(this.client.trigger("dragCreateStart",{proxyElement:e.element}),e.context.offset=0,e.context.oldValue=e.mousedownDate),t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){var t,n;const{client:r}=this;if(null!==(t=(n=e.target).closest)&&void 0!==t&&t.call(n,`.${r.timeAxisColumn.cellCls}`)){const t=r.resolveResourceRecord(e);if(t&&!t.isSpecialRow){const n=vc().prototype.setupDragContext.call(this,e),i=[];return r.isVertical?i.push({element:r.scrollable.element,direction:"vertical"}):i.push({element:r.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),n.scrollManager=r.scrollManager,n.monitoringConfig={scrollables:i},n.resourceRecord=n.rowRecord=t,n.getDistance=af,n}}}async dragDrop({context:e,event:t}){var n;e[e.toSet]=e.snappedDate;const{client:r}=this,{startDate:i,endDate:s}=e;let o;null===(n=this.tip)||void 0===n||n.hide(),e.valid=i&&s&&s-i>0&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(r.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:e.element}),o=!0),e.async||await e.finalize(o)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:Ot.assign({id:`${this.client.id}-drag-create-tip`},e),t)}async finalize(e){const t=this.owner,n=this,{eventRecord:r}=n,i=()=>{t.client.trigger("afterDragCreate",{proxyElement:n.element}),t.cleanup(n)};var s,o;e?(await t.finalizeDragCreate(n),i()):(null===(s=(o=t.store).unassignEventFromResource)||void 0===s||s.call(o,r,n.resourceRecord),t.store.remove(r),i())}async finalizeDragCreate(e){await this.internalUpdateRecord(e,e.eventRecord),this.client.trigger("dragCreateEnd",{eventRecord:e.eventRecord,newEventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element,proxyElement:e.element})}cleanup(e){var t;const{client:n}=this,{eventRecord:r}=e;r.meta.isResizing=!1,n.endListeningForBatchedUpdates(),null===(t=this.tip)||void 0===t||t.hide(),n.element.classList.remove(this.dragActiveCls)}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,n,r=!1){return Object.assign({},e,{async:r,event:t,finalize:n})}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}lf._$name="DragCreateBase";const cf=Mt,df=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,n]=e[0]instanceof wd?e:e.reverse(),r=cf.parse(t.value);return r&&r.setHours(n.value.getHours(),n.value.getMinutes(),n.value.getSeconds(),n.value.getMilliseconds()),r?Mt.clone(r):null}return null},uf=(e,t,n)=>{if(e&&t&&n.endDateField&&n.endTimeField){const e=cf.add(((e,t)=>{const n=new Date(e.getTime());return n.setHours(t.getHours(),t.getMinutes()),n})(n.startDateField.value,n.startTimeField.value),n.eventRecord.durationMS,"milliseconds");n.endDateField.value=e,n.endTimeField.value=cf.clone(e)}};class hf extends uo{static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,triggerEvent:null,showDeleteButton:!0,showNameField:!0,startTimeConfig:null,startDateConfig:null,endTimeConfig:null,endDateConfig:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,extraItems:null,items:null,weekStartDay:null}}construct(e,t){const n=this;e.eventEdit=n,super.construct(e,Ot.assign({weekStartDay:e.weekStartDay},t)),n.clientListenersDetacher=e.on({[n.triggerEvent]:"onActivateEditor",dragCreatEend:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}changeEditorConfig(e){const{items:t,extraItems:n}=this;return n?(e=j.clone(e),e=this.insertExtraWidgetsIntoDefaultWidgets(e)):t&&((e=j.clone(e)).items=Z.merge(t,e.items)),e}insertExtraWidgetsIntoDefaultWidgets(e){s.deprecate("Scheduler","5.0.0","extraItems replaced by items in EditFeature.");const{extraItems:t}=this,{items:n}=e,r=Array.isArray(t)?t:t&&Object.values(t);if(!t||!Object.keys(r).length)return e;if(Object.values(r).some((e=>"index"in e))){const r=Array.isArray(t)?t:t&&Ot.transformNamedObjectToArray(t);s.deprecate("Scheduler","5.0.0","index in extraItems replaced by weight to sort editor items");let i,o=Ot.transformNamedObjectToArray(n),a=o[o.length-1],l=o.findIndex((e=>"extraItems"===e.type));l>-1&&(o.splice(l,1),i=o.splice(l));const c=r.filter((e=>e.index>=0)),d=r.filter((e=>!(e.index>=0)));d.forEach(((e,t)=>e.weight=a.weight+100*t)),o=o.concat(d),c.sort(((e,t)=>e.index-t.index)),c.forEach((e=>{const t=o[Math.min(e.index,o.length)-1];e.weight=t?t.weight+1:-100,o.splice(e.index,0,e)})),i&&i.length&&(o=o.concat(i)),e.items=Ot.transformArrayToNamedObject(o)}else{let r=900;for(const e of Array.isArray(t)?t:Object.values(t))e.ref||(e.ref=e.id),e.weight=r+=100;e.items=d(d({},n),Array.isArray(t)?Ot.transformArrayToNamedObject(t):t)}return e}onDatesChange(e){const t=this,n=e.source,r=e.value;switch(n.ref){case"startDateField":t.startTimeField&&uf(r,t.startTimeField.value,t);break;case"startTimeField":t.startDateField&&uf(t.startDateField.value,r,t)}var i,s;(t.startDateField&&t.endDateField&&(t.endDateField.min=t.startDateField.value),t.endTimeField)&&(cf.isEqual(cf.clearTime(null===(i=t.startDateField)||void 0===i?void 0:i.value),cf.clearTime(null===(s=t.endDateField)||void 0===s?void 0:s.value))?t.endTimeField.min=t.startTimeField.value:t.endTimeField.min=null)}async save(){throw new Error("Implement in subclass")}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e=this,{editor:t}=e,n=[],r=[],i={};return t.eachWidget((s=>{var o;const a=s.name;if(a&&!s.hidden&&!s.up((t=>t===e.recurrenceEditor)))switch(a){case"startDate":n.push(s);break;case"endDate":r.push(s);break;case"resource":i[a]=s.record;break;case"recurrenceRule":i[a]="none"===(null===(o=t.widgetMap.recurrenceCombo)||void 0===o?void 0:o.value)?"":s.value;break;default:i[a]=s.value}}),!0),i.allDay&&!e.eventRecord.allDay&&(n.push(e.startTimeField),r.push(e.endTimeField)),n.length&&(i.startDate=df(n)),r.length&&(i.endDate=df(r)),"startDate"in i&&"endDate"in i&&(i.duration=cf.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;return this.assignmentStore&&delete t.resource,e.set(t)}onBeforeEditorShow(){const{eventRecord:e,editor:t}=this.editingContext,{nameField:n}=t.widgetMap;n&&e.isCreating&&(t._isSettingValues=!0,n.value="",t._isSettingValues=!1,n._configuredPlaceholder=n.placeholder,n.placeholder=e.name)}resetEditingContext(){const e=this,{eventRecord:t,client:n}=e,{eventStore:r}=n,{nameField:i}=e.editor.widgetMap;if(t.isCreating){var s;if(n.isTimelineBase)null===(s=e.editingContext.eventElement)||void 0===s||s.closest("[data-event-id]").classList.add("b-released");r.remove(t),t.isCreating=!1}i&&(i.placeholder=i._configuredPlaceholder),e.targetEventElement=null,e.client.element.classList.remove("b-eventeditor-editing")}onPopupKeyDown({event:e}){const t=this;!t.readOnly&&"Enter"===e.key&&t.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&uf(t.startDateField.value,t.startTimeField.value,t),t.onSaveClick())}async onSaveClick(){this.editor.focus();const e=await this.save();return e&&this.editor.close(),e}async onDeleteClick(){await this.deleteEvent()&&(this.editor.autoClose&&!this.editor.containsFocus||this.editor.close())}onCancelClick(){this.editor.close()}}hf._$name="EditBase";class gf extends(uo.mixin(ef)){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.scheduler;return this.store&&!this.store.storage.values.some((t=>e.isTimeSpanInAxis(t)))}construct(e,t){this.scheduler=e,super.construct(e,t)}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{eventRecord:n,iconCls:r}=e;t.shouldInclude(n)&&(t.scheduler.isVertical?e.width=t.scheduler.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls[t.rangeCls]=1,e.wrapperCls[`b-sch-color-${n.timeRangeColor}`]=n.timeRangeColor,e.children.push(n.name),r&&e.children.unshift({tag:"i",className:r}),e.eventId=t.generateElementId(n))}generateElementId(e){return`${this.idPrefix}-${e.id}`}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){this.scheduler.onInternalEventStoreChange(e)}}gf.featureClass="",gf._$name="ResourceTimeRangesBase";class mf extends wl{changeMenu(e,t){return e&&(e=j.assign({},{clippedBy:[this.client.timeAxisSubGridElement,this.client.bodyContainer]},e)),super.changeMenu(e,t)}}function pf(e,t){for(const n in e){let r=e[n];if(r){n in t&&(r=e[n]="object"==typeof r?Ot.merge(Ot.clone(t[n]),r):t[n]);const i=r.menu;i&&pf("items"in i?i.items:i,t)}}}mf._$name="TimeSpanMenuBase";class ff extends uo{static get defaultConfig(){return{defaultItems:null,items:null,processItems:null,triggerEvent:null}}static get pluginConfig(){return{assign:["showEventContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onEventSpaceKey"]}}construct(e,t){super.construct(e,t),s.deprecate("Scheduler","5.0.0","`TimeSpanRecordContextMenuBase` feature is deprecated, in favor of `TimeSpanMenuBase` feature. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information.")}doDestroy(){this.menu&&this.menu.destroy(),super.doDestroy()}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showEventContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showEventContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showEventContextMenu(e)}onEventSpaceKey(e){const t=nn.from(e.target).center,n=new MouseEvent("contextmenu",Object.assign({clientX:t.x,clientY:t.y},e));Object.defineProperty(n,"target",{get:()=>e.target}),this.showEventContextMenu(n)}showEventContextMenu(e){const t=this,n=t.client,r=e.target,i=er.up(r,n.eventSelector),s=i||r;if(s){const n=t.resolveRecord(s);n&&(e.preventDefault(),t.showContextMenuFor(n,{targetElement:s,eventElement:i,event:e}))}}resolveRecord(){}showContextMenuFor(e,t){}beforeContextMenuShow(){}showContextMenu(e){if(this.disabled)return;const t=this,n=e.event,r=e.menuType.toLowerCase(),i=A.uncapitalize(r),s=`get${A.capitalize(r)}MenuItems`,{client:o,processItems:a,defaultItems:l,namedItems:c}=t,d=n?[n.clientX+1,n.clientY+1]:nn.from(e.targetElement).center,u=e.items=Ot.isEmpty(t.items)?Ot.clone(l):Ot.merge(Ot.clone(l),t.items);e.namedItems=c,e.selection=o.selectedRecords,pf(u,c),o[s]&&o[s](e,u),a&&!1===a(e)||Ot.isEmpty(e.items)||!1!==t.beforeContextMenuShow(e)&&!1!==o.trigger(`${i}ContextMenuBeforeShow`,e)&&(t.menu=ql.showContextMenu(d,{owner:o,scrollAction:"hide",clippedBy:[o.timeAxisSubGridElement,o.bodyContainer],constrainTo:window,items:u,onDestroy(){t.menu=null},onBeforeItem:t=>{Object.assign(t,e)},onItem:e=>o.trigger(`${i}ContextMenuItem`,e),listeners:{show({source:t}){e.menu=t,o.trigger(`${i}ContextMenuShow`,e)}}}))}hideContextMenu(e){var t;null===(t=this.menu)||void 0===t||t.hide(e)}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=Ot.clone(this._defaultItems);if(this.client.readOnly)for(const t in e)e[t]=!1;return e}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}ff._$name="TimeSpanRecordContextMenuBase";class vf extends uo{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t){const n=this;t=n.processConfig(t),super.construct(e,t),n.forSelector||(n.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),n.clockTemplate=new nf({scheduler:e}),e.on({[`before${e.scheduledEventName}drag`]:()=>{var e;return null===(e=n.tooltip)||void 0===e?void 0:e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){var e,t;null===(e=this.clockTemplate)||void 0===e||e.destroy(),null===(t=this.tooltip)||void 0===t||t.destroy(),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){if(e){var t;const e=this,{client:n}=e,r=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-dragcreating",`.b-dragging-${n.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map((e=>`:not(${e})`)).join("");null===(t=e.tooltip)||void 0===t||t.destroy(),e.tooltip=new Ws(d(d({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip`,cls:e.tipCls,forSelector:`.b-timelinebase${r} .b-grid-body-container:not(.b-scrolling) ${e.forSelector}`,scrollAction:"realign",clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],forElement:n.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,allowOver:Boolean(e.config.items||e.config.tools),getHtml:e.getTipHtml.bind(e),disabled:e.disabled},e.config),{},{listeners:e.configuredListeners})),e.tooltip.on({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:e})}}processConfiguredListeners(){}addListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.addListener(...e)}removeListener(...e){var t;null===(t=this.tooltip)||void 0===t||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,n=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),n&&e.clockTemplate.updateDateIndicator(n,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const n=this,{client:r}=n,i=n.recordType||`${r.scheduledEventName}Record`,s=n.resolveTimeSpanRecord(t);if((null==s?void 0:s.startDate)instanceof Date){const{startDate:t,endDate:o}=s,a=r.getFormattedDate(t),l=r.getDisplayEndDate(o,t),c=r.getFormattedDate(l);return e.eventRecord=s,n.template({tip:e,[`${i}`]:s,startDate:t,endDate:o,startText:a,endText:c,startClockHtml:n.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:s.isMilestone?"":n.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.on({update:e.onRecordUpdate,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,null===(e=this.updateListener)||void 0===e||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(e)}onRecordUpdate({record:e}){e===this.record&&(this.tooltip.alignTo(),this.tooltip.updateContent())}}vf._$name="TooltipBase";class yf extends(uo.mixin(br)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",store:{modelClass:vm},enableResizing:!1,showTooltip:!0,showHeaderElements:!0,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${e.name||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",cls:"",narrowThreshold:80}}static get pluginConfig(){return{chain:["onPaint","populateHeaderMenu","populateTimeAxisHeaderMenu"]}}construct(e,t){const n=this;super.construct(e,t),e.isVertical&&e.on({renderRows:n.onUIReady,thisObj:n,once:!0}),n.cls=n.cls||`b-timerange-${n.constructor.$$name}`,n.baseSelector=`.${n.baseCls}.${n.cls}`,n.enableResizing&&(n.showHeaderElements=!0)}doDestroy(){var e,t,n,r,i;const s=this;null===(e=s.storeDetacher)||void 0===e||e.call(s),s.detachListeners("timeAxisViewModel"),s.detachListeners("timeAxis"),null===(t=s.clockTemplate)||void 0===t||t.destroy(),null===(n=s.tip)||void 0===n||n.destroy(),null===(r=s.drag)||void 0===r||r.destroy(),null===(i=s.resize)||void 0===i||i.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.renderRanges(),super.doDisable(e)}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onUIReady(){const e=this,{client:t}=e;e.client.on({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),e.enableResizing&&!t.hideHeaders&&(e.drag=new Ll({name:"rangeDrag",mode:t.isVertical?"translateY":"translateX",constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(n,r)=>!t.readOnly&&e.isElementDraggable(n,r),transitionDuration:t.transitionDuration,listeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onInvalidDrop",thisObj:e}}),e.resize=new Vl({direction:t.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,isElementResizable:e=>!e.closest(".b-dragging"),listeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",thisObj:e}})),e.renderRanges()}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.on({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.on({name:"timeAxis",includeChange:"renderRanges",thisObj:e})}onTimeAxisViewModelUpdate(){this.renderRanges()}renderRanges(){const e=this,t=e.client.foregroundCanvas;if(t){const{headerContainerElement:n}=e;if(er.removeEachSelector(t,e.baseSelector),n&&er.removeEachSelector(n,e.baseSelector),!e.disabled)for(const t of e.timeRanges)e.renderRange(t,!0)}}get timeRanges(){return this.store.records}shouldRenderRange(e){const{timeAxis:t}=this.client;return e.duration&&t.timeSpanInAxis(e.startDate,e.endDate)||e.startDate&&t.dateInAxis(e.startDate)}renderRange(e,t){const n=this,r=n.client;if(n.shouldRenderRange(e)){const i=r.getCoordinateFromDate(Mt.max(e.startDate,r.timeAxis.startDate),{respectExclusion:!0}),s=e.duration&&r.getCoordinateFromDate(Mt.min(e.endDate,r.timeAxis.endDate),{respectExclusion:!0,isEnd:!0}),o=s-i,a=e.name||e.iconCls?`<label>${e.iconCls?`<i class="${e.iconCls}"></i>`:""} ${e.name||"&nbsp;"}</label>`:"",l={className:{[n.baseCls]:1,[n.cls]:n.cls,[n.rangeCls]:s,[n.lineCls]:!s,[e.cls]:e.cls,"b-narrow-range":s&&o<n.narrowThreshold},dataset:{id:e.id},style:r.isVertical?`transform: translateY(${i}px); ${s?`height:${o}px`:""};`:`transform: translateX(${i}px); ${s?`width:${o}px`:""};`,retainElement:!0},c=er.createElement(Object.assign({},l,{parent:t&&r.foregroundCanvas,style:l.style+(e.style||""),html:n.showHeaderElements&&!n.showLabelInBody?"":a}));let d;n.showHeaderElements&&(d=er.createElement(Object.assign({parent:t&&n.headerContainerElement,html:n.showLabelInBody?"":a},l)));const u={bodyElement:c,headerElement:d};return t&&n.rotateLabel(e,u),u}}rotateLabel(e,{bodyElement:t}){if(!e.iconCls&&!e.name)return;const n=t.firstChild;if(!n)return;n.classList.remove("b-vertical");const r=this.client.isVertical?n.offsetHeight<t.offsetHeight:n.offsetWidth>t.offsetWidth;n.classList[r?"add":"remove"]("b-vertical")}getElementsByRecord(e){var t,n;const r=this,i="object"!=typeof e?e:e.id,s=null===(t=r.client.foregroundCanvas)||void 0===t?void 0:t.querySelector(`${r.baseSelector}[data-id="${i}"]`),o=null===(n=r.headerContainerElement)||void 0===n?void 0:n.querySelector(`${r.baseSelector}[data-id="${i}"]`);return s?{bodyElement:s,headerElement:o}:null}getBodyElementByRecord(e){const t="string"==typeof e?e:e.id;return this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`)}getRecordByElement(e){return this.store.getById(e.dataset.id)}get headerContainerElement(){const{isVertical:e,timeView:t,timeAxisColumn:n}=this.client;let r=null;return e&&t.element?r=t.element.parentElement:e||(r=n.element),r}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}set showHeaderElements(e){this._showHeaderElements=e,this.client.isPainted&&(e?this.client.element.classList.add("b-sch-timeranges-with-headerelements"):this.client.element.classList.remove("b-sch-timeranges-with-headerelements"),this.renderRanges())}populateHeaderMenu({column:e,items:t}){"timeAxis"===e.type&&this.populateTimeAxisHeaderMenu(...arguments)}populateTimeAxisHeaderMenu({column:e,items:t}){}get store(){return this._store}set store(e){const t=this;t._store=ta.getStore(e,ta);let n=!1;t.storeDetacher&&(t.storeDetacher(),n=!0),t.storeDetacher=t._store.on({change:t.onStoreChanged,refresh:t.onStoreChanged,thisObj:t}),n&&this.renderRanges()}onStoreChanged(e){const t=this;if(!(t.disabled||!t.client.isVisible||t.isConfiguring||"refresh"===e.type&&"batch"!==e.action))if("update"===e.action){const n=e.record,r=e.changes.hasOwnProperty("id")?e.changes.id.oldValue:n.id,i=t.getElementsByRecord(r),s=t.renderRange(n,!i);if(i&&!s&&(i.bodyElement.remove(),i.headerElement&&i.headerElement.remove()),!i||!s)return;t.client.runWithTransition((()=>{er.sync(s.bodyElement,i.bodyElement),t.showHeaderElements&&er.sync(s.headerElement,i.headerElement),t.rotateLabel(n,i)}))}else t.renderRanges()}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new nf({scheduler:t.client}),t.tip=new Ws(Ot.assign({id:`${t.client.id}-time-range-tip`,cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const t=this,n=t.getRecordByElement(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(n),i=t.client.timeAxisViewModel,s=t.drag;Object.assign(e,{record:n,rangeBodyEl:r,originRangeX:er.getTranslateX(r),originRangeY:er.getTranslateY(r)}),t.client.isVertical?(s.minY=0,s.maxY=i.totalSize-e.rangeBodyEl.offsetHeight,s.minX=0,s.maxX=Number.MAX_SAFE_INTEGER):(s.minX=0,s.maxX=i.totalSize-e.rangeBodyEl.offsetWidth,s.minY=0,s.maxY=Number.MAX_SAFE_INTEGER),t.client.element.classList.add("b-dragging-timerange"),t.showTip(e)}onDrag({context:e}){this.client.isVertical?er.setTranslateY(e.rangeBodyEl,er.getTranslateY(e.element)):er.setTranslateX(e.rangeBodyEl,er.getTranslateX(e.element))}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,n=e.record,r=e.rangeBodyEl.getBoundingClientRect(),i=t.client.getDateFromCoordinate(t.client.isVertical?r.top:r.left,"round",!1);n.startDate-i!=0?n.setStartDate(i):t.onInvalidDrop(),t.tip&&(t.tip.destroy(),t.tip=null),t.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){const e=this;e.drag.reset(),e.renderRanges(),e.client.element.classList.remove("b-dragging-timerange"),e.tip&&(e.tip.destroy(),e.tip=null)}onResizeStart({context:e}){const t=this,n=t.getRecordByElement(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(n);Object.assign(e,{record:n,rangeBodyEl:r}),t.showTip(e)}onResizeDrag({context:e}){this.client.isVertical?("top"===e.edge&&er.setTranslateY(e.rangeBodyEl,e.newY),e.rangeBodyEl.style.height=e.newHeight+"px"):("left"===e.edge&&er.setTranslateX(e.rangeBodyEl,e.newX),e.rangeBodyEl.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:n}=t,r=e.record,i=e.element.getBoundingClientRect(),s=n.isVertical?i.top:i.left,o=n.isVertical?i.bottom:i.right,a=n.getDateFromCoordinate(s,"round",!1),l="left"===e.edge||"top"===e.edge,c=n.getDateFromCoordinate(o,"round",!1);(l&&r.startDate-a!=0||c&&r.endDate-c!=0)&&c>a?l?r.setStartDate(a,!1):r.setEndDate(c,!1):t.onInvalidResize(),t.tip&&(t.tip.destroy(),t.tip=null)}onInvalidResize(){const e=this;e.resize.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}getTipHtml(e,t){const n=this,{client:r}=n,i=t.getBoundingClientRect(),s=r.isVertical?i.top:i.left,o=r.isVertical?i.bottom:i.right,a=r.getDateFromCoordinate(s,"round",!1),l=e.endDate&&r.getDateFromCoordinate(o,"round",!1),c=r.getFormattedDate(a),d=l&&r.getFormattedEndDate(l,a);return n.dragTipTemplate({name:e.name||"",startDate:a,endDate:l,startText:c,endText:d,startClockHtml:n.clockTemplate.template({date:a,text:c,cls:"b-sch-tooltip-startdate"}),endClockHtml:d&&n.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate"})})}}yf._$name="AbstractTimeRanges";const bf=Object.freeze({});class Cf extends(br(uo)){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t)}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}refresh(){const e=this,{client:t}=e,{timeAxis:n,timeAxisViewModel:r,isHorizontal:i}=t,{columnConfig:s}=r,{startDate:o,endDate:a}=t.visibleDateRange||bf;if(!n.startDate||!o)return;const l=r.columnLinesFor,c=Math.max(l-1,0),d=o.getTime(),u=a.getTime(),h=[],g=new Set,m=i?"X":"Y";if(e.element||(e.element=er.createElement({parent:t.backgroundCanvas,className:"b-column-lines-canvas"})),!e.disabled){const e=(e,t)=>{const n=e.start.getTime();n>d&&n<u&&!g.has(n)&&(g.add(n),h.push({className:t?"b-column-line-major":"b-column-line",style:{transform:`translate${m}(${e.coord}px)`},dataset:{line:t?`major-${e.index}`:`line-${e.index}`}}))};if(l!==c)for(let t=1;t<=s[c].length-1;t++)e(s[c][t],!0);for(let t=1;t<=s[l].length-1;t++)e(s[l][t],!1);if(!i&&t.columnLines){const{columnWidth:e,firstResource:n,lastResource:r}=t.resourceColumns;for(let t=n;t<r+1;t++)h.push({className:"b-column-line b-resource-column-line",style:{transform:`translateX(${(t+1)*e-1}px)`},dataset:{line:`resource-${t}`}})}}Ur.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:h,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}updateCanvasSize(){this.refresh()}}Cf._$name="ColumnLines",Tu.registerFeature(Cf,!0,["Scheduler","Gantt"]);var wf=e=>class extends(e||me){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["left","top","right","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const n=this;n.view=e,n.eventName=e.scheduledEventName,e.on("readOnly",(()=>n.updateCreateListeners())),n.updateCreateListeners()}doDestroy(){var e,t;const n=this;n.detachListeners("view"),n.creationData=null,null===(e=n.mouseUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.creationTooltip)||void 0===t||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.on({name:"view",[`${e.eventName}mouseenter`]:"onTimeSpanMouseEnter",[`${e.eventName}mouseleave`]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:e,source:t,[`${this.eventName}Record`]:n,[`${this.eventName}Element`]:r}){n.isCreating||(this.showTerminals(n,er.down(r,t.eventInnerSelector)),this.creationData&&e.target.closest(this.client.eventSelector)&&(this.creationData.timeSpanElement=r,this.onOverTargetEventBar(e)))}onTimeSpanMouseLeave(e){var t;const n=this,r=e[`${n.eventName}Element`],i=e.event.relatedTarget,s=null===(t=n.creationData)||void 0===t?void 0:t.timeSpanElement;n.creationData&&s&&er.isDescendant(r,i)||n.hideTerminals(r),n.creationData&&!n.creationData.finalizing&&(n.creationData.timeSpanElement=null,n.onOverNewTargetWhileCreating())}onTerminalMouseOver(e){this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){const t=this,n=er.up(e.target,t.view.eventSelector);!n||t.showingTerminalsFor&&er.isDescendant(n,t.showingTerminalsFor)||t.creationData&&n===t.creationData.timeSpanElement||(t.hideTerminals(n),t.view.unhover(e)),t.creationData&&t.onOverNewTargetWhileCreating(e.relatedTarget,t.creationData.target)}onTerminalMouseDown(e){const t=this;if(0===e.button&&!t.creationData){var n;const r=t.view,i=r.timeAxisSubGridElement,s=e.target,o=s.closest(r.eventSelector),a=nn.from(r.element,document.body);e.preventDefault(),e.stopPropagation(),t.creationData={source:r.resolveTimeSpanRecord(o),fromSide:s.dataset.side,startPoint:nn.from(s,i).center,startX:e.pageX-a.x+r.scrollLeft,startY:e.pageY-a.y+r.scrollTop,valid:!1,sourceResource:null===(n=r.resolveResourceRecord)||void 0===n?void 0:n.call(r,o)},t.mouseUpMoveDetacher=Tr.on({mouseup:{element:r.rootElement,handler:"onMouseUp"},mousemove:{element:i,handler:"onMouseMove"},thisObj:t}),t.documentMouseUpDetacher=Tr.on({mouseup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:e})=>{"Escape"===e&&t.abort()}},thisObj:t})}}onMouseMove(e){const t=this,{view:n,creationData:r}=t,i=nn.from(n.element,document.body),s=e.pageX-i.x+n.scrollLeft-r.startX,o=e.pageY-i.y+n.scrollTop-r.startY,a=Math.round(Math.sqrt(s*s+o*o))-3,l=Math.atan2(o,s);let{connector:c}=t;if(!c){if(!1===t.onRequestDragCreate())return;c=t.connector}c.style.width=`${a}px`,c.style.transform=`rotate(${l}rad)`,t.lastMouseMoveEvent=e}onRequestDragCreate(){const e=this,{view:t,creationData:n}=e;if(!1===t.trigger("beforeDependencyCreateDrag",{data:n,source:n.source}))return e.abort(),!1;t.element.classList.add("b-creating-dependency"),e.connector=e.createConnector(n.startPoint.x,n.startPoint.y),t.trigger("dependencyCreateDragStart",{data:n,source:n.source}),e.showCreationTooltip&&(e.creationTooltip=e.creationTooltip||e.createDragTooltip(),e.creationTooltip.disabled=!1,e.creationTooltip.show()),t.scrollManager.startMonitoring({scrollables:[{element:t.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:t.scrollable.element,direction:"vertical"}],callback:()=>e.lastMouseMoveEvent&&e.onMouseMove(e.lastMouseMoveEvent)})}onOverTargetEventBar({target:e}){const t=this,{view:n,creationData:r,allowDropOnEventBar:i}=t,s=n.resolveTimeSpanRecord(e);j.isPromise(r.valid)||!i&&!e.classList.contains(t.terminalCls)||s!==r.source&&t.onOverNewTargetWhileCreating(e,s)}async onOverNewTargetWhileCreating(e,t){const n=this,{view:r,creationData:i,connector:s,allowDropOnEventBar:o}=n;if(!j.isPromise(i.valid)){if(s.classList.remove("b-valid","b-invalid"),i.timeSpanElement&&er.removeClsGlobally(i.timeSpanElement,"b-sch-terminal-active"),t&&t!==i.source&&(o||e.classList.contains(n.terminalCls))){var a;let l,c=e.dataset.side;i.target=t,o&&!e.classList.contains(n.terminalCls)&&(c=n.getTargetSideFromType(n.dependencyStore.modelClass.fieldMap.type.defaultValue||Qm.Type.EndToStart)),r.resolveResourceRecord&&(i.targetResource=r.resolveResourceRecord(e)),i.toSide=c;const d=i.fromSide,u=t=>{n.isDestroyed||(i.valid=t,e.classList.add(t?"b-valid":"b-invalid"),s.classList.add(t?"b-valid":"b-invalid"),r.trigger("dependencyValidationComplete",{data:i,source:i.source,target:i.target,dependencyType:l}))};switch(!0){case"left"===d&&"left"===c:l=Qm.Type.StartToStart;break;case"left"===d&&"right"===c:l=Qm.Type.StartToEnd;break;case"right"===d&&"left"===c:l=Qm.Type.EndToStart;break;case"right"===d&&"right"===c:l=Qm.Type.EndToEnd}if(r.trigger("dependencyValidationStart",{data:i,source:i.source,target:i.target,dependencyType:l}),i.valid=n.dependencyStore.isValidDependency(i.source,i.target,l),j.isPromise(i.valid)){u(await i.valid)}else u(i.valid);const h=i.valid?"b-valid":"b-invalid";s.classList.add(h),null===(a=i.timeSpanElement)||void 0===a||a.querySelector(`.b-sch-terminal[data-side=${c}]`).classList.add("b-sch-terminal-active",h)}else i.target=i.toSide=null,i.valid=!1,s.classList.add("b-invalid");n.updateTooltip()}}async onMouseUp(e){var t;const n=this,r=n.creationData;if(r.finalizing=!0,null===(t=n.mouseUpMoveDetacher)||void 0===t||t.call(n),r.valid){if(!1===await n.view.trigger("beforeDependencyCreateFinalize",r))r.valid=!1;else if(j.isPromise(r.valid)){const e=await r.valid;r.valid=e}if(r.valid){let e=n.createDependency(r);j.isPromise(e)&&(e=await e),r.dependency=e,n.view.trigger("dependencyCreateDrop",{data:r,source:r.source,target:r.target,dependency:e}),this.doAfterDependencyDrop(r)}else n.doAfterDependencyDrop(r)}else r.valid=!1,n.doAfterDependencyDrop(r);this.abort()}doAfterDependencyDrop(e){this.view.trigger("afterDependencyCreateDrop",d({data:e},e))}onDocumentMouseUp({target:e}){this.view.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const n=this,{view:r,creationData:i}=n;if(i){const{source:e,sourceResource:t,target:s,targetResource:o}=i;if(e){const i=r.getElementFromEventRecord(e,t);i&&n.hideTerminals(i)}if(s){const e=r.getElementFromEventRecord(s,o);e&&n.hideTerminals(e)}}n.creationTooltip&&(n.creationTooltip.disabled=!0),n.creationData=n.lastMouseMoveEvent=null,null===(e=n.mouseUpMoveDetacher)||void 0===e||e.call(n),null===(t=n.documentMouseUpDetacher)||void 0===t||t.call(n),n.removeConnector()}createConnector(e,t){const n=this,r=n.view;return n.connector=er.createElement({parent:r.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),r.element.classList.add("b-creating-dependency"),n.connector}createDragTooltip(){const e=this,{view:t}=e,n=e.creationTooltip=Ws.new({id:`${t.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},listeners:{beforeShow:()=>{e.updateTooltip()}}},e.creationTooltip);return n.show(),n}removeConnector(e){const t=this,{connector:n,view:r}=t;n&&(n.classList.add("b-removing"),n.style.width="0",t.setTimeout((()=>{n.remove(),t.connector=null,e&&e.call(t)}),200)),r.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),r.scrollManager.stopMonitoring()}showTerminals(e,t){const n=this;if(!n.isCreateAllowed)return;const r=n.terminalCls,i=`${r}s-visible`;(t=er.down(t,n.view.eventInnerSelector)).classList.contains(i)||this.view.element.classList.contains("b-resizing-event")||n.view.readOnly||(n.terminalSides.forEach((e=>{const i=er.createElement({parent:t,className:`${r} ${r}-${e}`,dataset:{side:e,feature:!0}});i.detacher=Tr.on({element:i,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",mousedown:{handler:"onTerminalMouseDown",capture:!0},thisObj:n})})),t.classList.add(i),e.cls.add(i),n.showingTerminalsFor=t)}hideTerminals(e){const t=this,n=t.client.getTimeSpanMouseEventParams(e),r=null==n?void 0:n[`${t.eventName}Record`],i=`${t.terminalCls}s-visible`;er.forEachSelector(e,`.${t.terminalCls}`,(e=>{e.detacher&&e.detacher(),e.remove()})),er.down(e,t.view.eventInnerSelector).classList.remove(i),r.cls.remove(i),t.showingTerminalsFor=null}createDependency(e){const{source:t,target:n,fromSide:r,toSide:i}=e,s=("left"===r?0:2)+("right"===i?1:0);return this.dependencyStore.add({from:t.id,to:n.id,type:s,fromSide:r,toSide:i})[0]}getTargetSideFromType(e){return e===Qm.Type.StartToStart||e===Qm.Type.EndToStart?"left":"right"}updateTooltip(){var e,t;const n=this,r=n.creationData,{valid:i}=r,s=this.creationTooltip,{classList:o}=s.element;let a,l;if(Object.assign(r,{fromText:r.source.name,toText:null!==(e=null===(t=r.target)||void 0===t?void 0:t.name)&&void 0!==e?e:"",fromSide:r.fromSide,toSide:r.toSide||""}),j.isPromise(i))return o.remove("b-invalid"),o.add("b-checking"),new Promise((e=>i.then((t=>{r.valid=t,s.isDestroyed||e(n.updateTooltip())}))));!0===i?(o.remove("b-invalid"),o.remove("b-checking"),a="valid",l=n.L("L{Dependencies.valid}")):(o.remove("b-checking"),o.add("b-invalid"),a="invalid",l=n.L("L{Dependencies.invalid}")),s.title=`<i class="b-icon b-icon-${a}"></i>${l}`,s.html=`<table class="b-sch-dependency-creation-tooltip">\n                        <tr><td>${n.L("L{Dependencies.from}")}: </td><td>${r.fromText}</td><td><div class="b-sch-box b-${r.fromSide}"></div></td></tr>\n                        <tr><td>${n.L("L{Dependencies.to}")}: </td><td>${r.toText}</td><td><div class="b-sch-box b-${r.toSide}"></div></td></tr>\n                    </table>`}};class Sf extends me{static get defaultConfig(){return{startSide:"right",startArrowSize:0,startArrowMargin:12,startShift:0,endSide:"left",endArrowSize:0,endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null}}findPath(e,t){let n,r,i,s,o,a,l,c,d,u,h,g,m,p,f,v,y,b,C,w,S,E,D,x,R,T,M,F,A,I,k,O=this;for(t&&!Array.isArray(t)&&(t=[t]),k=0;e&&!I;)for(n=Object.assign(O.config,e),r=n.startBox,i=n.endBox,s=n.startShift,o=n.endShift,a=n.startSide,l=n.endSide,c=n.startArrowSize,d=n.endArrowSize,u=n.startArrowMargin,h=n.endArrowMargin,g=n.horizontalMargin,m=n.verticalMargin,p=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:g,f=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:m,v=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:g,y=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:m,b=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:g,C=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:m,w=n.otherBoxes,a=O.normalizeSide(a),l=O.normalizeSide(l),S=O.getConnectionCoordinatesFromBoxSideShift(r,a,s),E=O.getConnectionCoordinatesFromBoxSideShift(i,l,o),M=O.calcGridBaseBoxFromBoxAndDrawParams(r,a,c,u,p,f),F=O.calcGridBaseBoxFromBoxAndDrawParams(i,l,d,h,v,y),w=w&&w.map((e=>O.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,0,b,C))),D=O.getConnectionCoordinatesFromBoxSideShift(M,a,s),x=O.getConnectionCoordinatesFromBoxSideShift(F,l,o),A=O.buildPathGrid(M,F,D,x,a,l,w),R=O.convertDecartPointToGridPoint(A,D),T=O.convertDecartPointToGridPoint(A,x),I=O.findPathOnGrid(A,R,T,a,l),e=!1;!I&&!e&&t&&k<t.length;k++)e=t[k](n);return I&&(I=O.prependPathWithArrowStaffSegment(I,S,c,a),I=O.appendPathWithArrowStaffSegment(I,E,d,l),I=O.optimizePath(I)),I}getConnectionCoordinatesFromBoxSideShift(e,t,n){let r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+n};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+n};break;case"top":r={x:(e.start+e.end)/2+n,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+n,y:e.bottom}}return r}calcGridBaseBoxFromBoxAndDrawParams(e,t,n,r,i,s){let o;switch(t){case"left":o={start:e.start-Math.max(n+r,i),end:e.end+i,top:e.top-s,bottom:e.bottom+s};break;case"right":o={start:e.start-i,end:e.end+Math.max(n+r,i),top:e.top-s,bottom:e.bottom+s};break;case"top":o={start:e.start-i,end:e.end+i,top:e.top-Math.max(n+r,s),bottom:e.bottom+s};break;case"bottom":o={start:e.start-i,end:e.end+i,top:e.top-s,bottom:e.bottom+Math.max(n+r,s)};break;default:o={start:e.start-i,end:e.end+i,top:e.top-s,bottom:e.bottom+s}}return o}buildPathGrid(e,t,n,r,i,s,o){let a,l,c,d,u,h,g,m,p,f,v,y,b,C={},w=[];for(a=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:n.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:r.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:n.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:r.y,t.bottom],o&&o.forEach((e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),a=[...new Set(a.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,m=l.length;h<m;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=a.length;u<g;++u){if(d=a[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)v=o[p],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===n.x&&c===n.y||d===r.x&&c===r.y;b={distance:Math.pow(2,53)-1,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,w.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:w}}convertDecartPointToGridPoint(e,t){let n=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][n]}findPathOnGrid(e,t,n,r,i){let s=this,o=!1;return t.permitted&&n.permitted&&(e=s.waveForward(e,t,0),o=s.collectPath(e,n,i)),o}getGridPointNeighbors(e,t,n){let r,i=t.ix,s=t.iy,o=[];return s<e.height-1&&(r=e.points[s+1][i],(!n||n(r))&&o.push(r)),s>0&&(r=e.points[s-1][i],(!n||n(r))&&o.push(r)),i<e.width-1&&(r=e.points[s][i+1],(!n||n(r))&&o.push(r)),i>0&&(r=e.points[s][i-1],(!n||n(r))&&o.push(r)),o}waveForward(e,t,n){const r=this;return Zo.preWalkUnordered([t,n],(([t,n])=>r.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>n+1)).map((e=>[e,n+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,n){let r,i,s,o,a=this,l=!0,c=[];for(;l&&t.distance;)if(r=a.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance==t.distance-1)),l=r.length>0,l){switch(r=r.sort(((e,r)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;let o=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;i=r.ix-t.ix,s=r.iy-t.iy;let a=("left"===n||"right"===n)&&0===s||("top"===n||"bottom"===n)&&0===i?-1:1;return o>a?1:o<a?-1:o===a?e.y>r.y?-1:1:void 0})),i=r[0],c.push({x1:i.x,y1:i.y,x2:t.x,y2:t.y}),s=i.ix-t.ix,o=i.iy-t.iy,!0){case!o&&s>0:n="left";break;case!o&&s<0:n="right";break;case!s&&o>0:n="top";break;case!s&&o<0:n="bottom"}t=i}return l&&c.reverse()||!1}prependPathWithArrowStaffSegment(e,t,n,r){let i,s;if(e.length>0){switch(s=e[0],i={x2:s.x1,y2:s.y1},r){case"left":i.x1=t.x-n,i.y1=s.y1;break;case"right":i.x1=t.x+n,i.y1=s.y1;break;case"top":i.x1=s.x1,i.y1=t.y-n;break;case"bottom":i.x1=s.x1,i.y1=t.y+n}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,n,r){let i,s;if(e.length>0){switch(s=e[e.length-1],i={x1:s.x2,y1:s.y2},r){case"left":i.x2=t.x-n,i.y2=s.y2;break;case"right":i.x2=t.x+n,i.y2=s.y2;break;case"top":i.x2=s.x2,i.y2=t.y-n;break;case"bottom":i.x2=s.x2,i.y2=t.y+n}e.push(i)}return e}optimizePath(e){let t,n,r=[];if(e.length>0)for(t=e.shift(),r.push(t);e.length>0;)n=e.shift(),t.x1==n.x1&&t.y1==n.y1&&t.x2==n.x2&&t.y2==n.y2?t=n:t.y1-t.y2==0&&n.y1-n.y2==0?t.x2=n.x2:t.x1-t.x2==0&&n.x1-n.x2==0?t.y2=n.y2:(r.push(n),t=n);return r}normalizeSide(e){return Sf.sideToSide[e]||e}static get sideToSide(){return{l:"left",r:"right",t:"top",b:"bottom"}}}Sf._$name="RectangularPathFinder";const Ef={add:1,dataset:1,remove:1,removeAll:1},Df=["left","left","right","right"],xf=["left","right","left","right"];class Rf extends(uo.mixin(wf,ef,br)){static get $name(){return"Dependencies"}static get defaultConfig(){return{pathFinderConfig:null,overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",highlightDependenciesOnEventHover:!1,showTooltip:!0,tooltip:null,bufferSize:50,cacheGridSize:{ticks:25,index:25}}}static get properties(){return{toDrawOnProjectRefresh:new Set,dependenciesToRefresh:new Map,drawnDependencies:[],drawnLines:[]}}static get pluginConfig(){return{chain:["render","renderContents","onElementClick","onElementDblClick","onElementMouseOver","onElementMouseOut","onProjectRefresh"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t={}){const n=this;if(e.isVertical)throw new Error("Dependencies feature is not supported in vertical mode");n.doScheduleDraw=n.createOnFrame("draw",[],n,!0),super.construct(e,t),n.pathFinder=new Sf(n.pathFinderConfig),delete n.pathFinderConfig,n.lineDefAdjusters=n.createLineDefAdjusters(),e.rowManager.on({refresh:"onRefresh",thisObj:n})}doDestroy(){var e;null===(e=this.tooltip)||void 0===e||e.destroy(),super.doDestroy()}doDisable(e){const t=this,{project:n}=t;t.updateCreateListeners(),(n||e)&&(t.attachToResourceStore(e?null:n.resourceStore),t.attachToEventStore(e?null:n.eventStore),t.attachToAssignmentStore(e?null:n.assignmentStore),t.attachToDependencyStore(e?null:n.dependencyStore)),t.client.isPainted&&t.draw(),super.doDisable(e)}static getLocalizedDependencyType(e){return e?this.L(`L{DependencyType.${e}}`):""}findDependencyIndex(e=[],t,n){return e.findIndex((e=>e.dependency===t&&(e.assignmentData===n||e.assignmentData&&n&&e.assignmentData.from===n.from&&e.assignmentData.to===n.to)))}includesDependency(){return this.findDependencyIndex(...arguments)>=0}attachToResourceStore(e){super.attachToResourceStore(e),e&&!this.disabled&&e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",thisObj:this})}attachToDependencyStore(e){const t=this;super.attachToDependencyStore(e),t.resetGridCache(),t.resetBoundsCache(),e&&!t.disabled&&(e.metaMapId=t.client.id,e.on({name:"dependencyStore",changePreCommit:"onDependencyChange",idChange:"onDependencyIdChange",thisObj:t}))}attachToAssignmentStore(e){super.attachToAssignmentStore(e),e&&!this.disabled&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentChange",refreshPreCommit:"onAssignmentRefresh",thisObj:this})}attachToEventStore(e){super.attachToEventStore(e),e&&!this.disabled&&e.on({name:"eventStore",changePreCommit:"onEventChange",batchedUpdate:"onEventBatchedUpdate",thisObj:this})}createMarkers(){const e=this,t=e.client.svgCanvas,n=e.endMarker=e.initMarkerElement("arrowEnd","8","M0,0 L0,6 L9,3 z");if(r.isEdge||r.isIE11){const n=e.startMarker=e.initMarkerElement("arrowStart","1","M0,3 L9,6 L9,0 z");t.appendChild(n)}else n.setAttribute("orient","auto-start-reverse");t.appendChild(n)}initMarkerElement(e,t,n){return er.createElement({id:e,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:t,refY:3,viewBox:"0 0 9 6",orient:"auto",markerUnits:"userSpaceOnUse",children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:n}]})}createLineDefAdjusters(){const e=this.client;return[function(t){let n=!1;return(t.startArrowMargin>e.barMargin||t.endArrowMargin>e.barMargin)&&(t.startArrowMargin=t.endArrowMargin=e.barMargin,n=!0),n?t:n},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t}]}getElementForDependency(e,t=null){return this.getElementsForDependency(e,t)[0]}getElementsForDependency(e,t=null){let n=`[depId="${e.id}"]`;return t&&(n+=`[fromId="${t.from.id}"][toId="${t.to.id}"]`),Array.from(this.client.svgCanvas.querySelectorAll(n))}resolveDependencyRecord(e){const t="string"==typeof e?e:e.getAttribute("depId");return t?this.dependencyStore.getById(t):null}onRefresh(){this.client.isEngineReady&&this.onProjectRefresh()}onProjectRefresh(){const e=this;if(!e.client.refreshSuspended)if(e.refreshAllWhenReady)e.resetGridCache(),e.scheduleDraw(!0),e.refreshAllWhenReady=!1;else if(e.toDrawOnProjectRefresh){const t=e._dependencyGridCache;t&&e.toDrawOnProjectRefresh.forEach((t=>{e.addToGridCache(t)})),t||e._thisIsAUsedExpression(e.dependencyGridCache),e.toDrawOnProjectRefresh.clear(),e.scheduleDraw()}}onToggleNode(){this.resetGridCache(),this.scheduleDraw(!0)}onViewportResize(){this.scheduleDraw(!0)}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw(!0)}onChangeTotalHeight(){this.client.isEngineReady&&this.scheduleDraw(!0)}onHorizontalScroll({subGrid:e}){this.isDrawn&&e===this.client.timeAxisSubGrid&&this.scheduleDraw(!1)}onVerticalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onRowsRefresh(){this.scheduleDraw(!0)}onResourceStoreChange({action:e}){this.client.project.propagatingLoadChanges||Ef[e]&&(this.refreshAllWhenReady=!0)}onResourceStoreRefresh({action:e}){if(!this.client.project.propagatingLoadChanges)switch(e){case"sort":case"filter":case"batch":this.resetGridCache(),this.scheduleDraw(!0)}}async onDependencyChange({action:e,record:t,records:n}){const r=this,{client:i}=r;if(i.isPainted&&!i.suspendRendering&&!this.client.project.propagatingLoadChanges){switch(e){case"dataset":return r.dependencyGridCache={},void(r.toDrawOnProjectRefresh=new Set(n));case"add":return void n.forEach((e=>r.toDrawOnProjectRefresh.add(e)));case"update":if(r.drawnDependencies.some((e=>e.dependency===t)))return r.scheduleRefreshDependency(t);r.addToGridCache(t),r.scheduleDraw();break;case"remove":return n.forEach((e=>{r.releaseDependency(e,!0),r.removeFromCache(e),r.dependenciesToRefresh.delete(e)})),void i.trigger("dependenciesDrawn");case"removeall":case"filter":r.resetGridCache()}r.scheduleDraw(!0)}}onDependencyIdChange({record:e,oldValue:t}){this.removeFromCache(e,null,t),this.addToGridCache(e)}onEventBatchedUpdate(e){this.client.listenToBatchedUpdates&&(e.fromBatched=!0,this.onEventChange(...arguments))}onEventChange({action:e,record:t,changes:n,fromBatched:r}){const i=this;if(!i.client.project.propagatingLoadChanges)switch(e){case"filter":i.scheduleDraw(!0);break;case"update":if(!r&&1===Object.keys(n).length&&(n.startDate||n.endDate||n.duration))return;if(t.isEvent){const e=[t];t.resources.forEach((t=>e.push(...t.events))),new Set(e).forEach((e=>i.drawForTimeSpan(e,!0)))}else i.drawForTimeSpan(t,!0);break;case"removeall":i.resetGridCache(),i.scheduleDraw(!0)}}onAssignmentRefresh({action:e}){this.client.project.propagatingLoadChanges||"dataset"===e&&(this.resetGridCache(),this.scheduleDraw(!0))}onAssignmentChange({action:e,record:t,records:n,changes:r}){const i=this;if(!i.client.project.propagatingLoadChanges&&(t&&(n=[t]),"filter"===e&&(i.resetGridCache(),i.scheduleDraw(!0)),"add"===e||"remove"===e||"update"===e)){if("update"===e&&2===Object.keys(r).length&&r.event&&r.resource&&!r.event.isModel&&!r.resource.isModel)return;n.forEach((n=>{const{assignmentStore:r,eventStore:s}=i.client,o=s.getById(n.eventId);o&&o.dependencies.forEach((s=>{if("add"===e)i.toDrawOnProjectRefresh.add(s);else if("remove"===e){let e;e=s.fromEvent===o?s.toEvent.assignments.map((e=>({from:n,to:e}))):s.fromEvent.assignments.map((e=>({from:e,to:n}))),e.forEach((e=>{i.releaseDependency(s,e),i.removeFromCache(s,e)}))}else"update"===e&&i.getDependencyAssignmentsAsFromToArray({dependency:s,assignmentStore:r}).filter((e=>e.from===t||e.to===t)).forEach((e=>{i.scheduleRefreshDependency(s,e)}))}))}))}}getDependencyAssignmentsAsFromToArray({dependency:e,assignmentStore:t}){const{fromEvent:n,toEvent:r}=e,i=[];if(n&&r){const e=this.getEventAssignments(n,t),s=this.getEventAssignments(r,t);e.forEach((e=>{s.forEach((t=>{i.push({from:e,to:t})}))}))}return i}getEventAssignments(e,t){if(e.isRemoved){const n=t.removed.values.filter((t=>t.event===e));for(const r of t.assignmentsForRemoval)r.event===e&&n.push(r);return n}return e.assignments}onElementClick(e){const t=this;if(e.target.matches("."+t.baseCls)){const n=sa.get(e.target).dependency,r="click"===e.type?"Click":"DblClick";t.client.trigger(`dependency${r}`,{dependency:n,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this;if(e.target.matches("."+t.baseCls)){const n=sa.get(e.target).dependency;t.client.trigger("dependencyMouseOver",{dependency:n,event:e}),t.overCls&&t.highlight(n,t.overCls)}}onElementMouseOut(e){const t=this;if(e.target.matches("."+t.baseCls)){const n=sa.get(e.target).dependency;t.client.trigger("dependencyMouseOut",{dependency:n,event:e}),t.overCls&&!n.isRemoved&&t.unhighlight(n)}}highlight(e,t=this.overCls){this.getElementsForDependency(e).forEach((e=>{e.classList.add(t)})),e.highlight(t)}unhighlight(e,t=this.overCls){this.getElementsForDependency(e).forEach((e=>{e.classList.remove(t)})),e.unhighlight(t)}highlightEventDependencies(e){e.dependencies.forEach((e=>this.highlight(e)))}unhighlightEventDependencies(e){e.dependencies.forEach((e=>this.unhighlight(e)))}isDependencyVisible(e,t=null){const{assignmentStore:n,resourceStore:r,eventStore:i}=this.client,{fromEvent:s,toEvent:o}=e;if(!s||!o)return!1;let a,l;if(t){const{from:e,to:r}=t;if(a=e.resource,l=r.resource,!1===e.drawDependencies||!1===r.drawDependencies||i.isFiltered&&(!i.includes(s)||!i.includes(o))||n.isFiltered&&(!n.includes(e)||!n.includes(r)))return!1}else a=s.resource,l=o.resource;return!(!r.isAvailable(a)||!r.isAvailable(l))&&(s.isModel&&!a.instanceMeta(r).hidden&&!l.instanceMeta(r).hidden)}getBox(e,t,n=null,r=!1){const i=this.getTimeSpanRecordFromDependency(e,t);let s;return s=n?n[t?"from":"to"].resource:i.resource,this.client.getResourceEventBox(i,s,!0,r)}getRowRecordFromDependency(e,t,n){let r;return r=n?n[t?"from":"to"].resource:this.getTimeSpanRecordFromDependency(e,t).resource,r}getTimeSpanRecordFromDependency(e,t=!0){return e[(t?"from":"to")+"Event"]}getMetaId(e=null){return e?`${this.client.id}-ass${e.from.id}-ass${e.to.id}`:this.client.id}getDependencyBounds(e,t,n=!1){const r=this,i=r.client,s=e.getDateRange();if(!i.rowManager.rowCount||!r.isDependencyVisible(e,t))return null;if(!(s&&i.timeAxis.count&&Mt.intersectSpans(s.start,s.end,i.startDate,i.endDate)))return null;const o=r.getMetaId(t),a=e.instanceMeta(o),l=r.getBox(e,!0,t,n),c=r.getBox(e,!1,t,n);if(!l||!c)return null;if(r._resetBoundsCache||!a.bounds||!a.bounds.layout){const n=r.getTimeSpanRecordFromDependency(e,!0),s=r.getTimeSpanRecordFromDependency(e,!1),o=nn.union(l,c);i.isGantt||[[n,l,t.from],[s,c,t.to]].map((([e,t,n])=>{if("default"===i.milestoneLayoutMode&&e.isMilestone){if(!i.milestoneWidth){const e=i.getElementFromAssignmentRecord(n);e&&(i.milestoneWidth=e.offsetWidth)}const e=i.milestoneWidth||t.height;t.left-=e/2,t.right+=e/2}})),a.bounds={bounds:o,startRectangle:l,endRectangle:c,layout:l.layout||c.layout}}return e.instanceMeta(o).bounds}get dependencyGridCache(){const e=this;return e._dependencyGridCache||(e._dependencyGridCache={},e.dependencyStore.forEach((t=>e.addToGridCache(t)))),e._dependencyGridCache}get dependencyStore(){return this.project.dependencyStore}getIteratableDependencyAssignments(e){return this.assignmentStore?this.getDependencyAssignmentsAsFromToArray({dependency:e,assignmentStore:this.assignmentStore}):[null]}addToGridCache(e){const t=this,{client:n}=t,{store:r}=n,{dependencyGridCache:i,cacheGridSize:s}=t,o=t.getIteratableDependencyAssignments(e),a=n.startDate.getTime(),l=n.endDate.getTime(),c=Mt.asMilliseconds(n.timeAxis.unit)*s.ticks;o.forEach((n=>{const o=t.getMetaId(n),d=e.instanceMeta(o).gridCache=[],u=r.indexOf(t.getRowRecordFromDependency(e,!0,n)),h=r.indexOf(t.getRowRecordFromDependency(e,!1,n)),g=e.getDateRange(),m=null==g?void 0:g.start.getTime(),p=null==g?void 0:g.end.getTime();if(-1!==u&&-1!==h&&g&&p>a&&m<l){const t=Math.min(u,h),r=Math.max(u,h),l=Math.floor(t/s.index),g=Math.floor(r/s.index),f=Math.floor(Math.max(m-a,0)/c),v=Math.floor(Math.max(p-a,0)/c),y=`${e.id}.-.${o}`;let b,C,w,S,E;for(S=f;S<=v;S++)for(b=i[S]||(i[S]={}),E=l;E<=g;E++)C=b[E]||(b[E]=[]),w=C.cached||(C.cached={}),w[y]||(w[y]=!0,C.push({dependency:e,assignmentData:n,metaId:o})),d.push([S,E])}}))}removeFromCache(e,t=null,n=e.id){const r=this,{_dependencyGridCache:i}=r;let s;s=t?[t]:this.getIteratableDependencyAssignments(e),s.forEach((t=>{var s;const o=r.getMetaId(t),a=e.instanceMeta(o),l=`${n}.-.${o}`;i&&(null===(s=a.gridCache)||void 0===s||s.forEach((([n,s])=>{var o;if(null!==(o=i[n])&&void 0!==o&&o.hasOwnProperty(s)){const i=r._dependencyGridCache[n][s];if(null!=i&&i.cached[l]){const n=r.findDependencyIndex(i,e,t);delete i.cached[l],n>-1&&i.splice(n,1)}}}))),a.bounds=null,a.gridCache=null}))}set dependencyGridCache(e){this._dependencyGridCache=e}resetBoundsCache(){this._resetBoundsCache=!0}resetGridCache(){this.dependencyGridCache=null}generateBoundaryBoxes(e,t){const n=[];return"bottom"===t?n.push({start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}):n.push({start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}),n}getDependencyStartSide(e){const t=this,n=t.getTimeSpanRecordFromDependency(e,!0),r=e.type;let i=e.fromSide;if(!i)switch(!0){case r===np.Type.StartToEnd:case r===np.Type.StartToStart:i=t.getConnectorStartSide(n);break;case r===np.Type.EndToStart:case r===np.Type.EndToEnd:i=t.getConnectorEndSide(n);break;default:throw new Error("Invalid dependency type: "+r)}return i}getDependencyEndSide(e){const t=this,n=t.getTimeSpanRecordFromDependency(e,!1),r=e.type;let i=e.toSide;if(!i)switch(!0){case r===np.Type.StartToEnd:i=t.getConnectorEndSide(n);break;case r===np.Type.StartToStart:case r===np.Type.EndToStart:i=t.getConnectorStartSide(n);break;case r===np.Type.EndToEnd:i=t.getConnectorEndSide(n);break;default:throw new Error("Invalid dependency type: "+r)}return i}prepareLineDef(e,t,n=null){const r=this,i=r.getDependencyStartSide(e),s=r.getDependencyEndSide(e),{startRectangle:o,endRectangle:a}=t,l=[];null!=o.rowTop&&o.rowTop!==a.rowTop&&l.push(...r.generateBoundaryBoxes(o,i));let{startArrowMargin:c,verticalMargin:d}=r.pathFinder;return e.bidirectional||(/(top|bottom)/.test(i)&&(c=r.client.barMargin/2),d=r.client.barMargin/2),{startBox:{start:o.x,end:o.right,top:o.y,bottom:o.bottom},endBox:{start:a.x,end:a.right,top:a.y,bottom:a.bottom},otherBoxes:l,startArrowMargin:c,verticalMargin:d,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:i,endSide:s}}drawLine(e,t,n,i=null,s=!0){const o=this.client,a=this.getMetaId(i);let l=t.instanceMeta(a).lineElement;if(l&&s||(l=document.createElementNS("http://www.w3.org/2000/svg","polyline"),s&&(t.instanceMeta(a).lineElement=l),l.setAttribute("depId",t.id),i&&(l.setAttribute("fromId",i.from.id),l.setAttribute("toId",i.to.id)),e.appendChild(l)),l.classList.length&&l.classList.remove.apply(l.classList,l.getAttribute("class").split(" ")),l.classList.add(this.baseCls),t.cls&&l.classList.add(t.cls),t.bidirectional&&l.classList.add("b-sch-bidirectional-line"),t.highlighted&&l.classList.add(...t.highlighted.split(" ")),r.isIE11){const e=t.getDateRange(!0),n=o.startDate;e.start<n&&l.classList.add("b-no-start-marker"),e.end<n&&l.classList.add("b-no-end-marker")}return l.setAttribute("points",n?n.map(((e,t)=>t!==n.length-1?`${e.x1},${e.y1}`:`${e.x1},${e.y1} ${e.x2},${e.y2}`)).join(" "):""),sa.set(l,{dependency:t}),l}refreshDependency(e){const t=this,n=t.getIteratableDependencyAssignments(e);t.releaseDependency(e,null!==n[0]),t.removeFromCache(e),t.addToGridCache(e),n.forEach((n=>t.drawDependency(e,null,n)))}refreshDependencyAssignment(e,t){const n=this;n.releaseDependency(e,t),n.removeFromCache(e,t),n.addToGridCache(e),n.drawDependency(e,null,t)}scheduleRefreshDependency(e,t=null){const n=this,r=n.dependenciesToRefresh;if(!n.drawnDependencies.find((t=>t.dependency===e)))return n.removeFromCache(e),void n.addToGridCache(e);t?r.has(e)?!0!==r.get(e)&&r.get(e).add(t):r.set(e,new Set([t])):r.set(e,!0),1===r.size&&n.requestAnimationFrame((()=>n.refreshDependencyOnFrame()))}getSortedDependenciesToRefresh(){return this.dependenciesToRefresh}refreshDependencyOnFrame(){const e=this,t=e.getSortedDependenciesToRefresh();e.client.isPainted&&(t.forEach(((t,n)=>{if(!0===t){const t=e.getIteratableDependencyAssignments(n);e.releaseDependency(n,null!==t[0]),e.removeFromCache(n)}else t.forEach((t=>{e.releaseDependency(n,t),e.removeFromCache(n,t)}))})),t.forEach(((t,n)=>{e.addToGridCache(n)})),t.forEach(((t,n)=>{!0===t&&(t=e.getIteratableDependencyAssignments(n)),t.forEach((t=>{e.drawDependency(n,null,t)}))})),e.dependenciesToRefresh.clear(),e.client.trigger("dependenciesDrawn",{partial:!0}))}drawDependency(e,t=null,n=null,r=this.client.svgCanvas,i=!0){const s=this,{drawnDependencies:o,oldDrawnDependencies:a}=s,l=t||s.getDependencyBounds(e,n);if(!s.disabled&&l){const t=s.prepareLineDef(e,l),a=s.pathFinder.findPath(t,s.lineDefAdjusters);s.drawLine(r,e,a,n,i),i&&!this.includesDependency(o,e,n)&&o.push({dependency:e,assignmentData:n})}const c=this.findDependencyIndex(a,e,n);c>=0&&a.splice(c,1)}drawForTimeSpan(e,t=!1){const n=this;n.client.isAnimating?n.client.on({transitionend(){!e.isRemoved&&n.drawForTimeSpan(e,!0)},once:!0}):n.dependencyStore.getTimeSpanDependencies(e).forEach((e=>{t?n.scheduleRefreshDependency(e):n.refreshDependency(e)}))}drawForEvent(e){this.drawForTimeSpan(e)}updateDependenciesForTimeSpan(e,t,n=null){const r=this,i=e.isAssignment?e.event:e,s=r.dependencyStore.getTimeSpanDependencies(i),o=r.getMetaId(),a=r.client,l=nn.from(t,a.timeAxisSubGridElement),c=n&&a.getRowFor(n);let d;s.forEach((t=>{this.getIteratableDependencyAssignments(t).forEach((n=>{const s=l.clone();let a,u;c&&(s.rowTop=c.top,s.rowBottom=c.bottom),n&&n.from!==e&&n.to!==e||r.isDependencyVisible(t,n)&&(r.getTimeSpanRecordFromDependency(t,!0)===i?(a=s,u=(d=t.instanceMeta(o).bounds)?d.endRectangle:r.getBox(t,!1,n)):(a=(d=t.instanceMeta(o).bounds)?d.startRectangle:r.getBox(t,!0,n),u=s),a&&u&&r.drawDependency(t,{startRectangle:a,endRectangle:u},n))}))}))}scheduleDraw(e=!1){const t=this;t.disabled||(e&&t.resetBoundsCache(),t.client.isAnimating?t.clientTransitionRemover||(t.clientTransitionRemover=t.client.on({transitionend(){t.clientTransitionRemover(),t.clientTransitionRemover=null,t.draw()},once:!0})):t.doScheduleDraw())}draw(e=!1){const t=this,n=t.client;if(!t.oldDrawnDependencies&&!t.dependencyStore.count||!n.isPainted)return;if(n.isAnimating)return void n.on({transitionend(){t.scheduleDraw(!0)},once:!0});const r=n.timeAxisSubGrid.viewRectangle;if(e&&t.resetBoundsCache(),!r.width||!r.height)return;t.oldDrawnDependencies=t.drawnDependencies,t.drawnDependencies=[],r.inflate(t.bufferSize);const{startDate:i,visibleDateRange:s}=n;if(!t.disabled&&!n.suspendRendering&&n.store.count&&n.rowManager.rowCount&&i&&s.startDate&&s.endDate){if(!n.project.isInitialCommitPerformed)return t.drawnDependencies=t.oldDrawnDependencies,void(t.refreshAllWhenReady=!0);const e={},{dependencyGridCache:o,cacheGridSize:a}=t,l=Mt.asMilliseconds(n.timeAxis.unit)*a.ticks,c=s.startDate.getTime()-i.getTime(),d=s.endDate.getTime()-i.getTime(),u=Math.floor(c/l),h=Math.floor(d/l),g=Math.floor(n.rowManager.topRow.dataIndex/a.index),m=Math.floor(n.rowManager.bottomRow.dataIndex/a.index),p=[];let f,v,y;for(f=u;f<=h;f++)for(v=g;v<=m;v++){const i=o[f],s=null==i?void 0:i[v];for(y=0;s&&y<s.length;y++){const{dependency:i,assignmentData:o,metaId:a}=s[y],l=i.id+"-"+a;if(!e[l]){const s=t.getDependencyBounds(i,o);(null!=s&&s.bounds.intersect(r,!0,!0)||n.ignoreViewBox)&&p.push([i,s,o]),e[l]=!0}}}p.forEach((([e,n,r])=>{t.drawDependency(e,n,r)}))}t._resetBoundsCache=!1,t.oldDrawnDependencies.forEach((e=>t.releaseDependency(e.dependency,e.assignmentData))),n.trigger("dependenciesDrawn"),t.isDrawn=!0}releaseDependency(e,t=null){if(!0===t){Object.keys(e.meta.map||{}).filter((e=>e.startsWith(this.client.id))).forEach((t=>{const n=e.meta.map[t];n.lineElement&&(n.lineElement.remove(),n.lineElement=null)}))}else{const n=this.getMetaId(t),r=e.instanceMeta(n).lineElement;r&&(e.instanceMeta(n).lineElement=null,r.remove())}}render(){const e=this,t=e.client;e.showTooltip&&(e.tooltip=e.createTooltip()),t.timeAxis.on({endreconfigure:"resetGridCache",thisObj:e}),t.rowManager.on({refresh:"onRowsRefresh",changetotalheight:"onChangeTotalHeight",thisObj:e}),t.on({horizontalscroll:"onHorizontalScroll",svgcanvascreated:"createMarkers",togglenode:"onToggleNode",scroll:"onVerticalScroll",timelineviewportresize:"onViewportResize",thisObj:e}),e.highlightDependenciesOnEventHover&&(t.on(t.scheduledEventName+"MouseEnter",(t=>e.highlightEventDependencies(t.eventRecord||t.taskRecord))),t.on(t.scheduledEventName+"MouseLeave",(t=>e.unhighlightEventDependencies(t.eventRecord||t.taskRecord))))}renderContents(){this.draw()}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}createTooltip(){const e=this,t=e.client;return Ws.new({align:"b-t",id:`${t.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .${e.baseCls}`,clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:e.getHoverTipHtml.bind(e)},e.tooltip||{})}getHoverTipHtml({activeTarget:e}){const t=this,n=t.resolveDependencyRecord(e),{fromEvent:r,toEvent:i}=n;return Ul.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${t.L("L{from}")}: </td>
                    <td>${A.encodeHtml(r.name)}</td>
                    <td>
                        <div class="b-sch-box b-${Df[n.type]}"></div>
                    </td>
                </tr>
                <tr>
                    <td>${t.L("L{to}")}: </td>
                    <td>${A.encodeHtml(i.name)}</td>
                    <td><div class="b-sch-box b-${xf[n.type]}"></div></td>
                </tr>
            </table>
        `}}Rf._$name="Dependencies",Tu.registerFeature(Rf,!1,["Scheduler","ResourceHistogram"]),Tu.registerFeature(Rf,!0,"SchedulerPro"),document.createElementNS&&!("classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))&&function(e){if(!("Element"in e))return;const t="classList",r=e.Element.prototype,i=Object,s=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array.prototype.indexOf||function(e){for(let t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new a("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","The token must not contain space characters.");return o.call(e,t)},c=function(e){const t=s.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[];for(let e=0,t=n.length;e<t;e++)this.push(n[e]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},d=c.prototype=[],u=function(){return new c(this)};if(a.prototype=Error.prototype,d.item=function(e){return this[e]||null},d.contains=function(e){return~l(this,e+"")},d.add=function(){let e,t=arguments,n=0,r=t.length,i=!1;do{e=t[n]+"",~l(this,e)||(this.push(e),i=!0)}while(++n<r);i&&this._updateClassName()},d.remove=function(){let e,t,n=arguments,r=0,i=n.length,s=!1;do{for(e=n[r]+"",t=l(this,e);~t;)this.splice(t,1),s=!0,t=l(this,e)}while(++r<i);s&&this._updateClassName()},d.toggle=function(e,t){const n=this.contains(e),r=n?!0!==t&&"remove":!1!==t&&"add";return r&&this[r](e),!0===t||!1===t?t:!n},d.replace=function(e,t){const n=l(e+"");~n&&(this.splice(n,1,t),this._updateClassName())},d.toString=function(){return this.join(" ")},i.defineProperty){const e={get:u,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,e)}catch(s){s.number!==n&&-2146823252!==s.number||(e.enumerable=!1,i.defineProperty(r,t,e))}}else i.prototype.__defineGetter__&&r.__defineGetter__(t,u)}(window),function(){let e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){const e=function(e){const t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(let n=0,r=arguments.length;n<r;n++)e=arguments[n],t.call(this,e)}};e("add"),e("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){const e=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,n){return 1 in arguments&&!this.contains(t)==!n?n:e.call(this,t)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(e,t){let n=this.toString().split(" "),r=n.indexOf(e+"");~r&&(n=n.slice(r),this.remove.apply(this,n),this.add(t),this.add.apply(this,n.slice(1)))}),e=null}();class Tf extends Ns{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this.dependencyEditFeature;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&(Object.assign(e,{}),super.processWidgetConfig(e)))}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}Tf._$name="DependencyEditor";class Mf extends uo{static get $name(){return"DependencyEdit"}static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",label:"L{From}",editable:!1},toNameField:{type:"display",label:"L{To}"},typeField:{type:"combo",label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",items:Object.keys(np.Type).map((e=>({id:np.Type[e],name:this.L(e)})))},lagField:{type:"duration",label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-green",text:"L{Save}"},deleteButton:{color:"b-gray",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,t){const n=this;if(e.dependencyEdit=n,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");n.clientListenersDetacher=e.on({[n.triggerEvent]:n.onActivateEditor,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=Ot.assign({},t,e)).items=e.items||[],this._editorConfig=e}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e={};return this.editor.eachWidget((t=>{t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),Ot.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,n=t.client;let r=t.lastPointerDownCoordinate;if(!1===n.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const i=t.getEditor(e);if(t.loadRecord(e),n.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:i}),!r){const e=nn.from(t.client.element).center;r=[e.x-i.width/2,e.y-i.height/2]}i.showByPoint(r)}editDependency(e){this.client.readOnly||this.internalShowEditor(e)}getEditor(){var e,t,n;const r=this;let{editor:i}=r;return i||(i=r.editor=Tf.new({dependencyEditFeature:r,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[r.client.timeAxisSubGridElement,r.client.bodyContainer],constrainTo:window,autoClose:r.autoClose,cls:r.cls,rootElement:r.client.rootElement,listeners:{keydown:r.onPopupKeyDown,thisObj:r}},r.editorConfig),0===i.items.length&&console.warn("Editor configured without any `items`"),i.eachWidget((e=>{const t=e.ref||e.id;t&&!r[t]&&(r[t]=e)})),null===(e=r.saveButton)||void 0===e||e.on("click",r.onSaveClick,r),null===(t=r.deleteButton)||void 0===t||t.on("click",r.onDeleteClick,r),null===(n=r.cancelButton)||void 0===n||n.on("click",r.onCancelClick,r),r.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.unit=e.lagUnit),t.editor.record=t.dependencyRecord=e}async save(){const e=this,{client:t,dependencyRecord:n}=e;if(!n||!e.isValid)return;const{dependencyStore:r,values:i}=e;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:n,values:i})){var s;if(e.onBeforeSave(n),e.updateRecord(n),r&&!n.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:e}))return;r.add(n)}await(null===(s=t.project)||void 0===s?void 0:s.commitAsync()),t.trigger("afterDependencySave",{dependencyRecord:n}),e.onAfterSave(n)}return n}async deleteDependency(){const{client:e,editor:t,dependencyRecord:n}=this;var r;return!1!==e.trigger("beforeDependencyDelete",{dependencyRecord:n})&&(t.containsFocus&&t.revertFocus(),e.dependencyStore.remove(n),await(null===(r=e.project)||void 0===r?void 0:r.commitAsync()),!0)}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}}Mf._$name="DependencyEdit",Tu.registerFeature(Mf,!1);class Ff extends mf{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}onElementKeyDown(e){!e.handled&&e.target.matches(this.client.eventSelector)&&" "===e.key&&this.internalShowContextMenu(this.createContextMenuEventForElement(e.target))}getDataFromEvent(e){const t=super.getDataFromEvent(e),n=t.targetElement,{client:r}=this,i=r.resolveEventRecord(n),s=i&&(r.resolveResourceRecord(n)||r.resourceStore.last),o=i&&r.resolveAssignmentRecord(n);return Object.assign(t,{eventElement:n,eventRecord:i,resourceRecord:s,assignmentRecord:o})}getTargetElementFromEvent({target:e}){return er.up(e,this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t,event:n}={}){this.disabled||(t||(t=this.getElementFromRecord(e)))&&(n=n||this.createContextMenuEventForElement(t),this.internalShowContextMenu(n))}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e}){const{client:t}=this;e.deleteEvent={hidden:t.readOnly},e.unassignEvent={hidden:t.readOnly||t.eventStore.usesSingleAssignment}}changeItems(e){const{client:t}=this;return j.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"b-icon b-icon-trash",weight:200,onItem({menu:e,eventRecord:n}){var r;const i=null===(r=e.focusInEvent)||void 0===r?void 0:r.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),t.removeEvents(t.isEventSelected(n)?t.selectedEvents:[n])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"b-icon b-icon-unassign",weight:300,name:"unassignEvent",onItem({menu:e,eventRecord:n,resourceRecord:r}){var i;const s=null===(i=e.focusInEvent)||void 0===i?void 0:i.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),n.unassign(r)}}},e)}changeMenu(e,t){return e&&(e.clippedBy=n),super.changeMenu(e,t)}}Ff.featureClass="",Ff._$name="EventMenu",Tu.registerFeature(Ff,!0,"Scheduler"),Tu.registerFeature(Ff,!1,"ResourceHistogram");class Af extends Ff{static get $name(){return"EventContextMenu"}construct(e,t){super.construct(...arguments),this.scheduler=e,s.deprecate("Scheduler","5.0.0","`EventContextMenu` feature is deprecated, in favor of `EventMenu` feature. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."),e.features.eventMenu&&(e.features.eventMenu.disabled=!0)}}Af.featureClass="",Af._$name="EventContextMenu",Tu.registerFeature(Af),Tu.registerFeature(Af,!1,"ResourceHistogram");class If extends uo{static get $name(){return"ScheduleContext"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.useBackgroundCanvas=!0,e.on("scheduleclick",this.onSchedulerClick,this),this.scheduler=e,super.construct(e,t)}render(){const{scheduler:e}=this;this.element=er.createElement({parent:e.backgroundCanvas,className:"b-schedule-selected-tick",style:`${e.isVertical?"height":"width"}:${e.tickSize}px;`})}onSchedulerClick(e){const{scheduler:t,element:n}=this,{tickStartDate:r,tickEndDate:i,resourceRecord:s}=e,o=t.currentOrientation.getTimeSpanRenderData({startDate:r,endDate:i,startDateMS:r.getTime(),endDateMS:i.getTime()},s);let a;if(t.isVertical)a=o.top,n.style.width=o.width+"px";else{const e=t.getRowFor(s);a=e.top,n.style.height=e.height+"px"}er.setTranslateXY(n,o.left,a)}}If.featureClass="b-scheduler-context",If._$name="ScheduleContext",Tu.registerFeature(If,!1,["Scheduler"]);class kf extends uo{static get $name(){return"EventCopyPaste"}static get pluginConfig(){return{assign:["copyEvents","pasteEvents"],chain:["onElementKeyDown","populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}}static get properties(){return{recordsFromClipboard:[]}}construct(e,t){super.construct(e,t),e.features.scheduleContext&&(e.features.scheduleContext.disabled=!1),e.on("scheduleclick",this.onSchedulerClick,this),this.scheduler=e}onEventDataGenerated(e){const{eventRecord:t}=e;e.cls["b-cut-item"]=t.meta.isCut}onSchedulerClick(e){this._cellClickedContext=e}onElementKeyDown(e){if(e.ctrlKey)switch(e.key.toLowerCase()){case"c":this.onCtrlCKey();break;case"x":this.onCtrlXKey();break;case"v":this.onCtrlVKey()}}copyEvents(e,t=!1){const n=this,{scheduler:r}=n;r.readOnly||(n._isCut=t,n.recordsFromClipboard=e||r.selectedEvents,r.eventStore.forEach((e=>{e.meta.isCut=n._isCut&&n.recordsFromClipboard.includes(e)})),r.refreshWithTransition())}onCtrlCKey(){this.copyEvents()}onCtrlXKey(){this.copyEvents(null,!0)}onCtrlVKey(){const{date:e,resourceRecord:t}=this._cellClickedContext||{};this.pasteEvents(e,t)}pasteEvents(e,t){const n=this,r=n.recordsFromClipboard;r.length&&(r.forEach((r=>{const i={};t&&(i.resourceId=t.id),e&&Object.assign(i,{startDate:e,endDate:Mt.add(e,r.duration,r.durationUnit)}),n._isCut?(r.set(i),r.meta.isCut=!1):(i.name=`${r.name} - copy`,n.scheduler.eventStore.add(r.copy(i)))})),n._isCut&&(n._isCut=!1,n.recordsFromClipboard=[]))}populateEventMenu({eventRecord:e,items:t}){const n=this;n.scheduler.readOnly||(t.copyEvent={text:"L{copyEvent}",localeClass:n,icon:"b-icon b-icon-copy",weight:110,onItem:()=>n.copyEvents([e],!1)},t.cutEvent={text:"L{cutEvent}",localeClass:n,icon:"b-icon b-icon-cut",weight:120,onItem:()=>n.copyEvents([e],!0)})}populateScheduleMenu({items:e}){const t=this,{scheduler:n}=t;!n.readOnly&&t.recordsFromClipboard.length&&(e.pasteEvent={text:"L{pasteEvent}",localeClass:t,icon:"b-icon b-icon-paste",disabled:0===n.resourceStore.count,weight:110,onItem:({date:e,resourceRecord:r})=>t.pasteEvents(e,r,n.getRowFor(r))})}}kf.featureClass="b-event-copypaste",kf._$name="EventCopyPaste",Tu.registerFeature(kf,!0,"Scheduler");class Of extends rf{static get $name(){return"EventDrag"}static get defaultConfig(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,validatorFn:()=>{},validatorFnThisObj:null,unifiedDrag:null}}get scheduler(){return this.client}isElementDraggable(e,t){const{scheduler:n}=this,r=er.up(e,n.eventSelector),{eventResize:i}=n.features;if(!r||this.disabled)return!1;if(e.matches('[class$="-handle"]'))return!1;const s=n.resolveEventRecord(r),o=null==s?void 0:s.resizable;return!(o&&i&&!i.disabled&&!s.isMilestone&&((!0===o||"start"===o)&&i.isOverStartHandle(t,r)||(!0===o||"end"===o)&&i.isOverEndHandle(t,r)))&&!n.readOnly}getTriggerParams(e){const{assignmentRecords:t,eventRecords:n,resourceRecord:r,browserEvent:i}=e;return{context:e,draggedRecords:n,eventRecords:n,resourceRecord:r,assignmentRecords:t,event:i}}triggerEventDrag(e,t){e.startDate-t==0&&e.newResource===e.resourceRecord||this.scheduler.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.drag.startEvent.ignoreNavigation=!0,this.scheduler.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventDragAbort",this.getTriggerParams(e))}triggerAfterDrop(e,t){this.currentOverClient.trigger("afterEventDrop",Object.assign(this.getTriggerParams(e),{valid:t}))}onDragAbort(){const{assignmentStore:e,eventStore:t}=this.client;this.dragData.initialAssignmentsState.find((({resource:n,assignment:r},i)=>{var s;return!e.includes(r)||!t.includes(r.event)||n.id!==(null===(s=this.dragData.assignmentRecords[i])||void 0===s?void 0:s.resourceId)}))&&this.client.refresh(),super.onDragAbort(...arguments)}isValidDrop(e){const{newResource:t,resourceRecord:n}=e,r=e.draggedEntities[0];return!(!t||t.isSpecialRow)&&(n===t||!r.event.resources.includes(t))}checkDragValidity(e,t){const n=this,r=n.currentOverClient;let i=n.dragData.context.valid;return i&&(i=r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?n.validatorFn.call(n.validatorFnThisObj||n,e,t):{valid:!1,message:n.L("L{eventOverlapsExisting}")}),i}async updateRecords(e){const t=this,n=t.scheduler,r=t.currentOverClient;n.eventStore.suspendAutoCommit(),r.eventStore.suspendAutoCommit();const i=await t.updateAssignments(n,r,e,false);return n.eventStore.resumeAutoCommit(),r.eventStore.resumeAutoCommit(),r.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:false,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource})),i}async updateAssignments(e,t,n,r){const i=this,s=e!==t,o="vertical"===t.mode,{assignmentStore:a,eventStore:l,resourceStore:c}=e,{assignmentStore:d,eventStore:u,resourceStore:h}=t,{eventRecords:g,assignmentRecords:m,timeDiff:p,initialAssignmentsState:f,resourceRecord:v,newResource:y}=n,b=i.unifiedDrag,C=i.adjustStartDate(m[0].event.startDate,p),w=[],S=[],E=[],D=[],x=[],R=new Set,T=new Set;e.suspendRefresh(),t.suspendRefresh();let M,F=!1,A=!1;M=s?h.indexOf(y)-c.indexOf(v):i.constrainDragToResource?0:c.indexOf(v)-c.indexOf(y),o&&g.forEach(((t,r)=>{const i=n.eventBarEls[r];delete t.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const I=n.eventBarEls.slice();for(let e=0;e<m.length;e++){let t=m[e],n=t.event;if(!(t.isOccurrenceAssignment||a.includes(t)&&l.includes(n))){I[e].remove(),I.splice(e,1),m.splice(e,1),e--;continue}const o=f[e],h=n,g=o.startDate,v=o.resource,O=this.constrainDragToTimeSlot?g:b?C:i.adjustStartDate(g,p);if(R.add(v),r)t=t.copy(null),E.push(t);else if(a!==d){const e=h.assignments.length>1,r=t.copy();if(D.push(t),e||S.push(h),!u.getById(h.id)){const e=Object.assign({},h.data,{id:h.id,calendar:null});n=e,w.push(e)}u.usesSingleAssignment||E.push(r),t=r}let L=y;if(!b)if(s){if(e>0){const e=v.resourceStore.indexOf(v);L=L.resourceStore.getAt(e+M)||L}}else if(0!==M){const e=Math.max(Math.min(c.indexOf(v)-M,c.count-1),0);L=c.getAt(e)}else L=v;var k;if(R.add(L),t.resource!==L&&(t.resource=L,n.isEvent&&T.add(n),F=!0,n.isOccurrence&&n.set("newResource",L),s&&u.usesSingleAssignment&&(n.resourceId=L.id)),!x.find((e=>e.draggedEvent===n))&&!Mt.isEqual(n.startDate,O))n.startDate=O,x.push({draggedEvent:n,originalStartDate:g}),n.isEvent&&T.add(n),A=!0,null===(k=n.resources)||void 0===k||k.forEach((e=>R.add(e)))}a.remove(D),l.remove(S),d.add(E);const O=u.add(w);if(!i.constrainDragToTimeline)for(let r=0;r<m.length;r++){const i=m[r].event,s=(null==O?void 0:O.find((e=>e.id===i.id)))||i,o=n.eventBarEls[r],a=0===r?n.context.element:n.context.relatedElements[r-1],l=t.isInTimeAxis(s);if(Ur.removeChild(e.foregroundCanvas,o),s.resource&&t.rowManager.getRowFor(s.resource)&&l){const e=nn.from(a,t.foregroundCanvas,!0);er.setTranslateXY(a,e.x,e.y),a.classList.remove("b-sch-event-hover"),a.classList.remove("b-active"),a.classList.remove("b-drag-proxy"),a.classList.remove("b-dragging"),a.retainElement=!1,Ur.addChild(t.foregroundCanvas,a,s.assignments[0].id)}}null==O||O.forEach((e=>T.add(e))),(D.length||S.length||E.length||w.length)&&(F=!0),(F||A)&&(u.usesSingleAssignment&&T.forEach((e=>e.beginBatch())),await Promise.all([t.project!==e.project?t.project.commitAsync():null,e.project.commitAsync()]),u.usesSingleAssignment&&T.forEach((e=>e.endBatch(!1,!0)))),F||(F=x.some((({draggedEvent:e,originalStartDate:t})=>!Mt.isEqual(e.startDate,t)))),t.resumeRefresh(),e.resumeRefresh(),m.length>0&&(F?(t.refreshWithTransition(),s&&e.refreshWithTransition()):n.valid=!1)}getProductDragContext(e){const t=this.scheduler.resolveEventRecord(e.browserEvent.target);let n;n=this.constrainDragToResource?e.resourceRecord:this.constrainDragToTimeline?this.resolveResource()||e.newResource||e.resourceRecord:this.resolveResource();const{assignmentRecords:r,eventRecords:i}=e;return{valid:Boolean(n),draggedRecords:i,eventRecords:i,assignmentRecords:r,newResource:n,targetEventRecord:t}}getMinimalDragData(e){const t=this,{scheduler:n}=t,r=t.getElementFromContext(e),i=n.resolveEventRecord(r),s=n.resolveResourceRecord(r),o=n.resolveAssignmentRecord(r),a=o?[o]:[];n.multiEventSelect&&o&&(n.isAssignmentSelected(a[0])||t.drag.startEvent.ctrlKey)&&a.push.apply(a,t.getRelatedRecords(o));return{eventRecord:i,resourceRecord:s,assignmentRecord:o,eventRecords:[...new Set(a.map((e=>e.event)))],assignmentRecords:a}}setupProductDragData(e){const t=this,{scheduler:n}=t,r=t.getElementFromContext(e),{eventRecord:i,resourceRecord:s,assignmentRecord:o,assignmentRecords:a}=t.getMinimalDragData(e),l=nn.from(r),c=[];if(t.constrainDragToResource&&!s)throw new Error("Resource could not be resolved for event: "+i.id);const d=n.getDateConstraints(t.constrainDragToResource?s:null,i);return t.constrainDragToTimeline&&t.setupConstraints(n.getScheduleRegion(t.constrainDragToResource?s:null,i),l,n.timeAxisViewModel.snapPixelAmount,Boolean(d)),a.forEach((e=>{let t=n.getElementFromAssignmentRecord(e);t||(t=n.currentOrientation.addTemporaryDragElement(e.event,e.resource),t=t.innerElement),c.push(t)})),c.forEach(((e,t)=>c[t]=e.parentNode)),{record:o,draggedEntities:a,dateConstraints:d,eventBarEls:c}}getDragData(e){const t=this.getMinimalDragData(e)||{};return d(d(d({},super.getDragData(e)),t),{},{initialAssignmentsState:t.assignmentRecords.map((e=>({startDate:e.event.startDate,resource:e.resource,assignment:e})))})}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter((t=>t!==e&&t.event.isDraggable))}getCoordinate(e,t,n){const r=this.currentOverClient;if(r.isHorizontal){let i=n[0];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}{let i=n[1];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":i+=t.offsetHeight/2;break;case"end":i+=t.offsetHeight}return i}}resolveResource(){const e=this.dragData.dragProxy||this.dragData.context.element,t=this.currentOverClient,{isHorizontal:n}=t,{context:r}=this.dragData,i=nn.from(e,null,!0),s=t.isVertical||this.unifiedDrag?r.clientY:i.center.y,o=nn.from(e,t.timeAxisSubGridElement,!0),{x:a,y:l}=o.center;let c;if(n){const e=t.rowManager.getRowAt(s);c=e&&t.resourceStore.getAt(e.dataIndex)}else c=t.resolveResourceRecord(t.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[a,l]);return c}adjustStartDate(e,t){const n=this.currentOverClient;return n.timeAxis.roundDate(new Date(e-0+t),!!n.snapRelativeToEventStartDate&&e)}getRecordElement(e){return this.scheduler.getElementFromAssignmentRecord(e,!0)}}Of._$name="EventDrag",Tu.registerFeature(Of,!0,"Scheduler"),Tu.registerFeature(Of,!1,"ResourceHistogram");class Lf extends lf{static get $name(){return"EventDragCreate"}static get configurable(){return{validatorFn:()=>!0}}construct(e,t){this.scheduler=e,super.construct(e,t)}get store(){return this.scheduler.eventStore}handleBeforeDragCreate(e,t,n){const r=this.scheduler.trigger("beforeDragCreate",{resourceRecord:e.resourceRecord,date:e.mousedownDate,event:n});return this.dateConstraints=this.scheduler.getDateConstraints(e.resourceRecord,t),r}dragStart(e){var t;const n=this,{client:r}=n,i=r.isHorizontal?"X":"Y",{timeAxis:s,eventStore:o,enableEventAnimations:a,features:l}=r,{event:c,mousedownDate:d,date:u,resourceRecord:h}=e,g=n.draggingEnd=c[`page${i}`]>e.startEvent[`page${i}`],m=o.createRecord({name:o.modelClass.fieldMap.name.defaultValue||n.L("L{Object.newEvent}"),startDate:Mt.floor(g?d:u,s.resolution),endDate:Mt.ceil(g?u:d,s.resolution)}),p=Boolean(l.eventEdit&&!l.eventEdit.disabled||l.taskEdit&&!l.taskEdit.disabled||l.simpleEventEdit&&!l.simpleEventEdit.disabled),f=[h];return m.set("duration",Mt.diff(m.startDate,m.endDate,m.durationUnit,!0)),m.isCreating=p,!1!==n.handleBeforeDragCreate(e,m,e.event)&&(h&&o.assignEventToResource(m,h),!1!==r.trigger("beforeEventAdd",{eventRecord:m,resourceRecords:f})&&(null===(t=r.onEventCreated)||void 0===t||t.call(r,m),r.enableEventAnimations=!1,o.add(m),r.project.commitAsync().then((()=>r.enableEventAnimations=a)),r.isCreating=!0,r.refreshRows(),r.isCreating=!1,e.itemElement=e.element=r.getEventElement(m),super.dragStart(e)))}checkValidity(e,t){const n=this,{client:r}=n;return e.resourceRecord=n.dragging.resourceRecord,(r.allowOverlap||r.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&n.createValidatorFn.call(n.validatorFnThisObj||n,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}}Lf._$name="EventDragCreate",Tu.registerFeature(Lf,!0,"Scheduler"),Tu.registerFeature(Lf,!1,"ResourceHistogram");class Pf extends(br(uo)){static get $name(){return"EventDragSelect"}construct(e,t){this.timeline=e,this.onDocumentMouseUp=this.onDocumentMouseUp.bind(this),e.multiEventSelect=!0;this.targetSelector=[".b-timeline-subgrid .b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const t=this,n=t.client;e.touches||0!==e.button||t.disabled||e.target.matches(t.targetSelector)&&(t.startX=e.clientX,t.startY=e.clientY,t.element=er.createElement({tag:"div",className:"b-dragselect-rect"},!0)[0],n.floatRoot.appendChild(t.element),n.element.classList.add("b-dragselecting"),t.eventRectangles=Array.from(n.element.querySelectorAll(n.eventSelector)).map((e=>({rectangle:nn.from(e,!0),record:n.resolveEventRecord(e)}))),n.clearEventSelection(),t.subGridElementRect=nn.from(n.timeAxisSubGrid.element,!0),n.navigator.disabled=!0,document.addEventListener("mouseup",t.onDocumentMouseUp))}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){const n=Math.max(e.clientX,t.subGridElementRect.left),r=Math.max(e.clientY,t.subGridElementRect.top),i=Math.min(t.startX,n),s=Math.min(t.startY,r),o=Math.abs(t.startX-n),a=Math.abs(t.startY-r),l=new nn(i,s,o,a).constrainTo(t.subGridElementRect);er.setTranslateXY(t.element,l.left,l.top),t.element.style.width=l.width+"px",t.element.style.height=l.height+"px",t.rectangle=l,t.updateSelection()}}onDocumentMouseUp(e){var t;const n=this,r=n.client,{selectedAssignments:i,navigator:s}=r;null===(t=n.element)||void 0===t||t.remove(),r.element.classList.remove("b-dragselecting"),n.startX=n.startY=null,s.skipNextClick=r.timeAxisSubGridElement.contains(e.target),s.disabled=!1,i.length&&(s.skipScrollIntoView=!0,r.activeAssignment=i[i.length-1],s.activeItem.focus(),s.skipScrollIntoView=!1),document.removeEventListener("mouseup",n.onDocumentMouseUp)}updateSelection(){const e=this,t=e.eventRectangles,n=e.rectangle;for(let r=0,i=t.length;r<i;r++){const i=t[r],s=n.intersect(i.rectangle,!0);s&&!i.selected?(i.selected=!0,e.client.selectEvent(i.record,!0)):!s&&i.selected&&(i.selected=!1,e.client.deselectEvent(i.record))}}}Pf._$name="EventDragSelect",Tu.registerFeature(Pf,!1,"Scheduler");class _f extends Ns{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.makeChained((e=>!e.isSpecialRow),null,{excludeCollapsedRecords:!1})}processWidgetConfig(e){var t;const{eventEditFeature:n}=this;if(null!==(t=e.type)&&void 0!==t&&t.includes("date")&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"extraItems"===e.type)return!1;let r={};if("resourceField"===e.ref){if(!n.showResourceField)return!1;e.store=this.chainResourceStore(),e.multiSelect=!n.eventStore.usesSingleAssignment,n.resourceFieldConfig&&(r=n.resourceFieldConfig)}return!("nameField"===e.ref&&!n.showNameField)&&(!("deleteButton"===e.ref&&!n.showDeleteButton)&&("startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(r.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(r.format=n.timeFormat),n.startDateConfig&&"startDate"===e.name&&"date"===e.type&&(r=n.startDateConfig),n.startTimeConfig&&"startDate"===e.name&&"time"===e.type&&(r=n.startTimeConfig),n.endDateConfig&&"endDate"===e.name&&"date"===e.type&&(r=n.endDateConfig),n.endTimeConfig&&"endDate"===e.name&&"time"===e.type&&(r=n.endTimeConfig),Object.assign(e,r),super.processWidgetConfig(e)))}show(...e){const{resourceField:t}=this.widgetMap;t&&(t.store=this.chainResourceStore()),super.show(...e)}onBeforeShow(...e){const t=this,{record:n,titleRenderer:r}=t,i=t.widgetMap.deleteButton;i&&(i.hidden=t.readOnly||n.isCreating),t.title=r?t.callback(r,t,[n]):t.initialTitle,super.onBeforeShow&&super.onBeforeShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:n,cancelButton:r}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),n&&(n.hidden=e),r&&(r.hidden=e)}}_f.initClass(),_f._$name="EventEditor";class $f extends Ns{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:window,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeMultipleButton:{weight:100,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},changeSingleButton:{weight:200,color:"b-gray",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","thisObj"].forEach((n=>{n in e&&(t[n]=e[n])})),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:n,cancelButton:r}=e.widgetMap,{eventRecord:i,actionType:s="update"}=e,o=i&&i.isRecurring;o?(t.text=e.L("L{Object.Yes}"),e.html=e.L(`${s}-all-message`)):(t.text=e.L(`${s}-further-btn-text`),e.html=e.L(`${s}-further-message`)),n.text=e.L(`${s}-only-this-btn-text`),r.text=e.L("L{Object.Cancel}"),o?n.hide():n.show(),e.width=e.L("L{width}"),e.title=e.L(`${s}-title`)}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:n}=this;e.beginBatch(),this.callback(t,n,[e]),e.endBatch()}processSingleRecord(){const{eventRecord:e,changerFn:t,thisObj:n}=this;e.beginBatch(),e.recurrence=null,this.callback(t,n,[e]),e.recurrenceRule=null,e.endBatch()}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}}$f.initClass(),$f._$name="RecurrenceConfirmationPopup";class Hf extends(ch(cd)){static get $name(){return"RecurrenceFrequencyCombo"}static get type(){return"recurrencefrequencycombo"}static get defaultConfig(){return{editable:!1,displayField:"text",valueField:"value"}}buildLocalizedItems(){return[{value:"DAILY",text:this.L("L{Daily}")},{value:"WEEKLY",text:this.L("L{Weekly}")},{value:"MONTHLY",text:this.L("L{Monthly}")},{value:"YEARLY",text:this.L("L{Yearly}")}]}}Hf.initClass(),Hf._$name="RecurrenceFrequencyCombo";class jf extends Hf{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildLocalizedItems(){const e=this;return[{value:"none",text:e.L("L{None}")},...super.buildLocalizedItems(),{value:e.customValue,text:e.L("L{Custom}"),cls:e.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:n,monthDays:r,months:i}=e;return Boolean(t>1||n&&n.length||r&&r.length||i&&i.length)}}jf.initClass(),jf._$name="RecurrenceCombo";class Bf extends Rs{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const e=this,{recurrence:t}=e;e.text=t?Qp.getLegend(t,e.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}}Bf.initClass(),Bf._$name="RecurrenceLegendButton";class Nf extends(ch(cd)){static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter(((e,t)=>!Mt.nonWorkingDays[t])).join(","),nonWorkingDaysValue:e.filter(((e,t)=>Mt.nonWorkingDays[t])).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildLocalizedItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=Mt.weekStartDay,n=Mt.getDayNames().map(((e,t)=>({text:e,value:Cm.encodeDay(t)})));e._weekDays=n.slice(t).concat(n.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}}Nf.initClass(),Nf._$name="RecurrenceDaysCombo";class zf extends md{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}updateItemText(e){const t=Cm.decodeDay(e.value)[0];e.text=Mt.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=Mt.weekStartDay,n=Mt.getDayNames().map(((e,t)=>({text:e.substring(0,3),value:Cm.encodeDay(t)})));e.__items=n.slice(t).concat(n.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}zf.initClass(),zf._$name="RecurrenceDaysButtonGroup";class Vf extends md{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let n=e.minValue;n<=e.maxValue;n++)t.push({text:n+"",value:n});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Vf.initClass(),Vf._$name="RecurrenceMonthDaysButtonGroup";class Wf extends md{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){e.columns=4,e.items=this.buildItems(),super.construct(e)}buildItems(){return Mt.getMonthNames().map(((e,t)=>({text:e.substring(0,3),value:t+1})))}updateItemText(e){e.text=Mt.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}}Wf.initClass(),Wf._$name="RecurrenceMonthsButtonGroup";class Gf extends(ch(cd)){static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildLocalizedItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}}Gf.initClass(),Gf._$name="RecurrenceStopConditionCombo";class Uf extends(ch(cd)){static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildLocalizedItems(){const e=this;return e.buildDayNumbers().concat([{value:"-1",text:e.L("L{position-1}"),cls:e.splitCls}])}buildDayNumbers(){const e=this;return Ce.populate(e.maxPosition,(t=>({value:t,text:e.L(`position${t+1}`)})))}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){const e=super.value;return e?`${e}`.split(",").map((e=>parseInt(e,10))):[]}}Uf.initClass(),Uf._$name="RecurrencePositionsCombo";class Yf extends Ns{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,defaults:{localeClass:this},items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{Frequency}",weight:10,onChange:"up.onFrequencyFieldChange"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}updateRecord(e){super.updateRecord(e);const t=this,n=e.timeSpan,r=n&&n.startDate,{daysButtonField:i,monthDaysButtonField:s,monthsButtonField:o,monthDaysRadioField:a,positionAndDayRadioField:l,stopRecurrenceField:c}=t.widgetMap;r&&(e.days&&e.days.length||(i.value=[Cm.encodeDay(r.getDay())]),e.monthDays&&e.monthDays.length||(s.value=r.getDate()),e.months&&e.months.length||(o.value=r.getMonth()+1)),e.days&&e.positions?(l.check(),t.isPainted||a.uncheck()):(a.check(),t.isPainted||l.uncheck()),c.recurrence=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}syncEventRecord(e){const t=this.getValues((t=>t.name in e&&!t.disabled));e.set(t)}toggleStopFields(){const{countField:e,endDateField:t}=this.widgetMap;switch(this.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:n}=this.widgetMap;t.disabled=n.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.indexOf(t)>-1}onFrequencyFieldChange({value:e,valid:t}){const n=this,r=n.queryAll((e=>"forFrequency"in e));if(t&&e){for(let t=0;t<r.length;t++){const i=r[t];n.isWidgetAvailableForFrequency(i,e)?(i.show(),i.enable()):(i.hide(),i.disable())}n.widgetMap.intervalField.hint=n.L(`${e}intervalUnit`),n.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:t}=this;e.onMonthDaysRadioFieldChange({checked:t.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:n}=this.widgetMap;e.hint=this.L("L{time(s)}"),n.value&&(t.hint=this.L(`${n.value}intervalUnit`)),super.updateLocalization()}}Yf.initClass(),Yf._$name="RecurrenceEditor";var qf=e=>class extends(e||me){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",flex:"1",weight:800}},showRecurringUI:null}}changeEditorConfig(e){return e.items=d(d({},e.items),this.recurringEventsItems),e=super.changeEditorConfig(e)}construct(e,t){const n=this;super.construct(e,t),n.scheduler.on({beforeEventDelete:n.onRecurrableEventBeforeDelete,beforeEventSave:n.onRecurrableEventBeforeSave,thisObj:n})}doDestroy(){this._recurrenceConfirmation&&this.recurrenceConfirmation.destroy(),this._recurrenceEditor&&this.recurrenceEditor.destroy(),super.doDestroy()}onEditorConstructed(e){const t=this;e.on({hide:t.onRecurringEventEditorHide,thisObj:t}),t.editRecurrenceButton&&(t.editRecurrenceButton.menu=t.recurrenceEditor),t.recurrenceCombo&&t.recurrenceCombo.on({change:t.onRecurrenceComboChange,thisObj:t})}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){var t,n,r,i;const s=e?"show":"hide";null===(t=this.editRecurrenceButton)||void 0===t||null===(n=t[s])||void 0===n||n.call(t),null===(r=this.recurrenceCombo)||void 0===r||null===(i=r[s])||void 0===i||i.call(r)}onRecurringEventEditorHide(){var e,t;null!==(e=this.recurrenceEditor)&&void 0!==e&&e.isVisible&&this.recurrenceEditor.hide(),null!==(t=this.recurrenceConfirmation)&&void 0!==t&&t.isVisible&&this.recurrenceConfirmation.hide()}makeRecurrence(e){const t=this.eventRecord,n=t.copy();let r=t.recurrence;return r=!e&&r?r.copy():new t.recurrenceModel(e?{rule:e}:{}),r.timeSpan=n,n.setStartDate(this.values.startDate),r.suspendTimeSpanNotifying(),r}onRecurrableEventBeforeSave({eventRecord:e,context:t}){const n=this;e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(n.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0)}showDisplayConfirmationOnEventDelete(e){return this.isEditing&&this.eventRecord===e&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)}onRecurrableEventBeforeDelete({eventRecords:e,context:t}){const n=e[0];if(this.showDisplayConfirmationOnEventDelete(n))return this.recurrenceConfirmation.confirm({actionType:"delete",eventRecord:n,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}set recurrenceConfirmation(e){this._recurrenceConfirmation=e}get recurrenceConfirmation(){const e=this;let t=e._recurrenceConfirmation;return t&&t.$$name||(t=ki.create(Object.assign({type:"recurrenceconfirmation",owner:e.getEditor()},t)),e._recurrenceConfirmation=t),t}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$$name||(t=ki.create(Object.assign({type:"recurrenceeditor",autoShow:!1,clippedBy:[e.scheduler.timeAxisSubGridElement,e.scheduler.bodyContainer],centered:!0,modal:!0,constrainTo:window,anchor:!1,rootElement:e.rootElement,saveHandler:e.recurrenceEditorSaveHandler,onBeforeShow:e.onBeforeShowRecurrenceEditor.bind(e),thisObj:e},t)),e._recurrenceEditor=t,t.readOnly=e._readOnly),t}onBeforeShowRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:n}=e;t&&n&&n.supportsRecurring&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this,{editRecurrenceButton:n}=t;t.recurrenceCombo&&(t.recurrenceCombo.recurrence=e),n&&(n.recurrence=e,n.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?n.show():n.hide())}onRecurrenceComboChange({source:e,value:t,userAction:n}){const r=this,{recurrenceEditor:i}=r;t==e.customValue?n&&(r.recurrenceCombo.recurrence=r.makeRecurrence(),i.centered?i.show():i.show((r.editRecurrenceButton||e).element)):r.loadRecurrenceData(t?r.makeRecurrence(`FREQ=${t}`):null)}recurrenceEditorSaveHandler(e,t){e.syncEventRecord(t),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){if(super.onDatesChange(...e),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:e}=this.values;e&&(this.editRecurrenceButton.eventStartDate=e)}}internalLoadRecord(e,t){e&&e.supportsRecurring&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}};class Kf extends cd{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,picker:{cls:"b-resourcecombo-picker",itemIconTpl(e,t){const{eventColor:n}=e,r=!er.isNamedColor(n);return`<div class="b-icon b-icon-square${!n||r?"":` b-sch-foreground-${n}`}"${n?r?` style="color:${n}"`:"":' style="display:none"'}></div>`}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){const{_picker:t}=this,n=e?"add":"remove";this.element.classList[n]("b-show-event-color"),null==t||t.element.classList[n]("b-show-event-color")}changePicker(e,t){var n;return null===(n=e=super.changePicker(e,t))||void 0===n||n.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"b-icon b-resource-icon b-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,t;const n=this,{resourceIcon:r,lastResourceIconCls:i}=n,{classList:s}=r,o=null!==(e=null===(t=n.selected)||void 0===t?void 0:t.eventColor)&&void 0!==e?e:"";super.syncInputFieldValue(),r.style.color="",i&&s.remove(i),n.lastResourceIconCls=null,o?(er.isNamedColor(o)?(n.lastResourceIconCls=`b-sch-foreground-${o}`,s.add(n.lastResourceIconCls)):r.style.color=o,s.remove("b-hide-display")):s.add("b-hide-display")}}Kf.initClass(),Kf._$name="ResourceCombo";class Xf extends(hf.mixin(qf,br)){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",showResourceField:!0,resourceFieldConfig:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{Start}",name:"startDate",flex:"1 0 60%",weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",flex:"1 0 40%",weight:400},endDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{End}",name:"endDate",flex:"1 0 60%",weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",flex:"1 0 40%",weight:600}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-green",text:"L{Save}",weight:100},deleteButton:{color:"b-gray",text:"L{Delete}",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,t){this.scheduler=e,this.readOnly=e.readOnly,super.construct(e,t),e.on({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get readOnly(){return this.editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){this.editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}getEditor(){var e,t,n,r,i;const s=this;let{editor:o}=s;return o||(o=s.editor=ki.create(s.getEditorConfig()),o.readOnly=s._readOnly,0===o.items.length&&console.warn("Event Editor configured without any `items`"),o.on({beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s}),s.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach((e=>{const t=e.ref||e.id;if(t&&!s[t])switch(s[t]=e,e.name){case"startDate":case"endDate":e.on("change",s.onDatesChange,s)}})),null===(e=s.onEditorConstructed)||void 0===e||e.call(s,o),null===(t=s.eventTypeField)||void 0===t||t.on("change",s.onEventTypeChange,s),null===(n=s.saveButton)||void 0===n||n.on("click",s.onSaveClick,s),null===(r=s.deleteButton)||void 0===r||r.on("click",s.onDeleteClick,s),null===(i=s.cancelButton)||void 0===i||i.on("click",s.onCancelClick,s),s.editor)}getEditorConfig(){const e=this,{autoClose:t,cls:n,scheduler:r}=e;return Ot.assign({owner:r,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:`${r.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[r.timeAxisSubGridElement,r.bodyContainer],constrainTo:window,autoClose:t,cls:n},e.editorConfig)}internalShowEditor(e,t,n=null){var r,i,s;const o=this,{scheduler:a}=o,l=(null===(r=n)||void 0===r||null===(i=r.target)||void 0===i?void 0:i.nodeType)===Element.ELEMENT_NODE?n.target:er.down(a.getElementFromEventRecord(e,t),a.eventInnerSelector),c=e.isPartOfStore(a.eventStore);if((n=null!==(s=n)&&void 0!==s?s:{target:l,anchor:!0}).target||!c||e.isCreating){if(!1===a.trigger("beforeEventEdit",{eventEdit:o,eventRecord:e,resourceRecord:t,eventElement:l}))return a.element.classList.remove("b-eventeditor-editing"),!1;o.resourceRecord=t;const r=o.getEditor(e);o.editingContext={eventRecord:e,resourceRecord:t,eventElement:l,editor:r,isPartOfStore:c},super.internalShowEditor&&super.internalShowEditor(e,t,n),o.typeField&&o.toggleEventType(e.get(o.typeField)),o.loadRecord(e,t),r.centered||!r.anchor?r.show():l?(o.targetEventElement=l,r.showBy(n)):(r.show(),r.updateCentered(!0));const i=a.timeAxisViewModel.timeResolution;if("hour"===i.unit||"minute"===i.unit){const e=`${i.increment}${i.unit}`;o.startTimeField&&(o.startTimeField.step=e),o.endTimeField&&(o.endTimeField.step=e)}o.detachListeners("changesWhileEditing"),a.eventStore.on({change:o.onChangeWhileEditing,refresh:o.onChangeWhileEditing,thisObj:o,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",d({eventEdit:this},this.editingContext))}updateTargetEventElement(e,t){e&&e.classList.add("b-editing"),t&&t.classList.remove("b-editing")}editEvent(e,t,n=null){const r=this;if(r.isEditing&&r.resetEditingContext(),!r.disabled)return r.scheduler.element.classList.add("b-eventeditor-editing"),r.doEditEvent(...arguments)}get isEditing(){var e;return Boolean(null===(e=this.editor)||void 0===e?void 0:e.isVisible)}doEditEvent(e,t,n=null){const r=this,{scheduler:i}=r,s=e.isCreating;t||(t=e.resource||r.resourceStore.getById(e.resourceId)),s&&vm.prototype.normalize.call(e),n||s?r.internalShowEditor(e,t,n?{target:n}:null):i.scrollResourceEventIntoView(t,e,null,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then((()=>r.internalShowEditor(e,t)),(()=>i.element.classList.remove("b-eventeditor-editing")))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){return this.editor.record}internalLoadRecord(e,t){const n=this,{eventStore:r}=n.client,{editor:i}=n;if(n.resourceRecord=t,i.record=e,n.resourceField){const s=r.getResourcesForEvent(e);i._isSettingValues=!0,!r.storage.includes(e,!0)&&t?n.resourceField.value=t[n.resourceField.valueField]:n.assignmentStore&&(n.resourceField.value=s.map((e=>e[n.resourceField.valueField]))),i._isSettingValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((t=>{var n;(null===(n=t.dataset)||void 0===n?void 0:n.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}async finalizeEventSave(e,t,n,r){const i=this,{scheduler:s,eventStore:o,assignmentStore:a}=i;a.suspendAutoCommit(),s.suspendRefresh(),i.onBeforeSave(e),e.beginBatch(),i.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):i.resourceField&&o.assignEventToResource(e,t,!0),e.isCreating=!1,await s.project.commitAsync(),a.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),i.onAfterSave(e),n(e)}save(){return new Promise(((e,t)=>{var n;const r=this,{scheduler:i,eventRecord:s}=r;if(!s||!r.isValid)return void e(!1);const{eventStore:o,values:a}=r,l=(null===(n=r.resourceField)||void 0===n?void 0:n.records)||(r.resourceRecord?[r.resourceRecord]:[]),c=l[0];if(!r.scheduler.allowOverlap&&o){if(l.some((e=>!o.isDateRangeAvailable(a.startDate,a.endDate,s,e))))return void e(!1)}const d={finalize(n){try{!1!==n?r.finalizeEventSave(s,l,e,t):e(!1)}catch(e){t(e)}}};!1!==i.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,resourceRecord:c,values:a,context:d})?d.async||d.finalize():e(!1)}))}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise(((e,t)=>{const{eventRecord:n,editor:r}=this;this.scheduler.removeEvents([n],(t=>{t&&r.containsFocus&&r.revertFocus(),e(t)}))}))}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:n}){this.editEvent(e,t,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:n}){this.disabled||this.editEvent(e,t,n)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:n}){const r=n.closest(this.client.eventInnerSelector);e?this.editEvent(t,e.resource,r):t&&this.editEvent(t,t.resource,r)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:n}){this.scheduler.readOnly||(n.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"b-icon b-icon-edit",weight:100,onItem:()=>{this.editEvent(e,t)}})}resetEditingContext(){this.detachListeners("changesWhileEditing"),super.resetEditingContext(),this.resourceRecord=this.editingContext=this.editor._record=null}}Xf._$name="EventEdit",Tu.registerFeature(Xf,!0,"Scheduler"),Tu.registerFeature(Xf,!1,["SchedulerPro","ResourceHistogram"]),Xf.initClass();class Zf extends uo{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateHeaderMenu","populateTimeAxisHeaderMenu"]}}construct(e,t){super.construct(e,t),this.scheduler=e}populateHeaderMenu({column:e,items:t}){"timeAxis"===e.type&&this.populateTimeAxisHeaderMenu(...arguments)}populateTimeAxisHeaderMenu({column:e,items:t}){const n=this;t.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon b-icon-filter",disabled:n.disabled,localeClass:this,weight:100,menu:{type:"popup",localeClass:this,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:this,width:200,listeners:{change:n.onEventFilterChange,thisObj:n}}},onBeforeShow({source:e}){const[t]=e.items,r=n.scheduler.eventStore.filters.getBy("property","name");t.value=r&&r.value||""}}}}onEventFilterChange({value:e}){const t=this;""!==e?t.scheduler.eventStore.filter("name",e):t.scheduler.eventStore.removeFilter("name")}}Zf.featureClass="b-event-filter",Zf._$name="EventFilter",Tu.registerFeature(Zf,!0,["Scheduler","Gantt"]),Tu.registerFeature(Zf,!1,"ResourceHistogram");class Jf extends vf{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?A.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0}}construct(e,t){const n=this;super.construct(e,t),"string"==typeof n.align&&(n.align={align:n.align})}onPaint({firstPaint:e}){if(super.onPaint(...arguments),e){const e=this,t=e.client.features.dependencies;if(t){const n=e.align.offset;e.tooltip.on("beforeshow",(({source:e})=>{t.disabled?e.align.offset=n:e.align.offset=[0,10]}))}}}}Jf._$name="EventTooltip",Tu.registerFeature(Jf,!0,"Scheduler"),Tu.registerFeature(Jf,!1,"ResourceHistogram");class Qf extends(Be()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const n=t.timeAxis.viewPreset||t.viewPreset;if(n)if(n instanceof Kp)t.consumeViewPreset(n);else{const e=Zp.getPreset(n);e&&t.consumeViewPreset(e)}t.timeAxis.on("reconfigure",t.onTimeAxisReconfigure,t),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,n=!1){const r=this,{timeAxis:i,headers:s}=r;if(r.isConfiguring||r._availableSpace===e)return void(n&&r.trigger("update"));if(r._availableSpace=Math.max(e||r.availableSpace||0,0),"number"!=typeof r.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");r.columnConfig=[];const o=r._tickSize=r.calculateTickSize(r.originalTickSize);if("number"!=typeof o||o<=0)throw new Error("Invalid timeAxis tick size");r.unitToPixelsCache={},r._totalSize=null;for(let e=0,{length:t}=s;e<t;e++){const t=s[e];if(t.cellGenerator){const n=t.cellGenerator.call(r,i.startDate,i.endDate);r.columnConfig[e]=r.createHeaderRow(e,t,n)}else r.columnConfig[e]=r.createHeaderRow(e,t)}t||r.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const n=this.getScaledTick(e,t);return-1===n?-1:this.tickSize*(n-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:n,isEnd:r,min:i,max:s}){const{timeAxis:o}=this,{include:a,unit:l}=o;let c=o.getTickFromDate(e);if(-1!==c&&t&&a){let t=!1;if(a.hour&&Mt.compareUnits(l,"hour")>0&&"day"!==l){const{from:r,to:i,lengthFactor:s,center:o}=a.hour,l=e.getHours(),c=Math.min(Math.max(l,r),i);if(!n&&c!==l)return-1;const d=o-(o-(c+e.getMinutes()/60))*s;e=Mt.add(e,d-l,"h"),t=!0}if(a.day&&Mt.compareUnits(l,"day")>0){const{from:l,to:c,lengthFactor:d,center:u}=a.day;let h=e.getDay();r&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<l||h>=c){if(!n)return-1;if(g=r?(c-h-8)%7:(l-h+7)%7,e=Mt.add(e,g,"d"),e=Mt.startOf(e,"d",!1),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const{weekStartDay:m}=o,p=0===e.getDay()?0:u,f=e.getDay()+e.getHours()/24,v=p-(p-f)*d;e=Mt.add(e,v-f+m,"d"),t=!0}t&&(e=Mt.constrain(e,o.startDate,o.endDate),c=o.getTickFromDate(e))}return c}getDateFromPosition(e,t,n=!1){const r=this,{timeAxis:i}=r,s=r.getScaledPosition(e)/r.tickSize+i.visibleTickStart;if(s<0||s>i.count){if(n){let e;return e=s<0?Mt.add(i.startDate,s,i.unit):Mt.add(i.endDate,s-i.count,i.unit),t&&(e=i[t+"Date"](e)),e}return null}return i.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:n,weekStartDay:r}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&Mt.compareUnits(n,"day")>0){const{from:n,lengthFactor:s}=t.day,o=e%(7*i);e=o/s+(n-r)*i+(e-o)}if(t.hour&&Mt.compareUnits(n,"hour")>0&&"day"!==n){const{from:n,lengthFactorExcl:r}=t.hour,s=e%i;e=s/r+n*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=Mt.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(n,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:n,timeAxis:r,suppressFit:i}=t,s=r.unit;let o=0,a=1;if(t.snap){const e=r.resolution;a=Mt.getUnitToBaseUnitRatio(s,e.unit)*e.increment}if(i)o=e;else{const i=t.availableSpace/r.visibleTickTimeSpan;o=n||e<i?i:e,a>0&&(!n||a<1)&&(o=Math.max(1,a*o)/a)}return o}get totalSize(){return this._totalSize||(this._totalSize=Math.round(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,n=!1){const r=this,i=[],s=t?r.lowestHeader:e,o=r.majorHeaderLevel,a=r.headers&&r.headers[e].unit,l=null!=o&&r.headers&&r.headers[o].unit,c=null!=o&&Mt.doesUnitsAlign(l,a);if(!(!r.headers||!r.headers[s].cellGenerator)){const e=r.columnConfig[s];for(let t=1,n=e.length;t<n;t++)i.push({date:e[t].startDate})}else r.forEachInterval(s,((t,s)=>{i.push({date:n?s:t,isMajor:o!==e&&c&&r.isMajorTick(n?s:t)})}));return i}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,n){const r=this,i=[],s=t.align,o=Mt.clearTime(new Date),a=t.headerCellCls||"",{timeAxis:l}=r,c=r.headers.length-1,d=(n,d,h,g,m)=>{let p=Mt.format(n,t.dateFormat);const f=h>0&&!g,v={align:s,start:n,end:d,value:m?m.header:p,headerCellCls:a,width:c===e&&r.owner&&(l.fullTicks||f)?r.owner.tickSize:r.getDistanceBetweenDates(n,d),index:h};0!==v.width&&(v.coord=u-1,u+=v.width,r.headersDatesCache[e][n.getTime()]=1,t.renderer&&(p=t.renderer.call(t.thisObj||r,n,d,v,h),v.value=null==p?"":p),"day"!==t.unit||t.increment&&1!==t.increment||(v.headerCellCls+=" b-sch-dayheadercell-"+n.getDay(),Mt.clearTime(n,!0)-o==0&&(v.headerCellCls+=" b-sch-dayheadercell-today")),i.push(v))};let u=0;return r.headersDatesCache[e]={},n?n.forEach(((e,t)=>d(e.start,e.end,t,t===n.length-1,e))):r.forEachInterval(e,d),i}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,n=this){const{headers:r,timeAxis:i}=this;if(r)if(e===r.length-1)i.forEach(((e,r)=>t.call(n,e.startDate,e.endDate,r,r===i.count-1)));else{const s=r[e];i.forEachAuxInterval(s.unit,s.increment,t,n)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t._thisIsAUsedExpression(t.tickSize),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}Qf._$name="TimeAxisViewModel";const ev=new Date;var tv=e=>class extends(e||me){static get $name(){return"TimelineDateMapper"}getDateFromCoordinate(e,t,n=!0,r=!1){return n||(e=this.currentOrientation.translateToScheduleCoordinate(e)),this.timeAxisViewModel.getDateFromPosition(e,t,r)}getDateFromXY(e,t,n=!0,r=!1){return this.currentOrientation.getDateFromXY(e,t,n,r)}getDateFromDomEvent(e,t,n=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,n)}getStartEndDatesFromRectangle(e,t,n,r=!1){const i=this,{isHorizontal:s}=i,o=s?i.timeAxisSubGrid.width:i.timeAxisSubGrid.height,a=s?e.x:e.top,l=s?e.right:e.bottom;let c,d;return a>=0&&l<o?(c=i.getDateFromCoordinate(a,t,!0),d=i.getDateFromCoordinate(l,t,!0)):a<0?(d=i.getDateFromCoordinate(l,t,!0,r),c=d&&Mt.add(d,-n,"ms")):(c=i.getDateFromCoordinate(a,t,!0,r),d=c&&Mt.add(c,n,"ms")),{start:c,end:d}}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return Mt.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||Mt.formatContainsHourInfo(this.displayDateFormat)||(e=Mt.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const n=this,{timeAxisViewModel:r}=n,{isContinuous:i,startMS:s,endMS:o,startDate:a,endDate:l,unit:c}=n.timeAxis,d=e.valueOf();let u;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(ev.setTime(e),e=ev),i&&e.getTimezoneOffset()===a.getTimezoneOffset()&&a.getTimezoneOffset()===l.getTimezoneOffset()&&-1!==Mt.getUnitToBaseUnitRatio(c,"day")){if(d<s||d>o)return-1;u=(d-s)/(o-s)*r.totalSize}else u=r.getPositionFromDate(e,t);return t.local||(u=n.currentOrientation.translateToPageCoordinate(u)),u}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const e=this,{isHorizontal:t,timeAxis:n}=e,{scrollable:r}=t?e.timeAxisSubGrid:e,i=r.x+r.clientWidth/2,s=r.y+r.clientHeight/2;if(n.isContinuous){const e=t?i/r.scrollWidth:s/r.scrollHeight,o=n.startMS+(n.endMS-n.startMS)*e;return new Date(o)}{const n=t?[i,0]:[0,s];return e.getDateFromXY(n,null,!0)}}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}set snap(e){this.isConfiguring?this._snap=e:this.timeAxisViewModel.snap=e}get snap(){return this.isConfiguring?this._snap:this.timeAxisViewModel.snap}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}};const nv={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut"};var rv=e=>class extends(e||me){static get $name(){return"TimelineDomEvents"}static get configurable(){return{scheduledBarEvents:{mousedown:"handleScheduledBarEvent",mouseup:"handleScheduledBarEvent",click:"handleScheduledBarEvent",dblclick:"handleScheduledBarEvent",contextmenu:"handleScheduledBarEvent",mouseover:"handleScheduledBarEvent",mouseout:"handleScheduledBarEvent"},schedulerEvents:{click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent"}}}initDomEvents(){const e=this;e.scheduledBarEvents.element=e.schedulerEvents.element=e.timeAxisSubGridElement,e.scheduledBarEvents.thisObj=e.schedulerEvents.thisObj=e,Tr.on(e.scheduledBarEvents),Tr.on(e.schedulerEvents)}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduledBarEvent(e){const t=this,n=er.up(e.target,t.eventInnerSelector);if(n){const r=nv[e.type]||A.capitalize(e.type);t.trigger(t.scheduledEventName+r,t.getTimeSpanMouseEventParams(n,e))}}handleScheduleEvent(e){const t=this,n=!er.up(e.target,t.eventSelector)&&er.up(e.target,"."+t.timeCellCls),r=nv[e.type]||A.capitalize(e.type);if(n){const i=t.getDateFromDomEvent(e,"floor");if(!i)return;const s=sa.get(n),o=s.row.dataIndex,a=t.timeAxis.getTickFromDate(i),l=t.timeAxis.getAt(Math.floor(a));l&&t.trigger("schedule"+r,Object.assign({date:i,tickStartDate:l.startDate,tickEndDate:l.endDate,tickParentIndex:l.parentIndex,row:s.row,index:o,event:e},t.getScheduleMouseEventParams(s,e)))}}onElementMouseButtonEvent(e){const t=er.up(e.target,".b-sch-header-timeaxis-cell");if(t){const n=t.dataset.tickIndex,r=t.parentElement.dataset.headerPosition,i=this.timeAxisViewModel.columnConfig[r][n],s=this.features.contextMenu;if(!s||e.type!==s.triggerEvent){(this.isVertical?this.verticalTimeAxisColumn:this.timeAxisColumn).trigger("timeAxisHeader"+A.capitalize(e.type),{startDate:i.start,endDate:i.end,event:e})}}}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){super.onElementMouseOver(e);const t=this,n=e.target;if(n.closest(t.eventInnerSelector)){const r=n.closest(t.eventSelector);if(r.classList.add(t.overScheduledEventClass),r!==t.hoveredEventNode&&!t.preventOverCls){t.hoveredEventNode=r;const n=t.getTimeSpanMouseEventParams(r,e);n&&t.trigger(t.scheduledEventName+"MouseEnter",n)}}else t.hoveredEventNode=null}onElementMouseOut(e){super.onElementMouseOut(e);const t=this;if(e.target.closest(t.eventInnerSelector)&&t.resolveTimeSpanRecord(e.target)&&t.hoveredEventNode){if(e.relatedTarget&&er.isDescendant(e.target.closest(t.eventInnerSelector),e.relatedTarget))return;t.unhover(e)}}unhover(e){const t=this,n=t.hoveredEventNode;n&&(n.classList.remove(t.overScheduledEventClass),t.trigger(t.scheduledEventName+"MouseLeave",t.getTimeSpanMouseEventParams(n,e)),t.hoveredEventNode=null)}get widgetClass(){}};const iv=(e=0,t=0)=>t-e;var sv=e=>class extends(e||me){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter"}}static get defaultConfig(){return{displayDateFormat:null,presets:!0}}set presets(e){!0===e&&(e=Zp.allRecords),this._presets=new Xp({owner:this,data:e})}get presets(){return this._presets}normalizePreset(e){const t=e,{presets:n}=this;if(!(e instanceof Kp)){if("object"==typeof e){if(e.base){const t=n.getById(e.base)||Zp.getById(e.base);if(!t)throw new Error(`ViewPreset base '${e.base}' does not exist`);e=Ot.merge(Ot.clone(t.data),Zp.createRecord(e).data)}e.id?e=n.createRecord(e):(e=n.createRecord(Ot.assign({},e))).id=e.generateId(n)}else e="number"==typeof e?n.getAt(e):n.getById(e)||Zp.getById(e);if(!e){const e=n.map((e=>e.id));throw new Error(`Invalid ViewPreset: ${t}. Valid strings are ${e.join(", ")}`)}}return n.add(e)[0]}changeViewPreset(e,t){const n=this;if(!(e instanceof Kp)&&e.name&&!e.base)throw new Error("ViewPreset name config replaced by base config. See https://www.bryntum.com/docs/scheduler/#guides/upgrades/3.0.0.md");e=n.normalizePreset(e);const r=n.lastViewPresetOptions||{},i=e.options||(e.options={}),s=i.event={startDate:i.startDate,endDate:i.endDate,from:t,to:e,preset:e},o=!n._viewPreset||!n._viewPreset.equals(e),a=iv(i.startDate,r.startDate)||iv(i.endDate,r.endDate)||iv(i.centerDate,r.centerDate)||i.startDate&&iv(i.startDate,n.startDate)||i.endDate&&iv(i.endDate,n.endDate);if((o||a)&&(o||(n._viewPreset=null),n.isConfiguring||!1!==n.trigger("beforePresetChange",s)))return e}updateViewPreset(e){const t=this,{options:n}=e,{event:r,startDate:i,endDate:s}=n,{isHorizontal:o,_timeAxis:a}=t;let{centerDate:l}=n;if(t._viewPresetChanging=!0,t.displayDateFormat=t.config.displayDateFormat||e.displayDateFormat,a&&!t.isConfiguring){if(t.lastViewPresetOptions=n,a.isConfigured){t.suspendRefresh();const n={weekStartDay:t.weekStartDay,startTime:t.startTime,endTime:t.endTime};i?(n.startDate=i,n.endDate=s,!l&&s&&(l=new Date((i.getTime()+s.getTime())/2))):(n.startDate=a.startDate,n.endDate=s||a.endDate,l||(l=t.viewportCenterDate)),a.isConfigured=!1,a.viewPreset=e,a.reconfigure(n,!0),t.timeAxisViewModel.reconfigure({viewPreset:t.viewPreset,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:o?e.tickWidth:e.tickHeight||e.tickWidth||60}),t.resumeRefresh()}if(t.refresh(),!n.notScroll&&t.isPainted)if(l){t.cachedCenterDate=l,r.centerDate=l;const e=t.isHorizontal?t.timeAxisSubGrid.width:t.scrollable.clientHeight,n=Math.max(t.getCoordinateFromDate(l,!0)-e/2,0);t.viewPresetActiveScroll=t.isHorizontal?{left:n}:{top:n},t.scrollingToCenter=!0,t.isHorizontal?t.scrollHorizontallyTo(n,!1):t.scrollVerticallyTo(n,!1),t.setTimeout((()=>{t.scrollingToCenter=!1}),100)}else t.isHorizontal?t.scrollHorizontallyTo(0,!1):t.scrollVerticallyTo(0,!1)}t.dataset.presetId=e.id,t.trigger("presetChange",r),t._viewPresetChanging=!1}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}get widgetClass(){}},ov=e=>class extends(e||me){static get $name(){return"TimelineZoomable"}static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,preventScrollZoom:null,minZoomLevel:null,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&Tr.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt(e){e.ctrlKey&&e.preventDefault()}},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.on("timeaxisheaderdblclick",(({startDate:e,endDate:n})=>{t.zoomToSpan({startDate:e,endDate:n})}))}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel||0}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:n}=e,r=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((Mt.add(new Date(1,0,1),n.increment||1,n.unit)-new Date(1,0,1))/(t?r:e.actualWidth||r))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const n=this,r=n.isVertical?"tickHeight":"tickWidth",i=n.normalizePreset(e),s=i[r],o=t.startDate?new Date(t.startDate):null,a=t.endDate?new Date(t.endDate):null;let l=o&&a?{startDate:o,endDate:a}:null;const c=t.centerDate||(l?new Date((o.getTime()+a.getTime())/2):n.viewportCenterDateCached),d=n.isVertical?n.scrollable.clientHeight:n.timeAxisSubGrid.width;return 0===d?null:(l||(l=n.calculateOptimalDateRange(c,d,i)),"width"in t&&i.setData(r,t.width),n.isZooming=!0,i.options={startDate:l.startDate||n.startDate,endDate:l.endDate||n.endDate,centerDate:c},n.viewPreset=i,i.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,i.setData(r,s),n.zoomLevel)}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=Object.assign({leftMargin:0,rightMargin:0},e,t)).startDate&&e.endDate&&this.zoomToSpan(e)}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,n=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:r,endDate:i}=e;if(n&&(r=Mt.add(r,-e.adjustStart,t.timeAxis.mainUnit),i=Mt.add(i,e.adjustEnd,t.timeAxis.mainUnit)),r<=i){const{availableSpace:s}=t.timeAxisViewModel,o=t.presets.allRecords,a=i-r||1;let l,c,d=t.zoomLevel;-1===d&&(d=0);let u,h=t.getMilliSecondsPerPixelForZoomLevel(o[d],!0),g=d+(l=a/h+e.leftMargin+e.rightMargin>s?-1:1),m=null;for(;g>=0&&g<=o.length-1;){u=o[g],h=t.getMilliSecondsPerPixelForZoomLevel(u,!0);const n=a/h+e.leftMargin+e.rightMargin;if(-1===l){if(n<=s){m=g;break}}else{if(!(n<=s))break;d!==g-l&&(m=g)}g+=l}m=null!=m?m:g-l,u=o[m];const p=u.bottomHeader.unit;(e.leftMargin||e.rightMargin)&&(r=new Date(r.getTime()-h*e.leftMargin),i=new Date(i.getTime()+h*e.rightMargin));const f=Mt.getDurationInUnit(r,i,p,!0)/u.bottomHeader.increment;if(0===f)return null;const v=Math.floor(s/f),y=e.centerDate||new Date((r.getTime()+i.getTime())/2);return c=n?{startDate:r,endDate:i}:t.calculateOptimalDateRange(y,s,u),t.zoomToLevel(m,Object.assign(c,{width:v,centerDate:y}))}return null}zoomIn(e=1){const t=this.zoomLevel;return t>=this.maxZoomLevel?null:this.zoomToLevel(t+e)}zoomOut(e=1){const t=this.zoomLevel;return t<=this.minZoomLevel?null:this.zoomToLevel(t-e)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,n,r){if(r)return r;const i=this,{timeAxis:s}=i,{bottomHeader:o}=n,a=i.isHorizontal?n.tickWidth:n.tickHeight;if(i.zoomKeepsOriginalTimespan)return{startDate:s.startDate,endDate:s.endDate};const l=o.unit,c=Math.ceil(t/a*o.increment*i.visibleZoomFactor/2),d=Mt.add(e,-c,l),u=Mt.add(e,c,l);return{startDate:s.floorDate(d,!1,l,o.increment),endDate:s.ceilDate(u,!1,l,o.increment)}}onWheel(e){const t=this;e.ctrlKey&&(e.preventDefault(),t.preventScrollZoom||(e.deltaY>0?t.zoomOut():e.deltaY<0&&t.zoomIn(),t.preventScrollZoom=!0,t.setTimeout((()=>t.preventScrollZoom=!1),30)))}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},av=e=>class extends(e||me){static get $name(){return"RecurringEvents"}static get configurable(){return{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}}construct(e){super.construct(e),this.on({beforeeventdropfinalize:"onRecurrableBeforeEventDropFinalize",beforeeventresizefinalize:"onRecurrableBeforeEventResizeFinalize",beforeEventDelete:"onRecurrableEventBeforeDelete",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete",thisObj:this})}changeRecurrenceConfirmationPopup(e,t){const n=this.constructor.reconfigure(t,e,"recurrenceconfirmation");return n.owner=this,n}findRecurringEventToConfirmDelete(e){const{eventEdit:t}=this.features;return e.find((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(!t||!t.isEditing||t.eventRecord!==e)))}onRecurrableEventBeforeDelete({eventRecords:e,context:t}){const n=this.findRecurringEventToConfirmDelete(e);if(this.enableRecurringEvents&&n)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:n,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:t}){const n=e.map((e=>e.event)),r=this.findRecurringEventToConfirmDelete(n);if(this.enableRecurringEvents&&r)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:r,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:t}=e,n=t.filter((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)));n.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:n[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:t}=e;t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:t,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}get widgetClass(){}},lv=e=>class extends(e||me){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{barMargin:10,resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}get barMargin(){return this._barMargin}set barMargin(e){const t=this;Ot.assertNumber(e,"barMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._barMargin!==e&&(t._barMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;Ot.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickSize(e){Ot.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}};const cv={maintainVisibleStart:!0},dv={block:"nearest"};var uv=e=>class extends(e||me){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const e=this,{isHorizontal:t}=e;super.initScroll();const{scrollable:n}=t?e.timeAxisSubGrid:e;if(e.timelineScroller=new hv({widget:e,scrollable:n,isHorizontal:t}),n.on({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll){const{start:t,end:n}=e.calculateInfiniteScrollingDateRange(e.viewportCenterDate);e.setTimeSpan(t,n,cv)}}doDestroy(){var e;null===(e=this.timelineScroller)||void 0===e||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,n=t.timelineScroller,{clientSize:r}=n,i=r*t.bufferCoef*t.bufferThreshold;(n.maxPosition-e<i||e<i)&&t.shiftToDate(t.getDateFromCoordinate(e,null,!0))}calculateInfiniteScrollingDateRange(e,t,n,r,i){const{timeAxis:s,timeAxisViewModel:o}=this,a=o.availableSpace;if(r=r||o.tickSize,n=n||s.increment||1,t=t||s.unit,i){const i=Math.ceil(a*(1+this.bufferCoef)/(2*r))*n;return{start:s.floorDate(Mt.add(e,-i,t),!1,t,n),end:s.ceilDate(Mt.add(e,i,t),!1,t,n)}}{const i=Math.ceil(a*this.bufferCoef/r);return{start:s.floorDate(Mt.add(e,-i*n,t),!1,t,n),end:s.ceilDate(Mt.add(e,Math.ceil((a/r+i)*n),t),!1,t,n)}}}shiftToDate(e,t){const n=this.calculateInfiniteScrollingDateRange(e,null,null,null,t);this.setTimeSpan(n.start,n.end,cv)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}scrollToDate(e,t={}){const n=this,{timeAxis:r,visibleDateRange:i,infiniteScroll:s}=n,{unit:o,increment:a}=r,l=t.edgeOffset||0,c=Mt.ceil(i.endDate,a+" "+o)-Mt.floor(i.startDate,a+" "+o),d=e>n.viewportCenterDate?1:-1,u=(s?c*n.bufferCoef*n.bufferThreshold:"center"===t.block?c/2:l?n.getMilliSecondsPerPixelForZoomLevel(n.viewPreset)*l:0)*d,h=new Date(e.getTime()+u);(h>r.endDate?1:h<r.startDate?-1:0)&&n.infiniteScroll&&n.shiftToDate(new Date(e-u),null,!0);const g=n.timelineScroller.viewport,m=n.getCoordinateFromDate(e,!0),p=n.isHorizontal?new nn(n.getCoordinateFromDate(e,!1),g.y,n.timeAxisViewModel.tickSize,g.height):new nn(g.x,n.getCoordinateFromDate(e,!1),g.width,n.timeAxisViewModel.tickSize);return n.scrollToCoordinate(m,p,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,n,r={}){const i=this;if(e<0){const e=i.endDate-i.startDate,{unit:t,increment:s}=i.timeAxis,o=Mt.floor(new Date(n.getTime()-e/2),s+" "+t),a=Mt.add(o,e);return o-i.startDate!=0&&a-i.endDate!=0?(i.setTimeSpan(o,a),i.scrollToDate(n,r)):void 0}return await i.timelineScroller.scrollIntoView(t,r),!i.isDestroyed&&i.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.x=e}set scrollTop(e){this.scrollable.y=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.x}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}};class hv extends si{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this.scrollable.element[this.isHorizontal?"scrollLeft":"scrollTop"]}get clientSize(){return this.scrollable["client"+(this.isHorizontal?"Width":"Height")]}get scrollSize(){return this.scrollable["scroll"+(this.isHorizontal?"Width":"Height")]}get maxPosition(){return this.scrollable["max"+(this.isHorizontal?"X":"Y")]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,n=dv){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,n):this.scrollable.scrollBy(0,t||e,n)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}}class gv extends Mh{static get $name(){return"SchedulerHeader"}refreshContent(){this.headersElement&&0===this.headersElement.childNodes.length&&super.refreshContent()}}gv._$name="Header";class mv extends qh{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:gv}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),t.isHorizontal&&(e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){return this.element?this.element.scrollWidth:0},set(){e.grid.updateCanvasSize()}}),t}onInternalResize(e,t,n,r,i){if(this.isPainted&&t!==r){const e=this.grid,n=e._bodyRectangle.height;er.scrollBarWidth&&t<r&&(this.monitorResize=!1),e.onSchedulerViewportResize(t,n,r,n),this.monitorResize||this.requestAnimationFrame((()=>this.monitorResize=!0))}super.onInternalResize(...arguments)}}mv.initClass(),mv._$name="TimeAxisSubGrid";const pv=["viewPreset","eventBarTextField","eventRenderer","eventRendererThisObj","eventBodyTemplate"],fv={fn:"exitTransition",delay:0,cancelOutstanding:!0},vv={};class yv extends(tg.mixin(tv,rv,lv,uv,sv,ov,av)){static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get configurable(){return{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0}}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,visibleDate:null,snap:!1,snapRelativeToEventStartDate:!1,forceFit:!1,suppressFit:!1,eventCls:null,getDateConstraints:null,timeCellCls:null,timeCellSelector:null,scheduledEventName:null,createEventOnDblClick:!0,overScheduledEventClass:null,preventOverCls:!1,hoveredEventNode:null,useBackgroundCanvas:!1,enableEventAnimations:!r.isIE11,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250}}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.on("refresh",(()=>{t.forceLayout=!1}))}createSubGrid(e,t={}){const n=this,{stickyHeaders:r}=n;return e===(n.schedulerRegion||"normal")?t.type="timeaxissubgrid":"locked"===e&&r&&n.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},n.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:n}=e;null==n||n.destroy(),t?(t.forEach((t=>{e.removePartner(t)})),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),Zr.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return"string"==typeof e&&(e=Mt.parse(e)),e}refreshVirtualScrollbars(){if(super.refreshVirtualScrollbars(),!this.hasVerticalOverflow){const{scrollable:e}=this;this.partners.some((e=>e.hasVerticalOverflow))?e.overflowY="scroll":e.overflowY=!0}}onPaint({firstPaint:e}){if(e){const e=this,t=(e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable)[e.isHorizontal?"clientWidth":"clientHeight"];e.timeAxisViewModel.update(t,!1,!0)}super.onPaint(...arguments)}changeSubGridConfigs(e){this.isVertical&&e.locked&&(this.verticalTimeAxisColumn.width=e.locked.width),super.changeSubGridConfigs(e)}onSchedulerHorizontalScroll(e,t){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,t)}initScroll(){const e=this;let t=0;super.initScroll(),r.isMobileSafari&&(e.scrollable.element.style.transform="translate3d(0, 0, 0)"),r.isFirefox&&e.timeAxisSubGridElement.addEventListener("wheel",(({ctrlKey:t,deltaY:n,deltaX:r})=>{const i=Math.abs(n)>Math.abs(r);t||!i||e.scrollEndDetacher||(e.timeAxisSubGridElement.style.pointerEvents="none",e.scrollEndDetacher=e.scrollable.on({scrollEnd:()=>{e.scrollEndDetacher=null,e.timeAxisSubGridElement.style.pointerEvents=""},once:!0}))})),e.on("horizontalscroll",(({subGrid:n,scrollLeft:r})=>{!e.isPainted||n!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(n,r),t++})),"horizontal"===e.testPerformance&&e.setTimeout((()=>{let n=performance.now(),r=5,i=1;const s=e.setInterval((()=>{if(r+=5,e.scrollLeft+=(10+Math.floor(r))*i,1===i&&e.scrollLeft>5500&&(i=-1,r=5),-1===i&&e.scrollLeft<=0){let r=1e3/((performance.now()-n)/t);r=Math.round(10*r)/10,clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,r+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...n){const r=this,i=r.viewportCenterDate,s=e.apply(t,n),o=r.timelineScroller,{clientSize:a}=o,l=Math.max(Math.floor(r.getCoordinateFromDate(i,!0)-a/2),0);return r.scrollingToCenter=!0,o.scrollTo(l,!1).then((()=>r.scrollingToCenter=!1)),s}setTimeSpan(e,t,{preventThrow:n=!1,maintainVisibleStart:r=!1}=vv){const i=this,{timeAxis:s}=i,{startDate:o,endDate:a}=s.getAdjustedDates(e,t),l=s.startDate-o!=0,c=s.endDate-a!=0;if(l||c){if(r){const{timeAxisViewModel:e}=i,{totalSize:t}=e,n=e.tickSize,r=i.timelineScroller,s=r.position,d=e.getDateFromPosition(s);d>=o&&d<a&&e.on({update(){const o=e.tickSize!==n;i.updateCanvasSize(),!l||c||o?r.position=l||o?e.getPositionFromDate(d):s:r.position+=e.totalSize-t,r.syncPartners(!0)},prio:1e4,once:!0})}return s.reconfigure({startDate:o,endDate:a},!1,n)}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=A.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new Xi)).add(e),(e.partneredWith||(e.partneredWith=new Xi)).add(t),t.getConfig("viewPreset"),e.on({presetchange:"onPartnerPresetChange",thisObj:t});const n=t.partnerSharedConfigs.reduce(((t,n)=>(t[n]=e[n],t)),{});t.setConfig(n),t.on({presetchange:"onPartnerPresetChange",thisObj:e}),t.isPainted?t.scrollable.addPartner(e.scrollable,"x"):t.initScroll=Se.createSequence(t.initScroll,(()=>{t.scrollable.addPartner(e.scrollable,"x")}),t)}}removePartner(e){const t=this,{partneredWith:n}=t;t.isPartneredWith(e)&&(n.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return Boolean(null===(t=this.partneredWith)||void 0===t?void 0:t.includes(e))}onPartnerPresetChange({preset:e,startDate:t,endDate:n,centerDate:r}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:n,centerDate:r},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.all),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let n,r,i,s;if(e){const i=Array.isArray(e);let o=e;i||(o=e.data),n=o&&o.length,o.some(((e,i)=>"timeAxis"===e.type&&(n=i,r=Ot.assign(e,t.timeAxisColumn),!0))),t.isVertical?(t._horizontalColumns=e,o=[Ot.assign({type:"verticalTimeAxis",locked:!0},t.verticalTimeAxisColumn),o[n]],n=1):o=o.slice(),r=o[n]=Object.assign({type:"timeAxis",locked:!1,cellCls:t.timeCellCls,mode:t.mode},r),pv.forEach((e=>{s=t[e],null!=s&&(r[e]=s)})),i?e=o:e.data=o}super.columns=e,e&&(i=t._timeAxisColumn=t.columns.getAt(n),t.isVertical&&(t.verticalTimeAxisColumn=t.columns.getAt(n-1),t.verticalTimeAxisColumn.relayAll(t)),i.relayAll(t))}get timeView(){const e=this;return e.columns&&e.isVertical?e.verticalTimeAxisColumn&&e.verticalTimeAxisColumn.view:e.timeAxisColumn&&e.timeAxisColumn.timeAxisView}set eventCls(e){const t=this;t._eventCls=e,t.eventSelector||(t.eventSelector=`.${e}-wrap`,t.unreleasedEventSelector=`${t.eventSelector}`),t.eventInnerSelector||(t.eventInnerSelector="."+e)}get eventCls(){return this._eventCls}set timeAxisViewModel(e){const t=this,n=t._timeAxisViewModel,r={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.partner&&!e||n&&n===e||((null==n?void 0:n.owner)===t&&n.destroy(),t.detachListeners("timeAxisViewModel"),e&&e.isTimeAxisViewModel?e.on(r):(e=Object.assign({mode:t._mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,suppressFit:t.suppressFit,listeners:r,owner:t},e),e=new Qf(e)),!t.isConfiguring&&t.timeAxisColumn&&(t.timeAxisColumn.timeAxisViewModel=e),t._timeAxisViewModel=e,t.relayEvents(e,["update"],"timeAxisViewModel"),n&&e&&t.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,t;return null!==(e=null===(t=this._timeAxisViewModel)||void 0===t?void 0:t.suppressFit)&&void 0!==e?e:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){const t=this,n=t._timeAxis,r={name:"timeAxis",reconfigure({config:e}){t.trigger("timeAxisChange",{config:e})},thisObj:t};t.partner&&!e||n&&n===e||(n&&n.owner===t&&n.destroy(),t.detachListeners("timeAxis"),e&&e.isTimeAxis||(e=Ot.assign({owner:t,viewPreset:t.viewPreset,autoAdjust:t.autoAdjustTimeAxis,mode:"plain",weekStartDay:t.weekStartDay},e),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),t.workingTime&&t.applyWorkingTime(e),e=new Jp(e)),e.on(r),t._timeAxis=e)}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,n=t._workingTime;if(n){let t=null;n.fromHour>=0&&n.fromHour<24&&n.toHour>n.fromHour&&n.toHour<=24&&n.toHour-n.fromHour<24&&(t={from:n.fromHour,to:n.toHour});let r=null;n.fromDay>=0&&n.fromDay<7&&n.toDay>n.fromDay&&n.toDay<=7&&n.toDay-n.fromDay<7&&(r={from:n.fromDay,to:n.toDay}),e.include=t||r?{hour:t,day:r}:null}else e.include=null;var r;t.isPainted&&(t.timeAxisColumn.refreshHeader(),null===(r=t.features.columnLines)||void 0===r||r.refresh(),t.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||vv;if("string"==typeof e&&(e=Mt.parse(e)),r&&s){if(e){let r=s;if(t&&i){const t=Mt.diff(i,s,o,!0);r=Mt.add(e,t,o)}n.setTimeSpan(e,r)}}else n._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){"string"==typeof e&&(e=Mt.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const n=this,r=n._timeAxis,{startDate:i,endDate:s,mainUnit:o}=r||vv;if("string"==typeof e&&(e=Mt.parse(e)),r&&i){if(e){let r=i;if(t&&s){const t=Mt.diff(i,s,o,!0);r=Mt.add(e,-t,o)}n.setTimeSpan(r,e)}}else n._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||Mt.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){const t=this;t._eventStyle=e,t.isPainted&&t.refreshWithTransition()}get eventColor(){return this._eventColor}set eventColor(e){const t=this;t._eventColor=e,t.isPainted&&t.refreshWithTransition()}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:n,height:r}){this.isVertical&&t&&n!==t.width&&delete this.timeAxisSubGrid._width;const i=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&r!==t.height&&this.onSchedulerViewportResize(i,r,i,t.height)}onSchedulerViewportResize(e,t,n,r){if(this.isPainted){const i=this,{isHorizontal:s,timeAxisViewModel:o,rowManager:a,partneredWith:l}=i,c=i.timeAxisSubGrid;i.currentOrientation.onViewportResize(e,t,n,r),s&&c.height>=a.totalHeight&&c.height-a.totalHeight<=er.scrollBarWidth&&!c.overflowingVertically?o.availableSpace=e-er.scrollBarWidth:o.availableSpace=s?e:Math.floor(t),l&&!i.isSyncingFromPartner&&l.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,i.eachSubGrid((t=>{const n=e.subGrids[t.region];n.width!==t.width&&(t.collapsed?n.collapse():(n.collapsed&&n.expand(),t.flex?t.flex!==n.flex&&(n.flex=t.flex):n.width=t.width))})),e.isSyncingFromPartner=!1)})),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:n,oldHeight:r})}}onTimeAxisViewModelUpdate(){this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate()}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",Qr.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated")}return e._svgCanvas}get timeAxisSubGridElement(){return this.getConfig("regions"),this.timeAxisColumn&&this.timeAxisColumn.subGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,n=e.isHorizontal?t:e.timeAxisColumn.width;let r=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t,!0),e.suppressFit&&er.setLength(e.foregroundCanvas,"height",t),r=!0),n!==e.$canvasWidth&&(e.backgroundCanvas&&er.setLength(e.backgroundCanvas,"width",n),er.setLength(e.foregroundCanvas,"width",n),e.$canvasWidth=n,r=!0),r}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){"dataset"===e&&this.project.isRepopulatingStores&&await this.project.await("refresh",!1),super.onStoreDataChange(...arguments)}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.hasVisibleEvents?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=er.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const n=e._foregroundCanvas=er.createElement({className:"b-sch-foreground-canvas",style:`font-size:${e.rowHeight-2*e.resourceMargin}px`,parent:t});e.timeAxisSubGrid.insertRowsBefore=n,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments),e.visibleDate&&(e.visibleDate instanceof Date&&(e.visibleDate={date:e.visibleDate}),e.scrollToDate(e.visibleDate.date,e.visibleDate))}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}getDateConstraints(){}runWithTransition(e,t){const n=this;n.isVisible&&(null!=t&&!0!==t||(t=n.transitionDuration),t&&n.enableEventAnimations&&(n.hasTimeout("exitTransition")||(n.isAnimating=!0),fv.delay=t,n.setTimeout(fv))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){this.runWithTransition((()=>this.refresh(e)),t)}getVisibleDateRange(){return s.deprecate("scheduler","5.0.0","Deprecated in favor of `get visibleDateRange`"),this.visibleDateRange}get visibleDateRange(){return this.currentOrientation.visibleDateRange}formatDuration(e,t=this.durationDisplayPrecision){const n=Math.pow(10,t);return Math.round(e*n)/n}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}}yv.initClass(),s.setVersion("scheduler","4.2.1"),yv._$name="TimelineBase";const bv=Ne.mergeLocales(Xh,{Object:{newEvent:"New event"},ResourceInfoColumn:{eventCountText:function(e){return e+" event"+(1!==e?"s":"")}},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-End",EndToStart:"End-to-Start",EndToEnd:"End-to-End",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-End","End-to-Start","End-to-End"]},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit event":"Edit event",Repeat:"Repeat"},EventDrag:{eventOverlapsExisting:"Event overlaps existing event for this resource",noDropOutsideTimeline:"Event may not be dropped completely outside the timeline"},SchedulerBase:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},HeaderContextMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},TimeAxisHeaderMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventCopyPaste:{copyEvent:"Copy event",cutEvent:"Cut event",pasteEvent:"Paste event"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST"},weekAndDay:{displayDateFormat:"ll LST"},dayAndWeek:{displayDateFormat:"ll LST"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>`Weekly on ${e}`,"Monthly on {1}":({days:e})=>`Monthly on ${e}`,"Yearly on {1} of {2}":({days:e,months:t})=>`Yearly on ${e} of ${t}`,"Every {0} days":({interval:e})=>`Every ${e} days`,"Every {0} weeks on {1}":({interval:e,days:t})=>`Every ${e} weeks on ${t}`,"Every {0} months on {1}":({interval:e,days:t})=>`Every ${e} months on ${t}`,"Every {0} years on {1} of {2}":({interval:e,days:t,months:n})=>`Every ${e} years on ${t} of ${n}`,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>`${e} ${t}`},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>`Summary for ${e}`},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"Date range",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"}});Ve.registerLocale("En",{desc:"English",locale:bv});var Cv=e=>class extends(e||me){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,t=!1){return this.currentOrientation.getElementFromAssignmentRecord(e,t)}getElementFromEventRecord(e,t,n=!1){return this.currentOrientation.getElementFromEventRecord(e,t,n)}getElementsFromEventRecord(e,t,n=!1){return this.currentOrientation.getElementsFromEventRecord(e,t,n)}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveEventRecord(e){if(e=er.up(e,this.eventSelector)){if(e.dataset.eventId)return this.eventStore.getById(e.dataset.eventId);if(e.dataset.assignmentId)return this.assignmentStore.getById(e.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const t=er.up(e,this.eventSelector),n=t&&this.assignmentStore.getById(t.dataset.assignmentId),r=t&&this.eventStore.getById(t.dataset.eventId);return this.assignmentStore.getOccurrence(n,r)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}},wv=e=>class extends(e||me){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,t){const n=this.resolveEventRecord(e);return n&&{eventRecord:n,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){super.onElementKeyDown(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyDown",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e,eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e,eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}get widgetClass(){}};class Sv extends me{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}getNumberOfBands(e,t){const n=this.nbrOfBandsByResource;if(n.hasOwnProperty(e.id))return n[e.id];const r=("function"==typeof t?t():t).map((e=>({start:e.startDate,end:e.endDate,event:e})));return this.applyLayout(r,e)}applyLayout(e,t){const n=e.slice(),r=this.layoutEventsInBands(n);return this.nbrOfBandsByResource[t.id]=r}}Sv._$name="HorizontalLayout";class Ev extends Sv{layoutEventsInBands(e,t=!1){let n=0;do{let r=0,i=e[0];for(;i;)t||(i.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,n,i.eventRecord,i.resourceRecord)),e.splice(r,1),r=this.findClosestSuccessor(i,e),i=e[r];n++}while(e.length>0);return n}findClosestSuccessor(e,t){const n=e.endMS,r=e.eventRecord&&0===e.eventRecord.duration;let i,s,o,a=1/0;for(let e=0,l=t.length;e<l;e++)o=t[e],s=o.startMS-n,s>=0&&s<a&&(s>0||o.endMS-o.startMS>0||!r)&&(i=e,a=s);return i}}Ev._$name="HorizontalLayoutStack";var Dv=e=>class extends(e||me){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height"}}applyLayout(e,t){const n=this,{coordProp:r,sizeProp:i}=n;let s,o,a,l;for(let c=0,d=e.length;c<d;c++){if(o=e[c],s=n.findStartSlot(e,o),a=n.getCluster(e,c),a.length>1){for(o[r]=s.start,o[i]=s.end-s.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=n.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const d=a.length,u=(s.end-s.start)/d;for(l=0;l<d;l++)t(a[l],l,s,u);c+=d-1}}findStartSlot(e,t){const{sizeProp:n,coordProp:r}=this,i=this.getPriorOverlappingEvents(e,t);let s;if(0===i.length)return{start:0,end:1};for(s=0;s<i.length;s++){if(0===s&&i[0][r]>0)return{start:0,end:i[0][r]};if(i[s][r]+i[s][n]<(s<i.length-1?i[s+1][r]:1))return{start:i[s][r]+i[s][n],end:s<i.length-1?i[s+1][r]:1}}return!1}getPriorOverlappingEvents(e,t){const n=t.start,r=t.end,i=[];for(let s=0,o=e.indexOf(t);s<o;s++)Mt.intersectSpans(n,r,e[s].start,e[s].end)&&i.push(e[s]);return i.sort(this.sortOverlappers.bind(this)),i}sortOverlappers(e,t){return e[this.coordProp]<t[this.coordProp]?-1:1}getCluster(e,t){const n=e[t];if(t>=e.length-1)return[n];const r=[n],i=e.length;let{start:s,end:o}=n,a=t+1;for(;a<i&&Mt.intersectSpans(s,o,e[a].start,e[a].end);)r.push(e[a]),s=Mt.max(s,e[a].start),o=Mt.min(e[a].end,o),a++;return r}};class xv extends(Sv.mixin(Dv)){applyLayout(e){super.applyLayout(e,((e,t,n,r)=>{e.height=r,e.top=n.start+t*r})),e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))}))}}xv._$name="HorizontalLayoutPack";var Rv=e=>class extends(e||me){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",eventLayout:"stack"}}static get defaultConfig(){return{eventRenderer:null,milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",milestoneMinWidth:40,eventRendererThisObj:null,horizontalLayoutPackClass:xv,horizontalLayoutStackClass:Ev,horizontalEventSorterFn:null,eventBarTextField:"name",eventBodyTemplate:null,eventPositionMode:"translate",eventScrollMode:"move",fillTicks:!1,useInitialAnimation:!0,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg",resourceMargin:null,isFirstRender:!0,initialAnimationDuration:2e3}}get eventPrefix(){return this._eventPrefix}set eventPrefix(e){this._eventPrefix=e||this.id+"-"}updateEventLayout(e,t){const n=this;t&&n.element.classList.remove(`b-eventlayout-${t}`),n.element.classList.add(`b-eventlayout-${e}`),n.isConfiguring||n.refreshWithTransition()}getEventLayoutHandler(e){const t=this,{timeAxisViewModel:n,horizontal:r}=t;if(!t.isHorizontal)return null;switch(t.layouts||(t.layouts={}),e){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:r})),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass({scheduler:t,timeAxisViewModel:n,bandIndexToPxConvertFn:r.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:r})),t.layouts.horizontalPack;default:return null}}get fillTicks(){return this._fillTicks}set fillTicks(e){e!==this._fillTicks&&(this._fillTicks=e,this.isConfiguring||this.refreshWithTransition())}get useInitialAnimation(){return this._useInitialAnimation}set useInitialAnimation(e){const t=this;t._useInitialAnimation&&t.element.classList.remove(`b-initial-${t._useInitialAnimation}`),t._useInitialAnimation=!0===e?"fade-in":e,e&&(t.element.classList.add(`b-initial-${t._useInitialAnimation}`),r.isFirefox&&t.element.classList.add("b-prevent-event-transitions"))}set horizontalEventSorterFn(e){this._horizontalEventSorterFn=e,this.rendered&&this.refreshWithTransition()}get horizontalEventSorterFn(){return this._horizontalEventSorterFn}set resourceColumns(e){this._resourceColumns=e}get resourceColumns(){var e;return(null===(e=this.timeAxisColumn)||void 0===e?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){return this.resourceColumns?this.resourceColumns.columnWidth:null}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach((e=>this.repaintEventsForResource(e)))}getResourceMargin(e){var t;return null!==(t=null==e?void 0:e.resourceMargin)&&void 0!==t?t:this.resourceMargin}getBarMargin(e){var t;return null!==(t=null==e?void 0:e.barMargin)&&void 0!==t?t:this.barMargin}getResourceHeight(e){var t,n;const r=this.getRowById(e);return null!==(t=null!==(n=null==r?void 0:r.maxRequestedHeight)&&void 0!==n?n:e.rowHeight)&&void 0!==t?t:this.rowHeight}getResourceLayoutSettings(e){return{resourceMargin:this.getResourceMargin(e),barMargin:this.getBarMargin(e),rowHeight:this.getResourceHeight(e)}}generateRenderData(e,t,n={viewport:!0}){const r=this,i=r.currentOrientation.getTimeSpanRenderData(e,t,n),{isEvent:s,isMilestone:o}=e,a=s&&e.assignments.find((e=>e.resourceId===t.id)),l={className:"b-sch-event-content",dataset:{taskBarFeature:"content"}};if(i){var c;let n=e.isResizable;i.startsOutsideView&&(!0===n?n="end":"start"===n&&(n=!1)),i.endsOutsideView&&(!0===n?n="start":"end"===n&&(n=!1));const u=e.isResourceTimeRange?new on:e.cls.clone(),h=e.isResourceTimeRange?e.cls.clone():new on,g=Boolean(e.hasPersistableChanges||a&&a.hasPersistableChanges);if(Ot.assign(u,{[t.cls]:t.cls,[r.generatedIdCls]:e.hasGeneratedId,[r.dirtyCls]:g,[r.committingCls]:e.isCommitting,[r.endsOutsideViewCls]:i.endsOutsideView,[r.startsOutsideViewCls]:i.startsOutsideView,"b-clipped-start":i.clippedStart,"b-clipped-end":i.clippedEnd}),h[`${r.eventCls}-parent`]=t.isParent,i.wrapperStyle="",s){const s=a&&r.isAssignmentSelected(a);Ot.assign(u,{[r.eventCls]:1,"b-milestone":o,"b-sch-event-narrow":i.width<10,[r.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${n}`]:Boolean(r.features.eventResize),[r.eventSelectedCls]:s,[r.eventAssignHighlightCls]:r.isEventSelected(e)&&!s,"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence}),i.eventId=e.id;const l=e.eventStyle||t.eventStyle||r.eventStyle,c=e.eventColor||t.eventColor||r.eventColor,d=r.isFirstRender&&r.useInitialAnimation;if(Ot.assign(h,{[`${r.eventCls}-wrap`]:1,"b-milestone-wrap":o}),d){const e=i.row?i.row.index:i.top/r.tickSize;i.wrapperStyle=`animation-delay: ${e/20}s;`,r.initialAnimationDetacher||(r.initialAnimationDetacher=Tr.on({element:r.foregroundCanvas,delegate:r.eventSelector,animationend:"stopInitialAnimation",expires:{alt:"stopInitialAnimation",delay:r.initialAnimationDuration},thisObj:r}))}i.eventColor=c,i.eventStyle=l,i.assignmentRecord=i.assignment=a}if(i.wrapperCls=h,i.cls=u,i.iconCls=new on(e.get(r.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(i.style="",i.wrapperStyle+=e.style||""):i.style=e.style||"",i.resource=i.resourceRecord=t,i.resourceId=i.rowId,s){let n,s=null,a=null;if(r.eventRenderer){const s=r.eventRenderer.call(r.eventRendererThisObj||r,{eventRecord:e,resourceRecord:t,assignmentRecord:i.assignmentRecord,tplData:i,renderData:i});"string"==typeof i.cls&&(i.cls=new on(i.cls)),"string"==typeof i.wrapperCls&&(i.wrapperCls=new on(i.wrapperCls)),"string"==typeof i.iconCls&&(i.iconCls=new on(i.iconCls)),n=r.eventBodyTemplate?r.eventBodyTemplate(s):s}else r.eventBodyTemplate?n=r.eventBodyTemplate(e):r.eventBarTextField&&(n=A.encodeHtml(e[r.eventBarTextField]||""));var d;if(!r.eventBodyTemplate||Array.isArray(n))l.children=[],o&&"default"===r.milestoneLayoutMode&&null!=n&&""!==n&&l.children.unshift(a={tag:"label",children:[]}),null!==(d=i.iconCls)&&void 0!==d&&d.length&&l.children.unshift({tag:"i",className:i.iconCls}),Array.isArray(n)?(a||l).children.push(...n):A.isHtml(n)?l.children.length?s={tag:"span",html:n}:(l.children=null,l.html=n):"string"==typeof n||"object"==typeof n?s=n:null!=n&&(s=String(n)),null!=s&&((a||l).children.push(s),i.cls.add("b-has-content")),(null!=l.html||l.children.length)&&i.children.push(l);else l.html=n,i.children.push(l);const{eventStyle:c,eventColor:u}=i;if(i.wrapperCls[`b-sch-style-${c}`]=c,er.isNamedColor(u))i.wrapperCls[`b-sch-color-${u}`]=u;else if(u){const e=c?"color":"background-color";i.style=`${e}:${u};`+i.style,i.wrapperCls["b-sch-custom-color"]=1}i.style&&o&&l&&(l.style=i.style,delete i.style)}i.cls["b-sch-event-withicon"]=null===(c=i.iconCls)||void 0===c?void 0:c.length,i.eventContent=l,i.wrapperChildren=[],r.onEventDataGenerated(i)}return i}onEventDataGenerated(e){}restartInitialAnimation(e){var t;const n=this;null===(t=n.initialAnimationDetacher)||void 0===t||t.call(n),n.initialAnimationDetacher=null,n.useInitialAnimation=e,n.isFirstRender=!0,n.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,r.isFirefox&&e.setTimeout((()=>e.element.classList.remove("b-prevent-event-transitions")),100)}getMilestoneLabelWidth(e){const t=this,n=t.milestoneLayoutMode;if("measure"===n){const n=t.milestoneMeasureElement||(t.milestoneMeasureElement=er.createElement({className:"b-sch-event-wrap b-milestone-wrap b-measure",children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content"}]}],parent:t.foregroundCanvas}));return n.retainElement=!0,n.firstElementChild.firstElementChild.innerHTML=e.name,n.offsetWidth}return"estimate"===n?Math.max(e.name.length*t.milestoneCharWidth,t.milestoneMinWidth):"data"===n?Math.max(e.milestoneWidth,t.milestoneMinWidth):0}set milestoneLayoutMode(e){this._milestoneLayoutMode=e,this.element.classList["default"!==e?"add":"remove"]("b-sch-layout-milestones"),this.isConfiguring||this.refreshWithTransition()}get milestoneLayoutMode(){return this._milestoneLayoutMode}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside","inside"===e)}set milestoneAlign(e){this._milestoneAlign=e,this.isConfiguring||this.refreshWithTransition()}get milestoneAlign(){return this._milestoneAlign}set milestoneCharWidth(e){this._milestoneCharWidth=e,this.isConfiguring||this.refreshWithTransition()}get milestoneCharWidth(){return this._milestoneCharWidth}get widgetClass(){}},Tv=e=>class extends(tf(e||me)){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",clearChanges:"onEventClearChanges",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"applyStartEndParameters"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{timeRanges:null,resourceTimeRanges:null,store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,removeUnassignedEvent:!0,crudManagerClass:null,crudManager:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.on({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const t=this;e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh),t.navigateToAfterRefresh=null),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(),t.refreshAfterProjectRefresh=!1)}changeCrudManager(e){const t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new ta({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t}){const n=arguments;this.runWithTransition((()=>{this.currentOrientation.suspended=!t,super.refreshFromRowOnStoreAdd(e,...n),this.currentOrientation.suspended=!1}),!t)}onStoreAdd(e){super.onStoreAdd(e),this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:n}){let r=0;"assigned"in n&&r++,"calendar"in n&&r++,r!==Object.keys(n).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){!this._mode||e.isAssign||this.assignmentStore.isRemovingAssignment||this.currentOrientation.onEventStoreChange(e)}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map((e=>this.eventStore.getResourcesForEvent(e)));t=Array.prototype.concat.apply([],t),new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>e.assignments.forEach((e=>t.toggleCls(e,n,!0)))))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach((e=>this.repaintEvent(e)))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:t,committingCls:n}=this;[...e.added,...e.modified].forEach((e=>{t.toggleCls(e,n,!0)}))}onAssignmentException({action:e}){"commit"===e&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const t=[...e.added,...e.modified,...e.removed].map((e=>e.getResource()));new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventClearChanges(){this.refresh()}onAssignmentBeforeRemove({source:e,records:t,removingAll:n}){if(n)return;const r=this;let i;if(!r.isConfiguring&&r.activeAssignment&&t.includes(r.activeAssignment)){if("key"===an.lastInteractionType)for(let e=0,n=t.length;e<n&&(!i||t.includes(i));e++){const n=t[e];n.resource&&n.resource.isModel&&(i=r.getNext(n)||r.getPrevious(n))}i?(r.navigateTo(i),r.navigateToAfterRefresh=i):er.focusWithoutScrolling(r.focusElement)}}applyStartEndParameters({source:e,params:t}){const n=this,r=e.modelClass.fieldMap.startDate;n.passStartEndParameters&&(t[n.startParamName]=r.print(n.startDate),t[n.endParamName]=r.print(n.endDate))}getResourcesEventsPerTick(e,t){const{timeAxis:n,resourceStore:r}=this,i=[];return(e=e||r.records).forEach((e=>{e.events.forEach((r=>{if(!n.isTimeSpanInAxis(r)||t&&!t.call(this,{resource:e,event:r}))return;let s=Math.floor(n.getTickFromDate(r.startDate));const o=Math.ceil(n.getTickFromDate(r.endDate));do{i[s]?i[s].push(r):i[s]=[r],s=n.getNext(s).id}while(s<o)}))})),i}get widgetClass(){}};const Mv=Promise.resolve(),Fv={block:"nearest",edgeOffset:20},Av={highlight:!1,focus:!1};var Iv=e=>class extends(e||me){static get $name(){return"SchedulerScroll"}scrollEventIntoView(e,t=Fv){const n=e.resources||[e];if(n.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");return n.length?this.scrollResourceEventIntoView(n[0],e,null,t):(console.warn("You have asked to scroll to an event which is not assigned to a resource"),Mv)}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}scrollResourceEventIntoView(e,t,n,r=Fv){var i;const s=this,o=t.startDate,a=t.endDate,l=t.isScheduled&&o<s.timeAxis.startDate|(a>s.timeAxis.endDate)<<1;let c;if(null==r.edgeOffset&&(r.edgeOffset=20),l&&!1!==r.extendTimeAxis){const e=s.timeAxis.endDate-s.timeAxis.startDate;3===l?s.setTimeSpan(new Date(o.valueOf()-e/2),new Date(a.getTime()+e/2)):1&l?s.setTimeSpan(new Date(o),new Date(o.valueOf()+e)):s.setTimeSpan(new Date(a.valueOf()-e),new Date(a))}if(null===(i=s.expandTo)||void 0===i||i.call(s,e),c=s.getElementFromEventRecord(t,e),c){er.isFocusable(c)||(c=c.parentNode);const e=s.timeAxisSubGrid.scrollable;return s.timeAxisSubGrid.forceScrollUpdate=!0,e.scrollIntoView(c,r)}return l&&!1===r.extendTimeAxis?(console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"),Mv):t.isOccurrence||s.eventStore.isAvailable(t)?t.isScheduled?s.scrollUnrenderedEventIntoView(e,t,r):s.scrollResourceIntoView(e,r):(console.warn("You have asked to scroll to an event which is not available"),Mv)}scrollUnrenderedEventIntoView(e,t,n=Fv){return new Promise((r=>{const i=this,s=Object.assign({edgeOffset:20},n,Av),o=i.timeAxisSubGrid.scrollable,a=i.getResourceEventBox(t,e),l=o.viewport;if(!l)return void r();a.x=Math.ceil(a.x),a.y=Math.ceil(a.y);const c=a.translate(l.x-o.x,l.y-o.y),d=o.getDeltaTo(c,s)[i.isHorizontal?"xDelta":"yDelta"],u=i.on({renderEvent:async({eventRecord:e,element:i,targetElement:s})=>{if(e===t){const e=i||s;u(),await h,d>0&&await o.scrollIntoView(e,{edgeOffset:n.edgeOffset}),n.highlight&&er.highlight(e),n.focus&&e.focus(),r()}}}),h=o.scrollIntoView(c,s)}))}scrollResourceIntoView(e,t=Fv){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},kv=e=>class extends(e||me){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,t,n=!0){return this.currentOrientation.getScheduleRegion(e,t,n)}getResourceRegion(e,t,n){return this.currentOrientation.getRowRegion(e,t,n)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,n=!1,r=!1){return this.currentOrientation.getResourceEventBox(e,t,n,r)}getItemBox(e,t=!1){return e.resources.map((n=>this.getResourceEventBox(e,n,t)))}get widgetClass(){}};const Ov=["eventLayout","barMargin","mode","eventColor","eventStyle","tickSize","fillTicks"];var Lv=e=>class extends(e||me){static get $name(){return"SchedulerState"}getState(){const e=this,t=Ot.copyProperties(super.getState(),e,Ov);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,viewportCenterDate:e.viewportCenterDate,width:e.tickSize},t}applyState(e){this.suspendRefresh(),e.zoomLevel&&this.zoomToLevel(e.zoomLevel,e.zoomLevelOptions),Ot.copyProperties(this,e,Ov),super.applyState(e),this.resumeRefresh(!0)}get widgetClass(){}},Pv=e=>class extends(e||me){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){super.afterConstruct(),this.navigator.on({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof Xi||(e=new Xi(e)),this._selectedCollection=e,e.on({change:"onSelectedCollectionChange",thisObj:this})}get selectedCollection(){return this._selectedCollection}getEventsFromAssignments(e){return Ce.unique(e.map((e=>e.event)))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){const t=[];e&&!Array.isArray(e)&&(e=[e]),e&&e.forEach((e=>{t.push(...e.assignments)})),this.selectedCollection.splice(0,this.selectedCollection.count,t)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){return this.selectedEvents.includes(e)}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||(t?this.selectedCollection.add(e.assignments):this.selectedEvents=e)}selectAssignment(e,t=!1){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}deselectEvents(e){this.selectedCollection.remove(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedAssignments,i=e||[],s=t||[];function o(e,t){const r=e.event;if(r){const i=n.getElementFromAssignmentRecord(e);n.currentOrientation.toggleCls(e,n.eventSelectedCls,t),n.getElementsFromEventRecord(r).forEach((e=>{if(e!==i){const r=n.resolveAssignmentRecord(e);n.currentOrientation.toggleCls(r,n.eventAssignHighlightCls,t),t&&(e.style.animation="none",e.offsetHeight,e.style.animation=""),e.classList[t?"add":"remove"](n.eventAssignHighlightCls)}}))}}if(s.forEach((e=>o(e,!1))),i.forEach((e=>o(e,!0))),(n.highlightSuccessors||n.highlightPredecessors)&&n.highlightLinkedEvents(n.selectedEvents),n.$selectedAssignments=r.map((e=>({eventId:e.eventId,resourceId:e.resourceId}))),!n.silent){const e=r.length>0?i.length>0&&s.length>0?"update":i.length>0?"select":"deselect":"clear";n.trigger("assignmentSelectionChange",{action:e,selection:r,selected:i,deselected:s}),n.trigger("eventSelectionChange",{action:e,selection:n.selectedEvents,selected:n.getEventsFromAssignments(i),deselected:n.getEventsFromAssignments(s)})}}onAssignmentChange({action:e,records:t}){const n=this;if(n.silent=!n.triggerSelectionChangeOnRemove,"remove"===e)n.deselectAssignments(t);else if("removeall"!==e||n.eventStore.isSettingData){if("dataset"===e&&n.$selectedAssignments)if(n.maintainSelectionOnDatasetChange){const e=n.$selectedAssignments.map((e=>t.find((t=>t.eventId===e.eventId&&t.resourceId===e.resourceId))));n.selectedAssignments=Ce.clean(e)}else n.clearEventSelection()}else n.clearEventSelection();n.silent=!1}onInternalEventStoreChange({action:e,records:t}){"dataset"!==e||t.length||this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const n=this;n.isAssignmentSelected(t)?e.ctrlKey&&n.deselectAssignment(t,n.multiEventSelect):n.selectAssignment(t,e.ctrlKey&&n.multiEventSelect)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const n=t&&(t.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(t):t);n?(this.clearFocus(!0),this.onAssignmentSelectionClick(e,n)):this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const t=this;return e?(t.highlighted=t.highlighted||new Set,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const t=this,{highlighted:n}=t,r=t.features.dependencies;n.forEach((i=>{e.includes(i)||(i.$highlight=!1,n.delete(i),t.eventStore.includes(i)&&i.dependencies.forEach((e=>r.unhighlight(e,"b-highlight"))))})),t.eventStore.beginBatch(),e.forEach((e=>{const i=[e];for(;i.length;){const e=i.pop();n.add(e),t.highlightSuccessors&&e.outgoingDeps.forEach((e=>{r.highlight(e,"b-highlight"),!n.has(e.toEvent)&&i.push(e.toEvent)})),t.highlightPredecessors&&e.incomingDeps.forEach((e=>{r.highlight(e,"b-highlight"),!n.has(e.fromEvent)&&i.push(e.fromEvent)}))}n.forEach((e=>e.$highlight=!0))})),t.eventStore.endBatch(),e.length>0?t.element.classList.add("b-highlighting"):t.element.classList.remove("b-highlighting")}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.$highlight),super.onEventDataGenerated(e)}updateProject(e,t){this.clearEventSelection(),super.updateProject(e,t)}doDestroy(){var e;null===(e=this._selectedCollection)||void 0===e||e.destroy(),super.doDestroy()}get widgetClass(){}};const _v=e=>e.preventDefault();var $v=e=>class extends(br(e||me)){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey"}}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),super.construct(e)}changeNavigator(e){const t=this;return t.getConfig("subGridConfigs"),new Ks(t.constructor.mergeConfigs({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:_v}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:_v})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const n=this,{resourceStore:r}=n,{eventSorter:i}=n.currentOrientation,{startDate:s,endDate:o}=n.timeAxis,a=e.event,l=n.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)-1];if(!d)for(let e=r.indexOf(c)-1;(!d||t&&d===a)&&e>=0;e--){c=r.getAt(e);const t=n.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(n.isInTimeAxis).sort(i);d=t.length&&t[t.length-1]}return n.assignmentStore.getAssignmentForEventAndResource(d,c)}navigatePrevious(e){const t=this,n=t.getPrevious(t.normalizeTarget(e));if(e.preventDefault(),n)return e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,e)}getNext(e,t){const n=this,{resourceStore:r}=n,{eventSorter:i}=n.currentOrientation,{startDate:s,endDate:o}=n.timeAxis,a=e.event,l=n.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:o}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(a)+1];if(!d)for(let e=r.indexOf(c)+1;(!d||t&&d===a)&&e<r.count;e++){c=r.getAt(e);d=n.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:o}).filter(n.isInTimeAxis).sort(i)[0]}return n.assignmentStore.getAssignmentForEventAndResource(d,c)}navigateNext(e){const t=this,n=t.getNext(t.normalizeTarget(e));if(e.preventDefault(),n)return e.ctrlKey||t.clearEventSelection(),t.navigateTo(n,e)}async navigateTo(e,t={}){const n=this;e&&(n.navigator.disabled=!0,await n.scrollAssignmentIntoView(e,null,{animate:100}),n.isDestroyed||(n.navigator.disabled=!1,n.activeAssignment=e,n.navigator.trigger("navigate",{event:t,item:er.up(n.getElementFromAssignmentRecord(e),n.navigator.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e);this.navigator.activeItem=t.parentNode}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,n=er.up(e.target,t.eventSelector);return!t.navigator.disabled&&n&&(e.assignmentRecord=t.resolveAssignmentRecord(n),e.eventRecord=t.resolveEventRecord(n),e.resourceRecord=t.resolveResourceRecord(n)),e}onDeleteKey(e){const t=this;if(!t.readOnly&&t.enableDeleteKey){const e=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(e)}}removeEvents(e,t=null){const n=this;if(!n.readOnly&&e.length){const r={finalize(r=!0){if(t&&t(r),!1!==r)if(e.some((e=>{var t;return e.isOccurrence||(null===(t=e.event)||void 0===t?void 0:t.isOccurrence)})))e.forEach((e=>e.isOccurrenceAssignment?e.event.remove():e.remove()));else{(e[0].isAssignment?n.assignmentStore:n.eventStore).remove(e)}}};let i;if(i=e[0].isAssignment?n.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:r}):n.trigger("beforeEventDelete",{eventRecords:e,context:r}),!1!==i)return r.finalize(),!0}return!1}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},Hv=e=>class extends(e||me){getElementFromAssignmentRecord(e,t=!1){if(this.scheduler.isPainted&&e){var n,r;const i=null===(n=this.scheduler.foregroundCanvas.syncIdMap)||void 0===n?void 0:n[e.id];return t?i:null==i||null===(r=i.syncIdMap)||void 0===r?void 0:r.event}return null}getElementFromEventRecord(e,t=e.resource,n=!1){const r=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(r,n)}getElementsFromEventRecord(e,t,n=!1){const r=this;return t?[r.getElementFromEventRecord(e,t,n)]:e.resources.reduce(((t,i)=>{const s=r.getElementFromEventRecord(e,i,n);return s&&t.push(s),t}),[])}};const jv={releaseElement:1,reuseElement:1},Bv={newElement:1,reuseOwnElement:1,reuseElement:1},Nv=9999999,zv=({startDateMS:e},{startDateMS:t})=>e-t,Vv={startDate:1,endDate:1,duration:1};function Wv(e,t,n,r,i){if(e.fillTicks){let e=t.getTickFromDate(n);if(e>=0){i&&e===Math.round(e)&&e>0&&e--;const n=Math.floor(e);return t.getAt(n)[i?"endDate":"startDate"].getTime()}}return r}class Gv extends(me.mixin(Hv,ef)){static get configurable(){return{scrollBuffer:0,bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),e.rowManager.on({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),t.toDrawOnProjectRefresh=new Set,t.toDrawOnDataReady=new Set,super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,n,r=!1){let i=e[0];return n||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,r)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().left+this.scheduler.scrollLeft}translateToPageCoordinate(e){const t=this.scheduler.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}getScheduleRegion(e,t,n=!0){const r=this,{scheduler:i}=r,{timeAxisSubGridElement:s,timeAxis:o}=i,a=i.getResourceMargin(e);let l;if(e){const n=t&&r.getElementsFromEventRecord(t,e)[0];if(l=nn.from(i.getRowById(e.id).getElement("locked")),n){const e=nn.from(n,s);l.y=e.y,l.bottom=e.bottom}else l.y=l.y+a,l.bottom=l.bottom-a}else l=nn.from(s).moveTo(null,0),l.width=s.scrollWidth,l.y=l.y+a,l.bottom=l.bottom-a;const c=o.startDate,d=o.endDate,u=i.getDateConstraints(e,t)||{start:c,end:d};let h=i.getCoordinateFromDate(Mt.max(c,u.start)),g=i.getCoordinateFromDate(Mt.min(d,u.end));return n||(h=r.translateToPageCoordinate(h),g=r.translateToPageCoordinate(g)),l.left=Math.min(h,g),l.right=Math.max(h,g),l}getRowRegion(e,t,n){const{scheduler:r}=this,{timeAxis:i}=r,s=r.getRowById(e.id);if(!s)return null;const o=i.startDate,a=i.endDate,l=t?Mt.max(o,t):o,c=n?Mt.min(a,n):a,d=r.getCoordinateFromDate(l),u=r.getCoordinateFromDate(c,!0,!0),h=s.top,g=Math.min(d,u),m=h+s.offsetHeight;return new nn(g,h,Math.max(d,u)-g,m-h)}getResourceEventBox(e,t,n,r=!1){const i=this.resourceMap.get(t.id);let s=null,o=!1;if(i&&(s=i.eventsData.find((t=>t.eventRecord===e))),s||(s=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:n}),o=!0),s){const e=this.scheduler.getRecordCoords(t,!0,r),n=s.top+e.top,i=new nn(s.left,n,s.width,s.height);return o&&(i.layout=!1),i.rowTop=e.top,i.rowBottom=e.bottom,i}return null}resolveRowRecord(e){const t=this,{scheduler:n}=t,r=e.nodeType?e:e.target,i=r.nodeType===Element.TEXT_NODE?r.parentElement:r,s=er.up(i,n.eventSelector);return s?t.resourceStore.getById(s.dataset.resourceId):n.getRecordFromElement(i)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),null==e||e.on({name:"project",refresh:"onProjectRefresh",dataReady:"onProjectDataReady",thisObj:this})}onProjectDataReady(){const{scheduler:e,toDrawOnDataReady:t}=this;e.refreshSuspended||(t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear())}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:n}=e;if(!t.refreshSuspended){if(e.refreshAllWhenReady){t.calculateAllRowHeights(!0);const{rowManager:n}=t;n.topRow?(e.clearAll(),n.topRow.dataIndex>=t.store.count?t.renderRows(!1):t.refreshWithTransition(!1,!e.isFirstRefresh),e.isFirstRefresh=!1):n.reinitialize(),e.refreshAllWhenReady=!1}else n.size&&e.refreshResources(n);n.clear()}}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t,replaced:n,record:r,changes:i}){const s=this,o=new Set((t||(r?[r]:[])).map((e=>e.resourceId)));if(s.resourceStore.isRemoving||s.resourceStore.isChangingId)return;switch(e){case"dataset":return void(s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),s.scheduler.refreshWithTransition())));case"add":case"remove":case"updateMultiple":return void s.refreshResourcesWhenReady(o);case"removeall":return void(s.refreshAllWhenReady=!0);case"replace":return n.forEach((([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)})),void s.refreshResourcesWhenReady(o);case"filter":return s.clearAll(),s.scheduler.calculateAllRowHeights(!0),void s.scheduler.refreshWithTransition();case"update":("eventId"in i||"resourceId"in i||"id"in i)&&("resourceId"in i&&o.add(i.resourceId.oldValue),s.refreshResources(o,true))}}onAssignmentStoreRefresh({action:e,records:t}){}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.on({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){"batch"===e&&this.scheduler.isEngineReady&&(this.clearAll(),this.scheduler.refreshWithTransition())}onEventStoreChange({action:e,records:t,record:n,replaced:r,changes:i}){const s=this,o=t||(n?[n]:[]),a=o[0]&&o[0].isResourceTimeRange,l=new Set;if(o.forEach((e=>{var t;null===(t=e.resources)||void 0===t||t.forEach((e=>l.add(e.id)))})),a)s.refreshResources(l);else{switch(e){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":case"dataset":return s.clearAll(),void(s.refreshAllWhenReady=!0);case"add":case"updateMultiple":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>l.add(e.id)))}));break;case"removeall":case"filter":return s.scheduler.isEngineReady?(s.clearAll(),s.scheduler.calculateAllRowHeights(!0),void s.scheduler.refreshWithTransition()):void(s.refreshAllWhenReady=!0);case"update":{const e=n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!Vv[e]));let t=0;var c;if("startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,"resourceId"in i&&l.add(i.resourceId.oldValue),!e||t&&(!("duration"in i)||1!==t)||"percentDone"in i)null!==(c=s.project)&&void 0!==c&&c.propagatingLoadChanges?l.forEach((e=>s.toDrawOnDataReady.add(e))):s.refreshResources(l);return}}s.refreshResourcesWhenReady(l)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}onResourceStoreChange({action:e,isExpand:t,record:n,records:r,changes:i}){const s=this,o=n?[n.id]:null==r?void 0:r.map((e=>e.id));switch(e){case"add":return void(t||s.refreshResourcesWhenReady(o));case"update":return void(s.project.isBatchingChanges||i.isLeaf||s.refreshResources(o));case"filter":return;case"removeall":return void s.clearAll({clearLayoutCache:!0})}s.clearResources(o)}onTranslateRow({row:e}){null!=e.id&&this.refreshEventsForResource(e,!1)}calculateRowHeight(e){const{scheduler:t}=this,n=t.getResourceHeight(e),r=e.eventLayout||t.eventLayout;if("stack"===r&&t.isEngineReady&&!e.isSpecialRow&&e.assigned.size>1){const{assignmentStore:i,eventStore:s,timeAxis:o}=t,{barMargin:a,resourceMargin:l}=t.getResourceLayoutSettings(e),c=n-2*l,d=(s.isFiltered||i.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e&&i.includes(t)))),u=s.getEvents({resourceRecord:e,includeOccurrences:t.enableRecurringEvents,startDate:o.startDate,endDate:o.endDate,filter:d}).sort(zv).map((t=>{const n=t.isBatchUpdating?t.get("startDate"):t.startDate,r=t.isBatchUpdating?t.get("endDate"):t.endDate||n;return{eventRecord:t,resourceRecord:e,startMS:n.getTime(),endMS:r.getTime()}})),h=t.getEventLayoutHandler(r).layoutEventsInBands(u,!0);return h*c+(h-1)*a+2*l}return n}doUpdateTimeView(){this.updateFromHorizontalScroll(this.scheduler.timeAxisSubGrid.scrollable.x)}onTimeAxisViewModelUpdate(){const e=this;e.clearAll(),e.scheduler.refreshSuspended&&(e.detachListeners("renderingSuspend"),e.scheduler.on({name:"renderingSuspend",resumeRefresh(){e.scheduler.isEngineReady&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(){}onDragAbort({context:e,dragData:t}){this.resourceStore.indexOf(t.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,n=!0,r=!1){const i=this.getElementFromAssignmentRecord(e,r),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),o=null==s?void 0:s.eventsData.find((t=>t.eventId===e.eventId));o&&(o[r?"wrapperCls":"cls"][t]=n),i&&(i.classList[n?"add":"remove"](t),i.lastDomConfig.className[t]=n)}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}updateFromHorizontalScroll(e){const t=this,{scheduler:n,scrollBuffer:r}=t,{timeAxisSubGrid:i,timeAxis:s}=n,o=i.width,a=i.scrollable.maxX<=Math.round(e)+5,l=n.getDateFromCoordinate(Math.max(0,e-r)),c=a?s.endDate:n.getDateFromCoordinate(e+o+r)||s.endDate;if(l){t._visibleDateRange={startDate:l,endDate:c,startMS:l.getTime(),endMS:c.getTime()},t.viewportCoords={left:e-r,right:e+o+r};const i=n.timeView.range={startDate:l,endDate:c};if(n.onVisibleDateRangeChange(i),n.trigger("visibleRangeChange",i),!n.refreshSuspended&&n.rowManager.rows.length){if(null===n.rowManager.rows[0].id)return;n.rowManager.rows.forEach((e=>t.refreshEventsForResource(e,!1))),t.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshResources(e,t=!0){const{scheduler:n}=this,r=[],i=[];this.clearResources(e),n.refreshSuspended||(e.forEach((e=>{const t=n.getRowById(e);t?r.push(t):i.push(t)})),n.runWithTransition((()=>{n.calculateRowHeights(i.map((e=>this.resourceStore.getById(e))),!0),n.rowManager.renderRows(r)}),t))}layoutEventVerticallyStack(e,t,n){const{barMargin:r,resourceMargin:i,rowHeight:s}=this.scheduler.getResourceLayoutSettings(n);return 0===e?i:i+e*(s-2*i)+e*r}layoutEventVerticallyPack(e,t,n,r){const{barMargin:i,resourceMargin:s,rowHeight:o}=this.scheduler.getResourceLayoutSettings(r),a=1/t,l=e*a,c=(o-2*s-(a-1)*i)*t;return{top:s+l*c+l*i,height:c}}addTemporaryDragElement(e,t=e.resource){const{scheduler:n}=this,r=n.generateRenderData(e,t,{timeAxis:!0,viewport:!0});r.absoluteTop=r.row?r.top+r.row.top:n.getResourceEventBox(e,t,!0).top;const i=this.renderEvent(r),{dataset:s}=i;delete i.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const o=er.createElement(i);return o.innerElement=o.firstChild,e.instanceMeta(n).hasTemporaryDragElement=!0,o}eventSorter(e,t){if(this.horizontalEventSorterFn)return this.horizontalEventSorterFn(e.eventRecord||e,t.eventRecord||t);const n=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,r=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}calculateMS(e){const{scheduler:t}=this,{timeAxis:n,timeAxisViewModel:r}=t;let i=e.isBatchUpdating?e.get("startDate"):e.startDate,s=e.isBatchUpdating?e.get("endDate"):e.endDate,o=Wv(t,n,i,null==i?void 0:i.getTime(),!1),a=Wv(t,n,s,null==s?void 0:s.getTime(),!0),l=a-o;if("default"!==t.milestoneLayoutMode&&0===l){const n=r.getSingleUnitInPixels("minute");switch(l=60*(t.getMilestoneLabelWidth(e)*(1/n))*1e3,t.milestoneAlign){case"start":case"left":a=o+l;break;case"end":case"right":a=o,o=a-l;break;default:a=o+l/2,o=a-l}}return{startMS:o,endMS:a,durationMS:l}}getTimeSpanRenderData(e,t,n=!1){const r=this,{scheduler:i}=r,{timeAxis:s,timeAxisViewModel:o}=i,a=!0===n||n.timeAxis,l=!0===n||n.viewport;if(a||s.isTimeSpanInAxis(e)){const n=i.getRowById(t);if(n||l){const a=o.getSingleUnitInPixels("minute"),l=e.isBatchUpdating?e.get("startDate"):e.startDate,c=e.isBatchUpdating?e.get("endDate"):e.endDate||l,d=s.startMS,u=s.endMS,{startMS:h,endMS:g,durationMS:m}=r.calculateMS(e),p=h<d|(h>u)<<1,f=g>u|(g<=d)<<1,v=m/6e4,y=f?a*v:null;let b,C=i.getCoordinateFromDate(g,{local:!0,respectExclusion:!0,isEnd:!0}),w=!1,S=!1;if(p?b=(h-d)/6e4*a:(b=i.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==C}),w=-1===b),f?C=b+y:S=-1===C,S&&!w&&(C=i.getCoordinateFromDate(g,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),y>Nv&&(1===p?1===f?(b=-100,C=i.timeAxisColumn.width+100):b=C-Nv:1===f&&(C=b+Nv)),w&&S&&(b=i.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:g}),C=i.getCoordinateFromDate(g,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:h}),b===C))return e.instanceMeta(i).excluded=!0,null;const{resourceMargin:E,rowHeight:D}=i.getResourceLayoutSettings(t),x={eventRecord:e,taskRecord:e,left:Math.min(b,C),width:Math.abs(C-b)||(e.isMilestone?0:1),start:l,end:c,rowId:t.id,children:[],startMS:h,endMS:g,startsOutsideView:p,endsOutsideView:f,clippedStart:w,clippedEnd:S,row:n};return i.fillTicks&&(x.dataStartMS=x.start.getTime(),x.dataEndMS=x.end.getTime()),x.top=Math.max(0,E),i.managedEventSizing&&(x.height=Math.max(D-2*E,1)),x}}}layoutResourceEvents(e,t=!1){const{scheduler:n}=this,{eventStore:r,assignmentStore:i,timeAxis:s}=n,o=r.getEvents({includeOccurrences:n.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||r.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e&&i.includes(t))))}),a=(n.getEventsToRender(e,o)||[]).reduce(((r,i)=>{if(t||s.isTimeSpanInAxis(i)){const t=n.generateRenderData(i,e,!1);t&&r.push(t)}return r}),[]);a.sort(this.eventSorter);let l=n.getResourceHeight(e);const c=a.filter((e=>e.eventRecord.isEvent)),d=e.eventLayout||n.eventLayout,u=n.getEventLayoutHandler(d);if("stack"===d){const{barMargin:t,resourceMargin:r}=n.getResourceLayoutSettings(e),i=u.applyLayout(c,e);l=i*(l-2*r)+(i-1)*t+2*r}else"pack"===d&&u.applyLayout(c,e);return{rowHeight:l,eventsData:a}}renderEvent(e,t){const{scheduler:n}=this,{resourceRecord:r,assignmentRecord:i,eventRecord:s}=e,o=i?this.assignmentStore.getOccurrence(i,s).id:e.eventId,a={className:e.wrapperCls,tabIndex:"0",children:[{className:e.cls,style:e.style||"",children:e.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...e.wrapperChildren],style:{transform:`translate(${e.left}px, ${e.absoluteTop}px)`,height:e.fillSize?t:e.height,width:e.width>0?e.width:null,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:r.id,eventId:e.eventId,syncId:o},elementData:e,retainElement:(null==i?void 0:i.instanceMeta(n).retainElement)||s.instanceMeta(n).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.zIndex&&(a.zIndex=e.zIndex),i&&(a.dataset.assignmentId=i.id),e.elementConfig=a,n.trigger("beforeRenderEvent",{renderData:e,domConfig:a}),a}refreshEventsForResource(e,t=!0){let n,r;e.isModel?(n=this.scheduler.rowManager.getRowFor(e),r=e):(n=e,r=this.resourceStore.getById(e.id)),t&&this.clearResources([e]),n&&(this.renderer({row:n,record:r}),t&&this.onRenderDone())}renderer({row:e,record:t,size:n={}}){var r,i;if(t.isSpecialRow)return void this.rowMap.delete(e);const s=this,{bufferSize:o,scheduler:a}=s,l=(null===(r=a.features.labels)||void 0===r?void 0:r.left)||(null===(i=a.features.labels)||void 0===i?void 0:i.right),{left:c,right:d}=s.viewportCoords,u=[];let h,g,m=s.resourceMap.get(t.id);if(!m||m.invalid){if(s.suspended)return;m=s.layoutResourceEvents(t,!1),s.resourceMap.set(t.id,m)}n.height=m.rowHeight,m.eventsData.forEach((t=>{h=c,g=d,(l||0===t.width)&&(h-=o,g+=o),t.left+t.width>=h&&t.left<=g&&(t.absoluteTop=t.top+e.top,u.push(s.renderEvent(t,m.rowHeight)))})),s.rowMap.set(e,u)}onRenderDone(){var e;const{scheduler:t,rowMap:n,verticalBufferSize:r}=this,i=[],s=null!==(e=t._scrollTop)&&void 0!==e?e:0,o=s-r,a=s+t._bodyRectangle.height+r;n.forEach(((e,t)=>{if(r<0||t.bottom>o&&t.top<a)i.push.apply(i,e);else for(let t=0;t<e.length;t++)e[t]=d({},e[t])})),Ur.sync({domConfig:{onlyChildren:!0,children:i},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:e,domConfig:n,lastDomConfig:r,targetElement:i}){var s;if("none"!==e&&null!=n&&null!==(s=n.className)&&void 0!==s&&s[`${t.eventCls}-wrap`]){const s=Bv[e];if(jv[e]&&null!=r&&r.elementData){const{eventRecord:e,resourceRecord:n,assignmentRecord:s}=r.elementData,o={renderData:r.elementData,element:i,eventRecord:e,resourceRecord:n,assignmentRecord:s};i===er.getActiveElement(i)&&t.focusElement.focus(),t.trigger("releaseEvent",o)}if(s){const{eventRecord:r,resourceRecord:s,assignmentRecord:o}=n.elementData,a={renderData:n.elementData,tplData:n.elementData,element:i,isReusingElement:"reuseElement"===e,isRepaint:"reuseOwnElement"===e,eventRecord:r,resourceRecord:s,assignmentRecord:o};t.trigger("renderEvent",a)}}}})}clearResources(e){e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=[e]);e.map(Oo.asId).forEach((e=>{const t=this.resourceMap.get(e);t&&(t.invalid=!0);const n=this.scheduler.getRowById(e);n&&this.rowMap.delete(n)}))}clearAll({clearDom:e=!1,clearLayoutCache:t=!1}={}){const{layouts:n}=this.scheduler;if(t&&n)for(const e in n)n[e].clearCache();if(e){const{foregroundCanvas:e}=this.scheduler;e.syncIdMap=e.lastDomConfig=null;for(const t of e.children)t.lastDomConfig=t.elementData=null}this.resourceMap.clear(),this.rowMap.clear()}}Gv._$name="HorizontalRendering";class Uv extends(Dv()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,n,r,i,s){super.applyLayout(e,((e,i,o,a)=>{if("none"===s)e.width=t-2*n,e.left+=n;else{e.widthFactor=a;const l=e.leftFactor=o.start+i*a,c=Math.round(1/a),d=l/a,u=t-2*n-r*(c-1);"mixed"===s&&2===c?(e.left+=l*t/5+r,e.width=t-l*t/5-2*r,e.zIndex=5+d):(e.width=a*u,e.left+=l*u+n+r*d)}}))}}Uv._$name="VerticalLayout";const Yv={releaseElement:1,reuseElement:1},qv={newElement:1,reuseOwnElement:1,reuseElement:1},Kv={startDate:1,endDate:1,duration:1},Xv=Object.freeze({});class Zv extends(me.mixin(br,Hv,ef)){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new Uv({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t}=e;e.resourceColumns.resourceStore=e.resourceStore,e.resourceColumns.on({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),e.resourceColumns.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const{scheduler:n}=this,r=e.nodeType?null:e,i=r?r.target:e,s=r?[r.offsetX,r.offsetY]:t,o=i.nodeType===Element.TEXT_NODE?i.parentElement:i,a=er.up(o,n.eventSelector);if(a)return n.resourceStore.getById(a.dataset.resourceId);if(!er.up(i,".b-sch-timeaxis-cell"))return null;if(!s)throw new Error("Vertical mode needs coordinates to resolve this element. Can also be called with a browser\n                event instead of element to extract element and coordinates from");const l=Math.floor(s[0]/this.resourceColumns.columnWidth);return n.resourceStore.getAt(l)}toggleCls(e,t,n=!0,r=!1){var i;const s=null===(i=this.eventMap.get(e.eventId))||void 0===i?void 0:i[e.resourceId];if(s){s.renderData[r?"wrapperCls":"cls"][t]=n;const i=this.getElementFromAssignmentRecord(e,r);i&&i.classList[n?"add":"remove"](t)}}getDateFromXY(e,t,n,r=!1){let i=e[1];return n||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,r)}translateToScheduleCoordinate(e){return e-this.scheduler._bodyRectangle.y+this.scheduler.scrollTop}translateToPageCoordinate(e){return e+this.scheduler._bodyRectangle.y-this.scheduler.scrollTop}getResourceEventBox(e,t){var n;const r=e.id,i=t.id;let{renderData:s}=(null===(n=this.eventMap.get(r))||void 0===n?void 0:n[i])||Xv;var o,a;s||(this.layoutResource(this.scheduler.resourceStore.getById(i)),s=null===(o=this.eventMap.get(r))||void 0===o||null===(a=o[i])||void 0===a?void 0:a.renderData);return s?new nn(s.left,s.top,s.width,s.bottom-s.top):null}getScheduleRegion(e,t,n){const r=this,{scheduler:i}=r,s=nn.from(i.timeAxisSubGridElement);e&&(s.left=r.resourceStore.indexOf(e)*i.resourceColumnWidth,s.right=s.left+i.resourceColumnWidth);const o=i.timeAxis.startDate,a=i.timeAxis.endDate,l=i.getDateConstraints(e,t)||{start:o,end:a},c=i.getCoordinateFromDate(Mt.max(o,l.start)),d=i.getCoordinateFromDate(Mt.min(a,l.end));return n?(s.top=c,s.bottom=d):(s.top=r.translateToPageCoordinate(c),s.bottom=r.translateToPageCoordinate(d)),s}getRowRegion(e,t,n){const{scheduler:r}=this,i=this.resourceStore.indexOf(e)*r.resourceColumnWidth,s=r.timeAxis.startDate,o=r.timeAxis.endDate,a=t?Mt.max(s,t):s,l=n?Mt.min(o,n):o,c=r.getCoordinateFromDate(a),d=r.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new nn(i,u,r.resourceColumnWidth,h)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,n=e.scrollable.clientHeight;return{startDate:e.getDateFromCoordinate(t),endDate:e.getDateFromCoordinate(t+n)||e.timeAxis.endDate}}onResourceColumnWidthChange({width:e,oldWidth:t}){const n=this,{scheduler:r}=n;n.resourceColumns.width=r.timeAxisColumn.width=n.resourceStore.count*e,n.clearAll(),n.refresh(Math.abs(e-t)>30)}attachToProject(e){super.attachToProject(e),e&&e.on({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:n}=e;t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):n.size&&e.refresh(),n.clear())}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.on({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){"batch"===e&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t,record:n,replaced:r,changes:i,isAssign:s}){const o=this,a=t||(n?[n]:[]),l=new Set;switch(a.forEach((e=>{e.resources.forEach((e=>l.add(e.id)))})),e){case"sort":case"group":case"move":case"remove":return;case"dataset":return void o.refreshAllResourcesWhenReady();case"add":case"updateMultiple":break;case"replace":r.forEach((([,e])=>{e.resources.map((e=>l.add(e.id)))})),o.clearResources(l);break;case"removeall":case"filter":return o.clearAll(),void o.refresh();case"update":{const e=n.$entity?!Object.keys(i).some((e=>!n.$entity.getField(e))):!Object.keys(i).some((e=>!Kv[e]));let t=0;return"startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,void(e&&!t||(o.clearResources(l),o.refresh()))}}o.refreshResourcesWhenReady(l)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.on({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:n,record:r,replaced:i,changes:s}){const o=this,a=n||(i?i.map((e=>e[1])):r?[r]:[]),l=new Set(a.map((e=>e.id)));if(o.firstResource=o.lastResource=null,o.scheduler.isEngineReady){switch(t){case"update":null!=s&&s.id?o.clearResources([s.id.oldValue,s.id.value]):o.clearResources([r.id]);break;case"filter":o.clearAll()}o.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":return void o.refreshAllResourcesWhenReady();case"replace":case"add":for(let t=a.reduce(((t,n)=>Math.min(t,e.indexOf(n))),e.count);t<e.count;t++)l.add(e.getAt(t).id)}o.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;if("group"===e)throw new Error("Grouping of resources not supported in vertical mode");"sort"===e&&(t.firstResource=t.lastResource=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.on({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t,replaced:n,record:r,changes:i}){const s=this,o=new Set((t||(r?[r]:[])).map((e=>e.resourceId)));if(s.scheduler.isEngineReady){switch(e){case"filter":s.clearAll();break;case"update":if("resourceId"in i&&o.add(i.resourceId.oldValue),!Object.keys(i).filter((e=>"resource"!==e&&"event"!==e)).length)return;s.clearResources(o)}s.refresh(!0)}else{switch(i&&"resourceId"in i&&o.add(i.resourceId.oldValue),e){case"removeall":return void s.refreshAllResourcesWhenReady();case"replace":n.forEach((([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)}))}s.refreshResourcesWhenReady(o)}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearResources(t.map((e=>e.resourceId))),this.renderer())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollLeft&&(this.renderer(),this.prevScrollLeft=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:n}=this,r=n.resourceStore.indexOf(e)*n.resourceColumnWidth;return n.scrollHorizontallyTo(r,t)}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){return this.scheduler.timeAxisColumn.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:t}=this.getResourceRange();return{first:this.resourceStore.getAt(e),last:this.resourceStore.getAt(t)}}getResourceRange(e){const{scheduler:t,resourceStore:n}=this;let r=this.resourceBufferSize;return e||(r=0),n&&n.count?{first:Math.max(Math.floor(t.scrollLeft/t.resourceColumnWidth)-r,0),last:Math.min(Math.floor((t.scrollLeft+t.timeAxisSubGrid.width)/t.resourceColumnWidth)+r,n.count-1)}:{first:-1,last:-1}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let n=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return n||(n=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:n,bottomDate:t}}getTimeSpanRenderData(e,t,n=!1){const{scheduler:r}=this,i=e.isBatchUpdating?e.get("startDate"):e.startDate,s=e.isBatchUpdating?e.get("endDate"):e.endDate,o=r.getResourceMargin(t),a=r.getCoordinateFromDate(i),l=this.resourceStore.indexOf(t)*r.resourceColumnWidth,c=r.resourceColumnWidth-2*o,d=i.getTime(),u=s.getTime();let h=r.getCoordinateFromDate(s),g=h-a;return-1===h&&(g=Math.round((u-d)*r.timeAxisViewModel.getSingleUnitInPixels("millisecond")),h=a+g),{eventRecord:e,resourceRecord:t,left:l,top:a,bottom:h,width:c,height:g,startDate:i,endDate:s,startDateMS:d,endDateMS:u,children:[],start:i,end:s,startMs:d,endMs:u}}eventSorter(e,t){const n=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,o=e.isModel?e.name:e.eventRecord.name,a=t.isModel?t.name:t.eventRecord.name;return n-i||s-r||(o<a?-1:o==a?0:1)}layoutResource(e){const t=this,{scheduler:n}=t,{id:r}=e,{assignmentStore:i,eventStore:s}=n,o=t.resourceMap.set(r,{}).get(r),a=n.resourceStore.indexOf(e),{barMargin:l,resourceMargin:c}=n.getResourceLayoutSettings(e);let d=e.assignments.reduce(((e,t)=>(i.isAvailable(t)&&s.isAvailable(t.event)&&e.push(t.event),e)),[]);d=n.getEventsToRender(e,d);const u=d.reduce(((i,s)=>{const l=n.generateRenderData(s,e),c={renderData:l};return Ot.getMapPath(t.eventMap,l.eventId,{})[r]=c,o[l.eventId]=c,l.fillSize?(l.left=a*n.resourceColumnWidth,l.width=n.resourceColumnWidth):i.push(l),i}),[]);return u.sort(t.eventSorter),t.verticalLayout.applyLayout(u,n.resourceColumnWidth,c,l,a,e.eventLayout||n.eventLayout),o}addTemporaryDragElement(e){const{scheduler:t}=this,n=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});n.top=n.row?n.top+n.row.top:t.getResourceEventBox(e,e.resource,!0).top;const r=this.renderEvent({renderData:n}),{dataset:i}=r;delete r.tabIndex,delete i.eventId,delete i.resourceId,delete i.assignmentId,delete i.syncId,i.transient=!0,r.parent=this.scheduler.foregroundCanvas,r.retainElement=!0;const s=er.createElement(r);return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const t=e.renderData,{resourceRecord:n,assignmentRecord:r}=t,i={className:t.wrapperCls,tabIndex:"0",children:[{className:t.cls,style:(t.internalStyle||"")+(t.style||""),children:t.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...t.wrapperChildren],style:{transform:`translate(${t.left}px, ${t.top}px)`,height:t.height,width:t.width,style:t.wrapperStyle||""},dataset:{resourceId:n.id,eventId:t.eventId,syncId:r?r.id:t.eventId},elementData:e,retainElement:(r||t.eventRecord).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return t.zIndex&&(i.zIndex=t.zIndex),r&&(i.dataset.assignmentId=r.id),this.scheduler.trigger("beforeRenderEvent",{renderData:t,domConfig:i}),e.elementConfig=i,i}renderResource(e){const t=this,{topDateMS:n,bottomDateMS:r}=t,i=[];let s=t.resourceMap.get(e.id);s||(s=t.layoutResource(e));for(const e in s){const o=s[e],{endDateMS:a,startDateMS:l,eventRecord:c}=o.renderData;a>=n&&l<=r&&!c.instanceMeta(t.scheduler).hasTemporaryDragElement&&i.push(t.renderEvent(o))}return i}isEventElement(e){const t=e&&e.className;return t&&t[this.scheduler.eventCls+"-wrap"]}renderer(){const e=this,{scheduler:t}=e,{resourceStore:n}=t,{first:r,last:i}=e.resourceRange,{topDate:s,bottomDate:o}=e.dateRange,a=[],l=[];if(e.initialized&&(t.isEngineReady||t.isCreating)){if(!Mt.isEqual(s,e.topDate)||!Mt.isEqual(o,e.bottomDate)){e.topDate=s,e.bottomDate=o,e.topDateMS=s.getTime(),e.bottomDateMS=o.getTime();const n=e.timeView.range={startDate:s,endDate:o};t.onVisibleDateRangeChange(n),t.trigger("visibleRangeChange",n)}if(-1!==r&&-1!==i)for(let t=r;t<=i;t++)a.push.apply(a,e.renderResource(n.getAt(t)));if(t.getForegroundDomConfigs(l),a.push.apply(a,l),Ur.sync({domConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:n,domConfig:r,lastDomConfig:i,targetElement:s}){if(e.isEventElement(r)){const o=qv[n];if(Yv[n]&&e.isEventElement(i)&&!i.isReleased){const e=i.elementData.renderData,n={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s};s===er.getActiveElement(s)&&t.focusElement.focus(),t.trigger("releaseEvent",n)}if(o){const e=r.elementData.renderData,i={renderData:e,tplData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s,isReusingElement:"reuseElement"===n,isRepaint:"reuseOwnElement"===n};i.reusingElement="reuseElement"===n,t.trigger("renderEvent",i)}}}}),e.firstResource!==r||e.lastResource!==i){const n=e.resourceColumns.visibleResources={firstResource:r,lastResource:i};e.firstResource=r,e.lastResource=i,t.onVisibleResourceRangeChange(n),t.trigger("resourceRangeChange",n)}}}refresh(e){this.scheduler.runWithTransition((()=>this.renderer()),e)}refreshResources(e){this.clearResources(e),this.refresh()}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:t,eventMap:n}=this;e.forEach((e=>{t.has(e)&&(Object.values(t.get(e)).forEach((({renderData:{eventId:t}})=>{delete n.get(t)[e]})),t.delete(e))}))}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}}function Jv(e,t){return e===t.length-1}function Qv(e,t){return t===e.cells[e.cells.length-1]}Zv._$name="VerticalRendering";class ey extends ki{static get $name(){return"TimeAxisBase"}static get configurable(){return{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}}static get properties(){return{startDate:null,endDate:null,levels:[],size:null}}set range({startDate:e,endDate:t}){(this.startDate-e||this.endDate-t)&&(this.startDate=e,this.endDate=t,this.refresh(!0))}buildCells(){var e;const t=this,{sizeProperty:n}=t,{stickyHeaders:r,isVertical:i}=t.client||{},s=[],{length:o}=t.levels,a=t.levels.map(((e,s)=>{var a;const l=r&&(i||s<o-1);return{className:{"b-sch-header-row":1,[`b-sch-header-row-${e.position}`]:1,"b-sch-header-row-main":s===t.model.viewPreset.mainHeaderLevel,"b-lowest":Jv(s,t.levels),"b-sticky-header":l},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:`headerRow${s}`,headerPosition:e.position},children:null===(a=e.cells)||void 0===a?void 0:a.filter((e=>e.start<t.endDate&&e.end>t.startDate)).map((r=>({className:{"b-sch-header-timeaxis-cell":1,[r.headerCellCls]:r.headerCellCls,[`b-align-${r.align}`]:r.align,"b-last":Qv(e,r)},dataset:d({tickIndex:r.index},window.DEBUG&&{date:r.start.getTime()}),style:{[t.positionProperty]:r.coord,[n]:r.width,[`min-${n}`]:r.width},children:[{tag:"span",className:{"b-sch-header-text":1,"b-sticky-header":l},html:r.value}]})))}}));return null===(e=t.client)||void 0===e||e.getHeaderDomConfigs(s),a.push(...s),{className:t.widgetClassList,syncOptions:{releaseThreshold:0},children:a}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:n}=t.model,{levels:r}=t,i=r.length;if(e){r.length=0,n.forEach(((e,t)=>r[t]={position:t,cells:e})),t.size=r[0].cells.reduce(((e,t)=>e+t.width),0);const s=t.element.parentElement;s&&(r.length!==i||e)&&(s.classList.remove(`b-sch-timeaxiscolumn-levels-${i}`),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`))}t.startDate&&t.endDate&&(Ur.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}}ey._$name="TimeAxisBase";class ty extends ey{static get $name(){return"HorizontalTimeAxis"}static get type(){return"horizontaltimeaxis"}static get configurable(){return{model:null,sizeProperty:"width",positionProperty:"left"}}get width(){return this.size}onModelUpdate(){this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),null==e||e.on({name:"tavm",update:"onModelUpdate",thisObj:this})}}ty._$name="HorizontalTimeAxis";class ny extends ki{static get $name(){return"ResourceHeader"}static get type(){return"resourceheader"}static get defaultConfig(){return{resourceStore:null,columnWidth:150,headerRenderer:null,fillWidth:!0,fitWidth:!1,imagePath:null,imageExtension:null,defaultImageName:null}}static get configurable(){return{showAvatars:{value:!0,$config:"nullify"}}}static get properties(){return{firstResource:-1,lastResource:-1}}construct(e){super.construct(e);const t=this;null!=t.imagePath&&t.element.classList.add("b-has-images"),Tr.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return null===(t=this.avatarRendering)||void 0===t||t.destroy(),e&&(this.avatarRendering=new ru({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}set resourceStore(e){const t=this;var n;e!==t._resourceStore&&(null===(n=t.resourceStoreDetacher)||void 0===n||n.call(t),t._resourceStore=e,t.resourceStoreDetacher=e.on({changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}get resourceStore(){return this._resourceStore}onResourceStoreDataChange({action:e}){const t=this,n=t.resourceStore.count*t.columnWidth;n!==t.width&&(t.element.style.width=n+"px",t.column.set("width",n,t.column.grid.isConfiguring)),"removeall"===e&&(t.element.innerHTML=""),"remove"!==e&&"add"!==e&&"filter"!==e||t.refreshWidths()}get columnWidth(){return this._columnWidth}set columnWidth(e){const t=this;if(e!==t._columnWidth){const n=t._columnWidth;t._columnWidth=e,t.refreshingWidths||(t._originalColumnWidth=e,t.refreshWidths()),t.isConfiguring||(t.refresh(),t.trigger("columnWidthChange",{width:t._columnWidth,oldWidth:n}))}}get fillWidth(){return this._fillWidth}set fillWidth(e){this._fillWidth=e,this.refreshWidths()}get fitWidth(){return this._fitWidth}set fitWidth(e){this._fitWidth=e,this.refreshWidths()}getImageURL(e){return A.joinPaths([this.imagePath||"",e||""])}get imagePath(){return this._imagePath}set imagePath(e){this._imagePath=e,this.refresh()}get availableWidth(){return this._availableWidth}set availableWidth(e){this._availableWidth=e,this.refreshWidths()}refreshWidths(){const e=this,{availableWidth:t,_originalColumnWidth:n}=e,r=e.resourceStore&&e.resourceStore.count;if(!t||!r)return;e.refreshingWidths=!0;const i=e.fitWidth||e.fillWidth&&n*r<t?Math.floor(t/r):n,s=e.column.grid.enableEventAnimations&&Math.abs(e._columnWidth-i)>30;er.addTemporaryClass(e.element,"b-animating",s?300:0,e),e.columnWidth=i,e.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.refresh()}refresh(){const e=this,{firstResource:t,lastResource:n}=e,r=[];if(!e.column.grid.isConfiguring&&t>-1&n>-1&&n<e.resourceStore.count)for(let i=t;i<=n;i++){const t=e.resourceStore.getAt(i),n={className:new on({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{left:i*e.columnWidth,width:e.columnWidth},children:[]};if(e.headerRenderer){const r=e.headerRenderer({elementConfig:n,resourceRecord:t});null!=r&&(n.html=r)}else{let r;if(t.imageUrl)r=t.imageUrl;else if(null!=e.imagePath&&!1!==t.image){const n=t.image||t.name&&t.name.toLowerCase()+e.imageExtension;r=e.getImageURL(n)}n.children.push(e.showAvatars&&e.avatarRendering.getResourceAvatar({initials:t.initials,color:t.eventColor,iconCls:t.iconCls,defaultImageUrl:e.defaultImageName&&e.getImageURL(e.defaultImageName),imageUrl:r}),{tag:"span",className:"b-resource-name",html:A.encodeHtml(t.name)})}r.push(n)}Ur.sync({domConfig:{onlyChildren:!0,children:r},targetElement:e.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),n=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+A.capitalize(e.type),{resourceRecord:n,event:e})}}ny._$name="ResourceHeader";class ry extends(Be(su)){static get fields(){return["mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const t=this;t.externalRenderer=e.renderer,super.construct(...arguments),t.thisObj=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.on({paint:"onTimelinePaint",thisObj:t,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,t;null===(e=this.resourceColumns)||void 0===e||e.destroy(),null===(t=this.timeAxisView)||void 0===t||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:n}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new ty({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:t.grid,client:t.grid}):"vertical"===e&&(t.resourceColumns=ny.new({column:t,resourceStore:n.resourceStore,imagePath:n.resourceImagePath,imageExtension:n.resourceImageExtension,defaultImageName:n.defaultResourceImageName},n.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;"horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):"vertical"===t.mode&&t.grid.refreshRows()}onTimelinePaint({firstPaint:e}){const t=this;var n;t.subGrid.insertRowsBefore&&(e&&(t.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===t.mode&&(t.refreshHeader(),null===(n=t.grid)||void 0===n||n.onHeightChange())))}refreshHeader(e){const t=this,{element:r}=t;r&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(n,n,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(r.innerHTML="",t.timeAxisView.render(r))):"vertical"===t.mode&&(t.resourceColumns.currentElement||(r.innerHTML="",t.resourceColumns.render(r))))}renderer(e){var t;if(this.grid.project.isInitialCommitPerformed)return this.grid.currentOrientation.renderer(e),null===(t=this.externalRenderer)||void 0===t?void 0:t.call(this,e)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){this.detachListeners("tavm"),null==e||e.on({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:this}),this._timeAxisViewModel=e,this.timeAxisView&&(this.timeAxisView.model=e)}}au.registerColumnType(ry),ry._$name="TimeAxisColumn";class iy extends ey{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:t}=e,n=null==t?void 0:t.stickyHeaders,r=[],i=e.levels.reduce(((t,r,i)=>{var s;r.cells&&t.push(...null===(s=r.cells)||void 0===s?void 0:s.filter((t=>t.start<e.endDate&&t.end>e.startDate)).map(((t,r,s)=>({className:{"b-sch-header-timeaxis-cell":1,[t.headerCellCls]:t.headerCellCls,[`b-align-${t.align}`]:t.align,"b-last":r===s.length-1,"b-lowest":i===e.levels.length-1},dataset:d({tickIndex:t.index,cellId:`${i}-${t.index}`,headerPosition:i},window.DEBUG&&{date:t.start.getTime()}),style:{top:t.coord,height:t.width,minHeight:t.width},children:[{className:{"b-sch-header-text":1,"b-sticky-header":n},html:t.value}]}))));return t}),[]);return null==t||t.getHeaderDomConfigs(r),i.push(...r),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:i}}get height(){return this.size}}iy._$name="VerticalTimeAxis";class sy extends su{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cellCls:"b-verticaltimeaxiscolumn",flex:1}}get isFocusable(){return!1}construct(e){const t=this;super.construct(...arguments),t.timeAxisViewModel=t.grid.timeAxisViewModel,t.view=new iy({model:t.timeAxisViewModel,client:t.grid})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}}au.registerColumnType(sy),sy._$name="VerticalTimeAxisColumn";class oy extends(yv.mixin(gg,Cv,wv,Tv,Iv,Lv,Rv,kv,Pv,$v)){static get $name(){return"SchedulerBase"}static get type(){return"schedulerbase"}static get configurable(){return{date:{value:null,$config:{equal:"date"}},descriptionRenderer:{value:null,$config:null,default:e=>`${Mt.getLocalizedNameOfUnit("Week")} ${Mt.getWeekDescription(e.startDate,e.endDate)}`},verticalTimeAxisColumn:{}}}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:qp,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}static get deprecatedEvents(){return{eventContextMenuBeforeShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`eventContextMenuBeforeShow` event is deprecated, in favor of `eventMenuBeforeShow` event. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."},eventContextMenuShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`eventContextMenuShow` event is deprecated, in favor of `eventMenuShow` event. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."},eventContextMenuItem:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`eventContextMenuItem` event is deprecated, in favor of `eventMenuItem` event. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."},scheduleContextMenuBeforeShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`scheduleContextMenuBeforeShow` event is deprecated, in favor of `scheduleMenuBeforeShow` event. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."},scheduleContextMenuShow:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`scheduleContextMenuShow` event is deprecated, in favor of `scheduleMenuShow` event. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."},scheduleContextMenuItem:{product:"Scheduler",invalidAsOfVersion:"5.0.0",message:"`scheduleContextMenuItem` event is deprecated, in favor of `scheduleMenuItem` event. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."}}}afterConstruct(){super.afterConstruct(),this.createEventOnDblClick&&this.on("scheduledblclick",this.onSchedulerDblClick)}get store(){return super.store}set store(e){super.store=e}get visibleResources(){const e=this;return e.isVertical?e.currentOrientation.visibleResources:{first:e.store.getById(e.firstVisibleRow.id),last:e.store.getById(e.lastVisibleRow.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onSchedulerDblClick({date:e,resourceRecord:t,row:n}){this.readOnly||t.isSpecialRow||this.internalAddEvent(e,t,n)}onColumnsChanged({action:e,changes:t,record:n}){n===this.timeAxisColumn&&"width"in t&&this.updateCanvasSize(),super.onColumnsChanged(...arguments)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add(`b-sch-${e}`),"horizontal"===e?(t.horizontal=new Gv(t),t.isPainted&&t.horizontal.init(),t.un("scroll",t.onVerticalScroll,t)):"vertical"===e&&(t.vertical=new Zv(t),t.rendered&&t.vertical.init(),t.on("scroll",t.onVerticalScroll,t)))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(){}onVisibleResourceRangeChange(){}editEvent(e,t,n){const r=this,{eventStore:i,assignmentStore:s,features:o}=r,{eventEdit:a,taskEdit:l,simpleEventEdit:c}=o;if(!Boolean(a&&!a.disabled||l&&!l.disabled||c&&!c.disabled))return!1;if(e.eventStore!==i){const{enableEventAnimations:n}=r,o=[];e.isCreating=!0;let a=null;if(t&&(o.push(t),a=s.assignEventToResource(e,t)),!1===r.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:o,resources:o}))return a&&s.remove(a),!1;r.enableEventAnimations=!1,i.add(e),r.project.commitAsync().then((()=>r.enableEventAnimations=n)),r.refreshRows()}}async internalAddEvent(e,t,n){const r=this,{enableEventAnimations:i,features:s,eventStore:o,assignmentStore:a}=r,l=[t],c=o.createRecord({startDate:e,endDate:Mt.add(e,1,r.timeAxis.unit),name:r.L("L{Object.newEvent}")}),d=Boolean(s.eventEdit&&!s.eventEdit.disabled||s.taskEdit&&!s.taskEdit.disabled||s.simpleEventEdit&&!s.simpleEventEdit.disabled);c.isCreating=d,r.onEventCreated(c);let u=null;a&&(u=a.assignEventToResource(c,t)),!1!==r.trigger("beforeEventAdd",{eventRecord:c,resourceRecords:l,resources:l})?(r.enableEventAnimations=!1,o.add(c),r.project.commitAsync().then((()=>r.enableEventAnimations=i)),r.refreshRows(),d&&r.editEvent(c,t,r.getEventElement(c))):u&&a.remove(u)}isDateRangeAvailable(e,t,n,r){return this.eventStore.isDateRangeAvailable(e,t,n,r)}async resumeRefresh(e){super.resumeRefresh(!1);const t=this;if(!t.refreshSuspended&&e){if(!t.isEngineReady)return t.currentOrientation.refreshAllWhenReady=!0,t.project.commitAsync();t.isDestroyed||t.refreshWithTransition()}}toggleEmptyText(){const e=this;var t;e.bodyContainer&&er.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||null!==(t=e.crudManager)&&void 0!==t&&t.isLoading))}getRowHeight(e){if(this.currentOrientation.calculateRowHeight){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){e.forEach((e=>e&&this.getRowHeight(e))),t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:n}=this,r=Math.min(t.count,this.preCalculateHeightLimit);if(r){n.clearKnownHeights();for(let e=0;e<r;e++)this.getRowHeight(t.getAt(e));e||n.estimateTotalHeight(!0)}}get description(){return this.callback(this.descriptionRenderer,this,[this])}get stepUnit(){return"week"}getEventRecord(e){return e=er.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}updateDate(e){const t=Mt.startOf(e,this.stepUnit);this.setTimeSpan(t,Mt.add(t,1,this.stepUnit))}previous(){this.date=Mt.add(this.startDate,-1,this.stepUnit)}next(){this.date=this.endDate}}oy.initClass(),oy._$name="SchedulerBase";const ay={add:1,remove:1,update:1,removeAll:1,filter:1};class ly extends Gu{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),!n.summaries&&n.renderer&&(n.summaries=[{renderer:n.renderer}]),n.isScheduler=e instanceof oy,n.isScheduler&&(e.eventStore.on({changePreCommit:n.onEventStoreChange,thisObj:n}),e.on({timeAxisViewModelUpdate:n.onTimeAxisChange,thisObj:n}),e.project.on({dataReady:n.onProjectDataReady,thisObj:n}))}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach((e=>{e.isGroupFooter&&e.render()}))}onEventStoreChange({action:e,record:t,records:n,changes:r}){if(ay[e]){var i;const{rowManager:e}=this.scheduler,s=t?[t]:n,o=new Set;if(s.forEach((e=>e.resources.forEach((e=>o.add(e))))),null!=(null==r||null===(i=r.resourceId)||void 0===i?void 0:i.oldValue)){const e=this.scheduler.resourceStore.getById(r.resourceId.oldValue);e&&o.add(e)}for(const t of o){let n=e.getRowFor(t);for(;n&&!n.isGroupFooter;)n=e.getRow(n.index+1);n&&this.footersToUpdate.add(n)}}}onProjectDataReady(){const{footersToUpdate:e}=this;if(e.size){for(const n of e){var t;null===(t=n.render)||void 0===t||t.call(n)}e.clear()}}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,n,r,i,s){if("timeAxis"===e.type){const e=this,{scheduler:n}=e,{eventStore:o}=n,a=n.timeAxisViewModel.columnConfig;let l="";if(n.isEngineReady){const c=n.getResourcesEventsPerTick(t,(({event:e})=>e.resources.some((e=>t.includes(e)))&&(!o.isFiltered||o.records.includes(e))));n.timeAxis.forEach(((d,u)=>{const h=c[u]||[],g=e.summaries.map((e=>`<div class="b-timeaxis-summary-value">${e.renderer({startDate:d.startDate,endDate:d.endDate,resourceStore:n.resourceStore,events:h,resources:t,eventStore:o,groupRecord:r,groupField:i,groupValue:s})}</div>`)).join("");l+=`<div class="b-timeaxis-tick" style="width: ${a[a.length-1][u].width}px">${g}</div>`}))}return`<div class="b-timeaxis-group-summary">${l}</div>`}return super.generateHtml(e,t,n,r,i,s)}updateSummaryHtml(e,t,n){const r=super.updateSummaryHtml(e,t,n);if("timeAxis"===t.type){const e={count:0,height:0};return this.summaries.forEach((t=>{t.height?e.height+=t.height:e.count++})),e}return r}getTipHtml({activeTarget:e}){const t=this,n=Array.from(e.parentElement.children).indexOf(e),r=t.scheduler.timeAxis.getAt(n);let i=`<header>${t.L("L{Summary.Summary for}",t.scheduler.getFormattedDate(r.startDate))}</header>`,s=!1;return er.forEachSelector(e,".b-timeaxis-summary-value",((e,n)=>{const r=t._labels[n],o=e.innerText.trim();i+=`<label>${r||""}</label><div class="b-timeaxis-summary-value">${o}</div>`,e.innerHTML&&(s=!0)})),s?i:null}render(){const e=this,{scheduler:t}=e;var n;e.isScheduler&&(null!==(n=e.summaries)&&void 0!==n&&n.some((e=>e.label))&&e.showTooltip&&!e._tip&&(e._labels=e.summaries.map((e=>e.label||"")),e._tip=new Ws({id:`${t.id}-groupsummary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:t.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],getHtml:e.getTipHtml.bind(e)})))}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");null==t||t.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}}ly._$name="GroupSummary",Tu.registerFeature(ly,!1,"Scheduler");const cy={maintainVisibleStart:!0};class dy extends uo{static get $name(){return"HeaderContextMenu"}static get defaultConfig(){return{extraItems:null,processItems:null}}static get pluginConfig(){return{chain:["populateHeaderMenu"]}}construct(e,t){super.construct(e,t),this.scheduler=e,s.deprecate("Scheduler","5.0.0","`HeaderContextMenu` feature is deprecated, in favor of `TimeAxisHeaderMenu` feature. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."),e.features.timeAxisHeaderMenu&&(e.features.timeAxisHeaderMenu.disabled=!0),e.features.headerMenu&&(e.features.headerMenu._showForTimeAxis=!0)}populateHeaderMenu({column:e,items:t,menu:n}){const r=this;if("timeAxis"!==e.type)return;n&&(n.scrollAction="realign"),Ot.merge(t,r.defaultItems);const i=Ot.transformNamedObjectToArray(t);r.extraItems&&i.push(...r.extraItems),r.processItems&&r.processItems({items:i});const s=Ot.transformArrayToNamedObject(i);Ot.removeAllProperties(t),Ot.merge(t,s)}get defaultItems(){const e=this,{scheduler:t}=e,{timeAxis:n}=t,r={magnitude:n.shiftIncrement,unit:n.shiftUnit},i={};return i.pickZoomLevel={text:"L{pickZoomLevel}",localeClass:this,icon:"b-fw-icon b-icon-search-plus",disabled:!t.presets.count||e.disabled,menu:{type:"popup",items:[{type:"slider",minWidth:130,showValue:!1}],onBeforeShow({source:n}){const[r]=n.items;r.min=t.minZoomLevel,r.max=t.maxZoomLevel,r.value=t.zoomLevel,e.zoomDetatcher=r.on("input","onZoomSliderChange",e)},onHide(){e.zoomDetatcher&&(e.zoomDetatcher(),e.zoomDetatcher=null)}}},e.startDateField=new wd({label:e.L("L{startText}"),labelWidth:"6em",required:!0,step:r,listeners:{change:e.onRangeDateFieldChange,thisObj:e}}),e.endDateField=new wd({label:e.L("L{endText}"),labelWidth:"6em",required:!0,step:r,listeners:{change:e.onRangeDateFieldChange,thisObj:e}}),i.activeDateRange={text:"L{activeDateRange}",localeClass:this,icon:"b-fw-icon b-icon-calendar",disabled:e.disabled,menu:{type:"popup",width:"20em",items:[e.startDateField,e.endDateField,{type:"button",cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:e.onLeftShiftBtnClick,thisObj:e}},{type:"button",cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",localeClass:this,flex:4,margin:"0 8",listeners:{click:e.onTodayBtnClick,thisObj:e}},{type:"button",cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:e.onRightShiftBtnClick,thisObj:e}}],onBeforeShow:()=>e.initDates()}},i}onZoomSliderChange({value:e}){this.scheduler.zoomLevel=e}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.scheduler.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.scheduler.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,n=e===t.startDateField,{client:r}=t,{timeAxis:i}=r,s=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=Mt.add(s,i.shiftIncrement,i.shiftUnit)):o=Mt.add(o,i.shiftIncrement,i.shiftUnit),r.setTimeSpan(s,o,cy),t.initDates()}onLeftShiftBtnClick(){this.scheduler.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=Mt.clearTime(new Date);this.scheduler.setTimeSpan(e,Mt.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.scheduler.timeAxis.shiftNext(),this.initDates()}}dy.featureClass="",dy._$name="HeaderContextMenu",Tu.registerFeature(dy);class uy extends uo{static get $name(){return"HeaderZoom"}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,n=t.client;if(!e.touches&&0===e.button&&!t.disabled&&e.target.closest(".b-sch-header-timeaxis-cell")){const r=n.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=er.createElement({parent:r,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=nn.from(r)}}onElementMouseMove(e){const t=this;if(0!==e.buttons||r.isSafari||r.isIE11&&!e.isTrusted){if("number"==typeof t.startX){const n=Math.max(e.clientX,t.headerElementRect.left),r=Math.min(t.startX,n),i=Math.abs(t.startX-n),s=new nn(r-t.headerElementRect.x+t.client.scrollLeft,0,i,t.headerElementRect.height);er.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}else t.onElementMouseUp(e)}onElementMouseUp(e){const t=this;if("number"==typeof t.startX){const e=t.client,n=nn.from(t.element),r=e.getDateFromCoordinate(n.left,"round",!1),i=e.getDateFromCoordinate(n.right,"round",!1);t.element&&t.element.remove(),t.startX=null,t.client.zoomToSpan({startDate:r,endDate:i})}}}uy._$name="HeaderZoom",Tu.registerFeature(uy,!1,"Scheduler");const hy=["top","left","right","bottom"],gy={top:"b-b",right:"l-l",bottom:"t-t",left:"r-r"},my={top:1,bottom:1},py={estimate:1,measure:1},fy={left:1,right:1};class vy extends uo{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,right:null,bottom:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const n=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");n.scheduler=e,super.construct(e,t),(n.top||n.bottom||n.left||n.right)&&n.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:n}=this.scheduler.element;n.remove("b-labels-topbottom"),n.remove("b-labels-top"),n.remove("b-labels-bottom"),(e||t)&&(n.add("b-labels-topbottom"),e&&n.add("b-labels-top"),t&&n.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,n=e.target;if(n&&!t.scheduler.readOnly){const{side:r}=n.dataset,i=t[r],{editor:s,field:o}=i;if(s){const a=this.scheduler.resolveEventRecord(e.target);return s instanceof Fd||(i.editor=new Fd({appendTo:t.scheduler.element,blurAction:t.blurAction,inputField:s,scrollAction:"realign"})),i.editor.startEdit({target:n,align:gy[r],matchSize:!1,record:a,field:o}),e.stopImmediatePropagation(),!1}}}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeRight(e){return this.processLabelSpec(e,"right")}updateRight(){this.updateHostClasslist()}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeLeft(e){return this.processLabelSpec(e,"left")}updateLeft(){this.updateHostClasslist()}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return null;e=Object.setPrototypeOf({},e)}const{scheduler:n}=this,{eventStore:r,resourceStore:i,taskStore:s,id:o}=n,{field:a,editor:l}=e;if(my[t]&&(n.milestoneWidth=null),e.recordType=r&&!s?"event":"task",a){let t;r&&!s&&(t=r.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="event"):Reflect.has(r.modelClass.prototype,a)&&(e.recordType="event")),!t&&s&&(t=s.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="task"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="task")),!t&&i&&(t=i.modelClass.fieldMap[a],t?(e.fieldDef=t,e.recordType="resource"):Reflect.has(i.modelClass.prototype,a)&&(e.recordType="resource")),l&&("boolean"==typeof l?n.editor={type:"textfield"}:"string"==typeof l&&(n.editor={type:l}),Tr.on({element:n.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const t=this,n=[];for(const r of hy)if(t[r]){const{field:i,fieldDef:s,recordType:o,renderer:a,thisObj:l}=t[r],c={tag:"label",className:{[t.labelCls]:1,[`${t.labelCls}-${r}`]:1},dataset:{side:r,taskFeature:`label-${r}`}};let d;const u=`${o}Record`,h=e[u];a?d=a.call(l||t.thisObj||t,{[u]:h,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c}):(d=h[i],d="date"!==(null==s?void 0:s.type)||a?A.encodeHtml(d):Mt.format(d,t.client.displayDateFormat)),c.html=d||"Â ",n.push(c)}return n}measureLabels(e,t){const n=this,r=n.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const i of e)if(fy[i.dataset.side]){let{html:e}=i,s=0;if("estimate"===n.labelLayoutMode)e.includes("<")&&(e=er.stripTags(e)),s=e.length*n.labelCharWidth+18;else{const e=n.labelMeasureElement||(n.labelMeasureElement=er.createElement({className:"b-sch-event-wrap b-measure-label",parent:n.client.foregroundCanvas}));e.retainElement=!0,Ur.sync({targetElement:e,childrenOnly:!0,domConfig:{children:[i]}}),s=e.firstElementChild.offsetWidth}const o=s/r;switch(i.dataset.side){case"left":t.startMS-=o;break;case"right":t.endMS+=o}}}onEventDataGenerated(e){if(!this.disabled){const t=this.generateLabelConfigs(e);py[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}}vy.featureClass="b-sch-labels",vy._$name="Labels",Tu.registerFeature(vy,!1,"Scheduler");class yy extends(yf.mixin(ef)){static get $name(){return"NonWorkingTime"}static get defaultConfig(){return{highlightWeekends:!0,showHeaderElements:!0,showLabelInBody:!0,cls:"b-sch-nonworkingtime",maxTimeAxisUnit:"week",autoGeneratedWeekends:!1}}static get pluginConfig(){return{chain:["onPaint","attachToProject","updateLocalization"]}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.on({name:"project",calendarChange:()=>this.attachToCalendar(this.project.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate()}updateLocalization(){var e;if(null===(e=super.updateLocalization)||void 0===e||e.call(this),this.autoGeneratedWeekends&&this.calendar){const e=this.defaultNonWorkingIntervals,t=Boolean(e.length);this.calendar.clearIntervals(t),t&&this.calendar.addIntervals(e)}}attachToCalendar(e){const t=this,{project:n,client:r}=t;if(t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e){if(!r.isSchedulerPro&&!r.isGantt&&e===n.defaultCalendar&&!n.defaultCalendar.intervalStore.count){const n=t.defaultNonWorkingIntervals;n.length&&(e.addIntervals(n),t.autoGeneratedWeekends=!0)}e.intervalStore.on({name:"calendar",change:()=>t.setTimeout("renderRanges",1)})}r.isEngineReady?t.renderRanges():n.isDestroyed||(t.detachListeners("initialProjectListener"),n.on({name:"initialProjectListener",refresh:t.renderRanges,thisObj:t,once:!0}))}get defaultNonWorkingIntervals(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return Mt.nonWorkingDaysAsArray.map((t=>({recurrentStartDate:`on ${e[t]} at 0:00`,recurrentEndDate:`on ${e[(t+1)%7]} at 0:00`,isWorking:!1})))}get calendar(){var e;return null===(e=this.project)||void 0===e?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=Mt.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&e.durationMS>=this.timeAxisUnitDurationMs}renderRanges(){const e=this,{store:t,calendar:n}=e,{timeAxis:r,foregroundCanvas:i}=e.client;if(n&&i&&t&&!t.isDestroyed){if(!e.disabled){const i=!e.maxTimeAxisUnit||Mt.compareUnits(r.unit,e.maxTimeAxisUnit)<=0;if(t.removeAll(!0),n&&e.highlightWeekends&&i&&r.count){const e=n.getNonWorkingTimeRanges(r.startDate,r.endDate).map(((e,t)=>({name:e.name,cls:"b-nonworkingtime",startDate:e.startDate,endDate:e.endDate}))),i=[];let s;e.forEach((e=>{s&&e.startDate<=s.endDate&&e.name===s.name?s.endDate=e.endDate:(i.push(e),e.id=`nonworking-${i.length}`,s=e)})),t.add(i,!0)}}super.renderRanges()}}}yy._$name="NonWorkingTime",Tu.registerFeature(yy,!1,"Scheduler"),Tu.registerFeature(yy,!0,["SchedulerPro","Gantt","ResourceHistogram"]);class by extends uo{static get $name(){return"Pan"}static get defaultConfig(){return{vertical:!0}}construct(e,t){this.timeline=e;this.targetSelector=[".b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this,n=t.timeline,r=Object.values(n.features).find((e=>e instanceof rf)),i=n.readOnly||!r||r.disabled;e.touches||0!==e.button||t.disabled||(e.target.matches(t.targetSelector)||i&&e.target.closest(n.eventSelector))&&(t.mouseX=e.clientX,t.mouseY=e.clientY)}onElementMouseMove(e){const t=this;if(0!==e.buttons||r.isSafari||r.isIE11&&!e.isTrusted){if("number"==typeof t.mouseX){const n=t.timeline.subGrids.normal.scrollable,r=t.timeline.scrollable,i=e.clientX,s=e.clientY;e.preventDefault(),t.vertical&&r.scrollBy(0,t.mouseY-s),n.scrollBy(t.mouseX-i),t.mouseX=i,t.mouseY=s}}else t.onElementMouseUp()}onElementMouseUp(e){this.mouseX=this.mouseY=null}}by._$name="Pan",Tu.registerFeature(by,!1,["Scheduler","Gantt"]);class Cy extends gf{static get $name(){return"ResourceTimeRanges"}static get defaultConfig(){return{idPrefix:"resourcetimerange",rangeCls:"b-sch-resourcetimerange",store:!1,resourceTimeRanges:null}}attachToProject(e){const t=this,{scheduler:n}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=t._store||n.resourceTimeRangeStore||new up({owner:t});const{crudManager:r}=n;r&&!r.resourceTimeRangeStore&&(r.resourceTimeRangeStore=e.resourceTimeRangeStore)}const r=e.resourceTimeRangeStore;t.exposedOnScheduler||(n.resourceTimeRanges&&(r.add(n.resourceTimeRanges),delete n.resourceTimeRanges),Object.defineProperty(n,"resourceTimeRanges",{get:()=>r.records,set:e=>r.data=e}),t.exposedOnScheduler=!0),r.resourceStore||(r.resourceStore=e.resourceStore),t.detachListeners("store"),r.on({name:"store",change:t.onStoreChange,thisObj:t})}set store(e){this._store=e}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,t){const{timeRanges:n}=e;if(null!=n&&n.length&&!this.disabled){const{startDate:e,endDate:r}=this.client;n.forEach((n=>{n.isRecurring?t.push(...n.getOccurrencesForDateRange(e,r)):t.push(n)}))}return t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking}doDestroy(){var e;(null===(e=this.store)||void 0===e?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}}Cy.featureClass="",Cy._$name="ResourceTimeRanges",Tu.registerFeature(Cy,!1,"Scheduler");class wy extends mf{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{column:n,targetElement:r,resourceRecord:i}=e;return(n?n===t.timeAxisColumn:t.timeAxisSubGrid.element===r)&&!(i&&i.isSpecialRow)}getDataFromEvent(e){if(er.isDOMEvent(e)){const{client:t}=this,n=t.getCellDataFromEvent(e),r=t.getDateFromDomEvent(e,"floor"),i=t.resolveResourceRecord(e)||t.isVertical&&t.resourceStore.last;return Ot.assign(super.getDataFromEvent(e),n,{date:r,resourceRecord:i})}return e}populateScheduleMenu({items:e,resourceRecord:t}){const{client:n}=this;!n.readOnly&&n.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"b-icon b-icon-add",disabled:!t||t.readOnly,weight:100,onItem({date:e,resourceRecord:t}){n.internalAddEvent(e,t,n.getRowFor(t))}})}}wy.featureClass="",wy._$name="ScheduleMenu",Tu.registerFeature(wy,!0,"Scheduler");class Sy extends wy{static get $name(){return"ScheduleContextMenu"}construct(e,t){super.construct(e,t),this.scheduler=e,s.deprecate("Scheduler","5.0.0","`ScheduleContextMenu` feature is deprecated, in favor of `ScheduleMenu` feature. Please see https://bryntum.com/docs/scheduler/#Scheduler/guides/upgrades/3.1.0.md for more information."),e.features.scheduleMenu&&(e.features.scheduleMenu.disabled=!0)}}Sy.featureClass="",Sy._$name="ScheduleContextMenu",Tu.registerFeature(Sy);class Ey extends uo{static get $name(){return"ScheduleTooltip"}static get defaultConfig(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const t=this,n=t.client;let r;const i=t.hoverTip=new Ws({id:`${n.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:n.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(e){i.forElement.contains(e.event.target)&&(r=Tr.on({element:n.timeAxisSubGridElement,mousemove:e=>i.internalOnPointerOver(e),capture:!0}));const t=i.hideAnimation;i.hideAnimation=!1,i.constructor.prototype.onDocumentMouseDown.call(i,e),i.hideAnimation=t},listeners:{pointerover:({event:e})=>{const n="buttons"in e?e.buttons>0:e.which>0;return!n&&r&&r(),!t.disabled&&!n}}});(n.isHorizontal?n.timeAxisSubGrid.scrollable:n.scrollable).on({scroll:t.updateTip,thisObj:t}),n.on({timeAxisViewModelUpdate:t.updateTip,thisObj:t}),t.clockTemplate=new nf({scheduler:n})}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const n=this,r=n.client,i=t&&r.getDateFromDomEvent(t,"floor",!0);let s=n.lastHtml;if(i){const e=r.resolveResourceRecord(t);!e||i-n.lastTime==0&&e.id===n.lastResourceId||(n.lastResourceId=e.id,s=n.lastHtml=n.generateTipContent({date:i,event:t,resourceRecord:e}))}else e.hide(),n.lastTime=null,n.lastResourceId=null;return s}generateTipContent({date:e,event:t,resourceRecord:n}){const r=this,i=r.clockTemplate.generateContent({date:e,text:r.client.getFormattedDate(e)}),s=r.messageTemplate({message:r.getText(e,t,n)||""});return r.lastTime=e,i+s}getText(e,t,n){}}Ey.featureClass="b-scheduletip",Ey._$name="ScheduleTooltip",Tu.registerFeature(Ey,!0,"Scheduler");class Dy extends uo{static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,t){const n=this;n.scheduler=e,e.eventEdit=n,super.construct(e,t),n.clientListenersDetacher=e.on({[n.triggerEvent]:({eventRecord:e,eventElement:t})=>n.editEvent(e,e.resource,t),dragcreateend:n.onDragCreateEnd,thisObj:n})}doDestroy(){var e;this.clientListenersDetacher(),null===(e=this.editor)||void 0===e||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}editEvent(e,t,n){const r=this,i=r.scheduler;i.readOnly||r.disabled||(n=er.down(n,i.eventInnerSelector)||n,e=e.isAssignment?e.event:e,r.resource=t,r.event=e,r.element=n,i.element.classList.add("b-eventeditor-editing"),r.editor||(r.editor=Fd.new({owner:i.timeAxisSubGrid,appendTo:i.timeAxisSubGridElement,scrollAction:"realign",cls:"b-simpleeventeditor",listeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:r}},r.editorConfig),r.relayEvents(r.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),e.isCreating&&(e.name=""),r.editor.startEdit({target:n,record:e,field:r.field}),r.scheduler.navigator.disabled=!0)}onEditorComplete(){this.event.isCreating=!1,this.reset()}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const n=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),r=(e||t).resource;this.editEvent(t,r,n)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:n}){this.element=n,this.editEvent(e,t,n)}}Dy._$name="SimpleEventEdit",Tu.registerFeature(Dy,!1,"Scheduler");const xy={width:0,height:0};class Ry extends uo{static get $name(){return"StickyEvents"}static get type(){return"stickyEvents"}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){super.construct(e,t),this.toUpdate=new Set,e.on({horizontalScroll:"onSchedulerScroll",scroll:"onSchedulerScroll",thisObj:this,prio:1e4})}onEventDataGenerated(e){this.syncEventContentPosition(e),this.updateStyles()}onSchedulerScroll({subGrid:e}){const{client:t}=this,n=t.isHorizontal?"horizontalSyncAllEventsContentPosition":"verticalSyncAllEventsContentPosition";t.isHorizontal&&e&&!e.isTimeAxisSubGrid||this[n](t)}updateStyles(){for(const{contentEl:e,style:t}of this.toUpdate)er.applyStyle(e,t);this.toUpdate.clear()}horizontalSyncAllEventsContentPosition(e){const{rows:t}=e.rowManager,{resourceMap:n}=e.currentOrientation;if(n.size)for(let e=0,{length:s}=t;e<s;e++){var r;const s=null===(r=n.get(t[e].id))||void 0===r?void 0:r.eventsData;if(null!=s&&s.length)for(let e=0,{length:t}=s;e<t;e++){const t=s[e],n=[t];var i;if(t.eventRecord.isResourceTimeRange)n.push(null===(i=t.elementConfig)||void 0===i?void 0:i.children[0]);this.syncEventContentPosition.apply(this,n)}}this.updateStyles()}verticalSyncAllEventsContentPosition(e){const{resourceMap:t}=e.currentOrientation;for(const e of t.values())for(const{renderData:t,elementConfig:n}of Object.values(e)){const e=[t];n&&t.eventRecord.isResourceTimeRange&&e.push(n.children[0]),this.syncEventContentPosition.apply(this,e)}this.updateStyles()}onEventDrag(e){const{client:t}=this,{isHorizontal:n}=t,r="offset"+(n?"Width":"Height"),i=n?t.timeAxisSubGrid.scrollable.x:t.scrollable.y,s=e.querySelector(".b-sch-event-content"),o=er[n?"getTranslateX":"getTranslateY"](e),a=o+e[r]-1,l=n?"X":"Y",c=e[r],d=null==s?void 0:s[r];if(!e.classList.contains("b-milestone-wrap")&&d&&o<i&&a>=i){const e=this.getEventContentMargins(s)[n?"width":"height"],t="center"===(s&&er.getStyleValue(s.parentNode,"justifyContent"))?(c-d)/2:0,r=c-d-e,a=Math.min(i-o,r-2)-t;er.applyStyle(s,{transform:a>0?`translate${l}(${a}px)`:""})}}syncEventContentPosition(e,t=e.eventContent){var n,r,i,s,o;if(!1===e.eventRecord.stickyContents||null!==(n=e.elementConfig)&&void 0!==n&&null!==(r=n._element)&&void 0!==r&&r.lastDomConfig.isReleased)return;const{client:a}=this,{isHorizontal:l}=a,{elementConfig:c}=e,d=l?a.timeAxisSubGrid.scrollable.x:a.scrollable.y,u=null==c||null===(i=c.children[0])||void 0===i?void 0:i.children[0],h=("b-sch-event-content"===(null==u?void 0:u.className)&&u._element?u._element:t._element)||(null===(s=a.getEventElement(e.eventRecord))||void 0===s?void 0:s.querySelector(".b-sch-event-content")),g=null==h?void 0:h.offsetWidth,m="center"===((null==h?void 0:h.parentNode)&&er.getStyleValue(h.parentNode,"justifyContent"))?(e.width-g)/2:0,p=l?e.left+m:e.top,f=p+(l?e.width:e.height)-1,v=l?"X":"Y";if((null==c?void 0:c.dataset.syncId)==(null==c||null===(o=c._element)||void 0===o?void 0:o.dataset.syncId)&&(null==h||!h.parentElement.parentElement.classList.contains("b-dragging"))){const n="string"==typeof t.style?t.style=er.parseStyle(t.style):t.style||(t.style={});if(!e.eventRecord.isMilestone&&(!h||g)&&p<d&&f>=d){const t=this.getEventContentMargins(h),r=h?(l?e.width-g-t.width:e.height-h.offsetHeight-t.height)-m:Number.MAX_SAFE_INTEGER,i=Math.min(d-p,r-2);n.transform=i>0?`translate${v}(${i}px)`:""}else n.transform="";h&&this.toUpdate.add({contentEl:h,style:n})}}getEventContentMargins(e){return null!=e&&e.classList.contains("b-sch-event-content")?er.getEdgeSize(e,"margin"):xy}}Ry._$name="StickyEvents",Tu.registerFeature(Ry,!0,"Scheduler"),Tu.registerFeature(Ry,!1,"ResourceHistogram");class Ty extends th{static get $name(){return"Summary"}static get configurable(){return{showTooltip:!0,summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){return{chain:["renderRows","bindStore","updateEventStore","updateResourceStore","updateProject"]}}construct(e,t){const n=this;n.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,t.hideFooters=!0,e.add(e.createSubGrid("right")),n.summaryColumn=e.columns.add(Ot.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,groupable:!1,htmlEncode:!1,enableHeaderContextMenu:!1,hidden:n.disabled},n.verticalSummaryColumnConfig))[0]),super.construct(e,t),n.summaries||(n.summaries=[{renderer:n.renderer}]),e instanceof oy&&(n.updateEventStore(e.eventStore),n.updateResourceStore(e.resourceStore),n.updateProject(e.project),e.on({timeAxisViewModelUpdate:n.renderRows,thisObj:n}))}updateProject(e){this.detachListeners("summaryProject"),e.on({name:"summaryProject",dataReady:"updateScheduleSummaries",thisObj:this})}updateEventStore(e){this.detachListeners("summaryEventStore"),e.on({name:"summaryEventStore",filter:"updateScheduleSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.on({name:"summaryResourceStore",filter:"updateScheduleSummaries",thisObj:this})}renderRows(){this.scheduler.isHorizontal&&this.scheduler.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}updateScheduleSummaries(){const e=this,{scheduler:t}=e,{eventStore:n,timeAxis:r}=t,i=e.summaryBarElement,s=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(i&&t.isEngineReady){const o=t.getResourcesEventsPerTick(s,(({event:e})=>!n.isFiltered||n.records.includes(e)));Array.from(i.children).forEach(((i,s)=>{const a=r.getAt(s),l=o[s]||[];let c="",d=`<header>${e.L("L{Summary for}",t.getFormattedDate(a.startDate))}</header>`;e.summaries.forEach((r=>{const s=r.renderer({startDate:a.startDate,endDate:a.endDate,resourceStore:t.resourceStore,eventStore:n,events:l,element:i}),o=`<div class="b-timeaxis-summary-value">${s}</div>`;(e.summaries.length>1||""!==s)&&(c+=o),d+=`<label>${r.label||""}</label>`+o})),i.innerHTML=c,i._tipHtml=d}))}}get summaryBarElement(){return this.scheduler.element.querySelector(".b-sch-summarybar")}render(){const e=this,{scheduler:t}=e,n=t.isHorizontal?"width":"height",r=t.timeAxisViewModel.columnConfig,i=e.summaryBarElement;i&&(!e._tip&&e.showTooltip&&e.summaries.some((e=>e.label))&&(e._tip=new Ws({id:`${t.id}-summary-tip`,cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),i.innerHTML=r[r.length-1].map((e=>`<div class="b-timeaxis-tick" style="${n}: ${e.width}px"></div>`)).join(""),e.updateScheduleSummaries())}refresh(){super.refresh(),this.updateScheduleSummaries()}doDisable(e){var t;const{isConfiguring:n}=this.scheduler;super.doDisable(e),null===(t=this.summaryColumn)||void 0===t||t.toggle(!e),n||e||this.render()}doDestroy(){var e;null===(e=this._tip)||void 0===e||e.destroy(),super.doDestroy()}}Ty._$name="Summary",Tu.registerFeature(Ty,!1,"Scheduler");const My={maintainVisibleStart:!0};class Fy extends Uu{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t===this.client.timeAxisColumn}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:n}=t,r={magnitude:n.timeAxis.shiftIncrement,unit:n.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon b-icon-search-plus",disabled:!n.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1}},onBeforeShow({source:e}){const[r]=e.items;r.min=n.minZoomLevel,r.max=n.maxZoomLevel,r.value=n.zoomLevel,t.zoomDetatcher=r.on("input","onZoomSliderChange",t)},onHide(){t.zoomDetatcher&&(t.zoomDetatcher(),t.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon b-icon-calendar",weight:300,menu:{type:"popup",width:"20em",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:r,listeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:r,listeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"L{todayText}",flex:4,margin:"0 8",listeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:t.onRightShiftBtnClick,thisObj:t}}},listeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,n=e===t.startDateField,{client:r}=t,{timeAxis:i}=r,s=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value;let o=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,o-s?o<s&&(o=Mt.add(s,i.shiftIncrement,i.shiftUnit)):o=Mt.add(o,i.shiftIncrement,i.shiftUnit),r.setTimeSpan(s,o,My),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=Mt.clearTime(new Date);this.client.setTimeSpan(e,Mt.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}}Fy._$name="TimeAxisHeaderMenu",Tu.registerFeature(Fy,!0,["Scheduler","Gantt"]),Tu.registerFeature(Fy,!1,"ResourceHistogram");class Ay extends yf{static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:{modelClass:vm,storeId:"timeRanges"},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",timeRanges:null,showCurrentTimeLine:!1}}construct(e,t){const n=this;super.construct(e,t),e._timeRangesExposed||(Object.defineProperty(e,"timeRanges",{get:()=>n.timeRanges,set:e=>n.store.data=e}),e._timeRangesExposed=!0),n.getConfig("timeRanges")}startConfigure(e){const{client:t}=this;if(t.project&&!this.initialConfig.store){const n=t.project.timeRangeStore;if(n){const t=Ot.getPath(e,"store.data");t&&(n.data=t),e.store=n}}}set timeRanges(e){const t=this.getConfig("store");t?t.data=e:this._timeRanges=e}get timeRanges(){const{store:e}=this,{records:t}=e;if(e.recurringEvents){const e=[],{startDate:n,endDate:r}=this.client.timeAxis;return t.forEach((t=>{t.isRecurring?e.push.apply(e,t.getOccurrencesForDateRange(n,r)):e.push(t)})),e}return t}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const t="object"==typeof e.showCurrentTimeLine?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},t),e.updateCurrentTimeLine=e.updateCurrentTimeLine.bind(e),e.currentTimeInterval=e.setInterval(e.updateCurrentTimeLine,e.currentTimeLineUpdateInterval),e.updateCurrentTimeLine(),e.client.isPainted&&e.renderRanges()}updateCurrentTimeLine(){const e=this,t=e.currentTimeLine;t.startDate=new Date,t.originalData.name||(e.currentTimeLine.name=Mt.format(e.currentTimeLine.startDate,e.currentDateFormat)),e.onStoreChanged({action:"update",record:e.currentTimeLine,changes:{}})}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.client.isPainted&&e.renderRanges())}renderRanges(){const e=this;super.renderRanges(),e.showCurrentTimeLine&&!e.disabled&&e.renderRange(e.currentTimeLine,!0)}get showCurrentTimeLine(){return this._showCurrentTimeLine}set showCurrentTimeLine(e){this._showCurrentTimeLine=e,e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateHeaderMenu({column:e,items:t}){"timeAxis"===e.type&&this.populateTimeAxisHeaderMenu(...arguments)}populateTimeAxisHeaderMenu({column:e,items:t}){const n=this;t.currentTimeLine={weight:400,text:n.L("L{showCurrentTimeLine}"),checked:n.showCurrentTimeLine,onToggle:({checked:e})=>{n.showCurrentTimeLine=e}}}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.isPainted&&this.renderRanges()}get store(){return this._store}set store(e){const t=this,n=t.client;e.storeId||(e.storeId="timeRanges"),super.store=e,n.timeRanges&&!n._timeRangesExposed&&(t._store.add(n.timeRanges),delete n.timeRanges),t.timeRanges&&(t._store.add(t.timeRanges),delete t.timeRanges)}}Ay._$name="TimeRanges",Tu.registerFeature(Ay,!1,["Scheduler","Gantt"]);const Iy={completeview:"completeview",currentview:"currentview",daterange:"daterange"},ky=Promise.resolve();var Oy=e=>class extends e{async scrollRowIntoView(e,t){const{rowManager:n,scrollable:r}=e,i=r.y;return t<e.store.count&&(r.scrollTo(null,n.calculateTop(t)),r.y!==i)?new Promise((r=>{const i=e.on({scroll({scrollTop:e}){null!=e&&n.getRow(t)&&(i(),r())}})})):ky}async scrollToDate(e,t){let n=!1;const r=[],i=e.timeAxisSubGrid.scrollable.on({scrollStart({x:e}){null!=e&&(n=!0)}});r.push(e.scrollToDate(t,{block:"start"})),i(),n&&r.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(r)}async prepareComponent(e){const t=this,{client:n}=e,{currentOrientation:r}=n,i=n.timeAxisSubGrid.width>0;switch(e.scheduleRange){case Iy.completeview:e.rangeStart=n.startDate,e.rangeEnd=n.endDate;break;case Iy.currentview:const{startDate:t,endDate:r}=n.visibleDateRange;e.rangeStart=t,e.rangeEnd=r}await n.waitForAnimations(),i&&(n.setTimeSpan(e.rangeStart,e.rangeEnd),n.svgCanvas),t._oldEnableEventAnimations=n.enableEventAnimations,n.enableEventAnimations=!1,r.isHorizontalRendering&&(t._oldScrollBuffer=r.scrollBuffer,t._oldVerticalBuffer=r.verticalBufferSize,r.scrollBuffer=100,r.verticalBufferSize=-1),n.ignoreViewBox=!0,await super.prepareComponent(e);const{exportMeta:s,element:o}=t,a=o.querySelector(".b-sch-foreground-canvas"),l=o.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=i,i&&e.scheduleRange!==Iy.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=n.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const t=Math.ceil(s.totalWidth/s.pageWidth),r=t*s.verticalPages;s.horizontalPages=t,s.totalPages=r,s.subGrids.normal.scrollLeft=n.getCoordinateFromDate(e.rangeStart)}if(s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,er.forEachSelector(l,".b-sch-header-row",(e=>{s.timeAxisPlaceholders.push(t.createPlaceholder(e)),s.timeAxisHeaders.push(new Map)})),s.subGrids.normal.eventsPlaceholder=t.createPlaceholder(a,!1),er.removeEachSelector(a,".b-sch-event-wrap,.b-sch-resourcetimerange"),er.removeEachSelector(t.element,".b-released"),s.eventsBoxes=new Map,s.client=n,n.features.columnLines&&!n.features.columnLines.disabled){const e=o.querySelector(".b-column-lines-canvas");s.columnLinesPlaceholder=t.createPlaceholder(e),s.columnLines={lines:new Map,majorLines:new Map}}if(n.features.dependencies&&!n.features.dependencies.disabled){const e=o.querySelector(`[id="${n.svgCanvas.getAttribute("id")}"]`);(s.dependenciesPlaceholder=e)&&er.removeEachSelector(e,".b-sch-dependency")}i&&!Mt.betweenLesser(e.rangeStart,n.startDate,n.endDate)&&await t.scrollToDate(n,e.rangeStart)}async restoreState(e){let t=!1;const{client:n}=e,r=[],i=n.timeAxisSubGrid.scrollable.on({scrollStart({x:e}){this.element.scrollLeft!==e&&(t=!0)}});r.push(super.restoreState(e)),i(),t&&r.push(n.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(r)}async restoreComponent(e){const{client:t}=e,{currentOrientation:n}=t;t.ignoreViewBox=!1,t.enableEventAnimations=this._oldEnableEventAnimations,n.isHorizontalRendering&&(n.scrollBuffer=this._oldScrollBuffer,n.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(e)}async onRowsCollected(e,t){const n=this;if(await super.onRowsCollected(e),n.exportMeta.includeTimeline){const{client:r}=t,{timeView:i}=r,{pageRangeStart:s,pageRangeEnd:o}=n.getCurrentPageDateRange(t);if(s){let a=!1;for(await n.scrollToDate(r,s);!a;)if(n.collectLines(t),n.collectHeaders(t),n.collectEvents(e,t),Mt.timeSpanContains(i.startDate,i.endDate,s,o))a=!0;else if(i.endDate.getTime()>=o.getTime())a=!0;else{const e=i.endDate;if(await n.scrollToDate(r,i.endDate),e.getTime()===i.endDate.getTime())throw new Error("Could not scroll to date")}}await n.scrollToDate(r,t.rangeStart)}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,client:n}){const{exportMeta:r}=this,{horizontalPages:i,horizontalPosition:s,pageWidth:o,subGrids:a}=r;let l,c;if(i>1){const e=s*o,r=(s+1)*o,i=a.locked.width+a.locked.splitterWidth;r<=i?c=l=null:(l=n.getDateFromCoordinate(Math.max(e-i,0)),c=n.getDateFromCoordinate(1.2*(r-i))||t)}else l=e,c=t;return{pageRangeStart:l,pageRangeEnd:c}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:n,headerId:r,footerId:i,scrollLeft:s}=t.subGrids.normal,o=e.querySelector(`[id="${n}"]`);return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach((e=>{const n=o.querySelector(e);n&&(t.lastExportedRowBottom?n.style.height=`${t.lastExportedRowBottom}px`:n.style.height="",s&&(n.style.marginLeft=`-${s}px`))})),s&&[r,i].forEach((t=>{const n=e.querySelector(`[id="${t}"] .b-widget-scroller`);n&&(n.style.marginLeft=`-${s}px`)})),super.prepareExportElement()}collectRow(e){const{subGrids:t}=this.exportMeta;Object.entries(e.elements).forEach((([n,r])=>{const i=[r.outerHTML,e.top,e.offsetHeight];"normal"===n&&i.push(new Map),t[n].rows.push(i)}))}collectHeaders(e){const{client:t}=e,{exportMeta:n}=this;if(!n.headersCollected){const e=t.timeView.element,r=n.timeAxisHeaders;er.forEachSelector(e,".b-sch-header-row",((e,i,s)=>{const o=r[i];er.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{o.has(e.dataset.tickIndex)||o.set(e.dataset.tickIndex,e.outerHTML)})),i===s.length-1&&o.has(String(t.timeAxis.count-1))&&(n.headersCollected=!0)}))}}collectLines(e){const{client:t}=e,{exportMeta:n}=this,{columnLines:r}=n;if(!n.headersCollected&&r){const e=t.backgroundCanvas;er.forEachSelector(e,".b-column-line, .b-column-line-major",(e=>{if(e.classList.contains("b-column-line")){const t=Number(e.dataset.line.replace(/line-/,""));r.lines.set(t,e.outerHTML)}else{const t=Number(e.dataset.line.replace(/major-/,""));r.majorLines.set(t,e.outerHTML)}}))}}collectEvents(e,t){const n=e.length,{client:r}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{var s,o;const a=i[i.length-n+t],l=r.store.getAt(e.dataIndex),c=a[3];null===(s=l.events)||void 0===s||s.forEach((e=>{if(e.isScheduled){let t=r.getElementFromEventRecord(e,l);t&&(t=t.parentElement)&&!c.has(e.id)&&c.set(e.id,[t.outerHTML,nn.from(t,t.offsetParent)])}})),null===(o=l.timeRanges)||void 0===o||o.forEach((e=>{var t;const n=(null===(t=r.features.resourceTimeRanges)||void 0===t?void 0:t.generateElementId(e))||"",i=r.foregroundCanvas.syncIdMap[n];i&&!c.has(n)&&c.set(n,[i.outerHTML,nn.from(i,i.offsetParent)])}))}))}buildPageHtml(){const e=this,{subGrids:t,timeAxisHeaders:n,timeAxisPlaceholders:r,columnLines:i,columnLinesPlaceholder:s}=e.exportMeta;let o=e.prepareExportElement();if(Object.values(t).forEach((({placeHolder:t,eventsPlaceholder:n,rows:r})=>{const i=t.outerHTML,{resources:s,events:a}=e.positionRows(r);o=o.replace(i,s.join("")),n&&(o=o.replace(n.outerHTML,a.join("")))})),n.forEach(((e,t)=>{o=o.replace(r[t].outerHTML,Array.from(e.values()).join(""))})),i){const e=Array.from(i.lines.values()).concat(Array.from(i.majorLines.values()));o=o.replace(s.outerHTML,e.join(""))}return o=e.buildDependenciesHtml(o),o}getDependenciesOuterHTML(){const{dependenciesPlaceholder:e}=this.exportMeta;let t;if(r.isIE11){const n=document.createElement("div"),r=e.cloneNode(!0);n.appendChild(r),t=n.innerHTML}else t=e.outerHTML;return t}renderDependencies(){const{client:e,dependenciesPlaceholder:t,eventsBoxes:n}=this.exportMeta,{dependencies:r}=e,i=e.features.dependencies,s=Array.from(n.keys());r.filter((e=>s.includes(String(e.from))||s.includes(String(e.to)))).forEach((e=>{let r=n.get(String(e.from)),s=n.get(String(e.to));const o=i.getIteratableDependencyAssignments(e),{fromEvent:a,toEvent:l}=e;o.forEach((n=>{var o,c;if(!r&&a){const t=i.getBox(e,!0,n);t&&(r=t instanceof nn?t:new nn(t.start,t.top,t.end-t.start,t.bottom-t.top))}if(!s&&l){const t=i.getBox(e,!1,n);t&&(s=t instanceof nn?t:new nn(t.start,t.top,t.end-t.start,t.bottom-t.top))}const d={startRectangle:null===(o=r)||void 0===o?void 0:o.clone(),endRectangle:null===(c=s)||void 0===c?void 0:c.clone()};r&&s&&i.drawDependency(e,d,n,t,!1)}))}));const o=this.getDependenciesOuterHTML();return er.removeEachSelector(t,".b-sch-dependency"),o}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:n}=this.exportMeta;if(t&&n){const t=this.getDependenciesOuterHTML();e=e.replace(t,this.renderDependencies())}return e}};class Ly extends(Oy(ph)){static get $name(){return"MultiPageExporter"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],n=[];return e.forEach((([e,r,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,r]])=>{n.push(t),this.exportMeta.eventsBoxes.set(String(e),r)}))})),{resources:t,events:n}}}Ly._$name="MultiPageExporter";class Py extends(Oy(fh)){static get $name(){return"MultiPageVerticalExporter"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==Iy.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],n=[];return e.forEach((([e,r,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,r]])=>{n.push(t),this.exportMeta.eventsBoxes.set(String(e),r)}))})),{resources:t,events:n}}}Py._$name="MultiPageVerticalExporter";class _y extends dh{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1}}buildLocalizedItems(){return Object.entries(Iy).map((([e,t])=>({id:e,text:this.L(t)})))}}_y.initClass(),_y._$name="ScheduleRangeCombo";class $y extends gh{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get defaultConfig(){return{scheduleRange:"completeview"}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach((t=>{t instanceof qs?t.labelWidth=e:"rangeFieldsContainer"===t.ref&&(t.items[0].width=e)}))}get fieldProperties(){return["scheduleRange",...super.fieldProperties]}buildDialogItems(e){const t=this,{client:n}=e,{scheduleRange:r}=t.getDefaultFieldValues(e),i=super.buildDialogItems(e),s=t.L("labelWidth");t.columnsStore=n.columns.chain((e=>e.isLeaf&&e.exportable));const o=i.find((e=>"columnsField"===e.ref));return o.store=t.columnsStore,o.value=t.columnsStore.allRecords,i.splice(1,0,{labelWidth:s,type:"schedulerangecombo",ref:"scheduleRangeField",label:"L{Schedule range}",localeClass:t,value:r,onChange({value:e}){const t=e!==Iy.daterange,n=this.owner.widgetMap;n.rangeStartField.hidden=n.rangeEndField.hidden=t}},{type:"container",ref:"rangeFieldsContainer",flex:"1 0 100%",defaults:{localeClass:t},items:[{type:"widget",width:s},{type:"datefield",ref:"rangeStartField",label:"L{Export from}",labelWidth:"3em",hidden:!0,flex:"1 0 25%",localeClass:t,value:n.startDate,max:Mt.max(n.startDate,Mt.add(n.endDate,-1,"d")),onChange({value:e}){this.owner.widgetMap.rangeEndField.min=Mt.add(e,1,"d")}},{type:"widget",width:"0.5em"},{type:"datefield",ref:"rangeEndField",label:"L{Export to}",labelWidth:"1em",hidden:!0,flex:"1 0 25%",localeClass:t,value:n.endDate,min:Mt.min(n.endDate,Mt.add(n.startDate,1,"d")),onChange({value:e}){this.owner.widgetMap.rangeStartField.max=Mt.add(e,-1,"d")}}]}),i}}$y._$name="SchedulerExportDialog";class Hy extends(Oy(vh)){static get $name(){return"SinglePageExporter"}collectDependencies(){}positionRows(e){const t=[],n=[],r=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/;let i=0;return e.forEach((([e,s,o,a])=>{t.push(e.replace(r,`translate($1px, ${i}px)`));const l=i-s;a&&Array.from(a.entries()).forEach((([e,[t,i]])=>{i.translate(0,l),this.exportMeta.eventsBoxes.set(String(e),i),n.push(t.replace(r,`translate($1px, ${i.y}px)`))})),i+=o})),{resources:t,events:n}}}Hy._$name="SinglePageExporter";class jy extends yh{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[Hy,Ly,Py],scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return Ot.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}showExportDialog(){const e=this;return e.exportDialog||(e.exportDialog=$y.new({rootElement:e.rootElement,listeners:{export:e.onExportDialogExport,thisObj:e}},e.defaultExportDialogConfig)),e.exportDialog.show()}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:n,rangeEnd:r}=this;return e.columns&&!e.columns.find((e=>"timeAxis"===e.type))&&e.columns.push(e.client.timeAxisColumn.id),Ot.assign({scheduleRange:t,rangeStart:n,rangeEnd:r},e)}}jy._$name="PdfExport",Tu.registerFeature(jy,!1,"Scheduler");class By extends(Ye(bh)){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(e,t)=>e.internalId-t.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map((e=>"string"==typeof e?{field:e}:e))}generateExportData(e){const t=this,n=this.target instanceof oy,r=t.generateColumns(e),i=n?t.generateEventColumns(e):[];return{columns:r.concat(i),rows:t.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map((t=>this.processEventColumn(t,e)))}processEventColumn(e,t){const{width:n,minWidth:r}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(n||i,r||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:n}=t;let r;if(n instanceof oy){if(r=[],n.resourceStore.map((n=>{const i=n.events||[];i.sort(t.eventSortFn),i.length||i.push(""),i.forEach((i=>r.push(t.getRowData(e,n,i))))})),e.includeUnassigned&&e.eventColumns.length){const i=n.eventStore.query((e=>!e.resources.length));if(i.length){const n=new Array(e.columns.length).fill("");n.push(t.L("L{ExcelExporter.No resource assigned}")),r.push(n),i.forEach((n=>r.push(t.getRowData(e,null,n))))}}r=r.filter((e=>e.length))}else r=super.generateRows(e);return r}getRowData(e,t,n){const{columns:r,eventColumns:i}=e,s=[],o=this.processRecord(t,r,e);if(o&&s.push(...o),!t||!t.isSpecialRow){const t=this.processRecord(n,i,e);t&&s.push(...t)}return s}}By._$name="ScheduleTableExporter";class Ny extends wh{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:By,exporterConfig:null}}}Ny._$name="ExcelExporter",Tu.registerFeature(Ny,!1,"Scheduler");class zy extends su{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"b-icon":1,"b-icon-expand-resource":1,"b-flip":"none"!==e.eventLayout}})}}onCellClick({record:e,event:t}){t.preventDefault(),e.eventLayout="none"!==e.eventLayout?"none":"stack"}}au.registerColumnType(zy),zy._$name="ResourceCollapseColumn";class Vy extends su{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:["amit","angelo","arcady","arnold","celia","chang","dan","dave","emilia","george","gloria","henrik","hitomi","jong","kate","lee","linda","lisa","lola","macy","madison","malik","mark","maxim","mike","rob","steve"],autoScaleThreshold:40,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",useNameAsImageName:!0,editor:!s.isTestEnv&&"text"}}construct(...e){super.construct(...e),this.avatarRendering=new ru({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){return A.joinPaths([this.grid.resourceImagePath||"",e||""])}template(e,t){const n=this,{showImage:r,showRole:i,showMeta:s,showEventCount:o,grid:a}=n,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=a,u="string"==typeof i?i:"role",h=o&&e.eventStore.getEvents({includeOccurrences:a.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let g;if(r&&!1!==e.image)if(e.imageUrl)g=e.imageUrl;else{const i="string"==typeof r?r:e.image||t&&n.useNameAsImageName&&t.toLowerCase()+c||d||"";g=i&&n.getImageURL(i),i.includes(".")||n.validNames&&!n.validNames.includes(i)||(g+=c)}return t=A.encodeHtml(t),{class:"b-resource-info",children:[r&&n.avatarRendering.getResourceAvatar({initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:g,defaultImageUrl:d&&this.getImageURL(d)}),i||o||s?{tag:"dl",children:[{tag:"dt",html:t},i?{tag:"dd",class:"b-resource-role",html:A.encodeHtml(e[u])}:null,o?{tag:"dd",class:"b-resource-events",html:n.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:n.showMeta(e)}:null]}:t]}}defaultRenderer({grid:e,record:t,cellElement:n,value:r,isExport:i}){let s;return t.isSpecialRow?s="":i?s=r:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?n.style.fontSize=e.rowHeight/40+"em":n.style.fontSize="",s=this.template(t,r)),s}}au.registerColumnType(Vy),Vy._$name="ResourceInfoColumn";class Wy extends oy{static get $name(){return"Scheduler"}static get type(){return"scheduler"}}Wy.initClass(),Wy._$name="Scheduler";class Gy extends sd{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilter:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,itemTpl:e=>A.encodeHtml(e.name||"")}}itemIconTpl(e,t){const{eventColor:n}=e,r=er.isNamedColor(n)?` b-sch-foreground-${n}`:"",i=!r&&n?` style="color:${n}"`:"";return this.multiSelect?`<div class="b-selected-icon b-icon${r}"${i}></div>`:""}updateEventStore(e){var t;const{resourceStore:n}=e,r=this.initialConfig.store instanceof ta?this.initialConfig.store.initialConfig:null===(t=this.store)||void 0===t?void 0:t.config;this.store=n.makeChained(null,null,r),n.count?this.initFilter():n.project.on({name:"project",refresh:"initFilter",thisObj:this})}initFilter(){const{eventStore:e}=this;e.count&&e.resourceStore.count&&(this.selected.add(this.store.getRange()),this.detachListeners("project"))}onSelectionChange({source:e}){const t=this,n=e.count===t.eventStore.resourceStore.count;super.onSelectionChange(...arguments),t.resourceFilter?(t.resourceFilter.disabled=n,t.applyFilter()):t.resourceFilter=t.eventStore.addFilter({id:`${t.id}-filter-instance`,filterBy:e=>!e.resource||t.selected.includes(e.resources),disabled:n},!0)}applyFilter(){this.eventStore.filter()}}Gy.initClass(),Gy._$name="ResourceFilter";const Uy=e=>e.isProjectConsumer;class Yy extends hd{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(Uy))}changeScheduler(e){return e.isProjectConsumer?e:Yy.getById(e)}updateScheduler(e){const{crudManager:t}=e;t?t.on({load:"onCrudManagerLoad",thisObj:this}):this.onCrudManagerLoad(),this.stm=e.project.stm}async onCrudManagerLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}}Yy.initClass(),Yy._$name="UndoRedo",e.AbstractCrudManager=dg,e.AbstractCrudManagerMixin=cg,e.AbstractRecurrenceIterator=Rm,e.AbstractTimeRanges=yf,e.ActionBase=aa,e.ActionColumn=lu,e.AggregateColumn=cu,e.AjaxHelper=be,e.AjaxStore=ia,e.AjaxTransport=ug,e.ArrayHelper=Ce,e.AssignmentModel=Bg,e.AssignmentModelMixin=pg,e.AssignmentStore=qg,e.AssignmentStoreMixin=Ng,e.AsyncHelper=h,e.AttachToProjectMixin=ef,e.AvatarRendering=ru,e.Badge=Ss,e.Bag=Qi,e.Bar=Eh,e.Base=me,e.BooleanCombo=gd,e.BooleanDataField=wo,e.BrowserHelper=r,e.Button=Rs,e.ButtonGroup=md,e.CSSHelper=Sl,e.CalendarPanel=pd,e.CellEdit=Au,e.CellMenu=Iu,e.CellTooltip=ku,e.CheckColumn=uu,e.Checkbox=fd,e.ChipView=od,e.ClickRepeater=Fr,e.Collection=Xi,e.CollectionFilter=ji,e.CollectionSorter=Bi,e.Column=su,e.ColumnAutoWidth=Lu,e.ColumnDragToolbar=Pu,e.ColumnLines=Cf,e.ColumnPicker=_u,e.ColumnReorder=$u,e.ColumnResize=Hu,e.ColumnStore=au,e.Combo=cd,e.Config=Z,e.Container=os,e.ContextMenu=ju,e.ContextMenuBase=wl,e.CrudManager=qp,e.CrudManagerView=gg,e.DailyRecurrenceIterator=Tm,e.DataField=bo,e.DataGenerator=Zl,e.DateColumn=hu,e.DateDataField=So,e.DateField=wd,e.DateHelper=Mt,e.DatePicker=Cd,e.DateTimeField=xd,e.DayTime=Lc,e.Delayable=br,e.DemoBot=Ql,e.Dependencies=Rf,e.DependencyBaseModel=Qm,e.DependencyCreation=wf,e.DependencyEdit=Mf,e.DependencyModel=np,e.DependencyStore=lp,e.DependencyStoreMixin=rp,e.DisplayField=Rd,e.DomClassList=on,e.DomDataStore=sa,e.DomHelper=er,e.DomSync=Ur,e.DragBase=rf,e.DragContext=pc,e.DragCreateBase=lf,e.DragHelper=Ll,e.DragProxy=fc,e.DragTipProxy=Fc,e.Draggable=vc,e.Droppable=yc,e.Duration=$i,e.DurationField=Td,e.DynamicObject=ls,e.EditBase=hf,e.Editor=Fd,e.EventContextMenu=Af,e.EventCopyPaste=kf,e.EventDayIndex=am,e.EventDrag=Of,e.EventDragCreate=Lf,e.EventDragSelect=Pf,e.EventEdit=Xf,e.EventEditor=_f,e.EventFilter=Zf,e.EventHelper=Tr,e.EventMenu=Ff,e.EventModel=Ym,e.EventModelMixin=Nm,e.EventNavigation=$v,e.EventResize=of,e.EventSelection=Pv,e.EventStore=Zm,e.EventStoreMixin=hm,e.EventTooltip=Jf,e.Events=Be,e.ExcelExporter=Ny,e.ExportDialog=gh,e.ExportOrientationCombo=hh,e.ExportRowsCombo=uh,e.Exporter=mh,e.Factoryable=ui,e.Featureable=e=>class extends(e||me){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const t=d({ownerName:"client"},e.featureable);t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:()=>t})}doDestroy(){const e=this.features;super.doDestroy();for(const n in e){var t;const r=e[n];null===(t=r.destroy)||void 0===t||t.call(r)}}hasFeature(e){var t;return Boolean(null===(t=this.features)||void 0===t?void 0:t[e])}changeFeatures(e,t){if(this.isDestroying)return;const n=this,{featureable:r}=n.constructor,i=n.$features||(n.$features=new ls({configName:"features",factory:r.factory,owner:n,ownerName:r.ownerName}));return i.update(e),t?void 0:i.target}get widgetClass(){}},e.Field=qs,e.FileField=Ad,e.FileFormat=ah,e.FilePicker=Id,e.Filter=Nu,e.FilterBar=zu,e.FilterField=kd,e.Finalizable=cc,e.Footer=Dh,e.Formatter=rc,e.Fullscreen=Yr,e.FunctionHelper=Se,e.GlobalEvents=an,e.Grid=ng,e.GridBase=tg,e.GridElementEvents=Ah,e.GridExcelExporter=wh,e.GridFeatureManager=Tu,e.GridFeatures=kh,e.GridGroupSummary=ly,e.GridMultiPageExporter=ph,e.GridMultiPageVerticalExporter=fh,e.GridPdfExport=yh,e.GridResponsive=_h,e.GridRowModel=wu,e.GridSelection=jh,e.GridSinglePageExporter=vh,e.GridState=Wh,e.GridSubGrids=Kh,e.GridSummary=th,e.Group=Vu,e.GroupSummary=Gu,e.Header=Mh,e.HeaderContextMenu=dy,e.HeaderMenu=Uu,e.HeaderZoom=uy,e.Histogram=eu,e.HorizontalTimeAxis=ty,e.Hoverable=e=>class extends(e.mixin(br)){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null===(t=this.hoverIgnoreElement)||void 0===t?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:n,hoverEdgeSize:r,hoverTarget:i}=t;if(i){if(n){const{top:s,left:o,width:a,height:l,right:c,bottom:d}=i.getBoundingClientRect(),{clientX:u,clientY:h}=e,g=o+a/2,m=s+l/2,p=h<(r?s+r:m),f=u>=(r?c-r:g),v=h>=(r?d-r:m),y=u<(r?o+r:g),b=p||v?p?"t":"b":"",C=f||y?f?"r":"l":"";t.hoverZone=(n.includes(b)?b:"")+(n.includes(C)?C:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;var n;t&&(e=null===(n=e)||void 0===n?void 0:n.closest(t));this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:n}=this;n&&(null==t||t.classList.remove(n),null==e||e.classList.add(n)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const n=this,{hoverCls:r,hoverAnimationCls:i,hoverRootActiveCls:s,hoverRootElement:o}=n;s&&(null==o||o.classList[e?"add":"remove"](s)),t&&(r&&t.classList.remove(r),i&&t.classList.remove(i),n.hoverLeave(t)),e&&(r&&e.classList.add(r),n.hoverEnter(t),n.hoverTrack&&n.hoverMove(n.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:t,hoverTarget:n}=this;if(n){const{className:r}=n,i=on.change(r,e?xc[e]:null,Dc);r!==i&&(n.className=i,e&&t&&(n.classList.remove(t),n.getBoundingClientRect(),n.classList.add(t)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,n=t.hoverRootElement,r={element:n,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(r.mousemove="onHoverMouseMove"),null===(e=t._hoverRootDetacher)||void 0===e||e.call(t),t._hoverRootDetacher=n&&Tr.on(r)}},e.IdHelper=Qr,e.Identifiable=mi,e.InstancePlugin=uo,e.IntegerDataField=Eo,e.JsonEncoder=hg,e.Label=Od,e.Labels=vy,e.Layout=Oi,e.List=sd,e.LoadMaskable=Rc,e.LocaleHelper=Ne,e.LocaleManager=Ve,e.Localizable=Ye,e.LocalizableCombo=dh,e.Mask=yi,e.Menu=Cl,e.MenuItem=yl,e.MessageDialog=_d,e.Model=Oo,e.ModelDataField=Do,e.ModelStm=fo,e.Month=Pc,e.MonthlyRecurrenceIterator=Fm,e.MultiPageExporter=Ly,e.MultiPageVerticalExporter=Py,e.NonWorkingTime=yy,e.NumberColumn=gu,e.NumberDataField=xo,e.NumberField=Sd,e.NumberFormat=lc,e.ObjectDataField=Ro,e.ObjectHelper=Ot,e.Objects=j,e.Orientation=oh,e.Override=l,e.PagingToolbar=$d,e.Pan=by,e.Panel=Bs,e.PaperFormat=sh,e.Parser=td,e.PartOfBaseProject=e=>class extends e{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},e.PartOfProject=mg,e.PdfExport=jy,e.PercentColumn=mu,e.PickerField=rd,e.Pluggable=ho,e.Point=Cr,e.Popup=Ns,e.PresetManager=Zp,e.PresetStore=Xp,e.ProjectConsumer=tf,e.ProjectCrudManager=cp,e.ProjectModel=Yp,e.ProjectModelMixin=hp,e.Promissory=pi,e.QuickFind=Yu,e.RandomGenerator=Xl,e.RatingColumn=pu,e.Rectangle=nn,e.RectangularPathFinder=Sf,e.RecurrenceCombo=jf,e.RecurrenceConfirmationPopup=$f,e.RecurrenceDayRuleEncoder=Cm,e.RecurrenceDaysButtonGroup=zf,e.RecurrenceDaysCombo=Nf,e.RecurrenceEditor=Yf,e.RecurrenceFrequencyCombo=Hf,e.RecurrenceLegend=Qp,e.RecurrenceLegendButton=Bf,e.RecurrenceModel=_m,e.RecurrenceMonthDaysButtonGroup=Vf,e.RecurrenceMonthsButtonGroup=Wf,e.RecurrencePositionsCombo=Uf,e.RecurrenceStopConditionCombo=Gf,e.RecurringEventEdit=qf,e.RecurringEvents=av,e.RecurringEventsMixin=fm,e.RecurringTimeSpan=Bm,e.RecurringTimeSpansMixin=pm,e.RegionResize=qu,e.Renderable=vi,e.ResizeHelper=Vl,e.ResizeMonitor=Zr,e.ResourceCollapseColumn=zy,e.ResourceCombo=Kf,e.ResourceFilter=Gy,e.ResourceHeader=ny,e.ResourceInfoColumn=Vy,e.ResourceModel=Jg,e.ResourceModelMixin=Xg,e.ResourceStore=nm,e.ResourceStoreMixin=Kg,e.ResourceTimeRangeModel=dp,e.ResourceTimeRangeStore=up,e.ResourceTimeRanges=Cy,e.ResourceTimeRangesBase=gf,e.Responsive=e=>{var t,n;return n=t=class extends(e||me){changeBreakpoints(e){return Ot.assertObject(e,"breakpoints"),null!=e&&e.width&&Object.keys(e.width).forEach((t=>{e.width[t].maxWidth=t})),null!=e&&e.height&&Object.keys(e.height).forEach((t=>{e.height[t].maxHeight=t})),e}updateBreakpoints(e){e&&(this.monitorResize=!0)}getBreakpoint(e,t){const n=Object.keys(e).map((e=>parseInt(e))).sort().find((e=>t<=e));return e[null!=n?n:e["*"]&&"*"]}activateBreakpoint(e,t){const n=this,r=n[`current${e}Breakpoint`];var i,s;t!==r&&(n[`current${e}Breakpoint`]=t,n.setConfig(t.configs),r&&n.element.classList.remove(`b-breakpoint-${r.name.toLowerCase()}`),n.element.classList.add(`b-breakpoint-${t.name.toLowerCase()}`),n.trigger(`responsive${e}Change`,{breakpoint:t,prevBreakpoint:r}),null===(i=t.callback)||void 0===i||i.call(t,{source:n,breakpoint:t,prevBreakpoint:r}),null===(s=n.recompose)||void 0===s||s.call(n))}applyResponsiveness(e,t){var n;const r=this,{width:i,height:s}=null!==(n=r.breakpoints)&&void 0!==n?n:{};if(i){const t=r.getBreakpoint(i,e);r.activateBreakpoint("Width",t)}if(s){const e=r.getBreakpoint(s,t);r.activateBreakpoint("Height",e)}}onInternalResize(e,t,n,r,i){super.onInternalResize(e,t,n,r,i),this.applyResponsiveness(t,n)}},u(t,"$name","Responsive"),u(t,"configurable",{breakpoints:null}),n},e.Ripple=_i,e.Rotatable=hs,e.Row=Sh,e.RowCopyPaste=Ku,e.RowManager=xh,e.RowNumberColumn=fu,e.RowReorder=Xu,e.RowsRange=ih,e.Scale=nu,e.ScheduleContextMenu=Sy,e.ScheduleMenu=wy,e.ScheduleRange=Iy,e.ScheduleRangeCombo=_y,e.ScheduleTableExporter=By,e.ScheduleTooltip=Ey,e.Scheduler=Wy,e.SchedulerBase=oy,e.SchedulerDom=Cv,e.SchedulerDomEvents=wv,e.SchedulerEventRendering=Rv,e.SchedulerExportDialog=$y,e.SchedulerRegions=kv,e.SchedulerScroll=Iv,e.SchedulerState=Lv,e.SchedulerStores=Tv,e.ScrollManager=Tc,e.Scroller=si,e.Search=Zu,e.SharedEventStoreMixin=gm,e.SimpleEventEdit=Dy,e.SinglePageExporter=Hy,e.SlideToggle=jd,e.Slider=Hd,e.Sort=Ju,e.Splitter=Nd,e.State=go,e.StateBase=da,e.StateTrackingManager=pl,e.StickyCells=Qu,e.StickyEvents=Ry,e.Store=ta,e.StoreCRUD=Po,e.StoreChained=Yo,e.StoreFilter=_o,e.StoreGroup=Ho,e.StoreProxy=jo,e.StoreRelation=Bo,e.StoreSearch=Wo,e.StoreSort=Go,e.StoreState=qo,e.StoreStm=ea,e.StoreSum=No,e.StoreSync=Jo,e.StoreTree=Xo,e.StringDataField=To,e.StringHelper=A,e.Stripe=eh,e.Styleable=e=>{var t,n;return n=t=class extends(e||me){changeCssVarPrefix(e){return Ot.assertString(e,"prefix"),e&&!e.endsWith("-")&&(e+="-"),e||""}changeCss(e){Ot.assertObject(e,"css");const t=this;if(!r.global.Proxy)throw new Error("Proxy not supported");const n=new Proxy({},{get(e,n){var r;return null===(r=getComputedStyle(t.element||document.documentElement).getPropertyValue(`--${t.cssVarPrefix}${A.hyphenate(n)}`))||void 0===r?void 0:r.trim()},set:(e,n,r)=>((t.element||document.documentElement).style.setProperty(`--${t.cssVarPrefix}${A.hyphenate(n)}`,r),!0)});return e&&(t._element?Ot.assign(n,e):t.$initialCSS=e),n}updateElement(e,...t){super.updateElement(e,...t),this.$initialCSS&&Ot.assign(this.css,this.$initialCSS)}get widgetClass(){}},u(t,"$name","Styleable"),u(t,"configurable",{cssVarPrefix:"",css:{}}),n},e.SubGrid=qh,e.Summary=Ty,e.Tab=zd,e.TabBar=Wd,e.TabPanel=Yd,e.TableExporter=bh,e.TemplateColumn=vu,e.TemplateHelper=Ul,e.TextAreaField=qd,e.TextField=nd,e.TimeAxis=Jp,e.TimeAxisColumn=ry,e.TimeAxisHeaderMenu=Fy,e.TimeAxisSubGrid=mv,e.TimeAxisViewModel=Qf,e.TimeColumn=yu,e.TimeField=Dd,e.TimePicker=Ed,e.TimeRanges=Ay,e.TimeSpan=vm,e.TimeSpanMenuBase=mf,e.TimeSpanRecordContextMenuBase=ff,e.TimelineBase=yv,e.TimelineDateMapper=tv,e.TimelineDomEvents=rv,e.TimelineEventRendering=lv,e.TimelineScroll=uv,e.TimelineViewPresets=sv,e.TimelineZoomable=ov,e.Toast=Yl,e.Tool=gs,e.Toolable=vs,e.Toolbar=As,e.Tooltip=Ws,e.TooltipBase=vf,e.Transaction=Da,e.Tree=rh,e.TreeColumn=Cu,e.TreeGrid=rg,e.TreeNode=vo,e.UndoRedo=Yy,e.UndoRedoBase=hd,e.VersionHelper=s,e.ViewPreset=Kp,e.WeeklyRecurrenceIterator=Mm,e.Widget=ki,e.WidgetColumn=du,e.WidgetHelper=ql,e.XMLHelper=Kl,e.YearlyRecurrenceIterator=Am,Object.defineProperty(e,"__esModule",{value:!0})}));