<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bpr581skrvServiceImpl">

	<select id="bpr581skrvServiceImpl.selectList2" parameterType="Map" resultType="rMap">
	  	<if test="OPTSEL == &quot;0&quot;">
		    /* bpr581skrv.Cbpr581skrv[fnBpr581QStd] Query02 */
		    BEGIN
		            SET NOCOUNT ON
		            SET ARITHABORT ON
		
		            DECLARE @CompCode       NVARCHAR(08) /* 법인코드                */
		                  , @UserId         NVARCHAR(100) /* 사용자ID              */
		                  , @LangType       NVARCHAR(2)  /* 언어구분                */
		                  , @RefItem        NVARCHAR(01) /* 명칭 참조 유형            */
		                  , @DateFormat     NVARCHAR(10) /* 날짜 포맷 유형 설정     */
		
		            SET @CompCode = #{S_COMP_CODE}
		            SET @UserId   = #{S_USER_ID}
		            SET @LangType = #{S_LANG_CODE}
		
		            /* 명칭 참조 유형 */
		            SELECT TOP 1 @RefItem = REF_ITEM
		              FROM BSA300T WITH (NOLOCK)
		             WHERE USER_ID = @UserId
		
		            SET @RefItem = ISNULL(@RefItem, N'0')
		
		            /* 날짜 포맷 유형 설정 */
		            SELECT TOP 1 @DateFormat = CODE_NAME
		              FROM BSA100T WITH (NOLOCK)
		             WHERE COMP_CODE = @CompCode
		               AND MAIN_CODE = N'B044'
		               AND REF_CODE1 = N'Y'
		
		             SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		            SELECT A.COMP_CODE
		                 , A.DIV_CODE
		                 , A.PROD_ITEM_CODE
		                 , A.CHILD_ITEM_CODE
		                 , (CASE WHEN @RefItem = '1' THEN B.ITEM_NAME1
		                         WHEN @RefItem = '2' THEN B.ITEM_NAME2
		                                             ELSE B.ITEM_NAME
		                 END)               AS ITEM_NAME
		                 , B.SPEC
		                 , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)    AS START_DATE
		                 , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)     AS STOP_DATE
		                 , A.UPDATE_DB_USER
		                 , A.UPDATE_DB_TIME
		              FROM            BPR500T A WITH (NOLOCK)
		                   INNER JOIN BPR100T B  WITH (NOLOCK) ON A.COMP_CODE      = B.COMP_CODE
		                                                      AND A.PROD_ITEM_CODE = B.ITEM_CODE
		                   INNER JOIN BPR200T C  WITH (NOLOCK) ON A.COMP_CODE      = C.COMP_CODE
		                                                      AND A.DIV_CODE       = C.DIV_CODE
		                                                      AND A.PROD_ITEM_CODE = C.ITEM_CODE
		             WHERE A.CHILD_ITEM_CODE   = '$'
		               AND A.COMP_CODE         = @CompCode
<!-- 20210818 수정: 품목 팝업 조회쿼리 수정 -->
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		               AND A.PROD_ITEM_CODE = #{ITEM_CODE}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		               AND A.PROD_ITEM_CODE LIKE #{ITEM_CODE} + '%'
		    </if>
		    <if test="@foren.Ognl@isEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		               AND (CASE WHEN @RefItem = '1' THEN B.ITEM_NAME1
		                         WHEN @RefItem = '2' THEN B.ITEM_NAME2
		                                             ELSE B.ITEM_NAME
		                     END)             LIKE REPLACE(#{ITEM_NAME},'[','[[]') + '%'
		    </if>
		               <if test="@foren.Ognl@isNotEmpty(ITEM_ACCOUNT)">
		               AND C.ITEM_ACCOUNT  = #{ITEM_ACCOUNT}
		               </if>
		               <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		               AND A.DIV_CODE = #{DIV_CODE}
		               </if>
		
		               <if test="@foren.Ognl@isNotEmpty(ITEM_LEVEL1)">
		               AND B.ITEM_LEVEL1 = #{ITEM_LEVEL1}
		               </if>
		
		               <if test="@foren.Ognl@isNotEmpty(ITEM_LEVEL2)">
		               AND B.ITEM_LEVEL2 = #{ITEM_LEVEL2}
		               </if>
		
		               <if test="@foren.Ognl@isNotEmpty(ITEM_LEVEL3)">
		               AND B.ITEM_LEVEL3 = #{ITEM_LEVEL3}
		               </if>
		
		             ORDER BY A.PROD_ITEM_CODE
		             SET NOCOUNT OFF
		             SET ARITHABORT OFF
		    END
	    </if>
	    <if test="OPTSEL == &quot;1&quot;">
	    	/* bpr581skrv.Cbpr581skrv[fnBpr581QStd] Query02 */
		     BEGIN
		            SET NOCOUNT ON
		            SET ARITHABORT ON
		
		            DECLARE @CompCode       NVARCHAR(08) /* 법인코드                */
		                  , @UserId         NVARCHAR(100) /* 사용자ID              */
		                  , @LangType       NVARCHAR(2)  /* 언어구분                */
		                  , @RefItem        NVARCHAR(01) /* 명칭 참조 유형            */
		                  , @DateFormat     NVARCHAR(10) /* 날짜 포맷 유형 설정     */
		
		            SET @CompCode = #{S_COMP_CODE}
		            SET @UserId   = #{S_USER_ID}
		            SET @LangType = #{S_LANG_CODE}
		
		            /* 명칭 참조 유형 */
		            SELECT TOP 1 @RefItem = REF_ITEM
		              FROM BSA300T WITH (NOLOCK)
		             WHERE USER_ID = @UserId
		
		            SET @RefItem = ISNULL(@RefItem, N'0')
		
		            /* 날짜 포맷 유형 설정 */
		            SELECT TOP 1 @DateFormat = CODE_NAME
		              FROM BSA100T WITH (NOLOCK)
		             WHERE COMP_CODE = @CompCode
		               AND MAIN_CODE = N'B044'
		               AND REF_CODE1 = N'Y'
		
		             SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		
		            SELECT  A.COMP_CODE
		                 , B.DIV_CODE
		                 , A.ITEM_CODE AS PROD_ITEM_CODE
		                 , A.ITEM_CODE AS CHILD_ITEM_CODE
		                 , (CASE WHEN @RefItem = '1' THEN A.ITEM_NAME1
		                         WHEN @RefItem = '2' THEN A.ITEM_NAME2
		                                             ELSE A.ITEM_NAME
		                 END)               AS ITEM_NAME
		                 , A.SPEC
		                 , ''  AS START_DATE
		                 , ''    AS STOP_DATE
		                 , A.UPDATE_DB_USER
		                 , A.UPDATE_DB_TIME
		              FROM   BPR100T A WITH (NOLOCK) 
		                     INNER JOIN BPR200T B  WITH (NOLOCK) ON  A.COMP_CODE  = B.COMP_CODE
		                                                AND  A.ITEM_CODE    = B.ITEM_CODE
		             WHERE A.COMP_CODE         = @CompCode
<!-- 20210818 수정: 품목 팝업 조회쿼리 수정 -->
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		               AND A.ITEM_CODE = #{ITEM_CODE}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		               AND A.ITEM_CODE LIKE #{ITEM_CODE} + '%'
		    </if>
		    <if test="@foren.Ognl@isEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		               AND (CASE WHEN @RefItem = '1' THEN A.ITEM_NAME1
		                         WHEN @RefItem = '2' THEN A.ITEM_NAME2
		                                             ELSE A.ITEM_NAME
		                     END)             LIKE REPLACE(#{ITEM_NAME},'[','[[]') + '%'
		    </if>
		               <if test="@foren.Ognl@isNotEmpty(ITEM_ACCOUNT)">
		               AND B.ITEM_ACCOUNT  = #{ITEM_ACCOUNT}
		               </if>
		               <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		               AND B.DIV_CODE = #{DIV_CODE}
		               </if>
		
		               <if test="@foren.Ognl@isNotEmpty(ITEM_LEVEL1)">
		               AND A.ITEM_LEVEL1 = #{ITEM_LEVEL1}
		               </if>
		
		               <if test="@foren.Ognl@isNotEmpty(ITEM_LEVEL2)">
		               AND A.ITEM_LEVEL2 = #{ITEM_LEVEL2}
		               </if>
		
		               <if test="@foren.Ognl@isNotEmpty(ITEM_LEVEL3)">
		               AND A.ITEM_LEVEL3 = #{ITEM_LEVEL3}
		               </if>
		
		             ORDER BY A.ITEM_CODE
		             SET NOCOUNT OFF
		             SET ARITHABORT OFF
		    END
	    </if>
	</select>

	<select id="bpr581skrvServiceImpl.selectMaster" parameterType="Map" resultType="rMap">
		<if test="OPTSEL == &quot;0&quot;">
			/* bpr580skrv.Cbpr580skrv [fnBpr580QSt1]Query1 */
			/* 정전개 */
			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
			      , @UserId			NVARCHAR(100)	/* 사용자ID */
			      , @LangType		NVARCHAR(2)		/* 언어구분 */
			      , @RefItem		NVARCHAR(01)
			      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */

			SET @CompCode = #{S_COMP_CODE}
			SET @UserId   = #{S_USER_ID}
			SET @LangType = #{S_LANG_CODE}

			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
			SELECT A.DIV_CODE
			     , A.PROD_ITEM_CODE
			     , B.ITEM_CODE
			     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
			     , B.SPEC
			     , B.STOCK_UNIT
			     , (A.UNIT_Q * 0 + 1)                                                               AS UNIT_Q
			     , (A.PROD_UNIT_Q * 0 + 1)                                                          AS PROD_UNIT_Q
			     , (A.LOSS_RATE * 0)                                                                AS LOSS_RATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
			     , M1.CODE_NAME                                                  AS PATH_CODE
			     , A.BOM_YN
			     , A.USE_YN
			     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
			     --20180528 MATERIAL_CNT, SET_QTY 추가
			     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
			     , ISNULL(A.SET_QTY,0)																AS SET_QTY
			     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
			     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
			     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
			     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
			     , CONVERT(NVARCHAR(02), '')                                                        AS SUB_FLAG
			     , C.ITEM_ACCOUNT
			     , CONVERT(NUMERIC(5,0), 0)                                                         AS SEQ
			     , (A.UNIT_Q * 0 + 1)                                                               AS INTENS_Q
			     , B.SPEC_NUM                                                                       AS SPEC_NUM
			     , E.STOCK_Q                                                                        AS STOCK_Q
			     , A.REMARK                                                                         AS REMARK
			  FROM            BPR500T  A  WITH (NOLOCK)
			       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
			                                           AND B.ITEM_CODE    = A.PROD_ITEM_CODE
			       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
			                                           AND C.DIV_CODE     = A.DIV_CODE
			                                           AND C.ITEM_CODE    = A.PROD_ITEM_CODE
			       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
			                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
			       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
			       				 FROM BIV100T WITH (NOLOCK)
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.PROD_ITEM_CODE
			       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
			                                           AND M1.MAIN_CODE   = N'B083'
			                                           AND M1.SUB_CODE   != N'$'
			                                           AND M1.SUB_CODE    = A.PATH_CODE
			 WHERE A.COMP_CODE       = #{S_COMP_CODE}
			   AND A.DIV_CODE        = #{DIV_CODE}
			   AND A.PROD_ITEM_CODE  = #{ITEM_CODE}
			   AND A.CHILD_ITEM_CODE = '$'
<!-- 20190718 주석처리
			   <if test="@foren.Ognl@isNotEmpty(StPathY)">
                  <if test="StPathY == &quot;Y&quot;">
                  		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
                  </if>
                  <if test="StPathY == &quot;N&quot;">
            	  		AND A.path_code = A.path_code
                  </if>
          	   </if>
-->
          	   <if test="ITEM_SEARCH == &quot;C&quot;">
			   AND A.START_DATE     = (SELECT MAX(START_DATE)
                                         FROM BPR500T WITH(NOLOCK)
                                        WHERE COMP_CODE        = #{S_COMP_CODE}
                                          AND DIV_CODE         = #{DIV_CODE}
                                          AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                          AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                          AND PATH_CODE        = A.PATH_CODE
                                          AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112))
			   AND (A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                 OR A.STOP_DATE       IS NULL)
			  </if>
		</if>

		<if test="OPTSEL == &quot;1&quot;">
			/* bpr580skrv.Cbpr580skrv [fnBpr580QSt2]Query1 */
			/* 역전개 */
			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
			      , @UserId			NVARCHAR(100)	/* 사용자ID */
			      , @LangType		NVARCHAR(2)		/* 언어구분 */
			      , @RefItem		NVARCHAR(01)
			      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */

			SET @CompCode = #{S_COMP_CODE}
			SET @UserId   = #{S_USER_ID}
			SET @LangType = #{S_LANG_CODE}

			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
			SELECT DISTINCT
				   A.DIV_CODE
			     , B.ITEM_CODE                                                                      AS PROD_ITEM_CODE
			     , B.ITEM_CODE
			     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
			     , B.SPEC
			     , B.STOCK_UNIT
			     , 1                                                                                AS UNIT_Q
			     , 1                                                                                AS PROD_UNIT_Q
			     , 0                                                                                AS LOSS_RATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
			     , M1.CODE_NAME                                                  AS PATH_CODE
			     , A.BOM_YN
			     , A.USE_YN
			     , A.MAN_HOUR
			     --20180528 MATERIAL_CNT, SET_QTY 추가
			     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
			     , ISNULL(A.SET_QTY,0)																AS SET_QTY
			     , A.UNIT_P1
			     , A.UNIT_P2
			     , A.UNIT_P3
			     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
			     , ''                                                                               AS SUB_FLAG
			     , C.ITEM_ACCOUNT
			     , 0                                                                                AS SEQ
			     , 1                                                                                AS INTENS_Q
			     , B.SPEC_NUM                                                                       AS SPEC_NUM
			     , E.STOCK_Q                                                                        AS STOCK_Q
			     , A.REMARK                                                                         AS REMARK
			  FROM            BPR500T  A  WITH (NOLOCK)
			       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
			                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
			       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
			                                           AND C.DIV_CODE     = A.DIV_CODE
			                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
			       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
			                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
			       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
			       				 FROM BIV100T WITH (NOLOCK)
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE
			       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
			                                           AND M1.MAIN_CODE   = N'B083'
			                                           AND M1.SUB_CODE   != N'$'
			                                           AND M1.SUB_CODE    = A.PATH_CODE
			 WHERE A.COMP_CODE       = #{S_COMP_CODE}
			   AND A.DIV_CODE        = #{DIV_CODE}
			   AND A.CHILD_ITEM_CODE = #{ITEM_CODE}
<!-- 20190718 주석처리
			   <if test="@foren.Ognl@isNotEmpty(StPathY)">
                  <if test="StPathY == &quot;Y&quot;">
                  		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
                  </if>
                  <if test="StPathY == &quot;N&quot;">
            	  		AND A.path_code = A.path_code
                  </if>
          	   </if>
-->
          	   <if test="ITEM_SEARCH == &quot;C&quot;">
			   	AND	 A.START_DATE     = (SELECT MAX(START_DATE)
                                           FROM BPR500T WITH(NOLOCK)
                                          WHERE COMP_CODE        = #{S_COMP_CODE}
                                            AND DIV_CODE         = #{DIV_CODE}
                                            AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                            AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                            AND PATH_CODE        = A.PATH_CODE
                                            AND START_DATE   &lt;= CONVERT(VARCHAR(8), GETDATE(), 112))
			    AND (A.STOP_DATE &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                  OR A.STOP_DATE       IS NULL)
          	   </if>
		</if>
	</select>

	<select id="bpr581skrvServiceImpl.selectList" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		/* bpr580skrv.Cbpr580skrv [fnBpr580QSt1]Query1 */
		/* 정전개 */
		DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
		      , @UserId			NVARCHAR(100)	/* 사용자ID */
		      , @LangType		NVARCHAR(2)		/* 언어구분 */
		      , @RefItem		NVARCHAR(01)
		      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */

		SET @CompCode = #{S_COMP_CODE}
		SET @UserId   = #{S_USER_ID}
		SET @LangType = #{S_LANG_CODE}

		SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
		SELECT A.PROD_ITEM_CODE + B.ITEM_CODE 	as id
			 , 'root' 							as parentId
		     , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , (A.UNIT_Q * 0 + 1)                                                               AS UNIT_Q
		     , (A.PROD_UNIT_Q * 0 + 1)                                                          AS PROD_UNIT_Q
		     , (A.LOSS_RATE * 0)                                                                AS LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
		     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , CONVERT(NVARCHAR(02), '')                                                        AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , CONVERT(NUMERIC(5,0), 0)                                                         AS SEQ
		     , (A.UNIT_Q * 0 + 1)                                                               AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
		     , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		     --20190621 구매단가 추가
		     , C.PURCHASE_BASE_P
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.PROD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.PROD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
		       				 FROM BIV100T WITH (NOLOCK)
		       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
		       														   AND E.DIV_CODE	= A.DIV_CODE
		       														   AND E.ITEM_CODE  = A.PROD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{ITEM_CODE}
		   AND A.CHILD_ITEM_CODE = '$'
<!-- 20190718 주석처리
		   <if test="@foren.Ognl@isNotEmpty(StPathY)">
              <if test="StPathY == &quot;Y&quot;">
              		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
              </if>
              <if test="StPathY == &quot;N&quot;">
        	  		AND A.path_code = A.path_code
              </if>
      	   </if>
-->
      	   <if test="ITEM_SEARCH == &quot;C&quot;">
		   AND A.START_DATE     = (SELECT MAX(START_DATE)
                                     FROM BPR500T WITH(NOLOCK)
                                    WHERE COMP_CODE        = #{S_COMP_CODE}
                                      AND DIV_CODE         = #{DIV_CODE}
                                      AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                      AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                      AND PATH_CODE        = A.PATH_CODE
                                      AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                      )
		   AND (
               A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
           OR  A.STOP_DATE       IS NULL
               )
		  </if>
	</select>
	<select id="bpr581skrvServiceImpl.selectList_new" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		/* bpr580skrv.Cbpr580skrv [fnBpr580QSt1]Query1 NEW */
		/* 정전개 */
		DECLARE @CompCode  NVARCHAR(08) 	/* 법인코드  */
		      , @DivCode  NVARCHAR(08) 		/* 사업장코드 */
		      , @ProdItemCode NVARCHAR(20) 	/* 품목코드  */
		      , @BaseDate  NVARCHAR(08) 	/* 기준일  */
		      , @UserId   NVARCHAR(100) 		/* 사용자ID  */

		SET @CompCode = #{S_COMP_CODE}
		SET @DivCode       = #{DIV_CODE}
		SET @ProdItemCode  = #{ITEM_CODE}
		SET @BaseDate      = CONVERT(NVARCHAR(08), GETDATE(), 112)
		SET @UserId   = #{S_USER_ID}

		SELECT rtrim(ltrim(A.SORT_FLD)) AS id
		     , rtrim(ltrim(SORT_FLD2))  AS parentId
		     , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , A.ITEM_CODE
		     , A.ITEM_NAME
		     , A.SPEC
		     , A.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , C.ITEM_ACCOUNT
			 , C.SUPPLY_TYPE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)             AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )             AS STOP_DATE
		     , M1.CODE_NAME             AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                         AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)										AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)											AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                         AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                         AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                         AS UNIT_P3
		     , uniLITE.fnCustNameComp(A.COMP_CODE, @UserId, D.CUSTOM_CODE) AS CUSTOM_NAME
		     , ''                                                           AS SUB_FLAG
		     , A.SEQ
		     , A.INTENS_Q             AS INTENS_Q
		     , B.SPEC_NUM                                                   AS SPEC_NUM
		     , ISNULL(E.STOCK_Q, 0)                                         AS STOCK_Q
		     , A.REMARK
		     , ISNULL(A.LEVEL,0)+1											AS LVL --EXCEL 다운로드시 필요
		     --20190621 구매단가 추가
		     , C.PURCHASE_BASE_P
		     , CASE WHEN M2.REF_CODE3 NOT IN ('00','10','20') THEN ROUND(E.AVERAGE_P,2) ELSE 0 END AS AVERAGE_P
		  FROM uniLITE.fnBOMExplosionAddInfo (@CompCode , @DivCode, @ProdItemCode, @BaseDate, @UserId, '') A
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q, AVG(AVERAGE_P) AS AVERAGE_P
		                         FROM BIV100T WITH (NOLOCK)
		                        GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE) E ON E.COMP_CODE = A.COMP_CODE
		                                                                  AND E.DIV_CODE  = A.DIV_CODE
		                                                                  AND E.ITEM_CODE = A.ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		       LEFT  JOIN BSA100T  M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                           AND M2.MAIN_CODE   = N'B020'
		                                           AND M2.SUB_CODE   != N'$'
		                                           AND M2.SUB_CODE    = A.ITEM_ACCOUNT		                                           
		 ORDER BY A.SEQ
	</select>
	<select id="bpr581skrvServiceImpl.getChildren" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetChildren]Query1
		SELECT A.PROD_ITEM_CODE + B.ITEM_CODE 		as id
			 , #{parentId} 						as parentId
			 , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , ''                                                                               AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(UNIT_Q, 1) * (1 + ISNULL(LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                     AS REMARK
		     --20190621 구매단가 추가
		     , C.PURCHASE_BASE_P
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
			       				 FROM BIV100T WITH (NOLOCK)
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{ITEM_CODE}
<!-- 20190718 주석처리
		   AND (
		       ({StPathY} = 'Y' AND (A.path_code = '0' OR A.path_code LIKE '1%'))
		    OR ({StPathY} = 'N' AND  A.path_code = A.path_code)
		       )
-->
		       <if test="ITEM_SEARCH == &quot;C&quot;">

			   AND A.START_DATE     = (
                                          SELECT MAX(START_DATE)
                                            FROM BPR500T WITH(NOLOCK)
                                           WHERE COMP_CODE        = #{S_COMP_CODE}
                                             AND DIV_CODE         = #{DIV_CODE}
                                             AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                             AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                             AND PATH_CODE        = A.PATH_CODE
                                             AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                          )
			   AND (
                   A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
               OR  A.STOP_DATE       IS NULL
                   )
			  </if>
		 ORDER BY A.SEQ
	</select>

	<select id="bpr581skrvServiceImpl.getSubstitute" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetSubstitute]Query1
		SELECT A.PROD_ITEM_CODE + A.CHILD_ITEM_CODE as id
			 , #{parentId}						as parentId
			 , A.DIV_CODE
		     , A.CHILD_ITEM_CODE AS PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE )                                 AS STOP_DATE
		     , CONVERT(NVARCHAR(08), '0')                                                       AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , ISNULL(A.MAN_HOUR,0)                                                             AS MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , ISNULL(A.UNIT_P1 ,0)                                                             AS UNIT_P1
		     , ISNULL(A.UNIT_P2 ,0)                                                             AS UNIT_P2
		     , ISNULL(A.UNIT_P3 ,0)                                                             AS UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , 'S'                                                                              AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(UNIT_Q, 1) * (1 + ISNULL(LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		     --20190621 구매단가 추가
		     , C.PURCHASE_BASE_P
		  FROM            BPR510T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.EXCHG_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.EXCHG_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
			       				 FROM BIV100T WITH (NOLOCK)
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.EXCHG_ITEM_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{PROD_ITEM_CODE}
		   AND A.CHILD_ITEM_CODE = #{ITEM_CODE}
		 ORDER BY A.SEQ
	</select>

	<select id="bpr581skrvServiceImpl.selectList1" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
	/* bpr580skrv.Cbpr580skrv [fnBpr580QSt2]Query1 */  /* 역전개 */

			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드  */
			      , @UserId			NVARCHAR(100)	/* 사용자ID */
			      , @LangType		NVARCHAR(2)		/* 언어구분 */
			      , @RefItem		NVARCHAR(01)
			      , @DateFormat		NVARCHAR(10) /* 날짜 포맷 유형 설정     */

			SET @CompCode = #{S_COMP_CODE}
			SET @UserId   = #{S_USER_ID}
			SET @LangType = #{S_LANG_CODE}


			SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
			SELECT Top 1
			 	   B.ITEM_CODE + B.ITEM_CODE 	as id
				 , 'root' 						as parentId
				 , A.DIV_CODE
			     , B.ITEM_CODE                                                                      AS PROD_ITEM_CODE
			     , B.ITEM_CODE
			     , uniLITE.fnItemNameComp(@CompCode, @UserId, B.ITEM_CODE)      AS ITEM_NAME
			     , B.SPEC
			     , B.STOCK_UNIT
			     , 1                                                                                AS UNIT_Q
			     , 1                                                                                AS PROD_UNIT_Q
			     , 0                                                                                AS LOSS_RATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
			     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
			     , M1.CODE_NAME                                                  AS PATH_CODE
			     , A.BOM_YN
			     , A.USE_YN
			     , A.MAN_HOUR
			     --20180528 MATERIAL_CNT, SET_QTY 추가
			     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
			     , ISNULL(A.SET_QTY,0)																AS SET_QTY
			     , A.UNIT_P1
			     , A.UNIT_P2
			     , A.UNIT_P3
			     , uniLITE.fnCustNameComp(@CompCode, @UserId, D.CUSTOM_CODE)    AS CUSTOM_NAME
			     , ''                                                                               AS SUB_FLAG
			     , C.ITEM_ACCOUNT
			     , 0                                                                                AS SEQ
			     , 1                                                                                AS INTENS_Q
			     , B.SPEC_NUM                                                                       AS SPEC_NUM
			     , E.STOCK_Q                                                                        AS STOCK_Q
			     , A.REMARK                                                                         AS REMARK
			     --20190621 구매단가 추가
			     , C.PURCHASE_BASE_P
			  FROM            BPR500T  A  WITH (NOLOCK)
			       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
			                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
			       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
			                                           AND C.DIV_CODE     = A.DIV_CODE
			                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
			       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
			                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       	   LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
			       				 FROM BIV100T WITH (NOLOCK)
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE
			       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
			                                           AND M1.MAIN_CODE   = N'B083'
			                                           AND M1.SUB_CODE   != N'$'
			                                           AND M1.SUB_CODE    = A.PATH_CODE
			 WHERE A.COMP_CODE       = #{S_COMP_CODE}
			   AND A.DIV_CODE        = #{DIV_CODE}
			   AND A.CHILD_ITEM_CODE = #{ITEM_CODE}
<!-- 20190718 주석처리
			   <if test="@foren.Ognl@isNotEmpty(StPathY)">
                  <if test="StPathY == &quot;Y&quot;">
                  		AND  (A.path_code = '0' OR A.path_code LIKE '1%')
                  </if>
                  <if test="StPathY == &quot;N&quot;">
            	  		AND A.path_code = A.path_code
                  </if>
          	   </if>
-->
          	   <if test="ITEM_SEARCH == &quot;C&quot;">
			   	AND	 A.START_DATE     = (
                                          SELECT MAX(START_DATE)
                                            FROM BPR500T WITH(NOLOCK)
                                           WHERE COMP_CODE        = #{S_COMP_CODE}
                                             AND DIV_CODE         = #{DIV_CODE}
                                             AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                             AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                             AND PATH_CODE        = A.PATH_CODE
                                             AND START_DATE   &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                          )
			    AND (
				    A.STOP_DATE &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                OR  A.STOP_DATE       IS NULL
                    )
          	   </if>
	</select>

	<select id="bpr581skrvServiceImpl.getParent" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetParent]Query1
		SELECT
		 	  case when  #{CHILD_ITEM_CODE}+#{PROD_ITEM_CODE} = #{ROOT_ITEM_CODE}
		 	  	   then 'root'
		 	  else #{CHILD_ITEM_CODE}+#{PROD_ITEM_CODE}
		 	  end as parentId
			 , #{PROD_ITEM_CODE}+A.PROD_ITEM_CODE as id
			 , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , A.MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , A.UNIT_P1
		     , A.UNIT_P2
		     , A.UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , ''                                                                               AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(A.UNIT_Q, 1) * (1 + ISNULL(A.LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		     --20190621 구매단가 추가
		     , C.PURCHASE_BASE_P
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.CHILD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.CHILD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
			       				 FROM BIV100T WITH (NOLOCK)
			       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
			       														   AND E.DIV_CODE	= A.DIV_CODE
			       														   AND E.ITEM_CODE  = A.CHILD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.CHILD_ITEM_CODE = #{PROD_ITEM_CODE}
<!-- 20190718 주석처리
		   AND (
		       ({StPathY} = 'Y' AND (A.path_code = '0' OR A.path_code LIKE '1%'))
		    OR ({StPathY} = 'N' AND  A.path_code = A.path_code)
		       )
-->
	       <if test="ITEM_SEARCH == &quot;C&quot;">

		   AND A.START_DATE     = (
                                         SELECT MAX(START_DATE)
                                           FROM BPR500T WITH(NOLOCK)
                                          WHERE COMP_CODE        = #{S_COMP_CODE}
                                            AND DIV_CODE         = #{DIV_CODE}
                                            AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
                                            AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
                                            AND PATH_CODE        = A.PATH_CODE
                                            AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
                                         )
		   AND (
                  A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
              OR  A.STOP_DATE       IS NULL
                  )
		  </if>
		 ORDER BY A.SEQ
	</select>

	<select id="bpr581skrvServiceImpl.getParent1" parameterType="Map" resultType="foren.framework.lib.tree.GenericTreeDataMap">
		--bpr580skrv.Cbpr580skrv [fnGetParent]Query2
		SELECT
			   #{CHILD_ITEM_CODE}+#{PROD_ITEM_CODE} as parentId
			 , #{PROD_ITEM_CODE}+A.PROD_ITEM_CODE as id
	<!-- 		   B.ITEM_CODE as parentId -->
	<!-- 		 , A.PROD_ITEM_CODE as id -->
			 , A.DIV_CODE
		     , A.PROD_ITEM_CODE
		     , B.ITEM_CODE
		     , B.ITEM_NAME
		     , uniLITE.fnItemNameComp(#{S_COMP_CODE}, #{S_USER_ID}, B.ITEM_CODE)      AS ITEM_NAME
		     , B.SPEC
		     , B.STOCK_UNIT
		     , A.UNIT_Q
		     , A.PROD_UNIT_Q
		     , A.LOSS_RATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.START_DATE)                                 AS START_DATE
		     , uniLITE.fnGetUserDate(A.COMP_CODE, A.STOP_DATE)                                  AS STOP_DATE
		     , M1.CODE_NAME                                                  AS PATH_CODE
		     , A.BOM_YN
		     , A.USE_YN
		     , A.MAN_HOUR
		     --20180528 MATERIAL_CNT, SET_QTY 추가
		     , ISNULL(A.MATERIAL_CNT,0)															AS MATERIAL_CNT
		     , ISNULL(A.SET_QTY,0)																AS SET_QTY
		     , A.UNIT_P1
		     , A.UNIT_P2
		     , A.UNIT_P3
		     , uniLITE.fnCustNameComp(#{S_COMP_CODE}, #{S_USER_ID}, D.CUSTOM_CODE)    AS CUSTOM_NAME
		     , ''                                                                               AS SUB_FLAG
		     , C.ITEM_ACCOUNT
		     , A.SEQ
		     , #{INTENS_Q} * ISNULL(A.UNIT_Q, 1) * (1 + ISNULL(A.LOSS_RATE, 0) / 100)          AS INTENS_Q
		     , B.SPEC_NUM                                                                       AS SPEC_NUM
			 , E.STOCK_Q                                                                        AS STOCK_Q
		     , A.REMARK                                                                         AS REMARK
		     --20190621 구매단가 추가
		     , C.PURCHASE_BASE_P
		  FROM            BPR500T  A  WITH (NOLOCK)
		       INNER JOIN BPR100T  B  WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
		                                           AND B.ITEM_CODE    = A.PROD_ITEM_CODE
		       INNER JOIN BPR200T  C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                           AND C.DIV_CODE     = A.DIV_CODE
		                                           AND C.ITEM_CODE    = A.PROD_ITEM_CODE
		       LEFT  JOIN BCM100T  D  WITH (NOLOCK) ON D.COMP_CODE    = C.COMP_CODE
		                                           AND D.CUSTOM_CODE  = C.CUSTOM_CODE
		       LEFT  JOIN (SELECT COMP_CODE, DIV_CODE, ITEM_CODE, SUM(ISNULL(STOCK_Q, 0)) AS STOCK_Q
				       				 FROM BIV100T WITH (NOLOCK)
				       				GROUP BY COMP_CODE, DIV_CODE, ITEM_CODE)  E ON E.COMP_CODE	= A.COMP_CODE
				       														   AND E.DIV_CODE	= A.DIV_CODE
				       														   AND E.ITEM_CODE  = A.PROD_ITEM_CODE
		       LEFT  JOIN BSA100T  M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                           AND M1.MAIN_CODE   = N'B083'
		                                           AND M1.SUB_CODE   != N'$'
		                                           AND M1.SUB_CODE    = A.PATH_CODE
		 WHERE A.COMP_CODE       = #{S_COMP_CODE}
		   AND A.DIV_CODE        = #{DIV_CODE}
		   AND A.PROD_ITEM_CODE  = #{PROD_ITEM_CODE}
		   AND A.CHILD_ITEM_CODE = #{CHILD_ITEM_CODE}
<!-- 20190718 주석처리
		   AND (
		       ({StPathY} = 'Y' AND (A.path_code = '0' OR A.path_code LIKE '1%'))
		    OR ({StPathY} = 'N' AND  A.path_code = A.path_code)
		       )
-->
	       <if test="ITEM_SEARCH == &quot;C&quot;">

			   AND A.START_DATE     = (
	                                         SELECT MAX(START_DATE)
	                                           FROM BPR500T WITH(NOLOCK)
	                                          WHERE COMP_CODE        = #{S_COMP_CODE}
	                                            AND DIV_CODE         = #{DIV_CODE}
	                                            AND PROD_ITEM_CODE   = A.PROD_ITEM_CODE
	                                            AND CHILD_ITEM_CODE  = A.CHILD_ITEM_CODE
	                                            AND PATH_CODE        = A.PATH_CODE
	                                            AND START_DATE      &lt;= CONVERT(VARCHAR(8), GETDATE(), 112)
	                                         )
			   AND (
	                  A.STOP_DATE       &gt;= CONVERT(VARCHAR(8), GETDATE(), 112)
	              OR  A.STOP_DATE       IS NULL
	                  )
			</if>
		 ORDER BY A.SEQ
	 </select>

	<select id="bpr581skrvServiceImpl.chekCompCode" parameterType="Map" resultType="rMap">
		/* UBpr01Krv.CBpr501UKr[fnBpr501QStd] Query03 */
        DECLARE     @COMP_CODE  NVARCHAR(08)

        SET @COMP_CODE  = {S_COMP_CODE}

        SELECT SUB_CODE
          FROM BSA100T WITH(NOLOCK)
         WHERE COMP_CODE = @COMP_CODE
           AND MAIN_CODE = 'B082'
           AND (
               REF_CODE1 = 'Y'
            OR REF_CODE1 = 'y'
               )
	</select>
</mapper>