<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wkordininfoskrvServiceImpl">

<select id="wkordininfoskrvServiceImpl.selectList" parameterType="Map" resultType="rMap">
 
SELECT * FROM 
(
SELECT 
    ROW_NUMBER()OVER(PARTITION BY B.COMP_CODE, B.DIV_CODE, B.WKORD_NUM, B.PROG_WORK_CODE ORDER BY A.INSERT_DB_TIME DESC )  AS RN
	,B.COMP_CODE
	,B.DIV_CODE
	,B.WKORD_NUM
	,B.ITEM_CODE AS ITEM_CODE
	,R1.ITEM_NAME AS ITEM_NAME
	,B.WKORD_Q
	,B.PROG_WORK_CODE
	,B.CAVIT_BASE_Q
	,A.SHOT_Q		AS SHOT_Q
	,B.CAVIT_BASE_Q * A.SHOT_Q AS PASS_Q
	,B.CAVIT_BASE_Q * A.SHOT_Q - A.BAD_WORK_Q AS GOOD_WORK_Q
	,A.BAD_WORK_Q	AS BAD_WORK_Q
	,A.INSERT_DB_TIME
	,C.IP
	,C.STATUS
	
  FROM WKORDIN A WITH(NOLOCK)
INNER JOIN PMP100T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								 AND B.DIV_CODE = A.DIV_CODE
								 AND B.WKORD_NUM = A.WKORD_NUM
								 AND B.PROG_WORK_CODE = A.PROG_WORK_CODE
LEFT JOIN BPR100T R1 WITH(NOLOCK) ON R1.COMP_CODE = B.COMP_CODE
								 AND R1.ITEM_CODE = B.ITEM_CODE
INNER JOIN WKORDSTS C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
								  AND C.DIV_CODE = A.DIV_CODE
								  AND C.PROG_WORK_CODE = A.PROG_WORK_CODE

WHERE A.COMP_CODE = #{S_COMP_CODE}
<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
  AND A.DIV_CODE = #{DIV_CODE}
</if>
<if test="@foren.Ognl@isNotEmpty(WKORD_NUM)">
  AND B.WKORD_NUM = #{WKORD_NUM}
</if>
) T 
WHERE T.RN = 1

  ORDER BY T.COMP_CODE, T.DIV_CODE, T.WKORD_NUM, T.PROG_WORK_CODE  
   
</select>   
</mapper>