<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mro110skrvServiceImpl">
   
    <select id="mro110skrvServiceImpl.selectDetailList" parameterType="Map" resultType="rMap">
        /* mro110skrvServiceImpl.selectDetailList */
        BEGIN
		   SET NOCOUNT ON
	       SET ARITHABORT ON
	       
			IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE id=object_id('tempdb..#TMP_MRO110skrv'))
	        BEGIN DROP TABLE #TMP_MRO110skrv END
	
			CREATE TABLE #TMP_MRO110skrv(
			    SORT_KEY	NVARCHAR(08),
			    PARTS		NVARCHAR(08),
			    ITEM_MAKER	NVARCHAR(08),
			    ITEM_CODE	NVARCHAR(50),
			    ITEM_NAME	NVARCHAR(200),
			    SPEC		NVARCHAR(200),
			    SUM_REQ_Q  	NUMERIC(30,6),
			    SUM_REQ_P  	NUMERIC(30,6),
			    SUM_REQ_O  	NUMERIC(30,6),
				REQ_Q01	   	NUMERIC(30,6),
				REQ_P01	   	NUMERIC(30,6),
				REQ_O01	   	NUMERIC(30,6),
				REQ_Q02	   	NUMERIC(30,6),
				REQ_P02	   	NUMERIC(30,6),
				REQ_O02	   	NUMERIC(30,6),
				REQ_Q03	   	NUMERIC(30,6),
				REQ_P03	   	NUMERIC(30,6),
				REQ_O03	   	NUMERIC(30,6),
				REQ_Q04	   	NUMERIC(30,6),
				REQ_P04	   	NUMERIC(30,6),
				REQ_O04	   	NUMERIC(30,6),
				REQ_Q05	   	NUMERIC(30,6),
				REQ_P05	   	NUMERIC(30,6),
				REQ_O05		NUMERIC(30,6),
				REQ_Q06		NUMERIC(30,6),
				REQ_P06		NUMERIC(30,6),
				REQ_O06		NUMERIC(30,6),
				REQ_Q07		NUMERIC(30,6),
				REQ_P07		NUMERIC(30,6),
				REQ_O07		NUMERIC(30,6),
				REQ_Q08		NUMERIC(30,6),
				REQ_P08		NUMERIC(30,6),
				REQ_O08		NUMERIC(30,6),
				REQ_Q09		NUMERIC(30,6),
				REQ_P09		NUMERIC(30,6),
				REQ_O09		NUMERIC(30,6),
				REQ_Q10		NUMERIC(30,6),
				REQ_P10		NUMERIC(30,6),
				REQ_O10		NUMERIC(30,6),
				REQ_Q11		NUMERIC(30,6),
				REQ_P11		NUMERIC(30,6),
				REQ_O11		NUMERIC(30,6),
				REQ_Q12		NUMERIC(30,6),
				REQ_P12		NUMERIC(30,6),
				REQ_O12		NUMERIC(30,6),   
		   )
		   
			 INSERT INTO uniLITE.#TMP_MRO110skrv
			 (
					SORT_KEY	
					,PARTS		
					,ITEM_MAKER	
					,ITEM_CODE	
					,ITEM_NAME	
					,SPEC		
					,SUM_REQ_Q  	
					,SUM_REQ_P  	
					,SUM_REQ_O  	
					,REQ_Q01	   	
					,REQ_P01	   	
					,REQ_O01	   	
					,REQ_Q02	   	
					,REQ_P02	   	
					,REQ_O02	   	
					,REQ_Q03	   	
					,REQ_P03	   	
					,REQ_O03	   	
					,REQ_Q04	   	
					,REQ_P04	   	
					,REQ_O04	   	
					,REQ_Q05	   	
					,REQ_P05	   	
					,REQ_O05		
					,REQ_Q06		
					,REQ_P06		
					,REQ_O06		
					,REQ_Q07		
					,REQ_P07		
					,REQ_O07		
					,REQ_Q08		
					,REQ_P08		
					,REQ_O08		
					,REQ_Q09		
					,REQ_P09		
					,REQ_O09		
					,REQ_Q10		
					,REQ_P10		
					,REQ_O10		
					,REQ_Q11		
					,REQ_P11		
					,REQ_O11		
					,REQ_Q12		
					,REQ_P12		
					,REQ_O12		
				)
			 SELECT  SORT_KEY
					 , PARTS
					 , CASE WHEN ITEM_MAKER = 'B' THEN '볼트류' 
							WHEN ITEM_MAKER = 'E' THEN '전선류' 
							ELSE 'X' END ITEM_MAKER
					 , ITEM_CODE
					 , ITEM_NAME
					 , SPEC
					 , SUM(REQ_Q01)+SUM(REQ_Q02)+SUM(REQ_Q03)+SUM(REQ_Q04)+SUM(REQ_Q05)+SUM(REQ_Q06)+SUM(REQ_Q07)+SUM(REQ_Q08)+SUM(REQ_Q09)+SUM(REQ_Q10)+SUM(REQ_Q11)+SUM(REQ_Q12) SUM_REQ_Q
					 , 0 SUM_REQ_P
					 , SUM(REQ_O01)+SUM(REQ_O02)+SUM(REQ_O03)+SUM(REQ_O04)+SUM(REQ_O05)+SUM(REQ_O06)+SUM(REQ_O07)+SUM(REQ_O08)+SUM(REQ_O09)+SUM(REQ_O10)+SUM(REQ_O11)+SUM(REQ_O12) SUM_REQ_O
					 
						,SUM(REQ_Q01) REQ_Q01,   MAX(REQ_P01) REQ_P01,   SUM(REQ_O01) REQ_O01,
						SUM(REQ_Q02) REQ_Q02,   MAX(REQ_P02) REQ_P02,   SUM(REQ_O02) REQ_O02,
						SUM(REQ_Q03) REQ_Q03,   MAX(REQ_P03) REQ_P03,   SUM(REQ_O03) REQ_O03,
						SUM(REQ_Q04) REQ_Q04,   MAX(REQ_P04) REQ_P04,   SUM(REQ_O04) REQ_O04,
						SUM(REQ_Q05) REQ_Q05,   MAX(REQ_P05) REQ_P05,   SUM(REQ_O05) REQ_O05,
						SUM(REQ_Q06) REQ_Q06,   MAX(REQ_P06) REQ_P06,   SUM(REQ_O06) REQ_O06,
						SUM(REQ_Q07) REQ_Q07,   MAX(REQ_P07) REQ_P07,   SUM(REQ_O07) REQ_O07,
						SUM(REQ_Q08) REQ_Q08,   MAX(REQ_P08) REQ_P08,   SUM(REQ_O08) REQ_O08,
						SUM(REQ_Q09) REQ_Q09,   MAX(REQ_P09) REQ_P09,   SUM(REQ_O09) REQ_O09,
						SUM(REQ_Q10) REQ_Q10,   MAX(REQ_P10) REQ_P10,   SUM(REQ_O10) REQ_O10,
						SUM(REQ_Q11) REQ_Q11,   MAX(REQ_P11) REQ_P11,   SUM(REQ_O11) REQ_O11,
						SUM(REQ_Q12) REQ_Q12,   MAX(REQ_P12) REQ_P12,   SUM(REQ_O12) REQ_O12
				From
				(
					SELECT  '소모자재' PARTS
							, '4' SORT_KEY
							,SUBSTRING(REQ_YYYYMM,1,4) REQ_YYYYMM
							, DIV_CODE
							, A.COMP_CODE
							,(SELECT ITEM_MAKER FROM BPR100T WHERE ITEM_CODE = A.ITEM_CODE) ITEM_MAKER
							, ITEM_CODE
							,(SELECT ITEM_NAME FROM BPR100T WHERE ITEM_CODE=A.ITEM_CODE) ITEM_NAME
							,(SELECT SPEC FROM BPR100T WHERE ITEM_CODE=A.ITEM_CODE) SPEC,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_Q  ELSE 0   END ) REQ_Q01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_P  ELSE 0   END ) REQ_P01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_O  ELSE 0   END ) REQ_O01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_Q  ELSE 0   END ) REQ_Q02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_P  ELSE 0   END ) REQ_P02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_O  ELSE 0   END ) REQ_O02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_Q  ELSE 0   END ) REQ_Q03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_P  ELSE 0   END ) REQ_P03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_O  ELSE 0   END ) REQ_O03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_Q  ELSE 0   END ) REQ_Q04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_P  ELSE 0   END ) REQ_P04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_O  ELSE 0   END ) REQ_O04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_Q  ELSE 0   END ) REQ_Q05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_P  ELSE 0   END ) REQ_P05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_O  ELSE 0   END ) REQ_O05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_Q  ELSE 0   END ) REQ_Q06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_P  ELSE 0   END ) REQ_P06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_O  ELSE 0   END ) REQ_O06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_Q  ELSE 0   END ) REQ_Q07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_P  ELSE 0   END ) REQ_P07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_O  ELSE 0   END ) REQ_O07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_Q  ELSE 0   END ) REQ_Q08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_P  ELSE 0   END ) REQ_P08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_O  ELSE 0   END ) REQ_O08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_Q  ELSE 0   END ) REQ_Q09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_P  ELSE 0   END ) REQ_P09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_O  ELSE 0   END ) REQ_O09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_Q  ELSE 0   END ) REQ_Q10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_P  ELSE 0   END ) REQ_P10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_O  ELSE 0   END ) REQ_O10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_Q  ELSE 0   END ) REQ_Q11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_P  ELSE 0   END ) REQ_P11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_O  ELSE 0   END ) REQ_O11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_Q  ELSE 0   END ) REQ_Q12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_P  ELSE 0   END ) REQ_P12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_O  ELSE 0   END ) REQ_O12,
							REMARK, UPDATE_DB_USER, UPDATE_DB_TIME,
							SUBSTRING(REQ_YYYYMM,5,2) USE_MONTH
					From uniLITE.MRO200T A
					WHERE ITEM_CODE != 'TTTTTTTTTTTTT'
					Union All
					SELECT 
						'소모공구' PARTS
						, '3' SORT_KEY
						, SUBSTRING(REQ_YYYYMM,1,4) REQ_YYYYMM
						, DIV_CODE
						, A.COMP_CODE
						,'' ITEM_MAKER
						, A.TREE_CODE ITEM_CODE
						, B.TREE_NAME ITEM_NAME
						, B.SPEC,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_Q  ELSE 0   END ) REQ_Q01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_P  ELSE 0   END ) REQ_P01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_O  ELSE 0   END ) REQ_O01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_Q  ELSE 0   END ) REQ_Q02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_P  ELSE 0   END ) REQ_P02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_O  ELSE 0   END ) REQ_O02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_Q  ELSE 0   END ) REQ_Q03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_P  ELSE 0   END ) REQ_P03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_O  ELSE 0   END ) REQ_O03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_Q  ELSE 0   END ) REQ_Q04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_P  ELSE 0   END ) REQ_P04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_O  ELSE 0   END ) REQ_O04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_Q  ELSE 0   END ) REQ_Q05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_P  ELSE 0   END ) REQ_P05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_O  ELSE 0   END ) REQ_O05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_Q  ELSE 0   END ) REQ_Q06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_P  ELSE 0   END ) REQ_P06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_O  ELSE 0   END ) REQ_O06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_Q  ELSE 0   END ) REQ_Q07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_P  ELSE 0   END ) REQ_P07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_O  ELSE 0   END ) REQ_O07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_Q  ELSE 0   END ) REQ_Q08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_P  ELSE 0   END ) REQ_P08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_O  ELSE 0   END ) REQ_O08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_Q  ELSE 0   END ) REQ_Q09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_P  ELSE 0   END ) REQ_P09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_O  ELSE 0   END ) REQ_O09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_Q  ELSE 0   END ) REQ_Q10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_P  ELSE 0   END ) REQ_P10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_O  ELSE 0   END ) REQ_O10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_Q  ELSE 0   END ) REQ_Q11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_P  ELSE 0   END ) REQ_P11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_O  ELSE 0   END ) REQ_O11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_Q  ELSE 0   END ) REQ_Q12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_P  ELSE 0   END ) REQ_P12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_O  ELSE 0   END ) REQ_O12,
							A.REMARK, A.UPDATE_DB_USER, A.UPDATE_DB_TIME,
							SUBSTRING(REQ_YYYYMM,5,2) USE_MONTH
					FROM MRO100T A
					LEFT JOIN uniLITE.MRO010T B
						ON A.COMP_CODE=B.COMP_CODE
						AND A.TREE_CODE=B.TREE_CODE
					WHERE A.TREE_CODE != 'TTTTTTTTTTTTTT'
					AND SUBSTRING(A.TREE_CODE, 1,1)  != 'X'  AND  SUBSTRING(A.TREE_CODE, 1,1) != 'Z'
					Union All
					SELECT  
						'소모품' PARTS
						, '2' SORT_KEY
						, SUBSTRING(REQ_YYYYMM,1,4) REQ_YYYYMM
						, DIV_CODE
						, A.COMP_CODE
						, '' ITEM_MAKER
						, A.TREE_CODE ITEM_CODE
						, B.TREE_NAME ITEM_NAME
						, B.SPEC,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_Q  ELSE 0   END ) REQ_Q01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_P  ELSE 0   END ) REQ_P01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_O  ELSE 0   END ) REQ_O01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_Q  ELSE 0   END ) REQ_Q02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_P  ELSE 0   END ) REQ_P02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_O  ELSE 0   END ) REQ_O02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_Q  ELSE 0   END ) REQ_Q03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_P  ELSE 0   END ) REQ_P03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_O  ELSE 0   END ) REQ_O03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_Q  ELSE 0   END ) REQ_Q04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_P  ELSE 0   END ) REQ_P04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_O  ELSE 0   END ) REQ_O04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_Q  ELSE 0   END ) REQ_Q05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_P  ELSE 0   END ) REQ_P05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_O  ELSE 0   END ) REQ_O05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_Q  ELSE 0   END ) REQ_Q06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_P  ELSE 0   END ) REQ_P06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_O  ELSE 0   END ) REQ_O06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_Q  ELSE 0   END ) REQ_Q07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_P  ELSE 0   END ) REQ_P07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_O  ELSE 0   END ) REQ_O07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_Q  ELSE 0   END ) REQ_Q08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_P  ELSE 0   END ) REQ_P08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_O  ELSE 0   END ) REQ_O08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_Q  ELSE 0   END ) REQ_Q09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_P  ELSE 0   END ) REQ_P09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_O  ELSE 0   END ) REQ_O09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_Q  ELSE 0   END ) REQ_Q10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_P  ELSE 0   END ) REQ_P10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_O  ELSE 0   END ) REQ_O10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_Q  ELSE 0   END ) REQ_Q11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_P  ELSE 0   END ) REQ_P11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_O  ELSE 0   END ) REQ_O11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_Q  ELSE 0   END ) REQ_Q12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_P  ELSE 0   END ) REQ_P12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_O  ELSE 0   END ) REQ_O12,
							A.REMARK, A.UPDATE_DB_USER, A.UPDATE_DB_TIME,
							SUBSTRING(REQ_YYYYMM,5,2) USE_MONTH
					FROM MRO100T A
					LEFT JOIN uniLITE.MRO010T B
						ON A.COMP_CODE=B.COMP_CODE
						AND A.TREE_CODE=B.TREE_CODE
					WHERE A.TREE_CODE != 'TTTTTTTTTTTTTT'
					AND SUBSTRING(A.TREE_CODE, 1,1)  = 'Z'
					Union All
					SELECT  
						'포장류' PARTS
						, '1' SORK_KEY
						, SUBSTRING(REQ_YYYYMM,1,4) REQ_YYYYMM
						, DIV_CODE
						, A.COMP_CODE
						, '' ITEM_MAKER
						, A.TREE_CODE ITEM_CODE
						, B.TREE_NAME ITEM_NAME
						, B.SPEC,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_Q  ELSE 0   END ) REQ_Q01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_P  ELSE 0   END ) REQ_P01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '01' THEN REQ_O  ELSE 0   END ) REQ_O01,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_Q  ELSE 0   END ) REQ_Q02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_P  ELSE 0   END ) REQ_P02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '02' THEN REQ_O  ELSE 0   END ) REQ_O02,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_Q  ELSE 0   END ) REQ_Q03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_P  ELSE 0   END ) REQ_P03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '03' THEN REQ_O  ELSE 0   END ) REQ_O03,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_Q  ELSE 0   END ) REQ_Q04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_P  ELSE 0   END ) REQ_P04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '04' THEN REQ_O  ELSE 0   END ) REQ_O04,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_Q  ELSE 0   END ) REQ_Q05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_P  ELSE 0   END ) REQ_P05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '05' THEN REQ_O  ELSE 0   END ) REQ_O05,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_Q  ELSE 0   END ) REQ_Q06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_P  ELSE 0   END ) REQ_P06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '06' THEN REQ_O  ELSE 0   END ) REQ_O06,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_Q  ELSE 0   END ) REQ_Q07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_P  ELSE 0   END ) REQ_P07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '07' THEN REQ_O  ELSE 0   END ) REQ_O07,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_Q  ELSE 0   END ) REQ_Q08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_P  ELSE 0   END ) REQ_P08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '08' THEN REQ_O  ELSE 0   END ) REQ_O08,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_Q  ELSE 0   END ) REQ_Q09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_P  ELSE 0   END ) REQ_P09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '09' THEN REQ_O  ELSE 0   END ) REQ_O09,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_Q  ELSE 0   END ) REQ_Q10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_P  ELSE 0   END ) REQ_P10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '10' THEN REQ_O  ELSE 0   END ) REQ_O10,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_Q  ELSE 0   END ) REQ_Q11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_P  ELSE 0   END ) REQ_P11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '11' THEN REQ_O  ELSE 0   END ) REQ_O11,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_Q  ELSE 0   END ) REQ_Q12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_P  ELSE 0   END ) REQ_P12,
							(CASE SUBSTRING(REQ_YYYYMM,5,2)   WHEN '12' THEN REQ_O  ELSE 0   END ) REQ_O12,
							A.REMARK, A.UPDATE_DB_USER, A.UPDATE_DB_TIME,
							SUBSTRING(REQ_YYYYMM,5,2) USE_MONTH
					FROM MRO100T A
					LEFT JOIN uniLITE.MRO010T B
						ON A.COMP_CODE=B.COMP_CODE
						AND A.TREE_CODE=B.TREE_CODE
					WHERE A.TREE_CODE != 'TTTTTTTTTTTTTT'
					AND SUBSTRING(A.TREE_CODE, 1,1)  = 'X'
				)AA
				WHERE REQ_YYYYMM = #{REQ_YYYY}
				  AND DIV_CODE=#{DIV_CODE}
				  AND COMP_CODE=#{S_COMP_CODE}
				GROUP BY SORT_KEY, PARTS, REQ_YYYYMM, ITEM_MAKER,ITEM_CODE, ITEM_NAME, SPEC
				ORDER BY SORT_KEY, PARTS, ITEM_MAKER, ITEM_CODE
				
				
				---查询语句
				SELECT	
						 SORT_KEY,
						 GROUP_FLG,
						 SORT_KEY_DETAIL,
						 PARTS	AS GROUP1,
						 ITEM_MAKER	AS GROUP2,	
						 ITEM_CODE,
						 ITEM_NAME,
						 SPEC,
						 SUM_REQ_Q,
						 SUM_REQ_P,
						 SUM_REQ_O,	
						 REQ_Q01,
						 REQ_P01,
						 REQ_O01,
						 REQ_Q02,
						 REQ_P02,
						 REQ_O02,
						 REQ_Q03,
						 REQ_P03,
						 REQ_O03,
						 REQ_Q04,
						 REQ_P04,
						 REQ_O04,
						 REQ_Q05,
						 REQ_P05,
						 REQ_O05,
						 REQ_Q06,
						 REQ_P06,
						 REQ_O06,
						 REQ_Q07,
						 REQ_P07,
						 REQ_O07,
						 REQ_Q08,
						 REQ_P08,
						 REQ_O08,
						 REQ_Q09,
						 REQ_P09,
						 REQ_O09,
						 REQ_Q10,
						 REQ_P10,
						 REQ_O10,
						 REQ_Q11,
						 REQ_P11,
						 REQ_O11,
						 REQ_Q12,
						 REQ_P12,
						 REQ_O12
			FROM (
						SELECT 
						 0 AS GROUP_FLG,
						 0 AS SORT_KEY,
						 0 AS SORT_KEY_DETAIL,
						 N'계정계' AS PARTS,
						 '' ITEM_MAKER,	
						 '' ITEM_CODE,
						 '' ITEM_NAME,
						 '' SPEC,
						 0 SUM_REQ_Q,
						 0 SUM_REQ_P,
						 SUM(SUM_REQ_O) AS SUM_REQ_O,	
						 0 REQ_Q01,
						 0 REQ_P01,
						 SUM(REQ_O01) AS REQ_O01,
						 0 REQ_Q02,
						 0 REQ_P02,
						 SUM(REQ_O02) as REQ_O02,
						 0 REQ_Q03,
						 0 REQ_P03,
						 SUM(REQ_O03) as REQ_O03,
						 0 REQ_Q04,
						 0 REQ_P04,
						 SUM(REQ_O04) as REQ_O04,
						 0 REQ_Q05,
						 0 REQ_P05,
						 SUM(REQ_O05) as REQ_O05,
						 0 REQ_Q06,
						 0 REQ_P06,
						 SUM(REQ_O06) as REQ_O06,
						 0 REQ_Q07,
						 0 REQ_P07,
						 SUM(REQ_O07) as REQ_O07,
						 0 REQ_Q08,
						 0 REQ_P08,
						 SUM(REQ_O08) as REQ_O08,
						 0 REQ_Q09,
						 0 REQ_P09,
						 SUM(REQ_O09) as REQ_O09,
						 0 REQ_Q10,
						 0 REQ_P10,
						 SUM(REQ_O10) as REQ_O10,
						 0 REQ_Q11,
						 0 REQ_P11,
						 SUM(REQ_O11) as REQ_O11,
						 0 REQ_Q12,
						 0 REQ_P12,
						 SUM(REQ_O12) AS REQ_O12
						 FROM #TMP_MRO110skrv
						UNION ALL
						SELECT 
						 1 AS GROUP_FLG,
						 SORT_KEY,
						 CASE WHEN PARTS + ITEM_MAKER  =N'포장류X'   THEN '1'
                                      WHEN PARTS + ITEM_MAKER  =N'소모품X'   THEN '2'
                                      WHEN PARTS + ITEM_MAKER =N'소모공구X' THEN '3'
                                      WHEN PARTS + ITEM_MAKER  =N'소모자재X' THEN '4'
                                      WHEN PARTS + ITEM_MAKER = N'소모자재볼트류' THEN '31'
                                       WHEN PARTS + ITEM_MAKER = N'소모자재전선류'  THEN '32'
                                       END  AS SORT_KEY_DETAIL,
						 PARTS,
						 ITEM_MAKER,	
						 ITEM_CODE,
						 ITEM_NAME,
						 SPEC,
						 SUM_REQ_Q,
						 SUM_REQ_P,
						 SUM_REQ_O,	
						 REQ_Q01,
						 REQ_P01,
						 REQ_O01,
						 REQ_Q02,
						 REQ_P02,
						 REQ_O02,
						 REQ_Q03,
						 REQ_P03,
						 REQ_O03,
						 REQ_Q04,
						 REQ_P04,
						 REQ_O04,
						 REQ_Q05,
						 REQ_P05,
						 REQ_O05,
						 REQ_Q06,
						 REQ_P06,
						 REQ_O06,
						 REQ_Q07,
						 REQ_P07,
						 REQ_O07,
						 REQ_Q08,
						 REQ_P08,
						 REQ_O08,
						 REQ_Q09,
						 REQ_P09,
						 REQ_O09,
						 REQ_Q10,
						 REQ_P10,
						 REQ_O10,
						 REQ_Q11,
						 REQ_P11,
						 REQ_O11,
						 REQ_Q12,
						 REQ_P12,
						 REQ_O12
						 FROM #TMP_MRO110skrv
						UNION ALL
						SELECT 
								2 AS GROUP_FLG,
								 CASE WHEN PARTS =N'포장류'   THEN '1'
									  WHEN PARTS =N'소모품'   THEN '2'
									  WHEN PARTS =N'소모공구' THEN '3'
									  WHEN PARTS =N'소모자재' THEN '4'
									  END  AS SORT_KEY,
									   CASE WHEN PARTS + ITEM_MAKER  =N'포장류X'   THEN '1'
                                      WHEN PARTS + ITEM_MAKER  =N'소모품X'   THEN '2'
                                      WHEN PARTS + ITEM_MAKER =N'소모공구X' THEN '3'
                                      WHEN PARTS + ITEM_MAKER  =N'소모자재X' THEN '4'
                                      WHEN PARTS + ITEM_MAKER = N'소모자재볼트류' THEN '31'
                                       WHEN PARTS + ITEM_MAKER = N'소모자재전선류'  THEN '32'
                                       END  AS SORT_KEY_DETAIL
								,'' AS PARTS
								,'구분계' AS ITEM_MAKER
								,'' AS ITEM_CODE
								,'' AS ITEM_NAME
								,'' AS SPEC
								,0	AS 	SUM_REQ_Q
								,0	AS  SUM_REQ_P
								,SUM(SUM_REQ_O)	AS SUM_REQ_O
								 ,0 AS REQ_Q01
								 ,0 AS REQ_P01
								 ,SUM(REQ_O01) AS REQ_O01
								 ,0 AS REQ_Q02
								 ,0 AS REQ_P02
								 ,SUM(REQ_O02) AS REQ_O02
								 ,0 AS REQ_Q03
								 ,0 AS REQ_P03
								 ,SUM(REQ_O03) AS REQ_O03
								 ,0 AS REQ_Q04
								 ,0 AS REQ_P04
								 ,SUM(REQ_O04) AS REQ_O04
								 ,0 AS REQ_Q05
								 ,0 AS REQ_P05
								 ,SUM(REQ_O05) AS REQ_O05
								 ,0 AS REQ_Q06
								 ,0 AS REQ_P06
								 ,SUM(REQ_O06) AS REQ_O06
								 ,0 AS REQ_Q07
								 ,0 AS REQ_P07
								 ,SUM(REQ_O07) AS REQ_O07
								 ,0 AS REQ_Q08
								 ,0 AS REQ_P08
								 ,SUM(REQ_O08) AS REQ_O08
								 ,0 AS REQ_Q09
								 ,0 AS REQ_P09
								 ,SUM(REQ_O09) AS REQ_O09
								 ,0 AS REQ_Q10
								 ,0 AS REQ_P10
								 ,SUM(REQ_O10) AS REQ_O10
								 ,0 AS REQ_Q11
								 ,0 AS REQ_P11
								 ,SUM(REQ_O11) AS REQ_O11
								 ,0 AS REQ_Q12
								 ,0 AS REQ_P12
								 ,SUM(REQ_O12) AS REQ_O12
						FROM uniLITE.#TMP_MRO110skrv
						GROUP BY PARTS,ITEM_MAKER	
						
						UNION ALL
						SELECT 
								3 AS GROUP_FLG,
								CASE WHEN PARTS =N'포장류'   THEN '1'
									  WHEN PARTS =N'소모품'   THEN '2'
									  WHEN PARTS =N'소모공구' THEN '3'
									  WHEN PARTS =N'소모자재' THEN '4'
									  END  AS SORT_KEY,
									  CASE WHEN PARTS =N'포장류'   THEN '1'
                                      WHEN PARTS =N'소모품'   THEN '2'
                                      WHEN PARTS =N'소모공구' THEN '3'
                                      WHEN PARTS =N'소모자재' THEN '4'
                                      END  AS  SORT_KEY_DETAIL
								,'구분계' AS PARTS
								,'' AS ITEM_MAKER
								,'' AS ITEM_CODE
								,'' AS ITEM_NAME
								,'' AS SPEC
								,0	AS 	SUM_REQ_Q
								,0	AS  SUM_REQ_P
								,SUM(SUM_REQ_O)	AS SUM_REQ_O
								 ,0 AS REQ_Q01
								 ,0 AS REQ_P01
								 ,SUM(REQ_O01) AS REQ_O01
								 ,0 AS REQ_Q02
								 ,0 AS REQ_P02
								 ,SUM(REQ_O02) AS REQ_O02
								 ,0 AS REQ_Q03
								 ,0 AS REQ_P03
								 ,SUM(REQ_O03) AS REQ_O03
								 ,0 AS REQ_Q04
								 ,0 AS REQ_P04
								 ,SUM(REQ_O04) AS REQ_O04
								 ,0 AS REQ_Q05
								 ,0 AS REQ_P05
								 ,SUM(REQ_O05) AS REQ_O05
								 ,0 AS REQ_Q06
								 ,0 AS REQ_P06
								 ,SUM(REQ_O06) AS REQ_O06
								 ,0 AS REQ_Q07
								 ,0 AS REQ_P07
								 ,SUM(REQ_O07) AS REQ_O07
								 ,0 AS REQ_Q08
								 ,0 AS REQ_P08
								 ,SUM(REQ_O08) AS REQ_O08
								 ,0 AS REQ_Q09
								 ,0 AS REQ_P09
								 ,SUM(REQ_O09) AS REQ_O09
								 ,0 AS REQ_Q10
								 ,0 AS REQ_P10
								 ,SUM(REQ_O10) AS REQ_O10
								 ,0 AS REQ_Q11
								 ,0 AS REQ_P11
								 ,SUM(REQ_O11) AS REQ_O11
								 ,0 AS REQ_Q12
								 ,0 AS REQ_P12
								 ,SUM(REQ_O12) AS REQ_O12
						FROM uniLITE.#TMP_MRO110skrv
						GROUP BY PARTS
						
					
						
				  )	A
			
				
		ORDER BY SORT_KEY,CONVERT(VARCHAR(2),SORT_KEY_DETAIL),GROUP_FLG		
		
		SET NOCOUNT OFF
		SET ARITHABORT OFF
	END				
    </select>
    
    
    
</mapper>