<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hpb500ukrServiceImpl">
	<select id="hpb500ukrServiceImpl.getHometaxId" parameterType="rMap" resultType="rMap">
        /* hpb500ukrServiceImpl.getHomeTaxId */
        SELECT ISNULL(HOMETAX_ID, '') AS HOMETAX_ID
          FROM BOR120T
         WHERE COMP_CODE = #{S_COMP_CODE}
           AND DIV_CODE = #{S_DIV_CODE}
    </select>
	<select id="hpb500ukrServiceImpl.getSelectResidentBusinessA" parameterType="rMap" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb500Save] Query01
    /*************************************************************************************************************
     거주자 사업소득 신고 (A 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CONVERT(CHAR(30), CASE WHEN C1.DIV_FULL_NAME != '' THEN C1.DIV_FULL_NAME
                                      ELSE C1.DIV_NAME
                                 END)                                                   AS DIV_NAME
             , CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, ''))              AS REPRE_NO
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                             AS REPRE_NAME
             , CONVERT(CHAR(15), ISNULL(C1.TELEPHON  , ''))                             AS TELEPHON
             , C.SECT_CNT                                                               AS CNT
             , CONVERT(CHAR(25), '')                                                    AS A_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN (-- 사업장별 그룹갯수 조회
                          SELECT S1.COMP_CODE, COUNT(DISTINCT S1.SECT_CODE) AS SECT_CNT
                          FROM              HPB100T   S1 WITH (NOLOCK)
                                 INNER JOIN HPB200T   S2 WITH (NOLOCK) ON S2.COMP_CODE    = S1.COMP_CODE
                                                                      AND S2.PERSON_NUMB  = S1.PERSON_NUMB
                                                                      AND S2.DED_TYPE     = S1.DED_TYPE
                          WHERE  S1.COMP_CODE       = @COMP_CODE
                          AND    S2.SECT_CODE       = @DIV_CODE
                          AND    S1.DWELLING_YN     = '1'
                          AND    S2.SUPP_DATE   LIKE @PAY_YYYY + '%'
                          AND    S2.DED_TYPE        = '1'
                          GROUP  BY S1.COMP_CODE
                          ) C                        ON C.COMP_CODE     = A.COMP_CODE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '1'               --거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE           = '1'               --사업소득
    --
        GROUP  BY
               C1.SAFFER_TAX, C1.COMPANY_NUM, C1.DIV_FULL_NAME, C1.DIV_NAME, CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, '')), C1.REPRE_NAME, C1.TELEPHON
             , C.SECT_CNT
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectResidentBusinessB" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb500Save] Query02
    /*************************************************************************************************************
     거주자 사업소득 신고 (B 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CONVERT(CHAR(30), CASE WHEN C1.DIV_FULL_NAME != '' THEN C1.DIV_FULL_NAME
                                      ELSE C1.DIV_NAME
                                 END)                                                   AS DIV_NAME
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                             AS REPRE_NAME
             , unilite.fnCipherDecrypt(C1.REPRE_NO, '')                                 AS REPRE_NO
             , COUNT(DISTINCT unilite.fnCipherDecrypt(A.REPRE_NUM,''))                  AS PERSON_CNT
             , COUNT(A.PERSON_NUMB)                                                     AS SUPP_CNT
             , CASE WHEN SUM(B.PAY_AMOUNT_I) &gt; 0 THEN SUM(B.PAY_AMOUNT_I) ELSE 0 END    AS PAY_AMOUNT_I
             , CASE WHEN SUM(B.IN_TAX_I)     &gt; 0 THEN SUM(B.IN_TAX_I)     ELSE 0 END    AS IN_TAX_I
             , CASE WHEN SUM(B.LOCAL_TAX_I)  &gt; 0 THEN SUM(B.LOCAL_TAX_I)  ELSE 0 END    AS LOCAL_TAX_I
             , CASE WHEN SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) &lt;=0 THEN 0
                    ELSE SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I)
               END                                                                      AS TOTAL_TAX_I
             , @GUBUN                                                                   AS SUBMIT_CODE
             , CONVERT(CHAR(36), '')                                                    AS B_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '1'               --거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE           = '1'               --사업소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, C1.DIV_FULL_NAME, C1.DIV_NAME, unilite.fnCipherDecrypt(C1.REPRE_NO, ''), C1.REPRE_NAME
        ORDER  BY
               B.SECT_CODE
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectResidentBusinessC" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb500Save] Query03
    /*************************************************************************************************************
     거주자 사업소득 신고 (C 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CASE WHEN A.FOREIGN_YN = '1' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '') ELSE REPLACE(unilite.fnCipherDecrypt(A.FOREIGN_NUM, ''),'-','') END     AS REPRE_NUM
             , A.NAME
             , ISNULL(A.COMP_NUM     , '')                                              AS COMP_NUM
             , ISNULL(A.COMP_KOR_NAME, '')                                              AS COMP_KOR_NAME
             , A.DWELLING_YN
             , A.FOREIGN_YN
             , A.DED_CODE
             , LEFT(B.PAY_YYYYMM, 4)                                                    AS BELONG_YEAR
             , LEFT(B.SUPP_DATE , 4)                                                    AS SUPP_YEAR
             , COUNT(unilite.fnCipherDecrypt(A.REPRE_NUM,''))                           AS SUPP_CNT
             , SUM(B.PAY_AMOUNT_I)                                                      AS PAY_AMOUNT_I
             , B.PERCENT_I
             , SUM(B.IN_TAX_I)                                                          AS IN_TAX_I
             , SUM(B.LOCAL_TAX_I)                                                       AS LOCAL_TAX_I
             , SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I)                                     AS TOTAL_TAX_I
             , CASE WHEN SUM(B.PAY_AMOUNT_I)                  &lt; 0 THEN '1' ELSE '0' END AS PAY_AMOUNT_NV
             , CASE WHEN SUM(B.IN_TAX_I)                      &lt; 0 THEN '1' ELSE '0' END AS IN_TAX_NV
             , CASE WHEN SUM(B.LOCAL_TAX_I)                   &lt; 0 THEN '1' ELSE '0' END AS LOCAL_TAX_NV
             , CASE WHEN SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) &lt; 0 THEN '1' ELSE '0' END AS TOTAL_TAX_NV
             , CONVERT(CHAR(2), '')                                                     AS C_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '1'               --거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE           = '1'               --사업소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, A.FOREIGN_YN
             , CASE WHEN A.FOREIGN_YN = '1' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '') ELSE REPLACE(unilite.fnCipherDecrypt(A.FOREIGN_NUM, ''),'-','') END
             , A.NAME, A.COMP_NUM, A.COMP_KOR_NAME, A.DWELLING_YN, A.FOREIGN_YN, A.DED_CODE
             , LEFT(B.PAY_YYYYMM, 4), LEFT(B.SUPP_DATE, 4), B.PERCENT_I
        ORDER  BY
               B.SECT_CODE
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectResidentEtcA" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb510Save] Query01
    /*************************************************************************************************************
     거주자 기타소득 신고 (A 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CONVERT(CHAR(30), CASE WHEN C1.DIV_FULL_NAME != '' THEN C1.DIV_FULL_NAME
                                      ELSE C1.DIV_NAME
                                 END)                                                   AS DIV_NAME
             , CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, ''))              AS REPRE_NO
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                             AS REPRE_NAME
             , CONVERT(CHAR(15), ISNULL(C1.TELEPHON  , ''))                             AS TELEPHON
             , C.SECT_CNT                                                               AS CNT
             , CONVERT(CHAR(135), '')                                                   AS A_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN (-- 사업장별 그룹갯수 조회
                          SELECT S1.COMP_CODE, COUNT(DISTINCT S1.SECT_CODE) AS SECT_CNT
                          FROM              HPB100T   S1 WITH (NOLOCK)
                                 INNER JOIN HPB200T   S2 WITH (NOLOCK) ON S2.COMP_CODE    = S1.COMP_CODE
                                                                      AND S2.PERSON_NUMB  = S1.PERSON_NUMB
                                                                      AND S2.DED_TYPE     = S1.DED_TYPE
                          WHERE  S1.COMP_CODE       = @COMP_CODE
                          AND    S2.SECT_CODE       = @DIV_CODE
                          AND    S1.DWELLING_YN     = '1'
                          AND    S2.SUPP_DATE   LIKE @PAY_YYYY + '%'
                          AND    S2.DED_TYPE        = '2'
                          GROUP  BY S1.COMP_CODE
                          ) C                        ON C.COMP_CODE     = A.COMP_CODE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '1'               --거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE           = '2'               --기타소득
    --
        GROUP  BY
               C1.SAFFER_TAX, C1.COMPANY_NUM, C1.DIV_FULL_NAME, C1.DIV_NAME, CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, '')), C1.REPRE_NAME, C1.TELEPHON
             , C.SECT_CNT
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectResidentEtcB" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb510Save] Query02
    /*************************************************************************************************************
     거주자 기타소득 신고 (B 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CONVERT(CHAR(30), CASE WHEN C1.DIV_FULL_NAME != '' THEN C1.DIV_FULL_NAME
                                      ELSE C1.DIV_NAME
                                 END)                                                   AS DIV_NAME
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                             AS REPRE_NAME
             , unilite.fnCipherDecrypt(C1.REPRE_NO, '')                                 AS REPRE_NO
             , COUNT(DISTINCT unilite.fnCipherDecrypt(A.REPRE_NUM, ''))                 AS PERSON_CNT
             , COUNT(A.PERSON_NUMB)                                                     AS SUPP_CNT
             , CASE WHEN SUM(B.PAY_AMOUNT_I) &gt; 0 THEN SUM(B.PAY_AMOUNT_I) ELSE 0 END    AS PAY_AMOUNT_I
             , 0                                                                        AS TAX_EXEMPTION_I
             , CASE WHEN SUM(B.SUPP_TOTAL_I) &gt; 0 THEN SUM(B.SUPP_TOTAL_I) ELSE 0 END    AS SUPP_TOTAL_I
             , CASE WHEN SUM(B.IN_TAX_I)     &gt; 0 THEN SUM(B.IN_TAX_I)     ELSE 0 END    AS IN_TAX_I
             , CASE WHEN SUM(B.LOCAL_TAX_I)  &gt; 0 THEN SUM(B.LOCAL_TAX_I)  ELSE 0 END    AS LOCAL_TAX_I
             , CASE WHEN SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) &lt;=0 THEN 0
                    ELSE SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I)
               END                                                                      AS TOTAL_TAX_I
             , @GUBUN                                                                   AS SUBMIT_CODE
             , CONVERT(CHAR(141), '')                                                   AS B_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '1'               --거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE           = '2'               --기타소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, C1.DIV_FULL_NAME, C1.DIV_NAME, unilite.fnCipherDecrypt(C1.REPRE_NO, ''), C1.REPRE_NAME
        ORDER  BY
               B.SECT_CODE
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectResidentEtcC" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb510Save] Query03
    /*************************************************************************************************************
     거주자 기타소득 신고 (C 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CASE WHEN A.FOREIGN_YN = '1' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '') ELSE REPLACE(unilite.fnCipherDecrypt(A.FOREIGN_NUM, ''),'-','') END     AS REPRE_NUM
             , A.NAME
             , ISNULL(A.COMP_NUM     , '')                                              AS COMP_NUM
             , ISNULL(A.COMP_KOR_NAME, '')                                              AS COMP_KOR_NAME
             , A.DWELLING_YN
             , A.FOREIGN_YN
             , A.DED_CODE
             --, LEFT(B.PAY_YYYYMM, 4)                                                    AS BELONG_YEAR
             , LEFT(B.SUPP_DATE, 4)                                                     AS BELONG_YEAR
             , LEFT(B.SUPP_DATE, 4)                                                     AS SUPP_YEAR
             , COUNT(B.PERSON_NUMB)                                                     AS SUPP_CNT
             , SUM(B.PAY_AMOUNT_I)                                                      AS PAY_AMOUNT_I
             , SUM(B.EXPS_AMOUNT_I)                                                     AS EXPS_AMOUNT_I
             , SUM(B.SUPP_TOTAL_I)                                                      AS SUPP_TOTAL_I
             , 0                                                                        AS TAX_EXEMPTION_I
             , B.PERCENT_I
             , SUM(B.IN_TAX_I)                                                          AS IN_TAX_I
             , SUM(B.LOCAL_TAX_I)                                                       AS LOCAL_TAX_I
             , SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I)                                     AS TOTAL_TAX_I
             , CASE WHEN SUM(B.PAY_AMOUNT_I)                  &lt; 0 THEN '1' ELSE '0' END AS PAY_AMOUNT_NV
             , CASE WHEN SUM(B.EXPS_AMOUNT_I)                 &lt; 0 THEN '1' ELSE '0' END AS EXPS_AMOUNT_NV
             , CASE WHEN SUM(B.SUPP_TOTAL_I)                  &lt; 0 THEN '1' ELSE '0' END AS SUPP_TOTAL_NV
             , 0                                                                        AS TAX_EXEMPTION_NV
             , CASE WHEN SUM(B.IN_TAX_I)                      &lt; 0 THEN '1' ELSE '0' END AS IN_TAX_NV
             , CASE WHEN SUM(B.LOCAL_TAX_I)                   &lt; 0 THEN '1' ELSE '0' END AS LOCAL_TAX_NV
             , CASE WHEN SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) &lt; 0 THEN '1' ELSE '0' END AS TOTAL_TAX_NV
             , CONVERT(CHAR(119), '')                                                   AS C_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    A.DWELLING_YN        = '1'               --거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE           = '2'               --기타소득
        AND    B.SECT_CODE          = @DIV_CODE
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM
             , CASE WHEN A.FOREIGN_YN = '1' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '') ELSE REPLACE(unilite.fnCipherDecrypt(A.FOREIGN_NUM, ''),'-','') END
             , A.NAME, A.COMP_NUM, A.COMP_KOR_NAME, A.DWELLING_YN, A.FOREIGN_YN, A.DED_CODE
             , LEFT(B.SUPP_DATE, 4), B.PERCENT_I, B.PERSON_NUMB
        ORDER  BY
               B.SECT_CODE, B.PERSON_NUMB
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>		
	<select id="hpb500ukrServiceImpl.getSelectNonResidentBusinessEtcA" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb520Save] Query01
    /*************************************************************************************************************
     비거주자 사업/기타소득 신고 (A 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , CONVERT(CHAR(40), CASE WHEN C1.DIV_FULL_NAME != '' THEN C1.DIV_FULL_NAME
                                      ELSE C1.DIV_NAME
                                 END)                                                   AS DIV_NAME
             , CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, ''))              AS REPRE_NO
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                             AS REPRE_NAME
             , CONVERT(CHAR(15), ISNULL(C1.TELEPHON  , ''))                             AS TELEPHON
             , C.SECT_CNT                                                               AS CNT
             , CONVERT(CHAR(185), '')                                                   AS A_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN (-- 사업장별 그룹갯수 조회
                          SELECT S1.COMP_CODE, COUNT(DISTINCT S1.SECT_CODE) AS SECT_CNT
                          FROM              HPB100T   S1 WITH (NOLOCK)
                                 INNER JOIN HPB200T   S2 WITH (NOLOCK) ON S2.COMP_CODE    = S1.COMP_CODE
                                                                      AND S2.PERSON_NUMB  = S1.PERSON_NUMB
                                                                      AND S2.DED_TYPE     = S1.DED_TYPE
                          WHERE  S1.COMP_CODE       = @COMP_CODE
                          AND    S2.SECT_CODE       = @DIV_CODE
                          AND    S1.DWELLING_YN     = '2'
                          AND    S2.SUPP_DATE   LIKE @PAY_YYYY + '%'
                          AND    S2.DED_TYPE       IN ('1', '2')
                          GROUP  BY S1.COMP_CODE
                          ) C                        ON C.COMP_CODE     = A.COMP_CODE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '2'               --비거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE          IN ('1', '2')        --사업소득/기타소득
    --
        GROUP  BY
               C1.SAFFER_TAX, C1.COMPANY_NUM, C1.DIV_FULL_NAME, C1.DIV_NAME
             , CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, '')), C1.REPRE_NAME, C1.TELEPHON
             , C.SECT_CNT
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectNonResidentBusinessEtcB" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb520Save] Query02
    /*************************************************************************************************************
     비거주자 사업/기타소득 신고 (B 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                      AS SAFFER
             , C1.COMPANY_NUM
             , ISNULL(C2.COMP_ENG_NAME, '')                                                AS COMP_ENG_NAME
             , ISNULL(C2.ENG_ADDR, '')                                                     AS ENG_ADDR
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                                AS REPRE_NAME
             , unilite.fnCipherDecrypt(C1.REPRE_NO, '')                                    AS REPRE_NO
             , COUNT(DISTINCT A.PERSON_NUMB)                                               AS PERSON_CNT
    
             , COUNT(DISTINCT A.PERSON_NUMB+B.SUPP_DATE) AS SUPP_CNT                                                         
    
             , CASE WHEN SUM(B.PAY_AMOUNT_I) &gt; 0 THEN SUM(B.PAY_AMOUNT_I) ELSE 0 END       AS PAY_AMOUNT_I
             , CASE WHEN SUM(B.SUPP_TOTAL_I) &gt; 0 THEN SUM(B.SUPP_TOTAL_I) ELSE 0 END       AS SUPP_TOTAL_I
             , CASE WHEN SUM(B.IN_TAX_I)     &gt; 0 THEN SUM(B.IN_TAX_I)     ELSE 0 END       AS IN_TAX_I
             , CASE WHEN SUM(B.LOCAL_TAX_I)  &gt; 0 THEN SUM(B.LOCAL_TAX_I)  ELSE 0 END       AS LOCAL_TAX_I
             , CASE WHEN SUM(B.CP_TAX_I)     &gt; 0 THEN SUM(B.CP_TAX_I)     ELSE 0 END       AS CP_TAX_I
             , CASE WHEN SUM(B.SP_TAX_I)     &gt; 0 THEN SUM(B.SP_TAX_I)     ELSE 0 END       AS SP_TAX_I
             , CASE WHEN SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) + SUM(B.CP_TAX_I) + SUM(B.SP_TAX_I) &lt;=0 THEN 0
                    ELSE SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) + SUM(B.CP_TAX_I) + SUM(B.SP_TAX_I)
               END                                                                         AS TOTAL_TAX_I
             , @GUBUN                                                                      AS SUBMIT_CODE
             , CONVERT(CHAR(30), '')                                                       AS B_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
               INNER JOIN BOR100T   C2 WITH (NOLOCK) ON C2.COMP_CODE    = A.COMP_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '2'               --비거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE          IN ('1', '2')        --사업소득/기타소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, C2.COMP_ENG_NAME , C2.ENG_ADDR, unilite.fnCipherDecrypt(C1.REPRE_NO, ''), C1.REPRE_NAME
        ORDER  BY
               B.SECT_CODE
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectNonResidentBusinessEtcC" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb520Save] Query03
    /*************************************************************************************************************
     비거주자 사업/기타소득 신고 (C 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , C1.COMPANY_NUM
             , A.RECOGN_NUM
             , CASE WHEN A.BUSINESS_TYPE = '1' THEN A.COMP_ENG_NAME ELSE A.ENG_NAME END AS ENG_NAME
             , CASE WHEN A.BUSINESS_TYPE = '1' THEN A.COMP_ENG_ADDR ELSE A.ENG_ADDR END AS ENG_ADDR
             , A.NATION_CODE
             , A.FOREIGN_YN
             , A.DED_CODE
             , LEFT(B.PAY_YYYYMM, 4)                                                    AS BELONG_YEAR
             , LEFT(B.SUPP_DATE , 4)                                                    AS SUPP_YEAR
             , COUNT(B.PERSON_NUMB)                                                     AS SUPP_CNT
             , SUM(B.PAY_AMOUNT_I)                                                      AS PAY_AMOUNT_I
             , SUM(B.EXPS_AMOUNT_I)                                                     AS EXPS_AMOUNT_I
             , SUM(B.SUPP_TOTAL_I)                                                      AS SUPP_TOTAL_I
             , B.PERCENT_I
             , SUM(B.IN_TAX_I)                                                          AS IN_TAX_I
             , SUM(B.LOCAL_TAX_I)                                                       AS LOCAL_TAX_I
             , SUM(B.CP_TAX_I)                                                          AS CP_TAX_I
             , SUM(B.SP_TAX_I)                                                          AS SP_TAX_I
             , SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I) + SUM(B.CP_TAX_I) + SUM(B.SP_TAX_I) AS TOTAL_TAX_I
             , CASE WHEN SUM(B.PAY_AMOUNT_I)                  &lt; 0 THEN '1' ELSE '0' END AS PAY_AMOUNT_NV
             , CASE WHEN SUM(B.PAY_AMOUNT_I)                  &lt; 0 THEN '1' ELSE '0' END AS PAY_AMOUNT_NV
             , CASE WHEN SUM(B.EXPS_AMOUNT_I)                 &lt; 0 THEN '1' ELSE '0' END AS EXPS_AMOUNT_NV
             , CASE WHEN SUM(B.SUPP_TOTAL_I)                  &lt; 0 THEN '1' ELSE '0' END AS SUPP_TOTAL_NV
             , CASE WHEN SUM(B.IN_TAX_I)                      &lt; 0 THEN '1' ELSE '0' END AS IN_TAX_NV
             , CASE WHEN SUM(B.LOCAL_TAX_I)                   &lt; 0 THEN '1' ELSE '0' END AS LOCAL_TAX_NV
             , CASE WHEN SUM(B.CP_TAX_I)                      &lt; 0 THEN '1' ELSE '0' END AS CP_TAX_NV
             , CASE WHEN SUM(B.SP_TAX_I)                      &lt; 0 THEN '1' ELSE '0' END AS SP_TAX_NV
             , CASE WHEN SUM(B.IN_TAX_I) + SUM(B.LOCAL_TAX_I)  + SUM(B.CP_TAX_I) + SUM(B.SP_TAX_I) &lt; 0
                         THEN '1'
                    ELSE '0'
               END                                                                      AS TOTAL_TAX_NV
             , B.SUPP_DATE
             , CONVERT(CHAR(13), '')                                                    AS C_SPACE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    A.DWELLING_YN        = '2'               --비거주자
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE          IN ('1', '2')        --사업소득/기타소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, A.RECOGN_NUM, A.BUSINESS_TYPE, A.COMP_ENG_NAME
             , A.ENG_NAME, A.COMP_ENG_ADDR, A.ENG_ADDR, A.NATION_CODE, A.FOREIGN_YN, A.DED_CODE
             , LEFT(B.PAY_YYYYMM, 4), LEFT(B.SUPP_DATE, 4), B.PERCENT_I, B.SUPP_DATE, B.PERSON_NUMB
        ORDER  BY
               B.SECT_CODE, B.PERSON_NUMB
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>	
	<select id="hpb500ukrServiceImpl.getSelectInterestA" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb530Save] Query01
    /*************************************************************************************************************
     이자배당 소득 신고 (A 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , ISNULL(C2.COMPANY_NUM, '')                                               AS COMPANY_NUM
             , CONVERT(CHAR(22), '')                                                    AS A_SPACE1
             , C2.COMP_NAME
             , CONVERT(CHAR(20), CASE WHEN C1.DIV_FULL_NAME != '' THEN C1.DIV_FULL_NAME
                                      ELSE C1.DIV_NAME
                                 END)                                                   AS DIV_NAME
             , CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, ''))              AS REPRE_NO
             , CONVERT(CHAR(30), ISNULL(C1.REPRE_NAME, ''))                             AS REPRE_NAME
             , CONVERT(CHAR(15), ISNULL(C1.TELEPHON  , ''))                             AS TELEPHON
             , C.SECT_CNT                                                               AS CNT
             , SUM(B.SUPP_TOTAL_I)                                                      AS SUPP_TOTAL_I --소득금액합계
             , SUM(B.IN_TAX_I)                                                          AS IN_TAX_I     --소득세액합계
             , SUM(B.CP_TAX_I)                                                          AS CP_TAX_I     --법인세액합계
             , COUNT(A.PERSON_NUMB)                                                     AS SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '0' THEN 1
                        ELSE 0
                   END)                                                                 AS NEW_SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '0' THEN B.SUPP_TOTAL_I
                        ELSE 0
                   END)                                                                 AS NEW_SUPP_TOTAL_I
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '4' THEN 1
                        ELSE 0
                   END)                                                                 AS DEL_SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '4' THEN B.SUPP_TOTAL_I
                        ELSE 0
                   END)                                                                 AS DEL_SUPP_TOTAL_I
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '9' THEN 1
                        ELSE 0
                   END)                                                                 AS UPD_SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '9' THEN B.SUPP_TOTAL_I
                        ELSE 0
                   END)                                                                 AS UPD_SUPP_TOTAL_I
             , CONVERT(CHAR(170), '')                                                   AS A_SPACE2
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN (-- 사업장별 그룹갯수 조회
                          SELECT S1.COMP_CODE, COUNT(DISTINCT S1.SECT_CODE) AS SECT_CNT
                          FROM              HPB100T   S1 WITH (NOLOCK)
                                 INNER JOIN HPB200T   S2 WITH (NOLOCK) ON S2.COMP_CODE    = S1.COMP_CODE
                                                                      AND S2.PERSON_NUMB  = S1.PERSON_NUMB
                                                                      AND S2.DED_TYPE     = S1.DED_TYPE
                          WHERE  S1.COMP_CODE       = @COMP_CODE
                          AND    S2.SECT_CODE       = @DIV_CODE
                          AND    S2.SUPP_DATE   LIKE @PAY_YYYY + '%'
                          AND    S2.DED_TYPE       IN ('10', '20')
                          GROUP  BY S1.COMP_CODE
                          ) C                        ON C.COMP_CODE     = A.COMP_CODE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
               INNER JOIN BOR100T   C2 WITH (NOLOCK) ON C2.COMP_CODE    = A.COMP_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE          IN ('10', '20')      --이자소득/배당소득
    --
        GROUP  BY
               C1.SAFFER_TAX, C2.COMPANY_NUM, C2.COMP_NAME, C1.DIV_FULL_NAME, C1.DIV_NAME, CONVERT(CHAR(13), unilite.fnCipherDecrypt(C1.REPRE_NO, '')), C1.REPRE_NAME
             , C1.TELEPHON, C.SECT_CNT
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectInterestB" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb530Save] Query02
    /*************************************************************************************************************
     이자배당 소득 신고 (B 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (필수) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , ISNULL(C2.COMPANY_NUM, '')                                               AS COMPANY_NUM
             , ISNULL(C1.COMPANY_NUM, C2.COMPANY_NUM)                                   AS COMPANY_NUM2
             , CONVERT(CHAR(12),' ')                                                    AS B_SPACE1
             , ISNULL(C1.DIV_NAME, '')                                                  AS DIV_NAME
             , CASE WHEN COUNT(C.DWELLING_YN) &gt; 0 THEN ISNULL(C2.COMP_ENG_NAME, '')
                    ELSE ''
               END                                                                      AS COMP_ENG_NAME
             , CASE WHEN COUNT(C.DWELLING_YN) &gt; 0 THEN ISNULL(C2.ENG_ADDR,'')
                    ELSE ''
               END                                                                      AS ADDR
             , SUM(B.SUPP_TOTAL_I)                                                      AS SUPP_TOTAL_I --소득금액합계
             , SUM(B.IN_TAX_I)                                                          AS IN_TAX_I     --소득세액합계
             , SUM(B.CP_TAX_I)                                                          AS CP_TAX_I     --법인세액합계
             , CONVERT(CHAR(45), '')                                                    AS B_SPACE2
             , COUNT(A.PERSON_NUMB)                                                     AS SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '0' THEN 1
                        ELSE 0
                   END)                                                                 AS NEW_SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '0' THEN B.SUPP_TOTAL_I
                        ELSE 0
                   END)                                                                 AS NEW_SUPP_TOTAL_I
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '4' THEN 1
                        ELSE 0
                   END)                                                                 AS DEL_SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '4' THEN B.SUPP_TOTAL_I
                        ELSE 0
                   END)                                                                 AS DEL_SUPP_TOTAL_I
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '9' THEN 1
                        ELSE 0
                   END)                                                                 AS UPD_SUPP_CNT
             , SUM(CASE WHEN ISNULL(B.CHANGE_GUBN, '0') = '9' THEN B.SUPP_TOTAL_I
                        ELSE 0
                   END)                                                                 AS UPD_SUPP_TOTAL_I
             , @GUBUN                                                                   AS SUBMIT_CODE
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               LEFT  JOIN (-- 비거주자 존재여부 조회
                          SELECT S1.COMP_CODE, S1.DWELLING_YN
                          FROM   HPB100T   S1 WITH (NOLOCK)
                          WHERE  S1.COMP_CODE       = @COMP_CODE
                          AND    S1.SECT_CODE       = @DIV_CODE
                          AND    S1.DWELLING_YN     = '2'       -- 비거주자
                          AND    S1.DED_TYPE       IN ('10', '20')
                          GROUP  BY
                                 S1.COMP_CODE, S1.DWELLING_YN
                          ) C                        ON C.COMP_CODE     = A.COMP_CODE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
               INNER JOIN BOR100T   C2 WITH (NOLOCK) ON C2.COMP_CODE    = A.COMP_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE          IN ('10', '20')      --이자소득/배당소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, C2.COMPANY_NUM, C2.COMP_ENG_NAME, C1.DIV_NAME, C2.ENG_ADDR
        ORDER  BY
               B.SECT_CODE
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
	<select id="hpb500ukrServiceImpl.getSelectInterestC" parameterType="Map" resultType="rMap">
	--hpb500ukr.Chpb500ukr[fnHpb530Save] Query03
    /*************************************************************************************************************
     이자배당 소득 신고 (C 레코드) 조회
    *************************************************************************************************************/
    BEGIN
        DECLARE     @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                  , @DIV_CODE           NVARCHAR(08)                -- (선택) 신고사업장
                  , @PAY_YYYY           NVARCHAR(04)                -- (필수) 정산년도
                  , @GUBUN              NVARCHAR(03)                -- (필수) 제출방법
    
        SET NOCOUNT ON
        SET ARITHABORT ON
    
    --  1. 변수 값 할당 ----------------------------------------------------------------------------------------
        SET @COMP_CODE          = #{S_COMP_CODE}
        SET @DIV_CODE           = #{DIV_CODE}
        SET @PAY_YYYY           = #{CAL_YEAR}
        SET @GUBUN              = #{SUBMIT_CODE}
    
    --  2. 데이터 조회 -----------------------------------------------------------------------------------------
        SELECT B.SECT_CODE
             --자료관리번호
             , ISNULL(SUBSTRING(LTRIM(RTRIM(C1.SAFFER_TAX)),1,3), '')                   AS SAFFER
             , ISNULL(C2.COMPANY_NUM, '')                                               AS COMPANY_NUM
             , ISNULL(C1.COMPANY_NUM, C2.COMPANY_NUM)                                   AS COMPANY_NUM2
    
             --소득자기본사항
             , CASE WHEN A.DWELLING_YN = '2' THEN ISNULL(A.ENG_NAME, A.COMP_ENG_NAME)
                    ELSE A.NAME
               END                                                                      AS NAME
             , CASE WHEN A.DWELLING_YN = '2' THEN ISNULL(A.RECOGN_NUM, '')
                    ELSE CASE WHEN A.BUSINESS_TYPE = '3' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '')
                              ELSE CASE WHEN ISNULL(A.COMP_NUM, '') = '' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '')
                                        ELSE ISNULL(A.COMP_NUM, '')
                                   END
                         END
               END                                                                      AS REPRE_NUM
             , CASE WHEN A.DWELLING_YN = '1' OR A.COMP_ENG_NAME != '' THEN ''
                    ELSE ISNULL(A.BIRTH_DATE, '')
               END                                                                      AS BIRTH
             , A.DED_CODE                                                               AS DED_CODE
             , CASE WHEN A.DWELLING_YN = '2' THEN ISNULL(A.ENG_ADDR, A.COMP_ENG_ADDR)
                    ELSE ''
               END                                                                      AS ADDR
             , A.DWELLING_YN                                                            AS DWELLING_YN
             , CASE WHEN A.DWELLING_YN = '2' THEN A.NATION_CODE ELSE '' END             AS NATION_CODE
    
             --기타관리항목
             , REPLACE(uniLITE.fnCipherDecrypt(A.BANK_ACCOUNT, ''),'-','')              AS BANK_ACCOUNT
             , CASE WHEN @PAY_YYYY &lt; '2012' THEN '' ELSE ISNULL(A.TRUST_PROFIT_YN,'2') END AS TRUST_PROFIT_YN
    
             --소득지급내역
             , B.SUPP_DATE                                                              AS SUPP_DATE
             , B.PAY_YYYYMM                                                             AS PAY_YYYYMM
             , B.TAX_GUBN                                                               AS TAX_GUBN
             , CASE WHEN @PAY_YYYY &lt; '2012' THEN '' ELSE B.INCOME_KIND END              AS INCOME_KIND
             , CASE WHEN @PAY_YYYY &lt; '2012' THEN '' 
                    ELSE CASE WHEN TAX_GUBN IN ('F','I','W','N') THEN '' 
                              ELSE B.TAX_EXCEPTION END
                END                                                                     AS TAX_EXCEPTION
             , ISNULL(B.PRIZE_CODE, '')                                                 AS PRIZE_CODE
             , ISNULL(B.WERT_PAPER_CODE, C2.COMPANY_NUM)                                AS WERT_PAPER_CODE
             , ISNULL(B.CLAIM_INTER_GUBN, '')                                           AS CLAIM_INTER_GUBN
             , ISNULL(B.DATE_FROM_YYMM + B.DATE_TO_YYMM, '')                            AS SUPP_PERIOD
             , CASE WHEN LEN(REPLACE(CONVERT(NVARCHAR(11),INTER_RATE),'.','')) - 5 = 3
                         THEN '00' + REPLACE(CONVERT(NVARCHAR(11),INTER_RATE),'.','')  
                    WHEN LEN(REPLACE(CONVERT(NVARCHAR(11),INTER_RATE),'.','')) - 5 = 2
                         THEN '000' + REPLACE(CONVERT(NVARCHAR(11),INTER_RATE),'.','')
                    WHEN LEN(REPLACE(CONVERT(NVARCHAR(11),INTER_RATE),'.','')) - 5 = 1
                         THEN '0000' + REPLACE(CONVERT(NVARCHAR(11),INTER_RATE),'.','')
                END                                                                     AS INTER_RATE
             , SUM(B.SUPP_TOTAL_I)                                                      AS SUPP_TOTAL_I
             , CASE WHEN TAX_GUBN = 'N' THEN CONVERT(CHAR(9), '')
                    WHEN TAX_GUBN IN ('E','X','F','I','W') THEN '000000'
                    ELSE (CASE WHEN LEN(REPLACE(CONVERT(NVARCHAR(7),PERCENT_I),'.',''))- 4  = 1 
                                    THEN '0' + REPLACE(CONVERT(NVARCHAR(7),PERCENT_I),'.','') 
                               ELSE REPLACE(CONVERT(NVARCHAR(7),PERCENT_I),'.','') 
                           END)
                END                                                                     AS PERCENT_I
    
             --원천징수내역
             , CASE WHEN SUM(B.IN_TAX_I) &lt; 0 THEN '0' ELSE SUM(B.IN_TAX_I) END          AS IN_TAX_I
             , CASE WHEN SUM(B.CP_TAX_I) &lt; 0 THEN '0' ELSE SUM(B.CP_TAX_I) END          AS CP_TAX_I
             , SUM(B.LOCAL_TAX_I)                                                       AS LOCAL_TAX_I
             , SUM(B.SP_TAX_I)                                                          AS SP_TAX_I
             , CONVERT(CHAR(33), '')                                                    AS C_SPACE
             , ISNULL(B.CHANGE_GUBN, '0')                                               AS CHANGE_GUBN
        FROM              HPB100T   A  WITH (NOLOCK)
               INNER JOIN HPB200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                    AND B.PERSON_NUMB   = A.PERSON_NUMB
                                                    AND B.DED_TYPE      = A.DED_TYPE
               INNER JOIN BOR120T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                    AND C1.DIV_CODE     = A.SECT_CODE
               INNER JOIN BOR100T   C2 WITH (NOLOCK) ON C2.COMP_CODE    = A.COMP_CODE
        WHERE  A.COMP_CODE          = @COMP_CODE
        AND    B.SECT_CODE          = @DIV_CODE
        AND    B.SUPP_DATE      LIKE @PAY_YYYY + '%'
        AND    B.DED_TYPE          IN ('10', '20')      --이자소득/배당소득
    --
        GROUP  BY
               B.SECT_CODE, C1.SAFFER_TAX, C1.COMPANY_NUM, C2.COMPANY_NUM, A.DWELLING_YN, A.NATION_CODE
             , A.DED_CODE, A.ENG_NAME, A.COMP_ENG_NAME, A.NAME, A.RECOGN_NUM
             , CASE WHEN A.DWELLING_YN = '2' THEN ISNULL(A.RECOGN_NUM, '')
                    ELSE CASE WHEN A.BUSINESS_TYPE = '3' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '')
                              ELSE CASE WHEN ISNULL(A.COMP_NUM, '') = '' THEN unilite.fnCipherDecrypt(A.REPRE_NUM, '')
                                        ELSE ISNULL(A.COMP_NUM, '')
                                   END
                         END
               END
             , A.COMP_NUM
             , A.ENG_ADDR, A.COMP_ENG_ADDR, B.SUPP_DATE, B.DATE_FROM_YYMM, B.DATE_TO_YYMM, B.PERCENT_I
             , REPLACE(uniLITE.fnCipherDecrypt(A.BANK_ACCOUNT, ''),'-',''), B.PAY_YYYYMM, B.PRIZE_CODE, A.KNOWN_YN, B.TAX_GUBN, B.CLAIM_INTER_GUBN
             , B.WERT_PAPER_CODE, B.CHANGE_GUBN, B.PERSON_NUMB, A.BUSINESS_TYPE, A.BIRTH_DATE, A.TRUST_PROFIT_YN,B.INTER_RATE
             , B.INCOME_KIND, B.TAX_EXCEPTION
        ORDER  BY
               B.SECT_CODE, B.PERSON_NUMB
    
        SET NOCOUNT OFF
        SET ARITHABORT OFF
    END
	</select>
</mapper>