<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hpa700rkrServiceImpl">

	<select id="hpa700rkrServiceImpl.selectList1" parameterType="Map" resultType="rMap">		
        
    --hpa700rkrServiceImpl.selectList1 : 부서별 지급대장
    DECLARE @COMP_CODE        NVARCHAR(08)            -- 법인코드
          , @PAY_YYYYMM       NVARCHAR(06)            -- 지급년월
          , @SUPP_TYPE        NVARCHAR(02)            -- 지급구분 ( F : 년차,  G : 월차 )
          , @DIV_CODE         NVARCHAR(08)            -- 사업장
    
          , @FR_DEPT_CODE     NVARCHAR(08)            -- 부서코드(FR)
          , @TO_DEPT_CODE     NVARCHAR(08)            -- 부서코드(TO)
          , @PAY_CODE         NVARCHAR(02)            -- 급여지급방식 ( 0 : 연봉, 1 : 월급, 2 : 일급, 3 : 시급 )
          , @SUPP_DATE        NVARCHAR(08)            -- 지급일
          , @PAY_PROV_FLAG    NVARCHAR(02)            -- 지급차수
          , @PAY_GUBUN        NVARCHAR(02)            -- 고용형태( 1 : 정규직, 2 : 비정규직 )
          , @EMPLOY_TYPE      NVARCHAR(02)            -- 사원구분( 1 : 정규T사원, 2 : 수습사원, 3 :실습생, 4 : 아르바이트, 5 : 산업연수생 )
          , @PERSON_GROUP     NVARCHAR(02)            -- 사원그룹
          , @AFFIL_CODE       NVARCHAR(04)            -- 직렬
          , @PERSON_NUMB      NVARCHAR(08)            -- 사원번호
             
    
            
        SET @COMP_CODE     = #{S_COMP_CODE}
        SET @PAY_YYYYMM    = #{SUPP_MONTH}
        SET @SUPP_TYPE     = #{SUPP_TYPE}
        SET @DIV_CODE      = #{DIV_CODE}
        SET @FR_DEPT_CODE  = #{DEPT_CODE_FR}
        SET @TO_DEPT_CODE  = #{DEPT_CODE_TO}
        SET @PAY_CODE      = #{PAY_CODE}
        SET @SUPP_DATE     = #{SUPP_DATE}
        SET @PAY_PROV_FLAG = #{PAY_DAY_FLAG}
        SET @PAY_GUBUN     = #{PAY_GUBUN}
        SET @EMPLOY_TYPE   = #{EMPLOY_TYPE}
        SET @PERSON_GROUP  = #{PERSON_GROUP}
        SET @AFFIL_CODE    = #{AFFIL_CODE}
        SET @PERSON_NUMB   = #{PERSON_NUMB}
        
    	IF ( ISNULL(@DIV_CODE,      '') = '' ) SET @DIV_CODE      = ''
    	IF ( ISNULL(@FR_DEPT_CODE,  '') = '' ) SET @FR_DEPT_CODE  = ''
    	IF ( ISNULL(@TO_DEPT_CODE,  '') = '' ) SET @TO_DEPT_CODE  = ''
    	IF ( ISNULL(@PAY_CODE,      '') = '' ) SET @PAY_CODE      = ''
    	IF ( ISNULL(@SUPP_DATE,     '') = '' ) SET @SUPP_DATE     = ''
    	IF ( ISNULL(@PAY_PROV_FLAG, '') = '' ) SET @PAY_PROV_FLAG = ''
    	IF ( ISNULL(@PAY_GUBUN,     '') = '' ) SET @PAY_GUBUN     = ''
    	IF ( ISNULL(@EMPLOY_TYPE,   '') = '' ) SET @EMPLOY_TYPE   = ''
    	IF ( ISNULL(@PERSON_GROUP,  '') = '' ) SET @PERSON_GROUP  = ''
    	IF ( ISNULL(@AFFIL_CODE,    '') = '' ) SET @AFFIL_CODE    = ''
    	IF ( ISNULL(@PERSON_NUMB,   '') = '' ) SET @PERSON_NUMB   = ''
            
    SELECT T2.NAME              
         , T1.PERSON_NUMB    
         , T1.DEPT_CODE         
         , T1.DEPT_NAME         
         , T2.JOIN_DATE         
         , T1.LONG_MONTH        
         , T1.BONUS_STD_I       
         , T1.YEAR_CRT          
         , T1.YEAR_ADD          
         , T1.MONTH_CRT         
         , T1.MON_YEAR_USE      
         , T1.MON_YEAR_PROV     
         , T1.SUPP_TOTAL_I      
         , ISNULL(T3.INC_AMT, 0) AS INC_AMT  
         , ISNULL(T3.LOC_AMT, 0) AS LOC_AMT  
         , ISNULL(T3.HIR_AMT, 0) AS HIR_AMT  
         , ISNULL(T3.ETC_AMT, 0) AS ETC_AMT  
         , T1.REAL_AMOUNT_I                  
         , (SELECT DIV_NAME                  
              FROM BOR120T                   
             WHERE COMP_CODE = @COMP_CODE
               AND DIV_CODE  = T2.DIV_CODE) AS DIV_NAME
      FROM HPA600T T1                                                     
                    INNER JOIN HUM100T T2                                 
                            ON T1.COMP_CODE = T2.COMP_CODE
                           AND T1.PERSON_NUMB = T2.PERSON_NUMB            
               LEFT OUTER JOIN (SELECT PAY_YYYYMM                         
                                     , SUPP_TYPE                          
                                     , PERSON_NUMB                        
                                     , MAX(CASE WHEN DED_CODE = 'INC'     
                                                     THEN DED_AMOUNT_I    
                                                     ELSE 0               
                                            END) AS INC_AMT               
                                     , MAX(CASE WHEN DED_CODE = 'LOC'     
                                                     THEN DED_AMOUNT_I    
                                                     ELSE 0               
                                            END) AS LOC_AMT               
                                     , MAX(CASE WHEN DED_CODE = 'HIR'     
                                                     THEN DED_AMOUNT_I    
                                                     ELSE 0               
                                            END) AS HIR_AMT               
                                     , SUM(CASE WHEN DED_CODE != 'HIR' AND DED_CODE != 'INC' AND DED_CODE != 'LOC' 
                                                     THEN DED_AMOUNT_I    
                                                     ELSE 0               
                                            END) AS ETC_AMT               
                                     , COMP_CODE
                                  FROM HPA400T                            
                                 WHERE COMP_CODE = @COMP_CODE
                                 GROUP BY PAY_YYYYMM, SUPP_TYPE, PERSON_NUMB, COMP_CODE ) T3
                            ON T1.COMP_CODE   = T3.COMP_CODE
                           AND T1.PERSON_NUMB = T3.PERSON_NUMB            
                           AND T1.SUPP_TYPE   = T3.SUPP_TYPE              
                           AND T1.PAY_YYYYMM  = T3.PAY_YYYYMM             
           LEFT  JOIN BSA100T B1 WITH (NOLOCK) ON B1.COMP_CODE   = T2.COMP_CODE
                                              AND B1.MAIN_CODE   = 'H024'
                                              AND B1.SUB_CODE    = T2.EMPLOY_TYPE
           LEFT  JOIN BSA100T B2 WITH (NOLOCK) ON B2.COMP_CODE   = T2.COMP_CODE
                                              AND B2.MAIN_CODE   = 'H181'
                                              AND B2.SUB_CODE    = ISNULL(B1.REF_CODE1, '')
     WHERE T1.COMP_CODE  = @COMP_CODE
       AND T1.PAY_YYYYMM = @PAY_YYYYMM
       AND T1.SUPP_TYPE  = @SUPP_TYPE
       <if test="OPTYN == &quot;2&quot;">
           AND T2.RETR_DATE = '00000000'
       </if>
       <if test="OPTYN == &quot;3&quot;">
           AND T2.RETR_DATE != '00000000'
       </if>
       AND ((T1.DIV_CODE       = @DIV_CODE        AND @DIV_CODE      != '') OR (@DIV_CODE       = ''))
       AND ((T2.DEPT_CODE     &gt;= @FR_DEPT_CODE    AND @FR_DEPT_CODE  != '') OR (@FR_DEPT_CODE   = ''))
       AND ((T2.DEPT_CODE     &lt;= @TO_DEPT_CODE    AND @TO_DEPT_CODE  != '') OR (@TO_DEPT_CODE   = ''))
       AND ((T1.PAY_CODE       = @PAY_CODE        AND @PAY_CODE      != '') OR (@PAY_CODE       = ''))
       AND ((T1.SUPP_DATE      = @SUPP_DATE       AND @SUPP_DATE     != '') OR (@SUPP_DATE      = ''))
       AND ((T1.PAY_PROV_FLAG  = @PAY_PROV_FLAG   AND @PAY_PROV_FLAG != '') OR (@PAY_PROV_FLAG  = ''))
       AND ((T2.PAY_GUBUN      = @PAY_GUBUN       AND @PAY_GUBUN     != '') OR (@PAY_GUBUN      = ''))
       AND ((T2.EMPLOY_TYPE    = @EMPLOY_TYPE     AND @EMPLOY_TYPE   != '') OR (@EMPLOY_TYPE    = ''))
       AND ((B2.SUB_CODE       = @PERSON_GROUP    AND @PERSON_GROUP  != '') OR (@PERSON_GROUP   = ''))
       AND ((T2.AFFIL_CODE     = @AFFIL_CODE      AND @AFFIL_CODE    != '') OR (@AFFIL_CODE     = ''))
       AND ((T1.PERSON_NUMB    = @PERSON_NUMB     AND @PERSON_NUMB   != '') OR (@PERSON_NUMB    = ''))
       
    ORDER BY T1.DEPT_CODE, T1.POST_CODE, T2.NAME, T1.PERSON_NUMB 
			
	</select>
    
    
	<select id="hpa700rkrServiceImpl.selectList2" parameterType="Map" resultType="rMap">		
        
    --hpa700rkrServiceImpl.selectList2 : 부서별집계표
    DECLARE @COMP_CODE        NVARCHAR(08)            -- 법인코드
          , @PAY_YYYYMM       NVARCHAR(06)            -- 지급년월
          , @SUPP_TYPE        NVARCHAR(02)            -- 지급구분 ( F : 년차,  G : 월차 )
          , @DIV_CODE         NVARCHAR(08)            -- 사업장
    
          , @FR_DEPT_CODE     NVARCHAR(08)            -- 부서코드(FR)
          , @TO_DEPT_CODE     NVARCHAR(08)            -- 부서코드(TO)
          , @PAY_CODE         NVARCHAR(02)            -- 급여지급방식 ( 0 : 연봉, 1 : 월급, 2 : 일급, 3 : 시급 )
          , @SUPP_DATE        NVARCHAR(08)            -- 지급일
          , @PAY_PROV_FLAG    NVARCHAR(02)            -- 지급차수
          , @PAY_GUBUN        NVARCHAR(02)            -- 고용형태( 1 : 정규직, 2 : 비정규직 )
          , @EMPLOY_TYPE      NVARCHAR(02)            -- 사원구분( 1 : 정규T사원, 2 : 수습사원, 3 :실습생, 4 : 아르바이트, 5 : 산업연수생 )
          , @PERSON_GROUP     NVARCHAR(02)            -- 사원그룹
          , @AFFIL_CODE       NVARCHAR(04)            -- 직렬
          , @PERSON_NUMB      NVARCHAR(08)            -- 사원번호
              
    
            
        SET @COMP_CODE     = #{S_COMP_CODE}
        SET @PAY_YYYYMM    = #{SUPP_MONTH}
        SET @SUPP_TYPE     = #{SUPP_TYPE}
        SET @DIV_CODE      = #{DIV_CODE}
        SET @FR_DEPT_CODE  = #{DEPT_CODE_FR}
        SET @TO_DEPT_CODE  = #{DEPT_CODE_TO}
        SET @PAY_CODE      = #{PAY_CODE}
        SET @SUPP_DATE     = #{SUPP_DATE}
        SET @PAY_PROV_FLAG = #{PAY_DAY_FLAG}
        SET @PAY_GUBUN     = #{PAY_GUBUN}
        SET @EMPLOY_TYPE   = #{EMPLOY_TYPE}
        SET @PERSON_GROUP  = #{PERSON_GROUP}
        SET @AFFIL_CODE    = #{AFFIL_CODE}
        SET @PERSON_NUMB   = #{PERSON_NUMB}

        
        IF ( ISNULL(@DIV_CODE,      '') = '' ) SET @DIV_CODE      = ''
        IF ( ISNULL(@FR_DEPT_CODE,  '') = '' ) SET @FR_DEPT_CODE  = ''
        IF ( ISNULL(@TO_DEPT_CODE,  '') = '' ) SET @TO_DEPT_CODE  = ''
        IF ( ISNULL(@PAY_CODE,      '') = '' ) SET @PAY_CODE      = ''
        IF ( ISNULL(@SUPP_DATE,     '') = '' ) SET @SUPP_DATE     = ''
        IF ( ISNULL(@PAY_PROV_FLAG, '') = '' ) SET @PAY_PROV_FLAG = ''
        IF ( ISNULL(@PAY_GUBUN,     '') = '' ) SET @PAY_GUBUN     = ''
        IF ( ISNULL(@EMPLOY_TYPE,   '') = '' ) SET @EMPLOY_TYPE   = ''
        IF ( ISNULL(@PERSON_GROUP,  '') = '' ) SET @PERSON_GROUP  = ''
        IF ( ISNULL(@AFFIL_CODE,    '') = '' ) SET @AFFIL_CODE    = ''
        IF ( ISNULL(@PERSON_NUMB,   '') = '' ) SET @PERSON_NUMB   = ''
        
                            
    SELECT COUNT(T1.PERSON_NUMB) AS PER_CNT  
            , T1.DEPT_CODE                      
            , MAX(T1.DEPT_NAME)         AS NAME   
            , SUM(T1.YEAR_CRT)          AS YEAR_CRT                         
            , SUM(T1.YEAR_ADD)          AS YEAR_ADD                         
            , SUM(T1.MONTH_CRT)         AS MONTH_CRT                       
            , SUM(T1.MON_YEAR_USE)      AS MON_YEAR_USE                 
            , SUM(T1.MON_YEAR_PROV)     AS MON_YEAR_PROV               
            , SUM(T1.SUPP_TOTAL_I)      AS SUPP_TOTAL_I                 
            , SUM(ISNULL(T3.INC_AMT,0)) AS INC_AMT                 
            , SUM(ISNULL(T3.LOC_AMT,0)) AS LOC_AMT                 
            , SUM(ISNULL(T3.HIR_AMT,0)) AS HIR_AMT                 
            , SUM(ISNULL(T3.ETC_AMT,0)) AS ETC_AMT                 
            , SUM(T1.REAL_AMOUNT_I)     AS REAL_AMOUNT_I               
            , '' AS DIV_NAME                                       
        FROM HPA600T T1                                           
       INNER JOIN HUM100T T2 ON T1.COMP_CODE   = T2.COMP_CODE
                            AND T1.PERSON_NUMB = T2.PERSON_NUMB  
        LEFT OUTER JOIN (SELECT PAY_YYYYMM               
                              , SUPP_TYPE                
                              , PERSON_NUMB              
                              , MAX(CASE WHEN DED_CODE = 'INC'   
                                         THEN DED_AMOUNT_I  
                                         ELSE 0             
                                     END) AS INC_AMT             
                              , MAX(CASE WHEN DED_CODE = 'LOC'   
                                         THEN DED_AMOUNT_I  
                                         ELSE 0             
                                     END) AS LOC_AMT             
                              , MAX(CASE WHEN DED_CODE = 'HIR'   
                                         THEN DED_AMOUNT_I  
                                         ELSE 0             
                                     END) AS HIR_AMT             
                              , SUM(CASE WHEN DED_CODE != 'HIR' AND DED_CODE != 'INC' AND DED_CODE != 'LOC' 
                                         THEN DED_AMOUNT_I  
                                         ELSE 0             
                                     END) AS ETC_AMT             
                              , COMP_CODE
                          FROM HPA400T                          
                         WHERE COMP_CODE = @COMP_CODE
                         GROUP BY PAY_YYYYMM, SUPP_TYPE, PERSON_NUMB, COMP_CODE) T3
                               ON T1.COMP_CODE   = T3.COMP_CODE
                              AND T1.PERSON_NUMB = T3.PERSON_NUMB          
                              AND T1.SUPP_TYPE   = T3.SUPP_TYPE            
                              AND T1.PAY_YYYYMM  = T3.PAY_YYYYMM           
        LEFT  JOIN BSA100T B1 WITH (NOLOCK) ON B1.COMP_CODE   = T2.COMP_CODE
                                            AND B1.MAIN_CODE  = 'H024'
                                            AND B1.SUB_CODE   = T2.EMPLOY_TYPE
        LEFT  JOIN BSA100T B2 WITH (NOLOCK) ON B2.COMP_CODE   = T2.COMP_CODE
                                            AND B2.MAIN_CODE  = 'H181'
                                            AND B2.SUB_CODE   = ISNULL(B1.REF_CODE1, '')
    WHERE T1.COMP_CODE  = @COMP_CODE
      AND T1.PAY_YYYYMM = @PAY_YYYYMM
      AND T1.SUPP_TYPE  = @SUPP_TYPE
    <if test="OPTYN == &quot;2&quot;">
        AND T2.RETR_DATE = '00000000'
    </if>
    <if test="OPTYN == &quot;3&quot;">
        AND T2.RETR_DATE != '00000000'
    </if>
      AND ((T1.DIV_CODE       = @DIV_CODE        AND @DIV_CODE      != '') OR (@DIV_CODE       = ''))
      AND ((T2.DEPT_CODE     &gt;= @FR_DEPT_CODE    AND @FR_DEPT_CODE  != '') OR (@FR_DEPT_CODE   = ''))
      AND ((T2.DEPT_CODE     &lt;= @TO_DEPT_CODE    AND @TO_DEPT_CODE  != '') OR (@TO_DEPT_CODE   = ''))
      AND ((T1.PAY_CODE       = @PAY_CODE        AND @PAY_CODE      != '') OR (@PAY_CODE       = ''))
      AND ((T1.SUPP_DATE      = @SUPP_DATE       AND @SUPP_DATE     != '') OR (@SUPP_DATE      = ''))
      AND ((T1.PAY_PROV_FLAG  = @PAY_PROV_FLAG   AND @PAY_PROV_FLAG != '') OR (@PAY_PROV_FLAG  = ''))
      AND ((T2.PAY_GUBUN      = @PAY_GUBUN       AND @PAY_GUBUN     != '') OR (@PAY_GUBUN      = ''))
      AND ((T2.EMPLOY_TYPE    = @EMPLOY_TYPE     AND @EMPLOY_TYPE   != '') OR (@EMPLOY_TYPE    = ''))
      AND ((B2.SUB_CODE       = @PERSON_GROUP    AND @PERSON_GROUP  != '') OR (@PERSON_GROUP   = ''))
      AND ((T2.AFFIL_CODE     = @AFFIL_CODE      AND @AFFIL_CODE    != '') OR (@AFFIL_CODE     = ''))
      AND ((T1.PERSON_NUMB    = @PERSON_NUMB     AND @PERSON_NUMB   != '') OR (@PERSON_NUMB    = ''))

    GROUP BY T1.DEPT_CODE   
    
	</select>
    
    
    <select id="hpa700rkrServiceImpl.selectList3" parameterType="Map" resultType="rMap">
        --hpa700rkrServiceImpl.selectList3 : 명세표
        BEGIN
        
            SET NOCOUNT ON
            SET ARITHABORT ON
        
            DECLARE @COMP_CODE        NVARCHAR(08)            -- 법인코드
                  , @PAY_YYYYMM       NVARCHAR(06)            -- 지급년월
                  , @SUPP_TYPE        NVARCHAR(02)            -- 지급구분 ( F : 년차,  G : 월차 )
                  , @DIV_CODE         NVARCHAR(08)            -- 사업장
            
                  , @FR_DEPT_CODE     NVARCHAR(08)            -- 부서코드(FR)
                  , @TO_DEPT_CODE     NVARCHAR(08)            -- 부서코드(TO)
                  , @PAY_CODE         NVARCHAR(02)            -- 급여지급방식 ( 0 : 연봉, 1 : 월급, 2 : 일급, 3 : 시급 )
                  , @SUPP_DATE        NVARCHAR(08)            -- 지급일
                  , @PAY_PROV_FLAG    NVARCHAR(02)            -- 지급차수
                  , @PAY_GUBUN        NVARCHAR(02)            -- 고용형태( 1 : 정규직, 2 : 비정규직 )
                  , @EMPLOY_TYPE      NVARCHAR(02)            -- 사원구분( 1 : 정규T사원, 2 : 수습사원, 3 :실습생, 4 : 아르바이트, 5 : 산업연수생 )
                  , @PERSON_GROUP     NVARCHAR(02)            -- 사원그룹
                  , @AFFIL_CODE       NVARCHAR(04)            -- 직렬
                  , @PERSON_NUMB      NVARCHAR(08)            -- 사원번호
                      

                SET @COMP_CODE     = #{S_COMP_CODE}
                SET @PAY_YYYYMM    = #{SUPP_MONTH}
                SET @SUPP_TYPE     = #{SUPP_TYPE}
                SET @DIV_CODE      = #{DIV_CODE}
                SET @FR_DEPT_CODE  = #{DEPT_CODE_FR}
                SET @TO_DEPT_CODE  = #{DEPT_CODE_TO}
                SET @PAY_CODE      = #{PAY_CODE}
                SET @SUPP_DATE     = #{SUPP_DATE}
                SET @PAY_PROV_FLAG = #{PAY_DAY_FLAG}
                SET @PAY_GUBUN     = #{PAY_GUBUN}
                SET @EMPLOY_TYPE   = #{EMPLOY_TYPE}
                SET @PERSON_GROUP  = #{PERSON_GROUP}
                SET @AFFIL_CODE    = #{AFFIL_CODE}
                SET @PERSON_NUMB   = #{PERSON_NUMB}
                
                
            	IF ( ISNULL(@DIV_CODE,      '') = '' ) SET @DIV_CODE      = ''
            	IF ( ISNULL(@FR_DEPT_CODE,  '') = '' ) SET @FR_DEPT_CODE  = ''
            	IF ( ISNULL(@TO_DEPT_CODE,  '') = '' ) SET @TO_DEPT_CODE  = ''
            	IF ( ISNULL(@PAY_CODE,      '') = '' ) SET @PAY_CODE      = ''
            	IF ( ISNULL(@SUPP_DATE,     '') = '' ) SET @SUPP_DATE     = ''
            	IF ( ISNULL(@PAY_PROV_FLAG, '') = '' ) SET @PAY_PROV_FLAG = ''
            	IF ( ISNULL(@PAY_GUBUN,     '') = '' ) SET @PAY_GUBUN     = ''
            	IF ( ISNULL(@EMPLOY_TYPE,   '') = '' ) SET @EMPLOY_TYPE   = ''
            	IF ( ISNULL(@PERSON_GROUP,  '') = '' ) SET @PERSON_GROUP  = ''
            	IF ( ISNULL(@AFFIL_CODE,    '') = '' ) SET @AFFIL_CODE    = ''
            	IF ( ISNULL(@PERSON_NUMB,   '') = '' ) SET @PERSON_NUMB   = ''
                
        
            --IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE id=object_id('HPA900PH_MASTER'))
                DROP TABLE HPA900PH_MASTER
        
            --IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE id=object_id('HBO800PH_MASTER'))
                DROP TABLE HBO800PH_MASTER
        
            --임시테이블 생성                                           
            SELECT IDENTITY(INT,1,1) AS SEQ                            
                 , A.DED_CODE AS SUB_CODE                              
                 , B.CODE_NAME                                         
              INTO HPA900PH_MASTER
              FROM HPA400T A                                           
                           INNER JOIN BSA100T B                        
                                   ON A.COMP_CODE = B.COMP_CODE        
                                  AND A.DED_CODE  = B.SUB_CODE         
             WHERE A.COMP_CODE = #{S_COMP_CODE}
               AND PAY_YYYYMM  = @PAY_YYYYMM 
               AND SUPP_TYPE   = @SUPP_TYPE
               AND B.MAIN_CODE = 'H034'                                
               AND B.SUB_CODE != '$'                                   
             GROUP BY A.DED_CODE, B.CODE_NAME, REF_CODE2               
             ORDER BY REF_CODE2, SUB_CODE                              
        
                            
            SELECT IDENTITY(INT,1,1) AS W_SEQ  
                 , WAGES_CODE                  
                 , WAGES_NAME                  
                 , WAGES_SEQ                   
              INTO HBO800PH_MASTER 
              FROM HBS300T                     
             WHERE COMP_CODE = #{S_COMP_CODE}
               AND CODE_TYPE = '1'             
               AND WAGES_SEQ = '1'             
             ORDER BY WAGES_SEQ
             
             
            --메인쿼리             
            SELECT M1.PAY_YYYYMM          
                 , M1.SUPP_TYPE           
                 , M1.POST_CODE           
                 , M0.DIV_CODE            
                 , M1.DEPT_CODE           
                 , M1.DEPT_NAME           
                 , M0.DEPT_CODE           
                 , M1.PAY_CODE            
                 , M0.PERSON_NUMB         
                 , M0.NAME                
                 , (SELECT DIV_NAME       
                      FROM BOR120T        
                     WHERE COMP_CODE = #{S_COMP_CODE}
                       AND DIV_CODE = M0.DIV_CODE) AS DIV_NAME
                 , (SELECT CODE_NAME      
                      FROM BSA100T        
                     WHERE COMP_CODE = #{S_COMP_CODE}
                       AND MAIN_CODE = 'H005' 
                       AND SUB_CODE  = M1.POST_CODE) AS POST_NM
                 , M1.BONUS_STD_I              
                 , M1.YEAR_CRT                 
                 , M1.YEAR_ADD                 
                 , M1.MONTH_CRT                
                 , M1.MON_YEAR_USE             
                 , M1.MON_YEAR_PROV            
                 , M1.SUPP_TOTAL_I             
                 , M1.DED_TOTAL_I              
                 , M1.REAL_AMOUNT_I            
                 , ISNULL(M2.S1,0) AS S1       
                 , ISNULL(M2.S2,0) AS S2       
                 , ISNULL(M2.S3,0) AS S3       
                 , ISNULL(M2.S4,0) AS S4       
                 , ISNULL(M3.G4,0) AS G4       
                 , ISNULL(M3.G5,0) AS G5       
                 , ISNULL(M3.G6,0) AS G6       
                 , ISNULL(M3.G7,0) AS G7       
                 , ISNULL(M3.G8,0) AS G8       
                 , ISNULL(M3.G8_1,0) AS G8_1   
                 , ISNULL(M3.G8_2,0) AS G8_2   
                 , ISNULL(M3.G8_3,0) AS G8_3   
                 , ISNULL(M3.G9,0) AS G9       
                 , unilite.fnCipherDecrypt(M0.BANK_ACCOUNT1, 'RB') AS BANK_ACCOUNT1           
                 , ISNULL((SELECT CUSTOM_NAME  
                             FROM BCM100T      
                            WHERE COMP_CODE   = #{S_COMP_CODE}
                              AND CUSTOM_CODE = M0.BANK_CODE1                          
                              AND CUSTOM_TYPE = '4'),'') AS BANK_NAME                  
                 , '' AS '5'
                 , '' AS '6'
                 , '' AS '7'
                 , '' AS '8'
                 , '' AS '9'
                 , '' AS '9_1'
                 , '' AS '9_2'
                 , '' AS '9_3'
              FROM HUM100T M0                                                          
                            INNER JOIN HPA600T M1                                      
                                    ON M0.COMP_CODE   = M1.COMP_CODE
                                   AND M0.PERSON_NUMB = M1.PERSON_NUMB                 
                       LEFT OUTER JOIN (SELECT T1.PERSON_NUMB                          
                                             , MAX(CASE WHEN T1.WAGES_CODE = T4.C1     
                                                             THEN T1.AMOUNT_I          
                                                             ELSE 0                    
                                                    END) AS 'S1'                       
                                             , MAX(CASE WHEN T1.WAGES_CODE = T4.C2     
                                                             THEN T1.AMOUNT_I          
                                                             ELSE 0                    
                                                    END) AS 'S2'                       
                                             , MAX(CASE WHEN T1.WAGES_CODE = T4.C3     
                                                             THEN T1.AMOUNT_I          
                                                             ELSE 0                    
                                                    END) AS 'S3'                       
                                             , MAX(CASE WHEN T4.C4 = '999'             
                                                             THEN ISNULL(T5.ETC_AMT,0) 
                                                             ELSE (CASE WHEN T1.WAGES_CODE = T4.C4 
                                                                             THEN T1.AMOUNT_I 
                                                                             ELSE 0    
                                                                    END)               
                                                    END) AS 'S4'                       
                                             , T1.COMP_CODE                            
                                          FROM HPA300T T1                              
                                                        INNER JOIN (SELECT PERSON_NUMB 
                                                                         , SUM(AMOUNT_I) AS ETC_AMT 
                                                                         , COMP_CODE
                                                                      FROM HPA300T 
                                                                     WHERE COMP_CODE  = @COMP_CODE
                                                                       AND PAY_YYYYMM = @PAY_YYYYMM
                                                                       AND SUPP_TYPE  = @SUPP_TYPE
                                                                       AND WAGES_CODE IN (SELECT WAGES_CODE 
                                                                                            FROM HBO800PH_MASTER
                                                                                           WHERE W_SEQ &gt; 4 ) 
                                                                     GROUP BY PERSON_NUMB, COMP_CODE) T5
                                                                ON T1.COMP_CODE   = T5.COMP_CODE
                                                               AND T1.PERSON_NUMB = T5.PERSON_NUMB
                                             , (SELECT MAX(CASE WHEN W_SEQ = 1         
                                                                     THEN WAGES_CODE   
                                                                     ELSE ''           
                                                            END) AS 'C1'               
                                                     , MAX(CASE WHEN W_SEQ = 2         
                                                                     THEN WAGES_CODE   
                                                                     ELSE ''           
                                                            END) AS 'C2'               
                                                     , MAX(CASE WHEN W_SEQ = 3         
                                                                     THEN WAGES_CODE   
                                                                     ELSE ''           
                                                            END) AS 'C3'               
                                                     , MAX(CASE WHEN W_SEQ &gt; 4         
                                                                THEN '999'             
                                                                ELSE (CASE WHEN W_SEQ = 4 
                                                                                THEN WAGES_CODE 
                                                                                ELSE '' 
                                                                       END)            
                                                            END) AS 'C4'               
                                                  FROM HBO800PH_MASTER) T4
                                         WHERE T1.COMP_CODE   = @COMP_CODE
                                           AND T1.PAY_YYYYMM  = @PAY_YYYYMM
                                           AND T1.SUPP_TYPE   = @SUPP_TYPE
                                           AND T1.COMP_CODE   = T5.COMP_CODE
                                           AND T1.PERSON_NUMB = T5.PERSON_NUMB
                                         GROUP BY T1.PERSON_NUMB, T1.COMP_CODE ) M2                
                                   ON M1.COMP_CODE   = M2.COMP_CODE
                                  AND M1.PERSON_NUMB = M2.PERSON_NUMB                
                      LEFT OUTER JOIN (SELECT T1.PERSON_NUMB                         
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C4      
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G4'                      
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C5      
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G5'                      
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C6      
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G6'                      
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C7      
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G7'                      
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C8      
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G8'                      
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C8_1    
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G8_1'                    
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C8_2    
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G8_2'                    
                                            , MAX(CASE WHEN T1.DED_CODE = T4.C8_3    
                                                            THEN T1.DED_AMOUNT_I     
                                                            ELSE 0                   
                                                   END) AS 'G8_3'                    
                                            , MAX(CASE WHEN T4.C9 = '99'             
                                                            THEN ISNULL(T5.ETC_AMT,0)
                                                            ELSE (CASE WHEN T1.DED_CODE = T4.C9 
                                                                            THEN T1.DED_AMOUNT_I 
                                                                            ELSE 0    
                                                                   END)               
                                                   END) AS 'G9'                       
                                            , T1.COMP_CODE                            
                                         FROM HPA400T T1                              
                                                       INNER JOIN (SELECT PERSON_NUMB 
                                                                        , SUM(DED_AMOUNT_I) AS ETC_AMT 
                                                                        , COMP_CODE                            
                                                                     FROM HPA400T
                                                                    WHERE COMP_CODE  = @COMP_CODE
                                                                      AND PAY_YYYYMM = @PAY_YYYYMM
                                                                      AND SUPP_TYPE  = @SUPP_TYPE
                                                                      AND DED_CODE IN (SELECT SUB_CODE 
                                                                                         FROM HPA900PH_MASTER
                                                                                        WHERE SEQ &gt; 6 )
                                                                    GROUP BY PERSON_NUMB, COMP_CODE ) T5
                                                               ON T1.COMP_CODE   = T5.COMP_CODE
                                                              AND T1.PERSON_NUMB = T5.PERSON_NUMB
                                            , (SELECT MAX(CASE WHEN A.SEQ = 1         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C4'               
                                                    , MAX(CASE WHEN A.SEQ = 2         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C5'               
                                                    , MAX(CASE WHEN A.SEQ = 3         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C6'               
                                                    , MAX(CASE WHEN A.SEQ = 4         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C7'               
                                                    , MAX(CASE WHEN A.SEQ = 5         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C8'               
                                                    , MAX(CASE WHEN A.SEQ = 6         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C8_1'             
                                                    , MAX(CASE WHEN A.SEQ = 7         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C8_2'             
                                                    , MAX(CASE WHEN A.SEQ = 8         
                                                                    THEN A.SUB_CODE   
                                                                    ELSE ''           
                                                           END) AS 'C8_3'             
                                                    , MAX(CASE WHEN A.SEQ &gt; 9         
                                                                    THEN '99'         
                                                                    ELSE (CASE WHEN A.SEQ = 9 
                                                                                    THEN A.SUB_CODE 
                                                                                    ELSE '' 
                                                                           END)      
                                                           END) AS 'C9'              
                                                 FROM HPA900PH_MASTER A ) T4                
                                        WHERE T1.COMP_CODE   = @COMP_CODE
                                          AND T1.PAY_YYYYMM  = @PAY_YYYYMM
                                          AND T1.SUPP_TYPE   = @SUPP_TYPE
                                          AND T1.COMP_CODE   = T5.COMP_CODE
                                          AND T1.PERSON_NUMB = T5.PERSON_NUMB
                                        GROUP BY T1.PERSON_NUMB, T1.COMP_CODE) M3          
                                   ON M1.COMP_CODE   = M3.COMP_CODE
                                  AND M1.PERSON_NUMB = M3.PERSON_NUMB                
                   LEFT  JOIN BSA100T B1 WITH (NOLOCK) ON B1.COMP_CODE   = M0.COMP_CODE
                                                      AND B1.MAIN_CODE   = 'H024'
                                                      AND B1.SUB_CODE    = M0.EMPLOY_TYPE
                   LEFT  JOIN BSA100T B2 WITH (NOLOCK) ON B2.COMP_CODE   = M0.COMP_CODE
                                                      AND B2.MAIN_CODE   = 'H181'
                                                      AND B2.SUB_CODE    = ISNULL(B1.REF_CODE1, '')
             WHERE M1.COMP_CODE  = #{S_COMP_CODE}
               AND M1.PAY_YYYYMM = @PAY_YYYYMM
               AND M1.SUPP_TYPE  = @SUPP_TYPE
               
               AND ((M0.DIV_CODE       = @DIV_CODE        AND @DIV_CODE      != '') OR (@DIV_CODE       = ''))
               AND ((M0.DEPT_CODE     &gt;= @FR_DEPT_CODE    AND @FR_DEPT_CODE  != '') OR (@FR_DEPT_CODE   = ''))
               AND ((M0.DEPT_CODE     &lt;= @TO_DEPT_CODE    AND @TO_DEPT_CODE  != '') OR (@TO_DEPT_CODE   = ''))
               
               AND ((M1.PAY_CODE       = @PAY_CODE        AND @PAY_CODE      != '') OR (@PAY_CODE       = ''))
               AND ((M1.SUPP_DATE      = @SUPP_DATE       AND @SUPP_DATE     != '') OR (@SUPP_DATE      = ''))
               AND ((M1.PAY_PROV_FLAG  = @PAY_PROV_FLAG   AND @PAY_PROV_FLAG != '') OR (@PAY_PROV_FLAG  = ''))
               AND ((M0.PAY_GUBUN      = @PAY_GUBUN       AND @PAY_GUBUN     != '') OR (@PAY_GUBUN      = ''))
               AND ((M0.EMPLOY_TYPE    = @EMPLOY_TYPE     AND @EMPLOY_TYPE   != '') OR (@EMPLOY_TYPE    = ''))
               AND ((B2.SUB_CODE       = @PERSON_GROUP    AND @PERSON_GROUP  != '') OR (@PERSON_GROUP   = ''))
               AND ((M0.AFFIL_CODE     = @AFFIL_CODE      AND @AFFIL_CODE    != '') OR (@AFFIL_CODE     = ''))
               AND ((M1.PERSON_NUMB    = @PERSON_NUMB     AND @PERSON_NUMB   != '') OR (@PERSON_NUMB    = ''))

               <if test="OPTYN == &quot;2&quot;">
                    AND M0.RETR_DATE = '00000000'
                </if>
                <if test="OPTYN == &quot;3&quot;">
                    AND M0.RETR_DATE != '00000000'
                </if>
               
             ORDER BY M1.DEPT_CODE, M1.POST_CODE, M0.NAME, M1.PERSON_NUMB 
             
             SET ARITHABORT OFF
             SET NOCOUNT OFF
         
         END
    </select>
    
    
    <select id="hpa700rkrServiceImpl.selectList3_sub"  parameterType="Map" resultType="rMap">
        --hpa700rkrServiceImpl.selectList3_sub
        SELECT MAX(CASE WHEN A.W_SEQ = 1                           
                             THEN A.WAGES_NAME                     
                             ELSE ''                               
                    END) AS '1'                                    
             , MAX(CASE WHEN A.W_SEQ = 2                           
                             THEN A.WAGES_NAME                     
                             ELSE ''                               
                    END) AS '2'                                    
             , MAX(CASE WHEN A.W_SEQ = 3                           
                             THEN A.WAGES_NAME                     
                             ELSE ''                               
                    END) AS '3'                                    
             , MAX(CASE WHEN A.W_SEQ &gt; 4                           
                             THEN 'Z' + uniLITE.fnGetTxt('H0042')  
                             ELSE (CASE WHEN A.W_SEQ = 4           
                                             THEN A.WAGES_NAME     
                                             ELSE ''               
                                    END)                           
                    END) AS '4'                                    
             , MAX(CASE WHEN B.SEQ = 1                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '5'                                    
             , MAX(CASE WHEN B.SEQ = 2                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '6'                                    
             , MAX(CASE WHEN B.SEQ = 3                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '7'                                    
             , MAX(CASE WHEN B.SEQ = 4                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '8'                                    
             , MAX(CASE WHEN B.SEQ = 5                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '9'                                    
             , MAX(CASE WHEN B.SEQ = 6                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '9_1'                                  
             , MAX(CASE WHEN B.SEQ = 7                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '9_2'                                  
             , MAX(CASE WHEN B.SEQ = 8                             
                             THEN B.CODE_NAME                      
                             ELSE ''                               
                    END) AS '9_3'                                  
             , MAX(CASE WHEN B.SEQ &gt; 9                             
                             THEN 'Z' + uniLITE.fnGetTxt('H0044')  
                             ELSE (CASE WHEN B.SEQ = 9             
                                             THEN B.CODE_NAME      
                                             ELSE ''               
                                    END)                           
                    END) AS '10'                                   
          FROM HBO800PH_MASTER A, HPA900PH_MASTER B
    </select>
	
</mapper>