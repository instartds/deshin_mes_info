<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hpa972ukrServiceImpl">
	
	<select id="hpa972ukrServiceImpl.selectListA" parameterType="Map" resultType="rMap">
		--hpa972ukrServiceImpl.selectListA
		/*************************************************************************************************************
			위택스 지방소득세 신고자료 (A 레코드) 조회
		*************************************************************************************************************/
		-- 1. A103900 : 지방소득세 특별징수 납부서 및 영수필통지서(서식42호)
		-- 특별징수 납부서 - Header
		BEGIN
		    DECLARE @CompCode       NVARCHAR(8)
		          , @BillDivCode    NVARCHAR(8)
		          , @PayYyyymm      NVARCHAR(6)
		          , @SuppYyyymm     NVARCHAR(6)
		          , @ReportDate     NVARCHAR(8)
		          , @BussOfficeCode NVARCHAR(8)
		      
		    SET @CompCode       = #{S_COMP_CODE}
		    SET @BillDivCode    = #{DIV_CODE}
		    SET @PayYyyymm      = #{PAY_YYYYMM}
		    SET @SuppYyyymm     = #{SUPP_YYYYMM}
		    SET @ReportDate     = #{SUBMIT_DATE}
		    SET @BussOfficeCode = #{BUSS_OFFICE_CODE}
		    SET @BussOfficeCode = CASE WHEN ISNULL(@BussOfficeCode,'') = '' THEN '%' ELSE @BussOfficeCode END
		    
        SELECT '21'                                         AS DATA_DIV         -- 1 자료구분
	         , 'A103900'                                    AS DOC_COD          -- 2 서식코드
	         , ISNULL(C.REF_CODE1,'')                       AS SIDO_COD         -- 3 사업장소재지 시도코드
	         , ISNULL(C.REF_CODE2,'')                       AS SGG_COD          -- 4 사업장소재지 시군구코드
	         , ISNULL(C.REF_CODE3,'')                       AS LDONG_COD        -- 5 사업장소재지 법정동코드
	         , '140004'                                     AS TAX_ITEM         -- 6 세목코드
	         , LEFT(@ReportDate,6)                          AS TAX_YYMM         -- 7 과세년월
	         , '3'                                          AS TAX_DIV          -- 8 과세구분
	         , '1'                                          AS REQ_DIV          -- 9 납부구분
	         , @ReportDate                                  AS TAX_DT           --10 신고일자
	         , ISNULL(C.REF_CODE4,'')                       AS TPR_COD          --11 개인/법인구분
	         , D.COMP_OWN_NO                                AS REG_NO           --12 주민(법인)등록번호
	         , D.COMP_NAME                                  AS REG_NM           --13 성명(법인명)
	         , ISNULL(A.COMPANY_NUM,'')                     AS BIZ_NO           --14 사업자등록번호
	         , D.COMP_NAME                                  AS CMP_NM           --15 상호
	         , ISNULL(A.ZIP_CODE,'')                        AS BIZ_ZIP_NO       --16 사업장소재지 우편번호
	         , ISNULL(A.ADDR,'')                            AS BIZ_ADDR         --17 사업장 주소
	         , ISNULL(A.TELEPHON,'')                        AS BIZ_TEL          --18 전화번호
	         , ISNULL(A.HANDPHONE,'')                       AS MO_TEL           --19 핸드폰번호
	         , @SuppYyyymm                                  AS SUP_YYMM         --20 지급연월
	         , @PayYyyymm                                   AS RVSN_YYMM        --21 귀속연월
	         , CONVERT(VARCHAR(8), DATEADD(M, 1, @SuppYyyymm + '10'), 112)	AS F_DUE_DT         --22 당초납기일자
	         , (CASE WHEN @ReportDate &gt; CONVERT(VARCHAR(8), DATEADD(M, 1, @SuppYyyymm + '10'), 112)
	                 THEN @ReportDate
	                 ELSE CONVERT(VARCHAR(8), DATEADD(M, 1, @SuppYyyymm + '10'), 112)
	             END)                                       AS DUE_DT            --23 납기일자
	         , 10.0                                          AS TAX_RT           --24 세율
	         , B.TXTP_STD                                    AS TOT_STD_AMT      --25 과세표준합계
	         , B.TXTP_INTX                                   AS PAY_RSTX         --26 지방소득세합계
	         , '2'                                           AS ADTX_YN          --27 가산세유무
	         , 0                                             AS ADTX_AM          --28 가산세1정액
	         , 0                                             AS DLQ_ADTX         --29 가산세2지연기간
	         , 0                                             AS DLQ_CNT          --30 납부지연일수
	         , 0                                             AS PAY_ADTX         --31 가산세
	         , ''                                            AS MEMO             --32 비고
	         , 0                                             AS ADD_MM_RTN       --33 당월기타환급액
	         , 0                                             AS ADD_MM_AAMT      --34 당월추가납부액
	         , ISNULL(F.YEAR_END_LOC_TAX_RE,0)     		     AS ADD_YY_TRTN      --35 연말정산환급액
	         , ISNULL(F.YEAR_END_LOC_TAX_AD,0)               AS ADD_YY_TAMT      --36 연말정산추가납부액
	         , ISNULL(E.YEAR_MID_LOC_TAX_RE,0)				 AS ADD_ETC_RTN      --37 중도퇴사자환급액
	         , 0                                             AS ADD_RDT_ADTX     --38 가산세대상추가납부액
	         , 0                                             AS ADD_RDT_AADD     --39 가산세대상추가가산세
	         , ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0) AS ADD_SUM_RTN      --40 환급합계금액(33+35+37)
	         , ISNULL(F.YEAR_END_LOC_TAX_AD,0)                                   AS ADD_SUM_AAMT     --41 추가납부합계금액(34+36+38+39)
	         , ABS(ISNULL(F.YEAR_END_LOC_TAX_AD,0) - (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0))) AS ADD_OUT_AMT --42 가감조정금액(41-40)
	         , CASE WHEN ISNULL(B.TXTP_INTX,0) + 0 + (ISNULL(F.YEAR_END_LOC_TAX_AD,0) - (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0))) &lt; 0 THEN 0 
			        ELSE ISNULL(B.TXTP_INTX,0) + 0 + (ISNULL(F.YEAR_END_LOC_TAX_AD,0) - (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0))) 
			    END                                          AS ADD_TOT_AMT      --43 납부총금액
	         , CASE WHEN ISNULL(B.TXTP_INTX,0) + 0 + (ISNULL(F.YEAR_END_LOC_TAX_AD,0) - (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0))) &lt; 0 THEN 0 
			        ELSE ISNULL(B.TXTP_INTX,0) + 0 + (ISNULL(F.YEAR_END_LOC_TAX_AD,0) - (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0))) 
			    END                                          AS INTX             --44 납부할 지방소득세
	         , 0                                             AS TOT_ADTX         --45 납부할 가산세
	         , CASE WHEN (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0)) - (ISNULL(B.TXTP_INTX,0) + ISNULL(F.YEAR_END_LOC_TAX_AD,0)) &lt; 0 THEN 0
			        ELSE (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0)) - (ISNULL(B.TXTP_INTX,0) + ISNULL(F.YEAR_END_LOC_TAX_AD,0))
			    END                                          AS ADD_OUT_SAMT     --46 차감후환급잔액
	         , CASE WHEN ISNULL(F.YEAR_END_LOC_TAX_AD,0) - (ISNULL(F.YEAR_END_LOC_TAX_RE,0) + ISNULL(E.YEAR_MID_LOC_TAX_RE,0)) &lt; 0 THEN 'Y' ELSE 'N' END AS MINU_YN --47 가감조정금액음수값여부
	         , ''                                            AS RPT_REG_NO       --48 세무대리인주민등록번호
	         , ''                                            AS RPT_NM           --49 세무대리인성명
	         , ''                                            AS RPT_BIZ_NO       --50 세무대리인사업자등록번호
	         , ''                                            AS RPT_TEL          --51 세무대리인전화번호
	         , '9000'                                        AS TAX_PRO_CD       --52 세무프로그램코드
	         , ''                                            AS A_SPACE          --53 공란
			 , A.DIV_CODE
	      FROM            BOR120T A WITH (NOLOCK)
	           LEFT JOIN (SELECT A.COMP_CODE
	                           , A.SECT_CODE        AS BILL_DIV_CODE
							   , A.DIV_CODE
	                           , SUM(A.TXTP_STD)    AS TXTP_STD
	                           , SUM(A.TXTP_INTX)   AS TXTP_INTX
	                        FROM (--이자소득
	                              SELECT A.COMP_CODE
	                                   , A.SECT_CODE
									   , A.DIV_CODE
	                                   , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '11'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(A.IN_TAX_I)	  AS TXTP_STD         -- 과세표준
	                                   , SUM(A.LOCAL_TAX_I)   AS TXTP_INTX        -- 지방소득세
	                                FROM            HPB200T A WITH (NOLOCK)
	                                     INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                       AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                                       AND B.DED_TYPE    = A.DED_TYPE
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND A.SECT_CODE         = @BillDivCode
	                                 AND A.PAY_YYYYMM        = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                 AND A.DED_TYPE          = '10'
	                                 AND B.BUSINESS_TYPE    != '1'
	                                 AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6)
	  
	                              UNION ALL
	  
	                              --배당소득
	                              SELECT A.COMP_CODE
	                                   , A.SECT_CODE
									   , A.DIV_CODE
	                                   , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '12'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(A.IN_TAX_I)	  AS TXTP_STD         -- 과세표준
	                                   , SUM(A.LOCAL_TAX_I)   AS TXTP_INTX        -- 지방소득세
	                                FROM            HPB200T A WITH (NOLOCK)
	                                     INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                       AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                                       AND B.DED_TYPE    = A.DED_TYPE
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND A.SECT_CODE         = @BillDivCode
	                                 AND A.PAY_YYYYMM        = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                 AND A.DED_TYPE          = '20'
	                                 AND B.BUSINESS_TYPE     != '1'
	                                 AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6)
	  
	                              UNION ALL
	  
	                              --사업소득
	                              SELECT A.COMP_CODE
	                                   , A.SECT_CODE
									   , A.DIV_CODE
	                                   , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '13'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(A.IN_TAX_I)      AS TXTP_STD	      -- 과세표준
	                                   , SUM(A.LOCAL_TAX_I)   AS TXTP_INTX        -- 지방소득세
	                                FROM            HPB200T A WITH (NOLOCK)
	                                     INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                       AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                                       AND B.DED_TYPE    = A.DED_TYPE
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND A.SECT_CODE         = @BillDivCode
	                                 AND A.PAY_YYYYMM        = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                 AND A.DED_TYPE          = '1'
	                                 AND B.BUSINESS_TYPE    != '1'
	                                 AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6)
	  
	                              UNION ALL
	  
	                              --근로소득
	                              SELECT A.COMP_CODE
	                                   , C.SECT_CODE
									   , A.DIV_CODE
	                                   , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '14'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(CASE WHEN B.DED_CODE = 'INC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_STD  -- 과세표준
	                                   , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_INTX -- 지방소득세
	                                FROM          HPA600T A WITH (NOLOCK)
	  	                               INNER JOIN HPA400T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE     
	  									                                 AND B.PERSON_NUMB = A.PERSON_NUMB   
	  									                                 AND B.PAY_YYYYMM  = A.PAY_YYYYMM    
	  									                                 AND B.SUPP_TYPE   = A.SUPP_TYPE     
	  	                               INNER JOIN HUM100T C WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE     
	  									                                 AND C.PERSON_NUMB = A.PERSON_NUMB   
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND C.SECT_CODE         = @BillDivCode
	                                 AND A.PAY_YYYYMM        = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                 AND ((A.PAY_GUBUN = '1') OR (A.PAY_GUBUN = '2' AND A.PAY_GUBUN2 != '1'))             
 	  	                             AND B.DED_CODE IN ('INC', 'LOC' )
	                                 AND ISNULL(C.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, C.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6)
	  
	                              UNION ALL
	  
	                              --근로소득(일용직)
	                              SELECT A.COMP_CODE
	                                   , C.SECT_CODE
									   , A.DIV_CODE
	                                   , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '14'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(CASE WHEN B.DED_CODE = 'INC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_STD  -- 과세표준
	                                   , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_INTX -- 지방소득세
	                                FROM          HPA600T A WITH (NOLOCK)
	  	                               INNER JOIN HPA400T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE     
	  									                                 AND B.PERSON_NUMB = A.PERSON_NUMB   
	  									                                 AND B.PAY_YYYYMM  = A.PAY_YYYYMM    
	  									                                 AND B.SUPP_TYPE   = A.SUPP_TYPE     
	  	                               INNER JOIN HUM100T C WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE     
	  									                                 AND C.PERSON_NUMB = A.PERSON_NUMB   
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND C.SECT_CODE         = @BillDivCode
	                                 AND A.PAY_YYYYMM        = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                 AND A.PAY_GUBUN         = '2'
	                                 AND A.PAY_GUBUN2        = '1'
	  	                             AND B.DED_CODE         IN ('INC', 'LOC')
	                                 AND ISNULL(C.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, C.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6)
	  
	                              UNION ALL
	  
	                              --기타소득
	                              SELECT A.COMP_CODE
	                                   , A.SECT_CODE
									   , A.DIV_CODE
	                                   , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '14'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(A.IN_TAX_I)	  AS TXTP_STD         -- 과세표준
	                                   , SUM(A.LOCAL_TAX_I)   AS TXTP_INTX        -- 지방소득세
	                                FROM            HPB200T A WITH (NOLOCK)
	                                     INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                       AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                                       AND B.DED_TYPE    = A.DED_TYPE
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND A.SECT_CODE         = @BillDivCode
	                                 AND A.PAY_YYYYMM        = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                 AND A.DED_TYPE          = '2'
	                                 AND B.BUSINESS_TYPE    != '1'
	                                 AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6)
	  
	                              UNION ALL
	  
	                              --퇴직소득
	                              SELECT A.COMP_CODE
	                                   , B.SECT_CODE
									   , B.DIV_CODE
	                                   , LEFT(A.RETR_DATE,6)  AS PAY_YYYYMM       -- 귀속연월
	                                   , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
	                                   , '21'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                                   , SUM(A.BAL_IN_TAX_I   ) - ISNULL(SUM(C.BAL_IN_TAX_I   ),0)    AS TXTP_STD         -- 과세표준
	                                   , SUM(A.BAL_LOCAL_TAX_I) - ISNULL(SUM(C.BAL_LOCAL_TAX_I),0)    AS TXTP_INTX        -- 지방소득세
	                                FROM            HRT500T A WITH (NOLOCK)
	                                     INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                       AND B.PERSON_NUMB = A.PERSON_NUMB
	                                     LEFT  JOIN (SELECT A.COMP_CODE
	                                                      , A.PERSON_NUMB
	                                                      , A.BAL_IN_TAX_I
	                                                      , A.BAL_LOCAL_TAX_I
	                                                   FROM            HRT500T A WITH (NOLOCK)
	                                                        INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
	                                                                                          AND B.PERSON_NUMB = A.PERSON_NUMB 
	                                                        INNER JOIN (SELECT A.COMP_CODE
	                                                                         , A.PERSON_NUMB
	                                                                         , A.RETR_DATE
	                                                                      FROM            HRT500T A WITH (NOLOCK)
	                                                                           INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                                                             AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                                     WHERE A.COMP_CODE         = @CompCode
	                                                                       AND B.SECT_CODE         = @BillDivCode
	                                                                       AND LEFT(A.RETR_DATE,6) = @PayYyyymm
	                                                                       AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                                                       AND A.RETR_TYPE         = 'R') C ON C.COMP_CODE         = A.COMP_CODE
	                                                                                                       AND C.PERSON_NUMB       = A.PERSON_NUMB
	                                                                                                       AND LEFT(C.RETR_DATE,4) = LEFT(A.SUPP_DATE,4)            
	                                                  WHERE A.COMP_CODE = @CompCode      
	                                                    AND B.SECT_CODE = @BillDivCode
	                                                    AND A.RETR_TYPE = 'M') C ON C.COMP_CODE   = A.COMP_CODE
	                                                                            AND C.PERSON_NUMB = A.PERSON_NUMB
	                               WHERE A.COMP_CODE         = @CompCode
	                                 AND B.SECT_CODE         = @BillDivCode
	                                 AND LEFT(A.RETR_DATE,6) = @PayYyyymm
	                                 AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	  	                             AND A.RETR_TYPE         != 'S'    
	  	                             AND B.RETR_PENSION_KIND != 'DC'
	                                 AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	                               GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, LEFT(A.RETR_DATE,6), LEFT(A.SUPP_DATE,6)
                                   UNION ALL

                                    --외국법인
                                    SELECT A.COMP_CODE
                                         , A.SECT_CODE
                                         , A.DIV_CODE
                                         , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
                                         , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
                                         , '31'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직,31:외국법인,33:내국법인)                                  
                                         , SUM(A.CP_TAX_I)      AS TXTP_STD         -- 과세표준
                                         , SUM(A.LOCAL_TAX_I)   AS TXTP_INTX        -- 지방소득세
                                      FROM            HPB200T A WITH (NOLOCK)
                                           INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
                                                                             AND B.PERSON_NUMB = A.PERSON_NUMB
                                                                             AND B.DED_TYPE    = A.DED_TYPE
                                     WHERE A.COMP_CODE         = @CompCode
                                       AND A.SECT_CODE         = @BillDivCode
                                       AND A.PAY_YYYYMM        = @PayYyyymm
                                       AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
                                       AND A.DED_TYPE          IN ('1','2','10','20')
                                       AND B.BUSINESS_TYPE    = '1'
                                       AND B.FOREIGN_YN      != '1'
	                                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                     GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM

                                    UNION ALL

                                    --내국법인
                                    SELECT A.COMP_CODE
                                         , A.SECT_CODE
                                         , A.DIV_CODE
                                         , A.PAY_YYYYMM         AS PAY_YYYYMM       -- 귀속연월
                                         , LEFT(A.SUPP_DATE,6)  AS SUPP_YYYYMM      -- 지급연월
                                         , '33'                 AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직,31:외국법인,33:내국법인)                                 
                                         , SUM(A.CP_TAX_I)      AS TXTP_STD         -- 과세표준
                                         , SUM(A.LOCAL_TAX_I)   AS TXTP_INTX        -- 지방소득세
                                      FROM            HPB200T A WITH (NOLOCK)
                                           INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
                                                                             AND B.PERSON_NUMB = A.PERSON_NUMB
                                                                             AND B.DED_TYPE    = A.DED_TYPE
                                     WHERE A.COMP_CODE         = @CompCode
                                       AND A.SECT_CODE         = @BillDivCode
                                       AND A.PAY_YYYYMM        = @PayYyyymm
                                       AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
                                       AND A.DED_TYPE          IN ('1','2','10','20')
                                       AND B.BUSINESS_TYPE    = '1'
                                       AND B.FOREIGN_YN       = '1'
	                                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                     GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM
                                   ) A	                               
	                       GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE ) B ON B.COMP_CODE     = A.COMP_CODE
	                                                                        AND B.BILL_DIV_CODE = A.BILL_DIV_CODE
	                                                                        AND B.DIV_CODE      = A.DIV_CODE
				--중간정산환급
				LEFT JOIN (SELECT A.COMP_CODE
					            , B.SECT_CODE AS BILL_DIV_CODE
								, B.DIV_CODE									                      
								, ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I)) ELSE 0 END, 0) AS YEAR_MID_LOC_TAX_RE
							 FROM            HAD600T A WITH (NOLOCK) 
								  INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE      
													                AND B.PERSON_NUMB = A.PERSON_NUMB
							WHERE A.COMP_CODE          = @CompCode               
							  AND A.YEAR_YYYY          = LEFT(@PayYyyymm, 4)         
							  AND A.HALFWAY_TYPE       = 'Y'
							  AND LEFT(A.RETR_DATE, 6) = @PayYyyymm
							  AND B.SECT_CODE          = @BillDivCode
	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
						     GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE) AS E ON E.COMP_CODE     = A.COMP_CODE
							                                                    AND E.BILL_DIV_CODE = A.BILL_DIV_CODE	
																				AND E.DIV_CODE      = A.DIV_CODE
				--연말정산환급/추가
                LEFT JOIN (SELECT A.COMP_CODE
                                , A.SECT_CODE AS BILL_DIV_CODE
                                , A.DIV_CODE
                                , SUM(A.YEAR_END_LOC_TAX_RE) AS YEAR_END_LOC_TAX_RE
                                , SUM(A.YEAR_END_LOC_TAX_AD) AS YEAR_END_LOC_TAX_AD
                             FROM (--2월귀속 2월지급인      경우 연말정산금액 - 2차분납금액 - 3차분납금액
                                   --2월귀속 2월지급이 아닌 경우 귀속연월의 분납금액
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &gt; 0 THEN SUM(A.LOCAL_TAX_I)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD600T AS A WITH (NOLOCK)                     
                                          INNER JOIN HUM100T AS B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                                                AND B.PERSON_NUMB = A.PERSON_NUMB
                                    WHERE A.COMP_CODE          = @CompCode
                                      AND A.YEAR_YYYY          = DATEADD(YEAR, -1, LEFT(@PayYyyymm, 4))   
                                      AND A.HALFWAY_TYPE       = 'N'
                                      AND B.SECT_CODE          = @BillDivCode 
                                      AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                   UNION ALL
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_01)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &gt; 0 THEN SUM(A.LOCAL_TAX_I_01)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD950T A WITH (NOLOCK)
                                          INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                            AND B.PERSON_NUMB      = A.PERSON_NUMB
                                    WHERE A.COMP_CODE         = @CompCode
                                      AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                      AND B.SECT_CODE         = @BillDivCode 
                                      AND A.PAY_YYYYMM_01    != @PayYyyyMm
                                      AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                   UNION ALL
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_02)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &gt; 0 THEN SUM(A.LOCAL_TAX_I_02)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD950T A WITH (NOLOCK)
                                          INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                            AND B.PERSON_NUMB      = A.PERSON_NUMB
                                    WHERE A.COMP_CODE         = @CompCode
                                      AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                      AND B.SECT_CODE         = @BillDivCode 
                                      AND A.PAY_YYYYMM_02    != @PayYyyyMm
                                      AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                   UNION ALL
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_03)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &gt; 0 THEN SUM(A.LOCAL_TAX_I_03)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD950T A WITH (NOLOCK)
                                          INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                            AND B.PERSON_NUMB      = A.PERSON_NUMB
                                    WHERE A.COMP_CODE         = @CompCode
                                      AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                      AND B.SECT_CODE         = @BillDivCode 
                                      AND A.PAY_YYYYMM_03    != @PayYyyyMm
                                      AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                   UNION ALL
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_01)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &gt; 0 THEN SUM(A.LOCAL_TAX_I_01)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD950T A WITH (NOLOCK)
                                          INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                            AND B.PERSON_NUMB      = A.PERSON_NUMB
                                    WHERE A.COMP_CODE         = @CompCode
                                      AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                      AND B.SECT_CODE         = @BillDivCode 
                                      AND A.PAY_YYYYMM_01     = @PayYyyyMm
                                      AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                   UNION ALL
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_02)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &gt; 0 THEN SUM(A.LOCAL_TAX_I_02)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD950T A WITH (NOLOCK)
                                          INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                            AND B.PERSON_NUMB      = A.PERSON_NUMB
                                    WHERE A.COMP_CODE         = @CompCode
                                      AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                      AND B.SECT_CODE         = @BillDivCode 
                                      AND A.PAY_YYYYMM_02     = @PayYyyyMm
                                      AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                   UNION ALL
                                   SELECT A.COMP_CODE
                                        , B.SECT_CODE
                                        , B.DIV_CODE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_03)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                        , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &gt; 0 THEN SUM(A.LOCAL_TAX_I_03)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                     FROM            HAD950T A WITH (NOLOCK)
                                          INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                            AND B.PERSON_NUMB      = A.PERSON_NUMB
                                    WHERE A.COMP_CODE         = @CompCode
                                      AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                      AND B.SECT_CODE         = @BillDivCode 
                                      AND A.PAY_YYYYMM_03     != @PayYyyyMm
                                      AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
         	                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                    GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE) A
                            GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE) AS F ON F.COMP_CODE     = A.COMP_CODE
                                                                               AND F.BILL_DIV_CODE = A.BILL_DIV_CODE
                                                                               AND F.DIV_CODE      = A.DIV_CODE
	            LEFT  JOIN BSA100T C WITH (NOLOCK) ON C.COMP_CODE = A.COMP_CODE
	                                              AND C.MAIN_CODE = 'H226'
	                                              AND C.SUB_CODE != '$'
	                                              AND C.SUB_CODE  = A.DIV_CODE
	            LEFT  JOIN BOR100T D WITH (NOLOCK) ON A.COMP_CODE = D.COMP_CODE
	     WHERE A.COMP_CODE		= @CompCode
	       AND A.BILL_DIV_CODE	= @BillDivCode
	       AND ISNULL(NULLIF(A.USE_YN, ''), 'Y')	= 'Y'
       END 
	</select>

	<select id="hpa972ukrServiceImpl.selectListB" parameterType="Map" resultType="rMap">
		--hpa972ukrServiceImpl.selectListB
		/*************************************************************************************************************
			위택스 지방소득세 신고자료 (B 레코드) 조회
		*************************************************************************************************************/
		--특별징수 납부세액 명세서
		BEGIN
		    DECLARE @CompCode       NVARCHAR(8)
		          , @BillDivCode    NVARCHAR(8)
		          , @PayYyyymm      NVARCHAR(6)
		          , @SuppYyyymm     NVARCHAR(6)
		          , @ReportDate     NVARCHAR(8)
		          , @BussOfficeCode NVARCHAR(8)
		      
		    SET @CompCode       = #{S_COMP_CODE}
		    SET @BillDivCode    = #{DIV_CODE}
		    SET @PayYyyymm      = #{PAY_YYYYMM}
		    SET @SuppYyyymm     = #{SUPP_YYYYMM}
		    SET @ReportDate     = #{SUBMIT_DATE}
		    SET @BussOfficeCode = #{BUSS_OFFICE_CODE}
		    SET @BussOfficeCode = CASE WHEN ISNULL(@BussOfficeCode,'') = '' THEN '%' ELSE @BussOfficeCode END
		
	    SELECT '22'                                         AS DATA_DIV     -- 1 자료구분
	         , 'A103900'                                    AS DOC_COD      -- 2 서식코드
	         , A.TXTP_CD                                    AS TXTP_CD      -- 3 소득구분
	         , SUM(A.TXTP_EMP)                              AS TXTP_EMP     -- 4 인원
	         , SUM(A.TXTP_STD)                              AS TXTP_STD     -- 5 과세표준액
	         , SUM(A.TXTP_INTX)                             AS TXTP_INTX    -- 6 지방소득세
	         , A.DIV_CODE
	      FROM (--이자소득
	            SELECT A.COMP_CODE
	                 , A.SECT_CODE
	                 , A.DIV_CODE
	                 , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '11'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(A.IN_TAX_I)		         AS TXTP_STD         -- 과세표준
	                 , SUM(A.LOCAL_TAX_I)            AS TXTP_INTX        -- 지방소득세
	              FROM            HPB200T A WITH (NOLOCK)
	                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                     AND B.DED_TYPE    = A.DED_TYPE
	             WHERE A.COMP_CODE         = @CompCode
	               AND A.SECT_CODE         = @BillDivCode
	               AND A.PAY_YYYYMM        = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	               AND A.DED_TYPE          = '10'
	               AND B.BUSINESS_TYPE    != '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM
	
	            UNION ALL
	
	            --배당소득
	            SELECT A.COMP_CODE
	                 , A.SECT_CODE
	                 , A.DIV_CODE
	                 , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '12'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(A.IN_TAX_I)		         AS TXTP_STD         -- 과세표준
	                 , SUM(A.LOCAL_TAX_I)            AS TXTP_INTX        -- 지방소득세
	              FROM            HPB200T A WITH (NOLOCK)
	                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                     AND B.DED_TYPE    = A.DED_TYPE
	             WHERE A.COMP_CODE         = @CompCode
	               AND A.SECT_CODE         = @BillDivCode
	               AND A.PAY_YYYYMM        = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	               AND A.DED_TYPE          = '20'
	               AND B.BUSINESS_TYPE    != '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM
	
	            UNION ALL
	
	            --사업소득
	            SELECT A.COMP_CODE
	                 , A.SECT_CODE
	                 , A.DIV_CODE
	                 , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '13'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(A.IN_TAX_I)		         AS TXTP_STD         -- 과세표준
	                 , SUM(A.LOCAL_TAX_I)            AS TXTP_INTX        -- 지방소득세
	              FROM            HPB200T A WITH (NOLOCK)
	                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                     AND B.DED_TYPE    = A.DED_TYPE
	             WHERE A.COMP_CODE         = @CompCode
	               AND A.SECT_CODE         = @BillDivCode
	               AND A.PAY_YYYYMM        = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	               AND A.DED_TYPE          = '1'
	               AND B.BUSINESS_TYPE    != '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM
	
	            UNION ALL
	
	            --근로소득
	            SELECT A.COMP_CODE
	                 , C.SECT_CODE
	                 , C.DIV_CODE
	                 , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '14'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT C.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(CASE WHEN B.DED_CODE = 'INC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_STD  -- 과세표준
	                 , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_INTX -- 지방소득세
	              FROM            HPA600T A WITH (NOLOCK)
		               INNER JOIN HPA400T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE     
										                 AND B.PERSON_NUMB = A.PERSON_NUMB   
										                 AND B.PAY_YYYYMM  = A.PAY_YYYYMM    
										                 AND B.SUPP_TYPE   = A.SUPP_TYPE     
		               INNER JOIN HUM100T C WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE     
										                 AND C.PERSON_NUMB = A.PERSON_NUMB   
	             WHERE A.COMP_CODE         = @CompCode
	               AND C.SECT_CODE         = @BillDivCode
	               AND A.PAY_YYYYMM        = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	               AND ((A.PAY_GUBUN = '1') OR (A.PAY_GUBUN = '2' AND A.PAY_GUBUN2 != '1'))           
		           AND B.DED_CODE IN ('INC', 'LOC' )    
                   AND ISNULL(C.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, C.SECT_CODE, C.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), C.REPRE_NUM
	
	            UNION ALL
	
	            --근로소득(일용직)
	            SELECT A.COMP_CODE
	                 , C.SECT_CODE
	                 , C.DIV_CODE
	                 , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '14'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT C.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(CASE WHEN B.DED_CODE = 'INC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_STD  -- 과세표준
	                 , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_INTX -- 지방소득세
	              FROM            HPA600T A WITH (NOLOCK)
		               INNER JOIN HPA400T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE     
										                 AND B.PERSON_NUMB = A.PERSON_NUMB   
										                 AND B.PAY_YYYYMM  = A.PAY_YYYYMM    
										                 AND B.SUPP_TYPE   = A.SUPP_TYPE     
		               INNER JOIN HUM100T C WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE     
										                 AND C.PERSON_NUMB = A.PERSON_NUMB   
	             WHERE A.COMP_CODE         = @CompCode
	               AND C.SECT_CODE         = @BillDivCode
	               AND A.PAY_YYYYMM        = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	               AND A.PAY_GUBUN         = '2'
	               AND A.PAY_GUBUN2        = '1'
		           AND B.DED_CODE          IN ('INC', 'LOC')     
                   AND ISNULL(C.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, C.SECT_CODE, C.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), C.REPRE_NUM
	
	            UNION ALL
	
	            --기타소득
	            SELECT A.COMP_CODE
	                 , A.SECT_CODE
	                 , A.DIV_CODE
	                 , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '14'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(A.SUPP_TOTAL_I)           AS TXTP_STD         -- 과세표준
	                 , SUM(A.LOCAL_TAX_I)            AS TXTP_INTX        -- 지방소득세
	              FROM            HPB200T A WITH (NOLOCK)
	                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                     AND B.DED_TYPE    = A.DED_TYPE
	             WHERE A.COMP_CODE         = @CompCode
	               AND A.SECT_CODE         = @BillDivCode
	               AND A.PAY_YYYYMM        = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	               AND A.DED_TYPE          = '2'
	               AND B.BUSINESS_TYPE    != '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM
	
	            UNION ALL
	
	            --퇴직소득
	            SELECT A.COMP_CODE
	                 , B.SECT_CODE
	                 , B.DIV_CODE
	                 , LEFT(A.RETR_DATE,6)           AS PAY_YYYYMM       -- 귀속연월
	                 , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
	                 , '21'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
	                 , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
	                 , SUM(A.BAL_IN_TAX_I   ) - ISNULL(SUM(C.BAL_IN_TAX_I   ),0)    AS TXTP_STD         -- 과세표준
	                 , SUM(A.BAL_LOCAL_TAX_I) - ISNULL(SUM(C.BAL_LOCAL_TAX_I),0)    AS TXTP_INTX        -- 지방소득세
	              FROM            HRT500T A WITH (NOLOCK)
	                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
	                   LEFT  JOIN (SELECT A.COMP_CODE
	                                    , A.PERSON_NUMB
	                                    , A.BAL_IN_TAX_I
	                                    , A.BAL_LOCAL_TAX_I
	                                 FROM            HRT500T A WITH (NOLOCK)
	                                      INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
	                                                                        AND B.PERSON_NUMB = A.PERSON_NUMB 
	                                      INNER JOIN (SELECT A.COMP_CODE
	                                                       , A.PERSON_NUMB
	                                                       , A.RETR_DATE
	                                                    FROM            HRT500T A WITH (NOLOCK)
	                                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
	                                                                                           AND B.PERSON_NUMB = A.PERSON_NUMB
	                                                   WHERE A.COMP_CODE         = @CompCode
	                                                     AND B.SECT_CODE         = @BillDivCode
	                                                     AND LEFT(A.RETR_DATE,6) = @PayYyyymm
	                                                     AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
	                                                     AND A.RETR_TYPE         = 'R') C ON C.COMP_CODE         = A.COMP_CODE
	                                                                                     AND C.PERSON_NUMB       = A.PERSON_NUMB
	                                                                                     AND LEFT(C.RETR_DATE,4) = LEFT(A.SUPP_DATE,4)            
	                                WHERE A.COMP_CODE = @CompCode      
	                                  AND B.SECT_CODE = @BillDivCode
	                                  AND A.RETR_TYPE = 'M') C ON C.COMP_CODE   = A.COMP_CODE
	                                                          AND C.PERSON_NUMB = A.PERSON_NUMB
	             WHERE A.COMP_CODE         = @CompCode
	               AND B.SECT_CODE         = @BillDivCode
	               AND LEFT(A.RETR_DATE,6) = @PayYyyymm
	               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		           AND A.RETR_TYPE         != 'S'    
		           AND B.RETR_PENSION_KIND != 'DC'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
	             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, LEFT(A.RETR_DATE,6), LEFT(A.SUPP_DATE,6), B.REPRE_NUM
	
	                UNION ALL
                
                --외국법인
                SELECT A.COMP_CODE
                     , A.SECT_CODE
                     , A.DIV_CODE
                     , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
                     , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
                     , '31'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직,31:외국법인,33:내국법인)
                     , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
                     , SUM(A.CP_TAX_I)               AS TXTP_STD         -- 과세표준
                     , SUM(A.LOCAL_TAX_I)            AS TXTP_INTX        -- 지방소득세
                  FROM            HPB200T A WITH (NOLOCK)
                       INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
                                                         AND B.PERSON_NUMB = A.PERSON_NUMB
                                                         AND B.DED_TYPE    = A.DED_TYPE
                 WHERE A.COMP_CODE         = @CompCode
                   AND A.SECT_CODE         = @BillDivCode
                   AND A.PAY_YYYYMM        = @PayYyyymm
                   AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
                   AND A.DED_TYPE          IN ('1','2','10','20')
                   AND B.BUSINESS_TYPE    = '1'
                   AND B.FOREIGN_YN      != '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                 GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM

                UNION ALL
                
                --내국법인
                SELECT A.COMP_CODE
                     , A.SECT_CODE
                     , A.DIV_CODE
                     , A.PAY_YYYYMM                  AS PAY_YYYYMM       -- 귀속연월
                     , LEFT(A.SUPP_DATE,6)           AS SUPP_YYYYMM      -- 지급연월
                     , '33'                          AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직,31:외국법인,33:내국법인)
                     , COUNT(DISTINCT B.REPRE_NUM)   AS TXTP_EMP         -- 인원
                     , SUM(A.CP_TAX_I)               AS TXTP_STD         -- 과세표준
                     , SUM(A.LOCAL_TAX_I)            AS TXTP_INTX        -- 지방소득세
                  FROM            HPB200T A WITH (NOLOCK)
                       INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
                                                         AND B.PERSON_NUMB = A.PERSON_NUMB
                                                         AND B.DED_TYPE    = A.DED_TYPE
                 WHERE A.COMP_CODE         = @CompCode
                   AND A.SECT_CODE         = @BillDivCode
                   AND A.PAY_YYYYMM        = @PayYyyymm
                   AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
                   AND A.DED_TYPE          IN ('1','2','10','20')
                   AND B.BUSINESS_TYPE    = '1'
                   AND B.FOREIGN_YN       = '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                 GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), B.REPRE_NUM  
                   			 
				UNION ALL
				
				--가감세액(조정액)
				SELECT A.COMP_CODE
				     , A.SECT_CODE
					 , A.DIV_CODE
				     , ''
					 , ''
					 , '34'
					 , 0
					 , 0
					 , ISNULL(B.YEAR_END_LOC_TAX_AD,0) - (ISNULL(B.YEAR_END_LOC_TAX_RE,0) + ISNULL(A.YEAR_MID_LOC_TAX_RE,0))
				 FROM 
						--중간정산환급
						(SELECT A.COMP_CODE
							  , B.SECT_CODE 
							  , B.DIV_CODE									                      
							  , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I)) ELSE 0 END, 0) AS YEAR_MID_LOC_TAX_RE
						  FROM            HAD600T A WITH (NOLOCK) 
							   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE      
								  								 AND B.PERSON_NUMB = A.PERSON_NUMB
						 WHERE A.COMP_CODE          = @CompCode               
						   AND A.YEAR_YYYY          = LEFT(@PayYyyymm, 4)         
						   AND A.HALFWAY_TYPE       = 'Y'
						   AND LEFT(A.RETR_DATE, 6) = @PayYyyymm
						   AND B.SECT_CODE          = @BillDivCode
                           AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
						 GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE) AS A
                        --연말정산환급/추가
                         LEFT JOIN
                         (SELECT A.COMP_CODE
                               , A.SECT_CODE
                               , A.DIV_CODE
                               , SUM(A.YEAR_END_LOC_TAX_RE) AS YEAR_END_LOC_TAX_RE
                               , SUM(A.YEAR_END_LOC_TAX_AD) AS YEAR_END_LOC_TAX_AD
                            FROM (--2월귀속 2월지급인      경우 연말정산금액 - 2차분납금액 - 3차분납금액
                                  --2월귀속 2월지급이 아닌 경우 귀속연월의 분납금액
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &gt; 0 THEN SUM(A.LOCAL_TAX_I)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD600T AS A WITH (NOLOCK)                     
                                         INNER JOIN HUM100T AS B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                                               AND B.PERSON_NUMB = A.PERSON_NUMB
                                   WHERE A.COMP_CODE          = @CompCode
                                     AND A.YEAR_YYYY          = DATEADD(YEAR, -1, LEFT(@PayYyyymm, 4))   
                                     AND A.HALFWAY_TYPE       = 'N'
                                     AND B.SECT_CODE          = @BillDivCode 
                                     AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                  UNION ALL
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_01)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &gt; 0 THEN SUM(A.LOCAL_TAX_I_01)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD950T A WITH (NOLOCK)
                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                           AND B.PERSON_NUMB      = A.PERSON_NUMB
                                   WHERE A.COMP_CODE         = @CompCode
                                     AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                     AND B.SECT_CODE         = @BillDivCode 
                                     AND A.PAY_YYYYMM_01    != @PayYyyyMm
                                     AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                  UNION ALL
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_02)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &gt; 0 THEN SUM(A.LOCAL_TAX_I_02)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD950T A WITH (NOLOCK)
                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                           AND B.PERSON_NUMB      = A.PERSON_NUMB
                                   WHERE A.COMP_CODE         = @CompCode
                                     AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                     AND B.SECT_CODE         = @BillDivCode 
                                     AND A.PAY_YYYYMM_02    != @PayYyyyMm
                                     AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                  UNION ALL
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_03)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &gt; 0 THEN SUM(A.LOCAL_TAX_I_03)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD950T A WITH (NOLOCK)
                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                           AND B.PERSON_NUMB      = A.PERSON_NUMB
                                   WHERE A.COMP_CODE         = @CompCode
                                     AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                     AND B.SECT_CODE         = @BillDivCode 
                                     AND A.PAY_YYYYMM_03    != @PayYyyyMm
                                     AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                  UNION ALL
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_01)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &gt; 0 THEN SUM(A.LOCAL_TAX_I_01)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD950T A WITH (NOLOCK)
                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                           AND B.PERSON_NUMB      = A.PERSON_NUMB
                                   WHERE A.COMP_CODE         = @CompCode
                                     AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                     AND B.SECT_CODE         = @BillDivCode 
                                     AND A.PAY_YYYYMM_01     = @PayYyyyMm
                                     AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                  UNION ALL
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_02)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &gt; 0 THEN SUM(A.LOCAL_TAX_I_02)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD950T A WITH (NOLOCK)
                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                           AND B.PERSON_NUMB      = A.PERSON_NUMB
                                   WHERE A.COMP_CODE         = @CompCode
                                     AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                     AND B.SECT_CODE         = @BillDivCode 
                                     AND A.PAY_YYYYMM_02     = @PayYyyyMm
                                     AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE
                                  UNION ALL
                                  SELECT A.COMP_CODE
                                       , B.SECT_CODE
                                       , B.DIV_CODE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_03)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                       , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &gt; 0 THEN SUM(A.LOCAL_TAX_I_03)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                    FROM            HAD950T A WITH (NOLOCK)
                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                           AND B.PERSON_NUMB      = A.PERSON_NUMB
                                   WHERE A.COMP_CODE         = @CompCode
                                     AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                     AND B.SECT_CODE         = @BillDivCode 
                                     AND A.PAY_YYYYMM_03     != @PayYyyyMm
                                     AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
                                     AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                   GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE) A
                           GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE) AS B ON B.COMP_CODE = A.COMP_CODE
                                                                              AND B.SECT_CODE = A.SECT_CODE
                                                                              AND B.DIV_CODE  = A.DIV_CODE
	         
	            WHERE A.COMP_CODE = @CompCode
	              AND A.SECT_CODE = @BillDivCode
				 ) A
	     WHERE A.TXTP_INTX != 0 --주민세 금액이 있는 경우만 포함
         GROUP BY A.TXTP_CD, A.DIV_CODE         
		END
	</select>

	<select id="hpa972ukrServiceImpl.selectListC" parameterType="Map" resultType="rMap">
		--hpa972ukrServiceImpl.selectListC
		/*************************************************************************************************************
			위택스 지방소득세 신고자료 (C 레코드) 조회
		*************************************************************************************************************/
		--2. A103901 : 지방소득세 특별징수 계산서 및 명세서(서식42호의2)
		BEGIN
		    DECLARE @CompCode       NVARCHAR(8)
		          , @BillDivCode    NVARCHAR(8)
		          , @PayYyyymm      NVARCHAR(6)
		          , @SuppYyyymm     NVARCHAR(6)
		          , @ReportDate     NVARCHAR(8)
		          , @BussOfficeCode NVARCHAR(8)
		      
		    SET @CompCode       = #{S_COMP_CODE}
		    SET @BillDivCode    = #{DIV_CODE}
		    SET @PayYyyymm      = #{PAY_YYYYMM}
		    SET @SuppYyyymm     = #{SUPP_YYYYMM}
		    SET @ReportDate     = #{SUBMIT_DATE}
		    SET @BussOfficeCode = #{BUSS_OFFICE_CODE}
		    SET @BussOfficeCode = CASE WHEN ISNULL(@BussOfficeCode,'') = '' THEN '%' ELSE @BussOfficeCode END

		    SELECT '23'                                             AS DATA_DIV     -- 1 자료구분
		         , 'A103901'                                        AS DOC_COD      -- 2 서식코드
		         , ROW_NUMBER() OVER (ORDER BY A.TXTP_CD, A.REG_NM) AS SEQ          -- 3 일련번호
		         , A.TXTP_CD                                        AS TXTP_CD      -- 4 소득구분코드
		         , A.D_JING                                         AS D_JING       -- 5 징수연월일
		         , A.REG_NM                                         AS REG_NM       -- 6 납세의무자 성명
		         , REPLACE(A.REG_NO, '-', '')                       AS REG_NO       -- 7 납세의무자 주민/법인등록번호
		         , A.TXTP_STD                                       AS TAX_STD      -- 8 과세표준
		         , A.CALCUL_TX                                      AS CALCUL_TX    -- 9 산출세액
		         , A.ADJ_TAX                                        AS ADJ_TAX      --10 조정액(환급액)
		         , A.PAY_TAX                                        AS PAY_TAX      --11 납부액
		         , ''                                               AS DTL_NOTE     --12 비고
		         , A.DIV_CODE
		      FROM (--이자소득
		            SELECT A.COMP_CODE
		                 , A.SECT_CODE
		                 , A.DIV_CODE
		                 , A.PAY_YYYYMM                             AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                      AS SUPP_YYYYMM      -- 지급연월
		                 , '11'                                     AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.RECE_DATE                              AS D_JING           -- 징수연월일
		                 , B.NAME                                   AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(B.REPRE_NUM, '') AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(A.IN_TAX_I)                          AS TXTP_STD         -- 과세표준
		                 , SUM(A.LOCAL_TAX_I)                       AS CALCUL_TX        -- 산출세액
		                 , 0                                        AS ADJ_TAX          -- 조정액(환급액)
		                 , SUM(A.LOCAL_TAX_I)                       AS PAY_TAX          -- 납부액
		              FROM            HPB200T A WITH (NOLOCK)
		                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
		                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
		                                                     AND B.DED_TYPE    = A.DED_TYPE
		             WHERE A.COMP_CODE         = @CompCode
		               AND A.SECT_CODE         = @BillDivCode
		               AND A.PAY_YYYYMM        = @PayYyyymm
		               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		               AND A.DED_TYPE          = '10'
		               AND B.BUSINESS_TYPE    != '1'
                       AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.RECE_DATE, B.NAME, B.REPRE_NUM
		
		            UNION ALL
		
		            --배당소득
		            SELECT A.COMP_CODE
		                 , A.SECT_CODE
		                 , A.DIV_CODE
		                 , A.PAY_YYYYMM                             AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                      AS SUPP_YYYYMM      -- 지급연월
		                 , '12'                                     AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.RECE_DATE                              AS D_JING           -- 징수연월일
		                 , B.NAME                                   AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(B.REPRE_NUM, '') AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(A.IN_TAX_I)                          AS TXTP_STD         -- 과세표준
		                 , SUM(A.LOCAL_TAX_I)                       AS CALCUL_TX        -- 산출세액
		                 , 0                                        AS ADJ_TAX          -- 조정액(환급액)
		                 , SUM(A.LOCAL_TAX_I)                       AS PAY_TAX          -- 납부액
		              FROM            HPB200T A WITH (NOLOCK)
		                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
		                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
		                                                     AND B.DED_TYPE    = A.DED_TYPE
		             WHERE A.COMP_CODE         = @CompCode
		               AND A.SECT_CODE         = @BillDivCode
		               AND A.PAY_YYYYMM        = @PayYyyymm
		               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		               AND A.DED_TYPE          = '20'
		               AND B.BUSINESS_TYPE    != '1'
                       AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.RECE_DATE, B.NAME, B.REPRE_NUM
		
		            UNION ALL
		
		            --사업소득
		            SELECT A.COMP_CODE
		                 , A.SECT_CODE
		                 , A.DIV_CODE
		                 , A.PAY_YYYYMM                             AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                      AS SUPP_YYYYMM      -- 지급연월
		                 , '13'                                     AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.RECE_DATE					            AS D_JING           -- 징수연월일
		                 , B.NAME                                   AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(B.REPRE_NUM, '') AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(A.IN_TAX_I)                          AS TXTP_STD         -- 과세표준
		                 , SUM(A.LOCAL_TAX_I)                       AS CALCUL_TX        -- 산출세액
		                 , 0                                        AS ADJ_TAX          -- 조정액(환급액)
		                 , SUM(A.LOCAL_TAX_I)                       AS PAY_TAX          -- 납부액
		              FROM            HPB200T A WITH (NOLOCK)
		                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
		                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
		                                                     AND B.DED_TYPE    = A.DED_TYPE
		             WHERE A.COMP_CODE         = @CompCode
		               AND A.SECT_CODE         = @BillDivCode
		               AND A.PAY_YYYYMM        = @PayYyyymm
		               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		               AND A.DED_TYPE          = '1'
		               AND B.BUSINESS_TYPE    != '1'
                       AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.RECE_DATE, B.NAME, B.REPRE_NUM
		
		            UNION ALL
		
		            --근로소득
		            SELECT A.COMP_CODE
		                 , C.SECT_CODE
		                 , C.DIV_CODE
		                 , A.PAY_YYYYMM                             AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                      AS SUPP_YYYYMM      -- 지급연월
		                 , '14'                                     AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.SUPP_DATE                              AS D_JING           -- 징수연월일
		                 , C.NAME                                   AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(C.REPRE_NUM, '') AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(CASE WHEN B.DED_CODE = 'INC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_STD  -- 과세표준
						 , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS CALCUL_TX -- 산출세액
						 , SUM(CASE WHEN B.DED_CODE = 'INC' THEN ISNULL(E.YEAR_END_LOC_TAX_AD,0) - (ISNULL(E.YEAR_END_LOC_TAX_RE,0) + ISNULL(D.YEAR_MID_LOC_TAX_RE,0)) ELSE 0 END) AS ADJ_TAX -- 조정액(환급액)
						 , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I - ABS(ISNULL(E.YEAR_END_LOC_TAX_AD,0) - (ISNULL(E.YEAR_END_LOC_TAX_RE,0) + ISNULL(D.YEAR_MID_LOC_TAX_RE,0)))
						            ELSE 0 END) AS PAY_TAX   -- 납부액
		              FROM            HPA600T A WITH (NOLOCK)
			               INNER JOIN HPA400T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE     
											                 AND B.PERSON_NUMB = A.PERSON_NUMB   
											                 AND B.PAY_YYYYMM  = A.PAY_YYYYMM    
											                 AND B.SUPP_TYPE   = A.SUPP_TYPE     
			               INNER JOIN HUM100T C WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE     
											                 AND C.PERSON_NUMB = A.PERSON_NUMB
						   --중간정산환급
					        LEFT JOIN (SELECT A.COMP_CODE
							 			    , B.SECT_CODE
										    , B.DIV_CODE	
										    , A.PERSON_NUMB
										    , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I)) ELSE 0 END, 0) AS YEAR_MID_LOC_TAX_RE
									     FROM            HAD600T A WITH (NOLOCK) 
										      INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE      
												    							AND B.PERSON_NUMB = A.PERSON_NUMB
									    WHERE A.COMP_CODE          = @CompCode               
									      AND A.YEAR_YYYY          = LEFT(@PayYyyymm, 4)         
									      AND A.HALFWAY_TYPE       = 'Y'
									      AND LEFT(A.RETR_DATE, 6) = @PayYyyymm
									      AND B.SECT_CODE          = @BillDivCode
                                          AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
									     GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
							          ) AS D ON D.COMP_CODE   = A.COMP_CODE
										    AND D.SECT_CODE   = A.SECT_CODE	
										    AND D.DIV_CODE    = A.DIV_CODE
										    AND D.PERSON_NUMB = A.PERSON_NUMB
						     --연말정산환급/추가
                         LEFT JOIN (SELECT A.COMP_CODE
                                         , A.SECT_CODE
                                         , A.DIV_CODE
                                         , A.PERSON_NUMB
                                         , SUM(A.YEAR_END_LOC_TAX_RE) AS YEAR_END_LOC_TAX_RE
                                         , SUM(A.YEAR_END_LOC_TAX_AD) AS YEAR_END_LOC_TAX_AD
                                      FROM (--2월귀속 2월지급인      경우 연말정산금액 - 2차분납금액 - 3차분납금액
                                            --2월귀속 2월지급이 아닌 경우 귀속연월의 분납금액
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I) &gt; 0 THEN SUM(A.LOCAL_TAX_I)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD600T AS A WITH (NOLOCK)                     
                                                   INNER JOIN HUM100T AS B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                                                         AND B.PERSON_NUMB = A.PERSON_NUMB
                                             WHERE A.COMP_CODE          = @CompCode
                                               AND A.YEAR_YYYY          = DATEADD(YEAR, -1, LEFT(@PayYyyymm, 4))   
                                               AND A.HALFWAY_TYPE       = 'N'
                                               AND B.SECT_CODE          = @BillDivCode 
                                               AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
                                            UNION ALL
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_01)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &gt; 0 THEN SUM(A.LOCAL_TAX_I_01)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD950T A WITH (NOLOCK)
                                                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                                     AND B.PERSON_NUMB      = A.PERSON_NUMB
                                             WHERE A.COMP_CODE         = @CompCode
                                               AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                               AND B.SECT_CODE         = @BillDivCode 
                                               AND A.PAY_YYYYMM_01    != @PayYyyyMm
                                               AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
                                            UNION ALL
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_02)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &gt; 0 THEN SUM(A.LOCAL_TAX_I_02)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD950T A WITH (NOLOCK)
                                                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                                     AND B.PERSON_NUMB      = A.PERSON_NUMB
                                             WHERE A.COMP_CODE         = @CompCode
                                               AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                               AND B.SECT_CODE         = @BillDivCode 
                                               AND A.PAY_YYYYMM_02    != @PayYyyyMm
                                               AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
                                            UNION ALL
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_03)) ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &gt; 0 THEN SUM(A.LOCAL_TAX_I_03)      ELSE 0 END, 0) * -1 AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD950T A WITH (NOLOCK)
                                                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                                     AND B.PERSON_NUMB      = A.PERSON_NUMB
                                             WHERE A.COMP_CODE         = @CompCode
                                               AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                               AND B.SECT_CODE         = @BillDivCode 
                                               AND A.PAY_YYYYMM_03    != @PayYyyyMm
                                               AND RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02' --2월귀속 2월지급일 경우만 연말정산 표시
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
                                            UNION ALL
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_01)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_01) &gt; 0 THEN SUM(A.LOCAL_TAX_I_01)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD950T A WITH (NOLOCK)
                                                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                                     AND B.PERSON_NUMB      = A.PERSON_NUMB
                                             WHERE A.COMP_CODE         = @CompCode
                                               AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                               AND B.SECT_CODE         = @BillDivCode 
                                               AND A.PAY_YYYYMM_01     = @PayYyyyMm
                                               AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
                                            UNION ALL
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_02)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_02) &gt; 0 THEN SUM(A.LOCAL_TAX_I_02)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD950T A WITH (NOLOCK)
                                                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                                     AND B.PERSON_NUMB      = A.PERSON_NUMB
                                             WHERE A.COMP_CODE         = @CompCode
                                               AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                               AND B.SECT_CODE         = @BillDivCode 
                                               AND A.PAY_YYYYMM_02     = @PayYyyyMm
                                               AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB
                                            UNION ALL
                                            SELECT A.COMP_CODE
                                                 , B.SECT_CODE
                                                 , B.DIV_CODE
                                                 , A.PERSON_NUMB
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &lt; 0 THEN ABS(SUM(A.LOCAL_TAX_I_03)) ELSE 0 END, 0) AS YEAR_END_LOC_TAX_RE
                                                 , ISNULL(CASE WHEN SUM(A.LOCAL_TAX_I_03) &gt; 0 THEN SUM(A.LOCAL_TAX_I_03)      ELSE 0 END, 0) AS YEAR_END_LOC_TAX_AD
                                              FROM            HAD950T A WITH (NOLOCK)
                                                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE        = A.COMP_CODE
                                                                                     AND B.PERSON_NUMB      = A.PERSON_NUMB
                                             WHERE A.COMP_CODE         = @CompCode
                                               AND A.YEAR_YYYY         = LEFT(@PayYyyyMm, 4)
                                               AND B.SECT_CODE         = @BillDivCode 
                                               AND A.PAY_YYYYMM_03     != @PayYyyyMm
                                               AND NOT (RIGHT(@PayYyyymm, 2) = '02' AND RIGHT(@SuppYyyymm, 2) = '02') --2월귀속 2월지급이 아닌 경우
                                               AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                                             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, A.PERSON_NUMB) A
                                     GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PERSON_NUMB) AS E ON E.COMP_CODE   = A.COMP_CODE
                                                                                                       AND E.SECT_CODE   = A.SECT_CODE
                                                                                                       AND E.DIV_CODE    = A.DIV_CODE
                                                                                                       AND E.PERSON_NUMB = A.PERSON_NUMB
		                 WHERE A.COMP_CODE         = @CompCode
		                   AND C.SECT_CODE         = @BillDivCode
		                   AND A.PAY_YYYYMM        = @PayYyyymm
		                   AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		                   AND ((A.PAY_GUBUN = '1') OR (A.PAY_GUBUN = '2' AND A.PAY_GUBUN2 != '1'))           
			               AND B.DED_CODE          IN ('INC', 'LOC')    
                           AND ISNULL(C.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		                 GROUP BY A.COMP_CODE, C.SECT_CODE, C.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.SUPP_DATE, C.NAME, C.REPRE_NUM
		
		            UNION ALL
		
		            --근로소득(일용직)
		            SELECT A.COMP_CODE
		                 , C.SECT_CODE
		                 , C.DIV_CODE
		                 , A.PAY_YYYYMM                             AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                      AS SUPP_YYYYMM      -- 지급연월
		                 , '14'                                     AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.SUPP_DATE                              AS D_JING           -- 징수연월일
		                 , C.NAME                                   AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(C.REPRE_NUM, '') AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(CASE WHEN B.DED_CODE = 'INC' THEN B.DED_AMOUNT_I ELSE 0 END) AS TXTP_STD  -- 과세표준
						 , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS CALCUL_TX -- 산출세액
						 , 0                                        	                    AS ADJ_TAX   -- 조정액(환급액)
						 , SUM(CASE WHEN B.DED_CODE = 'LOC' THEN B.DED_AMOUNT_I ELSE 0 END) AS PAY_TAX   -- 납부액
		              FROM            HPA600T A WITH (NOLOCK)
			               INNER JOIN HPA400T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE     
											                 AND B.PERSON_NUMB = A.PERSON_NUMB   
											                 AND B.PAY_YYYYMM  = A.PAY_YYYYMM    
											                 AND B.SUPP_TYPE   = A.SUPP_TYPE     
			               INNER JOIN HUM100T C WITH (NOLOCK) ON C.COMP_CODE   = A.COMP_CODE     
											                 AND C.PERSON_NUMB = A.PERSON_NUMB   
		             WHERE A.COMP_CODE         = @CompCode
		               AND C.SECT_CODE         = @BillDivCode
		               AND A.PAY_YYYYMM        = @PayYyyymm
		               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		               AND A.PAY_GUBUN         = '2'
		               AND A.PAY_GUBUN2        = '1'
			           AND B.DED_CODE          IN ('INC', 'LOC')
                       AND ISNULL(C.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		             GROUP BY A.COMP_CODE, C.SECT_CODE, C.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.SUPP_DATE, C.NAME, C.REPRE_NUM
		
		            UNION ALL
		
		            --기타소득
		            SELECT A.COMP_CODE
		                 , A.SECT_CODE
		                 , A.DIV_CODE
		                 , A.PAY_YYYYMM                             AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                      AS SUPP_YYYYMM      -- 지급연월
		                 , '14'                                     AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.RECE_DATE                              AS D_JING           -- 징수연월일
		                 , B.NAME                                   AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(B.REPRE_NUM, '') AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(A.IN_TAX_I)                          AS TXTP_STD         -- 과세표준
		                 , SUM(A.LOCAL_TAX_I)                       AS CALCUL_TX        -- 산출세액
		                 , 0                                        AS ADJ_TAX          -- 조정액(환급액)
		                 , SUM(A.LOCAL_TAX_I)                       AS PAY_TAX          -- 납부액
		              FROM            HPB200T A WITH (NOLOCK)
		                   INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
		                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
		                                                     AND B.DED_TYPE    = A.DED_TYPE
		             WHERE A.COMP_CODE         = @CompCode
		               AND A.SECT_CODE         = @BillDivCode
		               AND A.PAY_YYYYMM        = @PayYyyymm
		               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		               AND A.DED_TYPE          = '2'
		               AND B.BUSINESS_TYPE    != '1'
                       AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		             GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.RECE_DATE, B.NAME, B.REPRE_NUM
		
		            UNION ALL
		
		            --퇴직소득
		            SELECT A.COMP_CODE
		                 , B.SECT_CODE
		                 , B.DIV_CODE
		                 , LEFT(A.RETR_DATE,6)                                          AS PAY_YYYYMM       -- 귀속연월
		                 , LEFT(A.SUPP_DATE,6)                                          AS SUPP_YYYYMM      -- 지급연월
		                 , '21'                                                         AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직)
		                 , A.SUPP_DATE                                                  AS D_JING           -- 징수연월일
		                 , B.NAME                                                       AS REG_NM           -- 납세의무자 설명
		                 , uniLITE.fnCipherDecrypt(B.REPRE_NUM, '')                     AS REG_NO           -- 납세의무자 주민/법인등록번호
		                 , SUM(A.BAL_IN_TAX_I   ) - ISNULL(SUM(C.BAL_IN_TAX_I   ),0)    AS TXTP_STD         -- 과세표준
		                 , SUM(A.BAL_LOCAL_TAX_I) - ISNULL(SUM(C.BAL_LOCAL_TAX_I),0)    AS CALCUL_TX        -- 산출세액
		                 , 0                                                            AS ADJ_TAX          -- 조정액(환급액)
		                 , SUM(A.BAL_LOCAL_TAX_I) - ISNULL(SUM(C.BAL_LOCAL_TAX_I),0)    AS PAY_TAX          -- 납부액
		              FROM            HRT500T A WITH (NOLOCK)
		                   INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
		                                                     AND B.PERSON_NUMB = A.PERSON_NUMB
		                   LEFT  JOIN (SELECT A.COMP_CODE
		                                    , A.PERSON_NUMB
		                                    , A.BAL_IN_TAX_I
		                                    , A.BAL_LOCAL_TAX_I
		                                 FROM            HRT500T A WITH (NOLOCK)
		                                      INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                                                        AND B.PERSON_NUMB = A.PERSON_NUMB 
		                                      INNER JOIN (SELECT A.COMP_CODE
		                                                       , A.PERSON_NUMB
		                                                       , A.RETR_DATE
		                                                    FROM            HRT500T A WITH (NOLOCK)
		                                                         INNER JOIN HUM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
		                                                                                           AND B.PERSON_NUMB = A.PERSON_NUMB
		                                                   WHERE A.COMP_CODE         = @CompCode
		                                                     AND B.SECT_CODE         = @BillDivCode
		                                                     AND LEFT(A.RETR_DATE,6) = @PayYyyymm
		                                                     AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
		                                                     AND A.RETR_TYPE         = 'R') C ON C.COMP_CODE         = A.COMP_CODE
		                                                                                     AND C.PERSON_NUMB       = A.PERSON_NUMB
		                                                                                     AND LEFT(C.RETR_DATE,4) = LEFT(A.SUPP_DATE,4)            
		                                WHERE A.COMP_CODE = @CompCode      
		                                  AND B.SECT_CODE = @BillDivCode
		                                  AND A.RETR_TYPE = 'M') C ON C.COMP_CODE   = A.COMP_CODE
		                                                          AND C.PERSON_NUMB = A.PERSON_NUMB
		             WHERE A.COMP_CODE         = @CompCode
		               AND B.SECT_CODE         = @BillDivCode
		               AND LEFT(A.RETR_DATE,6) = @PayYyyymm
		               AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
			           AND A.RETR_TYPE         != 'S'    
			           AND B.RETR_PENSION_KIND != 'DC'
                       AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
		             GROUP BY A.COMP_CODE, B.SECT_CODE, B.DIV_CODE, LEFT(A.RETR_DATE,6), LEFT(A.SUPP_DATE,6), A.SUPP_DATE, B.NAME, B.REPRE_NUM
		             
                UNION ALL

                 --외국법인
                SELECT A.COMP_CODE
                     , A.SECT_CODE
                     , A.DIV_CODE
                     , A.PAY_YYYYMM                                 AS PAY_YYYYMM       -- 귀속연월
                     , LEFT(A.SUPP_DATE,6)                          AS SUPP_YYYYMM      -- 지급연월
                     , '31'                                         AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직,31:외국법인,33:내국법인)
                     , A.RECE_DATE                                  AS D_JING           -- 징수연월일
                     , B.NAME                                       AS REG_NM           -- 납세의무자 설명
                     , uniLITE.fnCipherDecrypt(B.REPRE_NUM, 'RR')   AS REG_NO           -- 납세의무자 주민/법인등록번호
                     , SUM(A.IN_TAX_I)                              AS TXTP_STD         -- 과세표준
                     , SUM(A.CP_TAX_I)                              AS CALCUL_TX        -- 산출세액
                     , 0                                            AS ADJ_TAX          -- 조정액(환급액)
                     , SUM(A.LOCAL_TAX_I)                           AS PAY_TAX          -- 납부액
                  FROM            HPB200T A WITH (NOLOCK)
                       INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
                                                         AND B.PERSON_NUMB = A.PERSON_NUMB
                                                         AND B.DED_TYPE    = A.DED_TYPE
                 WHERE A.COMP_CODE         = @CompCode
                   AND A.SECT_CODE         = @BillDivCode
                   AND A.PAY_YYYYMM        = @PayYyyymm
                   AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
                   AND A.DED_TYPE          = '10'
                   AND B.BUSINESS_TYPE     = '1'
                   AND B.FOREIGN_YN       != '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                 GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.RECE_DATE, B.NAME, B.REPRE_NUM

                UNION ALL

                 --내국법인
                SELECT A.COMP_CODE
                     , A.SECT_CODE
                     , A.DIV_CODE
                     , A.PAY_YYYYMM                                 AS PAY_YYYYMM       -- 귀속연월
                     , LEFT(A.SUPP_DATE,6)                          AS SUPP_YYYYMM      -- 지급연월
                     , '33'                                         AS TXTP_CD          -- 소득구분(11:이자,12:배당,13:사업,14:근로,16:기타,21:퇴직,31:외국법인,33:내국법인)
                     , A.RECE_DATE                                  AS D_JING           -- 징수연월일
                     , B.NAME                                       AS REG_NM           -- 납세의무자 설명
                     , uniLITE.fnCipherDecrypt(B.REPRE_NUM, 'RR')   AS REG_NO           -- 납세의무자 주민/법인등록번호
                     , SUM(A.CP_TAX_I)                              AS TXTP_STD         -- 과세표준
                     , SUM(A.LOCAL_TAX_I)                           AS CALCUL_TX        -- 산출세액
                     , 0                                            AS ADJ_TAX          -- 조정액(환급액)
                     , SUM(A.LOCAL_TAX_I)                           AS PAY_TAX          -- 납부액
                  FROM            HPB200T A WITH (NOLOCK)
                       INNER JOIN HPB100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE 
                                                         AND B.PERSON_NUMB = A.PERSON_NUMB
                                                         AND B.DED_TYPE    = A.DED_TYPE
                 WHERE A.COMP_CODE         = @CompCode
                   AND A.SECT_CODE         = @BillDivCode
                   AND A.PAY_YYYYMM        = @PayYyyymm
                   AND LEFT(A.SUPP_DATE,6) = @SuppYyyymm
                   AND A.DED_TYPE          = '10'
                   AND B.BUSINESS_TYPE     = '1'
                   AND B.FOREIGN_YN        = '1'
                   AND ISNULL(B.BUSS_OFFICE_CODE,'') LIKE @BussOfficeCode
                 GROUP BY A.COMP_CODE, A.SECT_CODE, A.DIV_CODE, A.PAY_YYYYMM, LEFT(A.SUPP_DATE,6), A.RECE_DATE, B.NAME, B.REPRE_NUM                  
                 ) A 
             WHERE A.CALCUL_TX != 0               		             
		END
	</select>
	<select id="hpa972ukrServiceImpl.getBussOfficeCode" parameterType="Map" resultType="comboItem">
		 SELECT BUSS_OFFICE_CODE	AS 'value'
		 	  , BUSS_OFFICE_NAME	AS 'text'
		 	  , BUSS_OFFICE_CODE + BUSS_OFFICE_NAME AS 'search'
		   FROM HBS230T 
		  WHERE COMP_CODE = #{S_COMP_CODE}
	</select>
</mapper>
