<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sbs020ukrvServiceImpl">
					
	<select id="sbs020ukrvServiceImpl.selectForm" parameterType="Map" resultType="rMap">


SELECT  
		/* 자동채번 설정 */ 
		MAX(S012_1) AS S012_1,
		MAX(S012_2) AS S012_2,
		MAX(S012_3) AS S012_3,
		MAX(S012_4) AS S012_4,
		MAX(S012_5) AS S012_5,
		MAX(S012_6) AS S012_6,
		MAX(S012_7) AS S012_7,
		MAX(S012_8) AS S012_8,
		
		/* 판매계획설정 */
		MAX(S022_1) AS S022_1,
		MAX(S022_2) AS S022_2,
		MAX(S022_3) AS S022_3,
		MAX(S022_4) AS S022_4,
		MAX(S022_5) AS S022_5,
		MAX(S022_6) AS S022_6,
		MAX(S022_9) AS S022_9,
		/* 여신설정  - 관리시점 */
		MAX(S026_1) AS S026_1,
		
		/* 여신설정 - 어음 */
		MAX(S019_1) AS S019_1,
		
		/* 여신설정 - 여신잔액 초과시 */
		MAX(S181_1) AS S181_1,

		/* 부가세율 */
		MAX(TAX) AS TAX,
		
		/* 기초잔액생성*/
		MAX(S025_1) AS S025_1,
		
		/* 수주등록내 설정 */
		MAX(S031_1) AS S031_1,
		
		/* 매출사업장 지정 */
		MAX(S029_1) AS S029_1,
		
		/* 출고등록시 자동매출생성/삭제여부 */
		MAX(S033_1) AS S033_1,
		
		/* 반품등록시 자동매출생성/삭제여부 */
		MAX(S034_1) AS S034_1,
		
		/* 매출등록시 자동출고생성/삭제여부  - 출고 */
		MAX(S035_1) AS S035_1,
		
		/* 매출등록시 자동출고생성/삭제여부  - 반품 */
		MAX(S038_1) AS S038_1,
		
		/* 수주승인 사용여부 */
		MAX(S044_1) AS S044_1,
		
		/* 승인자 */
		MAX(S044_2_CODE) AS S044_2_CODE,
		MAX(S044_2_NAME) AS S044_2_NAME

	FROM (
		SELECT
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '1' THEN REF_CODE1 ELSE 'N' END S012_1,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '2' THEN REF_CODE1 ELSE 'N' END S012_2,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '3' THEN REF_CODE1 ELSE 'N' END S012_3,
        CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '4' THEN REF_CODE1 ELSE 'N' END S012_4,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '5' THEN REF_CODE1 ELSE 'N' END S012_5,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '6' THEN REF_CODE1 ELSE 'N' END S012_6,
        CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '7' THEN REF_CODE1 ELSE 'N' END S012_7,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S012' AND SUB_CODE = '8' THEN REF_CODE1 ELSE 'N' END S012_8,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '1' THEN REF_CODE1 ELSE 'N' END S022_1,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '2' THEN REF_CODE1 ELSE 'N' END S022_2,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '3' THEN REF_CODE1 ELSE 'N' END S022_3,
        CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '4' THEN REF_CODE1 ELSE 'N' END S022_4,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '5' THEN REF_CODE1 ELSE 'N' END S022_5,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '6' THEN REF_CODE1 ELSE 'N' END S022_6,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S022' AND SUB_CODE = '9' THEN REF_CODE1 ELSE 'N' END S022_9,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S026' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S026_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S019' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S019_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S181' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S181_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S028' AND SUB_CODE  = '1' THEN REF_CODE1 ELSE '0' END TAX,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S025' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S025_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S031' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S031_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S029' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S029_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S033' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S033_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S034' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S034_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S035' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S035_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S038' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S038_1,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S044' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END S044_1,
		
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S044' AND REF_CODE1 = 'Y' THEN REF_CODE2 ELSE '' END S044_2_CODE, /* 사용자 id */
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'S044' AND REF_CODE1 = 'Y' 
				THEN (SELECT USER_NAME FROM BSA300T WHERE COMP_CODE = #{S_COMP_CODE} AND USER_ID = REF_CODE2)
				ELSE '' END S044_2_NAME
		
		FROM BSA100T
	    WHERE COMP_CODE = #{S_COMP_CODE}
		  AND MAIN_CODE IN ( 'S012','S022','S026','S019', 'S181','S028','S025','S031','S029','S033','S034','S035','S038','S044')
				
) A		


    </select>
    <select id="sbs020ukrvServiceImpl.selectForm2" parameterType="Map" resultType="rMap">
    	
		SELECT A.JOB_CODE               
				     , B.CODE_NAME  AS JOB_NAME  
				     , A.FORMAT_QTY            
				     , A.FORMAT_PRICE          
				     , A.FORMAT_IN             
				     , A.FORMAT_OUT            
				     , A.FORMAT_RATE         
				  FROM BSA110T A                
				     , BSA100T B                
				 WHERE A.COMP_CODE = B.COMP_CODE
				   AND A.JOB_CODE  = B.SUB_CODE 
				   AND A.JOB_CODE  = '14'       
				   AND B.MAIN_CODE = 'B007'     
				   AND A.COMP_CODE = #{S_COMP_CODE}
    </select>

	<update id="sbs020ukrvServiceImpl.updateForm" parameterType="Map">		
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_1}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '1'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_2}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '2'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_3}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '3'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_4}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '4'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_5}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '5'		
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_6}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '6'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_7}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '7'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S012_8}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S012'
				AND SUB_CODE = '8'	
		
		
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_1}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S022'
				AND SUB_CODE = '1'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_2}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S022'
				AND SUB_CODE = '2'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_3}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S022'
				AND SUB_CODE = '3'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_4}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S022'
				AND SUB_CODE = '4'
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_5}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S022'
				AND SUB_CODE = '5'	
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_6}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S022'
				AND SUB_CODE = '6'	
						
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{S022_9}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE   COMP_CODE = #{S_COMP_CODE}
				AND MAIN_CODE = 'S022'
				AND SUB_CODE = '9'			
	
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S026_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S026'
				AND SUB_CODE != '$'
				
	
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S019_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S019'
				AND SUB_CODE != '$'
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S181_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S181'
				AND SUB_CODE != '$'
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = #{TAX}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S028'
				AND SUB_CODE = '1'
				
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S025_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S025'
				AND SUB_CODE != '$'
							
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S031_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S031'
				AND SUB_CODE != '$'
							
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S029_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S029'
				AND SUB_CODE != '$'
				
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S033_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S033'
				AND SUB_CODE != '$'
	
	
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S034_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S034'
				AND SUB_CODE != '$'
				
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S035_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S035'
				AND SUB_CODE != '$'
				
	
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S038_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S038'
				AND SUB_CODE != '$'
				
				
	UPDATE BSA100T
		SET
			  REF_CODE1 = CASE WHEN SUB_CODE = #{S044_1} THEN 'Y' ELSE '' END
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S044'
				AND SUB_CODE != '$'
				
	UPDATE BSA100T
		SET
			  REF_CODE2 = #{S044_2_CODE}
			, UPDATE_DB_USER = #{S_USER_ID}
			, UPDATE_DB_TIME =  GETDATE()
			WHERE	COMP_CODE = #{S_COMP_CODE}
				AND	MAIN_CODE = 'S044'
				AND SUB_CODE != '$'
	</update>
	
	<update id="sbs020ukrvServiceImpl.updateForm2" parameterType="Map">	
	UPDATE BSA110T 
	       SET FORMAT_QTY    = #{FORMAT_QTY}
	         , FORMAT_PRICE  = #{FORMAT_PRICE}
	         , FORMAT_IN     = #{FORMAT_IN}
	         , FORMAT_OUT    = #{FORMAT_OUT}
	         , FORMAT_RATE   = #{FORMAT_RATE}
             , UPDATE_DB_USER = #{S_USER_ID}
             , UPDATE_DB_TIME =  GETDATE()
	     WHERE COMP_CODE      = #{S_COMP_CODE}
	       AND JOB_CODE		 = '14'
			
	</update>

	<select id="sbs020ukrvServiceImpl.checkCompCode" parameterType="Map" resultType="rMap">
		    SELECT A.COMP_CODE, A.COMP_NAME
		    FROM              BOR100T   A  WITH (NOLOCK)
		           LEFT  JOIN BSA100T   M1 WITH (NOLOCK) ON M1.COMP_CODE    = #{S_COMP_CODE}    
		                                                AND M1.MAIN_CODE    = 'B107'
		                                                AND M1.SUB_CODE     = '20'         
		    WHERE (A.COMP_CODE      &gt; ''        AND ISNULL(M1.REF_CODE1, 'N') = 'Y')
		       OR (A.COMP_CODE      = #{S_COMP_CODE}  AND ISNULL(M1.REF_CODE1, 'N') = 'N')
	</select>
</mapper>