<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssa720ukrvServiceImpl">
	<select id="ssa720ukrvServiceImpl.getGsBillYN" parameterType="Map" resultType="rMap">
         SELECT TOP 1 ISNULL(SUB_CODE , '01'  ) AS SUB_CODE
             ,       ISNULL(REF_CODE4, 'NAME')  AS REF_CODE4
             ,       ISNULL(REF_CODE5, 'N'   )  AS REF_CODE5
             ,       ISNULL(REF_CODE6, 'N'   )  AS REF_CODE6
             ,       ISNULL(REF_CODE7, ''    )  AS REF_CODE7
             ,       ISNULL(REF_CODE8, '8'   )  AS REF_CODE8
             ,       ISNULL(REF_CODE9, 'N'   )  AS REF_CODE9
        FROM   BSA100T  WITH (NOLOCK)
        WHERE  COMP_CODE = #{S_COMP_CODE}
        AND    MAIN_CODE = N'S084'
        AND    SUB_CODE != N'$'
        AND    REF_CODE1 = N'Y'
	</select>

	<select id="ssa720ukrvServiceImpl.getSalesPrsn" parameterType="Map" resultType="rMap">
         SELECT SUB_CODE  AS 'value'
             ,  CODE_NAME AS 'text'
             ,  REF_CODE1 AS 'search'
             ,  REF_CODE1 AS 'option'
        FROM   BSA100T  A WITH (NOLOCK)
        WHERE  A.COMP_CODE = #{S_COMP_CODE}
        AND    MAIN_CODE = N'S010'
        AND    SUB_CODE != N'$'
	</select>

<!--조회 -->
	<select id="ssa720ukrvServiceImpl.selectWebCashMaster" parameterType="Map" resultType="rMap">
		/* ssa720ukrvServiceImpl.selectWebCashMaster */
		BEGIN
			SET NOCOUNT ON
			SET ARITHABORT ON

			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드		*/
			      , @UserId			NVARCHAR(100)	/* 사용자ID		*/
			      , @LangType		NVARCHAR(2)		/* 언어구분		*/
		          , @RefItem		NVARCHAR(01)
		          , @DateFormat		NVARCHAR(10)

			DECLARE @BillTypeYn		NVARCHAR(01)
			      , @ETaxDBUser     NVARCHAR(50)

		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE}

			/* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

			/* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

			/* BILL_TYPE 참조시 S024의 REF_CODE1의 증빙유형 사용 여부 */
		    SELECT @BillTypeYn = (CASE WHEN ISNULL(REF_CODE3 , '') = ''
		                               THEN 'N'
		                               ELSE REF_CODE3
		                           END)
		         , @ETaxDBUser = (CASE WHEN ISNULL(REF_CODE10, '') = ''
		                               THEN 'WEBCASH'
		                               ELSE REF_CODE10
		                           END)
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = 'S084'
		       AND SUB_CODE  = '01'

		    SET @BillTypeYn = ISNULL(@BillTypeYn,'N')
		    SET @BillTypeYn = (CASE WHEN @BillTypeYn = 'Y' THEN 'Y' ELSE 'N' END)
		    SET @ETaxDBUser = ISNULL(@ETaxDBUser,'WEBCASH')

			/* 데이터 조회 */
		    SELECT (CASE WHEN ISNULL(D.ERR_CD, '') = ''						THEN M2.CODE_NAME
		    			 WHEN D.ERR_CD != '000000' AND D.ERR_CD != 'SEND'	THEN 'Error'
		                 ELSE M2.CODE_NAME
		             END)                                                                   AS TRANSYN_NAME     /* 전송여부명			*/
		         , D.STAT_CODE                                                              AS STAT_CODE        /* 상태              			*/
		         , M3.CODE_NAME                                                             AS STS              /* 상태              			*/
		         , CONVERT(NVARCHAR, A.CRT_LOC)                                             AS CRT_LOC          /* 생성경로          		*/
		         , A.BILL_FLAG      AS BILL_FLAG        /* 세금계산서구분    		*/
		         , (CASE WHEN A.BILL_FLAG = '1' THEN (CASE WHEN A.BILL_TYPE = '11' THEN '0101'    /* 과세   */
		                                                   WHEN A.BILL_TYPE = '20' THEN '0301'    /* 면세   */
		                                                   WHEN A.BILL_TYPE = '12' THEN '0102'    /* 영세율 */
		                                               END)
		                 WHEN A.BILL_FLAG = '2' THEN (CASE WHEN A.BILL_TYPE = '11' THEN '0201'    /* 과세   */
		                                                   WHEN A.BILL_TYPE = '20' THEN '0401'    /* 면세   */
		                                                   WHEN A.BILL_TYPE = '12' THEN '0202'    /* 영세율 */
		                                               END)
		             END)                                                                   AS TAX_TYPE         /* 세금계산서종류    		*/
		         , (CASE ISNULL(A.BILL_SEND_YN, 'N') WHEN 'N' THEN A.BILL_GUBUN
		                                             WHEN 'Y' THEN D.POPS_CODE
		             END)                                                                   AS POPS_CODE        /* 영수/청구 구분    		*/
		         , (CASE WHEN ISNULL(A.BILL_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.BILL_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.BILL_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.BILL_DATE, 7, 2))
		             END)																	AS REGS_DATE        /* 발행일            		*/
		         , C1.COMPANY_NUM                                                           AS SELR_CORP_NO     /* 공급자 사업자번호 		*/
		         , (CASE WHEN ISNULL(C1.DIV_FULL_NAME, '') = '' THEN C1.DIV_NAME         
		                                                        ELSE C1.DIV_FULL_NAME
		             END)                                                                   AS SELR_CORP_NM     /* 공급자 업체명     		*/
		         , C1.SUB_DIV_NUM                                                           AS SELR_CODE        /* 공급자 종사업장번호		*/
		         , C1.REPRE_NAME                                                            AS SELR_CEO         /* 공급자 대표자명   		*/
		         , C1.COMP_TYPE                                                             AS SELR_BUSS_CONS   /* 공급자 업태       		*/
		         , C1.COMP_CLASS                                                            AS SELR_BUSS_TYPE   /* 공급자 업종       		*/
		         , C1.ADDR                                                                  AS SELR_ADDR        /* 공급자 주소                  */             
		         , (CASE WHEN ISNULL(E1.CODE_NAME, '') != ''
		                 THEN E1.CODE_NAME
		                 ELSE (CASE WHEN ISNULL(E2.CODE_NAME, '') != '' THEN E2.CODE_NAME
		                                                                ELSE ''
		                       END)
		             END)                                                                   AS SELR_CHRG_NM     /* 공급자 담당자명   		*/
		         , (CASE WHEN ISNULL(E3.TREE_NAME, '') != ''
		                 THEN E3.TREE_NAME
		                 ELSE (CASE WHEN ISNULL(E4.TREE_NAME, '') != '' THEN E4.TREE_NAME
		                                                                ELSE ''
		                        END)
		             END)                                                                   AS SELR_CHRG_POST   /* 공급자 부서명     		*/
		         , (CASE WHEN ISNULL(E1.REF_CODE6, '') != ''
		                 THEN E1.REF_CODE6
		                 ELSE (CASE WHEN ISNULL(E2.REF_CODE6, '') != '' THEN E2.REF_CODE6
		                                                                ELSE C1.TELEPHON
		                        END)
		             END)                                                                   AS SELR_CHRG_TEL    /* 공급자 전화번호   		*/
		         , (CASE WHEN ISNULL(E1.REF_CODE7, '') != ''
		                 THEN E1.REF_CODE7
		                 ELSE (CASE WHEN ISNULL(E2.REF_CODE7, '') != '' THEN E2.REF_CODE7
		                                                                ELSE C2.EMAIL
	                            END)
		             END)                                                                   AS SELR_CHRG_EMAIL  /* 공급자 이메일주소 		*/
		         , (CASE WHEN ISNULL(E1.REF_CODE6, '') != ''
		                 THEN E1.REF_CODE6
		                 ELSE (CASE WHEN ISNULL(E2.REF_CODE6, '') != '' THEN E2.REF_CODE6
		                                                                ELSE C1.HANDPHONE
		                        END)
		             END)                                                                   AS SELR_CHRG_MOBL   /* 공급자 휴대폰번호 		*/
		         , A.CUSTOM_CODE      AS CUSTOM_CODE      /* 고객코드          		*/
		         , (CASE WHEN ISNULL(A.BILL_SEND_YN, 'N') = 'Y'
		                 THEN D.BUYR_CORP_NM
		                 ELSE C.CUSTOM_FULL_NAME
		             END)                                                                   AS BUYR_CORP_NM     /* 고객명            		*/
		         , (CASE WHEN C.BUSINESS_TYPE = '3'
		                 THEN '02'  /* 주민등록번호  		*/
		                 ELSE '01'  /* 사업자등록번호	*/
		             END)                                                                   AS BUYR_GB          /* 공급받는자구분코드 		*/
		         , (CASE ISNULL(A.BILL_SEND_YN, 'N') WHEN 'N' THEN (CASE WHEN C.BUSINESS_TYPE = '3' THEN unilite.fnCipherDecrypt(C.TOP_NUM, 'A')
		                                                                                            ELSE SUBSTRING(C.COMPANY_NUM ,1,3) + '-' + SUBSTRING(C.COMPANY_NUM ,4,2) + '-' + SUBSTRING(C.COMPANY_NUM,6,5)
		                                                             END)
		                                             WHEN 'Y' THEN (CASE WHEN C.BUSINESS_TYPE = '3' THEN SUBSTRING(D.BUYR_CORP_NO,1,6) + '-' + SUBSTRING(D.BUYR_CORP_NO,7,7)
		                                                                                            ELSE SUBSTRING(D.BUYR_CORP_NO,1,3) + '-' + SUBSTRING(D.BUYR_CORP_NO,4,2) + '-' + SUBSTRING(D.BUYR_CORP_NO,6,5)
		                                                             END)
		             END)                                                                   AS BUYR_CORP_NO     /* 공급받는자 사업자번호	*/
		         , A.SERVANT_COMPANY_NUM      AS BUYR_CODE        /* 공급받는자 종사업자번호	*/
		         , M1.CODE_NAME                                                             AS BILLTYPENAME     /* 계산서유형         		*/
		         , A.SALE_LOC_AMT_I      AS CHRG_AMT         /* 공급가액           		*/
		         , A.TAX_AMT_O      AS TAX_AMT          /* 세액               		*/
		         , ISNULL(A.SALE_LOC_AMT_I, 0) + ISNULL(A.TAX_AMT_O, 0)                     AS TOTL_AMT         /* 합계               		*/
		         , (CASE WHEN ISNULL(A.BILL_SEND_YN, 'N') = 'Y' THEN D.BUYR_CEO
		                                                        ELSE C.TOP_NAME
		             END)                                                                   AS BUYR_CEO         /* 공급받는자 대표자명 		*/
		         , (CASE WHEN ISNULL(A.BILL_SEND_YN, 'N') = 'Y' THEN D.BUYR_BUSS_CONS
		                                                        ELSE C.COMP_TYPE
		             END)                                                                   AS BUYR_BUSS_CONS   /* 공급받는자 업태     		*/
		         , (CASE WHEN ISNULL(A.BILL_SEND_YN, 'N') = 'Y' THEN D.BUYR_BUSS_TYPE
		                                                        ELSE C.COMP_CLASS
		             END)                                                                   AS BUYR_BUSS_TYPE   /* 공급받는자 업종    		*/
		         , (CASE WHEN ISNULL(A.BILL_SEND_YN, 'N') = 'Y' THEN D.BUYR_ADDR
		                                                        ELSE ISNULL(C.ADDR1, '') + ISNULL(C.ADDR2, '')
		             END)                                                                   AS BUYR_ADDR        /* 공급받는자 주소    		*/
		         , (CASE ISNULL(A.BILL_SEND_YN, 'N') WHEN 'N' THEN (CASE WHEN ISNULL(C4.PRSN_NAME, '') = '' THEN C.BILL_PRSN
		                                                                                                    ELSE C4.PRSN_NAME
		                                                            END)
		                                             WHEN 'Y' THEN D.SELR_CHRG_NM
		             END)                                                                   AS BUYR_CHRG_NM1     /* 전자문서담당자    		*/
		         , (CASE ISNULL(A.BILL_SEND_YN, 'N') WHEN 'N' THEN (CASE WHEN ISNULL(C4.PRSN_NAME, '') = '' THEN ISNULL(C.TELEPHON, C.HAND_PHON)
		                                                                                                    ELSE ISNULL(C4.TELEPHONE_NUM1, C4.HAND_PHON)
		                                                             END)
		                                             WHEN 'Y' THEN D.BUYR_CHRG_TEL1
		             END)                                                                   AS BUYR_CHRG_TEL1    /* 전자문서전화번호  		*/
		         , (CASE ISNULL(A.BILL_SEND_YN, 'N') WHEN 'N' THEN (CASE WHEN ISNULL(C4.PRSN_NAME, '') = '' THEN ISNULL(C.HAND_PHON, C.TELEPHON)
		                                                                                                    ELSE ISNULL(C4.HAND_PHON, C4.TELEPHONE_NUM1)
		                                                             END)
		                                             WHEN 'Y' THEN D.BUYR_CHRG_MOBL1
		             END)                                                                   AS BUYR_CHRG_MOBL1	 /* 전자문서핸드폰   		*/
		         , (CASE ISNULL(A.BILL_SEND_YN, 'N') WHEN 'N' THEN (CASE WHEN ISNULL(C4.PRSN_NAME, '') = '' THEN ISNULL(C.BILL_MAIL_ID, '')
		                                                                                                    ELSE ISNULL(C4.MAIL_ID, '')
		                                                             END)
		                                             WHEN 'Y' THEN D.BUYR_CHRG_EMAIL1
		             END)                                                                   AS BUYR_CHRG_EMAIL1  /* 전자문서E-MAIL	 	*/
		         , C.BILL_PRSN2                                                             AS BUYR_CHRG_NM2     /* 전자문서담당자2   	*/
		         , C.HAND_PHON2                                                             AS BUYR_CHRG_MOBL2   /* 전자문서핸드폰2   	*/
		         , C.BILL_MAIL_ID2                                                          AS BUYR_CHRG_EMAIL2  /* 전자문서E-MAIL2 	*/
		         , B.SEND_LOG_TIME                                                          AS SEND_DATE         /* 전송일시           		*/
		         , A.EB_NUM                                                                 AS ISSU_SEQNO        /* 전자문서번호       		*/
		         , A.PUB_NUM                                                                AS SELR_MGR_ID3      /* 계산서번호         		*/
		         , ISNULL(A.REMARK, '')                                                     AS NOTE1             /* 비고               		*/
		         , ISNULL(A.MODI_REASON, '')                                                AS MODY_CODE         /* 수정코드           		*/
		         , ISNULL(D.REQ_STAT_CODE, CASE WHEN A.BILL_FLAG = '2'
		                                        THEN '06'
		                                        ELSE '01'
		                                    END) 											AS REQ_STAT_CODE     /* 요청상태코드   		*/
		         , ISNULL(D.RECP_CD, #{ISSUE_GUBUN})                                        AS RECP_CD           /* 역발행 구분        		*/
		         , ISNULL(D.BILL_TYPE, #{ISSUE_GUBUN})                                      AS BILL_TYPE         /* 매출/매입구분     	 	*/
		         , ISNULL(E5.REF_CODE1, 'N')                                                AS SND_MAIL_YN       /* EMail발행요청유무  	*/
		         , ISNULL(E6.REF_CODE1, 'N')                                                AS SND_SMS_YN        /* SMS발행요청유무		*/
		         , ISNULL(E7.REF_CODE1, 'N')                                                AS SND_FAX_YN        /* FAX발행요청유무   	*/
		         , A.COMP_CODE      AS COMP_CODE         /* 법인코드           		*/
		         , A.DIV_CODE      AS DIV_CODE          /* 사업장코드        		*/
		         , A.SALE_DIV_CODE      AS SALE_DIV_CODE     /* 매출사업장코드     		*/
		         , M3.REF_CODE1                                                             AS DEL_YN            /* 삭제가능여부       		*/
		         , ISNULL(A.MODI_REASON, '')                                                AS REPORT_AMEND_CD   /* 신고문서 수정사유코드 	*/
		         , A.BFO_ISSU_ID      AS BFO_ISSU_ID       /* 당초승인번호       		*/
		         , ''                                                                       AS ERR_GUBUN   		 /*					*/
		         , D.ISSU_ID                                                                                     /*					*/
				 , CASE WHEN ISNULL(D.ERR_MSG, '') = '' THEN
																(CASE WHEN ISNULL((CASE WHEN ISNULL(C1.DIV_FULL_NAME, '') = '' THEN C1.DIV_NAME
									  													ELSE C1.DIV_FULL_NAME
									  													END ), '') = '' 
																		OR ISNULL(C1.REPRE_NAME, '') = '' 												THEN '공급자 정보를 확인하세요.(업체명, 대표자명)'
	
																	  WHEN ISNULL(C.CUSTOM_NAME, '') = '' 
																	  	OR ISNULL(C.TOP_NAME, '') = '' 													THEN '공급 받는자 정보를 확인하세요.(업체명, 대표자명)'
																	  
																--	  WHEN ISNULL(CASE WHEN ISNULL(C4.PRSN_NAME, '') = '' THEN ISNULL(C.BILL_MAIL_ID, '')
																--	  				   ELSE ISNULL(C4.MAIL_ID, '')
																--	  			   END, '') = ''														THEN '공급 받는자 정보를 확인하세요.(이메일주소)' --필수 제외됨
	<if test="ISSUE_GUBUN == &quot;3&quot;"> 	--위수탁사업자체크로직 추가	   
																	  WHEN ISNULL(Z2.CUSTOM_NAME, '') = '' 
																	  	OR ISNULL(Z2.TOP_NAME, '') = '' 												THEN '수탁사업자 정보를 확인하세요.(업체명, 대표자명)'
																	  
																	  WHEN ISNULL(CASE WHEN ISNULL(C5.PRSN_NAME, '') = '' THEN ISNULL(C.BILL_MAIL_ID, '')
																	  				   ELSE ISNULL(C4.MAIL_ID, '')
																	  			  END, '') = ''															THEN '수탁사업자 정보를 확인하세요.(이메일주소)'
	</if>
																	  ELSE ''
																END )
						ELSE D.ERR_MSG
				   END																	AS ERR_MSG           /* -- 에러메세지		*/
		         , A.BEFORE_PUB_NUM                        	/* 수정전세금계산서번호  	*/
		         , A.ORIGINAL_PUB_NUM                        	/* 원본세금계산서번호    	*/
		         , A.PLUS_MINUS_TYPE                        	/* 계산서 구분('+','-') */
		         , (CASE WHEN A.PLUS_MINUS_TYPE = '-' THEN 1 ELSE 2 END)                    AS SEQ_GUBUN      	/* 순번정열              		*/
		      FROM (/* 1.1 영업 세금계산서 테이블  */
		            SELECT A.COMP_CODE
		                 , A.DIV_CODE
		                 , A.SALE_DIV_CODE
		                 , A.EB_NUM
		                 , A.BILL_DATE
		                 , A.CUSTOM_CODE
		                 , (CASE WHEN @BillTypeYn = 'Y'
		                         THEN (CASE WHEN ISNULL(M1.REF_CODE1,'')='' THEN A.BILL_TYPE ELSE ISNULL(M1.REF_CODE1,'') END)
		                         ELSE A.BILL_TYPE
		                     END) AS BILL_TYPE
		                 , A.BILL_SEND_YN
		                 , A.BILL_FLAG
		                 , A.SALE_LOC_AMT_I
		                 , A.TAX_AMT_O
		                 , A.PUB_NUM
		                 , A.MODI_REASON
		                 , A.REMARK
		                 , (CASE WHEN A.BILL_GUBUN = '1' THEN '01'
		                         WHEN A.BILL_GUBUN = '2' THEN '02'
		                     END)                 	AS BILL_GUBUN
		                 , CONVERT(NVARCHAR, '1')  	AS CRT_LOC
		                 , ISNULL(A.SALE_PRSN, '') 	AS SALE_PRSN
		                 , A.BEFORE_PUB_NUM
		                 , A.ORIGINAL_PUB_NUM
		                 , A.PLUS_MINUS_TYPE
		                 , A.BFO_ISSU_ID
		                 , A.COMPANY_NUM
		                 , A.CUSTOM_NAME
		                 , A.TOP_NAME
		                 , A.ADDR
		                 , A.COMP_CLASS
		                 , A.COMP_TYPE
		                 , A.SERVANT_COMPANY_NUM
		                 , A.RECEIVE_PRSN_NAME
		                 , A.RECEIVE_PRSN_EMAIL
		                 , A.RECEIVE_PRSN_TEL
		                 , A.RECEIVE_PRSN_MOBL
		              FROM            STB100T A  WITH (NOLOCK)
		                   LEFT  JOIN BCM100T C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                                      AND C.CUSTOM_CODE  = A.CUSTOM_CODE
		                   LEFT  JOIN BCM100T C1 WITH (NOLOCK) ON C1.COMP_CODE   = C.COMP_CODE
		                                                      AND C1.CUSTOM_CODE = C.MANAGE_CUSTOM
		                   LEFT  JOIN WEBCASH_DB.WEBCASH.ITIS_ISSU_MSTR D WITH(NOLOCK) ON D.ISSU_SEQNO = A.EB_NUM
		                   LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                                      AND M1.SUB_CODE    = A.BILL_TYPE
		                                                      AND M1.MAIN_CODE   = 'S024'
		                   LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                                      AND M2.MAIN_CODE   = 'S099'
		                                                      AND M2.SUB_CODE    = '1'
		             WHERE A.COMP_CODE           = @CompCode
		               AND A.BILL_DATE       &gt;= #{BILL_DATE_FR}
		               AND A.BILL_DATE       &lt;= #{BILL_DATE_TO}
		               AND A.PLUS_MINUS_TYPE     = N'+'
		               AND C.BILL_PUBLISH_TYPE   = #{ISSUE_GUBUN}
		               AND ((ISNULL(A.AC_DATE, '') &gt; N'' AND M2.REF_CODE1 = 'Y') OR (M2.REF_CODE1 IS NULL OR M2.REF_CODE1  = 'N' OR M2.REF_CODE1 = ''))
		             <if test="@foren.Ognl@isNotEmpty(DIV_CODE)"> 
		               AND A.DIV_CODE            = #{DIV_CODE}
		             </if>
		             
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
					 AND A.CUSTOM_CODE 		= #{CUSTOM_CODE}					/* 거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
					 AND A.CUSTOM_CODE 		LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
					 AND C.CUSTOM_NAME 		LIKE '%' + #{CUSTOM_NAME} + '%'		/* 거래처명  */
					 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">
		    		   AND A.BILL_TYPE          = #{BILL_TYPE}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(STAT_CODE)">
		    		   AND D.STAT_CODE          = #{STAT_CODE}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_SEND_YN)">
		    		   AND A.BILL_SEND_YN       = #{BILL_SEND_YN}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_MEM_TYPE)">    
		    		   AND C.BILL_MEM_TYPE      = #{BILL_MEM_TYPE}
		    		 </if>
		    		 
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_CD) and @foren.Ognl@isNotEmpty(MANAGE_CUST_NM)">
					 AND C1.CUSTOM_CODE 		= #{MANAGE_CUST_CD}					/* 집계거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_CD) and @foren.Ognl@isEmpty(MANAGE_CUST_NM)">
					 AND C1.CUSTOM_CODE 		LIKE  #{MANAGE_CUST_CD} + '%'			/* 집계거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_NM) and @foren.Ognl@isEmpty(MANAGE_CUST_CD)">
					 AND C1.CUSTOM_NAME 		LIKE '%' + #{MANAGE_CUST_NM} + '%'		/* 집계거래처명  */
					 </if>
					 
		             <if test="@foren.Ognl@isNotEmpty(INSERT_DB_TIME_FR)">
		    		   AND CONVERT(VARCHAR(8), A.INSERT_DB_TIME, 112) &gt;= #{INSERT_DB_TIME_FR}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(INSERT_DB_TIME_TO)">
		    		   AND CONVERT(VARCHAR(8), A.INSERT_DB_TIME, 112) &lt;= #{INSERT_DB_TIME_TO}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(REMARK)">
		    		   AND A.REMARK          LIKE '%'+ #{REMARK} +'%'
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BUSI_PRSN)">
		    		   AND (A.SALE_PRSN = #{BUSI_PRSN} OR C.BUSI_PRSN = #{BUSI_PRSN})  
					 </if>
		               AND ((A.BILL_SEND_YN  = 'N' AND ISNULL(A.PRE_SEND_YN, 'N') != 'Y')           --20210527 추가: 선발행 되지 않은 데이터만 조회(미등록 조회시)
		                  OR A.BILL_SEND_YN != 'N')

		            UNION ALL

		             /* 1.2 회계 세금계산서 테이블    */
		            SELECT A.COMP_CODE
		                 , A.DIV_CODE
		                 , A.SALE_DIV_CODE
		                 , A.EB_NUM
		                 , A.BILL_DATE
		                 , A.CUSTOM_CODE
		                 , A.BILL_TYPE
		                 , A.BILL_SEND_YN
		                 , A.BILL_FLAG
		                 , A.SALE_LOC_AMT_I
		                 , A.TAX_AMT_O
		                 , A.PUB_NUM
		                 , A.MODI_REASON
		                 , A.REMARK
		                 , (CASE WHEN A.BILL_GUBUN = '1' THEN '01'
		                         WHEN A.BILL_GUBUN = '2' THEN '02'
		                     END)                  AS BILL_GUBUN
		                 , CONVERT(NVARCHAR, '3')  AS CRT_LOC
		                 , ISNULL(A.SALE_PRSN, '') AS SALE_PRSN
		                 , A.BEFORE_PUB_NUM
		                 , A.ORIGINAL_PUB_NUM
		                 , A.PLUS_MINUS_TYPE
		                 , A.BFO_ISSU_ID
		                 , A.COMPANY_NUM
		                 , A.CUSTOM_NAME
		                 , A.TOP_NAME
		                 , A.ADDR
		                 , A.COMP_CLASS
		                 , A.COMP_TYPE
		                 , A.SERVANT_COMPANY_NUM
		                 , A.RECEIVE_PRSN_NAME
		                 , A.RECEIVE_PRSN_EMAIL
		                 , A.RECEIVE_PRSN_TEL
		                 , A.RECEIVE_PRSN_MOBL
		              FROM           ATX110T A  WITH (NOLOCK)
		                   LEFT JOIN BCM100T C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                                     AND C.CUSTOM_CODE  = A.CUSTOM_CODE
		                   LEFT JOIN BCM100T C1 WITH (NOLOCK) ON C1.COMP_CODE   = C.COMP_CODE
		                                                     AND C1.CUSTOM_CODE = C.MANAGE_CUSTOM
		                   LEFT JOIN WEBCASH_DB.WEBCASH.ITIS_ISSU_MSTR D WITH(NOLOCK) ON D.ISSU_SEQNO = A.EB_NUM
		                   LEFT JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                                     AND M2.MAIN_CODE   = 'S099'
		                                                     AND M2.SUB_CODE    = '3'
		             WHERE A.COMP_CODE           = @CompCode
		               AND A.BILL_DATE       &gt;= #{BILL_DATE_FR}
		               AND A.BILL_DATE       &lt;= #{BILL_DATE_TO}
		               AND A.PLUS_MINUS_TYPE     = N'+'
		               AND C.BILL_PUBLISH_TYPE   = #{ISSUE_GUBUN}
		               AND ((ISNULL(A.AC_DATE, '') &gt; N'' AND M2.REF_CODE1 = 'Y') OR (M2.REF_CODE1 IS NULL OR M2.REF_CODE1  = 'N' OR M2.REF_CODE1 = ''))
					 <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		               AND A.DIV_CODE            = #{DIV_CODE}
		             </if>
		             
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
					 AND A.CUSTOM_CODE 		= #{CUSTOM_CODE}					/* 거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
					 AND A.CUSTOM_CODE 		LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
					 AND C.CUSTOM_NAME 		LIKE '%' + #{CUSTOM_NAME} + '%'		/* 거래처명  */
					 </if>
					
		             <if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">
		    		   AND A.BILL_TYPE           = #{BILL_TYPE}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(STAT_CODE)">
		    		   AND D.STAT_CODE           = #{STAT_CODE}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_SEND_YN)">
		    		   AND A.BILL_SEND_YN        = #{BILL_SEND_YN}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_MEM_TYPE)">
		    		   AND C.BILL_MEM_TYPE       = #{BILL_MEM_TYPE}
		    		 </if>
					 
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_CD) and @foren.Ognl@isNotEmpty(MANAGE_CUST_NM)">
					 AND C1.CUSTOM_CODE 		= #{MANAGE_CUST_CD}					/* 집계거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_CD) and @foren.Ognl@isEmpty(MANAGE_CUST_NM)">
					 AND C1.CUSTOM_CODE 		LIKE  #{MANAGE_CUST_CD} + '%'			/* 집계거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_NM) and @foren.Ognl@isEmpty(MANAGE_CUST_CD)">
					 AND C1.CUSTOM_NAME 		LIKE '%' + #{MANAGE_CUST_NM} + '%'		/* 집계거래처명  */
					 </if>
					 
		             <if test="@foren.Ognl@isNotEmpty(INSERT_DB_TIME_FR)">
		    		   AND CONVERT(VARCHAR(8), A.INSERT_DB_TIME, 112)    &gt;= #{INSERT_DB_TIME_FR}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(INSERT_DB_TIME_TO)">
		    		   AND CONVERT(VARCHAR(8), A.INSERT_DB_TIME, 112)    &lt;= #{INSERT_DB_TIME_TO}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(REMARK)">
		    		   AND A.REMARK           LIKE '%'+ #{REMARK} +'%'
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BUSI_PRSN)">
		    		   AND (A.SALE_PRSN = #{BUSI_PRSN} OR C.BUSI_PRSN = #{BUSI_PRSN})
					 </if>

		            UNION ALL

		            /* 1.3 무역 세금계산서 테이블 */
		            SELECT A.COMP_CODE
		                 , A.DIV_CODE
		                 , A.SALE_DIV_CODE
		                 , A.EB_NUM
		                 , A.BILL_DATE
		                 , A.CUSTOM_CODE
		                 , A.BILL_TYPE
		                 , A.BILL_SEND_YN
		                 , A.BILL_FLAG
		                 , A.SALE_LOC_AMT_I
		                 , A.TAX_AMT_O
		                 , A.PUB_NUM
		                 , A.MODI_REASON
		                 , A.REMARK
		                 , (CASE WHEN A.BILL_GUBUN = '1' THEN '01'
		                         WHEN A.BILL_GUBUN = '2' THEN '02'
		                     END)                  AS BILL_GUBUN
		                 , CONVERT(NVARCHAR, '5')  AS CRT_LOC
		                 , ISNULL(A.SALE_PRSN, '') AS SALE_PRSN
		                 , A.BEFORE_PUB_NUM
		                 , A.ORIGINAL_PUB_NUM
		                 , A.PLUS_MINUS_TYPE
		                 , A.BFO_ISSU_ID
		                 , A.COMPANY_NUM
		                 , A.CUSTOM_NAME
		                 , A.TOP_NAME
		                 , A.ADDR
		                 , A.COMP_CLASS
		                 , A.COMP_TYPE
		                 , A.SERVANT_COMPANY_NUM
		                 , A.RECEIVE_PRSN_NAME
		                 , A.RECEIVE_PRSN_EMAIL
		                 , A.RECEIVE_PRSN_TEL
		                 , A.RECEIVE_PRSN_MOBL
		              FROM            TTB100T A  WITH (NOLOCK)
		                   LEFT  JOIN BCM100T C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                                      AND C.CUSTOM_CODE  = A.CUSTOM_CODE
		                   LEFT  JOIN BCM100T C1 WITH (NOLOCK) ON C1.COMP_CODE   = C.COMP_CODE
		                                                      AND C1.CUSTOM_CODE = C.MANAGE_CUSTOM
		                   LEFT  JOIN WEBCASH_DB.WEBCASH.ITIS_ISSU_MSTR AS D WITH(NOLOCK) ON D.ISSU_SEQNO = A.EB_NUM
		                   LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                                      AND M2.MAIN_CODE   = 'S099'
		                                                      AND M2.SUB_CODE    = '5'
		             WHERE A.COMP_CODE           = @CompCode
		               AND A.BILL_DATE       &gt;= #{BILL_DATE_FR}
		               AND A.BILL_DATE       &lt;= #{BILL_DATE_TO}
		               AND A.PLUS_MINUS_TYPE     = N'+'
		               AND C.BILL_PUBLISH_TYPE   = #{ISSUE_GUBUN}
		               AND ((ISNULL(A.AC_DATE, '') &gt; N'' AND M2.REF_CODE1 = 'Y') OR (M2.REF_CODE1 IS NULL OR M2.REF_CODE1  = 'N' OR M2.REF_CODE1 = ''))
					 <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		               AND A.DIV_CODE            = #{DIV_CODE}
		             </if>
					 
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isNotEmpty(CUSTOM_NAME)">
					 AND A.CUSTOM_CODE 		= #{CUSTOM_CODE}					/* 거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE) and @foren.Ognl@isEmpty(CUSTOM_NAME)">
					 AND A.CUSTOM_CODE 		LIKE  #{CUSTOM_CODE} + '%'			/* 거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(CUSTOM_NAME) and @foren.Ognl@isEmpty(CUSTOM_CODE)">
					 AND C.CUSTOM_NAME 		LIKE '%' + #{CUSTOM_NAME} + '%'		/* 거래처명  */
					 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_TYPE)">
		    		   AND A.BILL_TYPE           = #{BILL_TYPE}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(STAT_CODE)">
		    		   AND D.STAT_CODE           = #{STAT_CODE}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_SEND_YN)">
		    		   AND A.BILL_SEND_YN        = #{BILL_SEND_YN}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BILL_MEM_TYPE)">
		    		   AND C.BILL_MEM_TYPE       = #{BILL_MEM_TYPE}
		    		 </if>
		    		 
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_CD) and @foren.Ognl@isNotEmpty(MANAGE_CUST_NM)">
					 AND C1.CUSTOM_CODE 		= #{MANAGE_CUST_CD}					/* 집계거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_CD) and @foren.Ognl@isEmpty(MANAGE_CUST_NM)">
					 AND C1.CUSTOM_CODE 		LIKE  #{MANAGE_CUST_CD} + '%'			/* 집계거래처코드  */
					 </if>
					 <if test="@foren.Ognl@isNotEmpty(MANAGE_CUST_NM) and @foren.Ognl@isEmpty(MANAGE_CUST_CD)">
					 AND C1.CUSTOM_NAME 		LIKE '%' + #{MANAGE_CUST_NM} + '%'		/* 집계거래처명  */
					 </if>
					 
		             <if test="@foren.Ognl@isNotEmpty(INSERT_DB_TIME_FR)">
		    		   AND CONVERT(VARCHAR(8), A.INSERT_DB_TIME, 112)    &gt;= #{INSERT_DB_TIME_FR}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(INSERT_DB_TIME_TO)">
		    		   AND CONVERT(VARCHAR(8), A.INSERT_DB_TIME, 112)    &lt;= #{INSERT_DB_TIME_TO}
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(REMARK)">
		    		   AND A.REMARK           LIKE '%'+ #{REMARK} +'%'
		    		 </if>
		             <if test="@foren.Ognl@isNotEmpty(BUSI_PRSN)">
		    		   AND (A.SALE_PRSN = #{BUSI_PRSN} OR C.BUSI_PRSN = #{BUSI_PRSN})
					 </if>
		           ) A
		           LEFT  JOIN (SELECT MAX(SEND_LOG_TIME) AS SEND_LOG_TIME
		                            , DIV_CODE
		                            , EB_NUM
		                            , BILL_DATE
		                            , CUSTOM_CODE
		                            , MAX(EB_STEP) AS EB_STEP
		                            , COMP_CODE
		                         FROM STB200T WITH (NOLOCK)
		                        WHERE COMP_CODE  = #{S_COMP_CODE}
						<if test="@foren.Ognl@isNotEmpty(BUSI_PRSN)">
		                          AND DIV_CODE   = #{DIV_CODE}
						</if>
		                          AND EB_STEP IN('1', '2')
		                        GROUP BY COMP_CODE, DIV_CODE, EB_NUM, BILL_DATE, CUSTOM_CODE) B ON B.COMP_CODE   = A.COMP_CODE
		                                                                                       AND B.DIV_CODE    = A.DIV_CODE
		                                                                                       AND B.EB_NUM      = A.EB_NUM
		                                                                                       AND B.BILL_DATE   = A.BILL_DATE
		                                                                                       AND B.CUSTOM_CODE = A.CUSTOM_CODE
		           LEFT  JOIN BCM100T C  WITH (NOLOCK) ON C.COMP_CODE    = A.COMP_CODE
		                                              AND C.CUSTOM_CODE  = A.CUSTOM_CODE
		           LEFT  JOIN WEBCASH_DB.WEBCASH.ITIS_ISSU_MSTR AS D  ON D.ISSU_SEQNO  = A.EB_NUM
		           LEFT  JOIN BOR120T C1 WITH (NOLOCK) ON C1.COMP_CODE   = A.COMP_CODE
		                                              AND C1.DIV_CODE    = A.DIV_CODE
		           LEFT  JOIN BOR100T C2 WITH (NOLOCK) ON C2.COMP_CODE   = A.COMP_CODE
		           LEFT  JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE   = A.COMP_CODE
		                                              AND M1.MAIN_CODE   = 'B066'
		                                              AND M1.SUB_CODE   != '$'
		                                              AND M1.SUB_CODE    = (CASE WHEN A.BILL_TYPE = '12' THEN '11' ELSE A.BILL_TYPE END)
		           LEFT  JOIN BSA100T M2 WITH (NOLOCK) ON M2.COMP_CODE   = A.COMP_CODE
		                                              AND M2.MAIN_CODE   = 'B087'
		                                              AND M2.SUB_CODE   != '$'
		                                              AND M2.SUB_CODE    = A.BILL_SEND_YN
		           LEFT  JOIN BSA100T M3 WITH (NOLOCK) ON M3.COMP_CODE   = A.COMP_CODE
		                                              AND M3.MAIN_CODE   = 'S080'
		                                              AND M3.SUB_CODE   != '$'
		                                              AND M3.SUB_CODE    = D.STAT_CODE
		           LEFT  JOIN BSA100T M4 WITH (NOLOCK) ON M4.COMP_CODE   = A.COMP_CODE
		                                              AND M4.MAIN_CODE   = 'S081'
		                                              AND M4.SUB_CODE   != '$'
		                                              AND M4.SUB_CODE    = D.REQ_STAT_CODE
		           LEFT  JOIN (SELECT A.COMP_CODE
		                            , A.CUSTOM_CODE
		                            , A.PRSN_NAME
		                            , A.MAIL_ID
		                            , A.HAND_PHON
		                            , A.TELEPHONE_NUM1
		                         FROM            BCM120T A WITH(NOLOCK)
		                              INNER JOIN (SELECT A.COMP_CODE
		                                               , MAX(A.CUSTOM_CODE) AS CUSTOM_CODE
		                                               , MIN(A.SEQ)         AS SEQ
		                                            FROM BCM120T AS A WITH(NOLOCK)
		                                           WHERE A.MAIN_BILL_YN ='Y'
		                                             AND A.BILL_TYPE IN ('1','3')
		                                           GROUP BY A.COMP_CODE, A.CUSTOM_CODE) B ON B.COMP_CODE   = A.COMP_CODE
		                                                                                 AND B.CUSTOM_CODE = A.CUSTOM_CODE
		                                                                                 AND B.SEQ         = A.SEQ) C4 ON C4.COMP_CODE   = A.COMP_CODE
		                                                                                                              AND C4.CUSTOM_CODE = A.CUSTOM_CODE
		           LEFT  JOIN BSA100T E1 WITH (NOLOCK)  ON E1.COMP_CODE   = A.COMP_CODE
		                                               AND E1.MAIN_CODE   = 'S010'
		                                               AND E1.SUB_CODE   != '$'
		                                               AND E1.SUB_CODE    = A.SALE_PRSN
	 	           LEFT  JOIN BSA100T E2 WITH (NOLOCK)  ON E2.COMP_CODE   = C.COMP_CODE
	 	                                               AND E2.MAIN_CODE   = 'S010'
	 	                                               AND E2.SUB_CODE   != '$'
		                                               AND E2.SUB_CODE    = C.BUSI_PRSN
		           LEFT  JOIN BSA210T E3 WITH (NOLOCK)  ON E3.COMP_CODE   = E1.COMP_CODE
		                                               AND E3.TREE_CODE   = E1.REF_CODE2
		           LEFT  JOIN BSA210T E4 WITH (NOLOCK)  ON E4.COMP_CODE   = E2.COMP_CODE
		                                               AND E4.TREE_CODE   = E2.REF_CODE2
		           LEFT  JOIN BSA100T E5 WITH (NOLOCK)  ON E5.COMP_CODE   = A.COMP_CODE
		                                               AND E5.MAIN_CODE   = 'S083'
		                                               AND E5.SUB_CODE   != '$'
		                                               AND E5.SUB_CODE    = '01'
		           LEFT  JOIN BSA100T E6 WITH (NOLOCK)  ON E6.COMP_CODE   = A.COMP_CODE
		                                               AND E6.MAIN_CODE   = 'S083'
		                                               AND E6.SUB_CODE   != '$'
		                                               AND E6.SUB_CODE    = '02'
		           LEFT  JOIN BSA100T E7 WITH (NOLOCK)  ON E7.COMP_CODE   = A.COMP_CODE
		                                               AND E7.MAIN_CODE   = 'S083'
		                                               AND E7.SUB_CODE   != '$'
		                                               AND E7.SUB_CODE    = '03'
		     WHERE ISNULL(A.SALE_LOC_AMT_I, 0) + ISNULL(A.TAX_AMT_O, 0) != 0.0
		     <if test="@foren.Ognl@isNotEmpty(CRT_LOC)">
		       AND A.CRT_LOC =  #{CRT_LOC}
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(SEND_LOG_TIME_FR)">
		       AND CONVERT(VARCHAR(8), B.SEND_LOG_TIME, 112)    &gt;= #{SEND_LOG_TIME_FR}
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(SEND_LOG_TIME_TO)">
		       AND CONVERT(VARCHAR(8), B.SEND_LOG_TIME, 112)    &lt;= #{SEND_LOG_TIME_TO}
		     </if>
		     ORDER BY A.BILL_DATE, A.CUSTOM_CODE, SEQ_GUBUN
	
			SET NOCOUNT OFF
			SET ARITHABORT OFF
		END
	</select>

<!--에러 메세지 조회 -->
	<select id="ssa720ukrvServiceImpl.getErrMsg" parameterType="Map" resultType="rMap">
		/* ssa720ukrvServiceImpl.getErrMsg    */
		SELECT TOP 1 ISNULL(ERR_MSG, '') AS ERR_MESG
		  FROM WEBCASH_DB.WEBCASH.ITIS_ISSU_MSTR WITH(NOLOCK)
		 WHERE ISSU_SEQNO = #{ISSU_SEQNO}
	</select>


<!--발송 -->
	<insert id="ssa720ukrvServiceImpl.saveWebCash" parameterType="Map">
	INSERT INTO L_SSA720T
		 ( KEY_VALUE			, OPR_FLAG				, TRANSYN_NAME			, STAT_CODE				, STS
		 , CRT_LOC				, BILL_FLAG				, TAX_TYPE				, POPS_CODE				, REGS_DATE
	     , SELR_CORP_NO			, SELR_CORP_NM			, SELR_CODE				, SELR_CEO				, SELR_BUSS_CONS
	     , SELR_BUSS_TYPE		, SELR_ADDR				, SELR_CHRG_NM			, SELR_CHRG_POST		, SELR_CHRG_TEL
	     , SELR_CHRG_EMAIL		, SELR_CHRG_MOBL		, CUSTOM_CODE			, BUYR_CORP_NM			, BUYR_GB
	     , BUYR_CORP_NO
	     , BUYR_CODE			, BILLTYPENAME			, CHRG_AMT				, TAX_AMT
	     , TOTL_AMT				, BUYR_CEO				, BUYR_BUSS_CONS		, BUYR_BUSS_TYPE		, BUYR_ADDR
	     , BUYR_CHRG_NM1		, BUYR_CHRG_TEL1		, BUYR_CHRG_MOBL1		, BUYR_CHRG_EMAIL1		, BUYR_CHRG_NM2
	     , BUYR_CHRG_MOBL2		, BUYR_CHRG_EMAIL2		, SEND_DATE				, ISSU_SEQNO			, SELR_MGR_ID3
	     , NOTE1				, MODY_CODE				, REQ_STAT_CODE			, RECP_CD				, BILL_TYPE
	     , SND_MAIL_YN			, SND_SMS_YN			, SND_FAX_YN			, COMP_CODE				, DIV_CODE
	     , SALE_DIV_CODE		, DEL_YN				, REPORT_AMEND_CD		, BFO_ISSU_ID			, ERR_GUBUN
	     , ISSU_ID				, BEFORE_PUB_NUM		, ORIGINAL_PUB_NUM		, PLUS_MINUS_TYPE		, SEQ_GUBUN
	     , INSERT_DB_USER		, INSERT_DB_TIME   )
	VALUES
		 ( #{KEY_VALUE}			, #{OPR_FLAG}			, #{TRANSYN_NAME}		, #{STAT_CODE}			, #{STS}
	     , #{CRT_LOC}			, #{BILL_FLAG}			, #{TAX_TYPE}			, #{POPS_CODE}			, #{REGS_DATE}
	     , #{SELR_CORP_NO}		, #{SELR_CORP_NM}		, #{SELR_CODE}			, #{SELR_CEO}			, #{SELR_BUSS_CONS}
	     , #{SELR_BUSS_TYPE}	, #{SELR_ADDR}			, #{SELR_CHRG_NM}		, #{SELR_CHRG_POST}		, #{SELR_CHRG_TEL}
	     , #{SELR_CHRG_EMAIL}	, #{SELR_CHRG_MOBL}		, #{CUSTOM_CODE}		, #{BUYR_CORP_NM}		, #{BUYR_GB}
	     , REPLACE(#{BUYR_CORP_NO}, '-', '')
	     , #{BUYR_CODE}			, #{BILLTYPENAME}		, #{CHRG_AMT}			, #{TAX_AMT}
	     , #{TOTL_AMT}			, #{BUYR_CEO}			, #{BUYR_BUSS_CONS}		, #{BUYR_BUSS_TYPE}		, #{BUYR_ADDR}
	     , #{BUYR_CHRG_NM1}		, #{BUYR_CHRG_TEL1}		, #{BUYR_CHRG_MOBL1}	, #{BUYR_CHRG_EMAIL1}	, #{BUYR_CHRG_NM2}
	     , #{BUYR_CHRG_MOBL2}	, #{BUYR_CHRG_EMAIL2}	, #{SEND_DATE}			, #{ISSU_SEQNO}			, #{SELR_MGR_ID3}
	     , #{NOTE1}				, #{MODY_CODE}			, #{REQ_STAT_CODE}		, #{RECP_CD}			, #{BILL_TYPE}
	     , #{SND_MAIL_YN}		, #{SND_SMS_YN}			, #{SND_FAX_YN}			, #{COMP_CODE}			, #{DIV_CODE}
	     , #{SALE_DIV_CODE}		, #{DEL_YN}				, #{REPORT_AMEND_CD}	, #{BFO_ISSU_ID}		, #{ERR_GUBUN}
	     , #{ISSU_ID}			, #{BEFORE_PUB_NUM}		, #{ORIGINAL_PUB_NUM}	, #{PLUS_MINUS_TYPE}	, #{SEQ_GUBUN}
	     , #{S_USER_ID}			, GETDATE() )
	</insert>

	<update id="ssa720ukrvServiceImpl.execWebCash" parameterType="Map" statementType="CALLABLE">
		{call USP_SALES_ElectronicTaxInvoiceOfWebCash (
			#{COMP_CODE		, mode=IN		, jdbcType=VARCHAR		, javaType=java.lang.String},
			#{KEY_VALUE		, mode=IN		, jdbcType=VARCHAR		, javaType=java.lang.String},
<!--			#{OPR_FLAG		, mode=IN		, jdbcType=VARCHAR		, javaType=java.lang.String}, -->
			#{UNIT_OPT		, mode=IN		, jdbcType=VARCHAR		, javaType=java.lang.String},
			#{LANG_TYPE		, mode=IN		, jdbcType=VARCHAR		, javaType=java.lang.String},
			#{LOGIN_ID		, mode=IN		, jdbcType=VARCHAR		, javaType=java.lang.String},
			#{ERROR_DESC	, mode=OUT		, jdbcType=VARCHAR		, javaType=java.lang.String} 
		)}
	</update>
</mapper>