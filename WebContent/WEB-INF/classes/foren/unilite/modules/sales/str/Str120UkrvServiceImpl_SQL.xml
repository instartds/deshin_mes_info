<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="str120ukrvServiceImpl">
	<select id="str120ukrvServiceImpl.selectInNumMaster" parameterType="Map" resultType="rMap">
		/* str120ukrv.Cstr120ukrv[fnStr120QPop] Query01 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON

		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE}

		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')


		    SELECT A.ITEM_CODE
		         , (CASE WHEN @RefItem = '1' THEN D.ITEM_NAME1
		                 WHEN @RefItem = '2' THEN D.ITEM_NAME2
		                                     ELSE D.ITEM_NAME
		            END)                                                                     AS ITEM_NAME
		         , B.SPEC
		         , (CASE WHEN ISNULL(A.INOUT_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INOUT_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.INOUT_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.INOUT_DATE, 7, 2))
		            END)                                                                     AS INOUT_DATE
		         , A.INOUT_Q
		         , A.INOUT_PRSN
		         , A.INOUT_NUM
		         , A.PROJECT_NO
		         , A.DIV_CODE
		         , A.WH_CODE
		         , A.WH_CELL_CODE
		         , C1.WH_CELL_NAME
		         , A.LOT_NO
		         , RTRIM(A.INOUT_NUM) + RTRIM(CONVERT(VARCHAR(4),A.INOUT_SEQ))                AS SORT_KEY
		      FROM            BTR100T A  WITH (NOLOCK)
		           INNER JOIN BPR100T B  WITH (NOLOCK) ON B.COMP_CODE      = A.COMP_CODE
		                                              AND B.ITEM_CODE      = A.ITEM_CODE
		           LEFT  JOIN BSA225T C1 WITH (NOLOCK) ON C1.COMP_CODE     = A.COMP_CODE
		                                              AND C1.DIV_CODE      = A.DIV_CODE
		                                              AND C1.WH_CODE       = A.WH_CODE
		                                              AND C1.WH_CELL_CODE  = A.WH_CELL_CODE
		           INNER JOIN BPR100T D  WITH (NOLOCK) ON D.COMP_CODE      = A.COMP_CODE
		                                              AND D.ITEM_CODE      = A.ITEM_CODE
		     WHERE A.INOUT_TYPE         = '1'
		       AND A.CREATE_LOC         = '1'
		       AND A.INOUT_TYPE_DETAIL != '98'
		       AND A.COMP_CODE          = @CompCode	  /* 법인코드 */
		     <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		       AND A.DIV_CODE           = #{DIV_CODE}
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
		       AND A.WH_CODE            = #{WH_CODE}     /* 입고창고 */
		     </if>
		     
		     <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		       AND A.ITEM_CODE 			= #{ITEM_CODE}						/* 품목코드  */
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		       AND A.ITEM_CODE 			LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
		       AND B.ITEM_NAME 			LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
		     </if>
		     
		     <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		       AND A.PROJECT_NO      LIKE #{PROJECT_NO}     /* 관리번호 */
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(INOUT_PRSN)">
		       AND A.INOUT_PRSN         = #{INOUT_PRSN}     /* 담당자 */
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">
		       AND A.INOUT_DATE     &gt;= #{INOUT_DATE_FR}     /* 입고일FROM */
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">
		       AND A.INOUT_DATE     &lt;= #{INOUT_DATE_TO}     /* 입고일TO */
		     </if>
		     <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		       AND A.LOT_NO          LIKE #{PROJECT_NO}     /* 관리번호 */
			 </if>
		     ORDER BY A.ITEM_CODE, A.INOUT_DATE, A.INOUT_PRSN

		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="str120ukrvServiceImpl.selectProdtList" parameterType="Map" resultType="rMap">
		/* str120ukrv.Cstr120ukrv[fnPmr200QRef] Query02 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON

		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		     SET @CompCode = #{S_COMP_CODE}
		     SET @UserId   = #{S_USER_ID}
		     SET @LangType = #{S_LANG_CODE}

		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

		    DECLARE     @InspecFlag     NVARCHAR(01)    /* 생산검사 사용여부 */

		    SELECT TOP 1 @InspecFlag = MAX(SUB_CODE)
		    FROM   BSA100T WITH (NOLOCK)
		    WHERE  COMP_CODE = @CompCode
		    AND    MAIN_CODE = 'Q004'
		    AND    UPPER(ISNULL(LEFT(REF_CODE1, 1), '')) = 'Y'

		    SET @InspecFlag = ISNULL(@InspecFlag, 'N')

		    /* 데이터 조회 */
		    SELECT A.*
		    FROM   (
		           /* 생산실적(양품)내역 조회 */
		           SELECT
		                  CAST(0 AS BIT) AS CHOICE
		                , A.ITEM_CODE
		                , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                       WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                       ELSE                     C1.ITEM_NAME
		                  END  AS ITEM_NAME
		                , C1.SPEC
		                , C1.STOCK_UNIT
		                , (CASE WHEN ISNULL(A.PRODT_DATE, '') = ''
		                        THEN ''
		                        ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.PRODT_DATE, 1, 4))
		                                                                , 'MM'  , SUBSTRING(A.PRODT_DATE, 5, 2))
		                                                                , 'DD'  , SUBSTRING(A.PRODT_DATE, 7, 2))
		                   END)                                            AS PROD_DT
		                , A.GOOD_PRODT_Q                                   AS PRODT_Q
		                , ISNULL(A.GOOD_PRODT_Q, 0) - ISNULL(B.INOUT_Q, 0) AS NOTIN_Q
		                , A.WORK_SHOP_CODE
		                , C3.TREE_NAME                                     AS WK_SHOP_NM
		                , A.PRODT_NUM
		                , A.WKORD_NUM
		                , A.DIV_CODE
		                , A.REMARK
		                , A.PROJECT_NO
		                , A.LOT_NO
		                , ISNULL(C2.BASIS_P, 0)                            AS BASIS_P
		                , C2.ITEM_ACCOUNT
		                , RTRIM(A.PRODT_NUM) + RTRIM(A.DIV_CODE)           AS SORT_KEY
		                , C2.WH_CODE
		                , (CASE WHEN ISNULL(A.PRODT_DATE, '') = ''
		                        THEN ''
		                        ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.PRODT_DATE, 1, 4))
		                                                                , 'MM'  , SUBSTRING(A.PRODT_DATE, 5, 2))
		                                                                , 'DD'  , SUBSTRING(A.PRODT_DATE, 7, 2))
		                   END)                                            AS PRODT_DATE
		                , CONVERT(NVARCHAR(01), '1')                       AS ITEM_STATUS
		                --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		                , Z.EXPIRATION_DATE                                AS MAKE_EXP_DATE
		           FROM              PMR200T A  WITH (NOLOCK)
		                  LEFT  JOIN (
		                             SELECT COMP_CODE, DIV_CODE, BASIS_NUM, ITEM_STATUS
		                                  , SUM(INOUT_Q) AS INOUT_Q
		                             FROM   BTR100T WITH (NOLOCK)
		                             WHERE  COMP_CODE   = @CompCode
		                             AND    DIV_CODE    = #{DIV_CODE}
		                             AND    INOUT_TYPE  = '1'
		                             AND    CREATE_LOC  = '1'
		                             AND    ITEM_STATUS = '1'
		                             GROUP  BY COMP_CODE, DIV_CODE, BASIS_NUM, ITEM_STATUS
		                             ) B ON A.COMP_CODE = B.COMP_CODE
		                                AND A.DIV_CODE  = B.DIV_CODE
		                                AND A.PRODT_NUM = B.BASIS_NUM
		                  INNER JOIN BPR100T C1 WITH (NOLOCK) ON C1.COMP_CODE  = A.COMP_CODE
		                                                     AND C1.ITEM_CODE  = A.ITEM_CODE
		                  INNER JOIN BPR200T C2 WITH (NOLOCK) ON C2.COMP_CODE  = A.COMP_CODE
		                                                     AND C2.DIV_CODE   = A.DIV_CODE
		                                                     AND C2.ITEM_CODE  = A.ITEM_CODE
		                  INNER JOIN BSA230T C3 WITH (NOLOCK) ON C3.COMP_CODE  = A.COMP_CODE
		                                                     AND C3.TYPE_LEVEL = A.DIV_CODE
		                                                     AND C3.TREE_CODE  = A.WORK_SHOP_CODE
		                  --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		                  INNER JOIN PMR100T Z  WITH (NOLOCK) ON Z.COMP_CODE  = A.COMP_CODE
		                                                     AND Z.DIV_CODE   = A.DIV_CODE
		                                                     AND Z.PRODT_NUM  = A.PRODT_NUM
		           WHERE  A.COMP_CODE                      = @CompCode
		           AND    A.GOOD_PRODT_Q - ISNULL(B.INOUT_Q, 0) &gt; 0
		           AND    ((ISNULL(C2.INSPEC_YN, 'N') = 'N'      AND @InspecFlag     = 'Y') OR (@InspecFlag     = 'N'))

		           <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
		           AND    C2.WH_CODE       = #{WH_CODE}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_FR)">
		           AND    A.PRODT_DATE    &gt;= #{PRODT_DATE_FR}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_TO)">
		           AND    A.PRODT_DATE    &lt;= #{PRODT_DATE_TO}
		           </if>
		           
		           <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		           AND A.ITEM_CODE 			= #{ITEM_CODE}						/* 품목코드  */
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		           AND A.ITEM_CODE 			LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
		           AND (CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                     WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                                         ELSE C1.ITEM_NAME
		                 END)				LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
		           </if>
		           
		           <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		           AND    A.DIV_CODE       = #{DIV_CODE}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(WORK_SHOP_CODE)">
		           AND    A.WORK_SHOP_CODE = #{WORK_SHOP_CODE}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		           AND    A.PROJECT_NO  LIKE #{PROJECT_NO} + '%'
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(LOT_NO)">
		           AND    A.LOT_NO    = #{LOT_NO}
		           </if>
		           UNION  ALL

		           /* 생산실적(불량)내역 조회 */
		           SELECT
		                  CAST(0 AS BIT) AS CHOICE
		                , A.ITEM_CODE
		                , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                       WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                       ELSE                     C1.ITEM_NAME
		                  END  AS ITEM_NAME
		                , C1.SPEC
		                , C1.STOCK_UNIT
		                , (CASE WHEN ISNULL(A.PRODT_DATE, '') = ''
		                        THEN ''
		                        ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.PRODT_DATE, 1, 4))
		                                                                , 'MM'  , SUBSTRING(A.PRODT_DATE, 5, 2))
		                                                                , 'DD'  , SUBSTRING(A.PRODT_DATE, 7, 2))
		                   END)                                            AS PROD_DT
		                , A.BAD_PRODT_Q                                    AS PRODT_Q
		                , ISNULL(A.BAD_PRODT_Q, 0) - ISNULL(B.INOUT_Q, 0)  AS NOTIN_Q
		                , A.WORK_SHOP_CODE
		                , C3.TREE_NAME                                     AS WK_SHOP_NM
		                , A.PRODT_NUM
		                , A.WKORD_NUM
		                , A.DIV_CODE
		                , A.REMARK
		                , A.PROJECT_NO
		                , A.LOT_NO
		                , ISNULL(C2.BASIS_P, 0)                            AS BASIS_P
		                , C2.ITEM_ACCOUNT
		                , RTRIM(A.PRODT_NUM) + RTRIM(A.DIV_CODE)           AS SORT_KEY
		                , C2.WH_CODE
		                , (CASE WHEN ISNULL(A.PRODT_DATE, '') = ''
		                        THEN ''
		                        ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.PRODT_DATE, 1, 4))
		                                                                , 'MM'  , SUBSTRING(A.PRODT_DATE, 5, 2))
		                                                                , 'DD'  , SUBSTRING(A.PRODT_DATE, 7, 2))
		                   END)                                            AS PRODT_DATE
		                , CONVERT(NVARCHAR(01), '2')                       AS ITEM_STATUS
		                --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		                , Z.EXPIRATION_DATE                                AS MAKE_EXP_DATE
		           FROM              PMR200T A  WITH (NOLOCK)
		                  LEFT  JOIN (
		                             SELECT COMP_CODE, DIV_CODE, BASIS_NUM, ITEM_STATUS
		                                  , SUM(INOUT_Q) AS INOUT_Q
		                             FROM   BTR100T WITH (NOLOCK)
		                             WHERE  COMP_CODE   = @CompCode
		                             AND    DIV_CODE    = #{DIV_CODE}
		                             AND    INOUT_TYPE  = '1'
		                             AND    CREATE_LOC  = '1'
		                             AND    ITEM_STATUS = '2'
		                             GROUP  BY COMP_CODE, DIV_CODE, BASIS_NUM, ITEM_STATUS
		                             ) B ON A.COMP_CODE = B.COMP_CODE
		                                AND A.DIV_CODE  = B.DIV_CODE
		                                AND A.PRODT_NUM = B.BASIS_NUM
		                  INNER JOIN BPR100T C1 WITH (NOLOCK) ON C1.COMP_CODE  = A.COMP_CODE
		                                                     AND C1.ITEM_CODE  = A.ITEM_CODE
		                  INNER JOIN BPR200T C2 WITH (NOLOCK) ON C2.COMP_CODE  = A.COMP_CODE
		                                                     AND C2.DIV_CODE   = A.DIV_CODE
		                                                     AND C2.ITEM_CODE  = A.ITEM_CODE
		                  INNER JOIN BSA230T C3 WITH (NOLOCK) ON C3.COMP_CODE  = A.COMP_CODE
		                                                     AND C3.TYPE_LEVEL = A.DIV_CODE
		                                                     AND C3.TREE_CODE  = A.WORK_SHOP_CODE
		                  INNER JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
		                                                     AND M1.MAIN_CODE  = 'P007'     /* 제품입고시 불량반영여부 */
		                                                     AND M1.SUB_CODE   = '1'
		                                                     AND M1.REF_CODE1  = 'Y'
		                  --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		                  INNER JOIN PMR100T Z  WITH (NOLOCK) ON Z.COMP_CODE  = A.COMP_CODE
		                                                     AND Z.DIV_CODE   = A.DIV_CODE
		                                                     AND Z.PRODT_NUM  = A.PRODT_NUM
		           WHERE  A.COMP_CODE                      = @CompCode
		           AND    A.BAD_PRODT_Q - ISNULL(B.INOUT_Q, 0) &gt; 0
		          /*   2008/08/25 - 품질대상여부가 [예]더라도 생산에서 불량으로 잡은 수량은 바로 입고를 잡을 수 있도록 처리함 */
		           <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
		           AND   C2.WH_CODE       = #{WH_CODE}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_FR)">
		           AND    A.PRODT_DATE &gt;= #{PRODT_DATE_FR}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_TO)">
		           AND    A.PRODT_DATE &lt;= #{PRODT_DATE_TO}
		           </if>
		           
		           <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		           AND A.ITEM_CODE 			= #{ITEM_CODE}						/* 품목코드  */
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		           AND A.ITEM_CODE 			LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
		           AND (CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                     WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                                         ELSE C1.ITEM_NAME
		                 END)				LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
		           </if>
		           
		           <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		           AND    A.DIV_CODE       = #{DIV_CODE}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(WORK_SHOP_CODE)">
		           AND    A.WORK_SHOP_CODE = #{WORK_SHOP_CODE}
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		           AND    A.PROJECT_NO  LIKE #{PROJECT_NO} + '%'
		           </if>
		           <if test="@foren.Ognl@isNotEmpty(LOT_NO)">
		           AND    A.LOT_NO    = #{LOT_NO}
		           </if>
		           ) A

		     ORDER BY A.ITEM_CODE,A.LOT_NO, A.PRODT_DATE, A.PRODT_NUM

		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="str120ukrvServiceImpl.inspecResultList" parameterType="Map" resultType="rMap">
		/* str120ukrv.Cstr120ukrv[fnQms400QRef] Query01 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON

		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		     SET @CompCode = #{S_COMP_CODE}
		     SET @UserId   = #{S_USER_ID}
		     SET @LangType = #{S_LANG_CODE}

		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')
		    /* 3. 임시 테이블 선언 */
		    IF EXISTS (SELECT TOP 1 1 FROM tempdb..sysobjects WHERE id = OBJECT_ID('tempdb..#uniLITE200903191211'))
		       DROP TABLE #uniLITE200903191211

		    CREATE TABLE #uniLITE200903191211
		        (
		     /* 일반정보 */
		        COMP_CODE           NVARCHAR(08)
		      , DIV_CODE            NVARCHAR(08)
		      , PRODT_NUM           NVARCHAR(20)
		      , WKORD_NUM           NVARCHAR(20)
		      , INSPEC_NUM          NVARCHAR(20)
		      , INSPEC_SEQ          NUMERIC(04,0)

		    /* 품목정보 */
		      , ITEM_CODE           NVARCHAR(20)
		      , ITEM_NAME           NVARCHAR(100)
		      , SPEC                NVARCHAR(100)
		      , STOCK_UNIT          NVARCHAR(03)
		      , BASIS_P             NUMERIC(18,6)
		      , ITEM_ACCOUNT        NVARCHAR(02)

		    /* 생산 및 검사정보 */
		      , PRODT_DATE          NVARCHAR(08)
		      , INSPEC_DATE         NVARCHAR(08)
		      , PRODT_Q             NUMERIC(18,6)    DEFAULT 0
		      , GOOD_INSPEC_Q       NUMERIC(18,6)    DEFAULT 0
		      , BAD_INSPEC_Q        NUMERIC(18,6)    DEFAULT 0
		      , INOUT_Q             NUMERIC(18,6)    DEFAULT 0
		      , ITEM_STATUS         NVARCHAR(01)
		      , WORK_SHOP_CODE      NVARCHAR(08)
		      , WORK_SHOP_NAME      NVARCHAR(100)
		      , WH_CODE             NVARCHAR(08)
		      , WH_NAME             NVARCHAR(100)

		    /* 기타정보 */
		      , PROJECT_NO          NVARCHAR(20)
		      , LOT_NO              NVARCHAR(20)
		      , SORT_KEY            AS RTRIM(INSPEC_NUM) + CONVERT(NVARCHAR(05), RTRIM(INSPEC_SEQ))
		      --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		      , MAKE_EXP_DATE       NVARCHAR(08)
		        )
		    CREATE INDEX uniLITE200903040004_IDX01 ON #uniLITE200903191211(COMP_CODE, DIV_CODE, INSPEC_NUM, INSPEC_SEQ)

		    /* 4. 조회 데이터 생성 (양품) */
		    INSERT INTO #uniLITE200903191211
		    (      COMP_CODE          , DIV_CODE          , PRODT_NUM         , WKORD_NUM
		         , INSPEC_NUM         , INSPEC_SEQ
		         , ITEM_CODE          , ITEM_NAME         , SPEC              , STOCK_UNIT        , BASIS_P      , ITEM_ACCOUNT
		         , PRODT_DATE         , INSPEC_DATE       , PRODT_Q           , GOOD_INSPEC_Q     , BAD_INSPEC_Q
		         , INOUT_Q            , ITEM_STATUS       , WORK_SHOP_CODE    , WORK_SHOP_NAME
		         , WH_CODE            , WH_NAME           , PROJECT_NO        , LOT_NO
		         --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		         , MAKE_EXP_DATE
		    )
		    SELECT A.COMP_CODE
		         , A.DIV_CODE
		         , A.PRODT_NUM
		         , A.WKORD_NUM
		         , B.INSPEC_NUM
		         , B.INSPEC_SEQ

		         , A.ITEM_CODE
		         , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                ELSE C1.ITEM_NAME
		           END  AS ITEM_NAME
		         , C1.SPEC
		         , C1.STOCK_UNIT
		         , ISNULL(C2.BASIS_P, 0) AS BASIS_P
		         , C2.ITEM_ACCOUNT

		         , A.PRODT_DATE
		         , B.INSPEC_DATE
		         , A.PRODT_Q
		         , B.GOOD_INSPEC_Q
		         , 0                     AS BAD_INSPEC_Q
		         , 0                     AS INOUT_Q
		         , '1'                   AS ITEM_STATUS
		         , A.WORK_SHOP_CODE
		         , C3.TREE_NAME          AS WORK_SHOP_NAME
		         , C2.WH_CODE
		         , C4.TREE_NAME          AS WH_NAME
		         , A.PROJECT_NO
		         , A.LOT_NO
		         --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		         , Z.EXPIRATION_DATE                                AS MAKE_EXP_DATE
		    FROM              PMR200T A  WITH (NOLOCK)
		           INNER JOIN QMS400T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                              AND B.DIV_CODE    = A.DIV_CODE
		                                              AND B.PRODT_NUM   = A.PRODT_NUM
		                                              AND B.WKORD_NUM   = A.WKORD_NUM

		           INNER JOIN BPR100T C1 WITH (NOLOCK) ON C1.COMP_CODE  = A.COMP_CODE
		                                              AND C1.ITEM_CODE  = A.ITEM_CODE
		           INNER JOIN BPR200T C2 WITH (NOLOCK) ON C2.COMP_CODE  = A.COMP_CODE
		                                              AND C2.DIV_CODE   = A.DIV_CODE
		                                              AND C2.ITEM_CODE  = A.ITEM_CODE
		           LEFT  JOIN BSA230T C3 WITH (NOLOCK) ON C3.COMP_CODE  = A.COMP_CODE
		                                              AND C3.TYPE_LEVEL = A.DIV_CODE
		                                              AND C3.TREE_CODE  = A.WORK_SHOP_CODE
		           LEFT  JOIN BSA220T C4 WITH (NOLOCK) ON C4.COMP_CODE  = C2.COMP_CODE
		                                              AND C4.TYPE_LEVEL = C2.DIV_CODE
		                                              AND C4.TREE_CODE  = C2.WH_CODE
		           --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		           INNER JOIN PMR100T Z  WITH (NOLOCK) ON Z.COMP_CODE  = A.COMP_CODE
		                                              AND Z.DIV_CODE   = A.DIV_CODE
		                                              AND Z.PRODT_NUM  = A.PRODT_NUM
		    WHERE  A.COMP_CODE = @CompCode
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		    AND    A.DIV_CODE  = #{DIV_CODE}
		    </if>
		    AND    ISNULL(C2.INSPEC_YN, 'N') = 'Y'
		    <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_FR)">
		    AND  A.PRODT_DATE    &gt;= #{PRODT_DATE_FR}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_TO)">
		    AND  A.PRODT_DATE    &lt;= #{PRODT_DATE_TO}
		    </if>
		    
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		    AND A.ITEM_CODE 			= #{ITEM_CODE}						/* 품목코드  */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		    AND A.ITEM_CODE 			LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
		    AND (CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		              WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                                  ELSE C1.ITEM_NAME
		         END)				LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
		    </if>
		    
		    <if test="@foren.Ognl@isNotEmpty(WORK_SHOP_CODE)">
		    AND  A.WORK_SHOP_CODE    = #{WORK_SHOP_CODE}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		    AND  A.PROJECT_NO     LIKE #{PROJECT_NO} + '%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
		    AND  C2.WH_CODE          = #{WH_CODE}
		    </if>

		    /* 5. 조회 데이터 생성 (불량) */
		    INSERT INTO #uniLITE200903191211
		    (      COMP_CODE          , DIV_CODE          , PRODT_NUM         , WKORD_NUM
		         , INSPEC_NUM         , INSPEC_SEQ
		         , ITEM_CODE          , ITEM_NAME         , SPEC              , STOCK_UNIT        , BASIS_P      , ITEM_ACCOUNT
		         , PRODT_DATE         , INSPEC_DATE       , PRODT_Q           , GOOD_INSPEC_Q     , BAD_INSPEC_Q
		         , INOUT_Q            , ITEM_STATUS       , WORK_SHOP_CODE    , WORK_SHOP_NAME
		         , WH_CODE            , WH_NAME           , PROJECT_NO        , LOT_NO
		         --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		         , MAKE_EXP_DATE
		    )
		    SELECT A.COMP_CODE
		         , A.DIV_CODE
		         , A.PRODT_NUM
		         , A.WKORD_NUM
		         , B.INSPEC_NUM
		         , B.INSPEC_SEQ

		         , A.ITEM_CODE
		         , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                ELSE C1.ITEM_NAME
		           END  AS ITEM_NAME
		         , C1.SPEC
		         , C1.STOCK_UNIT
		         , ISNULL(C2.BASIS_P, 0) AS BASIS_P
		         , C2.ITEM_ACCOUNT
		         , A.PRODT_DATE
		         , B.INSPEC_DATE
		         , A.PRODT_Q
		         , 0                     AS GOOD_INSPEC_Q
		         , B.BAD_INSPEC_Q
		         , 0                     AS INOUT_Q
		         , '2'                   AS ITEM_STATUS
		         , A.WORK_SHOP_CODE
		         , C3.TREE_NAME          AS WORK_SHOP_NAME
		         , C2.WH_CODE
		         , C4.TREE_NAME          AS WH_NAME
		         , A.PROJECT_NO
		         , A.LOT_NO
		         --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		         , Z.EXPIRATION_DATE                                AS MAKE_EXP_DATE
		    FROM              PMR200T A  WITH (NOLOCK)
		           INNER JOIN QMS400T B  WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
		                                              AND B.DIV_CODE    = A.DIV_CODE
		                                              AND B.PRODT_NUM   = A.PRODT_NUM
		                                              AND B.WKORD_NUM   = A.WKORD_NUM

		           /* 제품입고시불량반영여부 (불량수량반영여부) */
		           INNER JOIN BSA100T M1 WITH (NOLOCK) ON M1.COMP_CODE  = A.COMP_CODE
		                                              AND M1.MAIN_CODE  = N'P007'
		                                              AND M1.SUB_CODE   = N'1'
		                                              AND M1.REF_CODE1  = N'Y'

		           INNER JOIN BPR100T C1 WITH (NOLOCK) ON C1.COMP_CODE  = A.COMP_CODE
		                                              AND C1.ITEM_CODE  = A.ITEM_CODE
		           INNER JOIN BPR200T C2 WITH (NOLOCK) ON C2.COMP_CODE  = A.COMP_CODE
		                                              AND C2.DIV_CODE   = A.DIV_CODE
		                                              AND C2.ITEM_CODE  = A.ITEM_CODE
		           LEFT  JOIN BSA230T C3 WITH (NOLOCK) ON C3.COMP_CODE  = A.COMP_CODE
		                                              AND C3.TYPE_LEVEL = A.DIV_CODE
		                                              AND C3.TREE_CODE  = A.WORK_SHOP_CODE
		           LEFT  JOIN BSA220T C4 WITH (NOLOCK) ON C4.COMP_CODE  = C2.COMP_CODE
		                                              AND C4.TYPE_LEVEL = C2.DIV_CODE
		                                              AND C4.TREE_CODE  = C2.WH_CODE
		           --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		           INNER JOIN PMR100T Z  WITH (NOLOCK) ON Z.COMP_CODE  = A.COMP_CODE
		                                              AND Z.DIV_CODE   = A.DIV_CODE
		                                              AND Z.PRODT_NUM  = A.PRODT_NUM
		    WHERE  A.COMP_CODE = @CompCode
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		    AND    A.DIV_CODE  = #{DIV_CODE}
		    </if>
		    AND    ISNULL(C2.INSPEC_YN, 'N') = 'Y'

		    <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_FR)">
		    AND  A.PRODT_DATE    &gt;= #{PRODT_DATE_FR}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(PRODT_DATE_TO)">
		    AND  A.PRODT_DATE    &lt;= #{PRODT_DATE_TO}
		    </if>
		    
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isNotEmpty(ITEM_NAME)">
		    AND A.ITEM_CODE 			= #{ITEM_CODE}						/* 품목코드  */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_CODE) and @foren.Ognl@isEmpty(ITEM_NAME)">
		    AND A.ITEM_CODE 			LIKE #{ITEM_CODE} + '%'				/* 품목코드  */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(ITEM_NAME) and @foren.Ognl@isEmpty(ITEM_CODE)">
		    AND (CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		              WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                                  ELSE C1.ITEM_NAME
		         END)				LIKE '%' + #{ITEM_NAME} + '%'		/* 품목명  */
		    </if>
		    
		    <if test="@foren.Ognl@isNotEmpty(WORK_SHOP_CODE)">
		    AND  A.WORK_SHOP_CODE    = #{WORK_SHOP_CODE}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
		    AND  A.PROJECT_NO     LIKE #{PROJECT_NO} + '%'
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
		    AND  C2.WH_CODE          = #{WH_CODE}
		    </if>

		    /* 6. 입고수량 입력 */
		    UPDATE A
		    SET    A.INOUT_Q = B.INOUT_Q
		    FROM              #uniLITE200903191211 A WITH (NOLOCK)
		           INNER JOIN (
		                      SELECT COMP_CODE, DIV_CODE, BASIS_NUM, BASIS_SEQ, ITEM_STATUS, INSPEC_NUM, INSPEC_SEQ
		                           , SUM(INOUT_Q) AS INOUT_Q
		                      FROM   BTR100T WITH (NOLOCK)
		                      WHERE  COMP_CODE  = @CompCode
		                      <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		                      AND    DIV_CODE   = #{DIV_CODE}
		                      </if>
		                      AND    INOUT_TYPE = '1'   /* 입고 */
		                      AND    CREATE_LOC = '1'   /* 영업 */
		                      GROUP  BY COMP_CODE, DIV_CODE, BASIS_NUM, BASIS_SEQ, ITEM_STATUS, INSPEC_NUM, INSPEC_SEQ
		                      ) B ON B.COMP_CODE   = A.COMP_CODE
		                         AND B.DIV_CODE    = A.DIV_CODE
		                         AND B.INSPEC_NUM  = A.INSPEC_NUM
		                         AND B.INSPEC_SEQ  = A.INSPEC_SEQ
		                         AND B.BASIS_NUM  = A.PRODT_NUM
		                         AND ISNULL(B.BASIS_SEQ, 0)  = 0
		                         AND B.ITEM_STATUS = A.ITEM_STATUS
		    WHERE  A.COMP_CODE = @CompCode
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		    AND    A.DIV_CODE  = #{DIV_CODE}
		    </if>

		    /* 7. 검사참조 조회 */
		    SELECT CAST(0 AS BIT) CHOICE
		         , A.ITEM_CODE
		         , (CASE WHEN @RefItem = '1' THEN B.ITEM_NAME1
		                 WHEN @RefItem = '2' THEN B.ITEM_NAME2
		                 ELSE                     B.ITEM_NAME
		            END)                                           AS ITEM_NAME
		         , A.SPEC
		         , A.STOCK_UNIT
		         , (CASE WHEN ISNULL(A.PRODT_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.PRODT_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.PRODT_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.PRODT_DATE, 7, 2))
		            END)                                           AS PROD_DT
		         , (CASE WHEN ISNULL(A.INSPEC_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INSPEC_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.INSPEC_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.INSPEC_DATE, 7, 2))
		            END)                                           AS INSPEC_DATE
		         , A.PRODT_Q                                         AS PRODT_Q1

		          /* 양품일 경우 불량은 0, 불량일 경우 양품은 0이므로 더해서 계산한다. */
		         , A.GOOD_INSPEC_Q + A.BAD_INSPEC_Q                  AS PRODT_Q
		         , A.GOOD_INSPEC_Q + A.BAD_INSPEC_Q - A.INOUT_Q      AS NOTIN_Q
		         , A.ITEM_STATUS
		         , A.WORK_SHOP_CODE
		         , A.WORK_SHOP_NAME                                  AS WK_SHOP_NM
		         , A.WH_CODE
		         , A.WH_NAME                                         AS WH_NM
		         , A.PRODT_NUM
		         , A.WKORD_NUM
		         , A.DIV_CODE
		         , A.PROJECT_NO
		         , A.LOT_NO
		         , A.BASIS_P
		         , A.ITEM_ACCOUNT
		         , A.SORT_KEY
		         , A.INSPEC_NUM
		         , A.INSPEC_SEQ
		         --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		         , A.MAKE_EXP_DATE
		    FROM   #uniLITE200903191211 A WITH (NOLOCK)
		             INNER JOIN BPR100T B WITH (NOLOCK) ON B.COMP_CODE = A.COMP_CODE
		                                               AND B.ITEM_CODE = A.ITEM_CODE
		    WHERE  A.COMP_CODE = @CompCode
		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		      AND  A.DIV_CODE   = #{DIV_CODE}
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(LOT_NO)">
		      AND  A.LOT_NO    = #{LOT_NO}
		    </if>

		    /* 양품일 경우 불량은 0, 불량일 경우 양품은 0이므로 더해서 계산하며 INOUT_Q 생성이후 조건 실행 */
		    AND    A.GOOD_INSPEC_Q + A.BAD_INSPEC_Q - A.INOUT_Q &gt; 0
		    ORDER BY A.INSPEC_NUM, INSPEC_SEQ

		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="str120ukrvServiceImpl.selectDetailList" parameterType="Map" resultType="rMap">
		/* str120ukrv.Cstr120ukrv[fnStr120QStd] Query01 */
		BEGIN
		     SET NOCOUNT ON
		     SET ARITHABORT ON

		     DECLARE    @CompCode    NVARCHAR(08) /* 법인코드    */
		              , @UserId      NVARCHAR(100) /* 사용자ID    */
		              , @LangType    NVARCHAR(2)  /* 언어구분    */
		              , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
		              , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

		     SET @CompCode = #{S_COMP_CODE}
		     SET @UserId   = #{S_USER_ID}
		     SET @LangType = #{S_LANG_CODE}

		     /* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

		    /* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

		    SELECT TOP 1 @RefItem = REF_ITEM
		    FROM   BSA300T WITH (NOLOCK)
		    WHERE  COMP_CODE = @CompCode
		    AND    USER_ID   = @UserId

		    SET @RefItem = ISNULL(@RefItem, '0')

		    SELECT
		           A.INOUT_METH
		         , A.INOUT_CODE_TYPE
		         , (CASE WHEN ISNULL(A.INOUT_DATE, '') = ''
		                 THEN ''
		                 ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INOUT_DATE, 1, 4))
		                                                         , 'MM'  , SUBSTRING(A.INOUT_DATE, 5, 2))
		                                                         , 'DD'  , SUBSTRING(A.INOUT_DATE, 7, 2))
		            END)                                                        AS INOUT_DATE
		         , A.INOUT_PRSN
		         , A.INOUT_NUM
		         , A.INOUT_SEQ
		         , A.INOUT_TYPE_DETAIL
		         , A.ITEM_CODE
		         , CASE WHEN @RefItem = '1' THEN C1.ITEM_NAME1
		                WHEN @RefItem = '2' THEN C1.ITEM_NAME2
		                ELSE                     C1.ITEM_NAME
		           END                                                          AS ITEM_NAME
		         , C1.SPEC
		         , C1.STOCK_UNIT
		         , A.ITEM_STATUS
		         , A.INOUT_Q
		         , A.WH_CODE
		         , A.WH_CELL_CODE
		         , A.INOUT_CODE
		         , A.TO_DIV_CODE
		         , A.TO_DIV_CODE                                                AS ORG_CD
		         , A.INOUT_Q                                                    AS ORIGINAL_Q
		         , ISNULL(B.PRODT_Q, 0) - ISNULL(B.IN_STOCK_Q, 0)               AS NOTIN_Q
		         , A.MONEY_UNIT
		         , A.INOUT_P
		         , A.INOUT_I
		         , A.INOUT_FOR_P
		         , A.INOUT_FOR_O
		         , C2.BASIS_P
		         , C2.ITEM_ACCOUNT
		         , A.BASIS_NUM
		         , A.PROJECT_NO
		         , B.WKORD_NUM                                                  AS WKORD_NUM
		         , A.LOT_NO
		         , A.REMARK
		         , A.UPDATE_DB_USER
		         , A.UPDATE_DB_TIME
		         , A.DIV_CODE
		         , RTRIM(A.INOUT_NUM) + RTRIM(CONVERT(VARCHAR(4),A.INOUT_SEQ))  AS SORT_KEY
		         , A.INSPEC_NUM
		         , A.INSPEC_SEQ
		         , A.COMP_CODE
		         --20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		         , A.MAKE_EXP_DATE
		    FROM              BTR100T A  WITH (NOLOCK)
		           LEFT  JOIN PMR200T B  WITH (NOLOCK) ON B.COMP_CODE  = A.COMP_CODE
		                                              AND B.DIV_CODE   = A.DIV_CODE
		                                              AND B.PRODT_NUM  = A.BASIS_NUM
		           INNER JOIN BPR100T C1 WITH (NOLOCK) ON C1.COMP_CODE = A.COMP_CODE
		                                              AND C1.ITEM_CODE = A.ITEM_CODE
		           INNER JOIN BPR200T C2 WITH (NOLOCK) ON C2.COMP_CODE = A.COMP_CODE
		                                              AND C2.DIV_CODE  = A.DIV_CODE
		                                              AND C2.ITEM_CODE = A.ITEM_CODE
		    WHERE  A.COMP_CODE      = @CompCode
		      AND  A.INOUT_TYPE     = '1'   /* 수불유형 : 입고 */
		      AND  A.CREATE_LOC     = '1'   /* 생성경로 : 영업 */

		    <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
		      AND  A.DIV_CODE     = #{DIV_CODE}      /* 사업장 */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(WH_CODE)">
		      AND  A.WH_CODE      = #{WH_CODE}      /* 창고 */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(WH_CELL_CODE)">
		      AND  A.WH_CELL_CODE = #{WH_CELL_CODE}      /* CELL 창고 */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(INOUT_DATE)">
		      AND  A.INOUT_DATE   = #{INOUT_DATE}      /* 입고일 */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(INOUT_NUM)">
		      AND  A.INOUT_NUM    = #{INOUT_NUM}      /* 입고번호 */
		    </if>
		    <if test="@foren.Ognl@isNotEmpty(INOUT_PRSN)">
		      AND  A.INOUT_PRSN   = #{INOUT_PRSN}      /* 입고담당 */
		    </if>
		    ORDER  BY A.INOUT_NUM, A.INOUT_SEQ, A.ITEM_CODE, A.INOUT_DATE

		    SET NOCOUNT OFF
		    SET ARITHABORT OFF
		END
	</select>

	<select id="str120ukrvServiceImpl.getWkShopDivCode" parameterType="Map" resultType="rMap">
		/* str120ukrv.Cstr120ukrv[fnStr120QStd] Query05 */
		SELECT TREE_CODE AS S_CODE4
		     , TREE_NAME AS S_NAME4
		     , TYPE_LEVEL AS S_CODE2
		  FROM BSA230T
		 WHERE USE_YN    = 'Y'
		   AND COMP_CODE = #{S_COMP_CODE}
	</select>

	<insert id="str120ukrvServiceImpl.insertLogMaster" parameterType="Map">
		INSERT INTO L_BTR100T
		( KEY_VALUE,           OPR_FLAG
		, INOUT_NUM,           INOUT_TYPE,         INOUT_METH,        INOUT_SEQ,                         INOUT_TYPE_DETAIL
		, INOUT_CODE_TYPE,     INOUT_CODE,         WH_CODE,           TO_DIV_CODE,                       INOUT_DATE
		, ITEM_STATUS,         INOUT_Q,            INOUT_P,           INOUT_I,                           MONEY_UNIT
		, INOUT_FOR_P,         INOUT_FOR_O,        EXCHG_RATE_O,      INOUT_PRSN,                        CREATE_LOC
		, ITEM_CODE,           BASIS_NUM,          SALE_C_YN,         PROJECT_NO,                        REMARK
		, LOT_NO,              UPDATE_DB_USER,     UPDATE_DB_TIME,    SALE_DIV_CODE,                     SALE_CUSTOM_CODE
		, BILL_TYPE,           SALE_TYPE,          PRICE_YN,          DIV_CODE,                          INSPEC_NUM
		, ORDER_NUM
		, INSPEC_SEQ,          WH_CELL_CODE,       COMP_CODE
		--20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		, A.MAKE_EXP_DATE )
		VALUES
		( #{KEY_VALUE},        #{OPR_FLAG}
		, #{INOUT_NUM},        '1',                #{INOUT_METH},     #{INOUT_SEQ},                      #{INOUT_TYPE_DETAIL}
		, #{INOUT_CODE_TYPE},  #{INOUT_CODE},      #{WH_CODE},        #{TO_DIV_CODE},                    #{INOUT_DATE}
		, #{ITEM_STATUS},      #{INOUT_Q},         #{INOUT_FOR_P},    CAST(${INOUT_Q}AS NUMERIC(30,6)) * ${INOUT_FOR_P},       #{MONEY_UNIT}
		, #{INOUT_FOR_P},      #{INOUT_FOR_O},     '1',               #{INOUT_PRSN},                     '1'
		, #{ITEM_CODE},        #{BASIS_NUM},       '',                #{PROJECT_NO},                     #{REMARK}
		, #{LOT_NO},           #{UPDATE_DB_USER},  GETDATE(),         '*',                               '*'
		, '*',                 '*',                '*',               #{DIV_CODE},                       #{INSPEC_NUM}
		, #{WKORD_NUM}
		<if test="INSPEC_SEQ == null">
		, null
		</if>
		<if test="@foren.Ognl@isNotEmpty(INSPEC_SEQ)">
		, #{INSPEC_SEQ}
		</if>
		, #{WH_CELL_CODE},    #{S_COMP_CODE}
		--20191104 MAKE_EXP_DATE 가져오기 위한 로직 추가
		, #{MAKE_EXP_DATE} )
	</insert>

	<update id="spReceiving" parameterType="Map" statementType="CALLABLE">
		{call USP_SALES_Str120ukr (
		    #{KeyValue  , mode=IN   , jdbcType=VARCHAR, javaType=java.lang.String},
		    #{InOutNum  , mode=OUT  , jdbcType=VARCHAR, javaType=java.lang.String},
		    #{ErrorDesc , mode=OUT  , jdbcType=VARCHAR, javaType=java.lang.String}
		)}
	</update>




	<select id="str120ukrvServiceImpl.getItemCode" parameterType="Map" resultType="rMap">
		/* str120ukrvServiceImpl.getItemCode */
		DECLARE @COMP_CODE      NVARCHAR(08)
		      , @DIV_CODE       NVARCHAR(08)
		      , @ITEM_CODE      NVARCHAR(20)
		      , @LOT_NO         NVARCHAR(20)

		    SET @COMP_CODE = #{S_COMP_CODE}
		    SET @DIV_CODE  = #{DIV_CODE}
		    SET @LOT_NO    = #{LOT_NO}

		SELECT @ITEM_CODE = ITEM_CODE
		  FROM PMR200T WITH(NOLOCK)
		 WHERE COMP_CODE = @COMP_CODE
		   AND DIV_CODE  = @DIV_CODE
		   AND LOT_NO    = @LOT_NO

		SELECT ISNULL(@ITEM_CODE, '')   AS ITEM_CODE
	</select>

	<select id="str120ukrvServiceImpl.getItemInfo" parameterType="Map" resultType="rMap">
		/* str120ukrvServiceImpl.getItemInfo */
		DECLARE @COMP_CODE   NVARCHAR(08)
		      , @ITEM_CODE   NVARCHAR(20)
		      --품질(검사)대상 여부
		      , @INSPEC_YN   NVARCHAR(01)

		    SET @COMP_CODE  = #{S_COMP_CODE}
		    SET @ITEM_CODE  = #{ITEM_CODE}

		SELECT @INSPEC_YN = INSPEC_YN
		  FROM BPR200T WITH(NOLOCK)
		 WHERE COMP_CODE = @COMP_CODE
		   AND ITEM_CODE = @ITEM_CODE

		SELECT ISNULL(@INSPEC_YN, 'N')	AS INSPEC_YN
	</select>
</mapper>