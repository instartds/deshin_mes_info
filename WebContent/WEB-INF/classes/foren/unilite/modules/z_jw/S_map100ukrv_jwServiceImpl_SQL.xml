<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="s_map100ukrv_jwServiceImpl">

	<select id="s_map100ukrv_jwServiceImpl.selectRefCode2" parameterType="Map" resultType="rMap">
	   --UBFuncKrv.CBFuncKr[fnAutoNo] Query01
        SELECT ISNULL(REF_CODE2, 0) VAT_RATE
          FROM BSA100T
         WHERE COMP_CODE = 'MASTER'
           AND MAIN_CODE = 'A022'
           AND SUB_CODE  = #{BILL_TYPE}
	</select>

	<select id="s_map100ukrv_jwServiceImpl.selectMms510ukrv" parameterType="Map" resultType="rMap">
         /* mms510ukrv.Cmms510ukrv[fnMms510QStd] Query01 */
         BEGIN
                DECLARE @COMP_CODE          NVARCHAR(08)                -- (필수) 법인코드
                      , @DIV_CODE           NVARCHAR(08)                -- (필수) 사업장
                      , @INOUT_NUM          NVARCHAR(20)                -- (필수) 입고번호
                      , @USER_ID            NVARCHAR(100)                -- (필수) 사용자ID

                SET NOCOUNT ON
                SET ARITHABORT ON

            --  1. 변수 값 할당 -----------------------------------------------------------------------------------------------
                SET @COMP_CODE          = #{S_COMP_CODE}
                SET @DIV_CODE           = #{DIV_CODE}
                SET @INOUT_NUM          = #{INOUT_NUM}
                SET @USER_ID            = #{S_USER_ID}

            --  2. 명칭 조회 유형 설정 ----------------------------------------------------------------------------------------
                DECLARE @RefItem            NVARCHAR(01)

                SELECT TOP 1 @RefItem = REF_ITEM
                FROM   BSA300T WITH (NOLOCK)
                WHERE  USER_ID = @USER_ID

                SET @RefItem = ISNULL(@RefItem, '0')

            --  3. 날짜 포맷 유형 설정 ----------------------------------------------------------------------------------------
                DECLARE @DateFormat             NVARCHAR(01)

                SELECT TOP 1 @DateFormat = SUBSTRING(CODE_NAME, 5, 1)
                FROM   BSA100T WITH (NOLOCK)
                WHERE  COMP_CODE = @COMP_CODE
                AND    MAIN_CODE = 'B044'
                AND    REF_CODE1 = 'Y'

                SET @DateFormat = ISNULL(@DateFormat, '.')

            --  4. 데이터 조회 ------------------------------------------------------------------------------------------------
                SELECT A.INOUT_NUM
                     , A.INOUT_SEQ
                     , A.INOUT_METH
                     , A.INOUT_TYPE_DETAIL
                     , A.ITEM_CODE
                     , CASE WHEN @RefItem = '1' THEN C2.ITEM_NAME1
                            WHEN @RefItem = '2' THEN C2.ITEM_NAME2
                            ELSE C2.ITEM_NAME
                       END                                                      AS ITEM_NAME
                     , C3.ITEM_ACCOUNT
                     , C2.SPEC
                     , ISNULL(A.ORDER_UNIT, C2.STOCK_UNIT)                      AS ORDER_UNIT
                     , A.ORDER_UNIT_Q
                     , A.ITEM_STATUS
                     , A.INOUT_Q                                                AS ORIGINAL_Q
                     , ISNULL(C.GOOD_STOCK_Q, 0)                                AS GOOD_STOCK_Q
                     , ISNULL(C.BAD_STOCK_Q, 0)                                 AS BAD_STOCK_Q
                     , CASE WHEN B.ORDER_NUM IS NULL THEN ISNULL(D.QTY,0) - ISNULL(D.RECEIPT_QTY,0)
                           ELSE ISNULL(B.ORDER_Q, 0) - ISNULL(B.INSTOCK_Q, 0)
                       END AS NOINOUT_Q
                     , A.PRICE_YN
                     , A.MONEY_UNIT
                     , A.INOUT_FOR_P
                     , A.INOUT_FOR_O
                     , A.ORDER_UNIT_FOR_P
                     , A.INOUT_FOR_O                                            AS ORDER_UNIT_FOR_O
                     , A.ACCOUNT_YNC
                     , A.EXCHG_RATE_O
                     , A.INOUT_P
                     , A.INOUT_I
                     , A.ORDER_UNIT_P
                     , A.INOUT_I                                                AS ORDER_UNIT_I

                     , ISNULL(A.TRANS_COST,  0)                                 AS TRANS_COST
                     , ISNULL(A.TARIFF_AMT, 0)                                  AS TARIFF_AMT

                     , C2.STOCK_UNIT
                     , A.TRNS_RATE
                     , A.INOUT_Q
                     , A.ORDER_TYPE
                     , A.LC_NUM
                     , A.BL_NUM
                     , A.ORDER_NUM
                     , A.ORDER_SEQ
                     , CASE WHEN B.ORDER_NUM IS NULL THEN ISNULL(D.QTY,0)
                            ELSE ISNULL(B.ORDER_Q, 0)
                       END AS ORDER_Q
                     , A.INOUT_CODE_TYPE
                     , A.WH_CODE
                     , A.WH_CELL_CODE
                     , CASE WHEN ISNULL(A.INOUT_DATE, '') = '' THEN ''
                            ELSE SUBSTRING(A.INOUT_DATE, 1, 4) + @DateFormat +
                                 SUBSTRING(A.INOUT_DATE, 5, 2) + @DateFormat +
                                 SUBSTRING(A.INOUT_DATE, 7, 2)
                       END                                                      AS INOUT_DATE
                     , A.INOUT_PRSN
                     , A.ACCOUNT_Q
                     , A.CREATE_LOC
                     , A.SALE_C_DATE
                     , A.REMARK
                     , A.PROJECT_NO
                     , A.LOT_NO
                     , C3.LOT_YN
                     , A.INOUT_TYPE
                     , A.INOUT_CODE
                     , A.DIV_CODE
                     , CASE WHEN @RefItem = '1' THEN C1.CUSTOM_NAME1
                            WHEN @RefItem = '2' THEN C1.CUSTOM_NAME2
                            ELSE C1.CUSTOM_NAME
                       END                                                      AS CUSTOM_NAME
                     , CASE WHEN ISNULL(C1.COMPANY_NUM, '') = '' THEN ''
                            ELSE SUBSTRING(C1.COMPANY_NUM,1,3) + '-' +
                                 SUBSTRING(C1.COMPANY_NUM,4,2) + '-' +
                                 SUBSTRING(C1.COMPANY_NUM,6,5)
                       END                                                      AS COMPANY_NUM
                     , CASE WHEN B.ORDER_NUM IS NULL THEN ISNULL(D.RECEIPT_QTY,0)
                            ELSE ISNULL(B.INSTOCK_Q, 0)
                       END AS INSTOCK_Q
                     , A.SALE_DIV_CODE
                     , A.SALE_CUSTOM_CODE
                     , A.BILL_TYPE
                     , A.SALE_TYPE
                     , A.UPDATE_DB_USER
                     , A.UPDATE_DB_TIME
                     , C3.EXCESS_RATE
                     , A.INSPEC_NUM
                     , A.INSPEC_SEQ
                     , A.BASIS_NUM
                     , A.BASIS_SEQ
                     , ISNULL(A.SCM_FLAG_YN, 'N')                               AS SCM_FLAG_YN
                     , A.TRADE_LOC
                     , ISNULL(C2.STOCK_CARE_YN, 'Y')                            AS STOCK_CARE_YN
                     , A.COMP_CODE
                     , A.INSERT_DB_USER
                     , A.INSERT_DB_TIME
                     , 'FLAG'                                                   AS FLAG
                     , ISNULL(C1.MONEY_UNIT, F.SUB_CODE)                        AS MONEY_UNIT
                     , C1.WON_CALC_BAS
                     , C1.TAX_CALC_TYPE
                     , C1.BILL_TYPE
                     , C1.SET_METH
                     , C1.VAT_RATE
                FROM              BTR100T   A  WITH (NOLOCK)
                       LEFT  JOIN MPO200T   B  WITH (NOLOCK) ON B.COMP_CODE     = A.COMP_CODE
                                                            AND B.DIV_CODE      = A.DIV_CODE
                                                            AND B.CUSTOM_CODE   = A.INOUT_CODE
                                                            AND B.ORDER_NUM     = A.ORDER_NUM
                                                            AND B.ORDER_SEQ     = A.ORDER_SEQ
                       LEFT  JOIN TIA110T   D  WITH (NOLOCK) ON D.COMP_CODE     = A.COMP_CODE
                                                            AND D.DIV_CODE      = A.DIV_CODE
                                                            AND D.SO_SER_NO     = A.ORDER_NUM
                                                            AND D.SO_SER        = A.ORDER_SEQ
                       LEFT  JOIN TIA100T   E  WITH (NOLOCK) ON E.COMP_CODE     = A.COMP_CODE
                                                            AND E.DIV_CODE      = A.DIV_CODE
                                                            AND E.EXPORTER      = A.INOUT_CODE
                                                            AND E.SO_SER_NO     = A.ORDER_NUM
                       LEFT  JOIN BIV100T   C  WITH (NOLOCK) ON C.COMP_CODE     = A.COMP_CODE
                                                            AND C.DIV_CODE      = A.DIV_CODE
                                                            AND C.WH_CODE       = A.WH_CODE
                                                            AND C.ITEM_CODE     = A.ITEM_CODE
                       INNER JOIN BCM100T   C1 WITH (NOLOCK) ON C1.COMP_CODE    = A.COMP_CODE
                                                            AND C1.CUSTOM_CODE  = A.INOUT_CODE
                       INNER JOIN BPR100T   C2 WITH (NOLOCK) ON C2.COMP_CODE    = A.COMP_CODE
                                                            AND C2.ITEM_CODE    = A.ITEM_CODE
                       INNER JOIN BPR200T   C3 WITH (NOLOCK) ON C3.COMP_CODE    = A.COMP_CODE
                                                            AND C3.DIV_CODE     = A.DIV_CODE
                                                            AND C3.ITEM_CODE    = A.ITEM_CODE
                       LEFT JOIN BSA100T    F  WITH (NOLOCK) ON F.COMP_CODE     = A.COMP_CODE
                                                            AND F.MAIN_CODE     = N'B004'
                                                            AND F.SUB_CODE     != '$'
                                                            AND F.REF_CODE1     = 'Y'
                WHERE  A.COMP_CODE          = @COMP_CODE
                AND    A.DIV_CODE           = @DIV_CODE
                AND    A.INOUT_NUM          = @INOUT_NUM
                AND    A.INOUT_TYPE         = N'1'
                AND    A.CREATE_LOC         = #{CREATE_LOC}
                AND    A.INOUT_CODE_TYPE    = N'4'
                AND    A.ACCOUNT_YNC        = N'Y'
                ORDER  BY
                       A.INOUT_DATE DESC, A.INOUT_NUM DESC, A.INOUT_SEQ

                SET NOCOUNT OFF
                SET ARITHABORT OFF
            END
	</select>

	<select id="s_map100ukrv_jwServiceImpl.selectOrderNumMasterList" parameterType="Map" resultType="rMap">
	   /*s_map100ukrv_jw.Cs_map100ukrv_jw[fnMap100QPop] Query01*/
        BEGIN
            SET NOCOUNT ON
            SET ARITHABORT ON

            DECLARE @CompCode    NVARCHAR(08) /* 법인코드    */
                  , @UserId      NVARCHAR(100) /* 사용자ID    */
                  , @LangType    NVARCHAR(2)  /* 언어구분    */
                  , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
                  , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

        	SET @CompCode = #{S_COMP_CODE}
            SET @UserId   = #{S_USER_ID}
            SET @LangType = #{S_LANG_CODE}

            /* 명칭 참조 유형 */
            SELECT TOP 1 @RefItem = REF_ITEM
              FROM BSA300T WITH (NOLOCK)
             WHERE USER_ID = @UserId

            SET @RefItem = ISNULL(@RefItem, N'0')

            /* 날짜 포맷 유형 설정 */
            SELECT TOP 1 @DateFormat = CODE_NAME
              FROM BSA100T WITH (NOLOCK)
             WHERE COMP_CODE = @CompCode
               AND MAIN_CODE = N'B044'
               AND REF_CODE1 = N'Y'

            SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

            /* 데이터 조회 */

            SELECT
                   (CASE WHEN @RefItem = '1' THEN B.CUSTOM_NAME1
                         WHEN @RefItem = '2' THEN B.CUSTOM_NAME2
                                             ELSE B.CUSTOM_NAME
                     END)                AS CUSTOM_NAME
             , (CASE WHEN ISNULL(A.CHANGE_BASIS_DATE, '') = ''
                     THEN ''
                     ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.CHANGE_BASIS_DATE, 1, 4))
                                                             , 'MM'  , SUBSTRING(A.CHANGE_BASIS_DATE, 5, 2))
                                                             , 'DD'  , SUBSTRING(A.CHANGE_BASIS_DATE, 7, 2))
                 END)                                           AS CHANGE_BASIS_DATE

             , A.MONEY_UNIT
             , ISNULL(A.AMOUNT_I, 0) AS AMOUNT_I
             , A.BILL_NUM
             , (CASE WHEN ISNULL(A.BILL_DATE, '') = ''
                     THEN ''
                     ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.BILL_DATE, 1, 4))
                                                             , 'MM'  , SUBSTRING(A.BILL_DATE, 5, 2))
                                                             , 'DD'  , SUBSTRING(A.BILL_DATE, 7, 2))
                 END)                                           AS BILL_DATE
             , A.CHANGE_BASIS_NUM
             , A.DIV_CODE
             , A.BILL_DIV_CODE
             , A.CUSTOM_CODE
             , B.COMPANY_NUM
             , A.BILL_TYPE
             , A.RECEIPT_TYPE
             , A.ORDER_TYPE
             , A.VAT_RATE
             , ISNULL(A.VAT_AMOUNT_O, 0) AS VAT_AMOUNT_O
             , A.DEPT_CODE
             , (CASE WHEN ISNULL(A.EX_DATE, '') = ''
                     THEN ''
                     ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.EX_DATE, 1, 4))
                                                             , 'MM'  , SUBSTRING(A.EX_DATE, 5, 2))
                                                             , 'DD'  , SUBSTRING(A.EX_DATE, 7, 2))
                 END)                                           AS EX_DATE
             , A.EX_NUM
             , ISNULL(A.AGREE_YN,'N') AS AGREE_YN
             , A.DRAFT_YN
             , A.DEPT_NAME
             , A.ISSUE_EXPECTED_DATE
             , A.ACCOUNT_TYPE
             , A.PROJECT_NO
             , A.CREDIT_NUM
             , G.CRDT_NAME

           FROM          MAP100T A WITH (NOLOCK)
               LEFT JOIN BCM100T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                                AND B.CUSTOM_CODE = A.CUSTOM_CODE
               LEFT JOIN
                       (SELECT C.COMP_CODE
                             , C.CHANGE_BASIS_NUM
                             , COUNT(D.INOUT_NUM) AS CNT
                          FROM BTR100T D WITH (NOLOCK)
                             , MAP200T C WITH (NOLOCK)
                         Where D.COMP_CODE = C.COMP_CODE
                           AND D.INOUT_NUM  = C.INOUT_NUM
                           AND D.INOUT_SEQ  = C.INOUT_SEQ
                           AND D.COMP_CODE  = @CompCode
                           AND D.CREATE_LOC = N'2'
                      GROUP BY C.COMP_CODE, C.CHANGE_BASIS_NUM) E ON E.COMP_CODE        = A.COMP_CODE
                                                                 AND E.CHANGE_BASIS_NUM = A.CHANGE_BASIS_NUM

                LEFT JOIN ABA500T G WITH (NOLOCK) ON G.COMP_CODE = A.COMP_CODE
                								  AND A.CREDIT_NUM  = CRDT_NUM


         WHERE 1 = 1
        <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
                AND A.DIV_CODE             = #{DIV_CODE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
                AND A.CUSTOM_CODE       LIKE #{CUSTOM_CODE}+ '%'
        </if>
        <if test="@foren.Ognl@isNotEmpty(CHANGE_BASIS_DATE_FR)">
                AND A.CHANGE_BASIS_DATE   &gt;= #{CHANGE_BASIS_DATE_FR}
        </if>
        <if test="@foren.Ognl@isNotEmpty(CHANGE_BASIS_DATE_TO)">
                AND A.CHANGE_BASIS_DATE   &lt;= #{CHANGE_BASIS_DATE_TO}
        </if>
        <if test="@foren.Ognl@isNotEmpty(BILL_DATE_FR)">
                AND A.BILL_DATE           &gt;= #{BILL_DATE_FR}
        </if>
        <if test="@foren.Ognl@isNotEmpty(BILL_DATE_TO)">
                AND A.BILL_DATE           &lt;= #{BILL_DATE_TO}
        </if>
        <if test="@foren.Ognl@isNotEmpty(BILL_NUM)">
                AND A.BILL_NUM             = #{BILL_NUM}
        </if>
        <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
                AND A.PROJECT_NO           = #{PROJECT_NO}
        </if>
                AND A.COMP_CODE            = @CompCode



         ORDER BY CUSTOM_NAME, A.CHANGE_BASIS_DATE, A.CHANGE_BASIS_NUM

            SET NOCOUNT OFF
            SET ARITHABORT OFF
        END
	</select>

    <select id="s_map100ukrv_jwServiceImpl.selectForm" parameterType="Map" resultType="rMap">
		/*s_map100ukrv_jw.Cs_map100ukrv_jw[fnMap100QStd] Query05*/
			DECLARE @CompCode		NVARCHAR(08)	/* 법인코드				*/
		          , @UserId			NVARCHAR(100)	/* 사용자ID				*/
		          , @LangType		NVARCHAR(2)		/* 언어구분				*/
		          , @RefItem		NVARCHAR(01)	/* 명칭 참조 유형		*/
		          , @DateFormat		NVARCHAR(10)	/* 날짜 포맷 유형 설정	*/

		    SET @CompCode = #{S_COMP_CODE}
		    SET @UserId   = #{S_USER_ID}
		    SET @LangType = #{S_LANG_CODE}

			/* 명칭 참조 유형 */
		    SELECT TOP 1 @RefItem = REF_ITEM
		      FROM BSA300T WITH (NOLOCK)
		     WHERE USER_ID = @UserId

		    SET @RefItem = ISNULL(@RefItem, N'0')

			/* 날짜 포맷 유형 설정 */
		    SELECT TOP 1 @DateFormat = CODE_NAME
		      FROM BSA100T WITH (NOLOCK)
		     WHERE COMP_CODE = @CompCode
		       AND MAIN_CODE = N'B044'
		       AND REF_CODE1 = N'Y'

		    SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

			/* 데이터 조회 */

     SELECT
            (CASE WHEN ISNULL(CHANGE_BASIS_DATE, '') = ''
             THEN ''
             ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(CHANGE_BASIS_DATE, 1, 4))
                                                     , 'MM'  , SUBSTRING(CHANGE_BASIS_DATE, 5, 2))
                                                     , 'DD'  , SUBSTRING(CHANGE_BASIS_DATE, 7, 2))
         	END)                AS CHANGE_BASIS_DATE

          , (CASE WHEN ISNULL(BILL_DATE, '') = ''
             THEN ''
             ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(BILL_DATE, 1, 4))
                                                     , 'MM'  , SUBSTRING(BILL_DATE, 5, 2))
                                                     , 'DD'  , SUBSTRING(BILL_DATE, 7, 2))
         	END)                AS BILL_DATE
          , BILL_NUM
          , ISNULL(RECEIPT_TYPE,'') AS RECEIPT_TYPE
          , ISNULL(AMOUNT_I, 0) AS AMOUNT_I
          , ISNULL(VAT_RATE, 0) AS VAT_RATE
          , ISNULL(VAT_AMOUNT_O, 0) AS VAT_AMOUNT_O

          , (CASE WHEN ISNULL(EX_DATE, '') = ''
             THEN ''
             ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(EX_DATE, 1, 4))
                                                     , 'MM'  , SUBSTRING(EX_DATE, 5, 2))
                                                     , 'DD'  , SUBSTRING(EX_DATE, 7, 2))
         	END)                AS EX_DATE
          , ISNULL(EX_NUM, 0) AS EX_NUM
          , ISNULL(AGREE_YN,'N') AS AGREE_YN
          , DRAFT_YN

       FROM MAP100T
      WHERE 1=1
    <if test="@foren.Ognl@isNotEmpty(CHANGE_BASIS_NUM)">
      	AND	CHANGE_BASIS_NUM = #{CHANGE_BASIS_NUM}
    </if>
        AND COMP_CODE        = @Compcode

    </select>


    <select id="s_map100ukrv_jwServiceImpl.selectList" parameterType="Map" resultType="rMap">
        /*s_map100ukrv_jw.Cs_map100ukrv_jw[fnMap100QStd] Query01*/
        BEGIN
            SET NOCOUNT ON
            SET ARITHABORT ON

		--일반 조회
    	<if test="gsRefFlag != &quot;Y&quot;">
            DECLARE @CompCode    NVARCHAR(08) /* 법인코드    */
                  , @UserId      NVARCHAR(100) /* 사용자ID    */
                  , @LangType    NVARCHAR(2)  /* 언어구분    */
                  , @RefItem     NVARCHAR(01) /* 명칭 참조 유형  */
                  , @DateFormat  NVARCHAR(10) /* 날짜 포맷 유형 설정 */

        	SET @CompCode = #{S_COMP_CODE}
            SET @UserId   = #{S_USER_ID}
            SET @LangType = #{S_LANG_CODE}

            /* 명칭 참조 유형 */
            SELECT TOP 1 @RefItem = REF_ITEM
              FROM BSA300T WITH (NOLOCK)
             WHERE USER_ID = @UserId

            SET @RefItem = ISNULL(@RefItem, N'0')

            /* 날짜 포맷 유형 설정 */
            SELECT TOP 1 @DateFormat = CODE_NAME
              FROM BSA100T WITH (NOLOCK)
             WHERE COMP_CODE = @CompCode
               AND MAIN_CODE = N'B044'
               AND REF_CODE1 = N'Y'

            SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

            /* 데이터 조회 */
	        SELECT
	               A.CHANGE_BASIS_NUM
	             , A.CHANGE_BASIS_SEQ
	             /*, uniLITE.fnGetUserDate(A.COMP_CODE, A.INSTOCK_DATE) AS INSTOCK_DATE*/
	             , (CASE WHEN ISNULL(A.INSTOCK_DATE, '') = ''
	                     THEN ''
	                     ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INSTOCK_DATE, 1, 4))
	                                                             , 'MM'  , SUBSTRING(A.INSTOCK_DATE, 5, 2))
	                                                             , 'DD'  , SUBSTRING(A.INSTOCK_DATE, 7, 2))
	                 END)                AS INSTOCK_DATE
	             , D.ITEM_ACCOUNT
	             , A.ITEM_CODE
	             /*, uniLITE.fnItemNameComp(A.COMP_CODE, N'UNILITE5',B.ITEM_CODE) AS ITEM_NAME */
	             ,(CASE WHEN @RefItem = '1' THEN B.ITEM_NAME1
	                     WHEN @RefItem = '2' THEN B.ITEM_NAME2
	                                         ELSE B.ITEM_NAME
	                 END)                        AS ITEM_NAME
	             , B.SPEC
	             , A.ORDER_UNIT
	             , B.TAX_TYPE
	             , A.ORDER_UNIT_Q
	             , ((C.ACCOUNT_Q / ISNULL(C.TRNS_RATE, 1)) - A.ORDER_UNIT_Q) AS REMAIN_Q
	             , A.ORDER_UNIT_P
	             , A.AMOUNT_P
	             , A.AMOUNT_I
	             , A.TAX_I
	             , A.AMOUNT_I + A.TAX_I AS TOTAL_I
	             , A.ORDER_UNIT_FOR_P
	             , A.FOREIGN_P
	             , A.FOR_AMOUNT_O
	             , A.MONEY_UNIT
	             , A.EXCHG_RATE_O
	             , B.STOCK_UNIT
	             , A.TRNS_RATE
	             , A.BUY_Q
	             , A.ORDER_TYPE
	             , A.ORDER_PRSN
	             , A.LC_NUM
	             , A.BL_NUM
	             , A.ORDER_NUM
	             , A.ORDER_SEQ
	             , A.INOUT_NUM
	             , A.INOUT_SEQ
	             , A.DIV_CODE
	             , A.BILL_DIV_CODE
	             , A.CUSTOM_CODE
	             , A.REMARK
	             , A.PROJECT_NO
	             , A.UPDATE_DB_USER
	             , A.UPDATE_DB_TIME
	             , A.COMP_CODE
	             , A.ADVAN_YN
	             , E.ADVAN_AMOUNT AS ADVAN_AMOUNT
	             --, A.INOUT_TYPE
	             --, A.PURCHASE_TYPE
	          FROM           MAP200T A WITH (NOLOCK)
	               LEFT JOIN BTR100T C WITH (NOLOCK) ON C.COMP_CODE = A.COMP_CODE
	                                                AND C.DIV_CODE  = A.DIV_CODE
	                                                AND C.INOUT_NUM = A.INOUT_NUM
	                                                AND C.INOUT_SEQ = A.INOUT_SEQ
	                                                AND C.INOUT_TYPE = '1'
	               LEFT JOIN BPR100T B WITH (NOLOCK) ON B.COMP_CODE = A.COMP_CODE
	                                                AND B.ITEM_CODE = A.ITEM_CODE
	               LEFT JOIN BPR200T D WITH (NOLOCK) ON D.COMP_CODE = A.COMP_CODE
	                                                AND D.DIV_CODE  = A.DIV_CODE
	                                                AND D.ITEM_CODE = A.ITEM_CODE
	               LEFT JOIN MPO200T E WITH (NOLOCK) ON E.COMP_CODE = C.COMP_CODE
	                                                AND E.DIV_CODE  = C.DIV_CODE
	                                                AND E.ORDER_NUM = C.ORDER_NUM
	                                                AND E.ORDER_SEQ = C.ORDER_SEQ
	
	         WHERE
	               A.COMP_CODE        = @CompCode
	        <if test="@foren.Ognl@isNotEmpty(CHANGE_BASIS_NUM)">
	           AND A.CHANGE_BASIS_NUM = #{CHANGE_BASIS_NUM}
	        </if>
	         ORDER BY A.CHANGE_BASIS_NUM, A.CHANGE_BASIS_SEQ
	    </if>

		--참조 직접적용
    	<if test="gsRefFlag == &quot;Y&quot;">
            DECLARE @CompCode       NVARCHAR(08) /* 법인코드                */
                  , @UserId         NVARCHAR(100) /* 사용자ID        */
                  , @LangType       NVARCHAR(2)  /* 언어구분                */
                  , @RefItem        NVARCHAR(01) /* 명칭 참조 유형            */
                  , @DateFormat     NVARCHAR(10) /* 날짜 포맷 유형 설정     */

            SET @CompCode = #{S_COMP_CODE}
            SET @UserId   = #{S_USER_ID}
            SET @LangType = #{S_LANG_CODE}

            /* 명칭 참조 유형 */
            SELECT TOP 1 @RefItem = REF_ITEM
              FROM BSA300T WITH (NOLOCK)
             WHERE USER_ID = @UserId

            SET @RefItem = ISNULL(@RefItem, N'0')

            /* 날짜 포맷 유형 설정 */
            SELECT TOP 1 @DateFormat = CODE_NAME
              FROM BSA100T WITH (NOLOCK)
             WHERE COMP_CODE = @CompCode
               AND MAIN_CODE = N'B044'
               AND REF_CODE1 = N'Y'

            SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

            /* 데이터 조회 */
            SELECT CAST('' AS BIT) AS GUBUN
                 , A.DIV_CODE
                 , #{CHANGE_BASIS_NUM}						AS CHANGE_BASIS_NUM
                 --추가수정 필요
                 , #{CHANGE_BASIS_SEQ}
                   + (ROW_NUMBER() OVER(ORDER BY A.INOUT_DATE DESC, INOUT_NUM DESC, INOUT_SEQ))
                   - 1										AS CHANGE_BASIS_SEQ
                 , 'N'										AS ADVAN_YN
                 , (CASE WHEN ISNULL(A.INOUT_DATE, '') = ''
                         THEN ''
                         ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INOUT_DATE, 1, 4))
                                                                 , 'MM'  , SUBSTRING(A.INOUT_DATE, 5, 2))
                                                                 , 'DD'  , SUBSTRING(A.INOUT_DATE, 7, 2))
                     END)                AS INSTOCK_DATE
                 , B.ITEM_ACCOUNT
                 , A.ITEM_CODE
                 , (CASE WHEN @RefItem = '1' THEN C.ITEM_NAME1
                         WHEN @RefItem = '2' THEN C.ITEM_NAME2
                                             ELSE C.ITEM_NAME
                     END)                 AS ITEM_NAME
                 , C.SPEC
                 , A.ORDER_UNIT
                 , C.TAX_TYPE
                 , CASE WHEN C.TAX_TYPE = '1' THEN (CASE WHEN A.ACCOUNT_Q = 0
								                         THEN A.INOUT_I
								                         ELSE (A.ORDER_UNIT_P *  (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))))
								                     END) * #{VAT_RATE} / 100
						ELSE 0
				   END																	AS TAX_I
                 , (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))) AS ORDER_UNIT_Q
                 , A.ORDER_UNIT_P
                 , A.INOUT_P AS AMOUNT_P
                 , (CASE WHEN A.ACCOUNT_Q = 0
                         THEN A.INOUT_I
                         ELSE (A.ORDER_UNIT_P *  (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))))
                     END) AS AMOUNT_I
                 , A.ORDER_UNIT_FOR_P
                 , A.INOUT_FOR_P AS FOREIGN_P
                 , (CASE WHEN A.ACCOUNT_Q = 0
                         THEN A.INOUT_FOR_O
                         ELSE (A.ORDER_UNIT_FOR_P * (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))))
                     END) AS FOR_AMOUNT_O
                 , A.ORDER_UNIT_Q - ISNULL(A.ACCOUNT_Q, 0) AS REMAIN_Q  /* 매입잔량   */
                 , A.ORDER_UNIT_Q - ISNULL(A.ACCOUNT_Q, 0) AS ORDER_UNIT_Q  /* 매입잔량   */
                 , ISNULL(D.ADVAN_AMOUNT, 0) AS ADVAN_AMOUNT
                 , (CASE WHEN ISNULL(A.ACCOUNT_Q, 0) = 0
                         THEN A.INOUT_I
                         ELSE (ISNULL(A.ORDER_UNIT_Q, 0) - ISNULL(A.ACCOUNT_Q, 0)) * ISNULL(A.ORDER_UNIT_P, 0)
                     END) AS REMAIN_AMOUNT
                 , A.MONEY_UNIT
                 , A.EXCHG_RATE_O
                 , C.STOCK_UNIT
                 , A.TRNS_RATE
                 , (A.INOUT_Q - ISNULL(A.ACCOUNT_Q, 0)) AS BUY_Q
                 , A.ORDER_TYPE
                 , (SELECT ORDER_PRSN
                      FROM MPO100T WITH (NOLOCK)
                     WHERE ORDER_NUM   = A.ORDER_NUM
                       AND COMP_CODE   = A.COMP_CODE
                       AND DIV_CODE    = A.DIV_CODE
                       AND CUSTOM_CODE = A.INOUT_CODE) AS ORDER_PRSN
                 , A.LC_NUM
                 , A.BL_NUM
                 , A.ORDER_NUM
                 , A.ORDER_SEQ
                 , A.INOUT_NUM
                 , A.INOUT_SEQ
                 , (SELECT TAX_TYPE
                      FROM BCM100T
                     WHERE COMP_CODE   = A.COMP_CODE
                       <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
                       AND CUSTOM_CODE = #{CUSTOM_CODE}
                     </if>
                     )	AS TAX_CALC_TYPE
                 , A.REMARK
                 , A.PROJECT_NO
                 , A.INOUT_TYPE
                 --, A.PURCHASE_TYPE


                 , A.INOUT_Q
        		 , A.INOUT_I
        		 --, A.INOUT_I									AS AMOUNT_I
        		 , A.INOUT_TAX_AMT
        		 , A.INOUT_I + A.INOUT_TAX_AMT				AS TOTAL_INOUT_I
        		 , A.INOUT_I + A.INOUT_TAX_AMT				AS TOTAL_I
        		 
        		 , #{BILL_DIV_CODE}							AS BILL_DIV_CODE
        		 , #{CUSTOM_CODE}							AS CUSTOM_CODE

              FROM           BTR100T A WITH (NOLOCK)
                   LEFT JOIN MPO200T D WITH (NOLOCK) ON D.COMP_CODE = A.COMP_CODE
                                                    AND D.DIV_CODE  = A.DIV_CODE
                                                    AND D.ORDER_NUM = A.ORDER_NUM
                                                    AND D.ORDER_SEQ = A.ORDER_SEQ
                                                    AND D.ORDER_UNIT_Q - D.MAP_Q &gt; 0
                   LEFT JOIN BPR200T B WITH (NOLOCK) ON B.COMP_CODE = A.COMP_CODE
                                                    AND B.DIV_CODE  = A.DIV_CODE
                                                    AND B.ITEM_CODE = A.ITEM_CODE
                   LEFT JOIN BPR100T C WITH (NOLOCK) ON C.COMP_CODE = A.COMP_CODE
                                                    AND C.ITEM_CODE = A.ITEM_CODE
                   LEFT JOIN (SELECT A1.COMP_CODE
                                   , A1.DIV_CODE
                                   , A1.CUSTOM_CODE
                                   , A1.ITEM_CODE
                                   , A1.ORDER_NUM
                                   , A1.ORDER_SEQ
                                   , SUM(ISNULL(BUY_Q, 0)) AS BUY_Q
                                   , SUM(ISNULL(AMOUNT_I, 0)) AS AMOUNT_I
                                FROM MAP200T A1 WITH (NOLOCK)
                               WHERE A1.COMP_CODE = @CompCode
                               <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
                                 AND A1.DIV_CODE  = #{DIV_CODE}
                               </if>
                               GROUP BY A1.COMP_CODE, A1.DIV_CODE, A1.CUSTOM_CODE, A1.ITEM_CODE, A1.ORDER_NUM
                                      , A1.ORDER_SEQ) E ON E.COMP_CODE   = D.COMP_CODE
                                                       AND E.DIV_CODE    = D.DIV_CODE
                                                       AND E.CUSTOM_CODE = D.CUSTOM_CODE
                                                       AND E.ITEM_CODE   = D.ITEM_CODE
                                                       AND E.ORDER_NUM   = D.ORDER_NUM
                                                       AND E.ORDER_SEQ   = D.ORDER_SEQ
                   LEFT JOIN TIB140T R1 WITH(NOLOCK) ON R1.COMP_CODE  = A.COMP_CODE     /* LOCAL L/C MASTER */
                                                    AND R1.DIV_CODE   = A.DIV_CODE
                                                    AND R1.LLC_SER_NO = A.LC_NUM
                                                    AND A.CREATE_LOC = '6'              /* 무역   */
                                                    AND A.ORDER_TYPE = '2'              /* LLC  */
                                                    AND A.TRADE_LOC  = '2'              /* LLC  */
             WHERE A.COMP_CODE    = @CompCode
               AND A.INOUT_TYPE   = '1'
          	   AND A.CREATE_LOC  IN ('2','6')
               AND A.ACCOUNT_YNC  = 'Y'
               AND A.PRICE_YN     = 'Y'
               AND (A.INOUT_Q - ISNULL(A.ACCOUNT_Q, 0) != 0)
                 /*  OR (INOUT_Q = 0 AND (INOUT_NUM + CONVERT(NVARCHAR(4), INOUT_SEQ) NOT IN (SELECT INOUT_NUM + CONVERT(NVARCHAR(4), INOUT_SEQ) FROM MAP200T)))) */

               AND ISNULL(R1.EX_DATE,'') = '' /* 무역 LLC 미착 지급결의 안된것 */
			<if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
               AND A.INOUT_CODE    = #{CUSTOM_CODE}
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">
               AND A.INOUT_DATE   &gt;= #{INOUT_DATE_FR}
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">
               AND A.INOUT_DATE   &lt;= #{INOUT_DATE_TO}
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">
               AND A.ORDER_TYPE    = #{ORDER_TYPE}
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(MONEY_UNIT)">
               AND A.MONEY_UNIT    = #{MONEY_UNIT}
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
               AND A.DIV_CODE      = #{DIV_CODE}
        	</if>
			<if test="@foren.Ognl@isNotEmpty(TAX_TYPE)">
               AND C.TAX_TYPE      = #{TAX_TYPE}
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(ITEM_CODE)">
               AND A.ITEM_CODE  LIKE #{ITEM_CODE}+ '%'
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(ITEM_NAME)">
               AND B.ITEM_NAME  LIKE #{ITEM_NAME}+ '%'
        	</if>
        	<if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
               AND A.PROJECT_NO    = #{PROJECT_NO}
        	</if>


        	<if test="rdoSelect == &quot;N&quot;">
               AND A.ITEM_STATUS = N'1'
        	</if>

            ORDER BY A.INOUT_DATE DESC, INOUT_NUM DESC, INOUT_SEQ
    	</if>


        SET NOCOUNT OFF
        SET ARITHABORT OFF
        END
	</select>

	<select id="s_map100ukrv_jwServiceImpl.selectreceiveHistoryList" parameterType="Map" resultType="rMap">
	   /* s_map100ukrv_jw.Cs_map100ukrv_jw[fnMap100QRef] */
        BEGIN
            SET NOCOUNT ON
            SET ARITHABORT ON

            DECLARE @CompCode       NVARCHAR(08) /* 법인코드                */
                  , @UserId         NVARCHAR(100) /* 사용자ID        */
                  , @LangType       NVARCHAR(2)  /* 언어구분                */
                  , @RefItem        NVARCHAR(01) /* 명칭 참조 유형            */
                  , @DateFormat     NVARCHAR(10) /* 날짜 포맷 유형 설정     */

            SET @CompCode = #{S_COMP_CODE}
            SET @UserId   = #{S_USER_ID}
            SET @LangType = #{S_LANG_CODE}

            /* 명칭 참조 유형 */
            SELECT TOP 1 @RefItem = REF_ITEM
              FROM BSA300T WITH (NOLOCK)
             WHERE USER_ID = @UserId

            SET @RefItem = ISNULL(@RefItem, N'0')

            /* 날짜 포맷 유형 설정 */
            SELECT TOP 1 @DateFormat = CODE_NAME
              FROM BSA100T WITH (NOLOCK)
             WHERE COMP_CODE = @CompCode
               AND MAIN_CODE = N'B044'
               AND REF_CODE1 = N'Y'

            SET @DateFormat = ISNULL(@DateFormat, 'YYYY.MM.DD')

            /* 데이터 조회 */
            SELECT CAST('' AS BIT) AS GUBUN
                 , (CASE WHEN ISNULL(A.INOUT_DATE, '') = ''
                         THEN ''
                         ELSE REPLACE(REPLACE(REPLACE(@DateFormat, 'YYYY', SUBSTRING(A.INOUT_DATE, 1, 4))
                                                                 , 'MM'  , SUBSTRING(A.INOUT_DATE, 5, 2))
                                                                 , 'DD'  , SUBSTRING(A.INOUT_DATE, 7, 2))
                     END)                AS INSTOCK_DATE
                 , B.ITEM_ACCOUNT
                 , A.ITEM_CODE
                 , (CASE WHEN @RefItem = '1' THEN C.ITEM_NAME1
                         WHEN @RefItem = '2' THEN C.ITEM_NAME2
                                             ELSE C.ITEM_NAME
                     END)                 AS ITEM_NAME
                 , C.SPEC
                 , A.ORDER_UNIT
                 , C.TAX_TYPE
                 , (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))) AS ORDER_UNIT_Q
                 , A.ORDER_UNIT_P
                 , A.INOUT_P AS AMOUNT_P
                 , (CASE WHEN A.ACCOUNT_Q = 0
                         THEN A.INOUT_I
                         ELSE (A.ORDER_UNIT_P *  (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))))
                     END) AS AMOUNT_I
                 , A.ORDER_UNIT_FOR_P
                 , A.INOUT_FOR_P AS FOREIGN_P
                 , (CASE WHEN A.ACCOUNT_Q = 0
                         THEN A.INOUT_FOR_O
                         ELSE (A.ORDER_UNIT_FOR_P * (A.ORDER_UNIT_Q - (ISNULL(A.ACCOUNT_Q, 0) / ISNULL(A.TRNS_RATE, 1))))
                     END) AS FOR_AMOUNT_O
                 , A.ORDER_UNIT_Q - ISNULL(A.ACCOUNT_Q, 0) AS REMAIN_Q  /* 매입잔량   */
                 , ISNULL(D.ADVAN_AMOUNT, 0) AS ADVAN_AMOUNT
                 , (CASE WHEN ISNULL(A.ACCOUNT_Q, 0) = 0
                         THEN A.INOUT_I
                         ELSE (ISNULL(A.ORDER_UNIT_Q, 0) - ISNULL(A.ACCOUNT_Q, 0)) * ISNULL(A.ORDER_UNIT_P, 0)
                     END) AS REMAIN_AMOUNT
                 , A.MONEY_UNIT
                 , A.EXCHG_RATE_O
                 , C.STOCK_UNIT
                 , A.TRNS_RATE
                 , (A.INOUT_Q - ISNULL(A.ACCOUNT_Q, 0)) AS BUY_Q
                 , A.ORDER_TYPE
                 , (SELECT ORDER_PRSN
                      FROM MPO100T WITH (NOLOCK)
                     WHERE ORDER_NUM   = A.ORDER_NUM
                       AND COMP_CODE   = A.COMP_CODE
                       AND DIV_CODE    = A.DIV_CODE
                       AND CUSTOM_CODE = A.INOUT_CODE) AS ORDER_PRSN
                 , A.LC_NUM
                 , A.BL_NUM
                 , A.ORDER_NUM
                 , A.ORDER_SEQ
                 , A.INOUT_NUM
                 , A.INOUT_SEQ
                 , (SELECT TAX_TYPE
                      FROM BCM100T
                     WHERE COMP_CODE   = A.COMP_CODE
                       <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
                       AND CUSTOM_CODE = #{CUSTOM_CODE}
                     </if>
                     )	AS TAX_CALC_TYPE
                 , A.REMARK
                 , A.PROJECT_NO
                 , A.INOUT_TYPE
                 --, A.PURCHASE_TYPE


                 ,A.INOUT_Q
        		 ,A.INOUT_I
        		 ,A.INOUT_TAX_AMT
        		 ,A.INOUT_I + A.INOUT_TAX_AMT AS TOTAL_INOUT_I

              FROM           BTR100T A WITH (NOLOCK)
                   LEFT JOIN MPO200T D WITH (NOLOCK) ON D.COMP_CODE = A.COMP_CODE
                                                    AND D.DIV_CODE  = A.DIV_CODE
                                                    AND D.ORDER_NUM = A.ORDER_NUM
                                                    AND D.ORDER_SEQ = A.ORDER_SEQ
                                                    AND D.ORDER_UNIT_Q - D.MAP_Q &gt; 0
                   LEFT JOIN BPR200T B WITH (NOLOCK) ON B.COMP_CODE = A.COMP_CODE
                                                    AND B.DIV_CODE  = A.DIV_CODE
                                                    AND B.ITEM_CODE = A.ITEM_CODE
                   LEFT JOIN BPR100T C WITH (NOLOCK) ON C.COMP_CODE = A.COMP_CODE
                                                    AND C.ITEM_CODE = A.ITEM_CODE
                   LEFT JOIN (SELECT A1.COMP_CODE
                                   , A1.DIV_CODE
                                   , A1.CUSTOM_CODE
                                   , A1.ITEM_CODE
                                   , A1.ORDER_NUM
                                   , A1.ORDER_SEQ
                                   , SUM(ISNULL(BUY_Q, 0)) AS BUY_Q
                                   , SUM(ISNULL(AMOUNT_I, 0)) AS AMOUNT_I
                                FROM MAP200T A1 WITH (NOLOCK)
                               WHERE A1.COMP_CODE = @CompCode
                               <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
                                 AND A1.DIV_CODE  = #{DIV_CODE}
                               </if>
                               GROUP BY A1.COMP_CODE, A1.DIV_CODE, A1.CUSTOM_CODE, A1.ITEM_CODE, A1.ORDER_NUM
                                      , A1.ORDER_SEQ) E ON E.COMP_CODE   = D.COMP_CODE
                                                       AND E.DIV_CODE    = D.DIV_CODE
                                                       AND E.CUSTOM_CODE = D.CUSTOM_CODE
                                                       AND E.ITEM_CODE   = D.ITEM_CODE
                                                       AND E.ORDER_NUM   = D.ORDER_NUM
                                                       AND E.ORDER_SEQ   = D.ORDER_SEQ
                   LEFT JOIN TIB140T R1 WITH(NOLOCK) ON R1.COMP_CODE  = A.COMP_CODE     /* LOCAL L/C MASTER */
                                                    AND R1.DIV_CODE   = A.DIV_CODE
                                                    AND R1.LLC_SER_NO = A.LC_NUM
                                                    AND A.CREATE_LOC = '6'              /* 무역   */
                                                    AND A.ORDER_TYPE = '2'              /* LLC  */
                                                    AND A.TRADE_LOC  = '2'              /* LLC  */
             WHERE A.COMP_CODE    = @CompCode
               AND A.INOUT_TYPE   = '1'
          	   AND A.CREATE_LOC  IN ('2','6')
               AND A.ACCOUNT_YNC  = 'Y'
               AND A.PRICE_YN     = 'Y'
               AND (A.INOUT_Q - ISNULL(A.ACCOUNT_Q, 0) != 0)
                 /*  OR (INOUT_Q = 0 AND (INOUT_NUM + CONVERT(NVARCHAR(4), INOUT_SEQ) NOT IN (SELECT INOUT_NUM + CONVERT(NVARCHAR(4), INOUT_SEQ) FROM MAP200T)))) */

               AND ISNULL(R1.EX_DATE,'') = '' /* 무역 LLC 미착 지급결의 안된것 */
		 <if test="@foren.Ognl@isNotEmpty(CUSTOM_CODE)">
               AND A.INOUT_CODE    = #{CUSTOM_CODE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_FR)">
               AND A.INOUT_DATE   &gt;= #{INOUT_DATE_FR}
        </if>
        <if test="@foren.Ognl@isNotEmpty(INOUT_DATE_TO)">
               AND A.INOUT_DATE   &lt;= #{INOUT_DATE_TO}
        </if>
        <if test="@foren.Ognl@isNotEmpty(ORDER_TYPE)">
               AND A.ORDER_TYPE    = #{ORDER_TYPE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(MONEY_UNIT)">
               AND A.MONEY_UNIT    = #{MONEY_UNIT}
        </if>
        <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">
               AND A.DIV_CODE      = #{DIV_CODE}
        </if>
		  <if test="@foren.Ognl@isNotEmpty(TAX_TYPE)">
               AND C.TAX_TYPE      = #{TAX_TYPE}
        </if>
        <if test="@foren.Ognl@isNotEmpty(ITEM_CODE)">
               AND A.ITEM_CODE  LIKE #{ITEM_CODE}+ '%'
        </if>
        <if test="@foren.Ognl@isNotEmpty(ITEM_NAME)">
               AND B.ITEM_NAME  LIKE #{ITEM_NAME}+ '%'
        </if>
        <if test="@foren.Ognl@isNotEmpty(PROJECT_NO)">
               AND A.PROJECT_NO    = #{PROJECT_NO}
        </if>


        <if test="rdoSelect == &quot;N&quot;">
               AND A.ITEM_STATUS = N'1'
        </if>

            ORDER BY A.INOUT_DATE DESC, INOUT_NUM DESC, INOUT_SEQ

            SET NOCOUNT OFF
            SET ARITHABORT OFF
        END
	</select>

    <select id="s_map100ukrv_jwServiceImpl.billDivCode" parameterType="Map" resultType="rMap">
    	SELECT BILL_DIV_CODE FROM BOR120T
    	WHERE COMP_CODE = #{S_COMP_CODE}
    	  AND DIV_CODE  = #{DIV_CODE}
    </select>

    <insert id="s_map100ukrv_jwServiceImpl.insertLogMaster" parameterType="Map">
        INSERT INTO L_MAP200T
             ( KEY_VALUE		    , OPR_FLAG
             , COMP_CODE            , DIV_CODE              , BILL_DIV_CODE         , CUSTOM_CODE           , CHANGE_BASIS_NUM
             , CHANGE_BASIS_SEQ     , INOUT_NUM             , INOUT_SEQ             , ORDER_NUM             , ORDER_SEQ
             , ITEM_CODE            , ITEM_ACCOUNT          , INSTOCK_DATE          , BUY_Q                 , AMOUNT_P
             , AMOUNT_I             , MONEY_UNIT            , FOREIGN_P             , FOR_AMOUNT_O          , EXCHG_RATE_O
             , ORDER_TYPE           , ORDER_PRSN            , LC_NUM                , BL_NUM                , TAX_I
             , ORDER_UNIT           , TRNS_RATE             , ORDER_UNIT_Q          , ORDER_UNIT_P          , ORDER_UNIT_FOR_P
             , PROJECT_NO           , PJT_CODE              , REMARK                , ADVAN_YN
             , INOUT_TYPE			, PURCHASE_TYPE 		, UPDATE_DB_USER	, UPDATE_DB_TIME	, INSERT_DB_USER    	, INSERT_DB_TIME)
        VALUES
             ( #{KEY_VALUE}         , #{OPR_FLAG}
             , #{S_COMP_CODE}         , #{DIV_CODE}           , #{BILL_DIV_CODE}    , #{CUSTOM_CODE}        , #{CHANGE_BASIS_NUM}
             , #{CHANGE_BASIS_SEQ}  , #{INOUT_NUM}          , #{INOUT_SEQ}          , #{ORDER_NUM}          , #{ORDER_SEQ}
             , #{ITEM_CODE}         , #{ITEM_ACCOUNT}       , #{INSTOCK_DATE}       , #{BUY_Q}              , #{AMOUNT_P}
             , #{AMOUNT_I}          , #{MONEY_UNIT}         , #{FOREIGN_P}          , #{FOR_AMOUNT_O}       , #{EXCHG_RATE_O}
             , #{ORDER_TYPE}        , #{ORDER_PRSN}         , #{LC_NUM}             , #{BL_NUM}             , #{TAX_I}
             , #{ORDER_UNIT}        , #{TRNS_RATE}          , #{ORDER_UNIT_Q}       , #{ORDER_UNIT_P}       , #{ORDER_UNIT_FOR_P}
             , #{PROJECT_NO}        , #{PJT_CODE}           , #{REMARK}             , #{ADVAN_YN}
             , #{INOUT_TYPE}		, #{PURCHASE_TYPE}		, #{S_USER_ID}     	, GETDATE()	       , #{S_USER_ID}     	, GETDATE())
    </insert>

    <insert id="s_map100ukrv_jwServiceImpl.insertLogForm" parameterType="Map">
        INSERT INTO L_MAP100T
             ( KEY_VALUE		    , OPR_FLAG
             , COMP_CODE            , DIV_CODE              , BILL_DIV_CODE         , CUSTOM_CODE           , CHANGE_BASIS_NUM
             , CHANGE_BASIS_DATE    , DEPT_CODE             , DEPT_NAME             , BILL_TYPE             , BILL_NUM
             , BILL_DATE            , RECEIPT_TYPE          , ORDER_TYPE            , AMOUNT_I              , VAT_RATE
             , VAT_AMOUNT_O         , MONEY_UNIT            , EX_DATE               , EX_NUM                , AGREE_YN
             , AC_DATE              , AC_NUM                , DRAFT_YN              , PROJECT_NO            , PJT_CODE
             , ISSUE_EXPECTED_DATE  , ACCOUNT_TYPE          , CREDIT_NUM            , EB_NUM                , BILL_SEND_YN
             , UPDATE_DB_USER		, UPDATE_DB_TIME		, INSERT_DB_USER    	, INSERT_DB_TIME)
        VALUES
             ( #{KEY_VALUE}         , #{OPR_FLAG}
             , #{S_COMP_CODE}       , #{DIV_CODE}           , #{BILL_DIV_CODE}      , #{CUSTOM_CODE}        , #{CHANGE_BASIS_NUM}
             , #{CHANGE_BASIS_DATE} , #{DEPT_CODE}          , #{DEPT_NAME}          , #{BILL_TYPE}          , #{BILL_NUM}
             , #{BILL_DATE}         , #{RECEIPT_TYPE}       , #{ORDER_TYPE}         			, #{AMOUNTI}            , #{VAT_RATE}
             , #{VATAMOUNTO}      	, #{MONEY_UNIT}         , #{EX_DATE}            , #{EX_NUM}             , #{AGREE_YN}
             , #{AC_DATE}           , #{AC_NUM}             , #{DRAFT_YN}           , #{PROJECT_NO}         , #{PJT_CODE}
             , #{ISSUE_EXPECTED_DATE},#{ACCOUNT_TYPE}       , #{CREDIT_NUM}         , #{EB_NUM}             , ''
             , #{S_USER_ID}     	, GETDATE()	       		, #{S_USER_ID}     		, GETDATE() )
    </insert>

    <update id="s_map100ukrv_jwServiceImpl.spBuy" parameterType="Map" statementType="CALLABLE">
    		{call USP_MATRL_Map100ukr (
    			#{KeyValue,          mode=IN,    jdbcType=VARCHAR, javaType=java.lang.String},
    			#{CHANGE_BASIS_NUM,  mode=OUT,   jdbcType=VARCHAR, javaType=java.lang.String},
    			#{BILL_NUM,          mode=OUT,   jdbcType=VARCHAR, javaType=java.lang.String},
    			#{ErrorDesc,         mode=OUT,   jdbcType=VARCHAR, javaType=java.lang.String}
    		)}
    </update>
</mapper>