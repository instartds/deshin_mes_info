<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tbs020ukrvServiceImpl">
					
<select id="tbs020ukrvServiceImpl.selectForm" parameterType="Map" resultType="rMap">

SELECT  MAX(RDO1) AS RDO1,
		MAX(RDO2) AS RDO2,
		MAX(RDO3) AS RDO3,
		MAX(RDO4) AS RDO4,
		MAX(RDO5) AS RDO5,		
		MAX(RDO6) AS RDO6,		
		MAX(RDO7) AS RDO7,
		MAX(RDO8) AS RDO8,
		MAX(RDO9) AS RDO9,
		MAX(RD10) AS RD10,		
		MAX(RD11) AS RD11,		
		MAX(RD12) AS RD12,		
		MAX(RD13) AS RD13,
		MAX(RD14) AS RD14,		
		MAX(RD15) AS RD15,
		MAX(RD16) AS RD16
	FROM (
			SELECT
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '01' THEN REF_CODE1 ELSE 'N' END RDO1,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '02' THEN REF_CODE1 ELSE 'N' END RDO2,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '03' THEN REF_CODE1 ELSE 'N' END RDO3,
			        CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '05' THEN REF_CODE1 ELSE 'N' END RDO4,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '06' THEN REF_CODE1 ELSE 'N' END RDO5,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '07' THEN REF_CODE1 ELSE 'N' END RDO6,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '08' THEN REF_CODE1 ELSE 'N' END RDO7,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '09' THEN REF_CODE1 ELSE 'N' END RDO8,					
			        CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '10' THEN REF_CODE1 ELSE 'N' END RDO9,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '11' THEN REF_CODE1 ELSE 'N' END RD10,		
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '12' THEN REF_CODE1 ELSE 'N' END RD11,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '13' THEN REF_CODE1 ELSE 'N' END RD12,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '14' THEN REF_CODE1 ELSE 'N' END RD13,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '17' THEN REF_CODE1 ELSE 'N' END RD14,		
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T100' AND SUB_CODE = '18' THEN REF_CODE1 ELSE 'N' END RD15,
					CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'T106' AND REF_CODE1 = 'Y' THEN SUB_CODE  ELSE ''  END RD16
			 FROM BSA100T
		    WHERE COMP_CODE = #{S_COMP_CODE}
			  AND MAIN_CODE IN ( 'T100','T106')	
			  AND SUB_CODE != '$'	
				
		) A		

</select>


<select id="tbs020ukrvServiceImpl.selectForm2" parameterType="Map" resultType="rMap">
SELECT A.JOB_CODE               
		     , B.CODE_NAME  AS JOB_NAME  
		     , A.FORMAT_QTY            
		     , A.FORMAT_PRICE          
		     , A.FORMAT_IN             
		     , A.FORMAT_OUT            
		     , A.FORMAT_RATE         
		  FROM BSA110T A                
		     , BSA100T B                
		 WHERE A.COMP_CODE = B.COMP_CODE
		   AND A.JOB_CODE  = B.SUB_CODE 
		   AND A.JOB_CODE  = '19'       
		   AND B.MAIN_CODE = 'B007'     
		   AND A.COMP_CODE = #{S_COMP_CODE}

</select>

<update id="tbs020ukrvServiceImpl.updateForm" parameterType="Map">	

UPDATE BSA100T
	SET REF_CODE1 = #{RDO1}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '1'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RDO2}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '2'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RDO3}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '3'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RDO4}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '5'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RDO5}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '6'						

UPDATE BSA100T
	SET	REF_CODE1 = #{RDO6}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '7'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RDO7}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '8'

UPDATE BSA100T
	SET	REF_CODE1 = #{RDO8}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '9'						

UPDATE BSA100T
	SET	REF_CODE1 = #{RDO9}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '10'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RD10}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '11'
		
UPDATE BSA100T
	SET	REF_CODE1 = #{RD11}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '12'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RD12}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '13'
		
UPDATE BSA100T
	SET	REF_CODE1 = #{RD13}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '14'
	
UPDATE BSA100T
	SET	REF_CODE1 = #{RD14}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '17'
		
UPDATE BSA100T
	SET	REF_CODE1 = #{RD15}
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T100'
	AND SUB_CODE = '18'

UPDATE BSA100T
	SET	REF_CODE1 = CASE WHEN SUB_CODE = #{RD16} THEN 'Y' ELSE '' END
WHERE	COMP_CODE =#{S_COMP_CODE}
	AND	MAIN_CODE = 'T106'
	AND SUB_CODE != '$'
		
</update>

<update id="tbs020ukrvServiceImpl.updateForm2" parameterType="Map">	
UPDATE BSA110T 
       SET FORMAT_QTY    = #{FORMAT_QTY}
         , FORMAT_PRICE  = #{FORMAT_PRICE}
         , FORMAT_IN     = #{FORMAT_IN}
         , FORMAT_OUT    = #{FORMAT_OUT}
         , FORMAT_RATE   = #{FORMAT_RATE}
         , UPDATE_DB_USER = #{S_USER_ID}
         , UPDATE_DB_TIME =  GETDATE()
     WHERE COMP_CODE      = #{S_COMP_CODE}
       AND JOB_CODE		 = '19'
		
</update>

</mapper>