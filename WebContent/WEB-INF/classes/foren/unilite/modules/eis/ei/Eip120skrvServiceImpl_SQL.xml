<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eip120skrvServiceImpl">
	<select id="eip120skrvServiceImpl.selectList" parameterType="Map" resultType="rMap">

IF OBJECT_ID('tempdb..#TEMP1') IS NOT NULL
    DROP TABLE #TEMP1

CREATE TABLE #TEMP1
(   
	 COMP_CODE NVARCHAR(10) NULL
	, DIV_CODE NVARCHAR(10) NULL
	, GUBUN NVARCHAR(01) NULL
	, GUBUN_NAME NVARCHAR(50) NULL
    , COL_01 NUMERIC(30,6) NULL
    , COL_02 NUMERIC(30,6) NULL
    , COL_03 NUMERIC(30,6) NULL
    , COL_04 NUMERIC(30,6) NULL
    , COL_05 NUMERIC(30,6) NULL
    , COL_06 NUMERIC(30,6) NULL
    , COL_07 NUMERIC(30,6) NULL
    , COL_08 NUMERIC(30,6) NULL
    , COL_09 NUMERIC(30,6) NULL
    , COL_10 NUMERIC(30,6) NULL
    , COL_11 NUMERIC(30,6) NULL
    , COL_12 NUMERIC(30,6) NULL
	, COL_SUM NUMERIC(30,6) NULL

)

INSERT INTO #TEMP1

SELECT 
A.COMP_CODE
,A.DIV_CODE
 ,'1' AS GUBUN
, '검사수량' AS GUBUN_NAME
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '01' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q01
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '02' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q02
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '03' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q03
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '04' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q04
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '05' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q05
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '06' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q06
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '07' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q07
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '08' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q08
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '09' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q09
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '10' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q10
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '11' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q11
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '12' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q12
						
,SUM(C.INSPEC_Q) AS SUM_Q_ALL

FROM  PMR200T A WITH (NOLOCK)
INNER JOIN QMS300T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                    AND B.DIV_CODE    = A.DIV_CODE
                                    AND B.PRODT_NUM   = A.PRODT_NUM
INNER JOIN QMS400T C WITH (NOLOCK) ON C.COMP_CODE   = B.COMP_CODE
                                    AND C.DIV_CODE    = B.DIV_CODE
                                    AND C.RECEIPT_NUM = B.RECEIPT_NUM
                                    AND C.RECEIPT_SEQ = B.RECEIPT_SEQ

LEFT JOIN BSA230T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
								AND R1.TYPE_LEVEL = A.DIV_CODE
								AND R1.TREE_CODE = A.WORK_SHOP_CODE

WHERE A.COMP_CODE = 'MASTER'
  AND A.DIV_CODE = '01'
  
<if test="SECTION_CD == &quot;ALL&quot;">
  AND R1.SECTION_CD IN ('A','B','C')
</if>

<if test="SECTION_CD != &quot;ALL&quot;">
	AND R1.SECTION_CD = #{SECTION_CD}
</if>
  AND LEFT(C.INSPEC_DATE,4) = LEFT(CONVERT(CHAR(8), GETDATE(), 112),4)

  GROUP BY A.COMP_CODE, A.DIV_CODE
  
  
UNION ALL


SELECT 

A.COMP_CODE
,A.DIV_CODE
, '2' AS GUBUN
, '불량수량' AS GUBUN_NAME
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '01' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q01
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '02' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q02
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '03' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q03
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '04' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q04
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '05' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q05
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '06' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q06
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '07' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q07
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '08' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q08
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '09' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q09
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '10' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q10
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '11' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q11
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '12' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q12
						
,SUM(C.BAD_INSPEC_Q) AS SUM_Q_ALL

FROM  PMR200T A WITH (NOLOCK)
INNER JOIN QMS300T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                    AND B.DIV_CODE    = A.DIV_CODE
                                    AND B.PRODT_NUM   = A.PRODT_NUM
INNER JOIN QMS400T C WITH (NOLOCK) ON C.COMP_CODE   = B.COMP_CODE
                                    AND C.DIV_CODE    = B.DIV_CODE
                                    AND C.RECEIPT_NUM = B.RECEIPT_NUM
                                    AND C.RECEIPT_SEQ = B.RECEIPT_SEQ

LEFT JOIN BSA230T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
								AND R1.TYPE_LEVEL = A.DIV_CODE
								AND R1.TREE_CODE = A.WORK_SHOP_CODE

WHERE A.COMP_CODE = 'MASTER'
  AND A.DIV_CODE = '01'
  <if test="SECTION_CD == &quot;ALL&quot;">
  AND R1.SECTION_CD IN ('A','B','C')
</if>

<if test="SECTION_CD != &quot;ALL&quot;">
	AND R1.SECTION_CD = #{SECTION_CD}
</if>
  AND LEFT(C.INSPEC_DATE,4) = LEFT(CONVERT(CHAR(8), GETDATE(), 112),4)

  GROUP BY A.COMP_CODE, A.DIV_CODE









   
SELECT 
	 GUBUN 
	, GUBUN_NAME 
	, COL_01 
	, COL_02 
	, COL_03 
	, COL_04 
	, COL_05 
	, COL_06 
	, COL_07 
	, COL_08 
	, COL_09 
	, COL_10 
	, COL_11 
	, COL_12 
	, COL_SUM


 FROM #TEMP1



 UNION ALL


SELECT 
'3' AS GUBUN
,'불량률' AS GUBUN_NAME
,(CASE WHEN T1.COL_01 = 0 THEN 0
			  ELSE T2.COL_01 / T1.COL_01 * 100
		END)
,(CASE WHEN T1.COL_02 = 0 THEN 0
			  ELSE T2.COL_02 / T1.COL_02 * 100
		END)
,(CASE WHEN T1.COL_03 = 0 THEN 0
			  ELSE T2.COL_03 / T1.COL_03 * 100
		END)
,(CASE WHEN T1.COL_04 = 0 THEN 0
			  ELSE T2.COL_04 / T1.COL_04 * 100
		END)
,(CASE WHEN T1.COL_05 = 0 THEN 0
			  ELSE T2.COL_05 / T1.COL_05 * 100
		END)
,(CASE WHEN T1.COL_06 = 0 THEN 0
			  ELSE T2.COL_06 / T1.COL_06 * 100
		END)
,(CASE WHEN T1.COL_07 = 0 THEN 0
			  ELSE T2.COL_07 / T1.COL_07 * 100
		END)
,(CASE WHEN T1.COL_08 = 0 THEN 0
			  ELSE T2.COL_08 / T1.COL_08 * 100
		END)
,(CASE WHEN T1.COL_09 = 0 THEN 0
			  ELSE T2.COL_09 / T1.COL_09 * 100
		END)
,(CASE WHEN T1.COL_10 = 0 THEN 0
			  ELSE T2.COL_10 / T1.COL_10 * 100
		END)
,(CASE WHEN T1.COL_11 = 0 THEN 0
			  ELSE T2.COL_11 / T1.COL_11 * 100
		END)
,(CASE WHEN T1.COL_12 = 0 THEN 0
			  ELSE T2.COL_12 / T1.COL_12 * 100
		END)
,(CASE WHEN T1.COL_SUM = 0 THEN 0
			  ELSE T2.COL_SUM / T1.COL_SUM * 100
		END)
FROM
  
(SELECT 
	*
 FROM #TEMP1 
 WHERE GUBUN = '1'
 ) T1
 LEFT JOIN (SELECT 
				*
			 FROM #TEMP1 
			 WHERE GUBUN = '2'
			 ) T2 ON T2.COMP_CODE = T1.COMP_CODE
				   AND T2.DIV_CODE = T1.DIV_CODE




UNION ALL


SELECT 
'4' AS GUBUN
,'PPM' AS GUBUN_NAME
,(CASE WHEN T1.COL_01 = 0 THEN 0
			  ELSE T2.COL_01 / T1.COL_01 * 1000000
		END)
,(CASE WHEN T1.COL_02 = 0 THEN 0
			  ELSE T2.COL_02 / T1.COL_02 * 1000000
		END)
,(CASE WHEN T1.COL_03 = 0 THEN 0
			  ELSE T2.COL_03 / T1.COL_03 * 1000000
		END)
,(CASE WHEN T1.COL_04 = 0 THEN 0
			  ELSE T2.COL_04 / T1.COL_04 * 1000000
		END)
,(CASE WHEN T1.COL_05 = 0 THEN 0
			  ELSE T2.COL_05 / T1.COL_05 * 1000000
		END)
,(CASE WHEN T1.COL_06 = 0 THEN 0
			  ELSE T2.COL_06 / T1.COL_06 * 1000000
		END)
,(CASE WHEN T1.COL_07 = 0 THEN 0
			  ELSE T2.COL_07 / T1.COL_07 * 1000000
		END)
,(CASE WHEN T1.COL_08 = 0 THEN 0
			  ELSE T2.COL_08 / T1.COL_08 * 1000000
		END)
,(CASE WHEN T1.COL_09 = 0 THEN 0
			  ELSE T2.COL_09 / T1.COL_09 * 1000000
		END)
,(CASE WHEN T1.COL_10 = 0 THEN 0
			  ELSE T2.COL_10 / T1.COL_10 * 1000000
		END)
,(CASE WHEN T1.COL_11 = 0 THEN 0
			  ELSE T2.COL_11 / T1.COL_11 * 1000000
		END)
,(CASE WHEN T1.COL_12 = 0 THEN 0
			  ELSE T2.COL_12 / T1.COL_12 * 1000000
		END)
,(CASE WHEN T1.COL_SUM = 0 THEN 0
			  ELSE T2.COL_SUM / T1.COL_SUM * 1000000
		END)
FROM
  
(SELECT 
	*
 FROM #TEMP1 
 WHERE GUBUN = '1'
 ) T1
 LEFT JOIN (SELECT 
				*
			 FROM #TEMP1 
			 WHERE GUBUN = '2'
			 ) T2 ON T2.COMP_CODE = T1.COMP_CODE
				   AND T2.DIV_CODE = T1.DIV_CODE



	</select>
	
	
	<select id="eip120skrvServiceImpl.selectChart" parameterType="Map" resultType="rMap">
		IF OBJECT_ID('tempdb..#TEMP1') IS NOT NULL
    DROP TABLE #TEMP1

CREATE TABLE #TEMP1
(   
	 COMP_CODE NVARCHAR(10) NULL
	, DIV_CODE NVARCHAR(10) NULL
	, GUBUN NVARCHAR(01) NULL
	, GUBUN_NAME NVARCHAR(50) NULL
    , COL_01 NUMERIC(30,6) NULL
    , COL_02 NUMERIC(30,6) NULL
    , COL_03 NUMERIC(30,6) NULL
    , COL_04 NUMERIC(30,6) NULL
    , COL_05 NUMERIC(30,6) NULL
    , COL_06 NUMERIC(30,6) NULL
    , COL_07 NUMERIC(30,6) NULL
    , COL_08 NUMERIC(30,6) NULL
    , COL_09 NUMERIC(30,6) NULL
    , COL_10 NUMERIC(30,6) NULL
    , COL_11 NUMERIC(30,6) NULL
    , COL_12 NUMERIC(30,6) NULL
	, COL_SUM NUMERIC(30,6) NULL

)

INSERT INTO #TEMP1

SELECT 
A.COMP_CODE
,A.DIV_CODE
 ,'1' AS GUBUN
, '검사수량' AS GUBUN_NAME
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '01' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q01
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '02' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q02
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '03' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q03
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '04' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q04
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '05' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q05
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '06' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q06
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '07' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q07
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '08' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q08
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '09' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q09
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '10' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q10
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '11' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q11
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '12' THEN C.INSPEC_Q
	ELSE 0 END) SUM_Q12
						
,SUM(C.INSPEC_Q) AS SUM_Q_ALL

FROM  PMR200T A WITH (NOLOCK)
INNER JOIN QMS300T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                    AND B.DIV_CODE    = A.DIV_CODE
                                    AND B.PRODT_NUM   = A.PRODT_NUM
INNER JOIN QMS400T C WITH (NOLOCK) ON C.COMP_CODE   = B.COMP_CODE
                                    AND C.DIV_CODE    = B.DIV_CODE
                                    AND C.RECEIPT_NUM = B.RECEIPT_NUM
                                    AND C.RECEIPT_SEQ = B.RECEIPT_SEQ

LEFT JOIN BSA230T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
								AND R1.TYPE_LEVEL = A.DIV_CODE
								AND R1.TREE_CODE = A.WORK_SHOP_CODE

WHERE A.COMP_CODE = 'MASTER'
  AND A.DIV_CODE = '01'
  <if test="SECTION_CD == &quot;ALL&quot;">
  AND R1.SECTION_CD IN ('A','B','C')
</if>

<if test="SECTION_CD != &quot;ALL&quot;">
	AND R1.SECTION_CD = #{SECTION_CD}
</if>
  AND LEFT(C.INSPEC_DATE,4) = LEFT(CONVERT(CHAR(8), GETDATE(), 112),4)

  GROUP BY A.COMP_CODE, A.DIV_CODE
  
  
UNION ALL


SELECT 

A.COMP_CODE
,A.DIV_CODE
, '2' AS GUBUN
, '불량수량' AS GUBUN_NAME
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '01' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q01
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '02' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q02
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '03' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q03
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '04' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q04
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '05' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q05
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '06' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q06
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '07' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q07
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '08' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q08
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '09' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q09
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '10' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q10
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '11' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q11
,SUM(CASE WHEN SUBSTRING(C.INSPEC_DATE,5,2) = '12' THEN C.BAD_INSPEC_Q
	ELSE 0 END) SUM_Q12
						
,SUM(C.BAD_INSPEC_Q) AS SUM_Q_ALL

FROM  PMR200T A WITH (NOLOCK)
INNER JOIN QMS300T B WITH (NOLOCK) ON B.COMP_CODE   = A.COMP_CODE
                                    AND B.DIV_CODE    = A.DIV_CODE
                                    AND B.PRODT_NUM   = A.PRODT_NUM
INNER JOIN QMS400T C WITH (NOLOCK) ON C.COMP_CODE   = B.COMP_CODE
                                    AND C.DIV_CODE    = B.DIV_CODE
                                    AND C.RECEIPT_NUM = B.RECEIPT_NUM
                                    AND C.RECEIPT_SEQ = B.RECEIPT_SEQ

LEFT JOIN BSA230T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
								AND R1.TYPE_LEVEL = A.DIV_CODE
								AND R1.TREE_CODE = A.WORK_SHOP_CODE

WHERE A.COMP_CODE = 'MASTER'
  AND A.DIV_CODE = '01'
  <if test="SECTION_CD == &quot;ALL&quot;">
  AND R1.SECTION_CD IN ('A','B','C')
</if>

<if test="SECTION_CD != &quot;ALL&quot;">
	AND R1.SECTION_CD = #{SECTION_CD}
</if>
  AND LEFT(C.INSPEC_DATE,4) = LEFT(CONVERT(CHAR(8), GETDATE(), 112),4)

  GROUP BY A.COMP_CODE, A.DIV_CODE





IF OBJECT_ID('tempdb..#TEMP2') IS NOT NULL
    DROP TABLE #TEMP2

CREATE TABLE #TEMP2
(   
	 COMP_CODE NVARCHAR(10) NULL
	, DIV_CODE NVARCHAR(10) NULL
    , COL_01 NUMERIC(30,6) NULL
    , COL_02 NUMERIC(30,6) NULL
    , COL_03 NUMERIC(30,6) NULL
    , COL_04 NUMERIC(30,6) NULL
    , COL_05 NUMERIC(30,6) NULL
    , COL_06 NUMERIC(30,6) NULL
    , COL_07 NUMERIC(30,6) NULL
    , COL_08 NUMERIC(30,6) NULL
    , COL_09 NUMERIC(30,6) NULL
    , COL_10 NUMERIC(30,6) NULL
    , COL_11 NUMERIC(30,6) NULL
    , COL_12 NUMERIC(30,6) NULL

)

INSERT INTO #TEMP2

SELECT 

'MASTER' AS COMP_CODE
,'01' AS DIV_CODE
,(CASE WHEN T1.COL_01 = 0 THEN 0
			  ELSE T2.COL_01 / T1.COL_01 * 1000000
		END) 
,(CASE WHEN T1.COL_02 = 0 THEN 0
			  ELSE T2.COL_02 / T1.COL_02 * 1000000
		END)
,(CASE WHEN T1.COL_03 = 0 THEN 0
			  ELSE T2.COL_03 / T1.COL_03 * 1000000
		END)
,(CASE WHEN T1.COL_04 = 0 THEN 0
			  ELSE T2.COL_04 / T1.COL_04 * 1000000
		END)
,(CASE WHEN T1.COL_05 = 0 THEN 0
			  ELSE T2.COL_05 / T1.COL_05 * 1000000
		END)
,(CASE WHEN T1.COL_06 = 0 THEN 0
			  ELSE T2.COL_06 / T1.COL_06 * 1000000
		END)
,(CASE WHEN T1.COL_07 = 0 THEN 0
			  ELSE T2.COL_07 / T1.COL_07 * 1000000
		END)
,(CASE WHEN T1.COL_08 = 0 THEN 0
			  ELSE T2.COL_08 / T1.COL_08 * 1000000
		END)
,(CASE WHEN T1.COL_09 = 0 THEN 0
			  ELSE T2.COL_09 / T1.COL_09 * 1000000
		END)
,(CASE WHEN T1.COL_10 = 0 THEN 0
			  ELSE T2.COL_10 / T1.COL_10 * 1000000
		END)
,(CASE WHEN T1.COL_11 = 0 THEN 0
			  ELSE T2.COL_11 / T1.COL_11 * 1000000
		END)
,(CASE WHEN T1.COL_12 = 0 THEN 0
			  ELSE T2.COL_12 / T1.COL_12 * 1000000
		END)
FROM
  
(SELECT 
	*
 FROM #TEMP1 
 WHERE GUBUN = '1'
 ) T1
 LEFT JOIN (SELECT 
				*
			 FROM #TEMP1 
			 WHERE GUBUN = '2'
			 ) T2 ON T2.COMP_CODE = T1.COMP_CODE
				   AND T2.DIV_CODE = T1.DIV_CODE


IF OBJECT_ID('tempdb..#TEMP3') IS NOT NULL
    DROP TABLE #TEMP3

CREATE TABLE #TEMP3
(   
	
	 COMP_CODE NVARCHAR(10) NULL
	, DIV_CODE NVARCHAR(10) NULL
     ,COL_MONTH NVARCHAR(10) NULL
    , COL_Q NUMERIC(30,6) NULL

)


DECLARE @I INT, @MAXNO INT
	
SET @I = 1
SET @MAXNO = 12

WHILE @I &lt;= @MAXNO
	BEGIN
		INSERT #TEMP3
			SELECT 
				'MASTER' AS COMP_CODE
				,'01' AS DIV_CODE
				,CONVERT(NVARCHAR(10),@I) AS COL_MONTH
				,0.000000 AS COL_Q
			SET @I = @I + 1
	END

SELECT 

T1.COMP_CODE
,T1.DIV_CODE
,T1.COL_MONTH
,CASE WHEN T1.COL_MONTH = 1 THEN T2.COL_01
	  WHEN T1.COL_MONTH = 2 THEN T2.COL_02
	  WHEN T1.COL_MONTH = 3 THEN T2.COL_03
	  WHEN T1.COL_MONTH = 4 THEN T2.COL_04
	  WHEN T1.COL_MONTH = 5 THEN T2.COL_05
	  WHEN T1.COL_MONTH = 6 THEN T2.COL_06
	  WHEN T1.COL_MONTH = 7 THEN T2.COL_07
	  WHEN T1.COL_MONTH = 8 THEN T2.COL_08
	  WHEN T1.COL_MONTH = 9 THEN T2.COL_09
	  WHEN T1.COL_MONTH = 10 THEN T2.COL_10
	  WHEN T1.COL_MONTH = 11 THEN T2.COL_11
	  WHEN T1.COL_MONTH = 12 THEN T2.COL_12
END AS COL_Q
      
FROM #TEMP3 T1
LEFT JOIN #TEMP2 T2 ON T2.COMP_CODE = T1.COMP_CODE
				   AND T2.DIV_CODE = T1.DIV_CODE

		
		

	</select>
</mapper>