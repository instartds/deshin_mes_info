<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mba020ukrvServiceImpl">
					
	<select id="mba020ukrvServiceImpl.selectForm" parameterType="Map" resultType="rMap">


SELECT MAX(RDO1) AS RDO1,
		MAX(RDO2) AS RDO2,
		MAX(RDO3) AS RDO3,
		MAX(RDO4) AS RDO4,
		MAX(RDO5) AS RDO5,
		
		MAX(RDO6) AS RDO6,
		
		MAX(RDO7) AS RDO7,
		
		MAX(NO1) AS NO1,
		MAX(NO2) AS NO2,
		MAX(NO3) AS NO3,
		
		MAX(RDO8) AS RDO8,
		MAX(RDO9) AS RDO9,
		MAX(RDO10) AS RDO10,
		
		MAX(RDO11) AS RDO11,
		
		MAX(RDO12) AS RDO12,
		
		MAX(RDO13) AS RDO13,
		
		MAX(RDO6_4_CODE) AS RDO6_4_CODE,
		MAX(RDO6_4_NAME) AS RDO6_4_NAME
	FROM (
		SELECT
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M101' AND SUB_CODE = '1' THEN REF_CODE1 ELSE 'N' END RDO1,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M101' AND SUB_CODE = '2' THEN REF_CODE1 ELSE 'N' END RDO2,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M101' AND SUB_CODE = '3' THEN REF_CODE1 ELSE 'N' END RDO3,
        CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M101' AND SUB_CODE = '4' THEN REF_CODE1 ELSE 'N' END RDO4,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M101' AND SUB_CODE = '5' THEN REF_CODE1 ELSE 'N' END RDO5,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M008' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END RDO6,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M015' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END RDO7,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M400' AND SUB_CODE = '1' THEN REF_CODE1 ELSE '0' END NO1,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M400' AND SUB_CODE = '2' THEN REF_CODE1 ELSE '0' END NO2,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M400' AND SUB_CODE = '3' THEN REF_CODE1 ELSE '0' END NO3,

		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M400' AND SUB_CODE = '5' THEN REF_CODE1 ELSE 'N' END RDO8,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M400' AND SUB_CODE = '6' THEN REF_CODE1 ELSE 'N' END RDO9,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'P000' AND SUB_CODE = '1' THEN REF_CODE1 ELSE 'N' END RDO10,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M009' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END RDO11,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'B062' AND REF_CODE1 = 'Y' THEN SUB_CODE ELSE '' END RDO12,
		
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M400' AND SUB_CODE = '4' THEN REF_CODE1 ELSE '' END RDO13,
		
		 /* 발주승인 승인자id */
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M008' AND REF_CODE1 = 'Y' THEN REF_CODE4 ELSE '' END RDO6_4_CODE,
		CASE WHEN COMP_CODE = #{S_COMP_CODE} AND MAIN_CODE = 'M008' AND REF_CODE1 = 'Y' 
				THEN (SELECT USER_NAME FROM BSA300T WHERE COMP_CODE = #{S_COMP_CODE} AND USER_ID = REF_CODE4)
				ELSE '' END RDO6_4_NAME
		FROM BSA100T
	    WHERE COMP_CODE = #{S_COMP_CODE}
		  AND MAIN_CODE IN ( 'M101','M008','M015','M400','P000','M009','B062')	
		  AND SUB_CODE != '$'	
				
) A		


    </select>
<select id="mba020ukrvServiceImpl.selectForm2" parameterType="Map" resultType="rMap">
SELECT A.JOB_CODE               
		     , B.CODE_NAME  AS JOB_NAME  
		     , A.FORMAT_QTY            
		     , A.FORMAT_PRICE          
		     , A.FORMAT_IN             
		     , A.FORMAT_OUT            
		     , A.FORMAT_RATE         
		  FROM BSA110T A                
		     , BSA100T B                
		 WHERE A.COMP_CODE = B.COMP_CODE
		   AND A.JOB_CODE  = B.SUB_CODE 
		   AND A.JOB_CODE  = '16'       
		   AND B.MAIN_CODE = 'B007'     
		   AND A.COMP_CODE = #{S_COMP_CODE}




    </select>
<update id="mba020ukrvServiceImpl.updateForm" parameterType="Map">	

UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO1}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M101'
			AND SUB_CODE = '1'
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO2}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M101'
			AND SUB_CODE = '2'
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO3}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M101'
			AND SUB_CODE = '3'
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO4}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M101'
			AND SUB_CODE = '4'
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO5}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M101'
			AND SUB_CODE = '5'						


UPDATE BSA100T
	SET
		REF_CODE1 = CASE WHEN SUB_CODE = #{RDO6} THEN 'Y' ELSE '' END
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M008'
			AND SUB_CODE != '$'
	
	
UPDATE BSA100T
	SET
		REF_CODE1 = CASE WHEN SUB_CODE = #{RDO7} THEN 'Y' ELSE '' END
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M015'
			AND SUB_CODE != '$'
			

UPDATE BSA100T
	SET
		REF_CODE1 = #{NO1}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M400'
			AND SUB_CODE = '1'
UPDATE BSA100T
	SET
		REF_CODE1 = #{NO2}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M400'
			AND SUB_CODE = '2'
UPDATE BSA100T
	SET
		REF_CODE1 = #{NO3}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M400'
			AND SUB_CODE = '3'	
			

UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO8}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M400'
			AND SUB_CODE = '5'
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO9}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M400'
			AND SUB_CODE = '6'
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO10}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'P000'
			AND SUB_CODE = '1'


UPDATE BSA100T
	SET
		REF_CODE1 = CASE WHEN SUB_CODE = #{RDO11} THEN 'Y' ELSE '' END
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M009'
			AND SUB_CODE != '$'
			
				
UPDATE BSA100T
	SET
		REF_CODE1 = CASE WHEN SUB_CODE = #{RDO12} THEN 'Y' ELSE '' END
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'B062'
			AND SUB_CODE != '$'	
			
			
UPDATE BSA100T
	SET
		REF_CODE1 = #{RDO13}
		WHERE	COMP_CODE =#{S_COMP_CODE}
			AND	MAIN_CODE = 'M400'
			AND SUB_CODE = '4'
			

UPDATE BSA100T
	SET
		REF_CODE4 = #{RDO6_4_CODE}
		WHERE	COMP_CODE = #{S_COMP_CODE}
			AND	MAIN_CODE = 'M008'
			AND SUB_CODE != '$'
</update>

<update id="mba020ukrvServiceImpl.updateForm2" parameterType="Map">	
UPDATE BSA110T 
       SET FORMAT_QTY    = #{FORMAT_QTY}
         , FORMAT_PRICE  = #{FORMAT_PRICE}
         , FORMAT_IN     = #{FORMAT_IN}
         , FORMAT_OUT    = #{FORMAT_OUT}
         , FORMAT_RATE   = #{FORMAT_RATE}
         , UPDATE_DB_USER = #{S_USER_ID}
         , UPDATE_DB_TIME =  GETDATE()
     WHERE COMP_CODE      = #{S_COMP_CODE}
       AND JOB_CODE		 = '16'
		
</update>
<select id="mba020ukrvServiceImpl.checkCompCode" parameterType="Map" resultType="rMap">
		    SELECT A.COMP_CODE, A.COMP_NAME
		    FROM              BOR100T   A  WITH (NOLOCK)
		           LEFT  JOIN BSA100T   M1 WITH (NOLOCK) ON M1.COMP_CODE    = #{S_COMP_CODE}    
		                                                AND M1.MAIN_CODE    = 'B107'
		                                                AND M1.SUB_CODE     = '20'         
		    WHERE (A.COMP_CODE      &gt; ''        AND ISNULL(M1.REF_CODE1, 'N') = 'Y')
		       OR (A.COMP_CODE      = #{S_COMP_CODE}  AND ISNULL(M1.REF_CODE1, 'N') = 'N')
	</select>
</mapper>