<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hpa955skrServiceImpl">
	<select id="hpa955skrServiceImpl.getCostPoolName" parameterType="Map" resultType="rMap">
        SELECT NVL(REF_CODE2, '') AS REF_CODE2
        FROM BSA100T
        WHERE  COMP_CODE  = #{S_COMP_CODE}
        AND    MAIN_CODE  = 'H175'
        AND    SUB_CODE   = '10'
        AND    REF_CODE1  = 'Y' 
	</select>
	
	<select id="hpa955skrServiceImpl.selectColumns" parameterType="loginVO" resultType="rMap">

         -- hpa955skrServiceImpl.selectColumns
         
        SET @KEY_VALUE = '';
        
        DO(
            SELECT @KEY_VALUE := fnGetHpa955skrSelectCol1(#{S_COMP_CODE})
          );
        
        
        SELECT WAGES_NAME
        FROM T_HPA955SKR_3
        WHERE KEY_VALUE = @KEY_VALUE;
        
        DELETE FROM T_HPA955SKR_1 WHERE KEY_VALUE = @KEY_VALUE;
        DELETE FROM T_HPA955SKR_2 WHERE KEY_VALUE = @KEY_VALUE;
        DELETE FROM T_HPA955SKR_3 WHERE KEY_VALUE = @KEY_VALUE;    

	</select>

	<select id="hpa955skrServiceImpl.selectColumns2" parameterType="Map" resultType="rMap">		
    --hpa955skrServiceImpl.selectColumns2
        
        SET @KEY_VALUE = '';
        
        DO(
            SELECT @KEY_VALUE := fnGetHpa955skrSelectCol2(#{S_COMP_CODE}, #{DATE_FR}, #{DATE_TO})
          );
        
        
        -- KEY_VALUE 추가, 화면에서 KEY_VALUE를 selectList호출시 파라미터로 넘겨줘야함.
        SELECT WAGES_NAME, @KEY_VALUE AS KEY_VALUE
        FROM T_HPA955SKR_3
        WHERE KEY_VALUE = @KEY_VALUE;
  
-- 조회시 hpa955skrServiceImpl.selectColumns2 에서 하단 테이블의 값을 사용하므로 삭제하지 않아야함.        
--        DELETE FROM T_HPA955SKR_1 WHERE KEY_VALUE = @KEY_VALUE;
--        DELETE FROM T_HPA955SKR_2 WHERE KEY_VALUE = @KEY_VALUE;

        DELETE FROM T_HPA955SKR_3 WHERE KEY_VALUE = @KEY_VALUE;     
	</select>

	<select id="hpa955skrServiceImpl.selectList" parameterType="Map" resultType="rMap">		
	/* hpa955skrServiceImpl.selectList */
		
        -- 화면 파라미터
        SET @KeyValue = #{KEY_VALUE};
            
		<choose>
			<when test="rdoSelect2 == &quot;dept&quot;">
            
                        
            /* 급여내역 INSERT */
                INSERT INTO T_HPA955SKR_4
                (   KEY_VALUE     , GUBUN            , COMP_CODE    , PAY_YYYYMM       , SUPP_TYPE       , SUPP_NAME              , DIV_CODE    , DEPT_CODE    , DEPT_NAME
                  , PERSON_CNT  , SUPP_TOTAL_I   , DED_TOTAL_I    , REAL_AMOUNT_I   , BUSI_SHARE_I   , WORKER_COMPEN_I
                  , S1              , S2            , S3                , S4            , S5
                  , S6              , S7            , S8                , S9            , S10
                  , S11             , S12           , S13               , S14           , S15
                  , S16             , S17           , S18               , S19           , S20
                  , S21             , S22           , S23               , S24           , S25
                  , S26             , S27           , S28               , S29           , S30
                  , S31             , S32           , S33               , S34           , S35
                  , S36             , S37           , S38               , S39           , S40
            
                  , D1              , D2            , D3                , D4            , D5
                  , D6              , D7            , D8                , D9            , D10
                  , D11             , D12           , D13               , D14           , D15
                  , D16             , D17           , D18               , D19           , D20        
                )
                SELECT @KeyValue
                         , '1'                              AS GUBUN
                         , M1.COMP_CODE                     AS COMP_CODE
                         , fnGetUserDateComp(M1.COMP_CODE, M1.PAY_YYYYMM) AS PAY_YYYYMM
                         , M1.SUPP_TYPE                     AS SUPP_TYPE
                         , (SELECT CODE_NAME 
                            FROM BSA100T
                            WHERE COMP_CODE = #{S_COMP_CODE}
                            AND    MAIN_CODE   = 'H032'
                            AND    SUB_CODE     = M1.SUPP_TYPE) AS SUPP_NAME
                         , M1.DIV_CODE
                         , M1.DEPT_CODE
                         , M1.DEPT_NAME
                         , COUNT(M1.PERSON_NUMB)            AS PERSON_CNT
                         , SUM(M1.SUPP_TOTAL_I)                 AS SUPP_TOTAL_I
                         , SUM(M1.DED_TOTAL_I)              AS DED_TOTAL_I
                         , SUM(M1.REAL_AMOUNT_I)            AS REAL_AMOUNT_I
                         , SUM(M1.BUSI_SHARE_I)                 AS BUSI_SHARE_I
                         , SUM(M1.WORKER_COMPEN_I)     AS WORKER_COMPEN_I
                         , SUM(M2.S1)   AS S1       , SUM(M2.S2)  AS S2       , SUM(M2.S3)  AS S3
                         , SUM(M2.S4)   AS S4       , SUM(M2.S5)  AS S5       , SUM(M2.S6)  AS S6
                         , SUM(M2.S7)   AS S7       , SUM(M2.S8)  AS S8       , SUM(M2.S9)  AS S9
                         , SUM(M2.S10)  AS S10      , SUM(M2.S11) AS S11      , SUM(M2.S12) AS S12
                         , SUM(M2.S13)  AS S13      , SUM(M2.S14) AS S14      , SUM(M2.S15) AS S15
                         , SUM(M2.S16)  AS S16      , SUM(M2.S17) AS S17      , SUM(M2.S18) AS S18
                         , SUM(M2.S19)  AS S19      , SUM(M2.S20) AS S20
                         , SUM(M2.S21)  AS S21      , SUM(M2.S22) AS S22      , SUM(M2.S23) AS S23
                         , SUM(M2.S24)  AS S24      , SUM(M2.S25) AS S25      , SUM(M2.S26) AS S26
                         , SUM(M2.S27)  AS S27      , SUM(M2.S28) AS S28      , SUM(M2.S29) AS S29
                         , SUM(M2.S30)  AS S30      , SUM(M2.S31) AS S31      , SUM(M2.S32) AS S32
                         , SUM(M2.S33)  AS S33      , SUM(M2.S34) AS S34      , SUM(M2.S35) AS S35
                         , SUM(M2.S36)  AS S36      , SUM(M2.S37) AS S37      , SUM(M2.S38) AS S38
                         , SUM(M2.S39)  AS S39      , SUM(M2.S20) AS S40
                         , NVL(SUM(M3.D1), 0) AS D1
                         , NVL(SUM(M3.D2), 0) AS D2
                         , NVL(SUM(M3.D3), 0) AS D3
                         , NVL(SUM(M3.D4), 0) AS D4
                         , NVL(SUM(M3.D5), 0) AS D5
                         , NVL(SUM(M3.D6), 0) AS D6
                         , NVL(SUM(M3.D7), 0) AS D7
                         , NVL(SUM(M3.D8), 0) AS D8
                         , NVL(SUM(M3.D9), 0) AS D9
                         , NVL(SUM(M3.D10), 0) AS D10
                         , NVL(SUM(M3.D11), 0) AS D11
                         , NVL(SUM(M3.D12), 0) AS D12
                         , NVL(SUM(M3.D13), 0) AS D13
                         , NVL(SUM(M3.D14), 0) AS D14
                         , NVL(SUM(M3.D15), 0) AS D15
                         , NVL(SUM(M3.D16), 0) AS D16
                         , NVL(SUM(M3.D17), 0) AS D17
                         , NVL(SUM(M3.D18), 0) AS D18
                         , NVL(SUM(M3.D19), 0) AS D19
                         , NVL(SUM(M3.D20), 0) AS D20
                  FROM          HUM100T M0
                  INNER JOIN HPA600T  M1 ON M1.COMP_CODE      = M0.COMP_CODE
                                                       AND M1.PERSON_NUMB   = M0.PERSON_NUMB
                  INNER JOIN BSA100T     Z  ON M1.COMP_CODE      = Z.COMP_CODE
                                                       AND Z.MAIN_CODE          = 'H024'
                                                       AND M1.EMPLOY_TYPE     = Z.SUB_CODE
                  LEFT  JOIN (
                                    SELECT T1.PERSON_NUMB, T1.PAY_YYYYMM, T1.SUPP_TYPE
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C1  THEN T1.AMOUNT_I ELSE 0 END) AS S1
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C2  THEN T1.AMOUNT_I ELSE 0 END) AS S2
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C3  THEN T1.AMOUNT_I ELSE 0 END) AS S3
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C4  THEN T1.AMOUNT_I ELSE 0 END) AS S4
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C5  THEN T1.AMOUNT_I ELSE 0 END) AS S5
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C6  THEN T1.AMOUNT_I ELSE 0 END) AS S6
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C7  THEN T1.AMOUNT_I ELSE 0 END) AS S7
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C8  THEN T1.AMOUNT_I ELSE 0 END) AS S8
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C9  THEN T1.AMOUNT_I ELSE 0 END) AS S9
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C10 THEN T1.AMOUNT_I ELSE 0 END) AS S10
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C11 THEN T1.AMOUNT_I ELSE 0 END) AS S11
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C12 THEN T1.AMOUNT_I ELSE 0 END) AS S12
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C13 THEN T1.AMOUNT_I ELSE 0 END) AS S13
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C14 THEN T1.AMOUNT_I ELSE 0 END) AS S14
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C15 THEN T1.AMOUNT_I ELSE 0 END) AS S15
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C16 THEN T1.AMOUNT_I ELSE 0 END) AS S16
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C17 THEN T1.AMOUNT_I ELSE 0 END) AS S17
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C18 THEN T1.AMOUNT_I ELSE 0 END) AS S18
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C19 THEN T1.AMOUNT_I ELSE 0 END) AS S19
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C20 THEN T1.AMOUNT_I ELSE 0 END) AS S20
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C21 THEN T1.AMOUNT_I ELSE 0 END) AS S21
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C22 THEN T1.AMOUNT_I ELSE 0 END) AS S22
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C23 THEN T1.AMOUNT_I ELSE 0 END) AS S23
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C24 THEN T1.AMOUNT_I ELSE 0 END) AS S24
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C25 THEN T1.AMOUNT_I ELSE 0 END) AS S25
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C26 THEN T1.AMOUNT_I ELSE 0 END) AS S26
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C27 THEN T1.AMOUNT_I ELSE 0 END) AS S27
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C28 THEN T1.AMOUNT_I ELSE 0 END) AS S28
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C29 THEN T1.AMOUNT_I ELSE 0 END) AS S29
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C30 THEN T1.AMOUNT_I ELSE 0 END) AS S30
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C31 THEN T1.AMOUNT_I ELSE 0 END) AS S31
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C32 THEN T1.AMOUNT_I ELSE 0 END) AS S32
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C33 THEN T1.AMOUNT_I ELSE 0 END) AS S33
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C35 THEN T1.AMOUNT_I ELSE 0 END) AS S34
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C35 THEN T1.AMOUNT_I ELSE 0 END) AS S35
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C36 THEN T1.AMOUNT_I ELSE 0 END) AS S36
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C37 THEN T1.AMOUNT_I ELSE 0 END) AS S37
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C38 THEN T1.AMOUNT_I ELSE 0 END) AS S38
                                                , SUM(CASE WHEN T1.WAGES_CODE = T4.C39 THEN T1.AMOUNT_I ELSE 0 END) AS S39
                                                , MAX(CASE WHEN T4.C40 = 'zzz' THEN NVL(T5.ETC_AMT,0)
                                                                  ELSE (CASE WHEN T1.WAGES_CODE = T4.C40 THEN T1.AMOUNT_I ELSE 0 END) 
                                                         END) AS S40
                                                , T1.COMP_CODE
                                 FROM           HPA300T T1
                                 LEFT JOIN (
                                                   SELECT PERSON_NUMB
                                                            , PAY_YYYYMM
                                                            , SUPP_TYPE
                                                            , SUM(AMOUNT_I) AS ETC_AMT
                                                            , COMP_CODE
                                                   FROM HPA300T
                                                   WHERE COMP_CODE = #{S_COMP_CODE} 
                                                        <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                                        AND SUPP_TYPE = #{SUPP_TYPE}
                                                        </if>
                                                    AND PAY_YYYYMM  &gt;= #{DATE_FR} 
                                                    AND PAY_YYYYMM  &lt;= #{DATE_TO} 
                                                    AND WAGES_CODE IN (SELECT WAGES_CODE FROM T_HPA955SKR_2 WHERE KEY_VALUE = @KeyValue AND W_SEQ &gt;= 20 )
                                                  GROUP BY PERSON_NUMB, PAY_YYYYMM, SUPP_TYPE, COMP_CODE
                                                ) T5 ON T5.COMP_CODE    = T1.COMP_CODE
                                                    AND T5.PERSON_NUMB = T1.PERSON_NUMB
                                                    AND T5.SUPP_TYPE       = T1.SUPP_TYPE
                                                    AND T5.PAY_YYYYMM   = T1.PAY_YYYYMM
                                                , (
                                                    SELECT MAX(CASE WHEN W_SEQ = 1  THEN WAGES_CODE ELSE '' END) AS C1
                                                            , MAX(CASE WHEN W_SEQ = 2  THEN WAGES_CODE ELSE '' END) AS C2
                                                            , MAX(CASE WHEN W_SEQ = 3  THEN WAGES_CODE ELSE '' END) AS C3
                                                            , MAX(CASE WHEN W_SEQ = 4  THEN WAGES_CODE ELSE '' END) AS C4
                                                            , MAX(CASE WHEN W_SEQ = 5  THEN WAGES_CODE ELSE '' END) AS C5
                                                            , MAX(CASE WHEN W_SEQ = 6  THEN WAGES_CODE ELSE '' END) AS C6
                                                            , MAX(CASE WHEN W_SEQ = 7  THEN WAGES_CODE ELSE '' END) AS C7
                                                            , MAX(CASE WHEN W_SEQ = 8  THEN WAGES_CODE ELSE '' END) AS C8
                                                            , MAX(CASE WHEN W_SEQ = 9  THEN WAGES_CODE ELSE '' END) AS C9
                                                            , MAX(CASE WHEN W_SEQ = 10 THEN WAGES_CODE ELSE '' END) AS C10
                                                            , MAX(CASE WHEN W_SEQ = 11 THEN WAGES_CODE ELSE '' END) AS C11
                                                            , MAX(CASE WHEN W_SEQ = 12 THEN WAGES_CODE ELSE '' END) AS C12
                                                            , MAX(CASE WHEN W_SEQ = 13 THEN WAGES_CODE ELSE '' END) AS C13
                                                            , MAX(CASE WHEN W_SEQ = 14 THEN WAGES_CODE ELSE '' END) AS C14
                                                            , MAX(CASE WHEN W_SEQ = 15 THEN WAGES_CODE ELSE '' END) AS C15
                                                            , MAX(CASE WHEN W_SEQ = 16 THEN WAGES_CODE ELSE '' END) AS C16
                                                            , MAX(CASE WHEN W_SEQ = 17 THEN WAGES_CODE ELSE '' END) AS C17
                                                            , MAX(CASE WHEN W_SEQ = 18 THEN WAGES_CODE ELSE '' END) AS C18
                                                            , MAX(CASE WHEN W_SEQ = 19 THEN WAGES_CODE ELSE '' END) AS C19
                                                            , MAX(CASE WHEN W_SEQ = 20 THEN WAGES_CODE ELSE '' END) AS C20
                                                            , MAX(CASE WHEN W_SEQ = 21 THEN WAGES_CODE ELSE '' END) AS C21
                                                            , MAX(CASE WHEN W_SEQ = 22 THEN WAGES_CODE ELSE '' END) AS C22
                                                            , MAX(CASE WHEN W_SEQ = 23 THEN WAGES_CODE ELSE '' END) AS C23
                                                            , MAX(CASE WHEN W_SEQ = 24 THEN WAGES_CODE ELSE '' END) AS C24
                                                            , MAX(CASE WHEN W_SEQ = 25 THEN WAGES_CODE ELSE '' END) AS C25
                                                            , MAX(CASE WHEN W_SEQ = 26 THEN WAGES_CODE ELSE '' END) AS C26
                                                            , MAX(CASE WHEN W_SEQ = 27 THEN WAGES_CODE ELSE '' END) AS C27
                                                            , MAX(CASE WHEN W_SEQ = 28 THEN WAGES_CODE ELSE '' END) AS C28
                                                            , MAX(CASE WHEN W_SEQ = 29 THEN WAGES_CODE ELSE '' END) AS C29
                                                            , MAX(CASE WHEN W_SEQ = 30 THEN WAGES_CODE ELSE '' END) AS C30
                                                            , MAX(CASE WHEN W_SEQ = 31 THEN WAGES_CODE ELSE '' END) AS C31
                                                            , MAX(CASE WHEN W_SEQ = 32 THEN WAGES_CODE ELSE '' END) AS C32
                                                            , MAX(CASE WHEN W_SEQ = 33 THEN WAGES_CODE ELSE '' END) AS C33
                                                            , MAX(CASE WHEN W_SEQ = 34 THEN WAGES_CODE ELSE '' END) AS C34
                                                            , MAX(CASE WHEN W_SEQ = 35 THEN WAGES_CODE ELSE '' END) AS C35
                                                            , MAX(CASE WHEN W_SEQ = 36 THEN WAGES_CODE ELSE '' END) AS C36
                                                            , MAX(CASE WHEN W_SEQ = 37 THEN WAGES_CODE ELSE '' END) AS C37
                                                            , MAX(CASE WHEN W_SEQ = 38 THEN WAGES_CODE ELSE '' END) AS C38
                                                            , MAX(CASE WHEN W_SEQ = 39 THEN WAGES_CODE ELSE '' END) AS C39
                                                            , MAX(CASE WHEN W_SEQ &gt;= 40 THEN 'zzz' 
                                                                              ELSE (CASE WHEN W_SEQ = 40 THEN WAGES_CODE ELSE '' END)
                                                                      END) AS C40
                                                 FROM T_HPA955SKR_2
                                                 WHERE KEY_VALUE = @KeyValue
                                               ) T4
                                         WHERE T1.COMP_CODE  = #{S_COMP_CODE} 
                                            <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                            AND T1.SUPP_TYPE = #{SUPP_TYPE}
                                            </if>
                                        AND T1.PAY_YYYYMM &gt;= #{DATE_FR}  
                                        AND T1.PAY_YYYYMM &lt;= #{DATE_TO}   
                                       GROUP BY T1.PERSON_NUMB, T1.PAY_YYYYMM, T1.SUPP_TYPE, T1.COMP_CODE
                                     ) M2 ON M2.COMP_CODE    = M1.COMP_CODE
                                          AND M2.PERSON_NUMB = M1.PERSON_NUMB
                                          AND M2.SUPP_TYPE       = M1.SUPP_TYPE
                                          AND M2.PAY_YYYYMM   = M1.PAY_YYYYMM
                  LEFT  JOIN (
                                    SELECT T1.PERSON_NUMB
                                              , T1.PAY_YYYYMM
                                              , T1.SUPP_TYPE
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D1 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D1
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D2 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D2
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D3 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D3
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D4 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D4
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D5 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D5
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D6 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D6
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D7 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D7
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D8 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D8
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D9 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D9
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D10 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D10
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D11 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D11
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D12 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D12
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D13 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D13
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D14 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D14
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D15 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D15
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D16 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D16
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D17 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D17
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D18 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D18
                                              , SUM(CASE WHEN T1.DED_CODE = T4.D19 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D19
                                           
                                              , SUM(CASE WHEN T4.D20 = 'zz' THEN NVL(T5.ETC_AMT,0)
                                                                ELSE (CASE WHEN T1.DED_CODE = T4.D20 THEN T1.DED_AMOUNT_I ELSE 0 END) 
                                                       END) AS D20
                                              , T1.COMP_CODE
                                     FROM        HPA400T T1
                                     LEFT JOIN (

                                                        SELECT PERSON_NUMB
                                                                 , PAY_YYYYMM
                                                                 , SUPP_TYPE
                                                                 , SUM(DED_AMOUNT_I) AS ETC_AMT
                                                                 , COMP_CODE
                                                        FROM HPA400T
                                                        WHERE COMP_CODE =  #{S_COMP_CODE} 
                                                            <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                                            AND SUPP_TYPE = #{SUPP_TYPE}
                                                            </if>
                                                        AND    PAY_YYYYMM &gt;= #{DATE_FR}
                                                        AND    PAY_YYYYMM &lt;= #{DATE_TO}
                                                        AND    DED_CODE IN (SELECT SUB_CODE FROM T_HPA955SKR_1 WHERE KEY_VALUE = @KeyValue AND SEQ &gt;= 15 )
                                                        GROUP BY PERSON_NUMB, PAY_YYYYMM, SUPP_TYPE, COMP_CODE 
                                                     ) T5 ON T5.COMP_CODE     = T1.COMP_CODE
                                                         AND T5.PERSON_NUMB  = T1.PERSON_NUMB
                                                         AND T5.SUPP_TYPE        = T1.SUPP_TYPE
                                                         AND T5.PAY_YYYYMM    = T1.PAY_YYYYMM
                                                   , (
                                                      SELECT MAX(CASE WHEN A.SEQ = 1  THEN A.SUB_CODE ELSE '' END) AS D1 
                                                               , MAX(CASE WHEN A.SEQ = 2  THEN A.SUB_CODE ELSE '' END) AS D2 
                                                               , MAX(CASE WHEN A.SEQ = 3  THEN A.SUB_CODE ELSE '' END) AS D3 
                                                               , MAX(CASE WHEN A.SEQ = 4  THEN A.SUB_CODE ELSE '' END) AS D4 
                                                               , MAX(CASE WHEN A.SEQ = 5  THEN A.SUB_CODE ELSE '' END) AS D5 
                                                               , MAX(CASE WHEN A.SEQ = 6  THEN A.SUB_CODE ELSE '' END) AS D6 
                                                               , MAX(CASE WHEN A.SEQ = 7  THEN A.SUB_CODE ELSE '' END) AS D7 
                                                               , MAX(CASE WHEN A.SEQ = 8  THEN A.SUB_CODE ELSE '' END) AS D8 
                                                               , MAX(CASE WHEN A.SEQ = 9  THEN A.SUB_CODE ELSE '' END) AS D9 
                                                               , MAX(CASE WHEN A.SEQ = 10 THEN A.SUB_CODE ELSE '' END) AS D10 
                                                               , MAX(CASE WHEN A.SEQ = 11 THEN A.SUB_CODE ELSE '' END) AS D11 
                                                               , MAX(CASE WHEN A.SEQ = 12 THEN A.SUB_CODE ELSE '' END) AS D12 
                                                               , MAX(CASE WHEN A.SEQ = 13 THEN A.SUB_CODE ELSE '' END) AS D13 
                                                               , MAX(CASE WHEN A.SEQ = 14 THEN A.SUB_CODE ELSE '' END) AS D14 
                                                               , MAX(CASE WHEN A.SEQ = 15 THEN A.SUB_CODE ELSE '' END) AS D15 
                                                               , MAX(CASE WHEN A.SEQ = 16 THEN A.SUB_CODE ELSE '' END) AS D16 
                                                               , MAX(CASE WHEN A.SEQ = 17 THEN A.SUB_CODE ELSE '' END) AS D17 
                                                               , MAX(CASE WHEN A.SEQ = 18 THEN A.SUB_CODE ELSE '' END) AS D18 
                                                               , MAX(CASE WHEN A.SEQ = 19 THEN A.SUB_CODE ELSE '' END) AS D19 
                                                               , MAX(CASE WHEN A.SEQ &gt;= 20 THEN 'zz' 
                                                                                 ELSE (CASE WHEN A.SEQ = 20 THEN A.SUB_CODE ELSE '' END) 
                                                                         END) AS D20
                                                      FROM T_HPA955SKR_1 A
                                                      WHERE A.KEY_VALUE = @KeyValue
                                                    ) T4
                                     WHERE T1.COMP_CODE =  #{S_COMP_CODE} 
                                      <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                      AND T1.SUPP_TYPE = #{SUPP_TYPE}
                                      </if>
                                     AND T1.PAY_YYYYMM &gt;= #{DATE_FR} 
                                     AND T1.PAY_YYYYMM &lt;=  #{DATE_TO} 
                                     GROUP BY T1.PERSON_NUMB, T1.PAY_YYYYMM, T1.SUPP_TYPE, T1.COMP_CODE
                                ) M3 ON M3.COMP_CODE     = M1.COMP_CODE
                                      AND M3.PERSON_NUMB = M1.PERSON_NUMB
                                      AND M3.SUPP_TYPE       = M1.SUPP_TYPE
                                      AND M3.PAY_YYYYMM   = M1.PAY_YYYYMM
                  WHERE M0.COMP_CODE = #{S_COMP_CODE} 
                  
	
	            <if test="@foren.Ognl@isNotEmpty(DIV_CODE)">	     
				  	AND M1.DIV_CODE	= #{DIV_CODE}
				</if>
		        <if test="@foren.Ognl@isNotEmpty(DEPTS)">
				   AND  M1.DEPT_CODE IN
					 <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
			          		 #{item}
			    	 </foreach>
				</if>
				<if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">	     
				  	AND M1.SUPP_TYPE = #{SUPP_TYPE}
			    </if>
	            <if test="@foren.Ognl@isNotEmpty(DATE_FR)">
                    AND  M1.PAY_YYYYMM &gt;= #{DATE_FR}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(DATE_TO)">
                    AND  M1.PAY_YYYYMM &lt;= #{DATE_TO}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_CODE)">
	                AND  M1.PAY_CODE = #{PAY_CODE}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_DAY_FLAG)">
	                AND  M1.PAY_PROV_FLAG = #{PAY_DAY_FLAG}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_GUBUN)">
                    AND M1.PAY_GUBUN = #{PAY_GUBUN}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(rdoSelect)">
                    AND M1.PAY_GUBUN2 = #{rdoSelect}
	            </if>
	            <if test="rdoSelect4 == &quot;male&quot;">
	            	AND M0.SEX_CODE = 'M'
	            </if>
            	<if test="rdoSelect4 == &quot;female&quot;">
            		AND M0.SEX_CODE = 'F'
            	</if>
            	<if test="rdoSelect3 == &quot;hired&quot;">
	            	AND (M0.RETR_DATE = '00000000' OR M0.RETR_DATE = '')
	            </if>
            	<if test="rdoSelect3 == &quot;fired&quot;">
            		AND (M0.RETR_DATE != '00000000' AND M0.RETR_DATE != '')
            	</if>
	            <if test="@foren.Ognl@isNotEmpty(COST_POOL)">
                    AND  M1.COST_KIND = #{COST_POOL}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(EMPLOY_TYPE)">
                    AND  M1.EMPLOY_TYPE = #{EMPLOY_TYPE}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PERSON_GROUP)">
                    AND  Z.REF_CODE1 = #{PERSON_GROUP}
	            </if>
            	
	            
            	GROUP BY M1.COMP_CODE, M1.PAY_YYYYMM, M1.SUPP_TYPE, M1.DIV_CODE, M1.DEPT_CODE, M1.DEPT_NAME
            	ORDER BY M1.COMP_CODE, M1.PAY_YYYYMM, M1.SUPP_TYPE, M1.DIV_CODE, M1.DEPT_CODE, M1.DEPT_NAME;
                
			</when>
			<otherwise>
                INSERT INTO T_HPA955SKR_4
                (   KEY_VALUE     , GUBUN            , COMP_CODE    , PAY_YYYYMM       , SUPP_TYPE       , SUPP_NAME              , DIV_CODE    , DEPT_CODE    , DEPT_NAME
                  , PERSON_CNT  , SUPP_TOTAL_I   , DED_TOTAL_I    , REAL_AMOUNT_I   , BUSI_SHARE_I   , WORKER_COMPEN_I
                  , S1              , S2            , S3                , S4            , S5
                  , S6              , S7            , S8                , S9            , S10
                  , S11             , S12           , S13               , S14           , S15
                  , S16             , S17           , S18               , S19           , S20
                  , S21             , S22           , S23               , S24           , S25
                  , S26             , S27           , S28               , S29           , S30
                  , S31             , S32           , S33               , S34           , S35
                  , S36             , S37           , S38               , S39           , S40
            
                  , D1              , D2            , D3                , D4            , D5
                  , D6              , D7            , D8                , D9            , D10
                  , D11             , D12           , D13               , D14           , D15
                  , D16             , D17           , D18               , D19           , D20        
                )            
                SELECT @KeyValue
                     , '1'                                  AS GUBUN
                     , M1.COMP_CODE                         AS COMP_CODE
                     , fnGetUserDateComp(M1.COMP_CODE, M1.PAY_YYYYMM) AS PAY_YYYYMM
                     , M1.SUPP_TYPE                         AS SUPP_TYPE
                     , (SELECT CODE_NAME 
                          FROM BSA100T
                         WHERE COMP_CODE = #{S_COMP_CODE}
                           AND MAIN_CODE = 'H032'
                           AND SUB_CODE = M1.SUPP_TYPE)     AS SUPP_NAME
                     , M1.DIV_CODE
                     , M1.POST_CODE                         AS DEPT_CODE
                     , (SELECT CODE_NAME
                          FROM BSA100T
                         WHERE COMP_CODE = #{S_COMP_CODE} 
                           AND MAIN_CODE = 'H005'
                           AND SUB_CODE  = M1.POST_CODE)    AS DEPT_NAME
                     , COUNT(M1.PERSON_NUMB)                AS PERSON_CNT
                     , SUM(M1.SUPP_TOTAL_I)                 AS SUPP_TOTAL_I
                     , SUM(M1.DED_TOTAL_I)                  AS DED_TOTAL_I
                     , SUM(M1.REAL_AMOUNT_I)                AS REAL_AMOUNT_I
                     , SUM(M1.BUSI_SHARE_I)                 AS BUSI_SHARE_I
                     , SUM(M1.WORKER_COMPEN_I)              AS WORKER_COMPEN_I
                     , SUM(M2.S1)   AS S1       , SUM(M2.S2)  AS S2       , SUM(M2.S3)  AS S3
                     , SUM(M2.S4)   AS S4       , SUM(M2.S5)  AS S5       , SUM(M2.S6)  AS S6
                     , SUM(M2.S7)   AS S7       , SUM(M2.S8)  AS S8       , SUM(M2.S9)  AS S9
                     , SUM(M2.S10)  AS S10      , SUM(M2.S11) AS S11      , SUM(M2.S12) AS S12
                     , SUM(M2.S13)  AS S13      , SUM(M2.S14) AS S14      , SUM(M2.S15) AS S15
                     , SUM(M2.S16)  AS S16      , SUM(M2.S17) AS S17      , SUM(M2.S18) AS S18
                     , SUM(M2.S19)  AS S19      , SUM(M2.S20) AS S20
                     , SUM(M2.S21)  AS S21      , SUM(M2.S22) AS S22      , SUM(M2.S23) AS S23
                     , SUM(M2.S24)  AS S24      , SUM(M2.S25) AS S25      , SUM(M2.S26) AS S26
                     , SUM(M2.S27)  AS S27      , SUM(M2.S28) AS S28      , SUM(M2.S29) AS S29
                     , SUM(M2.S30)  AS S30      , SUM(M2.S31) AS S31      , SUM(M2.S32) AS S32
                     , SUM(M2.S33)  AS S33      , SUM(M2.S34) AS S34      , SUM(M2.S35) AS S35
                     , SUM(M2.S36)  AS S36      , SUM(M2.S37) AS S37      , SUM(M2.S38) AS S38
                     , SUM(M2.S39)  AS S39      , SUM(M2.S20) AS S40
                     , NVL(SUM(M3.D1), 0) AS D1
                     , NVL(SUM(M3.D2), 0) AS D2
                     , NVL(SUM(M3.D3), 0) AS D3
                     , NVL(SUM(M3.D4), 0) AS D4
                     , NVL(SUM(M3.D5), 0) AS D5
                     , NVL(SUM(M3.D6), 0) AS D6
                     , NVL(SUM(M3.D7), 0) AS D7
                     , NVL(SUM(M3.D8), 0) AS D8
                     , NVL(SUM(M3.D9), 0) AS D9
                     , NVL(SUM(M3.D10), 0) AS D10
                     , NVL(SUM(M3.D11), 0) AS D11
                     , NVL(SUM(M3.D12), 0) AS D12
                     , NVL(SUM(M3.D13), 0) AS D13
                     , NVL(SUM(M3.D14), 0) AS D14
                     , NVL(SUM(M3.D15), 0) AS D15
                     , NVL(SUM(M3.D16), 0) AS D16
                     , NVL(SUM(M3.D17), 0) AS D17
                     , NVL(SUM(M3.D18), 0) AS D18
                     , NVL(SUM(M3.D19), 0) AS D19
                     , NVL(SUM(M3.D20), 0) AS D20
                  FROM          HUM100T M0
                  INNER JOIN HPA600T  M1 ON M1.COMP_CODE     = M0.COMP_CODE
                                                       AND M1.PERSON_NUMB  = M0.PERSON_NUMB
                  INNER JOIN BSA100T     Z  ON M1.COMP_CODE     = Z.COMP_CODE
                                                        AND Z.MAIN_CODE        = 'H024'
                                                        AND M1.EMPLOY_TYPE   = Z.SUB_CODE
                  LEFT  JOIN (
                                            SELECT   T1.PERSON_NUMB
                                                        , T1.PAY_YYYYMM
                                                        , T1.SUPP_TYPE
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C1  THEN T1.AMOUNT_I ELSE 0 END) AS S1
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C2  THEN T1.AMOUNT_I ELSE 0 END) AS S2
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C3  THEN T1.AMOUNT_I ELSE 0 END) AS S3
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C4  THEN T1.AMOUNT_I ELSE 0 END) AS S4
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C5  THEN T1.AMOUNT_I ELSE 0 END) AS S5
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C6  THEN T1.AMOUNT_I ELSE 0 END) AS S6
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C7  THEN T1.AMOUNT_I ELSE 0 END) AS S7
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C8  THEN T1.AMOUNT_I ELSE 0 END) AS S8
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C9  THEN T1.AMOUNT_I ELSE 0 END) AS S9
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C10 THEN T1.AMOUNT_I ELSE 0 END) AS S10
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C11 THEN T1.AMOUNT_I ELSE 0 END) AS S11
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C12 THEN T1.AMOUNT_I ELSE 0 END) AS S12
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C13 THEN T1.AMOUNT_I ELSE 0 END) AS S13
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C14 THEN T1.AMOUNT_I ELSE 0 END) AS S14
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C15 THEN T1.AMOUNT_I ELSE 0 END) AS S15
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C16 THEN T1.AMOUNT_I ELSE 0 END) AS S16
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C17 THEN T1.AMOUNT_I ELSE 0 END) AS S17
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C18 THEN T1.AMOUNT_I ELSE 0 END) AS S18
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C19 THEN T1.AMOUNT_I ELSE 0 END) AS S19
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C20 THEN T1.AMOUNT_I ELSE 0 END) AS S20
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C21 THEN T1.AMOUNT_I ELSE 0 END) AS S21
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C22 THEN T1.AMOUNT_I ELSE 0 END) AS S22
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C23 THEN T1.AMOUNT_I ELSE 0 END) AS S23
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C24 THEN T1.AMOUNT_I ELSE 0 END) AS S24
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C25 THEN T1.AMOUNT_I ELSE 0 END) AS S25
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C26 THEN T1.AMOUNT_I ELSE 0 END) AS S26
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C27 THEN T1.AMOUNT_I ELSE 0 END) AS S27
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C28 THEN T1.AMOUNT_I ELSE 0 END) AS S28
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C29 THEN T1.AMOUNT_I ELSE 0 END) AS S29
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C30 THEN T1.AMOUNT_I ELSE 0 END) AS S30
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C31 THEN T1.AMOUNT_I ELSE 0 END) AS S31
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C32 THEN T1.AMOUNT_I ELSE 0 END) AS S32
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C33 THEN T1.AMOUNT_I ELSE 0 END) AS S33
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C35 THEN T1.AMOUNT_I ELSE 0 END) AS S34
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C35 THEN T1.AMOUNT_I ELSE 0 END) AS S35
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C36 THEN T1.AMOUNT_I ELSE 0 END) AS S36
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C37 THEN T1.AMOUNT_I ELSE 0 END) AS S37
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C38 THEN T1.AMOUNT_I ELSE 0 END) AS S38
                                                        , SUM(CASE WHEN T1.WAGES_CODE = T4.C39 THEN T1.AMOUNT_I ELSE 0 END) AS S39
                                                        , MAX(CASE WHEN T4.C40 = 'zzz' THEN NVL(T5.ETC_AMT,0)
                                                                          ELSE (CASE WHEN T1.WAGES_CODE = T4.C40 THEN T1.AMOUNT_I ELSE 0 END) 
                                                                  END) AS S40       
                                                        , T1.COMP_CODE
                                            FROM HPA300T T1
                                            LEFT JOIN    (
                                                          SELECT PERSON_NUMB
                                                                   , PAY_YYYYMM
                                                                   , SUPP_TYPE
                                                                   , SUM(AMOUNT_I) AS ETC_AMT 
                                                                   , COMP_CODE
                                                          FROM HPA300T
                                                          WHERE COMP_CODE = #{S_COMP_CODE} 
                                                          <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                                          AND SUPP_TYPE = #{SUPP_TYPE}
                                                          </if>
                                                          AND     PAY_YYYYMM &gt;=  #{DATE_FR} 
                                                          AND     PAY_YYYYMM &lt;=  #{DATE_TO} 
                                                          AND     WAGES_CODE IN (SELECT WAGES_CODE FROM T_HPA955SKR_2 WHERE KEY_VALUE = @KeyValue AND W_SEQ &gt;= 20 )
                                                          GROUP BY PERSON_NUMB, PAY_YYYYMM, SUPP_TYPE, COMP_CODE
                                                                      
                                                          ) T5 ON T5.COMP_CODE   = T1.COMP_CODE
                                                                                                                    AND T5.PERSON_NUMB = T1.PERSON_NUMB
                                                                                                                    AND T5.SUPP_TYPE   = T1.SUPP_TYPE
                                                                                                                    AND T5.PAY_YYYYMM  = T1.PAY_YYYYMM
                                                        , (
                                                            SELECT MAX(CASE WHEN W_SEQ = 1  THEN WAGES_CODE ELSE '' END) AS C1
                                                                    , MAX(CASE WHEN W_SEQ = 2  THEN WAGES_CODE ELSE '' END) AS C2
                                                                    , MAX(CASE WHEN W_SEQ = 3  THEN WAGES_CODE ELSE '' END) AS C3
                                                                    , MAX(CASE WHEN W_SEQ = 4  THEN WAGES_CODE ELSE '' END) AS C4
                                                                    , MAX(CASE WHEN W_SEQ = 5  THEN WAGES_CODE ELSE '' END) AS C5
                                                                    , MAX(CASE WHEN W_SEQ = 6  THEN WAGES_CODE ELSE '' END) AS C6
                                                                    , MAX(CASE WHEN W_SEQ = 7  THEN WAGES_CODE ELSE '' END) AS C7
                                                                    , MAX(CASE WHEN W_SEQ = 8  THEN WAGES_CODE ELSE '' END) AS C8
                                                                    , MAX(CASE WHEN W_SEQ = 9  THEN WAGES_CODE ELSE '' END) AS C9
                                                                    , MAX(CASE WHEN W_SEQ = 10 THEN WAGES_CODE ELSE '' END) AS C10
                                                                    , MAX(CASE WHEN W_SEQ = 11 THEN WAGES_CODE ELSE '' END) AS C11
                                                                    , MAX(CASE WHEN W_SEQ = 12 THEN WAGES_CODE ELSE '' END) AS C12
                                                                    , MAX(CASE WHEN W_SEQ = 13 THEN WAGES_CODE ELSE '' END) AS C13
                                                                    , MAX(CASE WHEN W_SEQ = 14 THEN WAGES_CODE ELSE '' END) AS C14
                                                                    , MAX(CASE WHEN W_SEQ = 15 THEN WAGES_CODE ELSE '' END) AS C15
                                                                    , MAX(CASE WHEN W_SEQ = 16 THEN WAGES_CODE ELSE '' END) AS C16
                                                                    , MAX(CASE WHEN W_SEQ = 17 THEN WAGES_CODE ELSE '' END) AS C17
                                                                    , MAX(CASE WHEN W_SEQ = 18 THEN WAGES_CODE ELSE '' END) AS C18
                                                                    , MAX(CASE WHEN W_SEQ = 19 THEN WAGES_CODE ELSE '' END) AS C19
                                                                    , MAX(CASE WHEN W_SEQ = 20 THEN WAGES_CODE ELSE '' END) AS C20
                                                                    , MAX(CASE WHEN W_SEQ = 21 THEN WAGES_CODE ELSE '' END) AS C21
                                                                    , MAX(CASE WHEN W_SEQ = 22 THEN WAGES_CODE ELSE '' END) AS C22
                                                                    , MAX(CASE WHEN W_SEQ = 23 THEN WAGES_CODE ELSE '' END) AS C23
                                                                    , MAX(CASE WHEN W_SEQ = 24 THEN WAGES_CODE ELSE '' END) AS C24
                                                                    , MAX(CASE WHEN W_SEQ = 25 THEN WAGES_CODE ELSE '' END) AS C25
                                                                    , MAX(CASE WHEN W_SEQ = 26 THEN WAGES_CODE ELSE '' END) AS C26
                                                                    , MAX(CASE WHEN W_SEQ = 27 THEN WAGES_CODE ELSE '' END) AS C27
                                                                    , MAX(CASE WHEN W_SEQ = 28 THEN WAGES_CODE ELSE '' END) AS C28
                                                                    , MAX(CASE WHEN W_SEQ = 29 THEN WAGES_CODE ELSE '' END) AS C29
                                                                    , MAX(CASE WHEN W_SEQ = 30 THEN WAGES_CODE ELSE '' END) AS C30
                                                                    , MAX(CASE WHEN W_SEQ = 31 THEN WAGES_CODE ELSE '' END) AS C31
                                                                    , MAX(CASE WHEN W_SEQ = 32 THEN WAGES_CODE ELSE '' END) AS C32
                                                                    , MAX(CASE WHEN W_SEQ = 33 THEN WAGES_CODE ELSE '' END) AS C33
                                                                    , MAX(CASE WHEN W_SEQ = 34 THEN WAGES_CODE ELSE '' END) AS C34
                                                                    , MAX(CASE WHEN W_SEQ = 35 THEN WAGES_CODE ELSE '' END) AS C35
                                                                    , MAX(CASE WHEN W_SEQ = 36 THEN WAGES_CODE ELSE '' END) AS C36
                                                                    , MAX(CASE WHEN W_SEQ = 37 THEN WAGES_CODE ELSE '' END) AS C37
                                                                    , MAX(CASE WHEN W_SEQ = 38 THEN WAGES_CODE ELSE '' END) AS C38
                                                                    , MAX(CASE WHEN W_SEQ = 39 THEN WAGES_CODE ELSE '' END) AS C39
                                                                    , MAX(CASE WHEN W_SEQ &gt;= 40 THEN 'zzz' 
                                                                                      ELSE (CASE WHEN W_SEQ = 40 THEN WAGES_CODE ELSE '' END)
                                                                              END) AS C40
                                                             FROM T_HPA955SKR_2
                                                             WHERE KEY_VALUE = @KeyValue
                                                             ) T4
                                                WHERE T1.COMP_CODE = #{S_COMP_CODE} 
                                               <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                               AND T1.SUPP_TYPE = #{SUPP_TYPE}
                                               </if>
                                               AND T1.PAY_YYYYMM &gt;=  #{DATE_FR}  
                                               AND T1.PAY_YYYYMM &lt;=  #{DATE_TO}  
                                               GROUP BY T1.PERSON_NUMB, T1.PAY_YYYYMM, T1.SUPP_TYPE, T1.COMP_CODE
                                       ) M2 ON M2.COMP_CODE    = M1.COMP_CODE
                                            AND M2.PERSON_NUMB = M1.PERSON_NUMB
                                            AND M2.SUPP_TYPE       = M1.SUPP_TYPE
                                            AND M2.PAY_YYYYMM   = M1.PAY_YYYYMM
                       LEFT  JOIN (
                                        SELECT T1.PERSON_NUMB
                                                 , T1.PAY_YYYYMM
                                                 , T1.SUPP_TYPE
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D1 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D1
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D2 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D2
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D3 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D3
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D4 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D4
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D5 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D5
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D6 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D6
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D7 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D7
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D8 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D8
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D9 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D9
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D10 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D10
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D11 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D11
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D12 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D12
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D13 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D13
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D14 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D14
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D15 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D15
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D16 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D16
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D17 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D17
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D18 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D18
                                                 , SUM(CASE WHEN T1.DED_CODE = T4.D19 THEN T1.DED_AMOUNT_I ELSE 0 END) AS D19
                                                
                                                 , SUM(CASE WHEN T4.D20 = 'zz' THEN NVL(T5.ETC_AMT,0)
                                                                   ELSE (CASE WHEN T1.DED_CODE = T4.D20 THEN T1.DED_AMOUNT_I ELSE 0 END) 
                                                           END) AS D20
                                                , T1.COMP_CODE
                                        FROM        HPA400T T1
                                        LEFT JOIN
                                                     (
                                                      SELECT PERSON_NUMB
                                                               , PAY_YYYYMM
                                                               , SUPP_TYPE
                                                               , SUM(DED_AMOUNT_I) AS ETC_AMT
                                                               , COMP_CODE
                                                       FROM HPA400T
                                                       WHERE COMP_CODE =  #{S_COMP_CODE} 
                                                        <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                                        AND SUPP_TYPE = #{SUPP_TYPE}
                                                        </if>
                                                        AND    PAY_YYYYMM &gt;= #{DATE_FR} 
                                                        AND    PAY_YYYYMM &lt;= #{DATE_TO}  
                                                        AND    DED_CODE IN (SELECT SUB_CODE FROM T_HPA955SKR_1 WHERE KEY_VALUE = @KeyValue AND SEQ &gt;= 15 )
                                                        GROUP BY PERSON_NUMB, PAY_YYYYMM, SUPP_TYPE, COMP_CODE
                                                      ) T5 ON T5.COMP_CODE    = T1.COMP_CODE
                                                          AND T5.PERSON_NUMB = T1.PERSON_NUMB
                                                          AND T5.SUPP_TYPE       = T1.SUPP_TYPE
                                                          AND T5.PAY_YYYYMM   = T1.PAY_YYYYMM
                                                    , (
                                                        SELECT MAX(CASE WHEN A.SEQ = 1  THEN A.SUB_CODE ELSE '' END) AS D1 
                                                                 , MAX(CASE WHEN A.SEQ = 2  THEN A.SUB_CODE ELSE '' END) AS D2 
                                                                 , MAX(CASE WHEN A.SEQ = 3  THEN A.SUB_CODE ELSE '' END) AS D3 
                                                                 , MAX(CASE WHEN A.SEQ = 4  THEN A.SUB_CODE ELSE '' END) AS D4 
                                                                 , MAX(CASE WHEN A.SEQ = 5  THEN A.SUB_CODE ELSE '' END) AS D5 
                                                                 , MAX(CASE WHEN A.SEQ = 6  THEN A.SUB_CODE ELSE '' END) AS D6 
                                                                 , MAX(CASE WHEN A.SEQ = 7  THEN A.SUB_CODE ELSE '' END) AS D7 
                                                                 , MAX(CASE WHEN A.SEQ = 8  THEN A.SUB_CODE ELSE '' END) AS D8 
                                                                 , MAX(CASE WHEN A.SEQ = 9  THEN A.SUB_CODE ELSE '' END) AS D9 
                                                                 , MAX(CASE WHEN A.SEQ = 10 THEN A.SUB_CODE ELSE '' END) AS D10 
                                                                 , MAX(CASE WHEN A.SEQ = 11 THEN A.SUB_CODE ELSE '' END) AS D11 
                                                                 , MAX(CASE WHEN A.SEQ = 12 THEN A.SUB_CODE ELSE '' END) AS D12 
                                                                 , MAX(CASE WHEN A.SEQ = 13 THEN A.SUB_CODE ELSE '' END) AS D13 
                                                                 , MAX(CASE WHEN A.SEQ = 14 THEN A.SUB_CODE ELSE '' END) AS D14 
                                                                 , MAX(CASE WHEN A.SEQ = 15 THEN A.SUB_CODE ELSE '' END) AS D15 
                                                                 , MAX(CASE WHEN A.SEQ = 16 THEN A.SUB_CODE ELSE '' END) AS D16 
                                                                 , MAX(CASE WHEN A.SEQ = 17 THEN A.SUB_CODE ELSE '' END) AS D17 
                                                                 , MAX(CASE WHEN A.SEQ = 18 THEN A.SUB_CODE ELSE '' END) AS D18 
                                                                 , MAX(CASE WHEN A.SEQ = 19 THEN A.SUB_CODE ELSE '' END) AS D19 
                                                                 , MAX(CASE WHEN A.SEQ &gt;= 20 THEN 'zz' 
                                                                                   ELSE (CASE WHEN A.SEQ = 20 THEN A.SUB_CODE ELSE '' END) 
                                                                           END) AS D20
                                                         FROM T_HPA955SKR_1 A 
                                                         WHERE KEY_VALUE = @KeyValue
                                                         ) T4
                                         WHERE T1.COMP_CODE = #{S_COMP_CODE} 
                                          <if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">
                                          AND T1.SUPP_TYPE = #{SUPP_TYPE}
                                          </if>
                                         AND T1.PAY_YYYYMM &gt;= #{DATE_FR}  
                                         AND T1.PAY_YYYYMM &lt;= #{DATE_TO}  
                                         GROUP BY T1.PERSON_NUMB, T1.PAY_YYYYMM, T1.SUPP_TYPE, T1.COMP_CODE
                                    
                                    ) M3 ON M3.COMP_CODE      = M1.COMP_CODE
                                         AND  M3.PERSON_NUMB  = M1.PERSON_NUMB
                                         AND  M3.SUPP_TYPE        = M1.SUPP_TYPE
                                         AND  M3.PAY_YYYYMM    = M1.PAY_YYYYMM
                 WHERE M0.COMP_CODE = #{S_COMP_CODE}  
                 
	                 
	           	<if test="@foren.Ognl@isNotEmpty(DIV_CODE)">	     
				  	AND M1.DIV_CODE	= #{DIV_CODE}
				</if>
		        <if test="@foren.Ognl@isNotEmpty(DEPTS)">
				   AND  M1.DEPT_CODE IN
					 <foreach collection="DEPTS" item="item" separator="," close=")" open="(">
			          		 #{item}
			    	 </foreach>
				</if>
				<if test="@foren.Ognl@isNotEmpty(SUPP_TYPE)">	     
				  	AND M1.SUPP_TYPE = #{SUPP_TYPE}
			    </if>
	            <if test="@foren.Ognl@isNotEmpty(DATE_FR)">
                    AND  M1.PAY_YYYYMM &gt;= #{DATE_FR}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(DATE_TO)">
                    AND  M1.PAY_YYYYMM &lt;= #{DATE_TO}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_CODE)">
	                AND  M1.PAY_CODE = #{PAY_CODE}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_DAY_FLAG)">
	                AND  M1.PAY_PROV_FLAG = #{PAY_DAY_FLAG}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_GUBUN)">
                    AND M1.PAY_GUBUN = #{PAY_GUBUN}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PAY_GUBUN2)">
                    AND M1.PAY_GUBUN2 = #{PAY_GUBUN2}
	            </if>
	            <if test="rdoSelect4 == &quot;male&quot;">
	            	AND M0.SEX_CODE = 'M'
	            </if>
            	<if test="rdoSelect4 == &quot;female&quot;">
            		AND M0.SEX_CODE = 'F'
            	</if>
            	<if test="rdoSelect3 == &quot;hired&quot;">
	            	AND (M0.RETR_DATE = '00000000' OR M0.RETR_DATE = '')
	            </if>
            	<if test="rdoSelect3 == &quot;fired&quot;">
            		AND (M0.RETR_DATE != '00000000' AND M0.RETR_DATE != '')
            	</if>
	            <if test="@foren.Ognl@isNotEmpty(COST_POOL)">
                    AND  M1.COST_KIND = #{COST_POOL}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(EMPLOY_TYPE)">
                    AND  M1.EMPLOY_TYPE = #{EMPLOY_TYPE}
	            </if>
	            <if test="@foren.Ognl@isNotEmpty(PERSON_GROUP)">
                    AND  Z.REF_CODE1 = #{PERSON_GROUP}
	            </if>

	            	AND M1.REAL_AMOUNT_I &gt; 0
	            	AND (M1.REAL_AMOUNT_I &gt; 0 OR M1.REAL_AMOUNT_I &lt;0 )
           
           		GROUP BY M1.COMP_CODE, M1.PAY_YYYYMM, M1.SUPP_TYPE, M1.DIV_CODE, M1.POST_CODE
           		ORDER BY M1.COMP_CODE, M1.PAY_YYYYMM, M1.SUPP_TYPE, M1.DIV_CODE, M1.POST_CODE;
                
			</otherwise>
		</choose>
		
        /* 사업장별 합계 INSERT */
         INSERT INTO T_HPA955SKR_4
               (KEY_VALUE,    GUBUN           , COMP_CODE       , PAY_YYYYMM        , SUPP_TYPE     , SUPP_NAME     , DIV_CODE          , DEPT_CODE
              , DEPT_NAME       , PERSON_CNT    , SUPP_TOTAL_I      , DED_TOTAL_I   , REAL_AMOUNT_I , BUSI_SHARE_I      , WORKER_COMPEN_I

              , S1              , S2            , S3                , S4            , S5
              , S6              , S7            , S8                , S9            , S10
              , S11             , S12           , S13               , S14           , S15
              , S16             , S17           , S18               , S19           , S20
              , S21             , S22           , S23               , S24           , S25
              , S26             , S27           , S28               , S29           , S30
              , S31             , S32           , S33               , S34           , S35
              , S36             , S37           , S38               , S39           , S40
        
              , D1              , D2            , D3                , D4            , D5
              , D6              , D7            , D8                , D9            , D10
              , D11             , D12           , D13               , D14           , D15
              , D16             , D17           , D18               , D19           , D20
               )
         SELECT  KEY_VALUE
                ,  '2'                                  AS GUBUN
                , COMP_CODE                             AS COMP_CODE
                , PAY_YYYYMM                            AS PAY_YYYYMM
                , SUPP_TYPE                             AS SUPP_TYPE
                , SUPP_NAME                             AS SUPP_NAME 
                , DIV_CODE                              AS DIV_CODE
                , 'Z'                                   AS DEPT_CODE
                , ''                                    AS DEPT_NAME
                , NVL(SUM( PERSON_CNT ),0)          AS PERSON_CNT
                , NVL(SUM( SUPP_TOTAL_I ),0)            AS SUPP_TOTAL_I
                , NVL(SUM( DED_TOTAL_I ),0)         AS DED_TOTAL_I 
                , NVL(SUM( REAL_AMOUNT_I ),0)       AS REAL_AMOUNT_I
                , NVL(SUM( BUSI_SHARE_I ),0)            AS BUSI_SHARE_I
                , NVL(SUM( WORKER_COMPEN_I ),0)     AS WORKER_COMPEN_I
                , NVL(SUM( S1 ),0)                  AS S1
                , NVL(SUM( S2 ),0)                  AS S2
                , NVL(SUM( S3 ),0)                  AS S3
                , NVL(SUM( S4 ),0)                  AS S4
                , NVL(SUM( S5 ),0)                  AS S5
                , NVL(SUM( S6 ),0)                  AS S6
                , NVL(SUM( S7 ),0)                  AS S7
                , NVL(SUM( S8 ),0)                  AS S8
                , NVL(SUM( S9 ),0)                  AS S9
                , NVL(SUM( S10 ),0)                 AS S10
                , NVL(SUM( S11 ),0)                 AS S11
                , NVL(SUM( S12 ),0)                 AS S12
                , NVL(SUM( S13 ),0)                 AS S13
                , NVL(SUM( S14 ),0)                 AS S14
                , NVL(SUM( S15 ),0)                 AS S15
                , NVL(SUM( S16 ),0)                 AS S16
                , NVL(SUM( S17 ),0)                 AS S17
                , NVL(SUM( S18 ),0)                 AS S18
                , NVL(SUM( S19 ),0)                 AS S19
                , NVL(SUM( S20 ),0)                 AS S20
                , NVL(SUM( S21 ),0)                 AS S21
                , NVL(SUM( S22 ),0)                 AS S22
                , NVL(SUM( S23 ),0)                 AS S23
                , NVL(SUM( S24 ),0)                 AS S24
                , NVL(SUM( S25 ),0)                 AS S25
                , NVL(SUM( S26 ),0)                 AS S26
                , NVL(SUM( S27 ),0)                 AS S27
                , NVL(SUM( S28 ),0)                 AS S28
                , NVL(SUM( S29 ),0)                 AS S29
                , NVL(SUM( S30 ),0)                 AS S30
                , NVL(SUM( S31 ),0)                 AS S31
                , NVL(SUM( S32 ),0)                 AS S32
                , NVL(SUM( S33 ),0)                 AS S33
                , NVL(SUM( S34 ),0)                 AS S34
                , NVL(SUM( S35 ),0)                 AS S35
                , NVL(SUM( S36 ),0)                 AS S36
                , NVL(SUM( S37 ),0)                 AS S37
                , NVL(SUM( S38 ),0)                 AS S38
                , NVL(SUM( S39 ),0)                 AS S39
                , NVL(SUM( S40 ),0)                 AS S40
                
                , NVL(SUM( D1 ),0)                  AS D1
                , NVL(SUM( D2 ),0)                  AS D2
                , NVL(SUM( D3 ),0)                  AS D3
                , NVL(SUM( D4 ),0)                  AS D4
                , NVL(SUM( D5 ),0)                  AS D5
                , NVL(SUM( D6 ),0)                  AS D6
                , NVL(SUM( D7 ),0)                  AS D7
                , NVL(SUM( D8 ),0)                  AS D8
                , NVL(SUM( D9 ),0)                  AS D9
                , NVL(SUM( D10 ),0)                 AS D10
                , NVL(SUM( D11 ),0)                 AS D11
                , NVL(SUM( D12 ),0)                 AS D12
                , NVL(SUM( D13 ),0)                 AS D13
                , NVL(SUM( D14 ),0)                 AS D14
                , NVL(SUM( D15 ),0)                 AS D15
                , NVL(SUM( D16 ),0)                 AS D16
                , NVL(SUM( D17 ),0)                 AS D17
                , NVL(SUM( D18 ),0)                 AS D18
                , NVL(SUM( D19 ),0)                 AS D19
                , NVL(SUM( D20 ),0)                 AS D20
          FROM T_HPA955SKR_4
         WHERE KEY_VALUE = @KeyValue
         AND     GUBUN = '1'
         GROUP BY KEY_VALUE, COMP_CODE, PAY_YYYYMM, SUPP_TYPE, SUPP_NAME, DIV_CODE
         ORDER BY COMP_CODE, PAY_YYYYMM, SUPP_TYPE, DIV_CODE, DEPT_CODE;

        /* 지급구분별 합계 INSERT */
         INSERT INTO T_HPA955SKR_4
               (KEY_VALUE, GUBUN           , COMP_CODE      , PAY_YYYYMM        , SUPP_TYPE     , SUPP_NAME     , DIV_CODE          , DEPT_CODE
              , DEPT_NAME       , PERSON_CNT    , SUPP_TOTAL_I      , DED_TOTAL_I   , REAL_AMOUNT_I , BUSI_SHARE_I      , WORKER_COMPEN_I

              , S1              , S2            , S3                , S4            , S5
              , S6              , S7            , S8                , S9            , S10
              , S11             , S12           , S13               , S14           , S15
              , S16             , S17           , S18               , S19           , S20
              , S21             , S22           , S23               , S24           , S25
              , S26             , S27           , S28               , S29           , S30
              , S31             , S32           , S33               , S34           , S35
              , S36             , S37           , S38               , S39           , S40
        
              , D1              , D2            , D3                , D4            , D5
              , D6              , D7            , D8                , D9            , D10
              , D11             , D12           , D13               , D14           , D15
              , D16             , D17           , D18               , D19           , D20
               )
         SELECT  KEY_VALUE
                , '3'                                   AS GUBUN
                , COMP_CODE                             AS COMP_CODE
                , PAY_YYYYMM                            AS PAY_YYYYMM
                , SUPP_TYPE                             AS SUPP_TYPE
                , SUPP_NAME                             AS SUPP_NAME 
                , 'Z'                                   AS DIV_CODE
                , 'Z'                                   AS DEPT_CODE
                , ''                                    AS DEPT_NAME
                , NVL(SUM( PERSON_CNT ),0)          AS PERSON_CNT
                , NVL(SUM( SUPP_TOTAL_I ),0)            AS SUPP_TOTAL_I
                , NVL(SUM( DED_TOTAL_I ),0)         AS DED_TOTAL_I 
                , NVL(SUM( REAL_AMOUNT_I ),0)       AS REAL_AMOUNT_I
                , NVL(SUM( BUSI_SHARE_I ),0)            AS BUSI_SHARE_I
                , NVL(SUM( WORKER_COMPEN_I ),0)     AS WORKER_COMPEN_I
                , NVL(SUM( S1 ),0)                  AS S1
                , NVL(SUM( S2 ),0)                  AS S2
                , NVL(SUM( S3 ),0)                  AS S3
                , NVL(SUM( S4 ),0)                  AS S4
                , NVL(SUM( S5 ),0)                  AS S5
                , NVL(SUM( S6 ),0)                  AS S6
                , NVL(SUM( S7 ),0)                  AS S7
                , NVL(SUM( S8 ),0)                  AS S8
                , NVL(SUM( S9 ),0)                  AS S9
                , NVL(SUM( S10 ),0)                 AS S10
                , NVL(SUM( S11 ),0)                 AS S11
                , NVL(SUM( S12 ),0)                 AS S12
                , NVL(SUM( S13 ),0)                 AS S13
                , NVL(SUM( S14 ),0)                 AS S14
                , NVL(SUM( S15 ),0)                 AS S15
                , NVL(SUM( S16 ),0)                 AS S16
                , NVL(SUM( S17 ),0)                 AS S17
                , NVL(SUM( S18 ),0)                 AS S18
                , NVL(SUM( S19 ),0)                 AS S19
                , NVL(SUM( S20 ),0)                 AS S20
                , NVL(SUM( S21 ),0)                 AS S21
                , NVL(SUM( S22 ),0)                 AS S22
                , NVL(SUM( S23 ),0)                 AS S23
                , NVL(SUM( S24 ),0)                 AS S24
                , NVL(SUM( S25 ),0)                 AS S25
                , NVL(SUM( S26 ),0)                 AS S26
                , NVL(SUM( S27 ),0)                 AS S27
                , NVL(SUM( S28 ),0)                 AS S28
                , NVL(SUM( S29 ),0)                 AS S29
                , NVL(SUM( S30 ),0)                 AS S30
                , NVL(SUM( S31 ),0)                 AS S31
                , NVL(SUM( S32 ),0)                 AS S32
                , NVL(SUM( S33 ),0)                 AS S33
                , NVL(SUM( S34 ),0)                 AS S34
                , NVL(SUM( S35 ),0)                 AS S35
                , NVL(SUM( S36 ),0)                 AS S36
                , NVL(SUM( S37 ),0)                 AS S37
                , NVL(SUM( S38 ),0)                 AS S38
                , NVL(SUM( S39 ),0)                 AS S39
                , NVL(SUM( S40 ),0)                 AS S40
                
                , NVL(SUM( D1 ),0)                  AS D1
                , NVL(SUM( D2 ),0)                  AS D2
                , NVL(SUM( D3 ),0)                  AS D3
                , NVL(SUM( D4 ),0)                  AS D4
                , NVL(SUM( D5 ),0)                  AS D5
                , NVL(SUM( D6 ),0)                  AS D6
                , NVL(SUM( D7 ),0)                  AS D7
                , NVL(SUM( D8 ),0)                  AS D8
                , NVL(SUM( D9 ),0)                  AS D9
                , NVL(SUM( D10 ),0)                 AS D10
                , NVL(SUM( D11 ),0)                 AS D11
                , NVL(SUM( D12 ),0)                 AS D12
                , NVL(SUM( D13 ),0)                 AS D13
                , NVL(SUM( D14 ),0)                 AS D14
                , NVL(SUM( D15 ),0)                 AS D15
                , NVL(SUM( D16 ),0)                 AS D16
                , NVL(SUM( D17 ),0)                 AS D17
                , NVL(SUM( D18 ),0)                 AS D18
                , NVL(SUM( D19 ),0)                 AS D19
                , NVL(SUM( D20 ),0)                 AS D20
          FROM T_HPA955SKR_4          
         WHERE KEY_VALUE = @KeyValue
         AND    GUBUN = '1'
         GROUP BY KEY_VALUE, COMP_CODE, PAY_YYYYMM, SUPP_TYPE, SUPP_NAME
         ORDER BY COMP_CODE, PAY_YYYYMM, SUPP_TYPE, DIV_CODE, DEPT_CODE, GUBUN;
         
        /* 지급일별 합계 INSERT */
         INSERT INTO T_HPA955SKR_4
               (KEY_VALUE,   GUBUN           , COMP_CODE        , PAY_YYYYMM        , SUPP_TYPE     , SUPP_NAME     , DIV_CODE          , DEPT_CODE
              , DEPT_NAME       , PERSON_CNT    , SUPP_TOTAL_I      , DED_TOTAL_I   , REAL_AMOUNT_I , BUSI_SHARE_I      , WORKER_COMPEN_I

              , S1              , S2            , S3                , S4            , S5
              , S6              , S7            , S8                , S9            , S10
              , S11             , S12           , S13               , S14           , S15
              , S16             , S17           , S18               , S19           , S20
              , S21             , S22           , S23               , S24           , S25
              , S26             , S27           , S28               , S29           , S30
              , S31             , S32           , S33               , S34           , S35
              , S36             , S37           , S38               , S39           , S40
        
              , D1              , D2            , D3                , D4            , D5
              , D6              , D7            , D8                , D9            , D10
              , D11             , D12           , D13               , D14           , D15
              , D16             , D17           , D18               , D19           , D20
               )
         SELECT  KEY_VALUE
                ,  '4'                                  AS GUBUN
                , COMP_CODE                             AS COMP_CODE
                , PAY_YYYYMM                            AS PAY_YYYYMM
                , 'Z'                                   AS SUPP_TYPE
                , ''                                    AS SUPP_NAME 
                , 'Z'                                   AS DIV_CODE
                , 'Z'                                   AS DEPT_CODE
                , ''                                    AS DEPT_NAME
                , NVL(SUM( PERSON_CNT ),0)          AS PERSON_CNT
                , NVL(SUM( SUPP_TOTAL_I ),0)            AS SUPP_TOTAL_I
                , NVL(SUM( DED_TOTAL_I ),0)         AS DED_TOTAL_I 
                , NVL(SUM( REAL_AMOUNT_I ),0)       AS REAL_AMOUNT_I
                , NVL(SUM( BUSI_SHARE_I ),0)            AS BUSI_SHARE_I
                , NVL(SUM( WORKER_COMPEN_I ),0)     AS WORKER_COMPEN_I
                , NVL(SUM( S1 ),0)                  AS S1
                , NVL(SUM( S2 ),0)                  AS S2
                , NVL(SUM( S3 ),0)                  AS S3
                , NVL(SUM( S4 ),0)                  AS S4
                , NVL(SUM( S5 ),0)                  AS S5
                , NVL(SUM( S6 ),0)                  AS S6
                , NVL(SUM( S7 ),0)                  AS S7
                , NVL(SUM( S8 ),0)                  AS S8
                , NVL(SUM( S9 ),0)                  AS S9
                , NVL(SUM( S10 ),0)                 AS S10
                , NVL(SUM( S11 ),0)                 AS S11
                , NVL(SUM( S12 ),0)                 AS S12
                , NVL(SUM( S13 ),0)                 AS S13
                , NVL(SUM( S14 ),0)                 AS S14
                , NVL(SUM( S15 ),0)                 AS S15
                , NVL(SUM( S16 ),0)                 AS S16
                , NVL(SUM( S17 ),0)                 AS S17
                , NVL(SUM( S18 ),0)                 AS S18
                , NVL(SUM( S19 ),0)                 AS S19
                , NVL(SUM( S20 ),0)                 AS S20
                , NVL(SUM( S21 ),0)                 AS S21
                , NVL(SUM( S22 ),0)                 AS S22
                , NVL(SUM( S23 ),0)                 AS S23
                , NVL(SUM( S24 ),0)                 AS S24
                , NVL(SUM( S25 ),0)                 AS S25
                , NVL(SUM( S26 ),0)                 AS S26
                , NVL(SUM( S27 ),0)                 AS S27
                , NVL(SUM( S28 ),0)                 AS S28
                , NVL(SUM( S29 ),0)                 AS S29
                , NVL(SUM( S30 ),0)                 AS S30
                , NVL(SUM( S31 ),0)                 AS S31
                , NVL(SUM( S32 ),0)                 AS S32
                , NVL(SUM( S33 ),0)                 AS S33
                , NVL(SUM( S34 ),0)                 AS S34
                , NVL(SUM( S35 ),0)                 AS S35
                , NVL(SUM( S36 ),0)                 AS S36
                , NVL(SUM( S37 ),0)                 AS S37
                , NVL(SUM( S38 ),0)                 AS S38
                , NVL(SUM( S39 ),0)                 AS S39
                , NVL(SUM( S40 ),0)                 AS S40
                
                , NVL(SUM( D1 ),0)                  AS D1
                , NVL(SUM( D2 ),0)                  AS D2
                , NVL(SUM( D3 ),0)                  AS D3
                , NVL(SUM( D4 ),0)                  AS D4
                , NVL(SUM( D5 ),0)                  AS D5
                , NVL(SUM( D6 ),0)                  AS D6
                , NVL(SUM( D7 ),0)                  AS D7
                , NVL(SUM( D8 ),0)                  AS D8
                , NVL(SUM( D9 ),0)                  AS D9
                , NVL(SUM( D10 ),0)                 AS D10
                , NVL(SUM( D11 ),0)                 AS D11
                , NVL(SUM( D12 ),0)                 AS D12
                , NVL(SUM( D13 ),0)                 AS D13
                , NVL(SUM( D14 ),0)                 AS D14
                , NVL(SUM( D15 ),0)                 AS D15
                , NVL(SUM( D16 ),0)                 AS D16
                , NVL(SUM( D17 ),0)                 AS D17
                , NVL(SUM( D18 ),0)                 AS D18
                , NVL(SUM( D19 ),0)                 AS D19
                , NVL(SUM( D20 ),0)                 AS D20
          FROM T_HPA955SKR_4
         WHERE KEY_VALUE = @KeyValue
         AND    GUBUN = '1'
         GROUP BY KEY_VALUE, COMP_CODE, PAY_YYYYMM
         ORDER BY COMP_CODE, PAY_YYYYMM, SUPP_TYPE, DIV_CODE, DEPT_CODE, GUBUN;

        /* 총계 INSERT */
         INSERT INTO T_HPA955SKR_4
               (KEY_VALUE, GUBUN           , COMP_CODE      , PAY_YYYYMM        , SUPP_TYPE     , SUPP_NAME     , DIV_CODE          , DEPT_CODE
              , DEPT_NAME       , PERSON_CNT    , SUPP_TOTAL_I      , DED_TOTAL_I   , REAL_AMOUNT_I , BUSI_SHARE_I      , WORKER_COMPEN_I

              , S1              , S2            , S3                , S4            , S5
              , S6              , S7            , S8                , S9            , S10
              , S11             , S12           , S13               , S14           , S15
              , S16             , S17           , S18               , S19           , S20
              , S21             , S22           , S23               , S24           , S25
              , S26             , S27           , S28               , S29           , S30
              , S31             , S32           , S33               , S34           , S35
              , S36             , S37           , S38               , S39           , S40
        
              , D1              , D2            , D3                , D4            , D5
              , D6              , D7            , D8                , D9            , D10
              , D11             , D12           , D13               , D14           , D15
              , D16             , D17           , D18               , D19           , D20
               )
         SELECT  KEY_VALUE
                , '5'                                   AS GUBUN
                , COMP_CODE                             AS COMP_CODE
                , '999999'                              AS PAY_YYYYMM
                , 'Z'                                   AS SUPP_TYPE
                , ''                                    AS SUPP_NAME 
                , 'Z'                                   AS DIV_CODE
                , 'Z'                                   AS DEPT_CODE
                , ''                                    AS DEPT_NAME
                , NVL(SUM( PERSON_CNT ),0)          AS PERSON_CNT
                , NVL(SUM( SUPP_TOTAL_I ),0)            AS SUPP_TOTAL_I
                , NVL(SUM( DED_TOTAL_I ),0)         AS DED_TOTAL_I 
                , NVL(SUM( REAL_AMOUNT_I ),0)       AS REAL_AMOUNT_I
                , NVL(SUM( BUSI_SHARE_I ),0)            AS BUSI_SHARE_I
                , NVL(SUM( WORKER_COMPEN_I ),0)     AS WORKER_COMPEN_I
                , NVL(SUM( S1 ),0)                  AS S1
                , NVL(SUM( S2 ),0)                  AS S2
                , NVL(SUM( S3 ),0)                  AS S3
                , NVL(SUM( S4 ),0)                  AS S4
                , NVL(SUM( S5 ),0)                  AS S5
                , NVL(SUM( S6 ),0)                  AS S6
                , NVL(SUM( S7 ),0)                  AS S7
                , NVL(SUM( S8 ),0)                  AS S8
                , NVL(SUM( S9 ),0)                  AS S9
                , NVL(SUM( S10 ),0)                 AS S10
                , NVL(SUM( S11 ),0)                 AS S11
                , NVL(SUM( S12 ),0)                 AS S12
                , NVL(SUM( S13 ),0)                 AS S13
                , NVL(SUM( S14 ),0)                 AS S14
                , NVL(SUM( S15 ),0)                 AS S15
                , NVL(SUM( S16 ),0)                 AS S16
                , NVL(SUM( S17 ),0)                 AS S17
                , NVL(SUM( S18 ),0)                 AS S18
                , NVL(SUM( S19 ),0)                 AS S19
                , NVL(SUM( S20 ),0)                 AS S20
                , NVL(SUM( S21 ),0)                 AS S21
                , NVL(SUM( S22 ),0)                 AS S22
                , NVL(SUM( S23 ),0)                 AS S23
                , NVL(SUM( S24 ),0)                 AS S24
                , NVL(SUM( S25 ),0)                 AS S25
                , NVL(SUM( S26 ),0)                 AS S26
                , NVL(SUM( S27 ),0)                 AS S27
                , NVL(SUM( S28 ),0)                 AS S28
                , NVL(SUM( S29 ),0)                 AS S29
                , NVL(SUM( S30 ),0)                 AS S30
                , NVL(SUM( S31 ),0)                 AS S31
                , NVL(SUM( S32 ),0)                 AS S32
                , NVL(SUM( S33 ),0)                 AS S33
                , NVL(SUM( S34 ),0)                 AS S34
                , NVL(SUM( S35 ),0)                 AS S35
                , NVL(SUM( S36 ),0)                 AS S36
                , NVL(SUM( S37 ),0)                 AS S37
                , NVL(SUM( S38 ),0)                 AS S38
                , NVL(SUM( S39 ),0)                 AS S39
                , NVL(SUM( S40 ),0)                 AS S40
                
                , NVL(SUM( D1 ),0)                  AS D1
                , NVL(SUM( D2 ),0)                  AS D2
                , NVL(SUM( D3 ),0)                  AS D3
                , NVL(SUM( D4 ),0)                  AS D4
                , NVL(SUM( D5 ),0)                  AS D5
                , NVL(SUM( D6 ),0)                  AS D6
                , NVL(SUM( D7 ),0)                  AS D7
                , NVL(SUM( D8 ),0)                  AS D8
                , NVL(SUM( D9 ),0)                  AS D9
                , NVL(SUM( D10 ),0)                 AS D10
                , NVL(SUM( D11 ),0)                 AS D11
                , NVL(SUM( D12 ),0)                 AS D12
                , NVL(SUM( D13 ),0)                 AS D13
                , NVL(SUM( D14 ),0)                 AS D14
                , NVL(SUM( D15 ),0)                 AS D15
                , NVL(SUM( D16 ),0)                 AS D16
                , NVL(SUM( D17 ),0)                 AS D17
                , NVL(SUM( D18 ),0)                 AS D18
                , NVL(SUM( D19 ),0)                 AS D19
                , NVL(SUM( D20 ),0)                 AS D20
          FROM T_HPA955SKR_4
         WHERE KEY_VALUE = @KeyValue
         AND    GUBUN = '1'
         GROUP BY KEY_VALUE, COMP_CODE
         ORDER BY COMP_CODE, PAY_YYYYMM, SUPP_TYPE, DIV_CODE, DEPT_CODE, GUBUN;
         
        /* Data 불러오기 */
        SELECT * 
        FROM T_HPA955SKR_4
        WHERE KEY_VALUE = @KeyValue
        ORDER BY COMP_CODE, PAY_YYYYMM, SUPP_TYPE, DIV_CODE, DEPT_CODE, GUBUN;
        
        DROP TABLE T_HPA955SKR_1;
        DROP TABLE T_HPA955SKR_2;
        DROP TABLE T_HPA955SKR_3;
        DROP TABLE T_HPA955SKR_4;           
			
	</select>
	
</mapper>