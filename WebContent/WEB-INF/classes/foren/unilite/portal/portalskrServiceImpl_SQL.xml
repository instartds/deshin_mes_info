<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="portalskrServiceImpl">

	<select id="portalskrServiceImpl.selectList" parameterType="Map" resultType="rMap">
/* portalskrvServiceImpl.selectList */
		SELECT A.BULLETIN_ID
			  ,A.FROM_DATE
			  ,A.TO_DATE
			  ,A.USER_ID
		      ,A.TYPE_FLAG
		      ,A.AUTH_FLAG
		      ,A.DIV_CODE
		      ,A.DEPT_CODE
		      ,A.OFFICE_CODE
		      ,A.TITLE
		      ,A.CONTENTS
		      ,A.ACCESS_CNT
			  ,A.UPDATE_DB_TIME
			  ,A.UPDATE_DB_USER
		      ,B.TREE_NAME AS DEPT_NAME
		 FROM 			BSA600T A WITH (NOLOCK)
		 	LEFT  JOIN  BSA210T B WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
	                                           AND B.TREE_CODE    = A.DEPT_CODE
		WHERE A.COMP_CODE = #{S_COMP_CODE}

		  AND A.AUTH_FLAG = '1'

UNION ALL


		SELECT A.BULLETIN_ID
			  ,A.FROM_DATE
			  ,A.TO_DATE
			  ,A.USER_ID
		      ,A.TYPE_FLAG
		      ,A.AUTH_FLAG
		      ,A.DIV_CODE
		      ,A.DEPT_CODE
		      ,A.OFFICE_CODE
		      ,A.TITLE
		      ,A.CONTENTS
		      ,A.ACCESS_CNT
			  ,A.UPDATE_DB_TIME
			  ,A.UPDATE_DB_USER
		      ,B.TREE_NAME AS DEPT_NAME
		 FROM 			BSA600T A WITH (NOLOCK)
		 	LEFT  JOIN  BSA210T B WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
	                                           AND B.TREE_CODE    = A.DEPT_CODE
		WHERE A.COMP_CODE = #{S_COMP_CODE}

		  AND A.AUTH_FLAG = '2'

		  AND A.DIV_CODE = #{S_DIV_CODE}

UNION ALL


		SELECT A.BULLETIN_ID
			  ,A.FROM_DATE
			  ,A.TO_DATE
			  ,A.USER_ID
		      ,A.TYPE_FLAG
		      ,A.AUTH_FLAG
		      ,A.DIV_CODE
		      ,A.DEPT_CODE
		      ,A.OFFICE_CODE
		      ,A.TITLE
		      ,A.CONTENTS
		      ,A.ACCESS_CNT
			  ,A.UPDATE_DB_TIME
			  ,A.UPDATE_DB_USER
		      ,B.TREE_NAME AS DEPT_NAME
		 FROM 			BSA600T A WITH (NOLOCK)
		 	LEFT  JOIN  BSA210T B WITH (NOLOCK) ON B.COMP_CODE    = A.COMP_CODE
	                                           AND B.TREE_CODE    = A.DEPT_CODE
		WHERE A.COMP_CODE = #{S_COMP_CODE}

		  AND A.AUTH_FLAG = '3'

		  AND A.DEPT_CODE = #{S_DEPT_CODE}






		ORDER BY BULLETIN_ID DESC
	</select>

<!-- 20210830 추가: 정규 -->
	<select id="portalskrServiceImpl.SelectList1" parameterType="Map" resultType="rMap">
		/* portalskrServiceImpl.SelectList1 */
		SELECT
			B.OUT_DIV_CODE
			,R1.DIV_NAME +' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(B.ORDER_O),0) ), 1 ),'.00','') AS DIV_NAME
			,SUM(B.ORDER_O) AS ORDER_O
		  FROM SOF100T A WITH(NOLOCK)
    INNER JOIN SOF110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								     AND B.DIV_CODE = A.DIV_CODE
								     AND B.ORDER_NUM = A.ORDER_NUM
LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
								 AND R1.DIV_CODE = B.OUT_DIV_CODE
		 WHERE A.COMP_CODE = #{S_COMP_CODE}
		   AND A.ORDER_DATE LIKE #{BASIS_YM} + '%'
		   GROUP BY B.OUT_DIV_CODE ,R1.DIV_NAME

		   ORDER BY B.OUT_DIV_CODE
	</select>
	<select id="portalskrServiceImpl.SelectList2" parameterType="Map" resultType="rMap">
		/* portalskrServiceImpl.SelectList2 */
	SELECT A.OUT_DIV_CODE
		 , A.DIV_NAME+' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(A.ORDER_O),0) ), 1 ),'.00','') AS DIV_NAME
		 , SUM(A.ORDER_O) AS ORDER_O
	  FROM (
			SELECT B.OUT_DIV_CODE
				 , R1.DIV_NAME
				 , SUM((B.ORDER_UNIT_Q - B.OUTSTOCK_Q) * B.ORDER_P / B.TRANS_RATE) AS ORDER_O
			  FROM SOF100T A WITH(NOLOCK)
		INNER JOIN SOF110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
										 AND B.DIV_CODE  = A.DIV_CODE
										 AND B.ORDER_NUM = A.ORDER_NUM
		 LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
										  AND R1.DIV_CODE  = B.OUT_DIV_CODE
			 WHERE A.COMP_CODE = #{S_COMP_CODE}
			   AND B.DVRY_DATE LIKE #{BASIS_YM} + '%'
		  GROUP BY B.OUT_DIV_CODE, R1.DIV_NAME

	UNION

			SELECT B.OUT_DIV_CODE
				 , R1.DIV_NAME
				 , SUM(B.SALE_AMT_O) AS SALE_AMT_O
			  FROM SSA100T A WITH(NOLOCK)
		INNER JOIN SSA110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
										 AND B.DIV_CODE  = A.DIV_CODE
										 AND B.BILL_NUM  = A.BILL_NUM
		 LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
										  AND R1.DIV_CODE  = B.OUT_DIV_CODE
			 WHERE A.COMP_CODE = #{S_COMP_CODE}
			   AND A.SALE_DATE LIKE #{BASIS_YM} + '%'
		  GROUP BY B.OUT_DIV_CODE, R1.DIV_NAME
			) A
  GROUP BY A.OUT_DIV_CODE, A.DIV_NAME
  ORDER BY A.OUT_DIV_CODE
	</select>
	<select id="portalskrServiceImpl.SelectList3" parameterType="Map" resultType="rMap">
		/* portalskrServiceImpl.SelectList3 */
SELECT
	B.OUT_DIV_CODE
	,R1.DIV_NAME +' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(B.SALE_AMT_O),0) ), 1 ),'.00','')AS DIV_NAME
	,SUM(B.SALE_AMT_O)  AS SALE_AMT_O
	FROM SSA100T A WITH(NOLOCK)
				INNER JOIN SSA110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
												AND B.DIV_CODE = A.DIV_CODE
												AND B.BILL_NUM = A.BILL_NUM
				LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
												 AND R1.DIV_CODE = B.OUT_DIV_CODE

 WHERE A.COMP_CODE = #{S_COMP_CODE}
   AND A.SALE_DATE LIKE #{BASIS_YM} + '%'
   GROUP BY B.OUT_DIV_CODE ,R1.DIV_NAME

   ORDER BY B.OUT_DIV_CODE
	</select>
	<select id="portalskrServiceImpl.SelectList4" parameterType="Map" resultType="rMap">
		/* portalskrServiceImpl.SelectList4 */
SELECT
	A.COMP_CODE
	,A.DIV_CODE
	,C.DIV_NAME +' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(A.GOOD_PRODT_Q),0) ), 1 ),'.00','')AS DIV_NAME
	,ROUND(SUM(A.GOOD_PRODT_Q),0) AS GOOD_PRODT_Q
  FROM PMR200T A WITH(NOLOCK)
LEFT JOIN BPR200T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								AND B.DIV_CODE = A.DIV_CODE
								AND B.ITEM_CODE = A.ITEM_CODE
LEFT JOIN BOR120T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
								 AND C.DIV_CODE = A.DIV_CODE
WHERE A.COMP_CODE = #{S_COMP_CODE}
  AND B.ITEM_ACCOUNT IN ('10', '50') --제품, 반제품
  AND A.PRODT_DATE LIKE #{BASIS_YM} + '%'
  AND A.WORK_SHOP_CODE != 'WSK15' --충전작업장 제외
GROUP BY A.COMP_CODE,A.DIV_CODE ,C.DIV_NAME

ORDER BY A.DIV_CODE

	</select>
	<select id="portalskrServiceImpl.SelectList5" parameterType="Map" resultType="rMap">
		/* portalskrServiceImpl.SelectList5 */
SELECT
	A.COMP_CODE
	,ISNULL(D.LEVEL_NAME,'') AS ITEM_LEVEL1_NAME
	,SUM(A.GOOD_PRODT_Q) AS GOOD_PRODT_Q
	,REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, SUM(A.GOOD_PRODT_Q) ), 1 ),'.00','') AS GOOD_PRODT_Q_FORMAT
  FROM PMR200T A WITH(NOLOCK)
LEFT JOIN BPR200T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								AND B.DIV_CODE = A.DIV_CODE
								AND B.ITEM_CODE = A.ITEM_CODE
INNER JOIN BPR100T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
								 AND C.ITEM_CODE = A.ITEM_CODE

LEFT JOIN BPR000T  D WITH (NOLOCK) ON D.COMP_CODE	= C.COMP_CODE
								   AND D.LEVEL1 != '*'
								   AND D.LEVEL1 = C.ITEM_LEVEL1
								   AND D.LEVEL2 = '*'
								   AND D.LEVEL3 = '*'

WHERE A.COMP_CODE = #{S_COMP_CODE}
  AND A.DIV_CODE = #{DIV_CODE}
  AND B.ITEM_ACCOUNT IN ('10', '50') --제품, 반제품
  AND A.PRODT_DATE LIKE #{BASIS_YM} + '%'
  AND A.WORK_SHOP_CODE != 'WSK15' --충전사업장 제외
GROUP BY A.COMP_CODE,C.ITEM_LEVEL1,D.LEVEL_NAME

ORDER BY SUM(A.GOOD_PRODT_Q) ASC

	</select>
	
	<select id="portalskrServiceImpl.getDivcode" parameterType="Map" resultType="rMap">
		/* portalskrServiceImpl.getDivcode */
		SELECT DIV_NAME
		  FROM BOR120T
		 WHERE COMP_CODE = #{S_COMP_CODE}
	</select>


<!-- 코디 전용 -->
	<select id="portalskrServiceImpl.kodiSelectList1" parameterType="Map" resultType="rMap">
		SELECT
			B.OUT_DIV_CODE
			,R1.DIV_NAME +' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(B.ORDER_O),0) ), 1 ),'.00','') AS DIV_NAME
			,SUM(B.ORDER_O) AS ORDER_O
		  FROM SOF100T A WITH(NOLOCK)
    INNER JOIN SOF110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								     AND B.DIV_CODE = A.DIV_CODE
								     AND B.ORDER_NUM = A.ORDER_NUM
LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
								 AND R1.DIV_CODE = B.OUT_DIV_CODE
		 WHERE A.COMP_CODE = #{S_COMP_CODE}
		   AND A.ORDER_DATE LIKE #{BASIS_YM} + '%'
		   GROUP BY B.OUT_DIV_CODE ,R1.DIV_NAME

		   ORDER BY B.OUT_DIV_CODE
	</select>
	<select id="portalskrServiceImpl.kodiSelectList2" parameterType="Map" resultType="rMap">
	SELECT A.OUT_DIV_CODE, A.DIV_NAME+' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(A.ORDER_O),0) ), 1 ),'.00','')AS DIV_NAME
		, SUM(A.ORDER_O) AS ORDER_O
	FROM (
   SELECT
    B.OUT_DIV_CODE
    ,R1.DIV_NAME
    ,SUM((B.ORDER_UNIT_Q - B.OUTSTOCK_Q) * B.ORDER_P / B.TRANS_RATE) AS ORDER_O
  FROM SOF100T A WITH(NOLOCK)
  INNER JOIN SOF110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
     AND B.DIV_CODE = A.DIV_CODE
     AND B.ORDER_NUM = A.ORDER_NUM
  LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
    AND R1.DIV_CODE = B.OUT_DIV_CODE
    WHERE A.COMP_CODE = #{S_COMP_CODE}
   AND B.DVRY_DATE LIKE #{BASIS_YM} + '%'
 GROUP BY B.OUT_DIV_CODE ,R1.DIV_NAME

 UNION

  SELECT
  B.OUT_DIV_CODE
  ,R1.DIV_NAME
  ,SUM(B.SALE_AMT_O)  AS SALE_AMT_O
  FROM SSA100T A WITH(NOLOCK)
  INNER JOIN SSA110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
    AND B.DIV_CODE = A.DIV_CODE
    AND B.BILL_NUM = A.BILL_NUM
  LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
     AND R1.DIV_CODE = B.OUT_DIV_CODE

  WHERE A.COMP_CODE = #{S_COMP_CODE}
    AND A.SALE_DATE LIKE #{BASIS_YM} + '%'
 GROUP BY B.OUT_DIV_CODE ,R1.DIV_NAME
   ) A
GROUP BY A.OUT_DIV_CODE ,A.DIV_NAME
ORDER BY A.OUT_DIV_CODE
	</select>
	<select id="portalskrServiceImpl.kodiSelectList3" parameterType="Map" resultType="rMap">
SELECT
	B.OUT_DIV_CODE
	,R1.DIV_NAME +' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(B.SALE_AMT_O),0) ), 1 ),'.00','')AS DIV_NAME
	,SUM(B.SALE_AMT_O)  AS SALE_AMT_O
	FROM SSA100T A WITH(NOLOCK)
				INNER JOIN SSA110T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
												AND B.DIV_CODE = A.DIV_CODE
												AND B.BILL_NUM = A.BILL_NUM
				LEFT JOIN BOR120T R1 WITH(NOLOCK) ON R1.COMP_CODE = A.COMP_CODE
												 AND R1.DIV_CODE = B.OUT_DIV_CODE

 WHERE A.COMP_CODE = #{S_COMP_CODE}
   AND A.SALE_DATE LIKE #{BASIS_YM} + '%'
   GROUP BY B.OUT_DIV_CODE ,R1.DIV_NAME

   ORDER BY B.OUT_DIV_CODE
	</select>
	<select id="portalskrServiceImpl.kodiSelectList4" parameterType="Map" resultType="rMap">
SELECT
	A.COMP_CODE
	,A.DIV_CODE
	,C.DIV_NAME +' : '+ REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, ROUND(SUM(A.GOOD_PRODT_Q),0) ), 1 ),'.00','')AS DIV_NAME
	,ROUND(SUM(A.GOOD_PRODT_Q),0) AS GOOD_PRODT_Q
  FROM PMR200T A WITH(NOLOCK)
LEFT JOIN BPR200T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								AND B.DIV_CODE = A.DIV_CODE
								AND B.ITEM_CODE = A.ITEM_CODE
LEFT JOIN BOR120T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
								 AND C.DIV_CODE = A.DIV_CODE
WHERE A.COMP_CODE = #{S_COMP_CODE}
  AND B.ITEM_ACCOUNT IN ('10', '50') --제품, 반제품
  AND A.PRODT_DATE LIKE #{BASIS_YM} + '%'
  AND A.WORK_SHOP_CODE != 'WSK15' --충전작업장 제외
GROUP BY A.COMP_CODE,A.DIV_CODE ,C.DIV_NAME

ORDER BY A.DIV_CODE

	</select>
	<select id="portalskrServiceImpl.kodiSelectList5" parameterType="Map" resultType="rMap">
SELECT
	A.COMP_CODE
	,ISNULL(D.LEVEL_NAME,'') AS ITEM_LEVEL1_NAME
	,SUM(A.GOOD_PRODT_Q) AS GOOD_PRODT_Q
	,REPLACE(CONVERT( VARCHAR, CONVERT( MONEY, SUM(A.GOOD_PRODT_Q) ), 1 ),'.00','') AS GOOD_PRODT_Q_FORMAT
  FROM PMR200T A WITH(NOLOCK)
LEFT JOIN BPR200T B WITH(NOLOCK) ON B.COMP_CODE = A.COMP_CODE
								AND B.DIV_CODE = A.DIV_CODE
								AND B.ITEM_CODE = A.ITEM_CODE
INNER JOIN BPR100T C WITH(NOLOCK) ON C.COMP_CODE = A.COMP_CODE
								 AND C.ITEM_CODE = A.ITEM_CODE

LEFT JOIN BPR000T  D WITH (NOLOCK) ON D.COMP_CODE	= C.COMP_CODE
								   AND D.LEVEL1 != '*'
								   AND D.LEVEL1 = C.ITEM_LEVEL1
								   AND D.LEVEL2 = '*'
								   AND D.LEVEL3 = '*'

WHERE A.COMP_CODE = #{S_COMP_CODE}
  AND A.DIV_CODE = #{DIV_CODE}
  AND B.ITEM_ACCOUNT IN ('10', '50') --제품, 반제품
  AND A.PRODT_DATE LIKE #{BASIS_YM} + '%'
  AND A.WORK_SHOP_CODE != 'WSK15' --충전사업장 제외
GROUP BY A.COMP_CODE,C.ITEM_LEVEL1,D.LEVEL_NAME

ORDER BY SUM(A.GOOD_PRODT_Q) ASC
	</select>
</mapper>